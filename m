Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1030892AbWKOTI4@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1030892AbWKOTI4 (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 15 Nov 2006 14:08:56 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1030903AbWKOTI4
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 15 Nov 2006 14:08:56 -0500
Received: from bay0-omc1-s9.bay0.hotmail.com ([65.54.246.81]:14579 "EHLO
	bay0-omc1-s9.bay0.hotmail.com") by vger.kernel.org with ESMTP
	id S1030892AbWKOTIy (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Wed, 15 Nov 2006 14:08:54 -0500
Message-ID: <BAY20-F39F98C83859B7791817ECD8EA0@phx.gbl>
X-Originating-IP: [80.178.1.111]
X-Originating-Email: [yan_952@hotmail.com]
From: "Burman Yan" <yan_952@hotmail.com>
To: linux-kernel@vger.kernel.org
Cc: trivial@kernel.org, kkeil@suse.de
Subject: [PATCH 2.6.19-rc5] isdn: replace kmalloc+memset with kzalloc
Date: Wed, 15 Nov 2006 21:08:50 +0200
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="----=_NextPart_000_6cac_2861_6584"
X-OriginalArrivalTime: 15 Nov 2006 19:08:53.0715 (UTC) FILETIME=[7DF7EA30:01C708E9]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------=_NextPart_000_6cac_2861_6584
Content-Type: text/plain; format=flowed

Hi.

This is trivial patch to replace kmalloc+memset with kzalloc and remove 
unneeded casts.

Regards
Yan Burman

_________________________________________________________________
Don't just search. Find. Check out the new MSN Search! 
http://search.msn.click-url.com/go/onm00200636ave/direct/01/

------=_NextPart_000_6cac_2861_6584
Content-Type: application/octet-stream; name="kzalloc_isdn.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="kzalloc_isdn.patch"

UmVwbGFjZSBrbWFsbG9jK21lbXNldCB3aXRoIGt6YWxsb2MKClNpZ25lZC1v
ZmYtYnk6IFlhbiBCdXJtYW4gPHlhbl85NTJAaG90bWFpbC5jb20+CgpkaWZm
IC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vYWN0
MjAwMC9tb2R1bGUuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVy
cy9pc2RuL2FjdDIwMDAvbW9kdWxlLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9kcml2ZXJzL2lzZG4vYWN0MjAwMC9tb2R1bGUuYwkyMDA2LTExLTA5
IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2RyaXZlcnMvaXNkbi9hY3QyMDAwL21vZHVsZS5jCTIwMDYt
MTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC01NjcsMTIgKzU2
NywxMSBAQCBhY3QyMDAwX2FsbG9jY2FyZChpbnQgYnVzLCBpbnQgcG9ydCwg
aW50CiB7CiAJaW50IGk7CiAgICAgICAgIGFjdDIwMDBfY2FyZCAqY2FyZDsK
LSAgICAgICAgaWYgKCEoY2FyZCA9IChhY3QyMDAwX2NhcmQgKikga21hbGxv
YyhzaXplb2YoYWN0MjAwMF9jYXJkKSwgR0ZQX0tFUk5FTCkpKSB7CisgICAg
ICAgIGlmICghKGNhcmQgPSBremFsbG9jKHNpemVvZihhY3QyMDAwX2NhcmQp
LCBHRlBfS0VSTkVMKSkpIHsKICAgICAgICAgICAgICAgICBwcmludGsoS0VS
Tl9XQVJOSU5HCiAJCSAgICAgICAiYWN0MjAwMDogKCVzKSBDb3VsZCBub3Qg
YWxsb2NhdGUgY2FyZC1zdHJ1Y3QuXG4iLCBpZCk7CiAgICAgICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9Ci0gICAgICAgIG1lbXNldCgoY2hhciAq
KSBjYXJkLCAwLCBzaXplb2YoYWN0MjAwMF9jYXJkKSk7CiAgICAgICAgIHNw
aW5fbG9ja19pbml0KCZjYXJkLT5sb2NrKTsKICAgICAgICAgc3Bpbl9sb2Nr
X2luaXQoJmNhcmQtPm1ubG9jayk7CiAJc2tiX3F1ZXVlX2hlYWRfaW5pdCgm
Y2FyZC0+c25kcSk7CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmln
L2RyaXZlcnMvaXNkbi9jYXBpL2NhcGkuYyBsaW51eC0yLjYuMTktcmM1X2t6
YWxsb2MvZHJpdmVycy9pc2RuL2NhcGkvY2FwaS5jCi0tLSBsaW51eC0yLjYu
MTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2NhcGkvY2FwaS5jCTIwMDYtMTEt
MDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTkt
cmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2NhcGkvY2FwaS5jCTIwMDYtMTEt
MTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC0yMTUsMTMgKzIxNSwx
MiBAQCBzdGF0aWMgc3RydWN0IGNhcGltaW5vciAqY2FwaW1pbm9yX2FsbG9j
CiAJdW5zaWduZWQgaW50IG1pbm9yID0gMDsKIAl1bnNpZ25lZCBsb25nIGZs
YWdzOwogCi0JbXAgPSBrbWFsbG9jKHNpemVvZigqbXApLCBHRlBfQVRPTUlD
KTsKKwltcCA9IGt6YWxsb2Moc2l6ZW9mKCptcCksIEdGUF9BVE9NSUMpOwog
ICAJaWYgKCFtcCkgewogICAJCXByaW50ayhLRVJOX0VSUiAiY2FwaTogY2Fu
J3QgYWxsb2MgY2FwaW1pbm9yXG4iKTsKIAkJcmV0dXJuIE5VTEw7CiAJfQog
Ci0JbWVtc2V0KG1wLCAwLCBzaXplb2Yoc3RydWN0IGNhcGltaW5vcikpOwog
CW1wLT5hcCA9IGFwOwogCW1wLT5uY2NpID0gbmNjaTsKIAltcC0+bXNnaWQg
PSAwOwpAQCAtMzA0LDEwICszMDMsOSBAQCBzdGF0aWMgc3RydWN0IGNhcGlu
Y2NpICpjYXBpbmNjaV9hbGxvYyhzCiAJc3RydWN0IGNhcGltaW5vciAqbXAg
PSBOVUxMOwogI2VuZGlmIC8qIENPTkZJR19JU0ROX0NBUElfTUlERExFV0FS
RSAqLwogCi0JbnAgPSBrbWFsbG9jKHNpemVvZigqbnApLCBHRlBfQVRPTUlD
KTsKKwlucCA9IGt6YWxsb2Moc2l6ZW9mKCpucCksIEdGUF9BVE9NSUMpOwog
CWlmICghbnApCiAJCXJldHVybiBOVUxMOwotCW1lbXNldChucCwgMCwgc2l6
ZW9mKHN0cnVjdCBjYXBpbmNjaSkpOwogCW5wLT5uY2NpID0gbmNjaTsKIAlu
cC0+Y2RldiA9IGNkZXY7CiAjaWZkZWYgQ09ORklHX0lTRE5fQ0FQSV9NSURE
TEVXQVJFCkBAIC0zODQsMTAgKzM4Miw5IEBAIHN0YXRpYyBzdHJ1Y3QgY2Fw
aWRldiAqY2FwaWRldl9hbGxvYyh2b2kKIAlzdHJ1Y3QgY2FwaWRldiAqY2Rl
djsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JY2RldiA9IGttYWxsb2Mo
c2l6ZW9mKCpjZGV2KSwgR0ZQX0tFUk5FTCk7CisJY2RldiA9IGt6YWxsb2Mo
c2l6ZW9mKCpjZGV2KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFjZGV2KQogCQly
ZXR1cm4gTlVMTDsKLQltZW1zZXQoY2RldiwgMCwgc2l6ZW9mKHN0cnVjdCBj
YXBpZGV2KSk7CiAKIAlpbml0X01VVEVYKCZjZGV2LT5uY2NpX2xpc3Rfc2Vt
KTsKIAlza2JfcXVldWVfaGVhZF9pbml0KCZjZGV2LT5yZWN2cXVldWUpOwpk
aWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4v
Y2FwaS9jYXBpZHJ2LmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZl
cnMvaXNkbi9jYXBpL2NhcGlkcnYuYwotLS0gbGludXgtMi42LjE5LXJjNV9v
cmlnL2RyaXZlcnMvaXNkbi9jYXBpL2NhcGlkcnYuYwkyMDA2LTExLTA5IDEy
OjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2RyaXZlcnMvaXNkbi9jYXBpL2NhcGlkcnYuYwkyMDA2LTExLTEx
IDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMzM0LDEyICszMzQsMTEg
QEAgc3RhdGljIGNhcGlkcnZfcGxjaSAqbmV3X3BsY2koY2FwaWRydl9jbwog
ewogCWNhcGlkcnZfcGxjaSAqcGxjaXA7CiAKLQlwbGNpcCA9IChjYXBpZHJ2
X3BsY2kgKikga21hbGxvYyhzaXplb2YoY2FwaWRydl9wbGNpKSwgR0ZQX0FU
T01JQyk7CisJcGxjaXAgPSBremFsbG9jKHNpemVvZihjYXBpZHJ2X3BsY2kp
LCBHRlBfQVRPTUlDKTsKIAogCWlmIChwbGNpcCA9PSAwKQogCQlyZXR1cm4g
TlVMTDsKIAotCW1lbXNldChwbGNpcCwgMCwgc2l6ZW9mKGNhcGlkcnZfcGxj
aSkpOwogCXBsY2lwLT5zdGF0ZSA9IFNUX1BMQ0lfTk9ORTsKIAlwbGNpcC0+
cGxjaSA9IDA7CiAJcGxjaXAtPm1zZ2lkID0gMDsKQEAgLTQwNCwxMiArNDAz
LDExIEBAIHN0YXRpYyBpbmxpbmUgY2FwaWRydl9uY2NpICpuZXdfbmNjaShj
YXAKIHsKIAljYXBpZHJ2X25jY2kgKm5jY2lwOwogCi0JbmNjaXAgPSAoY2Fw
aWRydl9uY2NpICopIGttYWxsb2Moc2l6ZW9mKGNhcGlkcnZfbmNjaSksIEdG
UF9BVE9NSUMpOworCW5jY2lwID0ga3phbGxvYyhzaXplb2YoY2FwaWRydl9u
Y2NpKSwgR0ZQX0FUT01JQyk7CiAKIAlpZiAobmNjaXAgPT0gMCkKIAkJcmV0
dXJuIE5VTEw7CiAKLQltZW1zZXQobmNjaXAsIDAsIHNpemVvZihjYXBpZHJ2
X25jY2kpKTsKIAluY2NpcC0+bmNjaSA9IG5jY2k7CiAJbmNjaXAtPnN0YXRl
ID0gU1RfTkNDSV9OT05FOwogCW5jY2lwLT5wbGNpcCA9IHBsY2lwOwpAQCAt
MjAwNSwxMiArMjAwMywxMSBAQCBzdGF0aWMgaW50IGNhcGlkcnZfYWRkY29u
dHIodTE2IGNvbnRyLCBzCiAJCXByaW50ayhLRVJOX1dBUk5JTkcgImNhcGlk
cnY6ICglcykgQ291bGQgbm90IHJlc2VydmUgbW9kdWxlXG4iLCBpZCk7CiAJ
CXJldHVybiAtMTsKIAl9Ci0JaWYgKCEoY2FyZCA9IChjYXBpZHJ2X2NvbnRy
ICopIGttYWxsb2Moc2l6ZW9mKGNhcGlkcnZfY29udHIpLCBHRlBfQVRPTUlD
KSkpIHsKKwlpZiAoIShjYXJkID0ga3phbGxvYyhzaXplb2YoY2FwaWRydl9j
b250ciksIEdGUF9BVE9NSUMpKSkgewogCQlwcmludGsoS0VSTl9XQVJOSU5H
CiAJCSAiY2FwaWRydjogKCVzKSBDb3VsZCBub3QgYWxsb2NhdGUgY29udHIt
c3RydWN0LlxuIiwgaWQpOwogCQlyZXR1cm4gLTE7CiAJfQotCW1lbXNldChj
YXJkLCAwLCBzaXplb2YoY2FwaWRydl9jb250cikpOwogCWNhcmQtPm93bmVy
ID0gVEhJU19NT0RVTEU7CiAJaW5pdF90aW1lcigmY2FyZC0+bGlzdGVudGlt
ZXIpOwogCXN0cmNweShjYXJkLT5uYW1lLCBpZCk7CmRpZmYgLXJ1YnAgbGlu
dXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9oYXJkd2FyZS9hdm0v
YXZtX2NzLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNk
bi9oYXJkd2FyZS9hdm0vYXZtX2NzLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9kcml2ZXJzL2lzZG4vaGFyZHdhcmUvYXZtL2F2bV9jcy5jCTIwMDYt
MTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYu
MTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hhcmR3YXJlL2F2bS9hdm1f
Y3MuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAt
MTIxLDEwICsxMjEsOSBAQCBzdGF0aWMgaW50IGF2bWNzX3Byb2JlKHN0cnVj
dCBwY21jaWFfZGV2CiAgICAgcF9kZXYtPmNvbmYuUHJlc2VudCA9IFBSRVNF
TlRfT1BUSU9OOwogCiAgICAgLyogQWxsb2NhdGUgc3BhY2UgZm9yIHByaXZh
dGUgZGV2aWNlLXNwZWNpZmljIGRhdGEgKi8KLSAgICBsb2NhbCA9IGttYWxs
b2Moc2l6ZW9mKGxvY2FsX2luZm9fdCksIEdGUF9LRVJORUwpOworICAgIGxv
Y2FsID0ga3phbGxvYyhzaXplb2YobG9jYWxfaW5mb190KSwgR0ZQX0tFUk5F
TCk7CiAgICAgaWYgKCFsb2NhbCkKICAgICAgICAgZ290byBlcnI7Ci0gICAg
bWVtc2V0KGxvY2FsLCAwLCBzaXplb2YobG9jYWxfaW5mb190KSk7CiAgICAg
cF9kZXYtPnByaXYgPSBsb2NhbDsKIAogICAgIHJldHVybiBhdm1jc19jb25m
aWcocF9kZXYpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9k
cml2ZXJzL2lzZG4vaGFyZHdhcmUvYXZtL2IxLmMgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2RyaXZlcnMvaXNkbi9oYXJkd2FyZS9hdm0vYjEuYwotLS0g
bGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9oYXJkd2FyZS9h
dm0vYjEuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAor
KysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9oYXJk
d2FyZS9hdm0vYjEuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCAr
MDIwMApAQCAtNjUsMTggKzY1LDE1IEBAIGF2bWNhcmQgKmIxX2FsbG9jX2Nh
cmQoaW50IG5yX2NvbnRyb2xsZXIKIAlhdm1jdHJsX2luZm8gKmNpbmZvOwog
CWludCBpOwogCi0JY2FyZCA9IGttYWxsb2Moc2l6ZW9mKCpjYXJkKSwgR0ZQ
X0tFUk5FTCk7CisJY2FyZCA9IGt6YWxsb2Moc2l6ZW9mKCpjYXJkKSwgR0ZQ
X0tFUk5FTCk7CiAJaWYgKCFjYXJkKQogCQlyZXR1cm4gTlVMTDsKIAotCW1l
bXNldChjYXJkLCAwLCBzaXplb2YoKmNhcmQpKTsKLQotICAgICAgICBjaW5m
byA9IGttYWxsb2Moc2l6ZW9mKCpjaW5mbykgKiBucl9jb250cm9sbGVycywg
R0ZQX0tFUk5FTCk7CisgICAgICAgIGNpbmZvID0ga3phbGxvYyhzaXplb2Yo
KmNpbmZvKSAqIG5yX2NvbnRyb2xsZXJzLCBHRlBfS0VSTkVMKTsKIAlpZiAo
IWNpbmZvKSB7CiAJCWtmcmVlKGNhcmQpOwogCQlyZXR1cm4gTlVMTDsKIAl9
Ci0JbWVtc2V0KGNpbmZvLCAwLCBzaXplb2YoKmNpbmZvKSAqIG5yX2NvbnRy
b2xsZXJzKTsKIAogCWNhcmQtPmN0cmxpbmZvID0gY2luZm87CiAJZm9yIChp
ID0gMDsgaSA8IG5yX2NvbnRyb2xsZXJzOyBpKyspIHsKQEAgLTcxOCwxMiAr
NzE1LDExIEBAIGF2bWNhcmRfZG1hX2FsbG9jKGNoYXIgKm5hbWUsIHN0cnVj
dCBwY2kKIAlhdm1jYXJkX2RtYWluZm8gKnA7CiAJdm9pZCAqYnVmOwogCi0J
cCA9IGttYWxsb2Moc2l6ZW9mKGF2bWNhcmRfZG1haW5mbyksIEdGUF9LRVJO
RUwpOworCXAgPSBremFsbG9jKHNpemVvZihhdm1jYXJkX2RtYWluZm8pLCBH
RlBfS0VSTkVMKTsKIAlpZiAoIXApIHsKIAkJcHJpbnRrKEtFUk5fV0FSTklO
RyAiJXM6IG5vIG1lbW9yeS5cbiIsIG5hbWUpOwogCQlnb3RvIGVycjsKIAl9
Ci0JbWVtc2V0KHAsIDAsIHNpemVvZihhdm1jYXJkX2RtYWluZm8pKTsKIAog
CXAtPnJlY3ZidWYuc2l6ZSA9IHJzaXplOwogCWJ1ZiA9IHBjaV9hbGxvY19j
b25zaXN0ZW50KHBkZXYsIHJzaXplLCAmcC0+cmVjdmJ1Zi5kbWFhZGRyKTsK
ZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2Ru
L2hpc2F4L2F2bWExX2NzLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9oaXNheC9hdm1hMV9jcy5jCi0tLSBsaW51eC0yLjYuMTkt
cmM1X29yaWcvZHJpdmVycy9pc2RuL2hpc2F4L2F2bWExX2NzLmMJMjAwNi0x
MS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4x
OS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaGlzYXgvYXZtYTFfY3MuYwky
MDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTIzLDEx
ICsxMjMsMTAgQEAgc3RhdGljIGludCBhdm1hMWNzX3Byb2JlKHN0cnVjdCBw
Y21jaWFfZAogICAgIERFQlVHKDAsICJhdm1hMWNzX2F0dGFjaCgpXG4iKTsK
IAogICAgIC8qIEFsbG9jYXRlIHNwYWNlIGZvciBwcml2YXRlIGRldmljZS1z
cGVjaWZpYyBkYXRhICovCi0gICAgbG9jYWwgPSBrbWFsbG9jKHNpemVvZihs
b2NhbF9pbmZvX3QpLCBHRlBfS0VSTkVMKTsKKyAgICBsb2NhbCA9IGt6YWxs
b2Moc2l6ZW9mKGxvY2FsX2luZm9fdCksIEdGUF9LRVJORUwpOwogICAgIGlm
ICghbG9jYWwpCiAJcmV0dXJuIC1FTk9NRU07CiAKLSAgICBtZW1zZXQobG9j
YWwsIDAsIHNpemVvZihsb2NhbF9pbmZvX3QpKTsKICAgICBwX2Rldi0+cHJp
diA9IGxvY2FsOwogCiAgICAgLyogVGhlIGlvIHN0cnVjdHVyZSBkZXNjcmli
ZXMgSU8gcG9ydCBtYXBwaW5nICovCmRpZmYgLXJ1YnAgbGludXgtMi42LjE5
LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9oaXNheC9jb25maWcuYyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hpc2F4L2NvbmZpZy5j
Ci0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2hpc2F4
L2NvbmZpZy5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAw
CisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hp
c2F4L2NvbmZpZy5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICsw
MjAwCkBAIC04NjksMTQgKzg2OSwxMyBAQCBzdGF0aWMgaW50IGNoZWNrY2Fy
ZChpbnQgY2FyZG5yLCBjaGFyICppCiAJc3RydWN0IElzZG5DYXJkICpjYXJk
ID0gY2FyZHMgKyBjYXJkbnI7CiAJc3RydWN0IElzZG5DYXJkU3RhdGUgKmNz
OwogCi0JY3MgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgSXNkbkNhcmRTdGF0
ZSksIEdGUF9BVE9NSUMpOworCWNzID0ga3phbGxvYyhzaXplb2Yoc3RydWN0
IElzZG5DYXJkU3RhdGUpLCBHRlBfQVRPTUlDKTsKIAlpZiAoIWNzKSB7CiAJ
CXByaW50ayhLRVJOX1dBUk5JTkcKIAkJICAgICAgICJIaVNheDogTm8gbWVt
b3J5IGZvciBJc2RuQ2FyZFN0YXRlKGNhcmQgJWQpXG4iLAogCQkgICAgICAg
Y2FyZG5yICsgMSk7CiAJCWdvdG8gb3V0OwogCX0KLQltZW1zZXQoY3MsIDAs
IHNpemVvZihzdHJ1Y3QgSXNkbkNhcmRTdGF0ZSkpOwogCWNhcmQtPmNzID0g
Y3M7CiAJc3Bpbl9sb2NrX2luaXQoJmNzLT5zdGF0bG9jayk7CiAJc3Bpbl9s
b2NrX2luaXQoJmNzLT5sb2NrKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTkt
cmM1X29yaWcvZHJpdmVycy9pc2RuL2hpc2F4L2Vsc2FfY3MuYyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hpc2F4L2Vsc2FfY3Mu
YwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9oaXNh
eC9lbHNhX2NzLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAy
MDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4v
aGlzYXgvZWxzYV9jcy5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAw
ICswMjAwCkBAIC0xNDYsOSArMTQ2LDggQEAgc3RhdGljIGludCBlbHNhX2Nz
X3Byb2JlKHN0cnVjdCBwY21jaWFfZAogICAgIERFQlVHKDAsICJlbHNhX2Nz
X2F0dGFjaCgpXG4iKTsKIAogICAgIC8qIEFsbG9jYXRlIHNwYWNlIGZvciBw
cml2YXRlIGRldmljZS1zcGVjaWZpYyBkYXRhICovCi0gICAgbG9jYWwgPSBr
bWFsbG9jKHNpemVvZihsb2NhbF9pbmZvX3QpLCBHRlBfS0VSTkVMKTsKKyAg
ICBsb2NhbCA9IGt6YWxsb2Moc2l6ZW9mKGxvY2FsX2luZm9fdCksIEdGUF9L
RVJORUwpOwogICAgIGlmICghbG9jYWwpIHJldHVybiAtRU5PTUVNOwotICAg
IG1lbXNldChsb2NhbCwgMCwgc2l6ZW9mKGxvY2FsX2luZm9fdCkpOwogCiAg
ICAgbG9jYWwtPnBfZGV2ID0gbGluazsKICAgICBsaW5rLT5wcml2ID0gbG9j
YWw7CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMv
aXNkbi9oaXNheC9mc20uYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJp
dmVycy9pc2RuL2hpc2F4L2ZzbS5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29y
aWcvZHJpdmVycy9pc2RuL2hpc2F4L2ZzbS5jCTIwMDYtMTEtMDkgMTI6MTY6
MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxs
b2MvZHJpdmVycy9pc2RuL2hpc2F4L2ZzbS5jCTIwMDYtMTEtMTEgMjI6NDQ6
MDQuMDAwMDAwMDAwICswMjAwCkBAIC0yNiwxMiArMjYsMTAgQEAgRnNtTmV3
KHN0cnVjdCBGc20gKmZzbSwgc3RydWN0IEZzbU5vZGUgKgogCWludCBpOwog
CiAJZnNtLT5qdW1wbWF0cml4ID0gKEZTTUZOUFRSICopCi0JCWttYWxsb2Mo
c2l6ZW9mIChGU01GTlBUUikgKiBmc20tPnN0YXRlX2NvdW50ICogZnNtLT5l
dmVudF9jb3VudCwgR0ZQX0tFUk5FTCk7CisJCWt6YWxsb2Moc2l6ZW9mIChG
U01GTlBUUikgKiBmc20tPnN0YXRlX2NvdW50ICogZnNtLT5ldmVudF9jb3Vu
dCwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFmc20tPmp1bXBtYXRyaXgpCiAJCXJl
dHVybiAtRU5PTUVNOwogCi0JbWVtc2V0KGZzbS0+anVtcG1hdHJpeCwgMCwg
c2l6ZW9mIChGU01GTlBUUikgKiBmc20tPnN0YXRlX2NvdW50ICogZnNtLT5l
dmVudF9jb3VudCk7Ci0KIAlmb3IgKGkgPSAwOyBpIDwgZm5jb3VudDsgaSsr
KSAKIAkJaWYgKChmbmxpc3RbaV0uc3RhdGU+PWZzbS0+c3RhdGVfY291bnQp
IHx8IChmbmxpc3RbaV0uZXZlbnQ+PWZzbS0+ZXZlbnRfY291bnQpKSB7CiAJ
CQlwcmludGsoS0VSTl9FUlIgIkZzbU5ldyBFcnJvciBsaW5lICVkIHN0KCVs
ZC8lbGQpIGV2KCVsZC8lbGQpXG4iLApkaWZmIC1ydWJwIGxpbnV4LTIuNi4x
OS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaGlzYXgvaGZjNHM4c19sMS5jIGxp
bnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaGlzYXgvaGZj
NHM4c19sMS5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9p
c2RuL2hpc2F4L2hmYzRzOHNfbDEuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAw
MDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9oaXNheC9oZmM0czhzX2wxLmMJMjAwNi0xMS0xMSAyMjo0
NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTE1OTAsMTEgKzE1OTAsMTAgQEAg
aGZjNHM4c19wcm9iZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgY29ucwogCWhm
YzRzOHNfcGFyYW0gKmRyaXZlcl9kYXRhID0gKGhmYzRzOHNfcGFyYW0gKikg
ZW50LT5kcml2ZXJfZGF0YTsKIAloZmM0czhzX2h3ICpodzsKIAotCWlmICgh
KGh3ID0ga21hbGxvYyhzaXplb2YoaGZjNHM4c19odyksIEdGUF9BVE9NSUMp
KSkgeworCWlmICghKGh3ID0ga3phbGxvYyhzaXplb2YoaGZjNHM4c19odyks
IEdGUF9BVE9NSUMpKSkgewogCQlwcmludGsoS0VSTl9FUlIgIk5vIGttZW0g
Zm9yIEhGQy00Uy84UyBjYXJkXG4iKTsKIAkJcmV0dXJuIChlcnIpOwogCX0K
LQltZW1zZXQoaHcsIDAsIHNpemVvZihoZmM0czhzX2h3KSk7CiAKIAlody0+
cGRldiA9IHBkZXY7CiAJZXJyID0gcGNpX2VuYWJsZV9kZXZpY2UocGRldik7
CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNk
bi9oaXNheC9oZmNfdXNiLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9oaXNheC9oZmNfdXNiLmMKLS0tIGxpbnV4LTIuNi4xOS1y
YzVfb3JpZy9kcml2ZXJzL2lzZG4vaGlzYXgvaGZjX3VzYi5jCTIwMDYtMTEt
MDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTkt
cmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hpc2F4L2hmY191c2IuYwkyMDA2
LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTQ4MSw5ICsx
NDgxLDggQEAgaGZjX3VzYl9wcm9iZShzdHJ1Y3QgdXNiX2ludGVyZmFjZSAq
aW50ZgogCQkJaWZhY2UgPSBpZmFjZV91c2VkOwogCQkJaWYgKCEKIAkJCSAg
ICAoY29udGV4dCA9Ci0JCQkgICAgIGttYWxsb2Moc2l6ZW9mKGhmY3VzYl9k
YXRhKSwgR0ZQX0tFUk5FTCkpKQorCQkJICAgICBremFsbG9jKHNpemVvZiho
ZmN1c2JfZGF0YSksIEdGUF9LRVJORUwpKSkKIAkJCQlyZXR1cm4gKC1FTk9N
RU0pOwkvKiBnb3Qgbm8gbWVtICovCi0JCQltZW1zZXQoY29udGV4dCwgMCwg
c2l6ZW9mKGhmY3VzYl9kYXRhKSk7CiAKIAkJCWVwID0gaWZhY2UtPmVuZHBv
aW50OwogCQkJdmNmID0gdmFsaWRjb25mW3NtYWxsX21hdGNoXTsKZGlmZiAt
cnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2hpc2F4
L2hpc2F4X2ZjcGNpcG5wLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9oaXNheC9oaXNheF9mY3BjaXBucC5jCi0tLSBsaW51eC0y
LjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2hpc2F4L2hpc2F4X2ZjcGNp
cG5wLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysr
IGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaGlzYXgv
aGlzYXhfZmNwY2lwbnAuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAw
MCArMDIwMApAQCAtODQxLDEyICs4NDEsMTAgQEAgbmV3X2FkYXB0ZXIodm9p
ZCkKIAlzdHJ1Y3QgaGlzYXhfYl9pZiAqYl9pZlsyXTsKIAlpbnQgaTsKIAot
CWFkYXB0ZXIgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgZnJpdHpfYWRhcHRl
ciksIEdGUF9LRVJORUwpOworCWFkYXB0ZXIgPSBremFsbG9jKHNpemVvZihz
dHJ1Y3QgZnJpdHpfYWRhcHRlciksIEdGUF9LRVJORUwpOwogCWlmICghYWRh
cHRlcikKIAkJcmV0dXJuIE5VTEw7CiAKLQltZW1zZXQoYWRhcHRlciwgMCwg
c2l6ZW9mKHN0cnVjdCBmcml0el9hZGFwdGVyKSk7Ci0KIAlhZGFwdGVyLT5p
c2FjLmhpc2F4X2RfaWYub3duZXIgPSBUSElTX01PRFVMRTsKIAlhZGFwdGVy
LT5pc2FjLmhpc2F4X2RfaWYuaWZjLnByaXYgPSAmYWRhcHRlci0+aXNhYzsK
IAlhZGFwdGVyLT5pc2FjLmhpc2F4X2RfaWYuaWZjLmwybDEgPSBpc2FjX2Rf
bDJsMTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVy
cy9pc2RuL2hpc2F4L3NlZGxiYXVlcl9jcy5jIGxpbnV4LTIuNi4xOS1yYzVf
a3phbGxvYy9kcml2ZXJzL2lzZG4vaGlzYXgvc2VkbGJhdWVyX2NzLmMKLS0t
IGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaGlzYXgvc2Vk
bGJhdWVyX2NzLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAy
MDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4v
aGlzYXgvc2VkbGJhdWVyX2NzLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAw
MDAwMDAgKzAyMDAKQEAgLTE1NSw5ICsxNTUsOCBAQCBzdGF0aWMgaW50IHNl
ZGxiYXVlcl9wcm9iZShzdHJ1Y3QgcGNtY2lhCiAgICAgREVCVUcoMCwgInNl
ZGxiYXVlcl9hdHRhY2goKVxuIik7CiAKICAgICAvKiBBbGxvY2F0ZSBzcGFj
ZSBmb3IgcHJpdmF0ZSBkZXZpY2Utc3BlY2lmaWMgZGF0YSAqLwotICAgIGxv
Y2FsID0ga21hbGxvYyhzaXplb2YobG9jYWxfaW5mb190KSwgR0ZQX0tFUk5F
TCk7CisgICAgbG9jYWwgPSBremFsbG9jKHNpemVvZihsb2NhbF9pbmZvX3Qp
LCBHRlBfS0VSTkVMKTsKICAgICBpZiAoIWxvY2FsKSByZXR1cm4gLUVOT01F
TTsKLSAgICBtZW1zZXQobG9jYWwsIDAsIHNpemVvZihsb2NhbF9pbmZvX3Qp
KTsKICAgICBsb2NhbC0+Y2FyZG5yID0gLTE7CiAKICAgICBsb2NhbC0+cF9k
ZXYgPSBsaW5rOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9k
cml2ZXJzL2lzZG4vaGlzYXgvc3Q1NDgxX2luaXQuYyBsaW51eC0yLjYuMTkt
cmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2hpc2F4L3N0NTQ4MV9pbml0LmMK
LS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaGlzYXgv
c3Q1NDgxX2luaXQuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCAr
MDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNk
bi9oaXNheC9zdDU0ODFfaW5pdC5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAw
MDAwMDAwICswMjAwCkBAIC02OSwxMiArNjksMTAgQEAgc3RhdGljIGludCBw
cm9iZV9zdDU0ODEoc3RydWN0IHVzYl9pbnRlcgogCSAgICAgbGUxNl90b19j
cHUoZGV2LT5kZXNjcmlwdG9yLmlkUHJvZHVjdCksCiAJICAgICBudW1iZXJf
b2ZfbGVkcyk7CiAKLQlhZGFwdGVyID0ga21hbGxvYyhzaXplb2Yoc3RydWN0
IHN0NTQ4MV9hZGFwdGVyKSwgR0ZQX0tFUk5FTCk7CisJYWRhcHRlciA9IGt6
YWxsb2Moc2l6ZW9mKHN0cnVjdCBzdDU0ODFfYWRhcHRlciksIEdGUF9LRVJO
RUwpOwogCWlmICghYWRhcHRlcikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlt
ZW1zZXQoYWRhcHRlciwgMCwgc2l6ZW9mKHN0cnVjdCBzdDU0ODFfYWRhcHRl
cikpOwotCiAJYWRhcHRlci0+bnVtYmVyX29mX2xlZHMgPSBudW1iZXJfb2Zf
bGVkczsKIAlhZGFwdGVyLT51c2JfZGV2ID0gZGV2OwogCmRpZmYgLXJ1YnAg
bGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9oaXNheC90ZWxl
c19jcy5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4v
aGlzYXgvdGVsZXNfY3MuYwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2Ry
aXZlcnMvaXNkbi9oaXNheC90ZWxlc19jcy5jCTIwMDYtMTEtMDkgMTI6MTY6
MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxs
b2MvZHJpdmVycy9pc2RuL2hpc2F4L3RlbGVzX2NzLmMJMjAwNi0xMS0xMSAy
Mjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTEzNyw5ICsxMzcsOCBAQCBz
dGF0aWMgaW50IHRlbGVzX3Byb2JlKHN0cnVjdCBwY21jaWFfZGV2CiAgICAg
REVCVUcoMCwgInRlbGVzX2F0dGFjaCgpXG4iKTsKIAogICAgIC8qIEFsbG9j
YXRlIHNwYWNlIGZvciBwcml2YXRlIGRldmljZS1zcGVjaWZpYyBkYXRhICov
Ci0gICAgbG9jYWwgPSBrbWFsbG9jKHNpemVvZihsb2NhbF9pbmZvX3QpLCBH
RlBfS0VSTkVMKTsKKyAgICBsb2NhbCA9IGt6YWxsb2Moc2l6ZW9mKGxvY2Fs
X2luZm9fdCksIEdGUF9LRVJORUwpOwogICAgIGlmICghbG9jYWwpIHJldHVy
biAtRU5PTUVNOwotICAgIG1lbXNldChsb2NhbCwgMCwgc2l6ZW9mKGxvY2Fs
X2luZm9fdCkpOwogICAgIGxvY2FsLT5jYXJkbnIgPSAtMTsKIAogICAgIGxv
Y2FsLT5wX2RldiA9IGxpbms7CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJj
NV9vcmlnL2RyaXZlcnMvaXNkbi9oeXNkbi9oeWNhcGkuYyBsaW51eC0yLjYu
MTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2h5c2RuL2h5Y2FwaS5jCi0t
LSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2h5c2RuL2h5
Y2FwaS5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisr
KyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2h5c2Ru
L2h5Y2FwaS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAw
CkBAIC03NDUsMTIgKzc0NSwxMSBAQCBoeWNhcGlfY2FwaV9jcmVhdGUoaHlz
ZG5fY2FyZCAqY2FyZCkKIAkJcmV0dXJuIDE7CiAJfQogCWlmICghY2FyZC0+
aHljdHJsaW5mbykgewotCQljaW5mbyA9IChoeWNhcGljdHJsX2luZm8gKikg
a21hbGxvYyhzaXplb2YoaHljYXBpY3RybF9pbmZvKSwgR0ZQX0FUT01JQyk7
CisJCWNpbmZvID0ga3phbGxvYyhzaXplb2YoaHljYXBpY3RybF9pbmZvKSwg
R0ZQX0FUT01JQyk7CiAJCWlmICghY2luZm8pIHsKIAkJCXByaW50ayhLRVJO
X1dBUk5JTkcgIkhZU0ROOiBubyBtZW1vcnkgZm9yIGNhcGktY3RybC5cbiIp
OwogCQkJcmV0dXJuIC1FTk9NRU07CiAJCX0KLQkJbWVtc2V0KGNpbmZvLCAw
LCBzaXplb2YoaHljYXBpY3RybF9pbmZvKSk7CiAJCWNhcmQtPmh5Y3RybGlu
Zm8gPSBjaW5mbzsKIAkJY2luZm8tPmNhcmQgPSBjYXJkOwogCQlzcGluX2xv
Y2tfaW5pdCgmY2luZm8tPmxvY2spOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4x
OS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5fYm9vdC5jIGxp
bnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlz
ZG5fYm9vdC5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9p
c2RuL2h5c2RuL2h5c2RuX2Jvb3QuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAw
MDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9oeXNkbi9oeXNkbl9ib290LmMJMjAwNi0xMS0xMSAyMjo0
NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTI3OCwxNCArMjc4LDEzIEBAIHBv
Zl93cml0ZV9vcGVuKGh5c2RuX2NhcmQgKiBjYXJkLCB1bnNpZ24KIAkJcmV0
dXJuICgtRVJSX0FMUkVBRFlfQk9PVCk7CS8qIGJvb3QgYWxyZWFkeSBhY3Rp
dmUgKi8KIAl9CiAJLyogZXJyb3Igbm8gbWVtIGF2YWlsYWJsZSAqLwotCWlm
ICghKGJvb3QgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYm9vdF9kYXRhKSwg
R0ZQX0tFUk5FTCkpKSB7CisJaWYgKCEoYm9vdCA9IGt6YWxsb2Moc2l6ZW9m
KHN0cnVjdCBib290X2RhdGEpLCBHRlBfS0VSTkVMKSkpIHsKIAkJaWYgKGNh
cmQtPmRlYnVnX2ZsYWdzICYgTE9HX01FTV9FUlIpCiAJCQloeXNkbl9hZGRs
b2coY2FyZCwgIlBPRiBvcGVuOiB1bmFibGUgdG8gYWxsb2NhdGUgbWVtIik7
CiAJCXJldHVybiAoLUVGQVVMVCk7CiAJfQogCWNhcmQtPmJvb3QgPSBib290
OwogCWNhcmQtPnN0YXRlID0gQ0FSRF9TVEFURV9CT09USU5HOwotCW1lbXNl
dChib290LCAwLCBzaXplb2Yoc3RydWN0IGJvb3RfZGF0YSkpOwogCiAJY2Fy
ZC0+c3RvcGNhcmQoY2FyZCk7CS8qIGZpcnN0IHN0b3AgdGhlIGNhcmQgKi8K
IAlpZiAoY2FyZC0+dGVzdHJhbShjYXJkKSkgewpkaWZmIC1ydWJwIGxpbnV4
LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5faW5p
dC5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaHlz
ZG4vaHlzZG5faW5pdC5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJp
dmVycy9pc2RuL2h5c2RuL2h5c2RuX2luaXQuYwkyMDA2LTExLTA5IDEyOjE2
OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFs
bG9jL2RyaXZlcnMvaXNkbi9oeXNkbi9oeXNkbl9pbml0LmMJMjAwNi0xMS0x
MSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTgxLDExICs4MSwxMCBA
QCBzZWFyY2hfY2FyZHModm9pZCkKIAkJaWYgKHBjaV9lbmFibGVfZGV2aWNl
KGFrdF9wY2lkZXYpKQogCQkJY29udGludWU7CiAKLQkJaWYgKCEoY2FyZCA9
IGttYWxsb2Moc2l6ZW9mKGh5c2RuX2NhcmQpLCBHRlBfS0VSTkVMKSkpIHsK
KwkJaWYgKCEoY2FyZCA9IGt6YWxsb2Moc2l6ZW9mKGh5c2RuX2NhcmQpLCBH
RlBfS0VSTkVMKSkpIHsKIAkJCXByaW50ayhLRVJOX0VSUiAiSFlTRE46IHVu
YWJsZSB0byBhbGxvYyBkZXZpY2UgbWVtIFxuIik7CiAJCQlyZXR1cm47CiAJ
CX0KLQkJbWVtc2V0KGNhcmQsIDAsIHNpemVvZihoeXNkbl9jYXJkKSk7CiAJ
CWNhcmQtPm15aWQgPSBjYXJkbWF4OwkvKiBzZXQgb3duIGlkICovCiAJCWNh
cmQtPmJ1cyA9IGFrdF9wY2lkZXYtPmJ1cy0+bnVtYmVyOwogCQljYXJkLT5k
ZXZmbiA9IGFrdF9wY2lkZXYtPmRldmZuOwkvKiBzbG90ICsgZnVuY3Rpb24g
Ki8KZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9p
c2RuL2h5c2RuL2h5c2RuX25ldC5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxv
Yy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5fbmV0LmMKLS0tIGxpbnV4LTIu
Ni4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5fbmV0LmMJ
MjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4
LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5f
bmV0LmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAg
LTI3OCwxMSArMjc4LDEwIEBAIGh5c2RuX25ldF9jcmVhdGUoaHlzZG5fY2Fy
ZCAqIGNhcmQpCiAJCXJldHVybiAoLUVOT01FTSk7CiAJfQogCWh5c2RuX25l
dF9yZWxlYXNlKGNhcmQpOwkvKiByZWxlYXNlIGFuIGV4aXN0aW5nIG5ldCBk
ZXZpY2UgKi8KLQlpZiAoKGRldiA9IGttYWxsb2Moc2l6ZW9mKHN0cnVjdCBu
ZXRfbG9jYWwpLCBHRlBfS0VSTkVMKSkgPT0gTlVMTCkgeworCWlmICgoZGV2
ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IG5ldF9sb2NhbCksIEdGUF9LRVJO
RUwpKSA9PSBOVUxMKSB7CiAJCXByaW50ayhLRVJOX1dBUk5JTkcgIkhZU0RO
OiB1bmFibGUgdG8gYWxsb2NhdGUgbWVtXG4iKTsKIAkJcmV0dXJuICgtRU5P
TUVNKTsKIAl9Ci0JbWVtc2V0KGRldiwgMCwgc2l6ZW9mKHN0cnVjdCBuZXRf
bG9jYWwpKTsJLyogY2xlYW4gdGhlIHN0cnVjdHVyZSAqLwogCiAJc3Bpbl9s
b2NrX2luaXQoJigoc3RydWN0IG5ldF9sb2NhbCAqKSBkZXYpLT5sb2NrKTsK
IApkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lz
ZG4vaHlzZG4vaHlzZG5fcHJvY2xvZy5jIGxpbnV4LTIuNi4xOS1yYzVfa3ph
bGxvYy9kcml2ZXJzL2lzZG4vaHlzZG4vaHlzZG5fcHJvY2xvZy5jCi0tLSBs
aW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL2h5c2RuL2h5c2Ru
X3Byb2Nsb2cuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIw
MAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9o
eXNkbi9oeXNkbl9wcm9jbG9nLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAw
MDAwMDAgKzAyMDAKQEAgLTQwNSw4ICs0MDUsNyBAQCBoeXNkbl9wcm9jbG9n
X2luaXQoaHlzZG5fY2FyZCAqIGNhcmQpCiAKIAkvKiBjcmVhdGUgYSBjYXJk
bG9nIHByb2MgZW50cnkgKi8KIAotCWlmICgocGQgPSAoc3RydWN0IHByb2Nk
YXRhICopIGttYWxsb2Moc2l6ZW9mKHN0cnVjdCBwcm9jZGF0YSksIEdGUF9L
RVJORUwpKSAhPSBOVUxMKSB7Ci0JCW1lbXNldChwZCwgMCwgc2l6ZW9mKHN0
cnVjdCBwcm9jZGF0YSkpOworCWlmICgocGQgPSBremFsbG9jKHNpemVvZihz
dHJ1Y3QgcHJvY2RhdGEpLCBHRlBfS0VSTkVMKSkgIT0gTlVMTCkgewogCQlz
cHJpbnRmKHBkLT5sb2dfbmFtZSwgIiVzJWQiLCBQUk9DX0xPR19CQVNFTkFN
RSwgY2FyZC0+bXlpZCk7CiAJCWlmICgocGQtPmxvZyA9IGNyZWF0ZV9wcm9j
X2VudHJ5KHBkLT5sb2dfbmFtZSwgU19JRlJFRyB8IFNfSVJVR08gfCBTX0lX
VVNSLCBoeXNkbl9wcm9jX2VudHJ5KSkgIT0gTlVMTCkgewogCQkgICAgICAg
IHBkLT5sb2ctPnByb2NfZm9wcyA9ICZsb2dfZm9wczsgCmRpZmYgLXJ1YnAg
bGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9pNGwvaXNkbl9i
c2Rjb21wLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNk
bi9pNGwvaXNkbl9ic2Rjb21wLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3Jp
Zy9kcml2ZXJzL2lzZG4vaTRsL2lzZG5fYnNkY29tcC5jCTIwMDYtMTEtMDkg
MTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1
X2t6YWxsb2MvZHJpdmVycy9pc2RuL2k0bC9pc2RuX2JzZGNvbXAuYwkyMDA2
LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMzMxLDEyICsz
MzEsMTAgQEAgc3RhdGljIHZvaWQgKmJzZF9hbGxvYyAoc3RydWN0IGlzZG5f
cHBwXwogCSAqIEFsbG9jYXRlIHRoZSBtYWluIGNvbnRyb2wgc3RydWN0dXJl
IGZvciB0aGlzIGluc3RhbmNlLgogCSAqLwogCW1heG1heGNvZGUgPSBNQVhD
T0RFKGJpdHMpOwotCWRiID0gKHN0cnVjdCBic2RfZGIgKikga21hbGxvYyAo
c2l6ZW9mIChzdHJ1Y3QgYnNkX2RiKSxHRlBfS0VSTkVMKTsKKwlkYiA9IGt6
YWxsb2MgKHNpemVvZiAoc3RydWN0IGJzZF9kYiksR0ZQX0tFUk5FTCk7CiAJ
aWYgKCFkYikKIAkJcmV0dXJuIE5VTEw7CiAKLQltZW1zZXQgKGRiLCAwLCBz
aXplb2Yoc3RydWN0IGJzZF9kYikpOwotCiAJZGItPnhtaXQgPSBkYXRhLT5m
bGFncyAmIElQUFBfQ09NUF9GTEFHX1hNSVQ7CiAJZGVjb21wID0gZGItPnht
aXQgPyAwIDogMTsKIApkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3Jp
Zy9kcml2ZXJzL2lzZG4vaTRsL2lzZG5fY29tbW9uLmMgbGludXgtMi42LjE5
LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9pNGwvaXNkbl9jb21tb24uYwot
LS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9pNGwvaXNk
bl9jb21tb24uYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIw
MAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9p
NGwvaXNkbl9jb21tb24uYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAw
MCArMDIwMApAQCAtMjA3MiwyMSArMjA3MiwxOSBAQCBpc2RuX2FkZF9jaGFu
bmVscyhpc2RuX2RyaXZlcl90ICpkLCBpbnQgCiAKIAlpZiAoKGFkZGluZykg
JiYgKGQtPnJjdmVycikpCiAJCWtmcmVlKGQtPnJjdmVycik7Ci0JaWYgKCEo
ZC0+cmN2ZXJyID0ga21hbGxvYyhzaXplb2YoaW50KSAqIG0sIEdGUF9BVE9N
SUMpKSkgeworCWlmICghKGQtPnJjdmVyciA9IGt6YWxsb2Moc2l6ZW9mKGlu
dCkgKiBtLCBHRlBfQVRPTUlDKSkpIHsKIAkJcHJpbnRrKEtFUk5fV0FSTklO
RyAicmVnaXN0ZXJfaXNkbjogQ291bGQgbm90IGFsbG9jIHJjdmVyclxuIik7
CiAJCXJldHVybiAtMTsKIAl9Ci0JbWVtc2V0KChjaGFyICopIGQtPnJjdmVy
ciwgMCwgc2l6ZW9mKGludCkgKiBtKTsKIAogCWlmICgoYWRkaW5nKSAmJiAo
ZC0+cmN2Y291bnQpKQogCQlrZnJlZShkLT5yY3Zjb3VudCk7Ci0JaWYgKCEo
ZC0+cmN2Y291bnQgPSBrbWFsbG9jKHNpemVvZihpbnQpICogbSwgR0ZQX0FU
T01JQykpKSB7CisJaWYgKCEoZC0+cmN2Y291bnQgPSBremFsbG9jKHNpemVv
ZihpbnQpICogbSwgR0ZQX0FUT01JQykpKSB7CiAJCXByaW50ayhLRVJOX1dB
Uk5JTkcgInJlZ2lzdGVyX2lzZG46IENvdWxkIG5vdCBhbGxvYyByY3Zjb3Vu
dFxuIik7CiAJCWlmICghYWRkaW5nKQogCQkJa2ZyZWUoZC0+cmN2ZXJyKTsK
IAkJcmV0dXJuIC0xOwogCX0KLQltZW1zZXQoKGNoYXIgKikgZC0+cmN2Y291
bnQsIDAsIHNpemVvZihpbnQpICogbSk7CiAKIAlpZiAoKGFkZGluZykgJiYg
KGQtPnJwcXVldWUpKSB7CiAJCWZvciAoaiA9IDA7IGogPCBkLT5jaGFubmVs
czsgaisrKQpAQCAtMjIyNiwxMSArMjIyNCwxMCBAQCByZWdpc3Rlcl9pc2Ru
KGlzZG5faWYgKiBpKQogCQlwcmludGsoS0VSTl9XQVJOSU5HICJyZWdpc3Rl
cl9pc2RuOiBObyB3cml0ZSByb3V0aW5lIGdpdmVuLlxuIik7CiAJCXJldHVy
biAwOwogCX0KLQlpZiAoIShkID0ga21hbGxvYyhzaXplb2YoaXNkbl9kcml2
ZXJfdCksIEdGUF9LRVJORUwpKSkgeworCWlmICghKGQgPSBremFsbG9jKHNp
emVvZihpc2RuX2RyaXZlcl90KSwgR0ZQX0tFUk5FTCkpKSB7CiAJCXByaW50
ayhLRVJOX1dBUk5JTkcgInJlZ2lzdGVyX2lzZG46IENvdWxkIG5vdCBhbGxv
YyBkcml2ZXItc3RydWN0XG4iKTsKIAkJcmV0dXJuIDA7CiAJfQotCW1lbXNl
dCgoY2hhciAqKSBkLCAwLCBzaXplb2YoaXNkbl9kcml2ZXJfdCkpOwogCiAJ
ZC0+bWF4YnVmc2l6ZSA9IGktPm1heGJ1ZnNpemU7CiAJZC0+cGt0Y291bnQg
PSAwOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJz
L2lzZG4vaTRsL2lzZG5fbmV0LmMgbGludXgtMi42LjE5LXJjNV9remFsbG9j
L2RyaXZlcnMvaXNkbi9pNGwvaXNkbl9uZXQuYwotLS0gbGludXgtMi42LjE5
LXJjNV9vcmlnL2RyaXZlcnMvaXNkbi9pNGwvaXNkbl9uZXQuYwkyMDA2LTEx
LTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5
LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9pNGwvaXNkbl9uZXQuYwkyMDA2
LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMjU0MiwxNyAr
MjU0MiwxNSBAQCBpc2RuX25ldF9uZXcoY2hhciAqbmFtZSwgc3RydWN0IG5l
dF9kZXZpCiAJCXByaW50ayhLRVJOX1dBUk5JTkcgImlzZG5fbmV0OiBpbnRl
cmZhY2UgJXMgYWxyZWFkeSBleGlzdHNcbiIsIG5hbWUpOwogCQlyZXR1cm4g
TlVMTDsKIAl9Ci0JaWYgKCEobmV0ZGV2ID0gKGlzZG5fbmV0X2RldiAqKSBr
bWFsbG9jKHNpemVvZihpc2RuX25ldF9kZXYpLCBHRlBfS0VSTkVMKSkpIHsK
KwlpZiAoIShuZXRkZXYgPSBremFsbG9jKHNpemVvZihpc2RuX25ldF9kZXYp
LCBHRlBfS0VSTkVMKSkpIHsKIAkJcHJpbnRrKEtFUk5fV0FSTklORyAiaXNk
bl9uZXQ6IENvdWxkIG5vdCBhbGxvY2F0ZSBuZXQtZGV2aWNlXG4iKTsKIAkJ
cmV0dXJuIE5VTEw7CiAJfQotCW1lbXNldChuZXRkZXYsIDAsIHNpemVvZihp
c2RuX25ldF9kZXYpKTsKLQlpZiAoIShuZXRkZXYtPmxvY2FsID0gKGlzZG5f
bmV0X2xvY2FsICopIGttYWxsb2Moc2l6ZW9mKGlzZG5fbmV0X2xvY2FsKSwg
R0ZQX0tFUk5FTCkpKSB7CisJaWYgKCEobmV0ZGV2LT5sb2NhbCA9IGt6YWxs
b2Moc2l6ZW9mKGlzZG5fbmV0X2xvY2FsKSwgR0ZQX0tFUk5FTCkpKSB7CiAJ
CXByaW50ayhLRVJOX1dBUk5JTkcgImlzZG5fbmV0OiBDb3VsZCBub3QgYWxs
b2NhdGUgZGV2aWNlIGxvY2Fsc1xuIik7CiAJCWtmcmVlKG5ldGRldik7CiAJ
CXJldHVybiBOVUxMOwogCX0KLQltZW1zZXQobmV0ZGV2LT5sb2NhbCwgMCwg
c2l6ZW9mKGlzZG5fbmV0X2xvY2FsKSk7CiAJaWYgKG5hbWUgPT0gTlVMTCkK
IAkJc3RyY3B5KG5ldGRldi0+bG9jYWwtPm5hbWUsICIgICAgICAgICAiKTsK
IAllbHNlCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2Ru
L2k0bC9pc2RuX3BwcC5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAw
ICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9p
c2RuL2k0bC9pc2RuX3BwcC5jCTIwMDYtMTEtMTUgMjA6MzM6MjMuMDAwMDAw
MDAwICswMjAwCkBAIC04NzYsMTQgKzg3NiwxMiBAQCBpc2RuX3BwcF9pbml0
KHZvaWQpCiAjZW5kaWYgLyogQ09ORklHX0lTRE5fTVBQICovCiAKIAlmb3Ig
KGkgPSAwOyBpIDwgSVNETl9NQVhfQ0hBTk5FTFM7IGkrKykgewotCQlpZiAo
IShpcHBwX3RhYmxlW2ldID0gKHN0cnVjdCBpcHBwX3N0cnVjdCAqKQotCQkg
ICAgICBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgaXBwcF9zdHJ1Y3QpLCBHRlBf
S0VSTkVMKSkpIHsKKwkJaWYgKCEoaXBwcF90YWJsZVtpXSA9IGt6YWxsb2Mo
c2l6ZW9mKHN0cnVjdCBpcHBwX3N0cnVjdCksIEdGUF9LRVJORUwpKSkgewog
CQkJcHJpbnRrKEtFUk5fV0FSTklORyAiaXNkbl9wcHBfaW5pdDogQ291bGQg
bm90IGFsbG9jIGlwcHBfdGFibGVcbiIpOwogCQkJZm9yIChqID0gMDsgaiA8
IGk7IGorKykKIAkJCQlrZnJlZShpcHBwX3RhYmxlW2pdKTsKIAkJCXJldHVy
biAtMTsKIAkJfQotCQltZW1zZXQoKGNoYXIgKikgaXBwcF90YWJsZVtpXSwg
MCwgc2l6ZW9mKHN0cnVjdCBpcHBwX3N0cnVjdCkpOwogCQlzcGluX2xvY2tf
aW5pdCgmaXBwcF90YWJsZVtpXS0+YnVmbG9jayk7CiAJCWlwcHBfdGFibGVb
aV0tPnN0YXRlID0gMDsKIAkJaXBwcF90YWJsZVtpXS0+Zmlyc3QgPSBpcHBw
X3RhYmxlW2ldLT5ycSArIE5VTV9SQ1ZfQlVGRlMgLSAxOwpAQCAtMTUyOSwx
MCArMTUyNyw4IEBAIHN0YXRpYyBpbnQgaXNkbl9wcHBfbXBfYnVuZGxlX2Fy
cmF5X2luaXQKIHsKIAlpbnQgaTsKIAlpbnQgc3ogPSBJU0ROX01BWF9DSEFO
TkVMUypzaXplb2YoaXBwcF9idW5kbGUpOwotCWlmKCAoaXNkbl9wcHBfYnVu
ZGxlX2FyciA9IChpcHBwX2J1bmRsZSopa21hbGxvYyhzeiwgCi0JCQkJCQkJ
R0ZQX0tFUk5FTCkpID09IE5VTEwgKQorCWlmKCAoaXNkbl9wcHBfYnVuZGxl
X2FyciA9IGt6YWxsb2Moc3osIEdGUF9LRVJORUwpKSA9PSBOVUxMICkKIAkJ
cmV0dXJuIC1FTk9NRU07Ci0JbWVtc2V0KGlzZG5fcHBwX2J1bmRsZV9hcnIs
IDAsIHN6KTsKIAlmb3IoIGkgPSAwOyBpIDwgSVNETl9NQVhfQ0hBTk5FTFM7
IGkrKyApCiAJCXNwaW5fbG9ja19pbml0KCZpc2RuX3BwcF9idW5kbGVfYXJy
W2ldLmxvY2spOwogCXJldHVybiAwOwpAQCAtMjI0NiwxMyArMjI0MiwxMiBA
QCBzdGF0aWMgdm9pZCBpc2RuX3BwcF9jY3BfeG1pdF9yZXNldChzdHJ1CiBz
dGF0aWMgc3RydWN0IGlwcHBfY2NwX3Jlc2V0ICppc2RuX3BwcF9jY3BfcmVz
ZXRfYWxsb2Moc3RydWN0IGlwcHBfc3RydWN0ICppcykKIHsKIAlzdHJ1Y3Qg
aXBwcF9jY3BfcmVzZXQgKnI7Ci0JciA9IGttYWxsb2Moc2l6ZW9mKHN0cnVj
dCBpcHBwX2NjcF9yZXNldCksIEdGUF9LRVJORUwpOworCXIgPSBremFsbG9j
KHNpemVvZihzdHJ1Y3QgaXBwcF9jY3BfcmVzZXQpLCBHRlBfS0VSTkVMKTsK
IAlpZighcikgewogCQlwcmludGsoS0VSTl9FUlIgImlwcHBfY2NwOiBmYWls
ZWQgdG8gYWxsb2NhdGUgcmVzZXQgZGF0YSIKIAkJICAgICAgICIgc3RydWN0
dXJlIC0gbm8gbWVtXG4iKTsKIAkJcmV0dXJuIE5VTEw7CiAJfQotCW1lbXNl
dChyLCAwLCBzaXplb2Yoc3RydWN0IGlwcHBfY2NwX3Jlc2V0KSk7CiAJcHJp
bnRrKEtFUk5fREVCVUcgImlwcHBfY2NwOiBhbGxvY2F0ZWQgcmVzZXQgZGF0
YSBzdHJ1Y3R1cmUgJXBcbiIsIHIpOwogCWlzLT5yZXNldCA9IHI7CiAJcmV0
dXJuIHI7CkBAIC0yMzM4LDEwICsyMzMzLDkgQEAgc3RhdGljIHN0cnVjdCBp
cHBwX2NjcF9yZXNldF9zdGF0ZSAqaXNkbgogCQkgICAgICAgaWQpOwogCQly
ZXR1cm4gTlVMTDsKIAl9IGVsc2UgewotCQlycyA9IGttYWxsb2Moc2l6ZW9m
KHN0cnVjdCBpcHBwX2NjcF9yZXNldF9zdGF0ZSksIEdGUF9LRVJORUwpOwor
CQlycyA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBpcHBwX2NjcF9yZXNldF9z
dGF0ZSksIEdGUF9LRVJORUwpOwogCQlpZighcnMpCiAJCQlyZXR1cm4gTlVM
TDsKLQkJbWVtc2V0KHJzLCAwLCBzaXplb2Yoc3RydWN0IGlwcHBfY2NwX3Jl
c2V0X3N0YXRlKSk7CiAJCXJzLT5zdGF0ZSA9IENDUFJlc2V0SWRsZTsKIAkJ
cnMtPmlzID0gaXM7CiAJCXJzLT5pZCA9IGlkOwpkaWZmIC1ydWJwIGxpbnV4
LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaTRsL2lzZG5fdjExMC5j
IGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vaTRsL2lz
ZG5fdjExMC5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9p
c2RuL2k0bC9pc2RuX3YxMTAuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAw
MDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZl
cnMvaXNkbi9pNGwvaXNkbl92MTEwLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4w
MDAwMDAwMDAgKzAyMDAKQEAgLTkyLDkgKzkyLDggQEAgaXNkbl92MTEwX29w
ZW4odW5zaWduZWQgY2hhciBrZXksIGludCBoZAogCWludCBpOwogCWlzZG5f
djExMF9zdHJlYW0gKnY7CiAKLQlpZiAoKHYgPSBrbWFsbG9jKHNpemVvZihp
c2RuX3YxMTBfc3RyZWFtKSwgR0ZQX0FUT01JQykpID09IE5VTEwpCisJaWYg
KCh2ID0ga3phbGxvYyhzaXplb2YoaXNkbl92MTEwX3N0cmVhbSksIEdGUF9B
VE9NSUMpKSA9PSBOVUxMKQogCQlyZXR1cm4gTlVMTDsKLQltZW1zZXQodiwg
MCwgc2l6ZW9mKGlzZG5fdjExMF9zdHJlYW0pKTsKIAl2LT5rZXkgPSBrZXk7
CiAJdi0+bmJpdHMgPSAwOwogCWZvciAoaSA9IDA7IGtleSAmICgxIDw8IGkp
OyBpKyspCmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZl
cnMvaXNkbi9pY24vaWNuLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Ry
aXZlcnMvaXNkbi9pY24vaWNuLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3Jp
Zy9kcml2ZXJzL2lzZG4vaWNuL2ljbi5jCTIwMDYtMTEtMDkgMTI6MTY6MjEu
MDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2Mv
ZHJpdmVycy9pc2RuL2ljbi9pY24uYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAw
MDAwMDAwMCArMDIwMApAQCAtMTUxOSwxMiArMTUxOSwxMSBAQCBpY25faW5p
dGNhcmQoaW50IHBvcnQsIGNoYXIgKmlkKQogCWljbl9jYXJkICpjYXJkOwog
CWludCBpOwogCi0JaWYgKCEoY2FyZCA9IChpY25fY2FyZCAqKSBrbWFsbG9j
KHNpemVvZihpY25fY2FyZCksIEdGUF9LRVJORUwpKSkgeworCWlmICghKGNh
cmQgPSBremFsbG9jKHNpemVvZihpY25fY2FyZCksIEdGUF9LRVJORUwpKSkg
ewogCQlwcmludGsoS0VSTl9XQVJOSU5HCiAJCSAgICAgICAiaWNuOiAoJXMp
IENvdWxkIG5vdCBhbGxvY2F0ZSBjYXJkLXN0cnVjdC5cbiIsIGlkKTsKIAkJ
cmV0dXJuIChpY25fY2FyZCAqKSAwOwogCX0KLQltZW1zZXQoKGNoYXIgKikg
Y2FyZCwgMCwgc2l6ZW9mKGljbl9jYXJkKSk7CiAJc3Bpbl9sb2NrX2luaXQo
JmNhcmQtPmxvY2spOwogCWNhcmQtPnBvcnQgPSBwb3J0OwogCWNhcmQtPmlu
dGVyZmFjZS5vd25lciA9IFRISVNfTU9EVUxFOwpkaWZmIC1ydWJwIGxpbnV4
LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vaXNkbmxvb3AvaXNkbmxv
b3AuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9pc2RuL2lz
ZG5sb29wL2lzZG5sb29wLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9k
cml2ZXJzL2lzZG4vaXNkbmxvb3AvaXNkbmxvb3AuYwkyMDA2LTExLTA5IDEy
OjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2RyaXZlcnMvaXNkbi9pc2RubG9vcC9pc2RubG9vcC5jCTIwMDYt
MTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC0xNDMwLDEyICsx
NDMwLDExIEBAIGlzZG5sb29wX2luaXRjYXJkKGNoYXIgKmlkKQogCWlzZG5s
b29wX2NhcmQgKmNhcmQ7CiAJaW50IGk7CiAKLQlpZiAoIShjYXJkID0gKGlz
ZG5sb29wX2NhcmQgKikga21hbGxvYyhzaXplb2YoaXNkbmxvb3BfY2FyZCks
IEdGUF9LRVJORUwpKSkgeworCWlmICghKGNhcmQgPSBremFsbG9jKHNpemVv
Zihpc2RubG9vcF9jYXJkKSwgR0ZQX0tFUk5FTCkpKSB7CiAJCXByaW50ayhL
RVJOX1dBUk5JTkcKIAkJICJpc2RubG9vcDogKCVzKSBDb3VsZCBub3QgYWxs
b2NhdGUgY2FyZC1zdHJ1Y3QuXG4iLCBpZCk7CiAJCXJldHVybiAoaXNkbmxv
b3BfY2FyZCAqKSAwOwogCX0KLQltZW1zZXQoKGNoYXIgKikgY2FyZCwgMCwg
c2l6ZW9mKGlzZG5sb29wX2NhcmQpKTsKIAljYXJkLT5pbnRlcmZhY2Uub3du
ZXIgPSBUSElTX01PRFVMRTsKIAljYXJkLT5pbnRlcmZhY2UuY2hhbm5lbHMg
PSBJU0ROTE9PUF9CQ0g7CiAJY2FyZC0+aW50ZXJmYWNlLmhsX2hkcmxlbiAg
PSAxOyAvKiBzY3JhdGNoIGFyZWEgZm9yIHN0b3JpbmcgYWNrIGZsYWcqLyAK
ZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2Ru
L3BjYml0L2Rydi5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJz
L2lzZG4vcGNiaXQvZHJ2LmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9k
cml2ZXJzL2lzZG4vcGNiaXQvZHJ2LmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4w
MDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9k
cml2ZXJzL2lzZG4vcGNiaXQvZHJ2LmMJMjAwNi0xMS0xMSAyMjo0NDoxOC4w
MDAwMDAwMDAgKzAyMDAKQEAgLTc1LDE0ICs3NSwxMyBAQCBpbnQgcGNiaXRf
aW5pdF9kZXYoaW50IGJvYXJkLCBpbnQgbWVtX2JhCiAJc3RydWN0IHBjYml0
X2RldiAqZGV2OwogCWlzZG5faWYgKmRldl9pZjsKIAotCWlmICgoZGV2PWtt
YWxsb2Moc2l6ZW9mKHN0cnVjdCBwY2JpdF9kZXYpLCBHRlBfS0VSTkVMKSkg
PT0gTlVMTCkKKwlpZiAoKGRldj1remFsbG9jKHNpemVvZihzdHJ1Y3QgcGNi
aXRfZGV2KSwgR0ZQX0tFUk5FTCkpID09IE5VTEwpCiAJewogCQlwcmludGso
InBjYml0X2luaXQ6IGNvdWxkbid0IG1hbGxvYyBwY2JpdF9kZXYgc3RydWN0
XG4iKTsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCiAJZGV2X3BjYml0W2Jv
YXJkXSA9IGRldjsKLQltZW1zZXQoZGV2LCAwLCBzaXplb2Yoc3RydWN0IHBj
Yml0X2RldikpOwogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmRldi0+c2V0X3J1
bm5pbmdfd3EpOwogCXNwaW5fbG9ja19pbml0KCZkZXYtPmxvY2spOwogCkBA
IC0xMDYsNyArMTA1LDcgQEAgaW50IHBjYml0X2luaXRfZGV2KGludCBib2Fy
ZCwgaW50IG1lbV9iYQogCQlyZXR1cm4gLUVBQ0NFUzsKIAl9CiAKLQlkZXYt
PmIxID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IHBjYml0X2NoYW4pLCBHRlBf
S0VSTkVMKTsKKwlkZXYtPmIxID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHBj
Yml0X2NoYW4pLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWRldi0+YjEpIHsKIAkJ
cHJpbnRrKCJwY2JpdF9pbml0OiBjb3VsZG4ndCBtYWxsb2MgcGNiaXRfY2hh
biBzdHJ1Y3RcbiIpOwogCQlpb3VubWFwKGRldi0+c2hfbWVtKTsKQEAgLTEx
NSw3ICsxMTQsNyBAQCBpbnQgcGNiaXRfaW5pdF9kZXYoaW50IGJvYXJkLCBp
bnQgbWVtX2JhCiAJCXJldHVybiAtRU5PTUVNOwogCX0KICAgICAKLQlkZXYt
PmIyID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IHBjYml0X2NoYW4pLCBHRlBf
S0VSTkVMKTsKKwlkZXYtPmIyID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHBj
Yml0X2NoYW4pLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWRldi0+YjIpIHsKIAkJ
cHJpbnRrKCJwY2JpdF9pbml0OiBjb3VsZG4ndCBtYWxsb2MgcGNiaXRfY2hh
biBzdHJ1Y3RcbiIpOwogCQlrZnJlZShkZXYtPmIxKTsKQEAgLTEyNSw4ICsx
MjQsNiBAQCBpbnQgcGNiaXRfaW5pdF9kZXYoaW50IGJvYXJkLCBpbnQgbWVt
X2JhCiAJCXJldHVybiAtRU5PTUVNOwogCX0KIAotCW1lbXNldChkZXYtPmIx
LCAwLCBzaXplb2Yoc3RydWN0IHBjYml0X2NoYW4pKTsKLQltZW1zZXQoZGV2
LT5iMiwgMCwgc2l6ZW9mKHN0cnVjdCBwY2JpdF9jaGFuKSk7CiAJZGV2LT5i
Mi0+aWQgPSAxOwogCiAJSU5JVF9XT1JLKCZkZXYtPnFkZWxpdmVyeSwgcGNi
aXRfZGVsaXZlciwgZGV2KTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1
X29yaWcvZHJpdmVycy9pc2RuL3BjYml0L2xheWVyMi5jIGxpbnV4LTIuNi4x
OS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vcGNiaXQvbGF5ZXIyLmMKLS0t
IGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vcGNiaXQvbGF5
ZXIyLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysr
IGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vcGNiaXQv
bGF5ZXIyLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAK
QEAgLTM2OSwxMyArMzY5LDEyIEBAIHBjYml0X3JlY2VpdmUoc3RydWN0IHBj
Yml0X2RldiAqZGV2KQogCQkJa2ZyZWUoZGV2LT5yZWFkX2ZyYW1lKTsKIAkJ
CWRldi0+cmVhZF9mcmFtZSA9IE5VTEw7CiAJCX0KLQkJZnJhbWUgPSBrbWFs
bG9jKHNpemVvZihzdHJ1Y3QgZnJhbWVfYnVmKSwgR0ZQX0FUT01JQyk7CisJ
CWZyYW1lID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGZyYW1lX2J1ZiksIEdG
UF9BVE9NSUMpOwogCiAJCWlmIChmcmFtZSA9PSBOVUxMKSB7CiAJCQlwcmlu
dGsoS0VSTl9XQVJOSU5HICJrbWFsbG9jIGZhaWxlZFxuIik7CiAJCQlyZXR1
cm47CiAJCX0KLQkJbWVtc2V0KGZyYW1lLCAwLCBzaXplb2Yoc3RydWN0IGZy
YW1lX2J1ZikpOwogCiAJCWNwdSA9IHBjYml0X3JlYWRiKGRldik7CiAJCXBy
b2MgPSBwY2JpdF9yZWFkYihkZXYpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4x
OS1yYzVfb3JpZy9kcml2ZXJzL2lzZG4vc2MvaW5pdC5jIGxpbnV4LTIuNi4x
OS1yYzVfa3phbGxvYy9kcml2ZXJzL2lzZG4vc2MvaW5pdC5jCi0tLSBsaW51
eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9pc2RuL3NjL2luaXQuYwkyMDA2
LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42
LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvaXNkbi9zYy9pbml0LmMJMjAwNi0x
MS0xMSAyMjo0NDoxOC4wMDAwMDAwMDAgKzAyMDAKQEAgLTI3MSwxNCArMjcx
LDEzIEBAIHN0YXRpYyBpbnQgX19pbml0IHNjX2luaXQodm9pZCkKIAkJICog
SG9ycmF5ISBXZSBmb3VuZCBhIGJvYXJkLCBNYWtlIHN1cmUgd2UgY2FuIHJl
Z2lzdGVyCiAJCSAqIGl0IHdpdGggSVNETjRMaW51eAogCQkgKi8KLQkJaW50
ZXJmYWNlID0ga21hbGxvYyhzaXplb2YoaXNkbl9pZiksIEdGUF9LRVJORUwp
OworCQlpbnRlcmZhY2UgPSBremFsbG9jKHNpemVvZihpc2RuX2lmKSwgR0ZQ
X0tFUk5FTCk7CiAJCWlmIChpbnRlcmZhY2UgPT0gTlVMTCkgewogCQkJLyoK
IAkJCSAqIE9vcHMsIGNhbid0IG1hbGxvYyBpc2RuX2lmCiAJCQkgKi8KIAkJ
CWNvbnRpbnVlOwogCQl9Ci0JCW1lbXNldChpbnRlcmZhY2UsIDAsIHNpemVv
Zihpc2RuX2lmKSk7CiAKIAkJaW50ZXJmYWNlLT5vd25lciA9IFRISVNfTU9E
VUxFOwogCQlpbnRlcmZhY2UtPmhsX2hkcmxlbiA9IDA7CkBAIC0yOTQsNyAr
MjkzLDcgQEAgc3RhdGljIGludCBfX2luaXQgc2NfaW5pdCh2b2lkKQogCQkv
KgogCQkgKiBBbGxvY2F0ZSB0aGUgYm9hcmQgc3RydWN0dXJlCiAJCSAqLwot
CQlzY19hZGFwdGVyW2NpbnN0XSA9IGttYWxsb2Moc2l6ZW9mKGJvYXJkKSwg
R0ZQX0tFUk5FTCk7CisJCXNjX2FkYXB0ZXJbY2luc3RdID0ga3phbGxvYyhz
aXplb2YoYm9hcmQpLCBHRlBfS0VSTkVMKTsKIAkJaWYgKHNjX2FkYXB0ZXJb
Y2luc3RdID09IE5VTEwpIHsKIAkJCS8qCiAJCQkgKiBPb3BzLCBjYW4ndCBh
bGxvYyBtZW1vcnkgZm9yIHRoZSBib2FyZApAQCAtMzAyLDcgKzMwMSw2IEBA
IHN0YXRpYyBpbnQgX19pbml0IHNjX2luaXQodm9pZCkKIAkJCWtmcmVlKGlu
dGVyZmFjZSk7CiAJCQljb250aW51ZTsKIAkJfQotCQltZW1zZXQoc2NfYWRh
cHRlcltjaW5zdF0sIDAsIHNpemVvZihib2FyZCkpOwogCQlzcGluX2xvY2tf
aW5pdCgmc2NfYWRhcHRlcltjaW5zdF0tPmxvY2spOwogCiAJCWlmKCFyZWdp
c3Rlcl9pc2RuKGludGVyZmFjZSkpIHsKQEAgLTMyNiw3ICszMjQsNyBAQCBz
dGF0aWMgaW50IF9faW5pdCBzY19pbml0KHZvaWQpCiAJCS8qCiAJCSAqIEFs
bG9jYXRlIGNoYW5uZWxzIHN0YXR1cyBzdHJ1Y3R1cmVzCiAJCSAqLwotCQlz
Y19hZGFwdGVyW2NpbnN0XS0+Y2hhbm5lbCA9IGttYWxsb2Moc2l6ZW9mKGJj
aGFuKSAqIGNoYW5uZWxzLCBHRlBfS0VSTkVMKTsKKwkJc2NfYWRhcHRlcltj
aW5zdF0tPmNoYW5uZWwgPSBremFsbG9jKHNpemVvZihiY2hhbikgKiBjaGFu
bmVscywgR0ZQX0tFUk5FTCk7CiAJCWlmIChzY19hZGFwdGVyW2NpbnN0XS0+
Y2hhbm5lbCA9PSBOVUxMKSB7CiAJCQkvKgogCQkJICogT29wcywgY2FuJ3Qg
YWxsb2MgbWVtb3J5IGZvciB0aGUgY2hhbm5lbHMKQEAgLTMzNiw3ICszMzQs
NiBAQCBzdGF0aWMgaW50IF9faW5pdCBzY19pbml0KHZvaWQpCiAJCQlrZnJl
ZShzY19hZGFwdGVyW2NpbnN0XSk7CiAJCQljb250aW51ZTsKIAkJfQotCQlt
ZW1zZXQoc2NfYWRhcHRlcltjaW5zdF0tPmNoYW5uZWwsIDAsIHNpemVvZihi
Y2hhbikgKiBjaGFubmVscyk7CiAKIAkJLyoKIAkJICogTG9jayBkb3duIHRo
ZSBoYXJkd2FyZSByZXNvdXJjZXMK


------=_NextPart_000_6cac_2861_6584--
