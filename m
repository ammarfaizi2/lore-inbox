Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S132372AbREHMWc>; Tue, 8 May 2001 08:22:32 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S132359AbREHMWW>; Tue, 8 May 2001 08:22:22 -0400
Received: from m539-mp1-cvx1c.col.ntl.com ([213.104.78.27]:5504 "EHLO
	[213.104.78.27]") by vger.kernel.org with ESMTP id <S132352AbREHMWM>;
	Tue, 8 May 2001 08:22:12 -0400
To: "Grover, Andrew" <andrew.grover@intel.com>
Cc: <linux-kernel@vger.kernel.org>, <linux-pm-devel@sourceforge.net>
Subject: Re: simple userspace pm interface
In-Reply-To: <4148FEAAD879D311AC5700A0C969E89006CDDE25@orsmsx35.jf.intel.com>
From: John Fremlin <chief@bandits.org>
Date: 08 May 2001 13:21:30 +0100
In-Reply-To: <4148FEAAD879D311AC5700A0C969E89006CDDE25@orsmsx35.jf.intel.com>
Message-ID: <m23dagyqt1.fsf@boreas.yi.org.>
User-Agent: Gnus/5.0808 (Gnus v5.8.8) XEmacs/21.1 (GTK)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

"Grover, Andrew" <andrew.grover@intel.com> writes:

[...]

> - It's probably easier to put the "event" file in proc, instead of
> dev. This is what the acpi interface does, and eliminates the mknod
> step.

Is this kernel policy? I mean, you could apply the same argument to
all device nodes ;-)

> - perhaps rename boxevent() to event() or sys_event()?

Event is a bit generic, and sys_event is vague. I agree that boxevent
is not a pretty name, but it gives a vague suggestion of
hardwareness. hwevent looks ugly - what do people think?

> - Consider putting the subsystem/class identifier first
> - Consider hiding the source of the event. For example, we shouldn't care
> that the power button press was generated by APM or MIPS64, because we're
> going to take the same action, regardless.

The suggested action is given as the first word. The second word is
the subsystem, in order to avoid namespace collisions: you could have
two different PM systems active on your machine at different times,
(e.g. ACPI and APM) and this lets you distinguish between them. You
could think of it as the first word being the suggested action and the
rest being a description.

> I'd encourage you to take a look at the ACPI code that does
> something similar (in 2.4.4ac4 or greater, or grab the code from the
> website at
> http://developer.intel.com/technology/iapc/acpi/downloads.htm .)
> Specifically, grep -r for bm_osl_generate_event(). Modifying that
> code to be more general-purpose could possibly meet ACPI's needs as
> well as everyone else's.

ACPI_STATUS bm_osl_generate_event (
       BM_HANDLE               device_handle,
       char                    *device_type,
       char                    *device_instance,
       u32                     event_type,
       u32                     event_data)
{

The function could quickly be converted to boxevent without thinking

sprintf(buffer,"device %s instance %s says %x: %x",
        device_type,device_instance,event_type,event_data);
boxevent(BOXEVENT_NOTIFY,"ACPI",buffer);

this would provide all of the current functionality available from
ACPI (ATM the code does sprintf(str, "%s %s %08x %08x\n") to the
userspace reader) but boxevent also handles poll, short reads, and
event floods, etc.

Some one who knows about ACPI could change the BOXEVENT_NOTIFY to a
better suggestion based on event_type or something.

[...]

-- 

	http://ape.n3.net
