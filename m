Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S266967AbTBCXdh>; Mon, 3 Feb 2003 18:33:37 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S266989AbTBCXdh>; Mon, 3 Feb 2003 18:33:37 -0500
Received: from serenity.mcc.ac.uk ([130.88.200.93]:39948 "EHLO
	serenity.mcc.ac.uk") by vger.kernel.org with ESMTP
	id <S266967AbTBCXdf>; Mon, 3 Feb 2003 18:33:35 -0500
Date: Mon, 3 Feb 2003 23:43:07 +0000
From: John Levon <levon@movementarian.org>
To: Pavel Machek <pavel@suse.cz>
Cc: linux-kernel@vger.kernel.org
Subject: Re: Switch APIC to driver model (and make S3 sleep with APIC on)
Message-ID: <20030203234307.GA18528@compsoc.man.ac.uk>
References: <200301280121.CAA13798@harpo.it.uu.se> <20030202124235.GA133@elf.ucw.cz> <20030203103254.GA25619@compsoc.man.ac.uk> <20030203154008.GC480@elf.ucw.cz> <20030203202029.GA99614@compsoc.man.ac.uk> <20030203211858.GA3173@elf.ucw.cz>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030203211858.GA3173@elf.ucw.cz>
User-Agent: Mutt/1.3.25i
X-Url: http://www.movementarian.org/
X-Record: Mr. Scruff - Trouser Jazz
X-Scanner: exiscan for exim4 (http://duncanthrax.net/exiscan/) *18fqF2-000DEK-00*BJW9LTANfK6*
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, Feb 03, 2003 at 10:18:58PM +0100, Pavel Machek wrote:

> Unfortunately my systems seems to miss bfd.h, required by libutil++.

The debian package is apparently called binutils-dev

> > I haven't seen where you added these checks. They did not exist before:
> > oprofile took responsibility for the NMI/perfctr handling off the NMI
> > watchdog entirely, then handed it back when oprofile finished.
> 
> Ouch, I did not see that code. It seems not to be in nmi_int.c; where
> is that?

oprofile saves the perfctr config when it starts in nmi_int.c, then
calls the set_nmi_pm_callback. Then the suspend/resume calls oprofile's,
and we assume we have unique access to controlling the generated NMIs
(ie it becomes oprofile's job to ensure no NMIs are generated by the
perfctrs whilst suspended).

It's pretty ugly, so a correct cleanup would be appreciated.

I suppose this is quite an unusual case for the PM model ?

regards
john
