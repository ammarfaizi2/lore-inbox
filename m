Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S267456AbTAGRN4>; Tue, 7 Jan 2003 12:13:56 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S267455AbTAGRN4>; Tue, 7 Jan 2003 12:13:56 -0500
Received: from bi01p1.co.us.ibm.com ([32.97.110.142]:58636 "EHLO w-patman.des")
	by vger.kernel.org with ESMTP id <S267453AbTAGRNx>;
	Tue, 7 Jan 2003 12:13:53 -0500
Date: Tue, 7 Jan 2003 10:02:09 -0800
From: Patrick Mansfield <patmans@us.ibm.com>
To: Andries.Brouwer@cwi.nl
Cc: linux-kernel@vger.kernel.org, linux-scsi@vger.kernel.org,
       linux-usb-devel@lists.sourceforge.net, mdharm-kernel@one-eyed-alien.net,
       zwane@holomorphy.com
Subject: Re: IDs
Message-ID: <20030107100209.A15291@beaverton.ibm.com>
References: <UTC200301071055.h07At0T09202.aeb@smtp.cwi.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <UTC200301071055.h07At0T09202.aeb@smtp.cwi.nl>; from Andries.Brouwer@cwi.nl on Tue, Jan 07, 2003 at 11:55:00AM +0100
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Tue, Jan 07, 2003 at 11:55:00AM +0100, Andries.Brouwer@cwi.nl wrote:

> > But, we don't have to truncate, we should just allocate as many bytes as
> > we need, and store the information.
> 
> > And, the sysfs name should not store the id.

> 
> OK. It seems that we are in total agreement.
> Time for the next question.
> 
> An id is constructed, that in many cases identifies something.
> How do you plan to use this? Is it already in use somewhere?

It's not in use in the main-line kernel.

I forgot to mention that I'm using the id in scsi mid-level multi-path
code, it has the same problem (the id is not always unique, plus other
major issues to deal with).

I'm not working on any device naming/persistence code, although I have
given thought to solutions. Any solution there might apply to multi-path
usage. But the multi-path cannot easily be moved to user space until we
have complete user level scsi scanning.

Is anyone currently writing device name solutions based on the scsi id?

> The sysfs tree does not contain device nodes.
> Do you plan a user space utility that figures out that
> the ID "SHP      CD-Writer+ 8200 [" belongs to /dev/hdd
> which also is /dev/sr0?

With the current code, any utility would be scsi specific (it could only
name scsi devices based on an id, others would get a default name), so it
would only cover /dev/sr0. I don't know much about IDE capabilities.

> The id is not suitable as a user space name. Moreover,
> it is a heuristic only, and user space needs unambiguous names.

If we had a complete white/black list of devices with/without a unique id,
there would be no ambiguity. Such a list could be generated by asking the
user/administrator each time an unknown device is added to the system (or
have a safe default); we could also have a white/black somewhere (for use
from user space), much like we have with scsi_static_device_list in
scsi_scan.c today.

A user level white/black list is also useful for scanning, especially for
user level scanning, and for kernel scanning if we can access it before
starting the scan (via ramdisk at boot time).

> What user space names do you want to use?

Maybe have a configurable starting point (like /devnames, maybe
something that does not collide with /dev, perhaps we can generate a
/dev matching exactly what we have today), much like a mount point, or
like devfs. I don't know of any good reasons for a file system.

In any case, right now we should fix the scsi sysfs name, and add (and not
truncate) a uid to scsi_device.

-- Patrick Mansfield
