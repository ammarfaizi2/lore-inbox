Return-Path: <linux-kernel-owner+willy=40w.ods.org-S266708AbUGVVE0@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266708AbUGVVE0 (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 22 Jul 2004 17:04:26 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S267278AbUGVVE0
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 22 Jul 2004 17:04:26 -0400
Received: from cfcafwp.sgi.com ([192.48.179.6]:19619 "EHLO
	omx1.americas.sgi.com") by vger.kernel.org with ESMTP
	id S266708AbUGVVDq (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 22 Jul 2004 17:03:46 -0400
Date: Thu, 22 Jul 2004 16:03:34 -0500
From: Erik Jacobson <erikj@subway.americas.sgi.com>
To: linux-kernel@vger.kernel.org
cc: akpm@osdl.org
Subject: [PATCH] (update) Process Aggregates (PAGG) for 2.6.7
Message-ID: <Pine.SGI.4.53.0407221557260.474995@subway.americas.sgi.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-2136806248-436526230-1090530214=:474995"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---2136806248-436526230-1090530214=:474995
Content-Type: TEXT/PLAIN; charset=US-ASCII

Attached is the PAGG patch for kernel 2.6.7.  Some may recall I posted an
earlier PAGG patch for 2.6.7.  This version has improved handling for
the init function pointer functionality introduced earlier.

We'd be very interested in seeing this be accepted in to the kernel.  If
there is anything we should adjust to make it more likely to be accepted,
please reply.  Thanks.

Signed-off-by: Erik Jacobson <erikj@sgi.com>

--
Erik Jacobson - Linux System Software - Silicon Graphics - Eagan, Minnesota
---2136806248-436526230-1090530214=:474995
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=pagg
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.SGI.4.53.0407221603340.474995@subway.americas.sgi.com>
Content-Description: 
Content-Disposition: attachment; filename=pagg

SW5kZXg6IGxpbnV4L0RvY3VtZW50YXRpb24vcGFnZy50eHQNCj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0NCi0tLSAvZGV2L251bGwNCisrKyBsaW51eC9Eb2N1
bWVudGF0aW9uL3BhZ2cudHh0DQpAQCAtMCwwICsxLDMyIEBADQorTGludXgg
UHJvY2VzcyBBZ2dyZWdhdGVzIChQQUdHKQ0KKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0NCisNCitUaGUgcHJvY2VzcyBhZ2dyZWdhdGVzIGlu
ZnJhc3RydWN0dXJlLCBvciBQQUdHLCBwcm92aWRlcyBhIGdlbmVyYWxpemVk
DQorbWVjaGFuaXNtIGZvciBwcm92aWRpbmcgYXJiaXRyYXJ5IHByb2Nlc3Mg
Z3JvdXBzIGluIExpbnV4LiAgUEFHRyBjb25zaXN0cw0KK29mIGEgc2VyaWVz
IG9mIGZ1bmN0aW9ucyBmb3IgcmVnaXN0ZXJpbmcgYW5kIHVucmVnaXN0ZXJp
bmcgc3VwcG9ydA0KK2ZvciBuZXcgdHlwZXMgb2YgcHJvY2VzcyBhZ2dyZWdh
dGlvbiBjb250YWluZXJzIHdpdGggdGhlIGtlcm5lbC4NCitUaGlzIGlzIHNp
bWlsYXIgdG8gdGhlIHN1cHBvcnQgY3VycmVudGx5IHByb3ZpZGVkIHdpdGhp
biBMaW51eCB0aGF0DQorYWxsb3dzIGZvciBkeW5hbWljIHN1cHBvcnQgb2Yg
ZmlsZXN5c3RlbXMsIGJsb2NrIGFuZCBjaGFyYWN0ZXIgZGV2aWNlcywNCitz
eW1ib2wgdGFibGVzLCBuZXR3b3JrIGRldmljZXMsIHNlcmlhbCBkZXZpY2Vz
LCBhbmQgZXhlY3V0aW9uIGRvbWFpbnMuDQorVGhpcyBpbXBsZW1lbnRhdGlv
biBvZiBQQUdHIHByb3ZpZGVzIGRldmVsb3BlcnMgdGhlIGJhc2ljIGhvb2tz
IG5lY2Vzc2FyeQ0KK3RvIGltcGxlbWVudCBrZXJuZWwgbW9kdWxlcyBmb3Ig
c3BlY2lmaWMgcHJvY2VzcyBjb250YWluZXJzLCBzdWNoIGFzDQordGhlIGpv
YiBjb250YWluZXIuDQorDQorVGhlIGRvX2ZvcmsgZnVuY3Rpb24gaW4gdGhl
IGtlcm5lbCB3YXMgYWx0ZXJlZCB0byBzdXBwb3J0IFBBR0cuICBJZiBhDQor
cHJvY2VzcyBpcyBhdHRhY2hlZCB0byBhbnkgUEFHRyBjb250YWluZXJzIGFu
ZCBzdWJzZXF1ZW50bHkgZm9ya3MgYQ0KK2NoaWxkIHByb2Nlc3MsIHRoZSBj
aGlsZCBwcm9jZXNzIHdpbGwgYWxzbyBiZSBhdHRhY2hlZCB0byB0aGUgc2Ft
ZSBQQUdHDQorY29udGFpbmVycy4gIFRoZSBQQUdHIGNvbnRhaW5lcnMgaW52
b2x2ZWQgZHVyaW5nIHRoZSBmb3JrIGFyZSBub3RpZmllZA0KK3RoYXQgYSBu
ZXcgcHJvY2VzcyBoYXMgYmVlbiBhdHRhY2hlZC4gIFRoZSBub3RpZmljYXRp
b24gaXMgYWNjb21wbGlzaGVkDQordmlhIGEgY2FsbGJhY2sgZnVuY3Rpb24g
cHJvdmlkZWQgYnkgdGhlIFBBR0cgbW9kdWxlLg0KKw0KK1RoZSBkb19leGl0
IGZ1bmN0aW9uIGluIHRoZSBrZXJuZWwgaGFzIGFsc28gYmVlbiBhbHRlcmVk
LiAgSWYgYSBwcm9jZXNzDQoraXMgYXR0YWNoZWQgdG8gYW55IFBBR0cgY29u
dGFpbmVycyBhbmQgdGhhdCBwcm9jZXNzIGlzIGV4aXRpbmcsIHRoZSBQQUdH
DQorY29udGFpbmVycyBhcmUgbm90aWZpZWQgdGhhdCBhIHByb2Nlc3MgaGFz
IGRldGFjaGVkIGZyb20gdGhlIGNvbnRhaW5lci4NCitUaGUgbm90aWZpY2F0
aW9uIGlzIGFjY29tcGxpc2hlZCB2aWEgYSBjYWxsYmFjayBmdW5jdGlvbiBw
cm92aWRlZCBieQ0KK3RoZSBQQUdHIG1vZHVsZS4NCisNCitUaGUgc3lzX2V4
ZWN2ZSBmdW5jdGlvbiBoYXMgYmVlbiBtb2RpZmllZCB0byBzdXBwb3J0IGFu
IG9wdGlvbmFsIGNhbGxvdXQNCit0aGF0IGNhbiBiZSBydW4gd2hlbiBhIHBy
b2Nlc3MgaW4gYSBwYWdnIGxpc3QgZG9lcyBhbiBleGVjLiAgSXQgY2FuIGJl
IA0KK3VzZWQsIGZvciBleGFtcGxlLCBieSBvdGhlciBrZXJuZWwgbW9kdWxl
cyB0aGF0IHdpc2ggdG8gZG8gYWR2YW5jZWQgQ1BVDQorcGxhY2VtZW50IG9u
IG11bHRpLXByb2Nlc3NvciBzeXN0ZW1zIChqdXN0IG9uZSBleGFtcGxlKS4N
CisNCkluZGV4OiBsaW51eC9mcy9leGVjLmMNCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0NCi0tLSBsaW51eC5vcmlnL2ZzL2V4ZWMuYw0KKysrIGxpbnV4L2Zz
L2V4ZWMuYw0KQEAgLTQ2LDYgKzQ2LDcgQEANCiAjaW5jbHVkZSA8bGludXgv
c2VjdXJpdHkuaD4NCiAjaW5jbHVkZSA8bGludXgvc3lzY2FsbHMuaD4NCiAj
aW5jbHVkZSA8bGludXgvcm1hcC5oPg0KKyNpbmNsdWRlIDxsaW51eC9wYWdn
Lmg+DQogDQogI2luY2x1ZGUgPGFzbS91YWNjZXNzLmg+DQogI2luY2x1ZGUg
PGFzbS9wZ2FsbG9jLmg+DQpAQCAtMTEzMyw2ICsxMTM0LDcgQEANCiAJcmV0
dmFsID0gc2VhcmNoX2JpbmFyeV9oYW5kbGVyKCZicHJtLHJlZ3MpOw0KIAlp
ZiAocmV0dmFsID49IDApIHsNCiAJCWZyZWVfYXJnX3BhZ2VzKCZicHJtKTsN
CisJCXBhZ2dfZXhlYyhjdXJyZW50KTsNCiANCiAJCS8qIGV4ZWN2ZSBzdWNj
ZXNzICovDQogCQlzZWN1cml0eV9icHJtX2ZyZWUoJmJwcm0pOw0KSW5kZXg6
IGxpbnV4L2luY2x1ZGUvbGludXgvaW5pdF90YXNrLmgNCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0NCi0tLSBsaW51eC5vcmlnL2luY2x1ZGUvbGludXgvaW5p
dF90YXNrLmgNCisrKyBsaW51eC9pbmNsdWRlL2xpbnV4L2luaXRfdGFzay5o
DQpAQCAtMiw2ICsyLDcgQEANCiAjZGVmaW5lIF9MSU5VWF9fSU5JVF9UQVNL
X0gNCiANCiAjaW5jbHVkZSA8bGludXgvZmlsZS5oPg0KKyNpbmNsdWRlIDxs
aW51eC9wYWdnLmg+DQogDQogI2RlZmluZSBJTklUX0ZJTEVTIFwNCiB7IAkJ
CQkJCQlcDQpAQCAtMTEyLDYgKzExMyw3IEBADQogCS5wcm9jX2xvY2sJPSBT
UElOX0xPQ0tfVU5MT0NLRUQsCQkJCVwNCiAJLnN3aXRjaF9sb2NrCT0gU1BJ
Tl9MT0NLX1VOTE9DS0VELAkJCQlcDQogCS5qb3VybmFsX2luZm8JPSBOVUxM
LAkJCQkJCVwNCisJSU5JVF9UQVNLX1BBR0codHNrKQkJCQkJCVwNCiB9DQog
DQogDQpJbmRleDogbGludXgvaW5jbHVkZS9saW51eC9wYWdnLmgNCj09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0NCi0tLSAvZGV2L251bGwNCisrKyBsaW51eC9p
bmNsdWRlL2xpbnV4L3BhZ2cuaA0KQEAgLTAsMCArMSwyMDIgQEANCisvKiAN
CisgKiBQQUdHIChQcm9jZXNzIEFnZ3JlZ2F0ZXMpIGludGVyZmFjZQ0KKyAq
DQorICogDQorICogQ29weXJpZ2h0IChjKSAyMDAwLTIwMDIsIDIwMDQgU2ls
aWNvbiBHcmFwaGljcywgSW5jLiAgQWxsIFJpZ2h0cyBSZXNlcnZlZC4NCisg
Kg0KKyAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2Fu
IHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQorICogaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBh
cyBwdWJsaXNoZWQgYnkNCisgKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0
aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcg0KKyAq
IChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQorICoNCisg
KiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhh
dCBpdCB3aWxsIGJlIHVzZWZ1bCwNCisgKiBidXQgV0lUSE9VVCBBTlkgV0FS
UkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0K
KyAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VM
QVIgUFVSUE9TRS4gIFNlZSB0aGUNCisgKiBHTlUgR2VuZXJhbCBQdWJsaWMg
TGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KKyAqDQorICogWW91IHNob3Vs
ZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVi
bGljIExpY2Vuc2UNCisgKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYg
bm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KKyAqIEZvdW5kYXRp
b24sIEluYy4sIDU5IFRlbXBsZSBQbGFjZSwgU3VpdGUgMzMwLCBCb3N0b24s
IE1BIDAyMTExLTEzMDcgVVNBDQorICoNCisgKg0KKyAqIENvbnRhY3QgaW5m
b3JtYXRpb246ICBTaWxpY29uIEdyYXBoaWNzLCBJbmMuLCAxNTAwIENyaXR0
ZW5kZW4gTGFuZSwNCisgKiBNb3VudGFpbiBWaWV3LCBDQSAgOTQwNDMsIG9y
Og0KKyAqIA0KKyAqIGh0dHA6Ly93d3cuc2dpLmNvbSANCisgKiANCisgKiBG
b3IgZnVydGhlciBpbmZvcm1hdGlvbiByZWdhcmRpbmcgdGhpcyBub3RpY2Us
IHNlZTogDQorICogDQorICogaHR0cDovL29zcy5zZ2kuY29tL3Byb2plY3Rz
L0dlbkluZm8vTm90aWNlRXhwbGFuDQorICovDQorDQorLyoNCisgKiBEYXRh
IHN0cnVjdHVyZSBkZWZpbml0aW9ucyBhbmQgZnVuY3Rpb24gcHJvdG90eXBl
cyB1c2VkIHRvIGltcGxlbWVudA0KKyAqIHByb2Nlc3MgYWdncmVnYXRlcyAo
cGFnZ3MpLg0KKyAqDQorICogUGFnZ3MgcHJvdmlkZXMgYSBnZW5lcmFsaXpl
ZCB3YXkgdG8gaW1wbGVtZW50IHByb2Nlc3MgZ3JvdXBpbmdzIG9yDQorICog
Y29udGFpbmVycy4gIE1vZHVsZXMgdXNlIHRoZXNlIGZ1bmN0aW9ucyB0byBy
ZWdpc3RlciB3aXRoIHRoZSBrZXJuZWwgYXMNCisgKiBwcm92aWRlcnMgb2Yg
cHJvY2VzcyBhZ2dyZWdhdGlvbiBjb250YWluZXJzLiBUaGUgcGFnZyBkYXRh
IHN0cnVjdHVyZXMNCisgKiBkZWZpbmUgdGhlIGNhbGxiYWNrIGZ1bmN0aW9u
cyBhbmQgZGF0YSBhY2Nlc3MgcG9pbnRlcnMgYmFjayBpbnRvIHRoZQ0KKyAq
IHBhZ2cgbW9kdWxlcy4NCisgKi8NCisNCisjaWZuZGVmIF9MSU5VWF9QQUdH
X0gNCisjZGVmaW5lIF9MSU5VWF9QQUdHX0gNCisNCisjaW5jbHVkZSA8bGlu
dXgvc2NoZWQuaD4NCisNCisjaWZkZWYgQ09ORklHX1BBR0cNCisNCisjZGVm
aW5lIFBBR0dfTkFNRUxOCTMyCQkvKiBNYXggY2hhcnMgaW4gUEFHRyBtb2R1
bGUgbmFtZSAqLw0KKw0KKw0KKy8qKg0KKyAqIElOSVRfUEFHR19MSVNUIC0g
dXNlZCB0byBpbml0aWFsaXplIGEgcGFnZ19saXN0IHN0cnVjdHVyZSBhZnRl
ciBkZWNsYXJhdGlvbiANCisgKiBAX2w6IFRhc2sgc3RydWN0IHRvIGluaXQg
dGhlIHBhZ2dfbGlzdCBhbmQgc2VtYXBob3JlIGluDQorICogDQorICovDQor
I2RlZmluZSBJTklUX1BBR0dfTElTVChfbCkJCQkJCQlcDQorZG8gewkJCQkJ
CQkJCVwNCisJSU5JVF9MSVNUX0hFQUQoJihfbCktPnBhZ2dfbGlzdCk7CQkJ
CQlcDQorCWluaXRfcndzZW0oJihfbCktPnBhZ2dfc2VtKTsJCQkJCQlcDQor
fSB3aGlsZSgwKQ0KKwkNCisNCisvKg0KKyAqIFVzZWQgYnkgdGFza19zdHJ1
Y3QgdG8gbWFuYWdlIGxpc3Qgb2YgcGFnZyBhdHRhY2htZW50cyBmb3IgdGhl
IHByb2Nlc3MuICANCisgKiBFYWNoIHBhZ2cgcHJvdmlkZXMgdGhlIGxpbmsg
YmV0d2VlbiB0aGUgcHJvY2VzcyBhbmQgdGhlIA0KKyAqIGNvcnJlY3QgcGFn
ZyBjb250YWluZXIuDQorICoNCisgKiBTVFJVQ1QgTUVNQkVSUzoNCisgKiAg
ICAgaG9vazoJUmVmZXJlbmNlIHRvIHBhZ2cgbW9kdWxlIHN0cnVjdHVyZS4g
IFRoYXQgc3RydWN0DQorICogICAgIAkJaG9sZHMgdGhlIG5hbWUga2V5IGFu
ZCBmdW5jdGlvbiBwb2ludGVycy4NCisgKiAgICAgZGF0YToJT3BhcXVlIGRh
dGEgcG9pbnRlciAtIGRlZmluZWQgYnkgcGFnZyBtb2R1bGVzLg0KKyAqICAg
ICBlbnRyeToJTGlzdCBwb2ludGVycw0KKyAqLw0KK3N0cnVjdCBwYWdnIHsN
CisgICAgICAgc3RydWN0IHBhZ2dfaG9vawkqaG9vazsNCisgICAgICAgdm9p
ZAkJKmRhdGE7DQorICAgICAgIHN0cnVjdCBsaXN0X2hlYWQJZW50cnk7DQor
fTsNCisNCisvKg0KKyAqIFVzZWQgYnkgcGFnZyBtb2R1bGVzIHRvIGRlZmlu
ZSB0aGUgY2FsbGJhY2sgZnVuY3Rpb25zIGludG8gdGhlIA0KKyAqIG1vZHVs
ZS4NCisgKg0KKyAqIFNUUlVDVCBNRU1CRVJTOg0KKyAqICAgICBuYW1lOiAg
ICAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHBhZ2cgY29udGFpbmVyIHR5cGUg
cHJvdmlkZWQgYnkNCisgKiAgICAgICAgICAgICAgICAgICAgIHRoZSBtb2R1
bGUuIFRoaXMgd2lsbCBiZSBzZXQgYnkgdGhlIHBhZ2cgbW9kdWxlLg0KKyAq
ICAgICBhdHRhY2g6ICAgICAgICAgRnVuY3Rpb24gcG9pbnRlciB0byBmdW5j
dGlvbiB1c2VkIHdoZW4gYXR0YWNoaW5nDQorICogICAgICAgICAgICAgICAg
ICAgICBhIHByb2Nlc3MgdG8gdGhlIHBhZ2cgY29udGFpbmVyIHJlZmVyZW5j
ZWQgYnkgDQorICogICAgICAgICAgICAgICAgICAgICB0aGlzIHN0cnVjdC4N
CisgKiAgICAgZGV0YWNoOiAgICAgICAgIEZ1bmN0aW9uIHBvaW50ZXIgdG8g
ZnVuY3Rpb24gdXNlZCB3aGVuIGRldGFjaGluZw0KKyAqICAgICAgICAgICAg
ICAgICAgICAgYSBwcm9jZXNzIHRvIHRoZSBwYWdnIGNvbnRhaW5lciByZWZl
cmVuY2VkIGJ5IA0KKyAqICAgICAgICAgICAgICAgICAgICAgdGhpcyBzdHJ1
Y3QuDQorICogICAgIGluaXQ6ICAgICAgICAgICBGdW5jdGlvbiBwb2ludGVy
IHRvIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uLiAgVGhpcw0KKyAqICAgICAg
ICAgICAgICAgICAgICAgZnVuY3Rpb24gaXMgdXNlZCB3aGVuIHRoZSBtb2R1
bGUgaXMgbG9hZGVkIHRvIGF0dGFjaA0KKyAqICAgICAgICAgICAgICAgICAg
ICAgZXhpc3RpbmcgcHJvY2Vzc2VzIHRvIGEgZGVmYXVsdCBjb250YWluZXIg
YXMgZGVmaW5lZCBieQ0KKyAqICAgICAgICAgICAgICAgICAgICAgdGhlIHBh
Z2cgbW9kdWxlLiBUaGlzIGlzIG9wdGlvbmFsIGFuZCBtYXkgYmUgc2V0IHRv
IA0KKyAqICAgICAgICAgICAgICAgICAgICAgTlVMTCBpZiBpdCBpcyBub3Qg
bmVlZGVkIGJ5IHRoZSBwYWdnIG1vZHVsZS4NCisgKiAgICAgZGF0YTogICAg
ICAgICAgIE9wYXF1ZSBkYXRhIHBvaW50ZXIgLSBkZWZpbmVkIGJ5IHBhZ2cg
bW9kdWxlcy4NCisgKiAgICAgbW9kdWxlOiAgICAgICAgIFBvaW50ZXIgdG8g
a2VybmVsIG1vZHVsZSBzdHJ1Y3QuICBVc2VkIHRvIGluY3JlbWVudCAmIA0K
KyAqICAgICAgICAgICAgICAgICAgICAgZGVjcmVtZW50IHRoZSB1c2UgY291
bnQgZm9yIHRoZSBtb2R1bGUuDQorICogICAgIGVudHJ5OgkgICAgICAgTGlz
dCBwb2ludGVycw0KKyAqICAgICBleGVjOiAgICAgICAgICAgRnVuY3Rpb24g
cG9pbnRlciB0byBmdW5jdGlvbiB1c2VkIHdoZW4gYSBwcm9jZXNzDQorICog
ICAgICAgICAgICAgICAgICAgICBpbiB0aGUgcGFnZyBjb250YWluZXIgZXhl
YydzIGEgbmV3IHByb2Nlc3MuIFRoaXMNCisgKiAgICAgICAgICAgICAgICAg
ICAgIGlzIG9wdGlvbmFsIGFuZCBtYXkgYmUgc2V0IHRvIE5VTEwgaWYgaXQg
aXMgbm90IA0KKyAqICAgICAgICAgICAgICAgICAgICAgbmVlZGVkIGJ5IHRo
ZSBwYWdnIG1vZHVsZS4NCisgKiAgICAgcmVmY250OiAgICAgICAgIEtlZXAg
dHJhY2sgb2YgdXNlciBjb3VudCBvZiB0aGUgcGFnZyBob29rDQorICovDQor
c3RydWN0IHBhZ2dfaG9vayB7DQorICAgICAgIHN0cnVjdCBtb2R1bGUJKm1v
ZHVsZTsNCisgICAgICAgY2hhcgkJKm5hbWU7CS8qIE5hbWUgS2V5IC0gcmVz
dHJpY3RlZCB0byAzMiBjaGFyYWN0ZXJzICovDQorICAgICAgIHZvaWQJCSpk
YXRhOwkvKiBPcGFxdWUgbW9kdWxlIHNwZWNpZmljIGRhdGEgKi8NCisgICAg
ICAgc3RydWN0IGxpc3RfaGVhZAllbnRyeTsJLyogTGlzdCBwb2ludGVycyAq
Lw0KKwkJIGF0b21pY190IHJlZmNudDsgLyogdXNhZ2UgY291bnRlciAqLw0K
KyAgICAgICBpbnQJCSgqaW5pdCkoc3RydWN0IHRhc2tfc3RydWN0ICosIHN0
cnVjdCBwYWdnICopOw0KKyAgICAgICBpbnQJCSgqYXR0YWNoKShzdHJ1Y3Qg
dGFza19zdHJ1Y3QgKiwgc3RydWN0IHBhZ2cgKiwgdm9pZCopOw0KKyAgICAg
ICB2b2lkCQkoKmRldGFjaCkoc3RydWN0IHRhc2tfc3RydWN0ICosIHN0cnVj
dCBwYWdnICopOw0KKyAgICAgICB2b2lkCQkoKmV4ZWMpKHN0cnVjdCB0YXNr
X3N0cnVjdCAqLCBzdHJ1Y3QgcGFnZyAqKTsNCit9Ow0KKw0KKw0KKy8qIEtl
cm5lbCBzZXJ2aWNlIGZ1bmN0aW9ucyBmb3IgcHJvdmlkaW5nIFBBR0cgc3Vw
cG9ydCAqLw0KK2V4dGVybiBzdHJ1Y3QgcGFnZyAqcGFnZ19nZXQoc3RydWN0
IHRhc2tfc3RydWN0ICp0YXNrLCBjaGFyICprZXkpOw0KK2V4dGVybiBzdHJ1
Y3QgcGFnZyAqcGFnZ19hbGxvYyhzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2ss
IA0KKwkJCSAgICAgICBzdHJ1Y3QgcGFnZ19ob29rICpwdCk7DQorZXh0ZXJu
IHZvaWQgcGFnZ19mcmVlKHN0cnVjdCBwYWdnICpwYWdnKTsNCitleHRlcm4g
aW50IHBhZ2dfaG9va19yZWdpc3RlcihzdHJ1Y3QgcGFnZ19ob29rICpwdF9u
ZXcpOw0KK2V4dGVybiBpbnQgcGFnZ19ob29rX3VucmVnaXN0ZXIoc3RydWN0
IHBhZ2dfaG9vayAqcHRfb2xkKTsNCitleHRlcm4gdm9pZCBfX3BhZ2dfYXR0
YWNoKHN0cnVjdCB0YXNrX3N0cnVjdCAqdG9fdGFzaywgDQorCQkJIHN0cnVj
dCB0YXNrX3N0cnVjdCAqZnJvbV90YXNrKTsNCitleHRlcm4gdm9pZCBfX3Bh
Z2dfZGV0YWNoKHN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzayk7DQorZXh0ZXJu
IGludCBfX3BhZ2dfZXhlYyhzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2spOw0K
Kw0KKy8qKg0KKyAqIHBhZ2dfYXR0YWNoIC0gY2hpbGQgaW5oZXJpdHMgYXR0
YWNobWVudCB0byBwYWdnIGNvbnRhaW5lcnMgb2YgaXRzIHBhcmVudA0KKyAq
IEBjaGlsZDogY2hpbGQgdGFzayAtIHRvIGluaGVyaXQNCisgKiBAcGFyZW50
OiBwYXJlbmV0IHRhc2sgLSBjaGlsZCBpbmhlcml0cyBwYWdnIGNvbnRhaW5l
cnMgZnJvbSB0aGlzIHBhcmVudA0KKyAqIA0KKyAqIGZ1bmN0aW9uIHVzZWQg
d2hlbiBhIGNoaWxkIHByb2Nlc3MgbXVzdCBpbmhlcml0IGF0dGFjaG1lbnQg
dG8gcGFnZw0KKyAqIGNvbnRhaW5lcnMgZnJvbSB0aGUgcGFyZW50Lg0KKyAq
DQorICovDQorc3RhdGljIGlubGluZSB2b2lkIHBhZ2dfYXR0YWNoKHN0cnVj
dCB0YXNrX3N0cnVjdCAqY2hpbGQsIA0KKwkJCSAgICAgIHN0cnVjdCB0YXNr
X3N0cnVjdCAqcGFyZW50KQ0KK3sNCisJSU5JVF9QQUdHX0xJU1QoY2hpbGQp
Ow0KKwlpZiAoIWxpc3RfZW1wdHkoJnBhcmVudC0+cGFnZ19saXN0KSkNCisJ
CV9fcGFnZ19hdHRhY2goY2hpbGQsIHBhcmVudCk7DQorCXJldHVybjsNCit9
DQorDQorDQorLyoqDQorICogcGFnZ19kZXRhY2ggLSBEZXRhY2ggYSBwcm9j
ZXNzIGZyb20gYSBwYWdnIGNvbnRhaW5lciBpdCBpcyBhIG1lbWJlciBvZg0K
KyAqIEB0YXNrOiBUaGUgdGFzayB0aGUgcGFnZyB3aWxsIGJlIGRldGFjaGVk
IGZyb20NCisgKg0KKyAqLw0KK3N0YXRpYyBpbmxpbmUgdm9pZCBwYWdnX2Rl
dGFjaChzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2spDQorew0KKwlpZiAoIWxp
c3RfZW1wdHkoJnRhc2stPnBhZ2dfbGlzdCkpDQorCQlfX3BhZ2dfZGV0YWNo
KHRhc2spOw0KK30NCisNCisvKioNCisgKiBwYWdnX2V4ZWMgLSBVc2VkIHdo
ZW4gYSBwcm9jZXNzIGV4ZWMncw0KKyAqIEB0YXNrOiBUaGUgcHJvY2VzcyBk
b2luZyB0aGUgZXhlYw0KKyAqDQorICovDQorc3RhdGljIGlubGluZSB2b2lk
IHBhZ2dfZXhlYyhzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2spDQorew0KKwlp
ZiAoIWxpc3RfZW1wdHkoJnRhc2stPnBhZ2dfbGlzdCkpDQorCQlfX3BhZ2df
ZXhlYyh0YXNrKTsNCit9DQorDQorLyoqIA0KKyAqIElOSVRfVEFTS19QQUdH
IC0gVXNlZCBpbiBJTklUX1RBU0sgdG8gc2V0IHRoZSBoZWFkIGFuZCBzZW0g
b2YgcGFnZ19saXN0DQorICogQHRzazogVGhlIHRhc2sgd29yayB3aXRoDQor
ICoNCisgKiBNYXJjbyBVc2VkIGluIElOSVRfVEFTSyB0byBzZXQgdGhlIGhl
YWQgYW5kIHNlbSBvZiBwYWdnX2xpc3QuDQorICogSWYgQ09ORklHX1BBR0cg
aXMgb2ZmLCBpdCBpcyBkZWZpbmVkIGFzIGFuIGVtcHR5IG1hY3JvIGJlbG93
Lg0KKyAqDQorICovDQorI2RlZmluZSBJTklUX1RBU0tfUEFHRyh0c2spIFwN
CisJLnBhZ2dfbGlzdCA9IExJU1RfSEVBRF9JTklUKHRzay5wYWdnX2xpc3Qp
LCAgICAgXA0KKwkucGFnZ19zZW0gID0gX19SV1NFTV9JTklUSUFMSVpFUih0
c2sucGFnZ19zZW0pICANCisNCisjZWxzZSAgLyogQ09ORklHX1BBR0cgKi8N
CisNCisvKiANCisgKiBSZXBsYWNlbWVudCBtYWNyb3MgdXNlZCB3aGVuIFBB
R0cgKFByb2Nlc3MgQWdncmVnYXRlcykgc3VwcG9ydCBpcyBub3QNCisgKiBj
b21waWxlZCBpbnRvIHRoZSBrZXJuZWwuDQorICovDQorI2RlZmluZSBJTklU
X1RBU0tfUEFHRyh0c2spDQorI2RlZmluZSBJTklUX1BBR0dfTElTVChsKSBk
byB7IH0gd2hpbGUoMCkNCisjZGVmaW5lIHBhZ2dfYXR0YWNoKGN0LCBwdCkg
IGRvIHsgfSB3aGlsZSgwKQ0KKyNkZWZpbmUgcGFnZ19kZXRhY2godCkgIGRv
IHsgIH0gd2hpbGUoMCkgICAgIA0KKyNkZWZpbmUgcGFnZ19leGVjKHQpICBk
byB7ICB9IHdoaWxlKDApICAgICANCisNCisjZW5kaWYgLyogQ09ORklHX1BB
R0cgKi8NCisNCisjZW5kaWYgLyogX0xJTlVYX1BBR0dfSCAqLw0KSW5kZXg6
IGxpbnV4L2luY2x1ZGUvbGludXgvc2NoZWQuaA0KPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PQ0KLS0tIGxpbnV4Lm9yaWcvaW5jbHVkZS9saW51eC9zY2hlZC5o
DQorKysgbGludXgvaW5jbHVkZS9saW51eC9zY2hlZC5oDQpAQCAtNTEzLDYg
KzUxMywxMyBAQA0KICAgCXN0cnVjdCBtZW1wb2xpY3kgKm1lbXBvbGljeTsN
CiAgIAlzaG9ydCBpbF9uZXh0OwkJLyogY291bGQgYmUgc2hhcmVkIHdpdGgg
dXNlZF9tYXRoICovDQogI2VuZGlmDQorDQorI2lmZGVmIENPTkZJR19QQUdH
DQorLyogTGlzdCBvZiBwYWdnIChwcm9jZXNzIGFnZ3JlZ2F0ZSkgYXR0YWNo
bWVudHMgKi8NCisJc3RydWN0IGxpc3RfaGVhZCBwYWdnX2xpc3Q7DQorCXN0
cnVjdCByd19zZW1hcGhvcmUgcGFnZ19zZW07DQorI2VuZGlmDQorDQogfTsN
CiANCiBzdGF0aWMgaW5saW5lIHBpZF90IHByb2Nlc3NfZ3JvdXAoc3RydWN0
IHRhc2tfc3RydWN0ICp0c2spDQpJbmRleDogbGludXgvaW5pdC9LY29uZmln
DQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gbGludXgub3JpZy9pbml0
L0tjb25maWcNCisrKyBsaW51eC9pbml0L0tjb25maWcNCkBAIC0xMjEsNiAr
MTIxLDE0IEBADQogCSAgdXAgdG8gdGhlIHVzZXIgbGV2ZWwgcHJvZ3JhbSB0
byBkbyB1c2VmdWwgdGhpbmdzIHdpdGggdGhpcw0KIAkgIGluZm9ybWF0aW9u
LiAgVGhpcyBpcyBnZW5lcmFsbHkgYSBnb29kIGlkZWEsIHNvIHNheSBZLg0K
IA0KK2NvbmZpZyBQQUdHDQorCWJvb2wgIlN1cHBvcnQgZm9yIHByb2Nlc3Mg
YWdncmVnYXRlcyAoUEFHR3MpIg0KKwloZWxwDQorICAgICBTYXkgWSBoZXJl
IGlmIHlvdSB3aWxsIGJlIGxvYWRpbmcgbW9kdWxlcyB3aGljaCBwcm92aWRl
IHN1cHBvcnQNCisgICAgIGZvciBwcm9jZXNzIGFnZ3JlZ2F0ZSBjb250YWlu
ZXJzLiAgRXhhbXBsZXMgb2Ygc3VjaCBtb2R1bGVzIGluY2x1ZGUgdGhlDQor
ICAgICBMaW51eCBKb2JzIG1vZHVsZSBhbmQgdGhlIExpbnV4IEFycmF5IFNl
c3Npb25zIG1vZHVsZS4gIElmIHlvdSB3aWxsIG5vdCANCisgICAgIGJlIHVz
aW5nIHN1Y2ggbW9kdWxlcywgc2F5IE4uDQorDQogY29uZmlnIFNZU0NUTA0K
IAlib29sICJTeXNjdGwgc3VwcG9ydCINCiAJLS0taGVscC0tLQ0KSW5kZXg6
IGxpbnV4L2tlcm5lbC9NYWtlZmlsZQ0KPT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PQ0KLS0tIGxpbnV4Lm9yaWcva2VybmVsL01ha2VmaWxlDQorKysgbGludXgv
a2VybmVsL01ha2VmaWxlDQpAQCAtMTgsNiArMTgsNyBAQA0KIG9iai0kKENP
TkZJR19QTSkgKz0gcG93ZXIvDQogb2JqLSQoQ09ORklHX0JTRF9QUk9DRVNT
X0FDQ1QpICs9IGFjY3Qubw0KIG9iai0kKENPTkZJR19DT01QQVQpICs9IGNv
bXBhdC5vDQorb2JqLSQoQ09ORklHX1BBR0cpICs9IHBhZ2cubw0KIG9iai0k
KENPTkZJR19JS0NPTkZJRykgKz0gY29uZmlncy5vDQogb2JqLSQoQ09ORklH
X0lLQ09ORklHX1BST0MpICs9IGNvbmZpZ3Mubw0KIG9iai0kKENPTkZJR19T
VE9QX01BQ0hJTkUpICs9IHN0b3BfbWFjaGluZS5vDQpJbmRleDogbGludXgv
a2VybmVsL2ZvcmsuYw0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGxp
bnV4Lm9yaWcva2VybmVsL2ZvcmsuYw0KKysrIGxpbnV4L2tlcm5lbC9mb3Jr
LmMNCkBAIC0zNiw2ICszNiw3IEBADQogI2luY2x1ZGUgPGxpbnV4L21vdW50
Lmg+DQogI2luY2x1ZGUgPGxpbnV4L2F1ZGl0Lmg+DQogI2luY2x1ZGUgPGxp
bnV4L3JtYXAuaD4NCisjaW5jbHVkZSA8bGludXgvcGFnZy5oPg0KIA0KICNp
bmNsdWRlIDxhc20vcGd0YWJsZS5oPg0KICNpbmNsdWRlIDxhc20vcGdhbGxv
Yy5oPg0KQEAgLTg3LDYgKzg4LDggQEANCiAJV0FSTl9PTihhdG9taWNfcmVh
ZCgmdHNrLT51c2FnZSkpOw0KIAlXQVJOX09OKHRzayA9PSBjdXJyZW50KTsN
CiANCisJcGFnZ19kZXRhY2godHNrKTsNCisNCiAJaWYgKHVubGlrZWx5KHRz
ay0+YXVkaXRfY29udGV4dCkpDQogCQlhdWRpdF9mcmVlKHRzayk7DQogCXNl
Y3VyaXR5X3Rhc2tfZnJlZSh0c2spOw0KQEAgLTIzNiw2ICsyMzksOSBAQA0K
IA0KIAlpbml0X3Rhc2sucmxpbVtSTElNSVRfTlBST0NdLnJsaW1fY3VyID0g
bWF4X3RocmVhZHMvMjsNCiAJaW5pdF90YXNrLnJsaW1bUkxJTUlUX05QUk9D
XS5ybGltX21heCA9IG1heF90aHJlYWRzLzI7DQorDQorCS8qIEluaXRpYWxp
emUgdGhlIHBhZ2cgbGlzdCBpbiBwaWQgMCBiZWZvcmUgaXQgY2FuIGNsb25l
IGl0c2VsZi4gKi8NCisJSU5JVF9QQUdHX0xJU1QoY3VycmVudCk7DQogfQ0K
IA0KIHN0YXRpYyBzdHJ1Y3QgdGFza19zdHJ1Y3QgKmR1cF90YXNrX3N0cnVj
dChzdHJ1Y3QgdGFza19zdHJ1Y3QgKm9yaWcpDQpAQCAtMTAyMyw2ICsxMDI5
LDEyIEBADQogCXNjaGVkX2ZvcmsocCk7DQogDQogCS8qDQorCSAqIGNhbGwg
cGFnZyBtb2R1bGVzIHRvIHByb3Blcmx5IGF0dGFjaCBuZXcgcHJvY2VzcyB0
byB0aGUgc2FtZQ0KKwkgKiBwcm9jZXNzIGFnZ3JlZ2F0ZSBjb250YWluZXJz
IGFzIHRoZSBwYXJlbnQgcHJvY2Vzcy4NCisJICovDQorCXBhZ2dfYXR0YWNo
KHAsIGN1cnJlbnQpOw0KKw0KKwkvKg0KIAkgKiBPaywgbWFrZSBpdCB2aXNp
YmxlIHRvIHRoZSByZXN0IG9mIHRoZSBzeXN0ZW0uDQogCSAqIFdlIGRvbnQg
d2FrZSBpdCB1cCB5ZXQuDQogCSAqLw0KSW5kZXg6IGxpbnV4L2tlcm5lbC9w
YWdnLmMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSAvZGV2L251bGwN
CisrKyBsaW51eC9rZXJuZWwvcGFnZy5jDQpAQCAtMCwwICsxLDQ3NyBAQA0K
Ky8qIA0KKyAqIFBBR0cgKFByb2Nlc3MgQWdncmVnYXRlcykgaW50ZXJmYWNl
DQorICoNCisgKiANCisgKiBDb3B5cmlnaHQgKGMpIDIwMDAtMjAwNCBTaWxp
Y29uIEdyYXBoaWNzLCBJbmMuICBBbGwgUmlnaHRzIFJlc2VydmVkLg0KKyAq
DQorICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4g
cmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCisgKiBpdCB1bmRlciB0
aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFz
IHB1Ymxpc2hlZCBieQ0KKyAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRp
b247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yDQorICog
KGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCisgKg0KKyAq
IFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0
IGl0IHdpbGwgYmUgdXNlZnVsLA0KKyAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJS
QU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQor
ICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxB
UiBQVVJQT1NFLiAgU2VlIHRoZQ0KKyAqIEdOVSBHZW5lcmFsIFB1YmxpYyBM
aWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQorICoNCisgKiBZb3Ugc2hvdWxk
IGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJs
aWMgTGljZW5zZQ0KKyAqIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtOyBpZiBu
b3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlDQorICogRm91bmRhdGlv
biwgSW5jLiwgNTkgVGVtcGxlIFBsYWNlLCBTdWl0ZSAzMzAsIEJvc3Rvbiwg
TUEgMDIxMTEtMTMwNyBVU0ENCisgKg0KKyAqIENvbnRhY3QgaW5mb3JtYXRp
b246ICBTaWxpY29uIEdyYXBoaWNzLCBJbmMuLCAxNTAwIENyaXR0ZW5kZW4g
TGFuZSwNCisgKiBNb3VudGFpbiBWaWV3LCBDQSAgOTQwNDMsIG9yOg0KKyAq
IA0KKyAqIGh0dHA6Ly93d3cuc2dpLmNvbSANCisgKi8NCisNCisjaW5jbHVk
ZSA8bGludXgvY29uZmlnLmg+DQorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4N
CisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4NCisjaW5jbHVkZSA8bGludXgv
bW9kdWxlLmg+DQorI2luY2x1ZGUgPGxpbnV4L3BhZ2cuaD4NCisjaW5jbHVk
ZSA8YXNtL3NlbWFwaG9yZS5oPg0KKw0KKy8qIGxpc3Qgb2YgcGFnZyBob29r
IGVudHJpZXMgdGhhdCByZWZlcmVuY2UgdGhlICJtb2R1bGUiIGltcGxlbWVu
dGF0aW9ucyAqLw0KK3N0YXRpYyBMSVNUX0hFQUQocGFnZ19ob29rX2xpc3Qp
Ow0KK3N0YXRpYyBERUNMQVJFX1JXU0VNKHBhZ2dfaG9va19saXN0X3NlbSk7
DQorDQorDQorLyoqDQorICogcGFnZ19nZXQgLSBnZXQgYSBwYWdnIGdpdmVu
IGEgc2VhcmNoIGtleQ0KKyAqIEB0YXNrOiBXZSBleGFtaW5lIHRoZSBwYWdn
X2xpc3QgZnJvbSB0aGUgZ2l2ZW4gdGFzaw0KKyAqIEBrZXk6IEtleSBuYW1l
IG9mIHBhZ2cgd2Ugd2lzaCB0byByZXRyaWV2ZQ0KKyAqDQorICogR2l2ZW4g
YSBwYWdnX2xpc3QgbGlzdCBzdHJ1Y3R1cmUsIHRoaXMgZnVuY3Rpb24gd2ls
bCByZXR1cm4NCisgKiBhIHBvaW50ZXIgdG8gdGhlIHBhZ2cgc3RydWN0IHRo
YXQgbWF0Y2hlcyB0aGUgc2VhcmNoDQorICoga2V5LiAgSWYgdGhlIGtleSBp
cyBub3QgZm91bmQsIHRoZSBmdW5jdGlvbiB3aWxsIHJldHVybiBOVUxMLg0K
KyAqDQorICogVGhlIGNhbGxlciBzaG91bGQgaG9sZCBhdCBsZWFzdCBhIHJl
YWQgbG9jayBvbiB0aGUgcGFnZ19saXN0DQorICogZm9yIHRhc2sgdXNpbmcg
ZG93bl9yZWFkKCZ0YXNrLT5wYWdnX2xpc3Quc2VtKS4NCisgKg0KKyAqLw0K
K3N0cnVjdCBwYWdnICoNCitwYWdnX2dldChzdHJ1Y3QgdGFza19zdHJ1Y3Qg
KnRhc2ssIGNoYXIgKmtleSkNCit7DQorCXN0cnVjdCBwYWdnICpwYWdnOw0K
Kw0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBhZ2csICZ0YXNrLT5wYWdnX2xp
c3QsIGVudHJ5KSB7DQorCQlpZiAoIXN0cmNtcChwYWdnLT5ob29rLT5uYW1l
LGtleSkpDQorCQkJcmV0dXJuIHBhZ2c7DQorCX0NCisJcmV0dXJuIE5VTEw7
DQorfQ0KKw0KKw0KKy8qKg0KKyAqIHBhZ2dfYWxsb2MgLSBJbnNlcnQgYSBu
ZXcgcGFnZyBpbiB0byB0aGUgcGFnZ19saXN0IGZvciBhIHRhc2sNCisgKiBA
dGFzazogVGFzayB3ZSB3YW50IHRvIGluc2VydCB0aGUgcGFnZyBpbiB0bw0K
KyAqIEBwYWdnX2hvb2s6IFBhZ2cgaG9vayB0byBhc3NvY2lhdGUgd2l0aCB0
aGUgbmV3IHBhZ2cNCisgKg0KKyAqIEdpdmVuIGEgdGFzayBhbmQgYSBwYWdn
IGhvb2ssIHRoaXMgZnVuY3Rpb24gd2lsbCBhbGxvY2F0ZQ0KKyAqIGEgbmV3
IHBhZ2cgc3RydWN0dXJlLCBpbml0aWFsaXplIHRoZSBzZXR0aW5ncywgYW5k
IGluc2VydCB0aGUgcGFnZyBpbnRvDQorICogdGhlIHBhZ2dfbGlzdCBmb3Ig
dGhlIHRhc2suDQorICoNCisgKiBUaGUgY2FsbGVyIGZvciB0aGlzIGZ1bmN0
aW9uIHNob3VsZCBob2xkIGF0IGxlYXN0IGEgcmVhZCBsb2NrIG9uIHRoZQ0K
KyAqIHBhZ2dfaG9va19saXN0X3NlbSAtIG9yIGVuc3VyZSB0aGF0IHRoZSBw
YWdnIGhvb2sgZW50cnkgY2Fubm90IGJlIA0KKyAqIHJlbW92ZWQuIElmIHRo
aXMgZnVuY3Rpb24gd2FzIGNhbGxlZCBmcm9tIHRoZSBwYWdnIG1vZHVsZSAo
dXN1YWxseSB0aGUNCisgKiBjYXNlKSwgdGhlbiB0aGUgY2FsbGVyIG5lZWQg
bm90IGhvbGQgdGhpcyBsb2NrLiBUaGUgY2FsbGVyIHNob3VsZCBob2xkIA0K
KyAqIGEgd3JpdGUgbG9jayBvbiBmb3IgdGhlIHRhc2tzIHBhZ2dfc2VtLiAg
VGhpcyBjYW4gYmUgbG9ja2VkIHVzaW5nIA0KKyAqIGRvd25fd3JpdGUoJnRh
c2stPnBhZ2dfc2VtKQ0KKyAqIA0KKyAqLw0KK3N0cnVjdCBwYWdnICoNCitw
YWdnX2FsbG9jKHN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzaywgc3RydWN0IHBh
Z2dfaG9vayAqcGFnZ19ob29rKQ0KK3sNCisJc3RydWN0IHBhZ2cgKnBhZ2c7
DQorDQorCXBhZ2cgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgcGFnZyksIEdG
UF9LRVJORUwpOw0KKwlpZiAoIXBhZ2cpDQorCQlyZXR1cm4gTlVMTDsNCisN
CisJcGFnZy0+aG9vayA9IHBhZ2dfaG9vazsNCisJcGFnZy0+ZGF0YSA9IE5V
TEw7DQorCWF0b21pY19pbmMoJnBhZ2dfaG9vay0+cmVmY250KTsgIC8qIElu
Y3JlYXNlIGhvb2sncyByZWZlcmVuY2UgY291bnQgKi8NCisJbGlzdF9hZGRf
dGFpbCgmcGFnZy0+ZW50cnksICZ0YXNrLT5wYWdnX2xpc3QpOw0KKwlyZXR1
cm4gcGFnZzsNCit9DQorDQorDQorLyoqDQorICogcGFnZ19mcmVlIC0gRGVs
ZXRlIHBhZ2cgZnJvbSB0aGUgbGlzdCBhbmQgZnJlZSBpdHMgbWVtb3J5DQor
ICogQHBhZ2c6IFRoZSBwYWdnIHRvIGZyZWUNCisgKg0KKyAqIFRoaXMgZnVu
Y3Rpb24gd2lsbCBlbnN1cmUgdGhlIHBhZ2cgaXMgZGVsZXRlZCBmb3JtIA0K
KyAqIHRoZSBsaXN0IG9mIHBhZ2cgZW50cmllcyBmb3IgdGhlIHRhc2suIEZp
bmFsbHksIHRoZSBtZW1vcnkgZm9yIHRoZSANCisgKiBwYWdnIGlzIGRpc2Nh
cmRlZC4NCisgKg0KKyAqIFRoZSBjYWxsZXIgb2YgdGhpcyBmdW5jdGlvbiBz
aG91bGQgaG9sZCBhIHdyaXRlIGxvY2sgb24gdGhlIHBhZ2dfc2VtDQorICog
Zm9yIHRoZSB0YXNrLiBUaGlzIGNhbiBiZSBsb2NrZWQgdXNpbmcgZG93bl93
cml0ZSgmdGFzay0+cGFnZ19zZW0pLg0KKyAqDQorICogUHJpb3IgdG8gY2Fs
bGluZyBwYWdnX2ZyZWUsIHRoZSBwYWdnIHNob3VsZCBoYXZlIGJlZW4gZGV0
YWNoZWQgZnJvbSB0aGUNCisgKiBwYWdnIGNvbnRhaW5lciByZXByZXNlbnRl
ZCBieSB0aGlzIHBhZ2cuICBUaGF0IGlzIHVzdWFsbHkgZG9uZSB1c2luZw0K
KyAqIHAtPmhvb2stPmRldGFjaCh0YXNrLCBwYWdnKTsNCisgKiANCisgKi8N
Cit2b2lkDQorcGFnZ19mcmVlKHN0cnVjdCBwYWdnICpwYWdnKSANCit7DQor
CWF0b21pY19kZWMoJnBhZ2ctPmhvb2stPnJlZmNudCk7IC8qIGRlY3IgdGhl
IHJlZmVyZW5jZSBjb3VudCBvbiB0aGUgaG9vayAqLw0KKwlsaXN0X2RlbCgm
cGFnZy0+ZW50cnkpOw0KKwlrZnJlZShwYWdnKTsNCit9DQorDQorDQorLyoq
DQorICogZ2V0X3BhZ2dfaG9vayAtIEdldCB0aGUgcGFnZyBob29rIG1hdGNo
aW5nIHRoZSByZXF1ZXN0ZWQgbmFtZQ0KKyAqIEBrZXk6IFRoZSBuYW1lIG9m
IHRoZSBwYWdnIGhvb2sgdG8gZ2V0DQorICoNCisgKiBHaXZlbiBhIHBhZ2cg
aG9vayBuYW1lIGtleSwgdGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiBhIHBv
aW50ZXINCisgKiB0byB0aGUgcGFnZ19ob29rIHN0cnVjdCB0aGF0IG1hdGNo
ZXMgdGhlIG5hbWUuDQorICogDQorICogWW91IHNob3VsZCBob2xkIGVpdGhl
ciB0aGUgd3JpdGUgb3IgcmVhZCBsb2NrIGZvciBwYWdnX2hvb2tfbGlzdF9z
ZW0NCisgKiBiZWZvcmUgdXNpbmcgdGhpcyBmdW5jdGlvbi4gIFRoaXMgd2ls
bCBlbnN1cmUgdGhhdCB0aGUgcGFnZ19ob29rX2xpc3QNCisgKiBkb2VzIG5v
dCBjaGFuZ2Ugd2hpbGUgaXRlcmF0aW5nIHRocm91Z2ggdGhlIGxpc3QgZW50
cmllcy4NCisgKg0KKyAqLw0KK3N0YXRpYyBzdHJ1Y3QgcGFnZ19ob29rICoN
CitnZXRfcGFnZ19ob29rKGNoYXIgKmtleSkNCit7DQorCXN0cnVjdCBwYWdn
X2hvb2sgKnBhZ2dfaG9vazsNCisNCisJbGlzdF9mb3JfZWFjaF9lbnRyeShw
YWdnX2hvb2ssICZwYWdnX2hvb2tfbGlzdCwgZW50cnkpIHsNCisJCWlmICgh
c3RyY21wKHBhZ2dfaG9vay0+bmFtZSwga2V5KSkgew0KKwkJCXJldHVybiBw
YWdnX2hvb2s7DQorCQl9DQorCX0NCisJcmV0dXJuIE5VTEw7DQorfQ0KKw0K
Ky8qKg0KKyAqIHJlbW92ZV9jbGllbnRfcGFnZ3NfZnJvbV9hbGxfdGFza3Mg
LSBSZW1vdmUgYWxsIHBhZ2dzIGFzc29jaWF0ZWQgd2l0aCBob29rDQorICog
QHBocDogUGFnZyBob29rIGFzc29jaWF0ZWQgd2l0aCBwYWdncyB0byBwdXJn
ZQ0KKyAqIA0KKyAqIEdpdmVuIGEgcGFnZyBob29rLCB0aGlzIGZ1bmN0aW9u
IHdpbGwgcmVtb3ZlIGFsbCBwYWdncyBhc3NvY2lhdGVkIHdpdGggdGhhdCAN
CisgKiBwYWdnIGhvb2sgZnJvbSBhbGwgdGFza3MgY2FsbGluZyB0aGUgcHJv
dmlkZWQgZnVuY3Rpb24gb24gZWFjaCBwYWdnLg0KKyAqIA0KKyAqIElmIHRo
ZXJlIGlzIGEgZGV0YWNoIGZ1bmN0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUg
cGFnZywgaXQgaXMgY2FsbGVkDQorICogYmVmb3JlIHRoZSBwYWdnIGlzIGZy
ZWVkLg0KKyAqDQorICogVGhpcyBpcyBtZWFudCB0byBiZSB1c2VkIGJ5IHBh
Z2dfaG9va19yZWdpc3RlciBhbmQgcGFnZ19ob29rX3VucmVnaXN0ZXINCisg
Kg0KKyAqLw0KK3N0YXRpYyB2b2lkDQorcmVtb3ZlX2NsaWVudF9wYWdnc19m
cm9tX2FsbF90YXNrcyhzdHJ1Y3QgcGFnZ19ob29rICpwaHApDQorew0KKwlp
ZiAocGhwID09IE5VTEwpDQorCQlyZXR1cm47DQorDQorCS8qIEJlY2F1c2Ug
b2YgaW50ZXJuYWwgcmFjZSBjb25kaXRpb25zIHdlIGNhbid0IGdhdXJhbnRl
ZQ0KKwkgKiBnZXR0aW5nIGV2ZXJ5IHRhc2sgaW4ganVzdCBvbmUgcGFzcyBz
byB3ZSBqdXN0IGtlZXAgZ29pbmcNCisJICogdW50aWwgdGhlcmUgYXJlIG5v
IHRhc2tzIHdpdGggcGFnZ3MgZnJvbSB0aGlzIGhvb2sgYXR0YWNoZWQuDQor
CSAqIFRoZSBpbmVmZmljaWVuY3kgb2YgdGhpcyBzaG91bGQgYmUgdGVtcGVy
ZWQgYnkgdGhlIGZhY3QgdGhhdCB0aGlzDQorCSAqIGhhcHBlbnMgYXQgbW9z
dCBvbmNlIGZvciBlYWNoIHJlZ2lzdGVyZWQgY2xpZW50Lg0KKwkgKi8NCisJ
d2hpbGUgKGF0b21pY19yZWFkKCZwaHAtPnJlZmNudCkgIT0gMCkgew0KKwkJ
c3RydWN0IHRhc2tfc3RydWN0ICpwID0gTlVMTDsNCisNCisJCXJlYWRfbG9j
aygmdGFza2xpc3RfbG9jayk7DQorCQlmb3JfZWFjaF9wcm9jZXNzKHApIHsN
CisJCQlzdHJ1Y3QgcGFnZyAqcGFnZ3A7DQorDQorCQkJZ2V0X3Rhc2tfc3Ry
dWN0KHApOw0KKwkJCXJlYWRfdW5sb2NrKCZ0YXNrbGlzdF9sb2NrKTsNCisJ
CQlkb3duX3dyaXRlKCZwLT5wYWdnX3NlbSk7DQorCQkJcGFnZ3AgPSBwYWdn
X2dldChwLCBwaHAtPm5hbWUpOw0KKwkJCWlmIChwYWdncCAhPSBOVUxMKSB7
DQorCQkJCSh2b2lkKXBocC0+ZGV0YWNoKHAsIHBhZ2dwKTsNCisJCQkJcGFn
Z19mcmVlKHBhZ2dwKTsNCisJCQl9DQorCQkJdXBfd3JpdGUoJnAtPnBhZ2df
c2VtKTsNCisJCQlyZWFkX2xvY2soJnRhc2tsaXN0X2xvY2spOw0KKw0KKwkJ
CS8qIElmIGEgUEFHRyBnb3QgcmVtb3ZlZCBmcm9tIHRoZSBsaXN0IHdoaWxl
IHdlJ3JlIGdvaW5nIHRocm91Z2gNCisJCQkgKiBlYWNoIHByb2Nlc3MsIHRo
ZSB0YXNrcyBsaXN0IGZvciB0aGUgcHJvY2VzcyB3b3VsZCBiZSBlbXB0eS4g
IEluDQorCQkJICogdGhhdCBjYXNlLCBicmVhayBvdXQgb2YgdGhpcyBmb3Jf
ZWFjaF9wcm9jZXNzIHNvIHdlIGNhbiBkbyBpdA0KKwkJCSAqIGFnYWluLiAq
Lw0KKwkJCWlmIChsaXN0X2VtcHR5KCZwLT50YXNrcykpIHsNCisJCQkJcHV0
X3Rhc2tfc3RydWN0KHApOw0KKwkJCQlicmVhazsNCisJCQl9IGVsc2UNCisJ
CQkJcHV0X3Rhc2tfc3RydWN0KHApOw0KKw0KKwkJfQ0KKwkJcmVhZF91bmxv
Y2soJnRhc2tsaXN0X2xvY2spOw0KKwl9DQorfQ0KKw0KKy8qKg0KKyAqIHBh
Z2dfaG9va19yZWdpc3RlciAtIFJlZ2lzdGVyIGEgbmV3IHBhZ2cgaG9vayBh
bmQgZW50ZXIgaXQgdGhlIGxpc3QNCisgKiBAcGFnZ19ob29rX25ldzogVGhl
IG5ldyBwYWdnIGhvb2sgdG8gcmVnaXN0ZXINCisgKg0KKyAqIFVzZWQgdG8g
cmVnaXN0ZXIgYSBuZXcgcGFnZyBob29rIGFuZCBlbnRlciBpdCBpbnRvIHRo
ZSBwYWdnX2hvb2tfbGlzdC4NCisgKiBUaGUgc2VydmljZSBuYW1lIGZvciBh
IHBhZ2cgaG9vayBpcyByZXN0cmljdGVkIHRvIDMyIGNoYXJhY3RlcnMuDQor
ICoNCisgKiBJZiBhbiAiaW5pdCgpIiBmdW5jdGlvbiBpcyBzdXBwbGllZCBp
biB0aGUgaG9vayBiZWluZyByZWdpc3RlcmVkIHRoZW4gYQ0KKyAqIHBhZ2cg
d2lsbCBiZSBhdHRhY2hlZCB0byBhbGwgZXhpc3RpbmcgdGFza3MgYW5kIHRo
ZSBzdXBwbGllZCAiaW5pdCgpIg0KKyAqIGZ1bmN0aW9uIHdpbGwgYmUgYXBw
bGllZCB0byBpdC4gIElmIGFueSBjYWxsIHRvIHRoZSBzdXBwbGllZCAiaW5p
dCgpIg0KKyAqIGZ1bmN0aW9uIHJldHVybnMgYSBub24gemVybyByZXN1bHQg
dGhlIHJlZ2lzdHJhdGlvbiB3aWxsIGJlIGFib3J0ZWQuIEFzDQorICogcGFy
dCBvZiB0aGUgYWJvcnQgcHJvY2VzcywgYWxsIHBhZ2dzIGJlbG9uZ2luZyB0
byB0aGUgbmV3IGNsaWVudCB3aWxsIGJlDQorICogcmVtb3ZlZCBmcm9tIGFs
bCB0YXNrcyBhbmQgdGhlIHN1cHBsaWVkICJkZXRhY2goKSIgZnVuY3Rpb24g
d2lsbCBiZQ0KKyAqIGNhbGxlZCBvbiB0aGVtLiAgDQorICoNCisgKiBJZiBh
IG1lbW9yeSBlcnJvciBpcyBlbmNvdW50ZXJlZCwgdGhlIHBhZ2cgaG9vayBp
cyB1bnJlZ2lzdGVyZWQgYW5kIGFueQ0KKyAqIHRhc2tzIHRoYXQgaGF2ZSBi
ZWVuIGF0dGFjaGVkIHRvIHRoZSBpbml0aWFsIHBhZ2cgY29udGFpbmVyIGFy
ZSBkZXRhY2hlZA0KKyAqIGZyb20gdGhhdCBjb250YWluZXIuDQorICoNCisg
Ki8NCitpbnQNCitwYWdnX2hvb2tfcmVnaXN0ZXIoc3RydWN0IHBhZ2dfaG9v
ayAqcGFnZ19ob29rX25ldykNCit7DQorCXN0cnVjdCBwYWdnX2hvb2sgKnBh
Z2dfaG9vayA9IE5VTEw7DQorDQorCS8qIEFkZCBuZXcgcGFnZyBtb2R1bGUg
dG8gYWNjZXNzIGxpc3QgKi8NCisJaWYgKCFwYWdnX2hvb2tfbmV3KQ0KKwkJ
cmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3IgKi8NCisJaWYgKCFsaXN0X2Vt
cHR5KCZwYWdnX2hvb2tfbmV3LT5lbnRyeSkpDQorCQlyZXR1cm4gLUVJTlZB
TDsJCQkvKiBlcnJvciAqLw0KKwlpZiAocGFnZ19ob29rX25ldy0+bmFtZSA9
PSBOVUxMIHx8IHN0cmxlbihwYWdnX2hvb2tfbmV3LT5uYW1lKSA+IFBBR0df
TkFNRUxOKQ0KKwkJcmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3IgKi8NCisN
CisJLyogVHJ5IHRvIGluc2VydCBuZXcgaG9vayBlbnRyeSBpbnRvIHRoZSBw
YWdnIGhvb2sgbGlzdCAqLw0KKwlkb3duX3dyaXRlKCZwYWdnX2hvb2tfbGlz
dF9zZW0pOw0KKw0KKwlwYWdnX2hvb2sgPSBnZXRfcGFnZ19ob29rKHBhZ2df
aG9va19uZXctPm5hbWUpOw0KKw0KKwlpZiAocGFnZ19ob29rKSB7DQorCQl1
cF93cml0ZSgmcGFnZ19ob29rX2xpc3Rfc2VtKTsNCisJCXByaW50ayhLRVJO
X1dBUk5JTkcgIkF0dGVtcHQgdG8gcmVnaXN0ZXIgZHVwbGljYXRlIg0KKwkJ
CQkiIFBBR0cgc3VwcG9ydCAobmFtZT0lcylcbiIsIHBhZ2dfaG9va19uZXct
Pm5hbWUpOw0KKwkJcmV0dXJuIC1FQlVTWTsNCisJfQ0KKw0KKwkvKiBPa2F5
LCB3ZSBjYW4gaW5zZXJ0IGludG8gdGhlIHBhZ2cgaG9vayBsaXN0ICovDQor
CWxpc3RfYWRkX3RhaWwoJnBhZ2dfaG9va19uZXctPmVudHJ5LCAmcGFnZ19o
b29rX2xpc3QpOw0KKwkvKiBzZXQgdGhlIHJlZiBjb3VudCB0byB6ZXJvICov
DQorCWF0b21pY19zZXQoJnBhZ2dfaG9va19uZXctPnJlZmNudCwgMCk7DQor
DQorCS8qIE5vdyB3ZSBjYW4gY2FsbCB0aGUgaW5pdGlhbGl6ZXIgZnVuY3Rp
b24gKGlmIHByZXNlbnQpIGZvciBlYWNoIHRhc2sgKi8NCisJaWYgKHBhZ2df
aG9va19uZXctPmluaXQgIT0gTlVMTCkgew0KKwkJaW50IGluaXRfcmVzdWx0
ID0gMDsNCisJCWludCB0YXNrX2V4aXRlZDsNCisNCisJCS8qIEJlY2F1c2Ug
b2YgaW50ZXJuYWwgcmFjZSBjb25kaXRpb25zIHdlIGNhbid0IGdhdXJhbnRl
ZQ0KKwkJICogZ2V0dGluZyBldmVyeSB0YXNrIGluIGp1c3Qgb25lIHBhc3Mg
c28gd2UganVzdCBrZWVwIGdvaW5nDQorCQkgKiB1bnRpbCB3ZSBkb24ndCBm
aW5kIGFueSB1bml0aWFsaXplZCB0YXNrcy4gIFRoZSBpbmVmZmljaWVuY3kN
CisJCSAqIG9mIHRoaXMgc2hvdWxkIGJlIHRlbXBlcmVkIGJ5IHRoZSBmYWN0
IHRoYXQgdGhpcyBoYXBwZW5zDQorCQkgKiBhdCBtb3N0IG9uY2UgZm9yIGVh
Y2ggcmVnaXN0ZXJlZCBjbGllbnQuDQorCQkgKi8NCisJCWRvIHsNCisJCQlz
dHJ1Y3QgdGFza19zdHJ1Y3QgKnAgPSBOVUxMOw0KKw0KKwkJCXJlYWRfbG9j
aygmdGFza2xpc3RfbG9jayk7DQorCQkJZm9yX2VhY2hfcHJvY2VzcyhwKSB7
DQorCQkJCXN0cnVjdCBwYWdnICpwYWdncDsNCisNCisJCQkJZ2V0X3Rhc2tf
c3RydWN0KHApOw0KKwkJCQlyZWFkX3VubG9jaygmdGFza2xpc3RfbG9jayk7
DQorCQkJCWRvd25fd3JpdGUoJnAtPnBhZ2dfc2VtKTsNCisJCQkJcGFnZ3Ag
PSBwYWdnX2dldChwLCBwYWdnX2hvb2tfbmV3LT5uYW1lKTsNCisJCQkJaWYg
KHBhZ2dwID09IE5VTEwpIHsNCisJCQkJCXBhZ2dwID0gcGFnZ19hbGxvYyhw
LCBwYWdnX2hvb2tfbmV3KTsNCisJCQkJCWlmIChwYWdncCAhPSBOVUxMKQ0K
KwkJCQkJCWluaXRfcmVzdWx0ID0gcGFnZ19ob29rX25ldy0+aW5pdChwLCBw
YWdncCk7DQorCQkJCQllbHNlDQorCQkJCQkJaW5pdF9yZXN1bHQgPSAtRU5P
TUVNOw0KKwkJCQl9DQorCQkJCXVwX3dyaXRlKCZwLT5wYWdnX3NlbSk7DQor
CQkJCXJlYWRfbG9jaygmdGFza2xpc3RfbG9jayk7DQorCQkJCS8qIExpa2Ug
aW4gcmVtb3ZlX2NsaWVudF9wYWdnc19mcm9tX2FsbF90YXNrcywgaWYgdGhl
IHRhc2sNCisJCQkJICogZGlzYXBwZWFyZWQgb24gdXMgd2hpbGUgd2Ugd2Vy
ZSBnb2luZyB0aHJvdWdoIHRoZQ0KKwkJCQkgKiBmb3JfZWFjaF9wcm9jZXNz
IGxvb3AsIHdlIG5lZWQgdG8gc3RhcnQgb3ZlciB3aXRoIHRoYXQgbG9vcC4N
CisJCQkJICogVGhhdCdzIHdoeSB3ZSBoYXZlIHRoZSBsaXN0X2VtcHR5IGhl
cmUgKi8NCisJCQkJdGFza19leGl0ZWQgPSBsaXN0X2VtcHR5KCZwLT50YXNr
cyk7DQorCQkJCXB1dF90YXNrX3N0cnVjdChwKTsNCisJCQkJaWYgKChpbml0
X3Jlc3VsdCAhPSAwKSB8fCB0YXNrX2V4aXRlZCkgew0KKwkJCQkJYnJlYWs7
DQorCQkJCX0NCisJCQl9DQorCQkJcmVhZF91bmxvY2soJnRhc2tsaXN0X2xv
Y2spOw0KKwkJfSB3aGlsZSAoKGluaXRfcmVzdWx0ID09IDApICYmIHRhc2tf
ZXhpdGVkKTsNCisNCisJCS8qDQorCQkgKiBpZiBhbnl0aGluZyB3ZW50IHdy
b25nIGR1cmluZyBpbml0aWFsaXNhdGlvbiBhYmFuZG9uIHRoZQ0KKwkJICog
cmVnaXN0cmF0aW9uIHByb2Nlc3MNCisJCSAqLw0KKwkJaWYgKGluaXRfcmVz
dWx0ICE9IDApIHsNCisJCQlyZW1vdmVfY2xpZW50X3BhZ2dzX2Zyb21fYWxs
X3Rhc2tzKHBhZ2dfaG9va19uZXcpOw0KKwkJCWxpc3RfZGVsX2luaXQoJnBh
Z2dfaG9va19uZXctPmVudHJ5KTsNCisJCQl1cF93cml0ZSgmcGFnZ19ob29r
X2xpc3Rfc2VtKTsNCisNCisJCQlwcmludGsoS0VSTl9XQVJOSU5HICJSZWdp
c3RlcmluZyBQQUdHIHN1cHBvcnQgZm9yIg0KKwkJCQkiIChuYW1lPSVzKSBm
YWlsZWRcbiIsIHBhZ2dfaG9va19uZXctPm5hbWUpOw0KKw0KKwkJCXJldHVy
biBpbml0X3Jlc3VsdDsgLyogaG9vayBpbml0IGZ1bmN0aW9uIGVycm9yIHJl
c3VsdCAqLw0KKwkJfQ0KKwl9DQorDQorCXVwX3dyaXRlKCZwYWdnX2hvb2tf
bGlzdF9zZW0pOw0KKw0KKwlwcmludGsoS0VSTl9JTkZPICJSZWdpc3Rlcmlu
ZyBQQUdHIHN1cHBvcnQgZm9yIChuYW1lPSVzKVxuIiwNCisJCQlwYWdnX2hv
b2tfbmV3LT5uYW1lKTsNCisNCisJcmV0dXJuIDA7CQkJCQkvKiBzdWNjZXNz
ICovDQorDQorfQ0KKw0KKy8qKg0KKyAqIHBhZ2dfaG9va191bnJlZ2lzdGVy
IC0gVW5yZWdpc3RlciBwYWdnIGhvb2sgYW5kIHJlbW92ZSBpdCBmcm9tIHRo
ZSBsaXN0DQorICogQHBhZ2dfaG9va19vbGQ6IFRoZSBob29rIHRvIHVucmVn
aXN0ZXIgYW5kIHJlbW92ZQ0KKyAqDQorICogVXNlZCB0byB1bnJlZ2lzdGVy
IHBhZ2cgaG9va3MgYW5kIHJlbW92ZSB0aGVtIGZyb20gdGhlIHBhZ2dfaG9v
a19saXN0Lg0KKyAqIE9uY2UgdGhlIHBhZ2cgaG9vayBlbnRyeSBpbiB0aGUg
cGFnZ19ob29rX2xpc3QgaXMgZm91bmQsIHBhZ2dzIGFzc29jaWF0ZWQNCisg
KiB3aXRoIHRoZSBob29rIChpZiBhbnkpIHdpbGwgaGF2ZSB0aGVpciBkZXRh
Y2ggZnVuY3Rpb24gY2FsbGVkIGFuZCB3aWxsDQorICogYmUgZGV0YWNoZWQu
DQorICogDQorICovDQoraW50DQorcGFnZ19ob29rX3VucmVnaXN0ZXIoc3Ry
dWN0IHBhZ2dfaG9vayAqcGFnZ19ob29rX29sZCkNCit7DQorCXN0cnVjdCBw
YWdnX2hvb2sgKnBhZ2dfaG9vazsNCisNCisJLyogQ2hlY2sgdGhlIHZhbGlk
aXR5IG9mIHRoZSBhcmd1bWVudHMgKi8NCisJaWYgKCFwYWdnX2hvb2tfb2xk
KQ0KKwkJcmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3IgKi8NCisJaWYgKGxp
c3RfZW1wdHkoJnBhZ2dfaG9va19vbGQtPmVudHJ5KSkNCisJCXJldHVybiAt
RUlOVkFMOwkJCS8qIGVycm9yICovDQorCWlmIChwYWdnX2hvb2tfb2xkLT5u
YW1lID09IE5VTEwpDQorCQlyZXR1cm4gLUVJTlZBTDsJCQkvKiBlcnJvciAq
Lw0KKw0KKwlkb3duX3dyaXRlKCZwYWdnX2hvb2tfbGlzdF9zZW0pOw0KKw0K
KwlwYWdnX2hvb2sgPSBnZXRfcGFnZ19ob29rKHBhZ2dfaG9va19vbGQtPm5h
bWUpOw0KKw0KKwlpZiAocGFnZ19ob29rICYmIHBhZ2dfaG9vayA9PSBwYWdn
X2hvb2tfb2xkKSB7DQorCQlyZW1vdmVfY2xpZW50X3BhZ2dzX2Zyb21fYWxs
X3Rhc2tzKHBhZ2dfaG9vayk7DQorCQlsaXN0X2RlbF9pbml0KCZwYWdnX2hv
b2stPmVudHJ5KTsNCisJCXVwX3dyaXRlKCZwYWdnX2hvb2tfbGlzdF9zZW0p
Ow0KKw0KKwkJcHJpbnRrKEtFUk5fSU5GTyAiVW5yZWdpc3RlcmluZyBQQUdH
IHN1cHBvcnQgZm9yIg0KKwkJCQkiIChuYW1lPSVzKVxuIiwgcGFnZ19ob29r
X29sZC0+bmFtZSk7DQorDQorCQlyZXR1cm4gMDsJCQkvKiBzdWNjZXNzICov
DQorCX0NCisNCisJdXBfd3JpdGUoJnBhZ2dfaG9va19saXN0X3NlbSk7DQor
DQorCXByaW50ayhLRVJOX1dBUk5JTkcgIkF0dGVtcHQgdG8gdW5yZWdpc3Rl
ciBQQUdHIHN1cHBvcnQgKG5hbWU9JXMpIg0KKwkJCSIgZmFpbGVkIC0gbm90
IGZvdW5kXG4iLCBwYWdnX2hvb2tfb2xkLT5uYW1lKTsNCisJDQorCXJldHVy
biAtRUlOVkFMOwkJCQkvKiBlcnJvciAqLw0KK30NCisNCisNCisvKioNCisg
KiBfX3BhZ2dfYXR0YWNoIC0gQXR0YWNoIGEgbmV3IHRhc2sgdG8gdGhlIHNh
bWUgY29udGFpbmVycyBvZiBpdHMgcGFyZW50DQorICogQHRvX3Rhc2s6IFRo
ZSBjaGlsZCB0YXNrIHRoYXQgd2lsbCBpbmhlcml0IHRoZSBwYXJlbnQncyBj
b250YWluZXJzDQorICogQGZyb21fdGFzazogVGhlIHBhcmVudCB0YXNrIA0K
KyAqDQorICogVXNlZCB0byBhdHRhY2ggYSBuZXcgdGFzayB0byB0aGUgc2Ft
ZSBwYWdnIGNvbnRhaW5lcnMgdG8gd2hpY2ggaXQncyBwYXJlbnQNCisgKiBp
cyBhdHRhY2hlZC4NCisgKg0KKyAqIFRoZSAiZnJvbSIgYXJndW1lbnQgaXMg
dGhlIHBhcmVudCB0YXNrLiAgVGhlICJ0byIgYXJndW1lbnQgaXMgdGhlIGNo
aWxkDQorICogdGFzay4gDQorICoNCisgKi8NCit2b2lkIA0KK19fcGFnZ19h
dHRhY2goc3RydWN0IHRhc2tfc3RydWN0ICp0b190YXNrLCBzdHJ1Y3QgdGFz
a19zdHJ1Y3QgKmZyb21fdGFzaykNCit7DQorCXN0cnVjdCBwYWdnICpmcm9t
X3BhZ2c7DQorDQorCS8qIGxvY2sgdGhlIHBhcmVudHMgcGFnZ19saXN0IHdl
IGFyZSBjb3B5aW5nIGZyb20gKi8NCisJZG93bl9yZWFkKCZmcm9tX3Rhc2st
PnBhZ2dfc2VtKTsgLyogcmVhZCBsb2NrIHRoZSBwYWdnIGxpc3QgKi8NCisN
CisJbGlzdF9mb3JfZWFjaF9lbnRyeShmcm9tX3BhZ2csICZmcm9tX3Rhc2st
PnBhZ2dfbGlzdCwgZW50cnkpIHsNCisJCXN0cnVjdCBwYWdnICp0b19wYWdn
ID0gTlVMTDsNCisNCisJCXRvX3BhZ2cgPSBwYWdnX2FsbG9jKHRvX3Rhc2ss
IGZyb21fcGFnZy0+aG9vayk7DQorCQlpZiAoIXRvX3BhZ2cpIHsNCisJCQln
b3RvIGVycm9yX3JldHVybjsNCisJCX0NCisJCWlmICh0b19wYWdnLT5ob29r
LT5hdHRhY2godG9fdGFzaywgdG9fcGFnZywgZnJvbV9wYWdnLT5kYXRhKSAh
PSAwICkgDQorCQkJZ290byBlcnJvcl9yZXR1cm47DQorCX0NCisNCisJdXBf
cmVhZCgmZnJvbV90YXNrLT5wYWdnX3NlbSk7IC8qIHVubG9jayB0aGUgcGFn
ZyBsaXN0ICovDQorDQorCXJldHVybjsJCQkJCS8qIHN1Y2Nlc3MgKi8NCisN
CisgIGVycm9yX3JldHVybjoNCisJLyogDQorCSAqIENsZWFuIHVwIGFsbCB0
aGUgcGFnZyBhdHRhY2htZW50cyBtYWRlIG9uIGJlaGFsZiBvZiB0aGUgbmV3
DQorCSAqIHRhc2suICBTZXQgbmV3IHRhc2sgcGFnZyBwdHIgdG8gTlVMTCBm
b3IgcmV0dXJuLg0KKwkgKi8NCisJdXBfcmVhZCgmZnJvbV90YXNrLT5wYWdn
X3NlbSk7IC8qIHVubG9jayB0aGUgcGFnZyBsaXN0ICovDQorCV9fcGFnZ19k
ZXRhY2godG9fdGFzayk7DQorCXJldHVybjsJCQkJLyogZmFpbHVyZSAqLw0K
K30NCisNCisvKioNCisgKiBfX3BhZ2dfZGV0YWNoIC0gRGV0YWNoIGEgdGFz
ayBmcm9tIGFsbCBwYWdnIGNvbnRhaW5lcnMgaXQgaXMgYXR0YWNoZWQgdG8N
CisgKiBAdGFzazogVGFzayB0byBkZXRhY2ggZnJvbSBwYWdnIGNvbnRhaW5l
cnMNCisgKg0KKyAqIFVzZWQgdG8gZGV0YWNoIGEgdGFzayBmcm9tIGFsbCBw
YWdnIGNvbnRhaW5lcnMgdG8gd2hpY2ggaXQgaXMgYXR0YWNoZWQuDQorICog
DQorICovDQordm9pZCANCitfX3BhZ2dfZGV0YWNoKHN0cnVjdCB0YXNrX3N0
cnVjdCAqdGFzaykNCit7DQorCXN0cnVjdCBwYWdnICpwYWdnOw0KKwlzdHJ1
Y3QgcGFnZyAqcGFnZ3RtcDsNCisNCisJLyogUmVtb3ZlIHJlZi4gdG8gcGFn
Z3MgZnJvbSB0YXNrIGltbWVkaWF0ZWx5ICovDQorCWRvd25fd3JpdGUoJnRh
c2stPnBhZ2dfc2VtKTsgLyogd3JpdGUgbG9jayBwYWdnIGxpc3QgKi8NCisN
CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHBhZ2csIHBhZ2d0bXAsICZ0
YXNrLT5wYWdnX2xpc3QsIGVudHJ5KSB7DQorCQlwYWdnLT5ob29rLT5kZXRh
Y2godGFzaywgcGFnZyk7DQorCQlwYWdnX2ZyZWUocGFnZyk7DQorCX0NCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KKwl1cF93cml0
ZSgmdGFzay0+cGFnZ19zZW0pOyAvKiB3cml0ZSB1bmxvY2sgdGhlIHBhZ2cg
bGlzdCAqLw0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
DQorCXJldHVybjsgICAvKiAwID0gc3VjY2VzcywgZWxzZSByZXR1cm4gbGFz
dCBjb2RlIGZvciBmYWlsdXJlICovDQorfQ0KKw0KKw0KKy8qKg0KKyAqIF9f
cGFnZ19leGVjIC0gRXhlY3V0ZSBjYWxsYmFjayB3aGVuIGEgcHJvY2VzcyBp
biBhIGNvbnRhaW5lciBleGVjcw0KKyAqIEB0YXNrOiBXZSBnbyB0aHJvdWdo
IHRoZSBwYWdnIGxpc3QgaW4gdGhlIGdpdmVuIHRhc2sNCisgKg0KKyAqIFVz
ZWQgdG8gd2hlbiBhIHByb2Nlc3MgdGhhdCBpcyBpbiBhIHBhZ2cgY29udGFp
bmVyIGRvZXMgYW4gZXhlYy4NCisgKg0KKyAqIFRoZSAiZnJvbSIgYXJndW1l
bnQgaXMgdGhlIHRhc2suICBUaGUgIm5hbWUiIGFyZ3VtZW50IGlzIHRoZSBu
YW1lDQorICogb2YgdGhlIHByb2Nlc3MgYmVpbmcgZXhlYydlZC4NCisgKg0K
KyAqLw0KK2ludCANCitfX3BhZ2dfZXhlYyhzdHJ1Y3QgdGFza19zdHJ1Y3Qg
KnRhc2spIA0KK3sNCisJc3RydWN0IHBhZ2cJKnBhZ2c7DQorDQorCS8qIGxv
Y2sgdGhlIHBhcmVudHMgcGFnZ19saXN0IHdlIGFyZSBjb3B5aW5nIGZyb20g
Ki8NCisJZG93bl9yZWFkKCZ0YXNrLT5wYWdnX3NlbSk7IC8qIGxvY2sgdGhl
IHBhZ2cgbGlzdCAqLw0KKw0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBhZ2cs
ICZ0YXNrLT5wYWdnX2xpc3QsIGVudHJ5KSB7DQorCQlpZiAocGFnZy0+aG9v
ay0+ZXhlYykgLyogY29uZGl0aW9uYWwgYmVjYXVzZSBpdCdzIG9wdGlvbmFs
ICovDQorCQkJcGFnZy0+aG9vay0+ZXhlYyh0YXNrLCBwYWdnKTsNCisJfQ0K
Kw0KKwl1cF9yZWFkKCZ0YXNrLT5wYWdnX3NlbSk7IC8qIHVubG9jayB0aGUg
cGFnZyBsaXN0ICovDQorCXJldHVybiAwOw0KK30NCisNCisNCitFWFBPUlRf
U1lNQk9MKHBhZ2dfZ2V0KTsNCitFWFBPUlRfU1lNQk9MKHBhZ2dfYWxsb2Mp
Ow0KK0VYUE9SVF9TWU1CT0wocGFnZ19mcmVlKTsNCitFWFBPUlRfU1lNQk9M
KHBhZ2dfaG9va19yZWdpc3Rlcik7DQorRVhQT1JUX1NZTUJPTChwYWdnX2hv
b2tfdW5yZWdpc3Rlcik7DQo=

---2136806248-436526230-1090530214=:474995--
