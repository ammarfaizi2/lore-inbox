Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S277667AbRJLNRQ>; Fri, 12 Oct 2001 09:17:16 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S277670AbRJLNRH>; Fri, 12 Oct 2001 09:17:07 -0400
Received: from [196.38.120.139] ([196.38.120.139]:38160 "EHLO
	ntserver1.secureworx.com") by vger.kernel.org with ESMTP
	id <S277668AbRJLNQx>; Fri, 12 Oct 2001 09:16:53 -0400
Message-ID: <9136BE9FE178D411A14F00508B6A0B7B179F62@ntserver1>
From: Robert Sandilands <robert.sandilands@secureworx.com>
To: "Linux-Kernel (E-mail)" <linux-kernel@vger.kernel.org>
Subject: Routing Question
Date: Fri, 12 Oct 2001 15:27:20 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: text/plain;
	charset="iso-8859-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

I have the following setup, all Linux machines:

   M1    --    M2     --              M3       ---          M4
10.0.0.2   10.0.0.1-172.20.10.3    172.20.10.1-196.20.1.1     196.20.1.2

M1 has 10.0.0.1 as it's default gateway.
M2 is configured as a router and has 172.20.10.1 as it's default gateway.
M3 is configured as a router to the Internet with default gw 196.20.1.2 and
has a static route to the 10.0.0.0/24 network with 172.20.10.3 as gateway.
M4 is just a machine representing a machine on the Internet.

With this configuration all the machines can talk to all other machines
without any problems.

Now comes the problem. Let us say I add M5 that is 172.20.10.2 with default
gateway 172.20.10.1. This machine can talk to M3 and M4 without any
problems. It can only talk to the outside interface of M2 and can not talk
to M1 at all. This can be fixed by adding a static route to M5, but let us
say I have 200 machines that I have to add a static route to, and I would
rather fix the problem on M3 than on 200 computers.

If I traceroute from M1 -> M4 you get M1->M2->M3->M4. If I traceroute from
M3->M1 I get M3->M2->M1. If I traceroute from M4->M1 I get M4->M3->M2->M1.

If I traceroute from M5->M1, I get M5->M3->"* * *...." That is the problem
I'm trying to solve.  Why is the traffic dying at M3 if it originates from
M5? And what can I do about it?

If I use ethereal to follow the packet I can see the packet going from M5 to
M3. I see no traffic generated by M3 in response to that.

Thank you.

Robert Sandilands

PS: Here is the information in another format.

M1 - 10.0.0.2 - 10.0.0.0/24 gw 10.0.0.1 (M2)
M2 - 10.0.0.1 - 10.0.0.0/24 
     172.20.10.3 - 172.20.10.0/24 gw 172.20.10.1 (M3)
M3 - 172.20.10.1 - 172.20.10.0/24
   - 196.20.1.1  - 196.20.1.0/24  gw 196.20.1.2, (M4)
					    route -net 10.0.0.0/24 gw
172.20.10.3 (M2)
M4 - 196.20.1.2  - 196.20.1.0/24  route -net 10.0.0.0/24 gw 196.20.1.1, (M3)
					    route -net 172.20.10.0/24 gw
196.20.1.1 (M3)
M5 - 172.20.10.2 - 172.20.10.0/24 gw 172.20.10.1 (M3)
