Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262279AbTH3X2H (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 30 Aug 2003 19:28:07 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262280AbTH3X2H
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 30 Aug 2003 19:28:07 -0400
Received: from parcelfarce.linux.theplanet.co.uk ([195.92.249.252]:12960 "EHLO
	www.linux.org.uk") by vger.kernel.org with ESMTP id S262279AbTH3X2D
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sat, 30 Aug 2003 19:28:03 -0400
Date: Sat, 30 Aug 2003 20:30:36 -0300 (BRT)
From: Marcelo Tosatti <marcelo@parcelfarce.linux.theplanet.co.uk>
X-X-Sender: marcelo@logos.cnet
To: Andrea Arcangeli <andrea@suse.de>
Cc: Marcelo Tosatti <marcelo@conectiva.com.br>,
       Mike Fedyk <mfedyk@matchmail.com>, Antonio Vargas <wind@cocodriloo.com>,
       lkml <linux-kernel@vger.kernel.org>,
       Marc-Christian Petersen <m.c.p@wolk-project.de>
Subject: Re: Andrea VM changes
In-Reply-To: <20030830231904.GL24409@dualathlon.random>
Message-ID: <Pine.LNX.4.44.0308302026570.20323-100000@logos.cnet>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org



On Sun, 31 Aug 2003, Andrea Arcangeli wrote:

> On Sat, Aug 30, 2003 at 04:21:02PM -0300, Marcelo Tosatti wrote:
> > y
> > 
> > On Sat, 30 Aug 2003, Marcelo Tosatti wrote:
> > 
> > > >
> > > > Indeed, you are right.
> > > >
> > > > I'll start looking at them Monday. I'll keep you in touch. Thanks.
> > >
> > > Andrea,
> > >
> > > Would you mind to explain me 05_vm_06_swap_out-3 ?
> > >
> > > I see you change shrink_cache, try_to_free_pages_zone, etc.
> > >
> > > Can you please give me a detailed explanation of the changes there?
> > >
> > > I appreciate very much.
> > >
> > > I'll keep looking at other patches for now.
> > 
> > 05_vm_09_misc_junk-3 removes the PF_MEMDIE and you also seem to remove the
> > OOM killer. Is that right? Why?
> 
> because the oom killer is a DoS on servers, on a database setup, with 2G
> free, with say all tasks 2.7G large, it'll start killing all the
> thousand database tasks instead of the 2g netscape task that hit an
> userspace bug and it started allocating ram in a loop, and that will
> make no progress since no physical ram will be released. There's no need
> of oom killer to keep the system stable, with my vm, and the current
> probabilistic oom killer in the page fault hander 

So tasks get killed in case of page allocation failure? 

> kills the right task most of the time (unlike the stock oom killers that
> works well only for the desktops or developer machines). So it does a
> much better job and it doesn't risk to DoS the box due oom.

Mind to explain me in more detail the OOM killing mechanism? 


> Another DoS generated by the oom killer is that it'll try forever to
> kill a UNINTERRUPTIBLE task hanging in a nfs server that is down, so it
> hangs the whole box for an unlimited time.
> 
> I've an algorithm that will work, and that will provide very good
> guarantees to kill the "best" task to make the machine usable again,
> with the needed protection against the security DoSes, but it's in
> no-way similar to the current oom killer.

My concern is about how this oom killer works. 

PS: Thanks for answering, hope we can agree on things and make progress 
on this merge. 

