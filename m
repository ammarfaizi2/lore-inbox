Return-Path: <linux-kernel-owner+willy=40w.ods.org-S268877AbUI2Thg@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S268877AbUI2Thg (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 29 Sep 2004 15:37:36 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S268854AbUI2ThW
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 29 Sep 2004 15:37:22 -0400
Received: from omx2-ext.sgi.com ([192.48.171.19]:25545 "EHLO omx2.sgi.com")
	by vger.kernel.org with ESMTP id S268877AbUI2Td0 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 29 Sep 2004 15:33:26 -0400
Date: Wed, 29 Sep 2004 12:32:09 -0700 (PDT)
From: Christoph Lameter <clameter@sgi.com>
X-X-Sender: clameter@schroedinger.engr.sgi.com
To: George Anzinger <george@mvista.com>
cc: Ulrich Drepper <drepper@redhat.com>, johnstul@us.ibm.com,
       Ulrich.Windl@rz.uni-regensburg.de, jbarnes@sgi.com,
       linux-kernel@vger.kernel.org, libc-alpha@sources.redhat.com
Subject: Posix compliant CLOCK_PROCESS/THREAD_CPUTIME_ID V5
In-Reply-To: <415AF4C3.1040808@mvista.com>
Message-ID: <Pine.LNX.4.58.0409291227040.25905@schroedinger.engr.sgi.com>
References: <B6E8046E1E28D34EB815A11AC8CA312902CD3264@mtv-atc-605e--n.corp.sgi.com>
 <Pine.LNX.4.58.0409240508560.5706@schroedinger.engr.sgi.com>
 <4154F349.1090408@redhat.com> <Pine.LNX.4.58.0409242253080.13099@schroedinger.engr.sgi.com>
 <41550B77.1070604@redhat.com> <B6E8046E1E28D34EB815A11AC8CA312902CD327E@mtv-atc-605e--n.corp.sgi.com>
 <Pine.LNX.4.58.0409271344220.32308@schroedinger.engr.sgi.com>
 <4159B920.3040802@redhat.com> <Pine.LNX.4.58.0409282017340.18604@schroedinger.engr.sgi.com>
 <415AF4C3.1040808@mvista.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1700579579-76263974-1096486329=:25905"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1700579579-76263974-1096486329=:25905
Content-Type: TEXT/PLAIN; charset=US-ASCII

This version uses an offset field in the task and signal structs
to store offsets for the thread and process clock. It also includes
the check in timer_create for REALTIME or MONOTONIC. The
clocks are now independent and therefore the thread clock is not
clearedby clock_settime(CLOCK_PROCESS_CPUTIME_ID) in the testrun:

Single Thread Testing
  CLOCK_THREAD_CPUTIME_ID=          0.374943000 resolution= 0.000999848
 CLOCK_PROCESS_CPUTIME_ID=          0.374943000 resolution= 0.000999848
Multi Thread Testing
Starting Thread: 0 1 2 3 4 5 6 7 8 9
 Joining Thread: 0 1 2 3 4 5 6 7 8 9
0 Cycles=      0 Thread=  0.000000000ns Process=  0.000999848ns
1 Cycles=1000000 Thread=  0.036994376ns Process=  0.315951968ns
2 Cycles=2000000 Thread=  0.073988752ns Process=  0.086986776ns
3 Cycles=3000000 Thread=  0.109983280ns Process=  0.517921264ns
4 Cycles=4000000 Thread=  0.146977656ns Process=  0.563914272ns
5 Cycles=5000000 Thread=  0.180972488ns Process=  1.043841312ns
6 Cycles=6000000 Thread=  0.218966712ns Process=  1.112830824ns
7 Cycles=7000000 Thread=  0.254961240ns Process=  1.620753608ns
8 Cycles=8000000 Thread=  0.290955768ns Process=  1.490773368ns
9 Cycles=9000000 Thread=  0.326950296ns Process=  1.641750416ns

Clock status at the end of the timer tests:
          Gettimeofday() = 1096484938.561351000
           CLOCK_REALTIME= 1096484938.561363000 resolution= 0.000999848
          CLOCK_MONOTONIC=        157.633669432 resolution= 0.000999848
 CLOCK_PROCESS_CPUTIME_ID=          1.641750416 resolution= 0.000999848
  CLOCK_THREAD_CPUTIME_ID=          0.375942848 resolution= 0.000999848
---1700579579-76263974-1096486329=:25905
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=thread_process_time_v5
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.58.0409291232090.25905@schroedinger.engr.sgi.com>
Content-Description: V5 of patch
Content-Disposition: attachment; filename=thread_process_time_v5

SW5kZXg6IGxpbnV4LTIuNi45LXJjMi9rZXJuZWwvcG9zaXgtdGltZXJzLmMN
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBsaW51eC0yLjYuOS1yYzIu
b3JpZy9rZXJuZWwvcG9zaXgtdGltZXJzLmMJMjAwNC0wOS0xMiAyMjozMjo0
OC4wMDAwMDAwMDAgLTA3MDANCisrKyBsaW51eC0yLjYuOS1yYzIva2VybmVs
L3Bvc2l4LXRpbWVycy5jCTIwMDQtMDktMjkgMTE6NDg6NTQuMDAwMDAwMDAw
IC0wNzAwDQpAQCAtMTAsNiArMTAsMTAgQEANCiAgKiAyMDA0LTA2LTAxICBG
aXggQ0xPQ0tfUkVBTFRJTUUgY2xvY2svdGltZXIgVElNRVJfQUJTVElNRSBi
dWcuDQogICoJCQkgICAgIENvcHlyaWdodCAoQykgMjAwNCBCb3JpcyBIdQ0K
ICAqDQorICogMjAwNC0wNy0yNyBQcm92aWRlIFBPU0lYIGNvbXBsaWFudCBj
bG9ja3MNCisgKgkJQ0xPQ0tfUFJPQ0VTU19DUFVUSU1FX0lEIGFuZCBDTE9D
S19USFJFQURfQ1BVVElNRV9JRC4NCisgKgkJYnkgQ2hyaXN0b3BoIExhbWV0
ZXINCisgKg0KICAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5
b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQogICogaXQg
dW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGlj
ZW5zZSBhcyBwdWJsaXNoZWQgYnkNCiAgKiB0aGUgRnJlZSBTb2Z0d2FyZSBG
b3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBv
ciAoYXQNCkBAIC0xMzMsMTggKzEzNywxMCBAQA0KICAqCSAgICByZXNvbHV0
aW9uLgkgSGVyZSB3ZSBkZWZpbmUgdGhlIHN0YW5kYXJkIENMT0NLX1JFQUxU
SU1FIGFzIGENCiAgKgkgICAgMS9IWiByZXNvbHV0aW9uIGNsb2NrLg0KICAq
DQotICogQ1BVVElNRSAmIFRIUkVBRF9DUFVUSU1FOiBXZSBhcmUgbm90LCBh
dCB0aGlzIHRpbWUsIGRlZmluZGluZyB0aGVzZQ0KLSAqCSAgICB0d28gY2xv
Y2tzIChhbmQgdGhlIG90aGVyIHByb2Nlc3MgcmVsYXRlZCBjbG9ja3MgKFN0
ZA0KLSAqCSAgICAxMDAzLjFkLTE5OTkpLiAgVGhlIHdheSB0aGVzZSBzaG91
bGQgYmUgc3VwcG9ydGVkLCB3ZSB0aGluaywNCi0gKgkgICAgaXMgdG8gdXNl
IGxhcmdlIG5lZ2F0aXZlIG51bWJlcnMgZm9yIHRoZSB0d28gY2xvY2tzIHRo
YXQgYXJlDQotICoJICAgIHBpbm5lZCB0byB0aGUgZXhlY3V0aW5nIHByb2Nl
c3MgYW5kIHRvIHVzZSAtcGlkIGZvciBjbG9ja3MNCi0gKgkgICAgcGlubmVk
IHRvIHBhcnRpY3VsYXIgcGlkcy4JQ2FsbHMgd2hpY2ggc3VwcG9ydGVkIHRo
ZXNlIGNsb2NrDQotICoJICAgIGlkcyB3b3VsZCBzcGxpdCBlYXJseSBpbiB0
aGUgZnVuY3Rpb24uDQotICoNCiAgKiBSRVNPTFVUSU9OOiBDbG9jayByZXNv
bHV0aW9uIGlzIHVzZWQgdG8gcm91bmQgdXAgdGltZXIgYW5kIGludGVydmFs
DQogICoJICAgIHRpbWVzLCBOT1QgdG8gcmVwb3J0IGNsb2NrIHRpbWVzLCB3
aGljaCBhcmUgcmVwb3J0ZWQgd2l0aCBhcw0KICAqCSAgICBtdWNoIHJlc29s
dXRpb24gYXMgdGhlIHN5c3RlbSBjYW4gbXVzdGVyLiAgSW4gc29tZSBjYXNl
cyB0aGlzDQotICoJICAgIHJlc29sdXRpb24gbWF5IGRlcGVuZCBvbiB0aGUg
dW5kZXJsYXlpbmcgY2xvY2sgaGFyZHdhcmUgYW5kDQorICoJICAgIHJlc29s
dXRpb24gbWF5IGRlcGVuZCBvbiB0aGUgdW5kZXJseWluZyBjbG9jayBoYXJk
d2FyZSBhbmQNCiAgKgkgICAgbWF5IG5vdCBiZSBxdWFudGlmaWFibGUgdW50
aWwgcnVuIHRpbWUsIGFuZCBvbmx5IHRoZW4gaXMgdGhlDQogICoJICAgIG5l
Y2Vzc2FyeSBjb2RlIGlzIHdyaXR0ZW4uCVRoZSBzdGFuZGFyZCBzYXlzIHdl
IHNob3VsZCBzYXkNCiAgKgkgICAgc29tZXRoaW5nIGFib3V0IHRoaXMgaXNz
dWUgaW4gdGhlIGRvY3VtZW50YXRpb24uLi4NCkBAIC0xNjIsNyArMTU4LDcg
QEANCiAgKg0KICAqICAgICAgICAgIEF0IHRoaXMgdGltZSBhbGwgZnVuY3Rp
b25zIEVYQ0VQVCBjbG9ja19uYW5vc2xlZXAgY2FuIGJlDQogICogICAgICAg
ICAgcmVkaXJlY3RlZCBieSB0aGUgQ0xPQ0tTIHN0cnVjdHVyZS4gIENsb2Nr
X25hbm9zbGVlcCBpcyBpbg0KLSAqICAgICAgICAgIHRoZXJlLCBidXQgdGhl
IGNvZGUgaWdub3JzIGl0Lg0KKyAqICAgICAgICAgIHRoZXJlLCBidXQgdGhl
IGNvZGUgaWdub3JlcyBpdC4NCiAgKg0KICAqIFBlcm1pc3Npb25zOiBJdCBp
cyBhc3N1bWVkIHRoYXQgdGhlIGNsb2NrX3NldHRpbWUoKSBmdW5jdGlvbiBk
ZWZpbmVkDQogICoJICAgIGZvciBlYWNoIGNsb2NrIHdpbGwgdGFrZSBjYXJl
IG9mIHBlcm1pc3Npb24gY2hlY2tzLgkgU29tZQ0KQEAgLTE5OCw2ICsxOTQs
MTAgQEANCiAJc3RydWN0IHRpbWVzcGVjICp0cCwgc3RydWN0IHRpbWVzcGVj
ICptbyk7DQogaW50IGRvX3Bvc2l4X2Nsb2NrX21vbm90b25pY19nZXR0aW1l
KHN0cnVjdCB0aW1lc3BlYyAqdHApOw0KIGludCBkb19wb3NpeF9jbG9ja19t
b25vdG9uaWNfc2V0dGltZShzdHJ1Y3QgdGltZXNwZWMgKnRwKTsNCitpbnQg
ZG9fcG9zaXhfY2xvY2tfcHJvY2Vzc19nZXR0aW1lKHN0cnVjdCB0aW1lc3Bl
YyAqdHApOw0KK2ludCBkb19wb3NpeF9jbG9ja19wcm9jZXNzX3NldHRpbWUo
c3RydWN0IHRpbWVzcGVjICp0cCk7DQoraW50IGRvX3Bvc2l4X2Nsb2NrX3Ro
cmVhZF9nZXR0aW1lKHN0cnVjdCB0aW1lc3BlYyAqdHApOw0KK2ludCBkb19w
b3NpeF9jbG9ja190aHJlYWRfc2V0dGltZShzdHJ1Y3QgdGltZXNwZWMgKnRw
KTsNCiBzdGF0aWMgc3RydWN0IGtfaXRpbWVyICpsb2NrX3RpbWVyKHRpbWVy
X3QgdGltZXJfaWQsIHVuc2lnbmVkIGxvbmcgKmZsYWdzKTsNCiANCiBzdGF0
aWMgaW5saW5lIHZvaWQgdW5sb2NrX3RpbWVyKHN0cnVjdCBrX2l0aW1lciAq
dGltciwgdW5zaWduZWQgbG9uZyBmbGFncykNCkBAIC0yMTgsNiArMjE4LDE2
IEBADQogCQkuY2xvY2tfZ2V0ID0gZG9fcG9zaXhfY2xvY2tfbW9ub3Rvbmlj
X2dldHRpbWUsDQogCQkuY2xvY2tfc2V0ID0gZG9fcG9zaXhfY2xvY2tfbW9u
b3RvbmljX3NldHRpbWUNCiAJfTsNCisJc3RydWN0IGtfY2xvY2sgY2xvY2tf
dGhyZWFkID0gey5yZXMgPSBDTE9DS19SRUFMVElNRV9SRVMsDQorCQkuYWJz
X3N0cnVjdCA9IE5VTEwsDQorCQkuY2xvY2tfZ2V0ID0gZG9fcG9zaXhfY2xv
Y2tfdGhyZWFkX2dldHRpbWUsDQorCQkuY2xvY2tfc2V0ID0gZG9fcG9zaXhf
Y2xvY2tfdGhyZWFkX3NldHRpbWUNCisJfTsNCisJc3RydWN0IGtfY2xvY2sg
Y2xvY2tfcHJvY2VzcyA9IHsucmVzID0gQ0xPQ0tfUkVBTFRJTUVfUkVTLA0K
KwkJLmFic19zdHJ1Y3QgPSBOVUxMLA0KKwkJLmNsb2NrX2dldCA9IGRvX3Bv
c2l4X2Nsb2NrX3Byb2Nlc3NfZ2V0dGltZSwNCisJCS5jbG9ja19zZXQgPSBk
b19wb3NpeF9jbG9ja19wcm9jZXNzX3NldHRpbWUNCisJfTsNCiANCiAjaWZk
ZWYgQ09ORklHX1RJTUVfSU5URVJQT0xBVElPTg0KIAkvKiBDbG9ja3MgYXJl
IG1vcmUgYWNjdXJhdGUgd2l0aCB0aW1lIGludGVycG9sYXRvcnMgKi8NCkBA
IC0yMjYsNiArMjM2LDggQEANCiANCiAJcmVnaXN0ZXJfcG9zaXhfY2xvY2so
Q0xPQ0tfUkVBTFRJTUUsICZjbG9ja19yZWFsdGltZSk7DQogCXJlZ2lzdGVy
X3Bvc2l4X2Nsb2NrKENMT0NLX01PTk9UT05JQywgJmNsb2NrX21vbm90b25p
Yyk7DQorCXJlZ2lzdGVyX3Bvc2l4X2Nsb2NrKENMT0NLX1BST0NFU1NfQ1BV
VElNRV9JRCwgJmNsb2NrX3Byb2Nlc3MpOw0KKwlyZWdpc3Rlcl9wb3NpeF9j
bG9jayhDTE9DS19USFJFQURfQ1BVVElNRV9JRCwgJmNsb2NrX3RocmVhZCk7
DQogDQogCXBvc2l4X3RpbWVyc19jYWNoZSA9IGttZW1fY2FjaGVfY3JlYXRl
KCJwb3NpeF90aW1lcnNfY2FjaGUiLA0KIAkJCQkJc2l6ZW9mIChzdHJ1Y3Qg
a19pdGltZXIpLCAwLCAwLCBOVUxMLCBOVUxMKTsNCkBAIC01NzMsOCArNTg1
LDggQEANCiAJc2lnZXZlbnRfdCBldmVudDsNCiAJaW50IGl0X2lkX3NldCA9
IElUX0lEX05PVF9TRVQ7DQogDQotCWlmICgodW5zaWduZWQpIHdoaWNoX2Ns
b2NrID49IE1BWF9DTE9DS1MgfHwNCi0JCQkJIXBvc2l4X2Nsb2Nrc1t3aGlj
aF9jbG9ja10ucmVzKQ0KKwlpZiAoKHVuc2lnbmVkKSB3aGljaF9jbG9jayAh
PSBDTE9DS19SRUFMVElNRSAmJg0KKwkgICAgKHVuc2lnbmVkKSB3aGljaF9j
bG9jayAhPSBDTE9DS19NT05PVE9OSUMpDQogCQlyZXR1cm4gLUVJTlZBTDsN
CiANCiAJbmV3X3RpbWVyID0gYWxsb2NfcG9zaXhfdGltZXIoKTsNCkBAIC0x
MjI3LDYgKzEyMzksNjkgQEANCiAJcmV0dXJuIC1FSU5WQUw7DQogfQ0KIA0K
Ky8qDQorICogU2luZ2xlIFVuaXggU3BlY2lmaWNhdGlvbiBWMzoNCisgKg0K
KyAqIEltcGxlbWVudGF0aW9ucyBzaGFsbCBhbHNvIHN1cHBvcnQgdGhlIHNw
ZWNpYWwgY2xvY2tpZF90IHZhbHVlDQorICogQ0xPQ0tfVEhSRUFEX0NQVVRJ
TUVfSUQsIHdoaWNoIHJlcHJlc2VudHMgdGhlIENQVS10aW1lIGNsb2NrIG9m
IHRoZSBjYWxsaW5nDQorICogdGhyZWFkIHdoZW4gaW52b2tpbmcgb25lIG9m
IHRoZSBjbG9ja18qKCkgb3IgdGltZXJfKigpIGZ1bmN0aW9ucy4gRm9yIHRo
ZXNlDQorICogY2xvY2sgSURzLCB0aGUgdmFsdWVzIHJldHVybmVkIGJ5IGNs
b2NrX2dldHRpbWUoKSBhbmQgc3BlY2lmaWVkIGJ5DQorICogY2xvY2tfc2V0
dGltZSgpIHNoYWxsIHJlcHJlc2VudCB0aGUgYW1vdW50IG9mIGV4ZWN1dGlv
biB0aW1lIG9mIHRoZSB0aHJlYWQNCisgKiBhc3NvY2lhdGVkIHdpdGggdGhl
IGNsb2NrLiANCisgKi8NCitpbnQgZG9fcG9zaXhfY2xvY2tfdGhyZWFkX2dl
dHRpbWUoc3RydWN0IHRpbWVzcGVjICp0cCkNCit7DQorCWppZmZpZXNfdG9f
dGltZXNwZWMoY3VycmVudC0+dXRpbWUgKyBjdXJyZW50LT5zdGltZQ0KKwkJ
CSsgY3VycmVudC0+dGhyZWFkX2Nsb2NrX29mZnNldCwgdHApOw0KKwlyZXR1
cm4gMDsNCit9DQorDQoraW50IGRvX3Bvc2l4X2Nsb2NrX3RocmVhZF9zZXR0
aW1lKHN0cnVjdCB0aW1lc3BlYyAqdHApDQorew0KKwljdXJyZW50LT50aHJl
YWRfY2xvY2tfb2Zmc2V0ID0gdGltZXNwZWNfdG9famlmZmllcyh0cCkNCisJ
CS0gY3VycmVudC0+dXRpbWUgLSBjdXJyZW50LT5zdGltZTsNCisJcmV0dXJu
IDA7DQorfQ0KKw0KKy8qDQorICogU2luZ2xlIFVuaXggU3BlY2lmaWNhdGlv
biBWMzoNCisgKg0KKyAqIEltcGxlbWVudGF0aW9ucyBzaGFsbCBhbHNvIHN1
cHBvcnQgdGhlIHNwZWNpYWwgY2xvY2tpZF90IHZhbHVlDQorICogQ0xPQ0tf
UFJPQ0VTU19DUFVUSU1FX0lELCB3aGljaCByZXByZXNlbnRzIHRoZSBDUFUt
dGltZSBjbG9jayBvZiB0aGUNCisgKiBjYWxsaW5nIHByb2Nlc3Mgd2hlbiBp
bnZva2luZyBvbmUgb2YgdGhlIGNsb2NrXyooKSBvciB0aW1lcl8qKCkgZnVu
Y3Rpb25zLg0KKyAqIEZvciB0aGVzZSBjbG9jayBJRHMsIHRoZSB2YWx1ZXMg
cmV0dXJuZWQgYnkgY2xvY2tfZ2V0dGltZSgpIGFuZCBzcGVjaWZpZWQNCisg
KiBieSBjbG9ja19zZXR0aW1lKCkgcmVwcmVzZW50IHRoZSBhbW91bnQgb2Yg
ZXhlY3V0aW9uIHRpbWUgb2YgdGhlIHByb2Nlc3MNCisgKiBhc3NvY2lhdGVk
IHdpdGggdGhlIGNsb2NrLg0KKyAqLw0KKw0KK3Vuc2lnbmVkIGxvbmcgcHJv
Y2Vzc190aWNrcyh2b2lkKSB7DQorCXVuc2lnbmVkIGxvbmcgdGlja3M7DQor
CXRhc2tfdCAqdDsNCisJDQorCS8qIFRoZSBzaWduYWwgc3RydWN0dXJlIGlz
IHNoYXJlZCBiZXR3ZWVuIGFsbCB0aHJlYWRzICovDQorCXRpY2tzID0gY3Vy
cmVudC0+c2lnbmFsLT51dGltZSArIGN1cnJlbnQtPnNpZ25hbC0+c3RpbWU7
DQorDQorCS8qIEFkZCB1cCB0aGUgY3B1IHRpbWUgZm9yIGFsbCB0aGUgc3Rp
bGwgcnVubmluZyB0aHJlYWRzIG9mIHRoaXMgcHJvY2VzcyAqLw0KKwl0ID0g
Y3VycmVudDsNCisJZG8gew0KKwkJdGlja3MgKz0gdC0+dXRpbWUgKyB0LT5z
dGltZTsNCisJCXQgPSBuZXh0X3RocmVhZCh0KTsNCisJfSB3aGlsZSAodCAh
PSBjdXJyZW50KTsNCisJcmV0dXJuIHRpY2tzOw0KK30NCisNCitpbnQgZG9f
cG9zaXhfY2xvY2tfcHJvY2Vzc19nZXR0aW1lKHN0cnVjdCB0aW1lc3BlYyAq
dHApDQorew0KKwlqaWZmaWVzX3RvX3RpbWVzcGVjKGN1cnJlbnQtPnNpZ25h
bC0+cHJvY2Vzc19jbG9ja19vZmZzZXQgKyBwcm9jZXNzX3RpY2tzKCksIHRw
KTsNCisJcmV0dXJuIDA7DQorfQ0KKw0KK2ludCBkb19wb3NpeF9jbG9ja19w
cm9jZXNzX3NldHRpbWUoc3RydWN0IHRpbWVzcGVjICp0cCkNCit7DQorCWN1
cnJlbnQtPnNpZ25hbC0+cHJvY2Vzc19jbG9ja19vZmZzZXQgPSB0aW1lc3Bl
Y190b19qaWZmaWVzKHRwKSAtIHByb2Nlc3NfdGlja3MoKTsNCisJcmV0dXJu
IDA7DQorfQ0KKw0KIGFzbWxpbmthZ2UgbG9uZw0KIHN5c19jbG9ja19zZXR0
aW1lKGNsb2NraWRfdCB3aGljaF9jbG9jaywgY29uc3Qgc3RydWN0IHRpbWVz
cGVjIF9fdXNlciAqdHApDQogew0KSW5kZXg6IGxpbnV4LTIuNi45LXJjMi9p
bmNsdWRlL2xpbnV4L3NjaGVkLmgNCj09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0N
Ci0tLSBsaW51eC0yLjYuOS1yYzIub3JpZy9pbmNsdWRlL2xpbnV4L3NjaGVk
LmgJMjAwNC0wOS0yOCAxNzoyMDo1NS4wMDAwMDAwMDAgLTA3MDANCisrKyBs
aW51eC0yLjYuOS1yYzIvaW5jbHVkZS9saW51eC9zY2hlZC5oCTIwMDQtMDkt
MjkgMTE6NDE6MjcuMDAwMDAwMDAwIC0wNzAwDQpAQCAtMjkzLDYgKzI5Myw3
IEBADQogDQogCS8qIFBPU0lYLjFiIEludGVydmFsIFRpbWVycyAqLw0KIAlz
dHJ1Y3QgbGlzdF9oZWFkIHBvc2l4X3RpbWVyczsNCisJaW50CQkJcHJvY2Vz
c19jbG9ja19vZmZzZXQ7CS8qIGZvciBDTE9DS19QUk9DRVNTX0NQVVRJTUVf
SUQgKi8NCiANCiAJLyogam9iIGNvbnRyb2wgSURzICovDQogCXBpZF90IHBn
cnA7DQpAQCAtNTA5LDYgKzUxMCw3IEBADQogCXVuc2lnbmVkIGxvbmcgdXRp
bWUsIHN0aW1lOw0KIAl1bnNpZ25lZCBsb25nIG52Y3N3LCBuaXZjc3c7IC8q
IGNvbnRleHQgc3dpdGNoIGNvdW50cyAqLw0KIAl1NjQgc3RhcnRfdGltZTsN
CisJaW50IHRocmVhZF9jbG9ja19vZmZzZXQ7CS8qIG9mZnNldCB0byB0aHJl
YWRfY2xvY2sgZm9yIENMT0NLX1RIUkVBRF9DUFVUSU1FX0lEICovDQogLyog
bW0gZmF1bHQgYW5kIHN3YXAgaW5mbzogdGhpcyBjYW4gYXJndWFibHkgYmUg
c2VlbiBhcyBlaXRoZXIgbW0tc3BlY2lmaWMgb3IgdGhyZWFkLXNwZWNpZmlj
ICovDQogCXVuc2lnbmVkIGxvbmcgbWluX2ZsdCwgbWFqX2ZsdDsNCiAvKiBw
cm9jZXNzIGNyZWRlbnRpYWxzICovDQo=

---1700579579-76263974-1096486329=:25905
Content-Type: TEXT/x-csrc; charset=US-ASCII; name="test_cputime.c"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.58.0409291232091.25905@schroedinger.engr.sgi.com>
Content-Description: Test program
Content-Disposition: attachment; filename="test_cputime.c"

I2luY2x1ZGUgPHN0ZGlvLmg+DQojaW5jbHVkZSA8c3RkbGliLmg+DQojaW5j
bHVkZSA8dGltZS5oPg0KI2luY2x1ZGUgPGVycm5vLmg+DQojaW5jbHVkZSA8
YXNtL3VuaXN0ZC5oPg0KI2luY2x1ZGUgPHB0aHJlYWQuaD4NCg0KI2RlZmlu
ZSBjbG9ja19nZXRyZXMoeCx5KSBzeXNjYWxsKF9fTlJfY2xvY2tfZ2V0cmVz
LCB4LHkpDQojZGVmaW5lIGNsb2NrX2dldHRpbWUoeCx5KSBzeXNjYWxsKF9f
TlJfY2xvY2tfZ2V0dGltZSwgeCwgeSkNCiNkZWZpbmUgY2xvY2tfc2V0dGlt
ZSh4LHkpIHN5c2NhbGwoX19OUl9jbG9ja19zZXR0aW1lLCB4LCB5KQ0KDQp2
b2lkIHByKGludCBjbG9jayxjb25zdCBjaGFyICpuKQ0Kew0KCXN0cnVjdCB0
aW1lc3BlYyB0diA9IHsxLDJ9Ow0KCXN0cnVjdCB0aW1lc3BlYyByZXMgPSB7
Myw0fTsNCglpbnQgcmM7DQoNCg0KCXJjPWNsb2NrX2dldHJlcyhjbG9jaywm
cmVzKTsNCglpZiAocmMpIHsNCgkJcHJpbnRmKCJnZXRyZXMgcmV0dXJuIGNv
ZGUgb24gJXM9JWQgZXJybm89JWRcbiIsbixyYyxlcnJubyk7DQoJfQ0KCXJj
PWNsb2NrX2dldHRpbWUoY2xvY2ssJnR2KTsNCglpZiAocmMpIHsNCgkJcHJp
bnRmKCJnZXR0aW1lIHJldHVybiBjb2RlIG9uICVzPSVkIGVycm5vPSVkXG4i
LG4scmMsIGVycm5vKTsNCgl9IA0KCWVsc2UgDQoJcHJpbnRmKCIlMjVzPSUg
MTFkLiUwOWQgcmVzb2x1dGlvbj0lIDJkLiUwOWRcbiIsbix0di50dl9zZWMs
dHYudHZfbnNlYyxyZXMudHZfc2VjLHJlcy50dl9uc2VjKTsNCn0NCg0KaW50
IHk7DQoNCnZvaWQga3gobG9uZyBsb25nIHgpIHsNCgl5PXg7DQp9Ow0KDQpz
dHJ1Y3QgdGltZXNwZWMgemVybzsNCg0KcHRocmVhZF90IHRocmVhZFsxMF07
DQoNCnN0cnVjdCB0aW5mbyB7DQoJaW50IGk7DQoJc3RydWN0IHRpbWVzcGVj
IHR0aW1lLHB0aW1lOw0KfSB0aW5mWzEwXTsNCg0Kdm9pZCAqdGhyZWFkX2Z1
bmN0aW9uKHZvaWQgKngpIHsNCglzdHJ1Y3QgdGluZm8gKnQ9eDsNCglpbnQg
aTsNCgkNCglmb3IoaT0xO2k8IHQtPmk7aSsrKSBreCgxMDAwMDAwMDAwMDAw
TEwvaSk7DQoJY2xvY2tfZ2V0dGltZShDTE9DS19USFJFQURfQ1BVVElNRV9J
RCwmdC0+dHRpbWUpOw0KCWNsb2NrX2dldHRpbWUoQ0xPQ0tfUFJPQ0VTU19D
UFVUSU1FX0lELCZ0LT5wdGltZSk7DQp9DQoNCmludCBtYWluKGNoYXIgYXJn
YywgY2hhciAqYXJndltdKQ0Kew0KCXN0cnVjdCB0aW1lc3BlYyB0djsNCglp
bnQgaTsNCg0KCS8qIFdhc3RlIHNvbWUgdGltZSAqLw0KCXByaW50ZigiU2lu
Z2xlIFRocmVhZCBUZXN0aW5nXG4iKTsNCgkNCglmb3IoaT0xO2k8MTAwMDAw
MDA7aSsrKSBreCgxMDAwMDAwMDAwMDAwTEwvaSk7DQoJcHIoQ0xPQ0tfVEhS
RUFEX0NQVVRJTUVfSUQsIkNMT0NLX1RIUkVBRF9DUFVUSU1FX0lEIik7DQoJ
cHIoQ0xPQ0tfUFJPQ0VTU19DUFVUSU1FX0lELCJDTE9DS19QUk9DRVNTX0NQ
VVRJTUVfSUQiKTsNCgkvKiBXYXN0ZSBzb21lIG1vcmUgdGltZSBpbiB0aHJl
YWRzICovDQoJcHJpbnRmKCJNdWx0aSBUaHJlYWQgVGVzdGluZ1xuU3RhcnRp
bmcgVGhyZWFkOiIpOw0KCWNsb2NrX3NldHRpbWUoQ0xPQ0tfUFJPQ0VTU19D
UFVUSU1FX0lELCZ6ZXJvKTsNCglmb3IoaT0wO2k8MTA7aSsrKSB7DQoJCXRp
bmZbaV0uaT1pKjEwMDAwMDA7DQoJCWlmIChwdGhyZWFkX2NyZWF0ZSgmdGhy
ZWFkW2ldLCBOVUxMLCB0aHJlYWRfZnVuY3Rpb24sIHRpbmYraSkpDQoJCQlw
ZXJyb3IoInRocmVhZCIpOw0KCQllbHNlDQoJCQlwcmludGYoIiAlZCIsaSk7
DQoJfQ0KCXByaW50ZigiXG4gSm9pbmluZyBUaHJlYWQ6Iik7DQoJZm9yKGk9
MDtpPDEwO2krKykgaWYgKHB0aHJlYWRfam9pbiggdGhyZWFkW2ldLCBOVUxM
KSkgcGVycm9yKCJqb2luIik7IGVsc2UgcHJpbnRmKCIgJWQiLGkpOw0KCXBy
aW50ZigiXG4iKTsNCglmb3IoaT0wO2k8MTA7aSsrKSB7DQoJCXByaW50Zigi
JWQgQ3ljbGVzPSU3ZCBUaHJlYWQ9JSAzZC4lMDlkbnMgUHJvY2Vzcz0lIDNk
LiUwOWRuc1xuIixpLHRpbmZbaV0uaSx0aW5mW2ldLnR0aW1lLnR2X3NlYyx0
aW5mW2ldLnR0aW1lLnR2X25zZWMsdGluZltpXS5wdGltZS50dl9zZWMsdGlu
ZltpXS5wdGltZS50dl9uc2VjKTsNCgl9CQ0KCWdldHRpbWVvZmRheSgoc3Ry
dWN0IHRpbWV2YWwgKikmdHYpOw0KCXR2LnR2X25zZWMgPSB0di50dl9uc2Vj
KjEwMDA7DQoJcHJpbnRmKCJcbkNsb2NrIHN0YXR1cyBhdCB0aGUgZW5kIG9m
IHRoZSB0aW1lciB0ZXN0czpcbiIpOw0KCXByaW50ZigiICAgICAgICAgIEdl
dHRpbWVvZmRheSgpID0lIDExZC4lMDlkXG4iLHR2LnR2X3NlYyx0di50dl9u
c2VjKTsNCglwcihDTE9DS19SRUFMVElNRSwiQ0xPQ0tfUkVBTFRJTUUiKTsN
CglwcihDTE9DS19NT05PVE9OSUMsIkNMT0NLX01PTk9UT05JQyIpOw0KCXBy
KENMT0NLX1BST0NFU1NfQ1BVVElNRV9JRCwiQ0xPQ0tfUFJPQ0VTU19DUFVU
SU1FX0lEIik7DQoJcHIoQ0xPQ0tfVEhSRUFEX0NQVVRJTUVfSUQsIkNMT0NL
X1RIUkVBRF9DUFVUSU1FX0lEIik7DQoJcHJpbnRmKCJcbiIpOw0KfQ0K

---1700579579-76263974-1096486329=:25905--
