Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266659AbUAWVJu (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 23 Jan 2004 16:09:50 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266667AbUAWVJu
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 23 Jan 2004 16:09:50 -0500
Received: from twilight.ucw.cz ([81.30.235.3]:8590 "EHLO midnight.ucw.cz")
	by vger.kernel.org with ESMTP id S266659AbUAWVJr (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 23 Jan 2004 16:09:47 -0500
Date: Fri, 23 Jan 2004 22:09:53 +0100
From: Vojtech Pavlik <vojtech@suse.cz>
To: "P. Christeas" <p_christ@hol.gr>
Cc: lkml <linux-kernel@vger.kernel.org>
Subject: Re: atkbd w 2.6.2rc1 : HowTo for extra (inet) keys ?
Message-ID: <20040123210953.GA12647@ucw.cz>
References: <200401232204.27819.p_christ@hol.gr>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200401232204.27819.p_christ@hol.gr>
User-Agent: Mutt/1.4.1i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, Jan 23, 2004 at 10:04:27PM +0200, P. Christeas wrote:
> Hello again.
> I just reverted my atkbd.c code to your version (Linus's tree) and 
> unfortunately have 4 keys 'missing' from my HP Omnibook XE3GC extra "internet 
> keys".
> Question 1: Can I fix the table from userland, using some utility? That is, 
> can I upload an updated table into the kernel, so that I don't have to 
> reboot?

'setkeycodes' can do that.

> Q 2: Do you have any HowTo/QA for that?

Not yet, but I'll have to write one.

> Q 3: Will that work under X? (which AFAIK reads the 'raw' codes)

X needs to be set up as well. In 2.6, X doesn't get real raw codes but
instead simulated raw codes generated by the kernel.

> Q 4: It has been rather difficult for me to compute the scancodes needed for 
> the table. Could you put the "formula" onto the HowTo?

> FYI, the codes are:
> "www": Unknown key pressed (translated set 2, code 0xf3 on isa0060/serio0).
> "Mail":  Unknown key pressed (translated set 2, code 0xf4 on isa0060/serio0).
> "Launch": Unknown key pressed (translated set 2, code 0xf2 on isa0060/serio0).
> "Help":  Unknown key pressed (translated set 2, code 0xf1 on isa0060/serio0).

The formula for setkeycodes is:

if (code > 0x100)
	you're out of luck, setkeycodes doesn't handle this yet;
else if (code > 0x80)
	result = code - 0x80 + 0xe000;
else
	result = code;

And then you use 'setkeycodes result keycode',

where keycode you find in include/linux/input.h.

-- 
Vojtech Pavlik
SuSE Labs, SuSE CR
