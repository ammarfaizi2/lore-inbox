Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S130384AbRCLO5f>; Mon, 12 Mar 2001 09:57:35 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S130435AbRCLO5Z>; Mon, 12 Mar 2001 09:57:25 -0500
Received: from pat.uio.no ([129.240.130.16]:15336 "EHLO pat.uio.no")
	by vger.kernel.org with ESMTP id <S130384AbRCLO5O>;
	Mon, 12 Mar 2001 09:57:14 -0500
Message-ID: <15020.58260.471102.944034@charged.uio.no>
Date: Mon, 12 Mar 2001 15:56:20 +0100 (CET)
To: Chris Jensen <dr_spirograph@technologist.com>
Cc: NFS maillist <nfs@lists.sourceforge.net>,
        Linux Kernel <linux-kernel@vger.kernel.org>
Subject: Re: [NFS] New files on read only NFS mount
In-Reply-To: <001601c0ab02$df976860$0100a8c0@chris>
In-Reply-To: <001a01c0aac0$80432260$0100a8c0@chris>
	<shs8zmbksxo.fsf@charged.uio.no>
	<001601c0ab02$df976860$0100a8c0@chris>
X-Mailer: VM 6.75 under 21.1 (patch 14) "Cuyahoga Valley" XEmacs Lucid
Reply-To: trond.myklebust@fys.uio.no
From: Trond Myklebust <trond.myklebust@fys.uio.no>
Mime-Version: 1.0 (generated by tm-edit 1.7)
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

>>>>> " " == Chris Jensen <christopher.jensen@studentmail.newcastle.edu.au> writes:

    >> Details please, the minimum info required being 'which kernel
    >> is your client running'?
    >>

     > Oh yeah, whoops, sorry The server is a 586 and the client is
     > 686.  They're both using nfs-utils 0.2.1, under linux 2.4.0
     > with NFS v3 enabled, with glibc 2.2.1 The pertinent line in
     > /etc/exports is / 192.168.0.1(rw,no_root_squash)

How does the following patch work out?

Cheers,
  Trond

--- fs/nfs/dir.c.orig	Fri Feb  9 20:29:44 2001
+++ fs/nfs/dir.c	Mon Mar 12 15:54:14 2001
@@ -1097,6 +1097,10 @@
 
 	if (!NFS_PROTO(inode)->access)
 		goto out;
+
+	if (error == -EROFS)
+		goto out;
+
 	/*
 	 * Trust UNIX mode bits except:
 	 *



