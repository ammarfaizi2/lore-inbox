Return-Path: <linux-kernel-owner+willy=40w.ods.org-S268482AbUIQB3d@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S268482AbUIQB3d (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 16 Sep 2004 21:29:33 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S268483AbUIQB3c
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 16 Sep 2004 21:29:32 -0400
Received: from tama5.ecl.ntt.co.jp ([129.60.39.102]:56232 "EHLO
	tama5.ecl.ntt.co.jp") by vger.kernel.org with ESMTP id S268482AbUIQB1v
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 16 Sep 2004 21:27:51 -0400
Date: Fri, 17 Sep 2004 10:27:25 +0900
Message-ID: <uisadr8g2.wl%kihara.seiji@lab.ntt.co.jp>
From: Seiji Kihara <kihara.seiji@lab.ntt.co.jp>
To: Andrew Morton <akpm@osdl.org>
Cc: sct@redhat.com, adilger@clusterfs.com, ext3-users@redhat.com,
       linux-fsdevel@vger.kernel.org, linux-kernel@vger.kernel.org,
       ospfs@lab.ntt.co.jp
Subject: Re: [PATCH] BUG on fsync/fdatasync with Ext3 data=journal
In-Reply-To: <20040916145059.44a7e800.akpm@osdl.org>
References: <ufz5i5q4r.wl%kihara.seiji@lab.ntt.co.jp>
	<20040916145059.44a7e800.akpm@osdl.org>
User-Agent: Wanderlust/2.11.22 (Wonderwall) Emacs/21.1 Mule/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi, 

Thank you for reply, Mr. Morton.  I apologize to everyone that the
mail I sent last night was not delivered to lists because of its
size (maybe).

At Thu, 16 Sep 2004 14:50:59 -0700,
Andrew Morton wrote:
(snip)
> Yes, the I_DIRTY test is bogus because data pages are not marked dirty at
> write() time when the filesystem is mounted in data=journal mode.
> 
> However your patch will disable the above optimisation for data=writeback
> and data-ordered modes as well.  I don't think that's necessary?
> 
> How about this?

I have not understood what is the real problem yet, but I agree
that your patch is better than mine, and confirmed that no problem
occured during the test by the "diskio" and the kernel 2.6.8.1
with your patch.

Thank you again.

Seiji

-- 
Seiji Kihara
Open Source Software Computing Project,
NTT Cyber Space Laboratories, Yokosuka, JAPAN
