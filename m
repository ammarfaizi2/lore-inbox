Return-Path: <linux-kernel-owner+w=401wt.eu-S1752037AbWLSLHF@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1752037AbWLSLHF (ORCPT <rfc822;w@1wt.eu>);
	Tue, 19 Dec 2006 06:07:05 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751813AbWLSLHE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 19 Dec 2006 06:07:04 -0500
Received: from cantor2.suse.de ([195.135.220.15]:57481 "EHLO mx2.suse.de"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1752037AbWLSLHD (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Tue, 19 Dec 2006 06:07:03 -0500
Date: Tue, 19 Dec 2006 12:06:57 +0100
Message-ID: <s5htzzsdu0e.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Adrian Bunk <bunk@stusta.de>
Cc: perex@suse.cz, alsa-devel@alsa-project.org, linux-kernel@vger.kernel.org
Subject: Re: [Alsa-devel] [RFC: 2.6 patch] sound/: possible cleanups
In-Reply-To: <20061218034639.GC10316@stusta.de>
References: <20061218034639.GC10316@stusta.de>
User-Agent: Wanderlust/2.12.0 (Your Wildest Dreams) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.7 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 MULE XEmacs/21.5 (beta27)
 (fiddleheads) (+CVS-20060704) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 18 Dec 2006 04:46:39 +0100,
Adrian Bunk wrote:
> 
> --- linux-2.6.19-rc6-mm2/sound/pci/hda/hda_codec.h.old	2006-12-04 17:03:15.000000000 +0100
> +++ linux-2.6.19-rc6-mm2/sound/pci/hda/hda_codec.h	2006-12-04 17:03:23.000000000 +0100
> @@ -614,10 +614,6 @@
>  				int channel_id, int format);
>  unsigned int snd_hda_calc_stream_format(unsigned int rate, unsigned int channels,
>  					unsigned int format, unsigned int maxbps);
> -int snd_hda_query_supported_pcm(struct hda_codec *codec, hda_nid_t nid,
> -				u32 *ratesp, u64 *formatsp, unsigned int *bpsp);
> -int snd_hda_is_supported_format(struct hda_codec *codec, hda_nid_t nid,
> -				unsigned int format);

I'd like to keep them usable for codec support codes.
Removing EXPORT_SYMBOL() is fine, though.

> --- linux-2.6.19-rc6-mm2/sound/pci/ac97/ac97_local.h.old	2006-12-04 16:53:59.000000000 +0100
> +++ linux-2.6.19-rc6-mm2/sound/pci/ac97/ac97_local.h	2006-12-04 16:54:52.000000000 +0100
> @@ -65,9 +65,6 @@
>  int snd_ac97_get_volsw(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol);
>  int snd_ac97_put_volsw(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol);
>  int snd_ac97_try_bit(struct snd_ac97 * ac97, int reg, int bit);
> -int snd_ac97_remove_ctl(struct snd_ac97 *ac97, const char *name, const char *suffix);
> -int snd_ac97_rename_ctl(struct snd_ac97 *ac97, const char *src, const char *dst, const char *suffix);
> -int snd_ac97_swap_ctl(struct snd_ac97 *ac97, const char *s1, const char *s2, const char *suffix);

These are used in ac97_patch.c, at least in pending patches after
2.6.19.

> --- linux-2.6.19-rc6-mm2/include/sound/core.h.old	2006-12-04 17:13:39.000000000 +0100
> +++ linux-2.6.19-rc6-mm2/include/sound/core.h	2006-12-04 17:49:07.000000000 +0100
> @@ -22,6 +22,7 @@
>   *
>   */
>  
> +#include <sound/driver.h>

This makes things a bit complicated, so please don't add it yet.
It's better to clean up into a single core.h in future.

> @@ -35,6 +36,7 @@
>  #ifdef CONFIG_SBUS
>  struct sbus_dev;
>  #endif
> +struct snd_info_buffer;
>  
>  /* device allocation stuff */
>  
> @@ -287,6 +289,8 @@
>  int snd_card_file_add(struct snd_card *card, struct file *file);
>  int snd_card_file_remove(struct snd_card *card, struct file *file);
>  
> +void snd_card_info_read_oss(struct snd_info_buffer *buffer);
> +
>  #ifndef snd_card_set_dev
>  #define snd_card_set_dev(card,devptr) ((card)->parent = (devptr))
>  #endif

These should be rather in another file, e.g. info.h.

> --- linux-2.6.19-rc6-mm2/Documentation/sound/alsa/DocBook/writing-an-alsa-driver.tmpl.old	2006-12-04 17:17:34.000000000 +0100
> +++ linux-2.6.19-rc6-mm2/Documentation/sound/alsa/DocBook/writing-an-alsa-driver.tmpl	2006-12-04 17:18:34.000000000 +0100
> @@ -5648,8 +5648,7 @@
>      <para>
>  	As shown in the above, it's better to save registers after
>  	suspending the PCM operations via
> -	<function>snd_pcm_suspend_all()</function> or
> -	<function>snd_pcm_suspend()</function>.  It means that the PCM
> +	<function>snd_pcm_suspend_all()</function>.  It means that the PCM
>  	streams are already stoppped when the register snapshot is
>  	taken.  But, remind that you don't have to restart the PCM
>  	stream in the resume callback. It'll be restarted via 
> --- linux-2.6.19-rc6-mm2/include/sound/pcm.h.old	2006-12-04 17:14:50.000000000 +0100
> +++ linux-2.6.19-rc6-mm2/include/sound/pcm.h	2006-12-04 17:20:10.000000000 +0100
> @@ -467,10 +467,7 @@
>  int snd_pcm_start(struct snd_pcm_substream *substream);
>  int snd_pcm_stop(struct snd_pcm_substream *substream, int status);
>  int snd_pcm_drain_done(struct snd_pcm_substream *substream);
> -#ifdef CONFIG_PM
> -int snd_pcm_suspend(struct snd_pcm_substream *substream);
>  int snd_pcm_suspend_all(struct snd_pcm *pcm);
> -#endif
>  int snd_pcm_kernel_ioctl(struct snd_pcm_substream *substream, unsigned int cmd, void *arg);
>  int snd_pcm_open_substream(struct snd_pcm *pcm, int stream, struct file *file,
>  			   struct snd_pcm_substream **rsubstream);

I tend to disagree this removal.


thanks,

Takashi
