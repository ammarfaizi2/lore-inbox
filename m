Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1750781AbWGKNnw@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1750781AbWGKNnw (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 11 Jul 2006 09:43:52 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1750783AbWGKNnw
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 11 Jul 2006 09:43:52 -0400
Received: from mail.timesys.com ([65.117.135.102]:11727 "EHLO
	postfix.timesys.com") by vger.kernel.org with ESMTP
	id S1750781AbWGKNnv (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Tue, 11 Jul 2006 09:43:51 -0400
Date: Tue, 11 Jul 2006 15:46:53 +0200
Message-ID: <87y7v0tfsi.wl%tglx@linutronix.de>
From: Thomas Gleixner <tglx@linutronix.de>
To: Luca Tettamanti <kronos.it@gmail.com>
Cc: linux-kernel@vger.kernel.org, Ingo Molnar <mingo@redhat.com>,
       Andrew Morton <akpm@osdl.org>
Subject: Re: [PATCH] Add try_to_freeze() to rt-test kthreads
In-Reply-To: <20060709131955.GA24459@dreamland.darkstar.lan>
References: <20060709131955.GA24459@dreamland.darkstar.lan>
User-Agent: Wanderlust/2.15.1 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.7 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 Emacs/21.4
 (x86_64-pc-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Sun, 9 Jul 2006 15:19:55 +0200, Luca Tettamanti wrote:
> 
> Hi,
> I'm running kernel 2.6.18-rc1. When CONFIG_RT_MUTEX_TESTER is enabled
> kernel refuses to suspend the machine because it's unable to freeze the
> rt-test-* threads. This patch adds try_to_freeze() after schedule() so
> that the threads will be freezed correctly; I've tested the patch and it
> lets the notebook suspends and resumes nicely.
> 
> Signed-off-by: Luca Tettamanti <kronos.it@gmail.com>

Acked-by: Thomas Gleixner <tglx@linutronix.de>
 
> --- a/kernel/rtmutex-tester.c	2006-07-09 15:15:08.540456698 +0200
> +++ b/kernel/rtmutex-tester.c	2006-07-09 14:39:26.653218497 +0200
> @@ -275,6 +275,7 @@
>  
>  		/* Wait for the next command to be executed */
>  		schedule();
> +		try_to_freeze();
>  
>  		if (signal_pending(current))
>  			flush_signals(current);
> 
> 
> Luca
