Return-Path: <linux-kernel-owner+willy=40w.ods.org-S264717AbUGMIKV@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264717AbUGMIKV (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 13 Jul 2004 04:10:21 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264882AbUGMIKV
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 13 Jul 2004 04:10:21 -0400
Received: from cantor.suse.de ([195.135.220.2]:50561 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S264717AbUGMIH0 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 13 Jul 2004 04:07:26 -0400
Date: Tue, 13 Jul 2004 10:07:21 +0200
Message-ID: <s5hhdscba9y.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Andrew Morton <akpm@osdl.org>
Cc: Lee Revell <rlrevell@joe-job.com>, linux-audio-dev@music.columbia.edu,
       mingo@elte.hu, arjanv@redhat.com, linux-kernel@vger.kernel.org
Subject: Re: [linux-audio-dev] Re: [announce] [patch] Voluntary Kernel Preemption Patch
In-Reply-To: <20040712174639.38c7cf48.akpm@osdl.org>
References: <20040709182638.GA11310@elte.hu>
	<20040710222510.0593f4a4.akpm@osdl.org>
	<1089673014.10777.42.camel@mindpipe>
	<20040712163141.31ef1ad6.akpm@osdl.org>
	<1089677823.10777.64.camel@mindpipe>
	<20040712174639.38c7cf48.akpm@osdl.org>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 12 Jul 2004 17:46:39 -0700,
Andrew Morton wrote:
> 
> Lee Revell <rlrevell@joe-job.com> wrote:
> >
> > > resierfs: yes, it's a problem.  I "fixed" it multiple times in 2.4, but the
> >  > fixes ended up breaking the fs in subtle ways and I eventually gave up.
> >  > 
> > 
> >  Interesting.  There is an overwhelming consensus amongst Linux audio
> >  folks that you should use reiserfs for low latency work.
> 
> It seems to be misplaced.  A simple make-a-zillion-teeny-files test here
> exhibits a 14 millisecond holdoff.

Yes, I measured a similar on reiserfs, too.
Creation and deletion of many small files causes high latencies.

The creation latency appears with ext3, too, but vanishes when
preemption is enabled.

The deletion peaks appear on all systems.  It's in the long loop of
shrink_dcache_parent().

IIRC, the RCU tasklet stall was another cause of latency in some very
heavy cases.


But, except for creation/deletion of zillon-files, I've not seen any
big latencies during my tests with reiserfs.  Reading/writing big
files (a few GB) are totally OK on reiserfs, all under 1.5 ms.


Takashi
