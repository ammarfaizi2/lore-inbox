Return-Path: <linux-kernel-owner+willy=40w.ods.org-S268279AbUIPQhL@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S268279AbUIPQhL (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 16 Sep 2004 12:37:11 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S268229AbUIPQf1
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 16 Sep 2004 12:35:27 -0400
Received: from cantor.suse.de ([195.135.220.2]:19178 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S268274AbUIPQaL (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Thu, 16 Sep 2004 12:30:11 -0400
Date: Thu, 16 Sep 2004 18:29:23 +0200
Message-ID: <s5h8yba2n4s.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: ncunningham@linuxmail.org
Cc: Andrew Morton <akpm@digeo.com>,
       Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: Re: [PATCH]: Suspend2 Merge: Device driver fixes 2/2
In-Reply-To: <1095331535.3324.135.camel@laptop.cunninghams>
References: <1095331535.3324.135.camel@laptop.cunninghams>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


[Mistakenly posted to alsa-devel, now resent to the correct addreses]

At Thu, 16 Sep 2004 20:45:36 +1000,
Nigel Cunningham wrote:
> 
> -----Forwarded Message-----
> > From: Bernard Blackham <bernard@blackham.com.au>
> > To: Michael Frank <mhf@linuxmail.org>
> > Cc: softwaresuspend-devel@lists.berlios.de
> > Subject: Re: [SoftwareSuspend-devel] ALSA ali5451 and sis PM fundamentally broken?
> > Date: Sun, 08 Aug 2004 22:33:54 +0800
> > 
> > On Fri, Jul 16, 2004 at 01:24:09PM +0800, Michael Frank wrote:
> > > Built the current Gentoo ALSA package 1.05a on 2.4.24.
> > > 
> > > On ali5451 it is difficult to get the driver to work
> > > at all - takes several loads. Does not survive suspend.
> > 
> > With the latest 2.6.7 and swsusp 2.0.0.103, my sound card's
> > (ali5451) suspend/resume began eratticaly failing again. So I
> > started tinkering some more, and I've come up with this patch (in
> > addition to the one liner already in 2.0.0.103-for-2.6.7) that makes
> > sound reliably suspend and resume every time *and* playback is not
> > interrupted! :)
> > 
> > The line "snd_pcm_suspend_all(chip->pcm)" was the culprit for
> > stopping playback and requiring it to be restarted. It seems common
> > to some other alsa drivers too, so removing it may help with similar
> > problems experienced by others.

No, snd_pcm_suspend_all() must be called.  All PCM streams are
supposed to be moved to SUSPENDED state when the suspend happens.
Keeping other states doesn't guaratee the proper resume process.

The problem of ali5451 driver was that it forgot to call
snd_power_change_state() at the end of suspend callback.
This was already fixed.

So, don't apply this patch, please.


Takashi
