Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262337AbUCSKaW (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 19 Mar 2004 05:30:22 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262456AbUCSKaW
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 19 Mar 2004 05:30:22 -0500
Received: from ns.suse.de ([195.135.220.2]:56803 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S262337AbUCSKaR (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 19 Mar 2004 05:30:17 -0500
Date: Fri, 19 Mar 2004 11:30:16 +0100
Message-ID: <s5hznadb03r.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Andrew Morton <akpm@osdl.org>
Cc: andrea@suse.de, mjy@geizhals.at, linux-kernel@vger.kernel.org,
       Dipankar Sarma <dipankar@in.ibm.com>
Subject: Re: CONFIG_PREEMPT and server workloads
In-Reply-To: <20040318221006.74246648.akpm@osdl.org>
References: <40591EC1.1060204@geizhals.at>
	<20040318060358.GC29530@dualathlon.random>
	<s5hlllycgz3.wl@alsa2.suse.de>
	<20040318110159.321754d8.akpm@osdl.org>
	<s5hbrmuc6ed.wl@alsa2.suse.de>
	<20040318221006.74246648.akpm@osdl.org>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Thu, 18 Mar 2004 22:10:06 -0800,
Andrew Morton wrote:
> 
> Takashi Iwai <tiwai@suse.de> wrote:
> >
> > BTW, i had the worst latency in sis900's timer handler.
> >  it takes 3ms, and hard to fix, too :-<
> 
> It's all coming back to me now.
> 
> The worst-case latency is during umount, fs/inode.c:invalidate_list() when
> the filesystem has a zillion inodes in icache.  Measured 250 milliseconds
> on a 256MB 2.7GHz P4 here.   OK, so don't do that.
 
also that's not included in my test case :)

> The unavoidable worst case is in the RCU callbacks for dcache shrinkage -
> I've seen 25 millisecond holdoffs on the above machine during filesystem
> stresstests when RCU is freeing a huge number of dentries in softirq
> context.

hmm, this wasn't also evaluated in my tests.
it's worthy to try.  thanks for the info.

> This if Hard To Fix.  Dipankar spent quite some time looking into it and
> had patches, but I lost track of where they're at.

couldn't this tasklet be replaced with workqueue or such?


Takashi
