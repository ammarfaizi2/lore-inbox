Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S313605AbSDHMoB>; Mon, 8 Apr 2002 08:44:01 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S313603AbSDHMoA>; Mon, 8 Apr 2002 08:44:00 -0400
Received: from dell-paw-3.cambridge.redhat.com ([195.224.55.237]:40700 "HELO
	executor.cambridge.redhat.com") by vger.kernel.org with SMTP
	id <S313602AbSDHMn7>; Mon, 8 Apr 2002 08:43:59 -0400
To: torvalds@transmeta.com
Cc: linux-kernel@vger.kernel.org, Andrew Morton <akpm@zip.com.au>,
        jfs-discussion@www-126.southbury.usf.ibm.com
Subject: [PATCH] rw-semaphore asm constraints patch fix
User-Agent: EMH/1.14.1 SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.1
 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Date: Mon, 08 Apr 2002 13:43:58 +0100
Message-ID: <26894.1018269838@warthog.cambridge.redhat.com>
From: David Howells <dhowells@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Linus,

The attached patch should fix the compile error that asm-i386/rwsem.h causes
with old gcc's whilst maintaining the asm constraints correctly.

David

diff -Nru a/include/asm-i386/rwsem.h b/include/asm-i386/rwsem.h
--- a/include/asm-i386/rwsem.h	Fri Apr  5 16:56:35 2002
+++ b/include/asm-i386/rwsem.h	Fri Apr  5 16:56:35 2002
@@ -164,7 +164,7 @@
 		"  jmp       1b\n"
 		LOCK_SECTION_END
 		"# ending __up_read\n"
-		: /*"+m"(sem->count),*/ "+d"(tmp)
-		: "a"(sem)
+		: "=m"(sem->count), "=d"(tmp)
+		: "0"(sem->count), "1"(tmp), "a"(sem)
 		: "memory", "cc");
 }
