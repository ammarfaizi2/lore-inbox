Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S315870AbSFYTTx>; Tue, 25 Jun 2002 15:19:53 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S315856AbSFYTSv>; Tue, 25 Jun 2002 15:18:51 -0400
Received: from mion.elka.pw.edu.pl ([194.29.160.35]:651 "EHLO
	mion.elka.pw.edu.pl") by vger.kernel.org with ESMTP
	id <S315806AbSFYTRU>; Tue, 25 Jun 2002 15:17:20 -0400
Date: Tue, 25 Jun 2002 21:17:05 +0200 (MET DST)
From: Bartlomiej Zolnierkiewicz <B.Zolnierkiewicz@elka.pw.edu.pl>
To: Martin Dalecki <dalecki@evision-ventures.com>
cc: Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: [PATCH] 2.5.24: generic ATA PCI auto-dma tuning (5/5)
Message-ID: <Pine.SOL.4.30.0206252116210.27820-200000@mion.elka.pw.edu.pl>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-33463914-1025032625=:27820"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---559023410-33463914-1025032625=:27820
Content-Type: TEXT/PLAIN; charset=US-ASCII


	- split config_chipset_for_dma() in pdc202xx.c to
	  pdc202xx_udma_setup() and pdc202xx_tx_udma_setup()

	- convert it8172.c and pdc202xx.c to new scheme

--
Bartlomiej Zolnierkiewicz

---559023410-33463914-1025032625=:27820
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="ata-hosts-11.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.SOL.4.30.0206252117050.27820@mion.elka.pw.edu.pl>
Content-Description: 
Content-Disposition: attachment; filename="ata-hosts-11.diff"

ZGlmZiAtdXIgbGludXgtYXRhLWhvc3RzLTEwL2RyaXZlcnMvaWRlL2l0ODE3
Mi5jIGxpbnV4L2RyaXZlcnMvaWRlL2l0ODE3Mi5jDQotLS0gbGludXgtYXRh
LWhvc3RzLTEwL2RyaXZlcnMvaWRlL2l0ODE3Mi5jCU1vbiBKdW4gMjQgMjI6
MTU6MTggMjAwMg0KKysrIGxpbnV4L2RyaXZlcnMvaWRlL2l0ODE3Mi5jCU1v
biBKdW4gMjQgMjI6NDU6MjAgMjAwMg0KQEAgLTE3OSwxNCArMTc5LDYgQEAN
CiANCiAJcmV0dXJuIGlkZV9jb25maWdfZHJpdmVfc3BlZWQoZHJpdmUsIHNw
ZWVkKTsNCiB9DQotDQotc3RhdGljIGludCBpdDgxNzJfdWRtYV9zZXR1cChz
dHJ1Y3QgYXRhX2RldmljZSAqZHJpdmUpDQotew0KLQl1OCBzcGVlZCA9IGF0
YV90aW1pbmdfbW9kZShkcml2ZSwgWEZFUl9QSU8gfCBYRkVSX0VQSU8gfA0K
LQkJCQkgICBYRkVSX1NXRE1BIHwgWEZFUl9NV0RNQSB8IFhGRVJfVURNQSk7
DQotDQotCXJldHVybiAhaXQ4MTcyX3R1bmVfY2hpcHNldChkcml2ZSwgc3Bl
ZWQpOw0KLX0NCiAjZW5kaWYgLyogZGVmaW5lZChDT05GSUdfQkxLX0RFVl9J
REVETUEpICYmIChDT05GSUdfSVQ4MTcyX1RVTklORykgKi8NCiANCiANCkBA
IC0yMjEsNiArMjEzLDggQEANCiAjZWxzZSAvKiBDT05GSUdfQkxLX0RFVl9J
REVETUEgKi8NCiAjIGlmZGVmIENPTkZJR19JVDgxNzJfVFVOSU5HDQogICAg
IGh3aWYtPmF1dG9kbWEgPSAxOw0KKwlod2lmLT5tb2Rlc19tYXAgPSBYRkVS
X0VQSU8gfCBYRkVSX1NXRE1BIHwgWEZFUl9NV0RNQSB8IFhGRVJfVURNQTsN
CisJaHdpZi0+dWRtYV9zZXR1cCA9IHVkbWFfZ2VuZXJpY19zZXR1cDsNCiAg
ICAgaHdpZi0+ZG1hcHJvYyA9ICZpdDgxNzJfZG1hcHJvYzsNCiAgICAgaHdp
Zi0+c3BlZWRwcm9jID0gJml0ODE3Ml90dW5lX2NoaXBzZXQ7DQogIyBlbmRp
Zg0KZGlmZiAtdXIgbGludXgtYXRhLWhvc3RzLTEwL2RyaXZlcnMvaWRlL3Bk
YzIwMnh4LmMgbGludXgvZHJpdmVycy9pZGUvcGRjMjAyeHguYw0KLS0tIGxp
bnV4LWF0YS1ob3N0cy0xMC9kcml2ZXJzL2lkZS9wZGMyMDJ4eC5jCU1vbiBK
dW4gMjQgMjI6NDA6NDAgMjAwMg0KKysrIGxpbnV4L2RyaXZlcnMvaWRlL3Bk
YzIwMnh4LmMJTW9uIEp1biAyNCAyMjo0NDozOCAyMDAyDQpAQCAtMTMxLDcg
KzEzMSw3IEBADQogDQogc3RhdGljIGludCBfX2luaXQgcGRjMjAyeHhfbW9k
ZXNfbWFwKHN0cnVjdCBhdGFfY2hhbm5lbCAqY2gpDQogew0KLQlpbnQgbWFw
ID0gWEZFUl9FUElPIHwgWEZFUl9TV0RNQSB8IFhGRVJfTVdETUE7DQorCWlu
dCBtYXAgPSBYRkVSX0VQSU8gfCBYRkVSX1NXRE1BIHwgWEZFUl9NV0RNQSB8
IFhGRVJfVURNQTsNCiANCiAJc3dpdGNoKGNoLT5wY2lfZGV2LT5kZXZpY2Up
IHsNCiAJCWNhc2UgUENJX0RFVklDRV9JRF9QUk9NSVNFXzIwMjc2Og0KQEAg
LTE0Niw4ICsxNDYsMTEgQEANCiAJCQltYXAgfD0gWEZFUl9VRE1BXzEwMDsN
CiAJCWNhc2UgUENJX0RFVklDRV9JRF9QUk9NSVNFXzIwMjYyOg0KIAkJCW1h
cCB8PSBYRkVSX1VETUFfNjY7DQotCQljYXNlIFBDSV9ERVZJQ0VfSURfUFJP
TUlTRV8yMDI0NjoNCi0JCQltYXAgfD0gWEZFUl9VRE1BOw0KKw0KKwkJCWlm
ICghY2gtPnVkbWFfZm91cikgew0KKwkJCQlwcmludGsoS0VSTl9XQVJOSU5H
ICIlczogNDAtcGluIGNhYmxlLCBzcGVlZCByZWR1Y2VkIHRvIFVETUEoMzMp
IG1vZGUuXG4iLCBjaC0+bmFtZSk7DQorCQkJCW1hcCAmPSB+WEZFUl9VRE1B
XzgwVzsNCisJCQl9DQogCX0NCiANCiAJcmV0dXJuIG1hcDsNCkBAIC0zNzAs
NDggKzM3MywzNCBAQA0KIH0NCiANCiAjaWZkZWYgQ09ORklHX0JMS19ERVZf
SURFRE1BDQotLyogRklYTUU6IHNwbGl0IHRoaXMgZm9yIG9sZCAmIG5ldyBj
aGlwc2V0cyAoanVtcGJpdCkgLS1ia3ogKi8NCi1zdGF0aWMgaW50IGNvbmZp
Z19jaGlwc2V0X2Zvcl9kbWEoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlLCBi
eXRlIHVkbWEpDQorc3RhdGljIGludCBwZGMyMDJ4eF90eF91ZG1hX3NldHVw
KHN0cnVjdCBhdGFfZGV2aWNlICpkcml2ZSwgaW50IG1hcCkNCit7DQorCXN0
cnVjdCBoZF9kcml2ZWlkICppZCA9IGRyaXZlLT5pZDsNCisJc3RydWN0IGF0
YV9jaGFubmVsICpjaCA9IGRyaXZlLT5jaGFubmVsOw0KKwl1MzIgaW5kZXhy
ZWcgPSBjaC0+ZG1hX2Jhc2UgKyAxOw0KKwl1MzIgZGF0YXJlZyA9IGluZGV4
cmVnICsgMjsNCisJdTggYWRqID0gKGRyaXZlLT5kbiAlIDIpID8gMHgwOCA6
IDB4MDA7DQorDQorCWlmIChkcml2ZS0+dHlwZSAhPSBBVEFfRElTSykNCisJ
CXJldHVybiAwOw0KKw0KKwkvKiBJT1JEWV9FTiAmIFBSRUZFVENIX0VOICov
DQorCWlmIChpZC0+Y2FwYWJpbGl0eSAmIDQpDQorCQlzZXRfMnJlZ3MoMHgx
MywgKElOX0JZVEUoZGF0YXJlZyl8MHgwMykpOw0KKw0KKwlyZXR1cm4gdWRt
YV9nZW5lcmljX3NldHVwKGRyaXZlLCBtYXApOw0KK30NCisNCitzdGF0aWMg
aW50IHBkYzIwMnh4X3VkbWFfc2V0dXAoc3RydWN0IGF0YV9kZXZpY2UgKmRy
aXZlLCBpbnQgbWFwKQ0KIHsNCi0Jc3RydWN0IGhkX2RyaXZlaWQgKmlkCT0g
ZHJpdmUtPmlkOw0KKwlzdHJ1Y3QgaGRfZHJpdmVpZCAqaWQgPSBkcml2ZS0+
aWQ7DQogCXN0cnVjdCBhdGFfY2hhbm5lbCAqaHdpZiA9IGRyaXZlLT5jaGFu
bmVsOw0KIAlzdHJ1Y3QgaGRfZHJpdmVpZCAqbWF0ZV9pZCA9IGh3aWYtPmRy
aXZlc1shKGRyaXZlLT5kbiUyKV0uaWQ7DQotCXN0cnVjdCBwY2lfZGV2ICpk
ZXYJPSBod2lmLT5wY2lfZGV2Ow0KKwlzdHJ1Y3QgcGNpX2RldiAqZGV2ID0g
aHdpZi0+cGNpX2RldjsNCiAJdTMyIGhpZ2hfMTYgPSBwY2lfcmVzb3VyY2Vf
c3RhcnQoZGV2LCA0KTsNCi0JdTMyIGRtYV9iYXNlID0gaHdpZi0+ZG1hX2Jh
c2U7DQotCXUzMiBpbmRleHJlZyA9IGRtYV9iYXNlICsgMTsNCi0JdTMyIGRh
dGFyZWcgPSBkbWFfYmFzZSArIDM7DQotCWJ5dGUgYWRqCQk9IChkcml2ZS0+
ZG4lMikgPyAweDA4IDogMHgwMDsNCi0JdTgganVtcGJpdDsNCiAJdTMyIGRy
aXZlX2NvbmY7DQogCXU4IGRyaXZlX3BjaSA9IDAsIEFQLCB0bXAsIG1vZGUg
PSAtMTsNCiAJdTggQ0xLU1BELCBtYXNrID0gaHdpZi0+dW5pdCA/IDB4MDgg
OiAweDAyOw0KLQlpbnQgbWFwOw0KLQ0KLQkvKiBVRE1BIDMsIDQsIDUgYW5k
IDYgKi8NCi0JdTggbmVlZHNfODB3ID0gKGlkLT5kbWFfdWx0cmEgJiAweDAw
NzgpOw0KLQ0KLQlzd2l0Y2goZGV2LT5kZXZpY2UpIHsNCi0JCWNhc2UgUENJ
X0RFVklDRV9JRF9QUk9NSVNFXzIwMjY3Og0KLQkJY2FzZSBQQ0lfREVWSUNF
X0lEX1BST01JU0VfMjAyNjU6DQotCQljYXNlIFBDSV9ERVZJQ0VfSURfUFJP
TUlTRV8yMDI2MjoNCi0JCWNhc2UgUENJX0RFVklDRV9JRF9QUk9NSVNFXzIw
MjQ2Og0KLQkJCWp1bXBiaXQgPSAwOw0KLQkJCWJyZWFrOw0KLQkJZGVmYXVs
dDogLyogY2hpcHNldHMgbmV3ZXIgdGhlbiAyMDI2NyAqLw0KLQkJCWp1bXBi
aXQgPSAxOw0KLQkJCWJyZWFrOw0KLQl9DQotDQotCS8qIEZJWE1FOiB0aGlz
IGNoZWNrIGlzIHdyb25nIGZvciAyMDI0NiAgLS1ia3ogKi8NCi0JLyogKi8N
Ci0JaWYgKG5lZWRzXzgwdyAmJiAhaHdpZi0+dWRtYV9mb3VyKSB7DQotCQlw
cmludGsoS0VSTl9XQVJOSU5HICIlczogY2hhbm5lbCByZXF1aXJlcyBhbiA4
MC1waW4gY2FibGUuXG4iLCBod2lmLT5uYW1lKTsNCi0JCXByaW50ayhLRVJO
X0lORk8gIiVzOiByZWR1Y2VkIHRvIFVETUEoMzMpIG1vZGUuXG4iLCBkcml2
ZS0+bmFtZSk7DQotCX0NCi0NCi0JaWYgKGp1bXBiaXQpDQotCQlnb3RvIGNo
aXBzZXRfaXNfc2V0Ow0KIA0KIAkvKg0KIAkgKiBTZXQgdGhlIGNvbnRyb2wg
cmVnaXN0ZXIgdG8gdXNlIHRoZSA2Nk1oeiBzeXN0ZW0NCkBAIC00MjUsNyAr
NDE0LDcgQEANCiAJICogRklYTUU6IG1vdmUgdGhpcyB0byBwZGMyMDJ4eF90
dW5lcHJvYygpDQogCSAqICAgICAgICByaWdodCBub3cgeW91IGNhbid0IGRv
d25ncmFkZSBmcm9tIFU2NiB0byBVMzMgIC0tYmt6DQogCSAqLw0KLQlpZiAo
bmVlZHNfODB3KSB7DQorCWlmIChpZC0+ZG1hX3VsdHJhICYgMHgwMDc4KSB7
CS8qIFVETUEgMywgNCwgNSBhbmQgNiAqLw0KIAkJQ0xLU1BEID0gSU5fQllU
RShoaWdoXzE2ICsgUERDX0NMSyk7DQogCQkvKiBjaGVjayBjYWJsZSBhbmQg
bWF0ZSAobXVzdCBiZSBhdCBsZWFzdCB1ZG1hMyBjYXBhYmxlKSAqLw0KIAkJ
aWYgKCFod2lmLT51ZG1hX2ZvdXIgfHwNCkBAIC00NDcsMTIgKzQzNiwxMSBA
QA0KIAkvKiBGSVhNRTogd2hhdCBpZiBTWU5DX0VSUkRZIGlzIGVuYWJsZWQg
Zm9yIHNsYXZlDQogCQkgIGFuZCBkaXNhYmxlZCBmb3IgbWFzdGVyPyAtLWJr
eiAqLw0KIAlwY2lfcmVhZF9jb25maWdfYnl0ZShkZXYsIGRyaXZlX3BjaSwg
JkFQKTsNCisJLyogZW5hYmxlIFNZTkNfRVJSRFkgZm9yIG1hc3RlciBhbmQg
c2xhdmUgKGlmIGVuYWJsZWQgZm9yIG1hc3RlcikgKi8NCiAJaWYgKCEoQVAg
JiBTWU5DX0VSUkRZX0VOKSkgew0KLQkJaWYgKGRyaXZlLT5kbiA9PSAwIHx8
IGRyaXZlLT5kbiA9PSAyKSB7DQotCQkJLyogZW5hYmxlIFNZTkNfRVJSRFkg
Zm9yIG1hc3RlciAqLw0KKwkJaWYgKCEoZHJpdmUtPmRuICUgMikpIHsNCiAJ
CQlwY2lfd3JpdGVfY29uZmlnX2J5dGUoZGV2LCBkcml2ZV9wY2ksIEFQfFNZ
TkNfRVJSRFlfRU4pOw0KIAkJfSBlbHNlIHsNCi0JCQkvKiBlbmFibGUgU1lO
Q19FUlJEWSBmb3Igc2xhdmUgaWYgZW5hYmxlZCBmb3IgbWFzdGVyICovDQog
CQkJcGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBkcml2ZV9wY2kgLSA0LCAm
dG1wKTsNCiAJCQlpZiAodG1wICYgU1lOQ19FUlJEWV9FTikNCiAJCQkJcGNp
X3dyaXRlX2NvbmZpZ19ieXRlKGRldiwgZHJpdmVfcGNpLCBBUHxTWU5DX0VS
UkRZX0VOKTsNCkBAIC00NjQsODQgKzQ1MiwyNiBAQA0KIAlpZiAoZHJpdmUt
PnR5cGUgIT0gQVRBX0RJU0spDQogCQlyZXR1cm4gMDsNCiANCi0JaWYgKGp1
bXBiaXQpIHsNCi0JCWlmIChpZC0+Y2FwYWJpbGl0eSAmIDQpIHsJLyogSU9S
RFlfRU4gJiBQUkVGRVRDSF9FTiAqLw0KLQkJCXNldF8ycmVncygweDEzLCAo
SU5fQllURShkYXRhcmVnKXwweDAzKSk7DQotCQl9DQotCX0gZWxzZSB7DQot
CQlwY2lfcmVhZF9jb25maWdfYnl0ZShkZXYsIGRyaXZlX3BjaSwgJkFQKTsN
Ci0JCWlmIChpZC0+Y2FwYWJpbGl0eSAmIDQpCQkvKiBJT1JEWV9FTiAqLw0K
LQkJCXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYsIGRyaXZlX3BjaSwgQVB8
SU9SRFlfRU4pOw0KLQkJcGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBkcml2
ZV9wY2ksICZBUCk7DQotCQlpZiAoZHJpdmUtPnR5cGUgPT0gQVRBX0RJU0sp
CS8qIFBSRUZFVENIX0VOICovDQotCQkJcGNpX3dyaXRlX2NvbmZpZ19ieXRl
KGRldiwgZHJpdmVfcGNpLCBBUHxQUkVGRVRDSF9FTik7DQotCX0NCisJcGNp
X3JlYWRfY29uZmlnX2J5dGUoZGV2LCBkcml2ZV9wY2ksICZBUCk7DQorCWlm
IChpZC0+Y2FwYWJpbGl0eSAmIDQpCQkvKiBJT1JEWV9FTiAqLw0KKwkJcGNp
X3dyaXRlX2NvbmZpZ19ieXRlKGRldiwgZHJpdmVfcGNpLCBBUHxJT1JEWV9F
Tik7DQorCXBjaV9yZWFkX2NvbmZpZ19ieXRlKGRldiwgZHJpdmVfcGNpLCAm
QVApOw0KKwlpZiAoZHJpdmUtPnR5cGUgPT0gQVRBX0RJU0spCS8qIFBSRUZF
VENIX0VOICovDQorCQlwY2lfd3JpdGVfY29uZmlnX2J5dGUoZGV2LCBkcml2
ZV9wY2ksIEFQfFBSRUZFVENIX0VOKTsNCiANCiAJbWFwID0gaHdpZi0+bW9k
ZXNfbWFwOw0KIA0KIAlpZiAoIWVpZ2h0eV9uaW50eV90aHJlZShkcml2ZSkp
DQogCQltYXAgJj0gflhGRVJfVURNQV84MFc7DQogDQotCWlmICghdWRtYSkN
Ci0JCW1hcCAmPSB+WEZFUl9VRE1BX0FMTDsNCi0NCiAJbW9kZSA9IGF0YV90
aW1pbmdfbW9kZShkcml2ZSwgbWFwKTsNCiAJaWYgKG1vZGUgPCBYRkVSX1NX
X0RNQV8wKSB7DQogCQkvKiByZXN0b3JlIG9yaWdpbmFsIHBjaS1jb25maWcg
c3BhY2UgKi8NCi0JCWlmICghanVtcGJpdCkNCi0JCQlwY2lfd3JpdGVfY29u
ZmlnX2R3b3JkKGRldiwgZHJpdmVfcGNpLCBkcml2ZV9jb25mKTsNCisJCXBj
aV93cml0ZV9jb25maWdfZHdvcmQoZGV2LCBkcml2ZV9wY2ksIGRyaXZlX2Nv
bmYpOw0KIAkJcmV0dXJuIDA7DQogCX0NCiANCi0JcmV0dXJuICFod2lmLT5z
cGVlZHByb2MoZHJpdmUsIG1vZGUpOw0KLX0NCi0NCi1zdGF0aWMgaW50IHBk
YzIwMnh4X3VkbWFfc2V0dXAoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlLCBp
bnQgbWFwKQ0KLXsNCi0Jc3RydWN0IGhkX2RyaXZlaWQgKmlkID0gZHJpdmUt
PmlkOw0KLQlzdHJ1Y3QgYXRhX2NoYW5uZWwgKmh3aWYgPSBkcml2ZS0+Y2hh
bm5lbDsNCi0JaW50IG9uID0gMDsNCi0JaW50IHZlcmJvc2UgPSAxOw0KLQ0K
LQlpZiAoaWQgJiYgKGlkLT5jYXBhYmlsaXR5ICYgMSkgJiYgaHdpZi0+YXV0
b2RtYSkgew0KLQkJLyogQ29uc3VsdCB0aGUgbGlzdCBvZiBrbm93biAiYmFk
IiBkcml2ZXMgKi8NCi0JCXZlcmJvc2UgPSAwOw0KLQkJaWYgKHVkbWFfYmxh
Y2tfbGlzdChkcml2ZSkpDQotCQkJZ290byBub19kbWFfc2V0Ow0KLQkJaWYg
KGlkLT5maWVsZF92YWxpZCAmIDQpIHsNCi0JCQlpZiAoaWQtPmRtYV91bHRy
YSAmIDB4MDA3Rikgew0KLQkJCQkvKiBGb3JjZSBpZiBDYXBhYmxlIFVsdHJh
RE1BICovDQotCQkJCW9uID0gY29uZmlnX2NoaXBzZXRfZm9yX2RtYShkcml2
ZSwgMSk7DQotCQkJCWlmICgoaWQtPmZpZWxkX3ZhbGlkICYgMikgJiYNCi0J
CQkJICAgICghb24pKQ0KLQkJCQkJZ290byB0cnlfZG1hX21vZGVzOw0KLQkJ
CX0NCi0JCX0gZWxzZSBpZiAoaWQtPmZpZWxkX3ZhbGlkICYgMikgew0KLXRy
eV9kbWFfbW9kZXM6DQotCQkJaWYgKChpZC0+ZG1hX213b3JkICYgMHgwMDA3
KSB8fA0KLQkJCSAgICAoaWQtPmRtYV8xd29yZCAmIDB4MDAwNykpIHsNCi0J
CQkJLyogRm9yY2UgaWYgQ2FwYWJsZSByZWd1bGFyIERNQSBtb2RlcyAqLw0K
LQkJCQlvbiA9IGNvbmZpZ19jaGlwc2V0X2Zvcl9kbWEoZHJpdmUsIDApOw0K
LQkJCQlpZiAoIW9uKQ0KLQkJCQkJZ290byBub19kbWFfc2V0Ow0KLQkJCX0N
Ci0JCX0gZWxzZSBpZiAodWRtYV93aGl0ZV9saXN0KGRyaXZlKSkgew0KLQkJ
CWlmIChpZC0+ZWlkZV9kbWFfdGltZSA+IDE1MCkgew0KLQkJCQlnb3RvIG5v
X2RtYV9zZXQ7DQotCQkJfQ0KLQkJCS8qIENvbnN1bHQgdGhlIGxpc3Qgb2Yg
a25vd24gImdvb2QiIGRyaXZlcyAqLw0KLQkJCW9uID0gY29uZmlnX2NoaXBz
ZXRfZm9yX2RtYShkcml2ZSwgMCk7DQotCQkJaWYgKCFvbikNCi0JCQkJZ290
byBub19kbWFfc2V0Ow0KLQkJfSBlbHNlIGdvdG8gbm9fZG1hX3NldDsNCi0J
fSBlbHNlIGlmICgoaWQtPmNhcGFiaWxpdHkgJiA4KSB8fCAoaWQtPmZpZWxk
X3ZhbGlkICYgMikpIHsNCi1ub19kbWFfc2V0Og0KLQkJcGRjMjAyeHhfdHVu
ZV9kcml2ZShkcml2ZSwgMjU1KTsNCi0JfQ0KLQ0KLQl1ZG1hX2VuYWJsZShk
cml2ZSwgb24sIHZlcmJvc2UpOw0KLQ0KLQlyZXR1cm4gMDsNCisJcmV0dXJu
IHVkbWFfZ2VuZXJpY19zZXR1cChkcml2ZSwgbWFwKTsNCiB9DQogDQogc3Rh
dGljIHZvaWQgcGRjMjAyeHhfdWRtYV9zdGFydChzdHJ1Y3QgYXRhX2Rldmlj
ZSAqZHJpdmUsIHN0cnVjdCByZXF1ZXN0ICpycSkNCkBAIC03MjQsNiArNjU0
LDEwIEBADQogCQljYXNlIFBDSV9ERVZJQ0VfSURfUFJPTUlTRV8yMDI2OFI6
DQogCQkJaHdpZi0+c3BlZWRwcm9jID0gJnBkYzIwMnh4X25ld190dW5lX2No
aXBzZXQ7DQogCQkJaHdpZi0+cmVzZXRwcm9jID0gJnBkYzIwMnh4X25ld19y
ZXNldDsNCisjaWZkZWYgQ09ORklHX0JMS19ERVZfSURFRE1BDQorCQkJaWYg
KGh3aWYtPmRtYV9iYXNlKQ0KKwkJCQlod2lmLT51ZG1hX3NldHVwID0gcGRj
MjAyeHhfdHhfdWRtYV9zZXR1cDsNCisjZW5kaWYNCiAJCQlicmVhazsNCiAJ
CWNhc2UgUENJX0RFVklDRV9JRF9QUk9NSVNFXzIwMjY3Og0KIAkJY2FzZSBQ
Q0lfREVWSUNFX0lEX1BST01JU0VfMjAyNjU6DQpAQCAtNzM4LDYgKzY3Miwx
MCBAQA0KICNlbmRpZg0KIAkJLyogRklYTUU6IGNoZWNrIHdoZXRoZXIgMjAy
NDYgd29ya3Mgd2l0aCBsYmE0OCAtLWJreiAqLw0KIAkJY2FzZSBQQ0lfREVW
SUNFX0lEX1BST01JU0VfMjAyNDY6DQorI2lmZGVmIENPTkZJR19CTEtfREVW
X0lERURNQQ0KKwkJCWlmIChod2lmLT5kbWFfYmFzZSkNCisJCQkJaHdpZi0+
dWRtYV9zZXR1cCA9IHBkYzIwMnh4X3VkbWFfc2V0dXA7DQorI2VuZGlmDQog
CQkJaHdpZi0+c3BlZWRwcm9jID0gJnBkYzIwMnh4X3R1bmVfY2hpcHNldDsN
CiAJCWRlZmF1bHQ6DQogCQkJYnJlYWs7DQpAQCAtNzQ4LDcgKzY4Niw2IEBA
DQogCQlod2lmLT5tb2Rlc19tYXAgPSBwZGMyMDJ4eF9tb2Rlc19tYXAoaHdp
Zik7DQogCQlod2lmLT51ZG1hX2lycV9sb3N0ID0gcGRjMjAyeHhfYnVnOw0K
IAkJaHdpZi0+dWRtYV90aW1lb3V0ID0gcGRjMjAyeHhfYnVnOw0KLQkJaHdp
Zi0+dWRtYV9zZXR1cCA9IHBkYzIwMnh4X3VkbWFfc2V0dXA7DQogCQlod2lm
LT5oaWdobWVtID0gMTsNCiAJCWlmICghbm9hdXRvZG1hKQ0KIAkJCWh3aWYt
PmF1dG9kbWEgPSAxOw0K
---559023410-33463914-1025032625=:27820--
