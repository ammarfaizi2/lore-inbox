Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262560AbVG2MPv@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262560AbVG2MPv (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 29 Jul 2005 08:15:51 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262568AbVG2MPv
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 29 Jul 2005 08:15:51 -0400
Received: from NK210-202-245-3.vdsl.static.apol.com.tw ([210.202.245.3]:63461
	"EHLO uli.com.tw") by vger.kernel.org with ESMTP id S262560AbVG2MPp
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Fri, 29 Jul 2005 08:15:45 -0400
Subject: [patch] net/tulip: LAN driver for ULI M5261/M5263
To: Jeff Garzik <jgarzik@pobox.com>, alan@redhat.com
Cc: Clear.Zhang@uli.com.tw, linux-kernel@vger.kernel.org,
       Emily.Jiang@uli.com.tw
X-Mailer: Lotus Notes R5.0 (Intl) 30 March 1999
Message-ID: <OF9922119A.7A6623CD-ON4825704D.0040B00E@uli.com.tw>
From: Peer.Chen@uli.com.tw
Date: Fri, 29 Jul 2005 20:15:20 +0800
MIME-Version: 1.0
X-MIMETrack: Serialize by Router on ulicnm01/ULI(Release 5.0.11  |July 24, 2002) at 2005-07-29
 20:15:21,
	Itemize by SMTP Server on ulim01/ULI(Release 5.0.11  |July 24, 2002) at
 2005/07/29 08:15:22 PM,
	Serialize by Router on ulim01/ULI(Release 5.0.11  |July 24, 2002) at 2005/07/29
 08:15:27 PM
Content-type: multipart/mixed; 
	Boundary="0__=C7BBFADEDFD3369E8f9e8a93df938690918cC7BBFADEDFD3369E"
Content-Disposition: inline
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--0__=C7BBFADEDFD3369E8f9e8a93df938690918cC7BBFADEDFD3369E
Content-type: text/plain; charset=us-ascii


Hi,Jeff & Alan:
We want to extract our LAN card driver from tulip core driver and make a
new file uli526x.c at tulip folder,
because we have added some ethtool interface support and non-eprom support
in our driver and may be other change
in the futher. If our controllers support are still contained in the tulip
core driver, I think it'll increase the
complexity of maintenance, you know, tulip core driver include several
files and support so many other controllers.
Furthermore, I tested the newest kernel 2.6.12 and I found the tulip driver
can not work on our lan controller, and
I no time to debug it, so I aspired want to make a single uli526x.c file
just for our controllers.
Could you help us remove the ULi m5261/m5263 lan controller support from
tulip core driver and add the new single
uli526x.c file for us? Thanks a lot.

The following is the patch of single uli526x.c file, we have made a full
test for it.

Signed-off-by: Peer Chen <Peer.Chen@uli.com.tw>
(See attached file: patchuli526x)

Best Regards
Peer

--0__=C7BBFADEDFD3369E8f9e8a93df938690918cC7BBFADEDFD3369E
Content-type: application/octet-stream; 
	name="patchuli526x"
Content-Disposition: attachment; filename="patchuli526x"
Content-Transfer-Encoding: base64

ZGlmZiAtdXJOIGxpbnV4LXZhbmlsbGEvZHJpdmVycy9uZXQvdHVsaXAvS2NvbmZpZyBsaW51eC0y
LjYuMTIvZHJpdmVycy9uZXQvdHVsaXAvS2NvbmZpZwotLS0gbGludXgtdmFuaWxsYS9kcml2ZXJz
L25ldC90dWxpcC9LY29uZmlnCTIwMDUtMDYtMTggMDM6NDg6MjkuMDAwMDAwMDAwICswODAwCisr
KyBsaW51eC0yLjYuMTIvZHJpdmVycy9uZXQvdHVsaXAvS2NvbmZpZwkyMDA1LTA3LTI5IDE5OjM1
OjU3LjAwMDAwMDAwMCArMDgwMApAQCAtMTM1LDYgKzEzNSwxOCBAQAogCSAgPGZpbGU6RG9jdW1l
bnRhdGlvbi9uZXR3b3JraW5nL25ldC1tb2R1bGVzLnR4dD4uICBUaGUgbW9kdWxlIHdpbGwKIAkg
IGJlIGNhbGxlZCBkbWZlLgogCitjb25maWcgVUxJNTI2WAorCXRyaXN0YXRlICJVTGkgTTUyNngg
Y29udHJvbGxlciBzdXBwb3J0IgorCWRlcGVuZHMgb24gTkVUX1RVTElQICYmIFBDSQorCXNlbGVj
dCBDUkMzMgorCS0tLWhlbHAtLS0KKwkgIFRoaXMgZHJpdmVyIGlzIGZvciBVTGkgTTUyNjEvTTUy
NjMgMTAvMTAwTSBFdGhlcm5ldCBDb250cm9sbGVyCisJICAoPGh0dHA6Ly93d3cudWxpLmNvbS50
dy8+KS4KKworCSAgVG8gY29tcGlsZSB0aGlzIGRyaXZlciBhcyBhIG1vZHVsZSwgY2hvb3NlIE0g
aGVyZSBhbmQgcmVhZAorCSAgPGZpbGU6RG9jdW1lbnRhdGlvbi9uZXR3b3JraW5nL25ldC1tb2R1
bGVzLnR4dD4uICBUaGUgbW9kdWxlIHdpbGwKKwkgIGJlIGNhbGxlZCB1bGk1MjZ4LgorCSAgCiBj
b25maWcgUENNQ0lBX1hJUkNPTQogCXRyaXN0YXRlICJYaXJjb20gQ2FyZEJ1cyBzdXBwb3J0IChu
ZXcgZHJpdmVyKSIKIAlkZXBlbmRzIG9uIE5FVF9UVUxJUCAmJiBDQVJEQlVTCmRpZmYgLXVyTiBs
aW51eC12YW5pbGxhL2RyaXZlcnMvbmV0L3R1bGlwL01ha2VmaWxlIGxpbnV4LTIuNi4xMi9kcml2
ZXJzL25ldC90dWxpcC9NYWtlZmlsZQotLS0gbGludXgtdmFuaWxsYS9kcml2ZXJzL25ldC90dWxp
cC9NYWtlZmlsZQkyMDA1LTA2LTE4IDAzOjQ4OjI5LjAwMDAwMDAwMCArMDgwMAorKysgbGludXgt
Mi42LjEyL2RyaXZlcnMvbmV0L3R1bGlwL01ha2VmaWxlCTIwMDUtMDctMjkgMTk6MzA6MzAuMDAw
MDAwMDAwICswODAwCkBAIC05LDYgKzksNyBAQAogb2JqLSQoQ09ORklHX0RFMjEwNFgpCQkrPSBk
ZTIxMDR4Lm8KIG9iai0kKENPTkZJR19UVUxJUCkJCSs9IHR1bGlwLm8KIG9iai0kKENPTkZJR19E
RTRYNSkJCSs9IGRlNHg1Lm8KK29iai0kKENPTkZJR19VTEk1MjZYKQkJKz0gdWxpNTI2eC5vCiAK
ICMgRGVjbGFyZSBtdWx0aS1wYXJ0IGRyaXZlcnMuCiAKZGlmZiAtdXJOIGxpbnV4LXZhbmlsbGEv
ZHJpdmVycy9uZXQvdHVsaXAvdWxpNTI2eC5jIGxpbnV4LTIuNi4xMi9kcml2ZXJzL25ldC90dWxp
cC91bGk1MjZ4LmMKLS0tIGxpbnV4LXZhbmlsbGEvZHJpdmVycy9uZXQvdHVsaXAvdWxpNTI2eC5j
CTE5NzAtMDEtMDEgMDg6MDA6MDAuMDAwMDAwMDAwICswODAwCisrKyBsaW51eC0yLjYuMTIvZHJp
dmVycy9uZXQvdHVsaXAvdWxpNTI2eC5jCTIwMDUtMDctMjkgMTk6MzY6MTQuMDAwMDAwMDAwICsw
ODAwCkBAIC0wLDAgKzEsMTc3MCBAQAorLyoKKyAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0
d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgICAgbW9kaWZ5IGl0IHVuZGVy
IHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKyAgICBhcyBwdWJs
aXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMgor
ICAgIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9u
LgorCisgICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQg
d2lsbCBiZSB1c2VmdWwsCisgICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2
ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVT
UyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgICAgR05VIEdlbmVyYWwgUHVi
bGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKworICAgIAorKi8KKworI2RlZmluZSBEUlZf
TkFNRQkidWxpNTI2eCIKKyNkZWZpbmUgRFJWX1ZFUlNJT04JIjAuOS4zIgorI2RlZmluZSBEUlZf
UkVMREFURQkiMjAwNS03LTI5IgorCisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisKKyNpbmNs
dWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9zdHJpbmcuaD4KKyNpbmNsdWRl
IDxsaW51eC90aW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L3B0cmFjZS5oPgorI2luY2x1ZGUgPGxp
bnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGludXgvaW9wb3J0Lmg+CisjaW5jbHVkZSA8bGludXgv
c2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4L2ludGVycnVwdC5oPgorI2luY2x1ZGUgPGxpbnV4L3Bj
aS5oPgorI2luY2x1ZGUgPGxpbnV4L2luaXQuaD4KKyNpbmNsdWRlIDxsaW51eC9uZXRkZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9ldGhlcmRldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2V0aHRv
b2wuaD4KKyNpbmNsdWRlIDxsaW51eC9za2J1ZmYuaD4KKyNpbmNsdWRlIDxsaW51eC9kZWxheS5o
PgorI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CisKKyNpbmNsdWRlIDxhc20vcHJvY2Vzc29y
Lmg+CisjaW5jbHVkZSA8YXNtL2JpdG9wcy5oPgorI2luY2x1ZGUgPGFzbS9pby5oPgorI2luY2x1
ZGUgPGFzbS9kbWEuaD4KKyNpbmNsdWRlIDxhc20vdWFjY2Vzcy5oPgorCisKKy8qIEJvYXJkL1N5
c3RlbS9EZWJ1ZyBpbmZvcm1hdGlvbi9kZWZpbml0aW9uIC0tLS0tLS0tLS0tLS0tLS0gKi8KKyNk
ZWZpbmUgUENJX1VMSTUyNjFfSUQgIDB4NTI2MTEwQjkJLyogVUxpIE01MjYxIElEKi8KKyNkZWZp
bmUgUENJX1VMSTUyNjNfSUQgIDB4NTI2MzEwQjkJLyogVUxpIE01MjYzIElEKi8KKworI2RlZmlu
ZSBVTEk1MjZYX0lPX1NJWkUgMHgxMDAKKyNkZWZpbmUgVFhfREVTQ19DTlQgICAgIDB4MjAgICAg
ICAgICAgICAvKiBBbGxvY2F0ZWQgVHggZGVzY3JpcHRvcnMgKi8KKyNkZWZpbmUgUlhfREVTQ19D
TlQgICAgIDB4MzAgICAgICAgICAgICAvKiBBbGxvY2F0ZWQgUnggZGVzY3JpcHRvcnMgKi8KKyNk
ZWZpbmUgVFhfRlJFRV9ERVNDX0NOVCAoVFhfREVTQ19DTlQgLSAyKQkvKiBNYXggVFggcGFja2V0
IGNvdW50ICovCisjZGVmaW5lIFRYX1dBS0VfREVTQ19DTlQgKFRYX0RFU0NfQ05UIC0gMykJLyog
VFggd2FrZXVwIGNvdW50ICovCisjZGVmaW5lIERFU0NfQUxMX0NOVCAgICAoVFhfREVTQ19DTlQg
KyBSWF9ERVNDX0NOVCkKKyNkZWZpbmUgVFhfQlVGX0FMTE9DICAgIDB4NjAwCisjZGVmaW5lIFJY
X0FMTE9DX1NJWkUgICAweDYyMAorI2RlZmluZSBVTEk1MjZYX1JFU0VUICAgIDEKKyNkZWZpbmUg
Q1IwX0RFRkFVTFQgICAgIDAKKyNkZWZpbmUgQ1I2X0RFRkFVTFQgICAgIDB4MDAwODAwMDAgICAg
ICAvKiBIRCAqLworI2RlZmluZSBDUjZfREVGQVVMVF9BICAgICAweDIyMjQwMDAwCisjZGVmaW5l
IENSN19ERUZBVUxUICAgICAweDE4MGMxCisjZGVmaW5lIENSMTVfREVGQVVMVCAgICAweDA2ICAg
ICAgICAgICAgLyogVHhKYWJiZXIgUnhXYXRjaGRvZyAqLworI2RlZmluZSBUREVTMF9FUlJfTUFT
SyAgMHg0MzAyICAgICAgICAgIC8qIFRYSlQsIExDLCBFQywgRlVFICovCisjZGVmaW5lIE1BWF9Q
QUNLRVRfU0laRSAxNTE0CisjZGVmaW5lIFVMSTUyNjFfTUFYX01VTFRJQ0FTVCAxNAorI2RlZmlu
ZSBSWF9DT1BZX1NJWkUJMTAwCisjZGVmaW5lIE1BWF9DSEVDS19QQUNLRVQgMHg4MDAwCisKKyNk
ZWZpbmUgVUxJNTI2WF8xME1IRiAgICAgIDAKKyNkZWZpbmUgVUxJNTI2WF8xMDBNSEYgICAgIDEK
KyNkZWZpbmUgVUxJNTI2WF8xME1GRCAgICAgIDQKKyNkZWZpbmUgVUxJNTI2WF8xMDBNRkQgICAg
IDUKKyNkZWZpbmUgVUxJNTI2WF9BVVRPICAgICAgIDgKKworI2RlZmluZSBVTEk1MjZYX1RYVEhf
NzIJMHg0MDAwMDAJLyogVFggVEggNzIgYnl0ZSAqLworI2RlZmluZSBVTEk1MjZYX1RYVEhfOTYJ
MHg0MDQwMDAJLyogVFggVEggOTYgYnl0ZSAqLworI2RlZmluZSBVTEk1MjZYX1RYVEhfMTI4CTB4
MDAwMAkJLyogVFggVEggMTI4IGJ5dGUgKi8KKyNkZWZpbmUgVUxJNTI2WF9UWFRIXzI1NgkweDQw
MDAJCS8qIFRYIFRIIDI1NiBieXRlICovCisjZGVmaW5lIFVMSTUyNlhfVFhUSF81MTIJMHg4MDAw
CQkvKiBUWCBUSCA1MTIgYnl0ZSAqLworI2RlZmluZSBVTEk1MjZYX1RYVEhfMUsJMHhDMDAwCQkv
KiBUWCBUSCAxSyAgYnl0ZSAqLworCisjZGVmaW5lIFVMSTUyNlhfVElNRVJfV1VUICAoamlmZmll
cyArIEhaICogMSkvKiB0aW1lciB3YWtldXAgdGltZSA6IDEgc2Vjb25kICovCisjZGVmaW5lIFVM
STUyNlhfVFhfVElNRU9VVCAoKDE2KkhaKS8yKQkvKiB0eCBwYWNrZXQgdGltZS1vdXQgdGltZSA4
IHMiICovCisjZGVmaW5lIFVMSTUyNlhfVFhfS0lDSyAJKDQqSFovMikJLyogdHggcGFja2V0IEtp
Y2stb3V0IHRpbWUgMiBzIiAqLworCisjZGVmaW5lIFVMSTUyNlhfREJVRyhkYnVnX25vdywgbXNn
LCB2YWx1ZSkgaWYgKHVsaTUyNnhfZGVidWcgfHwgKGRidWdfbm93KSkgcHJpbnRrKEtFUk5fRVJS
IERSVl9OQU1FICI6ICVzICVseFxuIiwgKG1zZyksIChsb25nKSAodmFsdWUpKQorCisjZGVmaW5l
IFNIT1dfTUVESUFfVFlQRShtb2RlKSBwcmludGsoS0VSTl9FUlIgRFJWX05BTUUgIjogQ2hhbmdl
IFNwZWVkIHRvICVzTWh6ICVzIGR1cGxleFxuIixtb2RlICYgMSA/IjEwMCI6IjEwIiwgbW9kZSAm
IDQgPyAiZnVsbCI6ImhhbGYiKTsKKworCisvKiBDUjkgZGVmaW5pdGlvbjogU1JPTS9NSUkgKi8K
KyNkZWZpbmUgQ1I5X1NST01fUkVBRCAgIDB4NDgwMAorI2RlZmluZSBDUjlfU1JDUyAgICAgICAg
MHgxCisjZGVmaW5lIENSOV9TUkNMSyAgICAgICAweDIKKyNkZWZpbmUgQ1I5X0NSRE9VVCAgICAg
IDB4OAorI2RlZmluZSBTUk9NX0RBVEFfMCAgICAgMHgwCisjZGVmaW5lIFNST01fREFUQV8xICAg
ICAweDQKKyNkZWZpbmUgUEhZX0RBVEFfMSAgICAgIDB4MjAwMDAKKyNkZWZpbmUgUEhZX0RBVEFf
MCAgICAgIDB4MDAwMDAKKyNkZWZpbmUgTURDTEtIICAgICAgICAgIDB4MTAwMDAKKworI2RlZmlu
ZSBQSFlfUE9XRVJfRE9XTgkweDgwMAorCisjZGVmaW5lIFNST01fVjQxX0NPREUgICAweDE0CisK
KyNkZWZpbmUgU1JPTV9DTEtfV1JJVEUoZGF0YSwgaW9hZGRyKSBvdXRsKGRhdGF8Q1I5X1NST01f
UkVBRHxDUjlfU1JDUyxpb2FkZHIpO3VkZWxheSg1KTtvdXRsKGRhdGF8Q1I5X1NST01fUkVBRHxD
UjlfU1JDU3xDUjlfU1JDTEssaW9hZGRyKTt1ZGVsYXkoNSk7b3V0bChkYXRhfENSOV9TUk9NX1JF
QUR8Q1I5X1NSQ1MsaW9hZGRyKTt1ZGVsYXkoNSk7CisKKy8qIFN0ZW4gQ2hlY2sgKi8KKyNkZWZp
bmUgREVWSUNFIG5ldF9kZXZpY2UKKworLyogU3RydWN0dXJlL2VudW0gZGVjbGFyYXRpb24gLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLworc3RydWN0IHR4X2Rlc2MgeworICAgICAg
ICB1MzIgdGRlczAsIHRkZXMxLCB0ZGVzMiwgdGRlczM7IC8qIERhdGEgZm9yIHRoZSBjYXJkICov
CisgICAgICAgIGNoYXIgKnR4X2J1Zl9wdHI7ICAgICAgICAgICAgICAgLyogRGF0YSBmb3IgdXMg
Ki8KKyAgICAgICAgc3RydWN0IHR4X2Rlc2MgKm5leHRfdHhfZGVzYzsKK30gX19hdHRyaWJ1dGVf
XygoIGFsaWduZWQoMzIpICkpOworCitzdHJ1Y3QgcnhfZGVzYyB7CisJdTMyIHJkZXMwLCByZGVz
MSwgcmRlczIsIHJkZXMzOyAvKiBEYXRhIGZvciB0aGUgY2FyZCAqLworCXN0cnVjdCBza19idWZm
ICpyeF9za2JfcHRyOwkvKiBEYXRhIGZvciB1cyAqLworCXN0cnVjdCByeF9kZXNjICpuZXh0X3J4
X2Rlc2M7Cit9IF9fYXR0cmlidXRlX18oKCBhbGlnbmVkKDMyKSApKTsKKworc3RydWN0IHVsaTUy
NnhfYm9hcmRfaW5mbyB7CisJdTMyIGNoaXBfaWQ7CQkJLyogQ2hpcCB2ZW5kb3IvRGV2aWNlIElE
ICovCisJc3RydWN0IERFVklDRSAqbmV4dF9kZXY7CS8qIG5leHQgZGV2aWNlICovCisJc3RydWN0
IHBjaV9kZXYgKnBkZXY7CQkvKiBQQ0kgZGV2aWNlICovCisJc3BpbmxvY2tfdCBsb2NrOworCisJ
bG9uZyBpb2FkZHI7CQkJLyogSS9PIGJhc2UgYWRkcmVzcyAqLworCXUzMiBjcjBfZGF0YTsKKwl1
MzIgY3I1X2RhdGE7CisJdTMyIGNyNl9kYXRhOworCXUzMiBjcjdfZGF0YTsKKwl1MzIgY3IxNV9k
YXRhOworCisJLyogcG9pbnRlciBmb3IgbWVtb3J5IHBoeXNpY2FsIGFkZHJlc3MgKi8KKwlkbWFf
YWRkcl90IGJ1Zl9wb29sX2RtYV9wdHI7CS8qIFR4IGJ1ZmZlciBwb29sIG1lbW9yeSAqLworCWRt
YV9hZGRyX3QgYnVmX3Bvb2xfZG1hX3N0YXJ0OwkvKiBUeCBidWZmZXIgcG9vbCBhbGlnbiBkd29y
ZCAqLworCWRtYV9hZGRyX3QgZGVzY19wb29sX2RtYV9wdHI7CS8qIGRlc2NyaXB0b3IgcG9vbCBt
ZW1vcnkgKi8KKwlkbWFfYWRkcl90IGZpcnN0X3R4X2Rlc2NfZG1hOworCWRtYV9hZGRyX3QgZmly
c3RfcnhfZGVzY19kbWE7CisKKwkvKiBkZXNjcmlwdG9yIHBvaW50ZXIgKi8KKwl1bnNpZ25lZCBj
aGFyICpidWZfcG9vbF9wdHI7CS8qIFR4IGJ1ZmZlciBwb29sIG1lbW9yeSAqLworCXVuc2lnbmVk
IGNoYXIgKmJ1Zl9wb29sX3N0YXJ0OwkvKiBUeCBidWZmZXIgcG9vbCBhbGlnbiBkd29yZCAqLwor
CXVuc2lnbmVkIGNoYXIgKmRlc2NfcG9vbF9wdHI7CS8qIGRlc2NyaXB0b3IgcG9vbCBtZW1vcnkg
Ki8KKwlzdHJ1Y3QgdHhfZGVzYyAqZmlyc3RfdHhfZGVzYzsKKwlzdHJ1Y3QgdHhfZGVzYyAqdHhf
aW5zZXJ0X3B0cjsKKwlzdHJ1Y3QgdHhfZGVzYyAqdHhfcmVtb3ZlX3B0cjsKKwlzdHJ1Y3Qgcnhf
ZGVzYyAqZmlyc3RfcnhfZGVzYzsKKwlzdHJ1Y3QgcnhfZGVzYyAqcnhfaW5zZXJ0X3B0cjsKKwlz
dHJ1Y3QgcnhfZGVzYyAqcnhfcmVhZHlfcHRyOwkvKiBwYWNrZXQgY29tZSBwb2ludGVyICovCisJ
dW5zaWduZWQgbG9uZyB0eF9wYWNrZXRfY250OwkvKiB0cmFuc21pdHRlZCBwYWNrZXQgY291bnQg
Ki8KKwl1bnNpZ25lZCBsb25nIHJ4X2F2YWlsX2NudDsJLyogYXZhaWxhYmxlIHJ4IGRlc2NyaXB0
b3IgY291bnQgKi8KKwl1bnNpZ25lZCBsb25nIGludGVydmFsX3J4X2NudDsJLyogcnggcGFja2V0
IGNvdW50IGEgY2FsbGJhY2sgdGltZSAqLworCisJdTE2IGRidWdfY250OworCXUxNiBOSUNfY2Fw
YWJpbGl0eTsJCS8qIE5JQyBtZWRpYSBjYXBhYmlsaXR5ICovCisJdTE2IFBIWV9yZWc0OwkJCS8q
IFNhdmVkIFBoeXhjZXIgcmVnaXN0ZXIgNCB2YWx1ZSAqLworCisJdTggbWVkaWFfbW9kZTsJCQkv
KiB1c2VyIHNwZWNpZnkgbWVkaWEgbW9kZSAqLworCXU4IG9wX21vZGU7CQkJLyogcmVhbCB3b3Jr
IG1lZGlhIG1vZGUgKi8KKwl1OCBwaHlfYWRkcjsKKwl1OCBsaW5rX2ZhaWxlZDsJCQkvKiBFdmVy
IGxpbmsgZmFpbGVkICovCisJdTggd2FpdF9yZXNldDsJCQkvKiBIYXJkd2FyZSBmYWlsZWQsIG5l
ZWQgdG8gcmVzZXQgKi8KKwlzdHJ1Y3QgdGltZXJfbGlzdCB0aW1lcjsKKworCS8qIFN5c3RlbSBk
ZWZpbmVkIHN0YXRpc3RpYyBjb3VudGVyICovCisJc3RydWN0IG5ldF9kZXZpY2Vfc3RhdHMgc3Rh
dHM7CisKKwkvKiBEcml2ZXIgZGVmaW5lZCBzdGF0aXN0aWMgY291bnRlciAqLworCXVuc2lnbmVk
IGxvbmcgdHhfZmlmb191bmRlcnJ1bjsKKwl1bnNpZ25lZCBsb25nIHR4X2xvc3NfY2FycmllcjsK
Kwl1bnNpZ25lZCBsb25nIHR4X25vX2NhcnJpZXI7CisJdW5zaWduZWQgbG9uZyB0eF9sYXRlX2Nv
bGxpc2lvbjsKKwl1bnNpZ25lZCBsb25nIHR4X2V4Y2Vzc2l2ZV9jb2xsaXNpb247CisJdW5zaWdu
ZWQgbG9uZyB0eF9qYWJiZXJfdGltZW91dDsKKwl1bnNpZ25lZCBsb25nIHJlc2V0X2NvdW50Owor
CXVuc2lnbmVkIGxvbmcgcmVzZXRfY3I4OworCXVuc2lnbmVkIGxvbmcgcmVzZXRfZmF0YWw7CisJ
dW5zaWduZWQgbG9uZyByZXNldF9UWHRpbWVvdXQ7CisKKwkvKiBOSUMgU1JPTSBkYXRhICovCisJ
dW5zaWduZWQgY2hhciBzcm9tWzEyOF07CisJdTggaW5pdDsJCit9OworCitlbnVtIHVsaTUyNnhf
b2Zmc2V0cyB7CisJRENSMCA9IDB4MDAsIERDUjEgPSAweDA4LCBEQ1IyID0gMHgxMCwgRENSMyA9
IDB4MTgsIERDUjQgPSAweDIwLAorCURDUjUgPSAweDI4LCBEQ1I2ID0gMHgzMCwgRENSNyA9IDB4
MzgsIERDUjggPSAweDQwLCBEQ1I5ID0gMHg0OCwKKwlEQ1IxMCA9IDB4NTAsIERDUjExID0gMHg1
OCwgRENSMTIgPSAweDYwLCBEQ1IxMyA9IDB4NjgsIERDUjE0ID0gMHg3MCwKKwlEQ1IxNSA9IDB4
NzgKK307CisKK2VudW0gdWxpNTI2eF9DUjZfYml0cyB7CisJQ1I2X1JYU0MgPSAweDIsIENSNl9Q
QkYgPSAweDgsIENSNl9QTSA9IDB4NDAsIENSNl9QQU0gPSAweDgwLAorCUNSNl9GRE0gPSAweDIw
MCwgQ1I2X1RYU0MgPSAweDIwMDAsIENSNl9TVEkgPSAweDEwMDAwMCwKKwlDUjZfU0ZUID0gMHgy
MDAwMDAsIENSNl9SWEEgPSAweDQwMDAwMDAwLCBDUjZfTk9fUFVSR0UgPSAweDIwMDAwMDAwCit9
OworCisvKiBHbG9iYWwgdmFyaWFibGUgZGVjbGFyYXRpb24gLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0gKi8KK3N0YXRpYyBpbnQgX19kZXZpbml0ZGF0YSBwcmludGVkX3ZlcnNpb247Citz
dGF0aWMgY2hhciB2ZXJzaW9uW10gX19kZXZpbml0ZGF0YSA9CisJS0VSTl9JTkZPIERSVl9OQU1F
ICI6IFVMaSBNNTI2MS9NNTI2MyBuZXQgZHJpdmVyLCB2ZXJzaW9uICIKKwlEUlZfVkVSU0lPTiAi
ICgiIERSVl9SRUxEQVRFICIpXG4iOworCitzdGF0aWMgaW50IHVsaTUyNnhfZGVidWc7CitzdGF0
aWMgdW5zaWduZWQgY2hhciB1bGk1MjZ4X21lZGlhX21vZGUgPSBVTEk1MjZYX0FVVE87CitzdGF0
aWMgdTMyIHVsaTUyNnhfY3I2X3VzZXJfc2V0OworCisvKiBGb3IgbW9kdWxlIGlucHV0IHBhcmFt
ZXRlciAqLworc3RhdGljIGludCBkZWJ1ZzsKK3N0YXRpYyB1MzIgY3I2c2V0Oworc3RhdGljIHUz
MiBtNTI2eF9pZDsKK3N0YXRpYyB1bnNpZ25lZCBjaGFyIG1vZGUgPSA4OworCisvKiBmdW5jdGlv
biBkZWNsYXJhdGlvbiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCitz
dGF0aWMgaW50IHVsaTUyNnhfb3BlbihzdHJ1Y3QgREVWSUNFICopOworc3RhdGljIGludCB1bGk1
MjZ4X3N0YXJ0X3htaXQoc3RydWN0IHNrX2J1ZmYgKiwgc3RydWN0IERFVklDRSAqKTsKK3N0YXRp
YyBpbnQgdWxpNTI2eF9zdG9wKHN0cnVjdCBERVZJQ0UgKik7CitzdGF0aWMgc3RydWN0IG5ldF9k
ZXZpY2Vfc3RhdHMgKiB1bGk1MjZ4X2dldF9zdGF0cyhzdHJ1Y3QgREVWSUNFICopOworc3RhdGlj
IHZvaWQgdWxpNTI2eF9zZXRfZmlsdGVyX21vZGUoc3RydWN0IERFVklDRSAqKTsKK3N0YXRpYyBz
dHJ1Y3QgZXRodG9vbF9vcHMgbmV0ZGV2X2V0aHRvb2xfb3BzOworc3RhdGljIHUxNiByZWFkX3Ny
b21fd29yZChsb25nICxpbnQpOworc3RhdGljIGlycXJldHVybl90IHVsaTUyNnhfaW50ZXJydXB0
KGludCAsIHZvaWQgKiwgc3RydWN0IHB0X3JlZ3MgKik7CitzdGF0aWMgdm9pZCB1bGk1MjZ4X2Rl
c2NyaXB0b3JfaW5pdChzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICosIHVuc2lnbmVkIGxvbmcp
Oworc3RhdGljIHZvaWQgYWxsb2NhdGVfcnhfYnVmZmVyKHN0cnVjdCB1bGk1MjZ4X2JvYXJkX2lu
Zm8gKik7CitzdGF0aWMgdm9pZCB1cGRhdGVfY3I2KHUzMiwgdW5zaWduZWQgbG9uZyk7CitzdGF0
aWMgdm9pZCBzZW5kX2ZpbHRlcl9mcmFtZShzdHJ1Y3QgREVWSUNFICogLGludCk7CitzdGF0aWMg
dTE2IHBoeV9yZWFkKHVuc2lnbmVkIGxvbmcsIHU4LCB1OCwgdTMyKTsKK3N0YXRpYyB1MTYgcGh5
X3JlYWRieV9jcjEwKHVuc2lnbmVkIGxvbmcsIHU4LCB1OCk7CitzdGF0aWMgdm9pZCBwaHlfd3Jp
dGUodW5zaWduZWQgbG9uZywgdTgsIHU4LCB1MTYsIHUzMik7CitzdGF0aWMgdm9pZCBwaHlfd3Jp
dGVieV9jcjEwKHVuc2lnbmVkIGxvbmcsIHU4LCB1OCwgdTE2KTsKK3N0YXRpYyB2b2lkIHBoeV93
cml0ZV8xYml0KHVuc2lnbmVkIGxvbmcsIHUzMiwgdTMyKTsKK3N0YXRpYyB1MTYgcGh5X3JlYWRf
MWJpdCh1bnNpZ25lZCBsb25nLCB1MzIpOworc3RhdGljIHU4IHVsaTUyNnhfc2Vuc2Vfc3BlZWQo
c3RydWN0IHVsaTUyNnhfYm9hcmRfaW5mbyAqKTsKK3N0YXRpYyB2b2lkIHVsaTUyNnhfcHJvY2Vz
c19tb2RlKHN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKik7CitzdGF0aWMgdm9pZCB1bGk1MjZ4
X3RpbWVyKHVuc2lnbmVkIGxvbmcpOworc3RhdGljIHZvaWQgdWxpNTI2eF9yeF9wYWNrZXQoc3Ry
dWN0IERFVklDRSAqLCBzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICopOworc3RhdGljIHZvaWQg
dWxpNTI2eF9mcmVlX3R4X3BrdChzdHJ1Y3QgREVWSUNFICosIHN0cnVjdCB1bGk1MjZ4X2JvYXJk
X2luZm8gKik7CitzdGF0aWMgdm9pZCB1bGk1MjZ4X3JldXNlX3NrYihzdHJ1Y3QgdWxpNTI2eF9i
b2FyZF9pbmZvICosIHN0cnVjdCBza19idWZmICopOworc3RhdGljIHZvaWQgdWxpNTI2eF9keW5h
bWljX3Jlc2V0KHN0cnVjdCBERVZJQ0UgKik7CitzdGF0aWMgdm9pZCB1bGk1MjZ4X2ZyZWVfcnhi
dWZmZXIoc3RydWN0IHVsaTUyNnhfYm9hcmRfaW5mbyAqKTsKK3N0YXRpYyB2b2lkIHVsaTUyNnhf
aW5pdChzdHJ1Y3QgREVWSUNFICopOworc3RhdGljIHZvaWQgdWxpNTI2eF9zZXRfcGh5eGNlcihz
dHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICopOworCisvKiBVTEk1MjZYIG5ldHdvcmsgYmFvcmQg
cm91dGluZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCisKKy8qCisgKglTZWFyY2gg
VUxJNTI2WCBib2FyZCAsYWxsb2NhdGUgc3BhY2UgYW5kIHJlZ2lzdGVyIGl0CisgKi8KKworc3Rh
dGljIGludCBfX2RldmluaXQgdWxpNTI2eF9pbml0X29uZSAoc3RydWN0IHBjaV9kZXYgKnBkZXYs
CisJCQkJICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICplbnQpCit7CisJc3RydWN0IHVs
aTUyNnhfYm9hcmRfaW5mbyAqZGI7CS8qIGJvYXJkIGluZm9ybWF0aW9uIHN0cnVjdHVyZSAqLwor
CXN0cnVjdCBuZXRfZGV2aWNlICpkZXY7CisJaW50IGksIGVycjsKKwl1MzIgY29uZmlndmFsOwor
CisJVUxJNTI2WF9EQlVHKDAsICJ1bGk1MjZ4X2luaXRfb25lKCkiLCAwKTsKKworCWlmICghcHJp
bnRlZF92ZXJzaW9uKyspCisJCXByaW50ayh2ZXJzaW9uKTsKKworCS8qIEluaXQgbmV0d29yayBk
ZXZpY2UgKi8KKwlkZXYgPSBhbGxvY19ldGhlcmRldihzaXplb2YoKmRiKSk7CisJaWYgKGRldiA9
PSBOVUxMKQorCQlyZXR1cm4gLUVOT01FTTsKKwlTRVRfTU9EVUxFX09XTkVSKGRldik7CisJU0VU
X05FVERFVl9ERVYoZGV2LCAmcGRldi0+ZGV2KTsKKworCWlmIChwY2lfc2V0X2RtYV9tYXNrKHBk
ZXYsIDB4ZmZmZmZmZmYpKSB7CisJCXByaW50ayhLRVJOX1dBUk5JTkcgRFJWX05BTUUgIjogMzIt
Yml0IFBDSSBETUEgbm90IGF2YWlsYWJsZS5cbiIpOworCQllcnIgPSAtRU5PREVWOworCQlnb3Rv
IGVycl9vdXRfZnJlZTsKKwl9CisKKwkvKiBFbmFibGUgTWFzdGVyL0lPIGFjY2VzcywgRGlzYWJs
ZSBtZW1vcnkgYWNjZXNzICovCisJZXJyID0gcGNpX2VuYWJsZV9kZXZpY2UocGRldik7CisJaWYg
KGVycikKKwkJZ290byBlcnJfb3V0X2ZyZWU7CisKKwlpZiAoIXBjaV9yZXNvdXJjZV9zdGFydChw
ZGV2LCAwKSkgeworCQlwcmludGsoS0VSTl9FUlIgRFJWX05BTUUgIjogSS9PIGJhc2UgaXMgemVy
b1xuIik7CisJCWVyciA9IC1FTk9ERVY7CisJCWdvdG8gZXJyX291dF9kaXNhYmxlOworCX0KKwor
CWlmIChwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDApIDwgKFVMSTUyNlhfSU9fU0laRSkgKSB7CisJ
CXByaW50ayhLRVJOX0VSUiBEUlZfTkFNRSAiOiBBbGxvY2F0ZWQgSS9PIHNpemUgdG9vIHNtYWxs
XG4iKTsKKwkJZXJyID0gLUVOT0RFVjsKKwkJZ290byBlcnJfb3V0X2Rpc2FibGU7CisJfQorCisJ
aWYgKHBjaV9yZXF1ZXN0X3JlZ2lvbnMocGRldiwgRFJWX05BTUUpKSB7CisJCXByaW50ayhLRVJO
X0VSUiBEUlZfTkFNRSAiOiBGYWlsZWQgdG8gcmVxdWVzdCBQQ0kgcmVnaW9uc1xuIik7CisJCWVy
ciA9IC1FTk9ERVY7CisJCWdvdG8gZXJyX291dF9kaXNhYmxlOworCX0KKworCS8vYWRkIGJ5IGNs
ZWFyemhhbmcgMjAwNC83LzgKKwlwY2lfcmVhZF9jb25maWdfZHdvcmQocGRldiwweDAsJmNvbmZp
Z3ZhbCk7CisJbTUyNnhfaWQgPSBjb25maWd2YWw7CisJaWYoY29uZmlndmFsID09IDB4NTI2MzEw
YjkpCisJeworCQkvL3ByaW50aygiaXMgbTUyNjNcbiIpOworCQlwY2lfcmVhZF9jb25maWdfZHdv
cmQocGRldiwweDBjLCZjb25maWd2YWwpOworCQljb25maWd2YWwgPSAoKGNvbmZpZ3ZhbCAmIDB4
ZmZmZjAwZmYpIHwgMHg4MDAwKTsKKwkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZChwZGV2LDB4MGMs
Y29uZmlndmFsKTsKKwl9CisJLyogSW5pdCBzeXN0ZW0gJiBkZXZpY2UgKi8KKwlkYiA9IG5ldGRl
dl9wcml2KGRldik7CisKKwkvKiBBbGxvY2F0ZSBUeC9SeCBkZXNjcmlwdG9yIG1lbW9yeSAqLwor
CWRiLT5kZXNjX3Bvb2xfcHRyID0gcGNpX2FsbG9jX2NvbnNpc3RlbnQocGRldiwgc2l6ZW9mKHN0
cnVjdCB0eF9kZXNjKSAqIERFU0NfQUxMX0NOVCArIDB4MjAsICZkYi0+ZGVzY19wb29sX2RtYV9w
dHIpOworCWRiLT5idWZfcG9vbF9wdHIgPSBwY2lfYWxsb2NfY29uc2lzdGVudChwZGV2LCBUWF9C
VUZfQUxMT0MgKiBUWF9ERVNDX0NOVCArIDQsICZkYi0+YnVmX3Bvb2xfZG1hX3B0cik7CisKKwlk
Yi0+Zmlyc3RfdHhfZGVzYyA9IChzdHJ1Y3QgdHhfZGVzYyAqKSBkYi0+ZGVzY19wb29sX3B0cjsK
KwlkYi0+Zmlyc3RfdHhfZGVzY19kbWEgPSBkYi0+ZGVzY19wb29sX2RtYV9wdHI7CisJZGItPmJ1
Zl9wb29sX3N0YXJ0ID0gZGItPmJ1Zl9wb29sX3B0cjsKKwlkYi0+YnVmX3Bvb2xfZG1hX3N0YXJ0
ID0gZGItPmJ1Zl9wb29sX2RtYV9wdHI7CisKKwlkYi0+Y2hpcF9pZCA9IGVudC0+ZHJpdmVyX2Rh
dGE7CisJZGItPmlvYWRkciA9IHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAwKTsKKwkKKwlkYi0+
cGRldiA9IHBkZXY7CisJZGItPmluaXQgPSAxOworCQorCWRldi0+YmFzZV9hZGRyID0gZGItPmlv
YWRkcjsKKwlkZXYtPmlycSA9IHBkZXYtPmlycTsKKwlwY2lfc2V0X2RydmRhdGEocGRldiwgZGV2
KTsKKwkKKwkvKiBSZWdpc3RlciBzb21lIG5lY2Vzc2FyeSBmdW5jdGlvbnMgKi8KKwlkZXYtPm9w
ZW4gPSAmdWxpNTI2eF9vcGVuOworCWRldi0+aGFyZF9zdGFydF94bWl0ID0gJnVsaTUyNnhfc3Rh
cnRfeG1pdDsKKwlkZXYtPnN0b3AgPSAmdWxpNTI2eF9zdG9wOworCWRldi0+Z2V0X3N0YXRzID0g
JnVsaTUyNnhfZ2V0X3N0YXRzOworCWRldi0+c2V0X211bHRpY2FzdF9saXN0ID0gJnVsaTUyNnhf
c2V0X2ZpbHRlcl9tb2RlOworCWRldi0+ZXRodG9vbF9vcHMgPSAmbmV0ZGV2X2V0aHRvb2xfb3Bz
OworCXNwaW5fbG9ja19pbml0KCZkYi0+bG9jayk7CisKKwkJCisJLyogcmVhZCA2NCB3b3JkIHNy
b20gZGF0YSAqLworCWZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQorCQkoKHUxNiAqKSBkYi0+c3Jv
bSlbaV0gPSBjcHVfdG9fbGUxNihyZWFkX3Nyb21fd29yZChkYi0+aW9hZGRyLCBpKSk7CisKKwkv
KiBTZXQgTm9kZSBhZGRyZXNzICovCisJaWYoKCh1MTYgKikgZGItPnNyb20pWzBdID09IDB4ZmZm
ZikJCS8qIFNST00gYWJzZW50LCBzbyByZWFkIE1BQyBhZGRyZXNzIGZyb20gSUQgVGFibGUgKi8K
Kwl7CisJCW91dGwoMHgxMDAwMCwgZGItPmlvYWRkciArIERDUjApOwkvL0RpYWdub3NpcyBtb2Rl
CisJCW91dGwoMHgxYzAsIGRiLT5pb2FkZHIgKyBEQ1IxMyk7CS8vUmVzZXQgZGlhbm9zdGljIHBv
aW50ZXIgcG9ydAorCQlvdXRsKDAsIGRiLT5pb2FkZHIgKyBEQ1IxNCk7CQkvL0NsZWFyIHJlc2V0
IHBvcnQKKwkJb3V0bCgweDEwLCBkYi0+aW9hZGRyICsgRENSMTQpOwkJLy9SZXNldCBJRCBUYWJs
ZSBwb2ludGVyCisJCW91dGwoMCwgZGItPmlvYWRkciArIERDUjE0KTsJCS8vQ2xlYXIgcmVzZXQg
cG9ydAorCQlvdXRsKDAsIGRiLT5pb2FkZHIgKyBEQ1IxMyk7CQkvL0NsZWFyIENSMTMKKwkJb3V0
bCgweDFiMCwgZGItPmlvYWRkciArIERDUjEzKTsJLy9TZWxlY3QgSUQgVGFibGUgYWNjZXNzIHBv
cnQKKwkJLy9SZWFkIE1BQyBhZGRyZXNzIGZyb20gQ1IxNAorCQlmb3IgKGkgPSAwOyBpIDwgNjsg
aSsrKQorCQkJZGV2LT5kZXZfYWRkcltpXSA9IGlubChkYi0+aW9hZGRyICsgRENSMTQpOworCQkv
L1JlYWQgZW5kCisJCW91dGwoMCwgZGItPmlvYWRkciArIERDUjEzKTsJLy9DbGVhciBDUjEzCisJ
CW91dGwoMCwgZGItPmlvYWRkciArIERDUjApOwkJLy9DbGVhciBDUjAKKwkJdWRlbGF5KDEwKTsK
Kwl9CisJZWxzZQkJLypFeGlzdCBTUk9NKi8KKwl7CisJCWZvciAoaSA9IDA7IGkgPCA2OyBpKysp
CisJCQlkZXYtPmRldl9hZGRyW2ldID0gZGItPnNyb21bMjAgKyBpXTsKKwl9CisJZXJyID0gcmVn
aXN0ZXJfbmV0ZGV2IChkZXYpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX291dF9yZXM7CisKKwlw
cmludGsoS0VSTl9JTkZPICIlczogVUxpIE0lMDRseCBhdCBwY2klcywiLGRldi0+bmFtZSxlbnQt
PmRyaXZlcl9kYXRhID4+IDE2LHBjaV9uYW1lKHBkZXYpKTsKKwkKKwlmb3IgKGkgPSAwOyBpIDwg
NjsgaSsrKQorCQlwcmludGsoIiVjJTAyeCIsIGkgPyAnOicgOiAnICcsIGRldi0+ZGV2X2FkZHJb
aV0pOworCXByaW50aygiLCBpcnEgJWQuXG4iLCBkZXYtPmlycSk7CisKKwlwY2lfc2V0X21hc3Rl
cihwZGV2KTsKKworCXJldHVybiAwOworCitlcnJfb3V0X3JlczoKKwlwY2lfcmVsZWFzZV9yZWdp
b25zKHBkZXYpOworZXJyX291dF9kaXNhYmxlOgorCXBjaV9kaXNhYmxlX2RldmljZShwZGV2KTsK
K2Vycl9vdXRfZnJlZToKKwlwY2lfc2V0X2RydmRhdGEocGRldiwgTlVMTCk7CisJZnJlZV9uZXRk
ZXYoZGV2KTsKKworCXJldHVybiBlcnI7Cit9CisKKworc3RhdGljIHZvaWQgX19kZXZleGl0IHVs
aTUyNnhfcmVtb3ZlX29uZSAoc3RydWN0IHBjaV9kZXYgKnBkZXYpCit7CisJc3RydWN0IG5ldF9k
ZXZpY2UgKmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKKwlzdHJ1Y3QgdWxpNTI2eF9ib2Fy
ZF9pbmZvICpkYiA9IG5ldGRldl9wcml2KGRldik7CisKKwlVTEk1MjZYX0RCVUcoMCwgInVsaTUy
NnhfcmVtb3ZlX29uZSgpIiwgMCk7CisKKyAJaWYgKGRldikgeworCQlwY2lfZnJlZV9jb25zaXN0
ZW50KGRiLT5wZGV2LCBzaXplb2Yoc3RydWN0IHR4X2Rlc2MpICoKKwkJCQkJREVTQ19BTExfQ05U
ICsgMHgyMCwgZGItPmRlc2NfcG9vbF9wdHIsCisgCQkJCQlkYi0+ZGVzY19wb29sX2RtYV9wdHIp
OworCQlwY2lfZnJlZV9jb25zaXN0ZW50KGRiLT5wZGV2LCBUWF9CVUZfQUxMT0MgKiBUWF9ERVND
X0NOVCArIDQsCisJCQkJCWRiLT5idWZfcG9vbF9wdHIsIGRiLT5idWZfcG9vbF9kbWFfcHRyKTsK
KwkJdW5yZWdpc3Rlcl9uZXRkZXYoZGV2KTsKKwkJcGNpX3JlbGVhc2VfcmVnaW9ucyhwZGV2KTsK
KwkJZnJlZV9uZXRkZXYoZGV2KTsJLyogZnJlZSBib2FyZCBpbmZvcm1hdGlvbiAqLworCQlwY2lf
c2V0X2RydmRhdGEocGRldiwgTlVMTCk7CisJfQorCisJVUxJNTI2WF9EQlVHKDAsICJ1bGk1MjZ4
X3JlbW92ZV9vbmUoKSBleGl0IiwgMCk7Cit9CisKKworLyoKKyAqCU9wZW4gdGhlIGludGVyZmFj
ZS4KKyAqCVRoZSBpbnRlcmZhY2UgaXMgb3BlbmVkIHdoZW5ldmVyICJpZmNvbmZpZyIgYWN0aXZl
cyBpdC4KKyAqLworCitzdGF0aWMgaW50IHVsaTUyNnhfb3BlbihzdHJ1Y3QgREVWSUNFICpkZXYp
Cit7CisJaW50IHJldDsKKwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IG5ldGRldl9w
cml2KGRldik7CisKKwlVTEk1MjZYX0RCVUcoMCwgInVsaTUyNnhfb3BlbiIsIDApOworCisJcmV0
ID0gcmVxdWVzdF9pcnEoZGV2LT5pcnEsICZ1bGk1MjZ4X2ludGVycnVwdCwgU0FfU0hJUlEsIGRl
di0+bmFtZSwgZGV2KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJLyogc3lzdGVtIHZh
cmlhYmxlIGluaXQgKi8KKwlkYi0+Y3I2X2RhdGEgPSBDUjZfREVGQVVMVCB8IHVsaTUyNnhfY3I2
X3VzZXJfc2V0OworCWlmKG01MjZ4X2lkID09IDB4NTI2MzEwYjkpCisJeyAgCisJCS8vcHJpbnRr
KCJpcyA1MjYzXG4iKTsKKwkJZGItPmNyNl9kYXRhID0gQ1I2X0RFRkFVTFRfQSB8IHVsaTUyNnhf
Y3I2X3VzZXJfc2V0OworCX0KKwlkYi0+dHhfcGFja2V0X2NudCA9IDA7CisJZGItPnJ4X2F2YWls
X2NudCA9IDA7CisJZGItPmxpbmtfZmFpbGVkID0gMTsKKwluZXRpZl9jYXJyaWVyX29mZihkZXYp
OworCWRiLT53YWl0X3Jlc2V0ID0gMDsKKworCWRiLT5OSUNfY2FwYWJpbGl0eSA9IDB4ZjsJLyog
QWxsIGNhcGFiaWxpdHkqLworCWRiLT5QSFlfcmVnNCA9IDB4MWUwOworCisJLyogQ1I2IG9wZXJh
dGlvbiBtb2RlIGRlY2lzaW9uICovCisJZGItPmNyNl9kYXRhIHw9IFVMSTUyNlhfVFhUSF8yNTY7
CisJZGItPmNyMF9kYXRhID0gQ1IwX0RFRkFVTFQ7CisJCisJLyogSW5pdGlsaXplIFVMSTUyNlgg
Ym9hcmQgKi8KKwl1bGk1MjZ4X2luaXQoZGV2KTsKKworCS8qIEFjdGl2ZSBTeXN0ZW0gSW50ZXJm
YWNlICovCisJbmV0aWZfd2FrZV9xdWV1ZShkZXYpOworCisJLyogc2V0IGFuZCBhY3RpdmUgYSB0
aW1lciBwcm9jZXNzICovCisJaW5pdF90aW1lcigmZGItPnRpbWVyKTsKKwlkYi0+dGltZXIuZXhw
aXJlcyA9IFVMSTUyNlhfVElNRVJfV1VUICsgSFogKiAyOworCWRiLT50aW1lci5kYXRhID0gKHVu
c2lnbmVkIGxvbmcpZGV2OworCWRiLT50aW1lci5mdW5jdGlvbiA9ICZ1bGk1MjZ4X3RpbWVyOwor
CWFkZF90aW1lcigmZGItPnRpbWVyKTsKKworCXJldHVybiAwOworfQorCisKKy8qCUluaXRpbGl6
ZSBVTEk1MjZYIGJvYXJkCisgKglSZXNldCBVTEk1MjZYIGJvYXJkCisgKglJbml0aWxpemUgVFgv
UnggZGVzY3JpcHRvciBjaGFpbiBzdHJ1Y3R1cmUKKyAqCVNlbmQgdGhlIHNldC11cCBmcmFtZQor
ICoJRW5hYmxlIFR4L1J4IG1hY2hpbmUKKyAqLworCitzdGF0aWMgdm9pZCB1bGk1MjZ4X2luaXQo
c3RydWN0IERFVklDRSAqZGV2KQoreworCXN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKmRiID0g
bmV0ZGV2X3ByaXYoZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlvYWRkciA9IGRiLT5pb2FkZHI7CisJ
dTgJcGh5X3RtcDsKKwl1MTYJcGh5X3ZhbHVlOworCXUxNiBwaHlfcmVnX3Jlc2V0OworCisJVUxJ
NTI2WF9EQlVHKDAsICJ1bGk1MjZ4X2luaXQoKSIsIDApOworCisJLyogUmVzZXQgTTUyNnggTUFD
IGNvbnRyb2xsZXIgKi8KKwlvdXRsKFVMSTUyNlhfUkVTRVQsIGlvYWRkciArIERDUjApOwkvKiBS
RVNFVCBNQUMgKi8KKwl1ZGVsYXkoMTAwKTsKKwlvdXRsKGRiLT5jcjBfZGF0YSwgaW9hZGRyICsg
RENSMCk7CisJdWRlbGF5KDUpOworCisJLyogUGh5IGFkZHIgOiBJbiBzb21lIGJvYXJkcyxNNTI2
MS9NNTI2MyBwaHkgYWRkcmVzcyAhPSAxICovCisJZGItPnBoeV9hZGRyID0gMTsKKwlmb3IocGh5
X3RtcD0wO3BoeV90bXA8MzI7cGh5X3RtcCsrKQorCXsKKwkJcGh5X3ZhbHVlPXBoeV9yZWFkKGRi
LT5pb2FkZHIscGh5X3RtcCwzLGRiLT5jaGlwX2lkKTsvL3BlZXIgYWRkCisJCWlmKHBoeV92YWx1
ZSAhPSAweGZmZmYmJnBoeV92YWx1ZSE9MCkKKwkJeworCQkJZGItPnBoeV9hZGRyID0gcGh5X3Rt
cDsKKwkJCWJyZWFrOworCQl9CisJfQorCWlmKHBoeV90bXAgPT0gMzIpCisJCXByaW50ayhLRVJO
X1dBUk5JTkcgIkNhbiBub3QgZmluZCB0aGUgcGh5IGFkZHJlc3MhISEiKTsKKwkvKiBQYXJzZXIg
U1JPTSBhbmQgbWVkaWEgbW9kZSAqLworCWRiLT5tZWRpYV9tb2RlID0gdWxpNTI2eF9tZWRpYV9t
b2RlOworCisJLy9hZGQgYnkgY2xlYXJ6aGFuZyAyMDA0LzcvOAorCS8qIFJFU0VUIFBoeXhjZXIg
Q2hpcCBieSBHUFIgcG9ydCBiaXQgNyAqLworCS8vb3V0bCgweDE4MCwgaW9hZGRyICsgRENSMTIp
OwkJLyogTGV0IGJpdCA3IG91dHB1dCBwb3J0ICovCisJLy9vdXRsKDB4MCwgaW9hZGRyICsgRENS
MTIpOwkvKiBDbGVhciBSRVNFVCBzaWduYWwgKi8KKworCS8qIFBoeXhjZXIgY2FwYWJpbGl0eSBz
ZXR0aW5nICovCisJcGh5X3JlZ19yZXNldCA9IHBoeV9yZWFkKGRiLT5pb2FkZHIsIGRiLT5waHlf
YWRkciwgMCwgZGItPmNoaXBfaWQpOworCXBoeV9yZWdfcmVzZXQgPSAocGh5X3JlZ19yZXNldCB8
IDB4ODAwMCk7CisJcGh5X3dyaXRlKGRiLT5pb2FkZHIsIGRiLT5waHlfYWRkciwgMCwgcGh5X3Jl
Z19yZXNldCwgZGItPmNoaXBfaWQpOworCXVkZWxheSg1MDApOworCisJLyogUHJvY2VzcyBQaHl4
Y2VyIE1lZGlhIE1vZGUgKi8KKwl1bGk1MjZ4X3NldF9waHl4Y2VyKGRiKTsKKworCS8qIE1lZGlh
IE1vZGUgUHJvY2VzcyAqLworCWlmICggIShkYi0+bWVkaWFfbW9kZSAmIFVMSTUyNlhfQVVUTykg
KQorCQlkYi0+b3BfbW9kZSA9IGRiLT5tZWRpYV9tb2RlOyAJLyogRm9yY2UgTW9kZSAqLworCisJ
LyogSW5pdGlsaWF6ZSBUcmFuc21pdC9SZWNlaXZlIGRlY3JpcHRvciBhbmQgQ1IzLzQgKi8KKwl1
bGk1MjZ4X2Rlc2NyaXB0b3JfaW5pdChkYiwgaW9hZGRyKTsKKworCS8qIEluaXQgQ1I2IHRvIHBy
b2dyYW0gTTUyNlggb3BlcmF0aW9uICovCisJdXBkYXRlX2NyNihkYi0+Y3I2X2RhdGEsIGlvYWRk
cik7CisKKwkvKiBTZW5kIHNldHVwIGZyYW1lICovCisJc2VuZF9maWx0ZXJfZnJhbWUoZGV2LCBk
ZXYtPm1jX2NvdW50KTsJLyogTTUyNjEvTTUyNjMgKi8KKworCS8qIEluaXQgQ1I3LCBpbnRlcnJ1
cHQgYWN0aXZlIGJpdCAqLworCWRiLT5jcjdfZGF0YSA9IENSN19ERUZBVUxUOworCW91dGwoZGIt
PmNyN19kYXRhLCBpb2FkZHIgKyBEQ1I3KTsKKworCS8qIEluaXQgQ1IxNSwgVHggamFiYmVyIGFu
ZCBSeCB3YXRjaGRvZyB0aW1lciAqLworCW91dGwoZGItPmNyMTVfZGF0YSwgaW9hZGRyICsgRENS
MTUpOworCisJLyogRW5hYmxlIFVMSTUyNlggVHgvUnggZnVuY3Rpb24gKi8KKwlkYi0+Y3I2X2Rh
dGEgfD0gQ1I2X1JYU0MgfCBDUjZfVFhTQzsKKwl1cGRhdGVfY3I2KGRiLT5jcjZfZGF0YSwgaW9h
ZGRyKTsKK30KKworCisvKgorICoJSGFyZHdhcmUgc3RhcnQgdHJhbnNtaXNzaW9uLgorICoJU2Vu
ZCBhIHBhY2tldCB0byBtZWRpYSBmcm9tIHRoZSB1cHBlciBsYXllci4KKyAqLworCitzdGF0aWMg
aW50IHVsaTUyNnhfc3RhcnRfeG1pdChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgREVWSUNF
ICpkZXYpCit7CisJc3RydWN0IHVsaTUyNnhfYm9hcmRfaW5mbyAqZGIgPSBuZXRkZXZfcHJpdihk
ZXYpOworCXN0cnVjdCB0eF9kZXNjICp0eHB0cjsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJ
VUxJNTI2WF9EQlVHKDAsICJ1bGk1MjZ4X3N0YXJ0X3htaXQiLCAwKTsKKworCS8qIFJlc291cmNl
IGZsYWcgY2hlY2sgKi8KKwluZXRpZl9zdG9wX3F1ZXVlKGRldik7CisKKwkvKiBUb28gbGFyZ2Ug
cGFja2V0IGNoZWNrICovCisJaWYgKHNrYi0+bGVuID4gTUFYX1BBQ0tFVF9TSVpFKSB7CisJCXBy
aW50ayhLRVJOX0VSUiBEUlZfTkFNRSAiOiBiaWcgcGFja2V0ID0gJWRcbiIsICh1MTYpc2tiLT5s
ZW4pOworCQlkZXZfa2ZyZWVfc2tiKHNrYik7CisJCXJldHVybiAwOworCX0KKworCXNwaW5fbG9j
a19pcnFzYXZlKCZkYi0+bG9jaywgZmxhZ3MpOworCisJLyogTm8gVHggcmVzb3VyY2UgY2hlY2ss
IGl0IG5ldmVyIGhhcHBlbiBucm9tYWxseSAqLworCWlmIChkYi0+dHhfcGFja2V0X2NudCA+PSBU
WF9GUkVFX0RFU0NfQ05UKSB7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRiLT5sb2NrLCBm
bGFncyk7CisJCXByaW50ayhLRVJOX0VSUiBEUlZfTkFNRSAiOiBObyBUeCByZXNvdXJjZSAlbGRc
biIsIGRiLT50eF9wYWNrZXRfY250KTsKKwkJcmV0dXJuIDE7CisJfQorCisJLyogRGlzYWJsZSBO
SUMgaW50ZXJydXB0ICovCisJb3V0bCgwLCBkZXYtPmJhc2VfYWRkciArIERDUjcpOworCisJLyog
dHJhbnNtaXQgdGhpcyBwYWNrZXQgKi8KKwl0eHB0ciA9IGRiLT50eF9pbnNlcnRfcHRyOworCW1l
bWNweSh0eHB0ci0+dHhfYnVmX3B0ciwgc2tiLT5kYXRhLCBza2ItPmxlbik7CisJdHhwdHItPnRk
ZXMxID0gY3B1X3RvX2xlMzIoMHhlMTAwMDAwMCB8IHNrYi0+bGVuKTsKKworCS8qIFBvaW50IHRv
IG5leHQgdHJhbnNtaXQgZnJlZSBkZXNjcmlwdG9yICovCisJZGItPnR4X2luc2VydF9wdHIgPSB0
eHB0ci0+bmV4dF90eF9kZXNjOworCisJLyogVHJhbnNtaXQgUGFja2V0IFByb2Nlc3MgKi8KKwlp
ZiAoIChkYi0+dHhfcGFja2V0X2NudCA8IFRYX0RFU0NfQ05UKSApIHsKKwkJdHhwdHItPnRkZXMw
ID0gY3B1X3RvX2xlMzIoMHg4MDAwMDAwMCk7CS8qIFNldCBvd25lciBiaXQgKi8KKwkJZGItPnR4
X3BhY2tldF9jbnQrKzsJCQkvKiBSZWFkeSB0byBzZW5kICovCisJCW91dGwoMHgxLCBkZXYtPmJh
c2VfYWRkciArIERDUjEpOwkvKiBJc3N1ZSBUeCBwb2xsaW5nICovCisJCWRldi0+dHJhbnNfc3Rh
cnQgPSBqaWZmaWVzOwkJLyogc2F2ZWQgdGltZSBzdGFtcCAqLworCX0KKworCS8qIFR4IHJlc291
cmNlIGNoZWNrICovCisJaWYgKCBkYi0+dHhfcGFja2V0X2NudCA8IFRYX0ZSRUVfREVTQ19DTlQg
KQorCQluZXRpZl93YWtlX3F1ZXVlKGRldik7CisKKwkvKiBSZXN0b3JlIENSNyB0byBlbmFibGUg
aW50ZXJydXB0ICovCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGItPmxvY2ssIGZsYWdzKTsK
KwlvdXRsKGRiLT5jcjdfZGF0YSwgZGV2LT5iYXNlX2FkZHIgKyBEQ1I3KTsKKwkKKwkvKiBmcmVl
IHRoaXMgU0tCICovCisJZGV2X2tmcmVlX3NrYihza2IpOworCisJcmV0dXJuIDA7Cit9CisKKwor
LyoKKyAqCVN0b3AgdGhlIGludGVyZmFjZS4KKyAqCVRoZSBpbnRlcmZhY2UgaXMgc3RvcHBlZCB3
aGVuIGl0IGlzIGJyb3VnaHQuCisgKi8KKworc3RhdGljIGludCB1bGk1MjZ4X3N0b3Aoc3RydWN0
IERFVklDRSAqZGV2KQoreworCXN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKmRiID0gbmV0ZGV2
X3ByaXYoZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlvYWRkciA9IGRldi0+YmFzZV9hZGRyOworCisJ
VUxJNTI2WF9EQlVHKDAsICJ1bGk1MjZ4X3N0b3AiLCAwKTsKKworCS8qIGRpc2FibGUgc3lzdGVt
ICovCisJbmV0aWZfc3RvcF9xdWV1ZShkZXYpOworCisJLyogZGVsZXRlZCB0aW1lciAqLworCWRl
bF90aW1lcl9zeW5jKCZkYi0+dGltZXIpOworCisJLyogUmVzZXQgJiBzdG9wIFVMSTUyNlggYm9h
cmQgKi8KKwlvdXRsKFVMSTUyNlhfUkVTRVQsIGlvYWRkciArIERDUjApOworCXVkZWxheSg1KTsK
KwlwaHlfd3JpdGUoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCAwLCAweDgwMDAsIGRiLT5jaGlw
X2lkKTsKKworCS8qIGZyZWUgaW50ZXJydXB0ICovCisJZnJlZV9pcnEoZGV2LT5pcnEsIGRldik7
CisKKwkvKiBmcmVlIGFsbG9jYXRlZCByeCBidWZmZXIgKi8KKwl1bGk1MjZ4X2ZyZWVfcnhidWZm
ZXIoZGIpOworCisjaWYgMAorCS8qIHNob3cgc3RhdGlzdGljIGNvdW50ZXIgKi8KKwlwcmludGso
RFJWX05BTUUgIjogRlU6JWx4IEVDOiVseCBMQzolbHggTkM6JWx4IExPQzolbHggVFhKVDolbHgg
UkVTRVQ6JWx4IFJDUjg6JWx4IEZBTDolbHggVFQ6JWx4XG4iLAorCQlkYi0+dHhfZmlmb191bmRl
cnJ1biwgZGItPnR4X2V4Y2Vzc2l2ZV9jb2xsaXNpb24sCisJCWRiLT50eF9sYXRlX2NvbGxpc2lv
biwgZGItPnR4X25vX2NhcnJpZXIsIGRiLT50eF9sb3NzX2NhcnJpZXIsCisJCWRiLT50eF9qYWJi
ZXJfdGltZW91dCwgZGItPnJlc2V0X2NvdW50LCBkYi0+cmVzZXRfY3I4LAorCQlkYi0+cmVzZXRf
ZmF0YWwsIGRiLT5yZXNldF9UWHRpbWVvdXQpOworI2VuZGlmCisKKwlyZXR1cm4gMDsKK30KKwor
CisvKgorICoJTTUyNjEvTTUyNjMgaW5zdGVycnVwdCBoYW5kbGVyCisgKglyZWNlaXZlIHRoZSBw
YWNrZXQgdG8gdXBwZXIgbGF5ZXIsIGZyZWUgdGhlIHRyYW5zbWl0dGVkIHBhY2tldAorICovCisK
K3N0YXRpYyBpcnFyZXR1cm5fdCB1bGk1MjZ4X2ludGVycnVwdChpbnQgaXJxLCB2b2lkICpkZXZf
aWQsIHN0cnVjdCBwdF9yZWdzICpyZWdzKQoreworCXN0cnVjdCBERVZJQ0UgKmRldiA9IGRldl9p
ZDsKKwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IG5ldGRldl9wcml2KGRldik7CisJ
dW5zaWduZWQgbG9uZyBpb2FkZHIgPSBkZXYtPmJhc2VfYWRkcjsKKwl1bnNpZ25lZCBsb25nIGZs
YWdzOworCisgICAgICAgLy9VTEk1MjZYX0RCVUcoMCwgInVsaTUyNnhfaW50ZXJydXB0KCkiLCAw
KTsKKworCWlmICghZGV2KSB7CisJCVVMSTUyNlhfREJVRygxLCAidWxpNTI2eF9pbnRlcnJ1cHQo
KSB3aXRob3V0IERFVklDRSBhcmciLCAwKTsKKwkJcmV0dXJuIElSUV9OT05FOworCX0KKworCS8v
b3V0bCgwLCBpb2FkZHIgKyBEQ1I3KTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGItPmxvY2ssIGZs
YWdzKTsKKwlvdXRsKDAsIGlvYWRkciArIERDUjcpOworCisJLyogR290IFVMSTUyNlggc3RhdHVz
ICovCisJZGItPmNyNV9kYXRhID0gaW5sKGlvYWRkciArIERDUjUpOworCW91dGwoZGItPmNyNV9k
YXRhLCBpb2FkZHIgKyBEQ1I1KTsKKwlpZiAoICEoZGItPmNyNV9kYXRhICYgMHgxODBjMSkgKSB7
CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRiLT5sb2NrLCBmbGFncyk7CisJCW91dGwoZGIt
PmNyN19kYXRhLCBpb2FkZHIgKyBEQ1I3KTsKKwkJcmV0dXJuIElSUV9IQU5ETEVEOworCX0KKwor
CS8qIERpc2FibGUgYWxsIGludGVycnVwdCBpbiBDUjcgdG8gc29sdmUgdGhlIGludGVycnVwdCBl
ZGdlIHByb2JsZW0gKi8KKwkvL291dGwoMCwgaW9hZGRyICsgRENSNyk7CisKKwkvKiBDaGVjayBz
eXN0ZW0gc3RhdHVzICovCisJaWYgKGRiLT5jcjVfZGF0YSAmIDB4MjAwMCkgeworCQkvKiBzeXN0
ZW0gYnVzIGVycm9yIGhhcHBlbiAqLworCQlVTEk1MjZYX0RCVUcoMSwgIlN5c3RlbSBidXMgZXJy
b3IgaGFwcGVuLiBDUjU9IiwgZGItPmNyNV9kYXRhKTsKKwkJZGItPnJlc2V0X2ZhdGFsKys7CisJ
CWRiLT53YWl0X3Jlc2V0ID0gMTsJLyogTmVlZCB0byBSRVNFVCAqLworCQlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZkYi0+bG9jaywgZmxhZ3MpOworCQlyZXR1cm4gSVJRX0hBTkRMRUQ7CisJfQor
CisJIC8qIFJlY2VpdmVkIHRoZSBjb21pbmcgcGFja2V0ICovCisJaWYgKCAoZGItPmNyNV9kYXRh
ICYgMHg0MCkgJiYgZGItPnJ4X2F2YWlsX2NudCApCisJCXVsaTUyNnhfcnhfcGFja2V0KGRldiwg
ZGIpOworCisJLyogcmVhbGxvY2F0ZSByeCBkZXNjcmlwdG9yIGJ1ZmZlciAqLworCWlmIChkYi0+
cnhfYXZhaWxfY250PFJYX0RFU0NfQ05UKQorCQlhbGxvY2F0ZV9yeF9idWZmZXIoZGIpOworCisJ
LyogRnJlZSB0aGUgdHJhbnNtaXR0ZWQgZGVzY3JpcHRvciAqLworCWlmICggZGItPmNyNV9kYXRh
ICYgMHgwMSkKKwkJdWxpNTI2eF9mcmVlX3R4X3BrdChkZXYsIGRiKTsKKworCS8qIFJlc3RvcmUg
Q1I3IHRvIGVuYWJsZSBpbnRlcnJ1cHQgbWFzayAqLworCW91dGwoZGItPmNyN19kYXRhLCBpb2Fk
ZHIgKyBEQ1I3KTsKKworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRiLT5sb2NrLCBmbGFncyk7
CisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCisKKy8qCisgKglGcmVlIFRYIHJlc291cmNlIGFm
dGVyIFRYIGNvbXBsZXRlCisgKi8KKworc3RhdGljIHZvaWQgdWxpNTI2eF9mcmVlX3R4X3BrdChz
dHJ1Y3QgREVWSUNFICpkZXYsIHN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKiBkYikKK3sKKwlz
dHJ1Y3QgdHhfZGVzYyAqdHhwdHI7CisvLwl1bnNpZ25lZCBsb25nIGlvYWRkciA9IGRldi0+YmFz
ZV9hZGRyOworCXUzMiB0ZGVzMDsKKworCXR4cHRyID0gZGItPnR4X3JlbW92ZV9wdHI7CisJd2hp
bGUoZGItPnR4X3BhY2tldF9jbnQpIHsKKwkJdGRlczAgPSBsZTMyX3RvX2NwdSh0eHB0ci0+dGRl
czApOworCQkvKiBwcmludGsoRFJWX05BTUUgIjogdGRlczA9JXhcbiIsIHRkZXMwKTsgKi8KKwkJ
aWYgKHRkZXMwICYgMHg4MDAwMDAwMCkKKwkJCWJyZWFrOworCisJCS8qIEEgcGFja2V0IHNlbnQg
Y29tcGxldGVkICovCisJCWRiLT50eF9wYWNrZXRfY250LS07CisJCWRiLT5zdGF0cy50eF9wYWNr
ZXRzKys7CisKKwkJLyogVHJhbnNtaXQgc3RhdGlzdGljIGNvdW50ZXIgKi8KKwkJaWYgKCB0ZGVz
MCAhPSAweDdmZmZmZmZmICkgeworCQkJLyogcHJpbnRrKERSVl9OQU1FICI6IHRkZXMwPSV4XG4i
LCB0ZGVzMCk7ICovCisJCQlkYi0+c3RhdHMuY29sbGlzaW9ucyArPSAodGRlczAgPj4gMykgJiAw
eGY7CisJCQlkYi0+c3RhdHMudHhfYnl0ZXMgKz0gbGUzMl90b19jcHUodHhwdHItPnRkZXMxKSAm
IDB4N2ZmOworCQkJaWYgKHRkZXMwICYgVERFUzBfRVJSX01BU0spIHsKKwkJCQlkYi0+c3RhdHMu
dHhfZXJyb3JzKys7CisJCQkJaWYgKHRkZXMwICYgMHgwMDAyKSB7CS8qIFVuZGVyUnVuICovCisJ
CQkJCWRiLT50eF9maWZvX3VuZGVycnVuKys7CisJCQkJCWlmICggIShkYi0+Y3I2X2RhdGEgJiBD
UjZfU0ZUKSApIHsKKwkJCQkJCWRiLT5jcjZfZGF0YSA9IGRiLT5jcjZfZGF0YSB8IENSNl9TRlQ7
CisJCQkJCQl1cGRhdGVfY3I2KGRiLT5jcjZfZGF0YSwgZGItPmlvYWRkcik7CisJCQkJCX0KKwkJ
CQl9CisJCQkJaWYgKHRkZXMwICYgMHgwMTAwKQorCQkJCQlkYi0+dHhfZXhjZXNzaXZlX2NvbGxp
c2lvbisrOworCQkJCWlmICh0ZGVzMCAmIDB4MDIwMCkKKwkJCQkJZGItPnR4X2xhdGVfY29sbGlz
aW9uKys7CisJCQkJaWYgKHRkZXMwICYgMHgwNDAwKQorCQkJCQlkYi0+dHhfbm9fY2Fycmllcisr
OworCQkJCWlmICh0ZGVzMCAmIDB4MDgwMCkKKwkJCQkJZGItPnR4X2xvc3NfY2FycmllcisrOwor
CQkJCWlmICh0ZGVzMCAmIDB4NDAwMCkKKwkJCQkJZGItPnR4X2phYmJlcl90aW1lb3V0Kys7CisJ
CQl9CisJCX0KKworICAgIAkJdHhwdHIgPSB0eHB0ci0+bmV4dF90eF9kZXNjOworCX0vKiBFbmQg
b2Ygd2hpbGUgKi8KKworCS8qIFVwZGF0ZSBUWCByZW1vdmUgcG9pbnRlciB0byBuZXh0ICovCisJ
ZGItPnR4X3JlbW92ZV9wdHIgPSB0eHB0cjsKKworCS8qIFJlc291cmNlIGF2YWlsYWJsZSBjaGVj
ayAqLworCWlmICggZGItPnR4X3BhY2tldF9jbnQgPCBUWF9XQUtFX0RFU0NfQ05UICkKKwkJbmV0
aWZfd2FrZV9xdWV1ZShkZXYpOwkvKiBBY3RpdmUgdXBwZXIgbGF5ZXIsIHNlbmQgYWdhaW4gKi8K
K30KKworCisvKgorICoJUmVjZWl2ZSB0aGUgY29tZSBwYWNrZXQgYW5kIHBhc3MgdG8gdXBwZXIg
bGF5ZXIKKyAqLworCitzdGF0aWMgdm9pZCB1bGk1MjZ4X3J4X3BhY2tldChzdHJ1Y3QgREVWSUNF
ICpkZXYsIHN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKiBkYikKK3sKKwlzdHJ1Y3QgcnhfZGVz
YyAqcnhwdHI7CisJc3RydWN0IHNrX2J1ZmYgKnNrYjsKKwlpbnQgcnhsZW47CisJdTMyIHJkZXMw
OworCQorCXJ4cHRyID0gZGItPnJ4X3JlYWR5X3B0cjsKKworCXdoaWxlKGRiLT5yeF9hdmFpbF9j
bnQpIHsKKwkJcmRlczAgPSBsZTMyX3RvX2NwdShyeHB0ci0+cmRlczApOworCQlpZiAocmRlczAg
JiAweDgwMDAwMDAwKQkvKiBwYWNrZXQgb3duZXIgY2hlY2sgKi8KKwkJeworCQkJYnJlYWs7CisJ
CX0KKworCQlkYi0+cnhfYXZhaWxfY250LS07CisJCWRiLT5pbnRlcnZhbF9yeF9jbnQrKzsKKwor
CQlwY2lfdW5tYXBfc2luZ2xlKGRiLT5wZGV2LCBsZTMyX3RvX2NwdShyeHB0ci0+cmRlczIpLCBS
WF9BTExPQ19TSVpFLCBQQ0lfRE1BX0ZST01ERVZJQ0UpOworCQlpZiAoIChyZGVzMCAmIDB4MzAw
KSAhPSAweDMwMCkgeworCQkJLyogQSBwYWNrZXQgd2l0aG91dCBGaXJzdC9MYXN0IGZsYWcgKi8K
KwkJCS8qIHJldXNlIHRoaXMgU0tCICovCisJCQlVTEk1MjZYX0RCVUcoMCwgIlJldXNlIFNLIGJ1
ZmZlciwgcmRlczAiLCByZGVzMCk7CisJCQl1bGk1MjZ4X3JldXNlX3NrYihkYiwgcnhwdHItPnJ4
X3NrYl9wdHIpOworCQl9IGVsc2UgeworCQkJLyogQSBwYWNrZXQgd2l0aCBGaXJzdC9MYXN0IGZs
YWcgKi8KKwkJCXJ4bGVuID0gKCAocmRlczAgPj4gMTYpICYgMHgzZmZmKSAtIDQ7CisKKwkJCS8q
IGVycm9yIHN1bW1hcnkgYml0IGNoZWNrICovCisJCQlpZiAocmRlczAgJiAweDgwMDApIHsKKwkJ
CQkvKiBUaGlzIGlzIGEgZXJyb3IgcGFja2V0ICovCisJCQkJLy9wcmludGsoRFJWX05BTUUgIjog
cmRlczA6ICVseFxuIiwgcmRlczApOworCQkJCWRiLT5zdGF0cy5yeF9lcnJvcnMrKzsKKwkJCQlp
ZiAocmRlczAgJiAxKQorCQkJCQlkYi0+c3RhdHMucnhfZmlmb19lcnJvcnMrKzsKKwkJCQlpZiAo
cmRlczAgJiAyKQorCQkJCQlkYi0+c3RhdHMucnhfY3JjX2Vycm9ycysrOworCQkJCWlmIChyZGVz
MCAmIDB4ODApCisJCQkJCWRiLT5zdGF0cy5yeF9sZW5ndGhfZXJyb3JzKys7CisJCQl9CisKKwkJ
CWlmICggIShyZGVzMCAmIDB4ODAwMCkgfHwKKwkJCQkoKGRiLT5jcjZfZGF0YSAmIENSNl9QTSkg
JiYgKHJ4bGVuPjYpKSApIHsKKwkJCQlza2IgPSByeHB0ci0+cnhfc2tiX3B0cjsKKwkJCisJCQkJ
LyogR29vZCBwYWNrZXQsIHNlbmQgdG8gdXBwZXIgbGF5ZXIgKi8KKwkJCQkvKiBTaG9yc3QgcGFj
a2V0IHVzZWQgbmV3IFNLQiAqLworCQkJCWlmICggKHJ4bGVuIDwgUlhfQ09QWV9TSVpFKSAmJgor
CQkJCQkoIChza2IgPSBkZXZfYWxsb2Nfc2tiKHJ4bGVuICsgMikgKQorCQkJCQkhPSBOVUxMKSAp
IHsKKwkJCQkJLyogc2l6ZSBsZXNzIHRoYW4gQ09QWV9TSVpFLCBhbGxvY2F0ZSBhIHJ4bGVuIFNL
QiAqLworCQkJCQlza2ItPmRldiA9IGRldjsKKwkJCQkJc2tiX3Jlc2VydmUoc2tiLCAyKTsgLyog
MTZieXRlIGFsaWduICovCisJCQkJCW1lbWNweShza2JfcHV0KHNrYiwgcnhsZW4pLCByeHB0ci0+
cnhfc2tiX3B0ci0+dGFpbCwgcnhsZW4pOworCQkJCQl1bGk1MjZ4X3JldXNlX3NrYihkYiwgcnhw
dHItPnJ4X3NrYl9wdHIpOworCQkJCX0gZWxzZSB7CisJCQkJCXNrYi0+ZGV2ID0gZGV2OworCQkJ
CQlza2JfcHV0KHNrYiwgcnhsZW4pOworCQkJCX0KKwkJCQlza2ItPnByb3RvY29sID0gZXRoX3R5
cGVfdHJhbnMoc2tiLCBkZXYpOworCQkJCW5ldGlmX3J4KHNrYik7CisJCQkJZGV2LT5sYXN0X3J4
ID0gamlmZmllczsKKwkJCQlkYi0+c3RhdHMucnhfcGFja2V0cysrOworCQkJCWRiLT5zdGF0cy5y
eF9ieXRlcyArPSByeGxlbjsKKwkJCQkKKwkJCX0gZWxzZSB7CisJCQkJLyogUmV1c2UgU0tCIGJ1
ZmZlciB3aGVuIHRoZSBwYWNrZXQgaXMgZXJyb3IgKi8KKwkJCQlVTEk1MjZYX0RCVUcoMCwgIlJl
dXNlIFNLIGJ1ZmZlciwgcmRlczAiLCByZGVzMCk7CisJCQkJdWxpNTI2eF9yZXVzZV9za2IoZGIs
IHJ4cHRyLT5yeF9za2JfcHRyKTsKKwkJCX0KKwkJfQorCisJCXJ4cHRyID0gcnhwdHItPm5leHRf
cnhfZGVzYzsKKwl9CisKKwlkYi0+cnhfcmVhZHlfcHRyID0gcnhwdHI7Cit9CisKKworLyoKKyAq
CUdldCBzdGF0aXN0aWNzIGZyb20gZHJpdmVyLgorICovCisKK3N0YXRpYyBzdHJ1Y3QgbmV0X2Rl
dmljZV9zdGF0cyAqIHVsaTUyNnhfZ2V0X3N0YXRzKHN0cnVjdCBERVZJQ0UgKmRldikKK3sKKwlz
dHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IG5ldGRldl9wcml2KGRldik7CisKKwlVTEk1
MjZYX0RCVUcoMCwgInVsaTUyNnhfZ2V0X3N0YXRzIiwgMCk7CisJcmV0dXJuICZkYi0+c3RhdHM7
Cit9CisKKworLyoKKyAqIFNldCBVTEk1MjZYIG11bHRpY2FzdCBhZGRyZXNzCisgKi8KKworc3Rh
dGljIHZvaWQgdWxpNTI2eF9zZXRfZmlsdGVyX21vZGUoc3RydWN0IERFVklDRSAqIGRldikKK3sK
KwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IGRldi0+cHJpdjsKKwl1bnNpZ25lZCBs
b25nIGZsYWdzOworCisJVUxJNTI2WF9EQlVHKDAsICJ1bGk1MjZ4X3NldF9maWx0ZXJfbW9kZSgp
IiwgMCk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmRiLT5sb2NrLCBmbGFncyk7CisKKwlpZiAoZGV2
LT5mbGFncyAmIElGRl9QUk9NSVNDKSB7CisJCVVMSTUyNlhfREJVRygwLCAiRW5hYmxlIFBST00g
TW9kZSIsIDApOworCQlkYi0+Y3I2X2RhdGEgfD0gQ1I2X1BNIHwgQ1I2X1BCRjsKKwkJdXBkYXRl
X2NyNihkYi0+Y3I2X2RhdGEsIGRiLT5pb2FkZHIpOworCQlzcGluX3VubG9ja19pcnFyZXN0b3Jl
KCZkYi0+bG9jaywgZmxhZ3MpOworCQlyZXR1cm47CisJfQorCisJaWYgKGRldi0+ZmxhZ3MgJiBJ
RkZfQUxMTVVMVEkgfHwgZGV2LT5tY19jb3VudCA+IFVMSTUyNjFfTUFYX01VTFRJQ0FTVCkgewor
CQlVTEk1MjZYX0RCVUcoMCwgIlBhc3MgYWxsIG11bHRpY2FzdCBhZGRyZXNzIiwgZGV2LT5tY19j
b3VudCk7CisJCWRiLT5jcjZfZGF0YSAmPSB+KENSNl9QTSB8IENSNl9QQkYpOworCQlkYi0+Y3I2
X2RhdGEgfD0gQ1I2X1BBTTsKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGItPmxvY2ssIGZs
YWdzKTsKKwkJcmV0dXJuOworCX0KKworCVVMSTUyNlhfREJVRygwLCAiU2V0IG11bHRpY2FzdCBh
ZGRyZXNzIiwgZGV2LT5tY19jb3VudCk7CisJc2VuZF9maWx0ZXJfZnJhbWUoZGV2LCBkZXYtPm1j
X2NvdW50KTsgCS8qIE01MjYxL001MjYzICovCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGIt
PmxvY2ssIGZsYWdzKTsKK30KKworc3RhdGljIHZvaWQKK1VMaV9ldGh0b29sX2dzZXQoc3RydWN0
IHVsaTUyNnhfYm9hcmRfaW5mbyAqZGIsIHN0cnVjdCBldGh0b29sX2NtZCAqZWNtZCkKK3sKKwkv
L3N0cnVjdCBlMTAwMF9odyAqaHcgPSAmYWRhcHRlci0+aHc7CisKKwl7CisKKwkJZWNtZC0+c3Vw
cG9ydGVkID0gKFNVUFBPUlRFRF8xMGJhc2VUX0hhbGYgfAorCQkgICAgICAgICAgICAgICAgICAg
U1VQUE9SVEVEXzEwYmFzZVRfRnVsbCB8CisJCSAgICAgICAgICAgICAgICAgICBTVVBQT1JURURf
MTAwYmFzZVRfSGFsZiB8CisJCSAgICAgICAgICAgICAgICAgICBTVVBQT1JURURfMTAwYmFzZVRf
RnVsbCB8CisJCSAgICAgICAgICAgICAgICAgICBTVVBQT1JURURfQXV0b25lZyB8CisJCSAgICAg
ICAgICAgICAgICAgICBTVVBQT1JURURfTUlJKTsKKwkJCisJCWVjbWQtPmFkdmVydGlzaW5nID0g
KEFEVkVSVElTRURfMTBiYXNlVF9IYWxmIHwKKwkJICAgICAgICAgICAgICAgICAgIEFEVkVSVElT
RURfMTBiYXNlVF9GdWxsIHwKKwkJICAgICAgICAgICAgICAgICAgIEFEVkVSVElTRURfMTAwYmFz
ZVRfSGFsZiB8CisJCSAgICAgICAgICAgICAgICAgICBBRFZFUlRJU0VEXzEwMGJhc2VUX0Z1bGwg
fAorCQkgICAgICAgICAgICAgICAgICAgQURWRVJUSVNFRF9BdXRvbmVnIHwKKwkJICAgICAgICAg
ICAgICAgICAgIEFEVkVSVElTRURfTUlJKTsKKworCisJCWVjbWQtPnBvcnQgPSBQT1JUX01JSTsK
KwkJZWNtZC0+cGh5X2FkZHJlc3MgPSBkYi0+cGh5X2FkZHI7CisKKwkJZWNtZC0+dHJhbnNjZWl2
ZXIgPSBYQ1ZSX0VYVEVSTkFMOworCQkKKworCX0KKworCQorCWVjbWQtPnNwZWVkID0gMTA7CisJ
ZWNtZC0+ZHVwbGV4ID0gRFVQTEVYX0hBTEY7CisJCisJaWYoZGItPm9wX21vZGU9PVVMSTUyNlhf
MTAwTUhGIHx8IGRiLT5vcF9tb2RlPT1VTEk1MjZYXzEwME1GRCkKKwl7CisJCWVjbWQtPnNwZWVk
ID0gMTAwOyAgICAgICAgICAgICAgIAorCX0KKwlpZihkYi0+b3BfbW9kZT09VUxJNTI2WF8xME1G
RCB8fCBkYi0+b3BfbW9kZT09VUxJNTI2WF8xMDBNRkQpCisJeworCQllY21kLT5kdXBsZXggPSBE
VVBMRVhfRlVMTDsKKwl9CisJaWYoZGItPmxpbmtfZmFpbGVkKQorCXsKKwkJZWNtZC0+c3BlZWQg
PSAtMTsKKwkJZWNtZC0+ZHVwbGV4ID0gLTE7CQorCX0KKwkKKwlpZiAoZGItPm1lZGlhX21vZGUg
JiBVTEk1MjZYX0FVVE8pCisJewkKKwkJZWNtZC0+YXV0b25lZyA9IEFVVE9ORUdfRU5BQkxFOwor
CX0KKwkKKwkKK30KKworc3RhdGljIHZvaWQgbmV0ZGV2X2dldF9kcnZpbmZvKHN0cnVjdCBuZXRf
ZGV2aWNlICpkZXYsCisJCQkgICAgICAgc3RydWN0IGV0aHRvb2xfZHJ2aW5mbyAqaW5mbykKK3sK
KwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpucCA9IG5ldGRldl9wcml2KGRldik7CisKKwlz
dHJjcHkoaW5mby0+ZHJpdmVyLCBEUlZfTkFNRSk7CisJc3RyY3B5KGluZm8tPnZlcnNpb24sIERS
Vl9WRVJTSU9OKTsKKwlpZiAobnAtPnBkZXYpCisJCXN0cmNweShpbmZvLT5idXNfaW5mbywgcGNp
X25hbWUobnAtPnBkZXYpKTsKKwllbHNlCisJCXNwcmludGYoaW5mby0+YnVzX2luZm8sICJFSVNB
IDB4JWx4ICVkIiwKKwkJCWRldi0+YmFzZV9hZGRyLCBkZXYtPmlycSk7Cit9CisKK3N0YXRpYyBp
bnQgbmV0ZGV2X2dldF9zZXR0aW5ncyhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LCBzdHJ1Y3QgZXRo
dG9vbF9jbWQgKmNtZCkgeworCXN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKm5wID0gbmV0ZGV2
X3ByaXYoZGV2KTsKKwkKKwlVTGlfZXRodG9vbF9nc2V0KG5wLCBjbWQpOworCQorCXJldHVybiAw
OworfQorCitzdGF0aWMgdTMyIG5ldGRldl9nZXRfbGluayhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2
KSB7CisJc3RydWN0IHVsaTUyNnhfYm9hcmRfaW5mbyAqbnAgPSBuZXRkZXZfcHJpdihkZXYpOwor
CQkKKwlpZihucC0+bGlua19mYWlsZWQpCisJCXJldHVybiAwOworCWVsc2UKKwkJcmV0dXJuIDE7
Cit9CisKK3N0YXRpYyB2b2lkIHVsaTUyNnhfZ2V0X3dvbChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2
LCBzdHJ1Y3QgZXRodG9vbF93b2xpbmZvICp3b2wpCit7CisJd29sLT5zdXBwb3J0ZWQgPSBXQUtF
X1BIWSB8IFdBS0VfTUFHSUM7CisJd29sLT53b2xvcHRzID0gMDsKK30KKworc3RhdGljIHN0cnVj
dCBldGh0b29sX29wcyBuZXRkZXZfZXRodG9vbF9vcHMgPSB7CisJLmdldF9kcnZpbmZvCQk9IG5l
dGRldl9nZXRfZHJ2aW5mbywKKwkuZ2V0X3NldHRpbmdzCQk9IG5ldGRldl9nZXRfc2V0dGluZ3Ms
CisJLmdldF9saW5rCQk9IG5ldGRldl9nZXRfbGluaywKKwkuZ2V0X3dvbAkJPSB1bGk1MjZ4X2dl
dF93b2wsCit9OworCisvKgorICoJQSBwZXJpb2RpYyB0aW1lciByb3V0aW5lCisgKglEeW5hbWlj
IG1lZGlhIHNlbnNlLCBhbGxvY2F0ZSBSeCBidWZmZXIuLi4KKyAqLworCitzdGF0aWMgdm9pZCB1
bGk1MjZ4X3RpbWVyKHVuc2lnbmVkIGxvbmcgZGF0YSkKK3sKKwl1MzIgdG1wX2NyODsKKwl1bnNp
Z25lZCBjaGFyIHRtcF9jcjEyPTA7CisJc3RydWN0IERFVklDRSAqZGV2ID0gKHN0cnVjdCBERVZJ
Q0UgKikgZGF0YTsKKwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IG5ldGRldl9wcml2
KGRldik7CisgCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJdTggVG1wU3BlZWQ9MTA7CisJCisJLy9V
TEk1MjZYX0RCVUcoMCwgInVsaTUyNnhfdGltZXIoKSIsIDApOworCXNwaW5fbG9ja19pcnFzYXZl
KCZkYi0+bG9jaywgZmxhZ3MpOworCisJCisJLyogRHluYW1pYyByZXNldCBVTEk1MjZYIDogc3lz
dGVtIGVycm9yIG9yIHRyYW5zbWl0IHRpbWUtb3V0ICovCisJdG1wX2NyOCA9IGlubChkYi0+aW9h
ZGRyICsgRENSOCk7CisJaWYgKCAoZGItPmludGVydmFsX3J4X2NudD09MCkgJiYgKHRtcF9jcjgp
ICkgeworCQlkYi0+cmVzZXRfY3I4Kys7CisJCWRiLT53YWl0X3Jlc2V0ID0gMTsKKwl9CisJZGIt
PmludGVydmFsX3J4X2NudCA9IDA7CisKKwkvKiBUWCBwb2xsaW5nIGtpY2sgbW9uaXRvciAqLwor
CWlmICggZGItPnR4X3BhY2tldF9jbnQgJiYKKwkgICAgIHRpbWVfYWZ0ZXIoamlmZmllcywgZGV2
LT50cmFuc19zdGFydCArIFVMSTUyNlhfVFhfS0lDSykgKSB7CisJCW91dGwoMHgxLCBkZXYtPmJh
c2VfYWRkciArIERDUjEpOyAgIC8vIFR4IHBvbGxpbmcgYWdhaW4gCisKKwkJLy8gVFggVGltZW91
dCAKKwkJaWYgKCB0aW1lX2FmdGVyKGppZmZpZXMsIGRldi0+dHJhbnNfc3RhcnQgKyBVTEk1MjZY
X1RYX1RJTUVPVVQpICkgeworCQkJZGItPnJlc2V0X1RYdGltZW91dCsrOworCQkJZGItPndhaXRf
cmVzZXQgPSAxOworCQkJcHJpbnRrKCAiJXM6IFR4IHRpbWVvdXQgLSByZXNldHRpbmdcbiIsCisJ
CQkgICAgICAgZGV2LT5uYW1lKTsKKwkJfQorCX0KKworCWlmIChkYi0+d2FpdF9yZXNldCkgewor
CQlVTEk1MjZYX0RCVUcoMCwgIkR5bmFtaWMgUmVzZXQgZGV2aWNlIiwgZGItPnR4X3BhY2tldF9j
bnQpOworCQlkYi0+cmVzZXRfY291bnQrKzsKKwkJdWxpNTI2eF9keW5hbWljX3Jlc2V0KGRldik7
CisJCWRiLT50aW1lci5leHBpcmVzID0gVUxJNTI2WF9USU1FUl9XVVQ7CisJCWFkZF90aW1lcigm
ZGItPnRpbWVyKTsKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGItPmxvY2ssIGZsYWdzKTsK
KwkJcmV0dXJuOworCX0KKworCS8qIExpbmsgc3RhdHVzIGNoZWNrLCBEeW5hbWljIG1lZGlhIHR5
cGUgY2hhbmdlICovCisJaWYoKHBoeV9yZWFkKGRiLT5pb2FkZHIsIGRiLT5waHlfYWRkciwgNSwg
ZGItPmNoaXBfaWQpICYgMHgwMWUwKSE9MCkKKwkJdG1wX2NyMTIgPSAzOworCisJaWYgKCAhKHRt
cF9jcjEyICYgMHgzKSAmJiAhZGItPmxpbmtfZmFpbGVkICkgeworCQkvKiBMaW5rIEZhaWxlZCAq
LworCQlVTEk1MjZYX0RCVUcoMCwgIkxpbmsgRmFpbGVkIiwgdG1wX2NyMTIpOworCQluZXRpZl9j
YXJyaWVyX29mZihkZXYpOworCQlwcmludGsoS0VSTl9JTkZPICJ1bGk1MjZ4OiAlcyBOSUMgTGlu
ayBpcyBEb3duXG4iLGRldi0+bmFtZSk7CisJCWRiLT5saW5rX2ZhaWxlZCA9IDE7CisKKwkJLyog
Rm9yIEZvcmNlIDEwLzEwME0gSGFsZi9GdWxsIG1vZGU6IEVuYWJsZSBBdXRvLU5lZ28gbW9kZSAq
LworCQkvKiBBVVRPIGRvbid0IG5lZWQgKi8KKwkJaWYgKCAhKGRiLT5tZWRpYV9tb2RlICYgMHg4
KSApCisJCQlwaHlfd3JpdGUoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCAwLCAweDEwMDAsIGRi
LT5jaGlwX2lkKTsKKworCQkvKiBBVVRPIG1vZGUsIGlmIElOVCBwaHl4Y2VyIGxpbmsgZmFpbGVk
LCBzZWxlY3QgRVhUIGRldmljZSAqLworCQlpZiAoZGItPm1lZGlhX21vZGUgJiBVTEk1MjZYX0FV
VE8pIHsKKwkJCWRiLT5jcjZfZGF0YSY9fjB4MDAwMDAyMDA7CS8qIGJpdDk9MCwgSEQgbW9kZSAq
LworCQkJdXBkYXRlX2NyNihkYi0+Y3I2X2RhdGEsIGRiLT5pb2FkZHIpOworCQl9CisJfSBlbHNl
CisJCWlmICgodG1wX2NyMTIgJiAweDMpICYmIGRiLT5saW5rX2ZhaWxlZCkgeworCQkJVUxJNTI2
WF9EQlVHKDAsICJMaW5rIGxpbmsgT0siLCB0bXBfY3IxMik7CisJCQlkYi0+bGlua19mYWlsZWQg
PSAwOworCisJCQkvKiBBdXRvIFNlbnNlIFNwZWVkICovCisJCQlpZiAoIChkYi0+bWVkaWFfbW9k
ZSAmIFVMSTUyNlhfQVVUTykgJiYKKwkJCQl1bGk1MjZ4X3NlbnNlX3NwZWVkKGRiKSApCisJCQkJ
ZGItPmxpbmtfZmFpbGVkID0gMTsKKwkJCXVsaTUyNnhfcHJvY2Vzc19tb2RlKGRiKTsKKwkJCQor
CQkJaWYoZGItPmxpbmtfZmFpbGVkPT0wKQorCQkJeworCQkJCWlmKGRiLT5vcF9tb2RlPT1VTEk1
MjZYXzEwME1IRiB8fCBkYi0+b3BfbW9kZT09VUxJNTI2WF8xMDBNRkQpCisJCQkJeworCQkJCQlU
bXBTcGVlZCA9IDEwMDsKKwkJCQl9CisJCQkJaWYoZGItPm9wX21vZGU9PVVMSTUyNlhfMTBNRkQg
fHwgZGItPm9wX21vZGU9PVVMSTUyNlhfMTAwTUZEKQorCQkJCXsKKwkJCQkJcHJpbnRrKEtFUk5f
SU5GTyAidWxpNTI2eDogJXMgTklDIExpbmsgaXMgVXAgJWQgTWJwcyBGdWxsIGR1cGxleFxuIixk
ZXYtPm5hbWUsVG1wU3BlZWQpOworCQkJCX0KKwkJCQllbHNlCisJCQkJeworCQkJCQlwcmludGso
S0VSTl9JTkZPICJ1bGk1MjZ4OiAlcyBOSUMgTGluayBpcyBVcCAlZCBNYnBzIEhhbGYgZHVwbGV4
XG4iLGRldi0+bmFtZSxUbXBTcGVlZCk7CisJCQkJfQorCQkJCW5ldGlmX2NhcnJpZXJfb24oZGV2
KTsKKwkJCX0KKwkJCS8qIFNIT1dfTUVESUFfVFlQRShkYi0+b3BfbW9kZSk7ICovCisJCX0KKwkJ
ZWxzZSBpZighKHRtcF9jcjEyICYgMHgzKSAmJiBkYi0+bGlua19mYWlsZWQpCisJCXsKKwkJCWlm
KGRiLT5pbml0PT0xKQorCQkJeworCQkJCXByaW50ayhLRVJOX0lORk8gInVsaTUyNng6ICVzIE5J
QyBMaW5rIGlzIERvd25cbiIsZGV2LT5uYW1lKTsKKwkJCQluZXRpZl9jYXJyaWVyX29mZihkZXYp
OworCQkJfQorCQl9CisJCWRiLT5pbml0PTA7CisKKwkvKiBUaW1lciBhY3RpdmUgYWdhaW4gKi8K
KwlkYi0+dGltZXIuZXhwaXJlcyA9IFVMSTUyNlhfVElNRVJfV1VUOworCWFkZF90aW1lcigmZGIt
PnRpbWVyKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkYi0+bG9jaywgZmxhZ3MpOworfQor
CisKKy8qCisgKglEeW5hbWljIHJlc2V0IHRoZSBVTEk1MjZYIGJvYXJkCisgKglTdG9wIFVMSTUy
NlggYm9hcmQKKyAqCUZyZWUgVHgvUnggYWxsb2NhdGVkIG1lbW9yeQorICoJUmVzZXQgVUxJNTI2
WCBib2FyZAorICoJUmUtaW5pdGlsaXplIFVMSTUyNlggYm9hcmQKKyAqLworCitzdGF0aWMgdm9p
ZCB1bGk1MjZ4X2R5bmFtaWNfcmVzZXQoc3RydWN0IERFVklDRSAqZGV2KQoreworCXN0cnVjdCB1
bGk1MjZ4X2JvYXJkX2luZm8gKmRiID0gbmV0ZGV2X3ByaXYoZGV2KTsKKworCVVMSTUyNlhfREJV
RygwLCAidWxpNTI2eF9keW5hbWljX3Jlc2V0KCkiLCAwKTsKKworCS8qIFNvcHQgTUFDIGNvbnRy
b2xsZXIgKi8KKwlkYi0+Y3I2X2RhdGEgJj0gfihDUjZfUlhTQyB8IENSNl9UWFNDKTsJLyogRGlz
YWJsZSBUeC9SeCAqLworCXVwZGF0ZV9jcjYoZGItPmNyNl9kYXRhLCBkZXYtPmJhc2VfYWRkcik7
CisJb3V0bCgwLCBkZXYtPmJhc2VfYWRkciArIERDUjcpOwkJLyogRGlzYWJsZSBJbnRlcnJ1cHQg
Ki8KKwlvdXRsKGlubChkZXYtPmJhc2VfYWRkciArIERDUjUpLCBkZXYtPmJhc2VfYWRkciArIERD
UjUpOworCisJLyogRGlzYWJsZSB1cHBlciBsYXllciBpbnRlcmZhY2UgKi8KKwluZXRpZl9zdG9w
X3F1ZXVlKGRldik7CisKKwkvKiBGcmVlIFJ4IEFsbG9jYXRlIGJ1ZmZlciAqLworCXVsaTUyNnhf
ZnJlZV9yeGJ1ZmZlcihkYik7CisKKwkvKiBzeXN0ZW0gdmFyaWFibGUgaW5pdCAqLworCWRiLT50
eF9wYWNrZXRfY250ID0gMDsKKwlkYi0+cnhfYXZhaWxfY250ID0gMDsKKwlkYi0+bGlua19mYWls
ZWQgPSAxOworCWRiLT5pbml0PTE7CisJZGItPndhaXRfcmVzZXQgPSAwOworCisJLyogUmUtaW5p
dGlsaXplIFVMSTUyNlggYm9hcmQgKi8KKwl1bGk1MjZ4X2luaXQoZGV2KTsKKworCS8qIFJlc3Rh
cnQgdXBwZXIgbGF5ZXIgaW50ZXJmYWNlICovCisJbmV0aWZfd2FrZV9xdWV1ZShkZXYpOworfQor
CisKKy8qCisgKglmcmVlIGFsbCBhbGxvY2F0ZWQgcnggYnVmZmVyCisgKi8KKworc3RhdGljIHZv
aWQgdWxpNTI2eF9mcmVlX3J4YnVmZmVyKHN0cnVjdCB1bGk1MjZ4X2JvYXJkX2luZm8gKiBkYikK
K3sKKwlVTEk1MjZYX0RCVUcoMCwgInVsaTUyNnhfZnJlZV9yeGJ1ZmZlcigpIiwgMCk7CisKKwkv
KiBmcmVlIGFsbG9jYXRlZCByeCBidWZmZXIgKi8KKwl3aGlsZSAoZGItPnJ4X2F2YWlsX2NudCkg
eworCQlkZXZfa2ZyZWVfc2tiKGRiLT5yeF9yZWFkeV9wdHItPnJ4X3NrYl9wdHIpOworCQlkYi0+
cnhfcmVhZHlfcHRyID0gZGItPnJ4X3JlYWR5X3B0ci0+bmV4dF9yeF9kZXNjOworCQlkYi0+cnhf
YXZhaWxfY250LS07CisJfQorfQorCisKKy8qCisgKglSZXVzZSB0aGUgU0sgYnVmZmVyCisgKi8K
Kworc3RhdGljIHZvaWQgdWxpNTI2eF9yZXVzZV9za2Ioc3RydWN0IHVsaTUyNnhfYm9hcmRfaW5m
byAqZGIsIHN0cnVjdCBza19idWZmICogc2tiKQoreworCXN0cnVjdCByeF9kZXNjICpyeHB0ciA9
IGRiLT5yeF9pbnNlcnRfcHRyOworCisJaWYgKCEocnhwdHItPnJkZXMwICYgY3B1X3RvX2xlMzIo
MHg4MDAwMDAwMCkpKSB7CisJCXJ4cHRyLT5yeF9za2JfcHRyID0gc2tiOworCQlyeHB0ci0+cmRl
czIgPSBjcHVfdG9fbGUzMiggcGNpX21hcF9zaW5nbGUoZGItPnBkZXYsIHNrYi0+dGFpbCwgUlhf
QUxMT0NfU0laRSwgUENJX0RNQV9GUk9NREVWSUNFKSApOworCQl3bWIoKTsKKwkJcnhwdHItPnJk
ZXMwID0gY3B1X3RvX2xlMzIoMHg4MDAwMDAwMCk7CisJCWRiLT5yeF9hdmFpbF9jbnQrKzsKKwkJ
ZGItPnJ4X2luc2VydF9wdHIgPSByeHB0ci0+bmV4dF9yeF9kZXNjOworCX0gZWxzZQorCQlVTEk1
MjZYX0RCVUcoMCwgIlNLIEJ1ZmZlciByZXVzZSBtZXRob2QgZXJyb3IiLCBkYi0+cnhfYXZhaWxf
Y250KTsKK30KKworCisvKgorICoJSW5pdGlhbGl6ZSB0cmFuc21pdC9SZWNlaXZlIGRlc2NyaXB0
b3IKKyAqCVVzaW5nIENoYWluIHN0cnVjdHVyZSwgYW5kIGFsbG9jYXRlIFR4L1J4IGJ1ZmZlcgor
ICovCisKK3N0YXRpYyB2b2lkIHVsaTUyNnhfZGVzY3JpcHRvcl9pbml0KHN0cnVjdCB1bGk1MjZ4
X2JvYXJkX2luZm8gKmRiLCB1bnNpZ25lZCBsb25nIGlvYWRkcikKK3sKKwlzdHJ1Y3QgdHhfZGVz
YyAqdG1wX3R4OworCXN0cnVjdCByeF9kZXNjICp0bXBfcng7CisJdW5zaWduZWQgY2hhciAqdG1w
X2J1ZjsKKwlkbWFfYWRkcl90IHRtcF90eF9kbWEsIHRtcF9yeF9kbWE7CisJZG1hX2FkZHJfdCB0
bXBfYnVmX2RtYTsKKwlpbnQgaTsKKworCVVMSTUyNlhfREJVRygwLCAidWxpNTI2eF9kZXNjcmlw
dG9yX2luaXQoKSIsIDApOworCisJLyogdHggZGVzY3JpcHRvciBzdGFydCBwb2ludGVyICovCisJ
ZGItPnR4X2luc2VydF9wdHIgPSBkYi0+Zmlyc3RfdHhfZGVzYzsKKwlkYi0+dHhfcmVtb3ZlX3B0
ciA9IGRiLT5maXJzdF90eF9kZXNjOworCW91dGwoZGItPmZpcnN0X3R4X2Rlc2NfZG1hLCBpb2Fk
ZHIgKyBEQ1I0KTsgICAgIC8qIFRYIERFU0MgYWRkcmVzcyAqLworCisJLyogcnggZGVzY3JpcHRv
ciBzdGFydCBwb2ludGVyICovCisJZGItPmZpcnN0X3J4X2Rlc2MgPSAodm9pZCAqKWRiLT5maXJz
dF90eF9kZXNjICsgc2l6ZW9mKHN0cnVjdCB0eF9kZXNjKSAqIFRYX0RFU0NfQ05UOworCWRiLT5m
aXJzdF9yeF9kZXNjX2RtYSA9ICBkYi0+Zmlyc3RfdHhfZGVzY19kbWEgKyBzaXplb2Yoc3RydWN0
IHR4X2Rlc2MpICogVFhfREVTQ19DTlQ7CisJZGItPnJ4X2luc2VydF9wdHIgPSBkYi0+Zmlyc3Rf
cnhfZGVzYzsKKwlkYi0+cnhfcmVhZHlfcHRyID0gZGItPmZpcnN0X3J4X2Rlc2M7CisJb3V0bChk
Yi0+Zmlyc3RfcnhfZGVzY19kbWEsIGlvYWRkciArIERDUjMpOwkvKiBSWCBERVNDIGFkZHJlc3Mg
Ki8KKworCS8qIEluaXQgVHJhbnNtaXQgY2hhaW4gKi8KKwl0bXBfYnVmID0gZGItPmJ1Zl9wb29s
X3N0YXJ0OworCXRtcF9idWZfZG1hID0gZGItPmJ1Zl9wb29sX2RtYV9zdGFydDsKKwl0bXBfdHhf
ZG1hID0gZGItPmZpcnN0X3R4X2Rlc2NfZG1hOworCWZvciAodG1wX3R4ID0gZGItPmZpcnN0X3R4
X2Rlc2MsIGkgPSAwOyBpIDwgVFhfREVTQ19DTlQ7IGkrKywgdG1wX3R4KyspIHsKKwkJdG1wX3R4
LT50eF9idWZfcHRyID0gdG1wX2J1ZjsKKwkJdG1wX3R4LT50ZGVzMCA9IGNwdV90b19sZTMyKDAp
OworCQl0bXBfdHgtPnRkZXMxID0gY3B1X3RvX2xlMzIoMHg4MTAwMDAwMCk7CS8qIElDLCBjaGFp
biAqLworCQl0bXBfdHgtPnRkZXMyID0gY3B1X3RvX2xlMzIodG1wX2J1Zl9kbWEpOworCQl0bXBf
dHhfZG1hICs9IHNpemVvZihzdHJ1Y3QgdHhfZGVzYyk7CisJCXRtcF90eC0+dGRlczMgPSBjcHVf
dG9fbGUzMih0bXBfdHhfZG1hKTsKKwkJdG1wX3R4LT5uZXh0X3R4X2Rlc2MgPSB0bXBfdHggKyAx
OworCQl0bXBfYnVmID0gdG1wX2J1ZiArIFRYX0JVRl9BTExPQzsKKwkJdG1wX2J1Zl9kbWEgPSB0
bXBfYnVmX2RtYSArIFRYX0JVRl9BTExPQzsKKwl9CisJKC0tdG1wX3R4KS0+dGRlczMgPSBjcHVf
dG9fbGUzMihkYi0+Zmlyc3RfdHhfZGVzY19kbWEpOworCXRtcF90eC0+bmV4dF90eF9kZXNjID0g
ZGItPmZpcnN0X3R4X2Rlc2M7CisKKwkgLyogSW5pdCBSZWNlaXZlIGRlc2NyaXB0b3IgY2hhaW4g
Ki8KKwl0bXBfcnhfZG1hPWRiLT5maXJzdF9yeF9kZXNjX2RtYTsKKwlmb3IgKHRtcF9yeCA9IGRi
LT5maXJzdF9yeF9kZXNjLCBpID0gMDsgaSA8IFJYX0RFU0NfQ05UOyBpKyssIHRtcF9yeCsrKSB7
CisJCXRtcF9yeC0+cmRlczAgPSBjcHVfdG9fbGUzMigwKTsKKwkJdG1wX3J4LT5yZGVzMSA9IGNw
dV90b19sZTMyKDB4MDEwMDA2MDApOworCQl0bXBfcnhfZG1hICs9IHNpemVvZihzdHJ1Y3Qgcnhf
ZGVzYyk7CisJCXRtcF9yeC0+cmRlczMgPSBjcHVfdG9fbGUzMih0bXBfcnhfZG1hKTsKKwkJdG1w
X3J4LT5uZXh0X3J4X2Rlc2MgPSB0bXBfcnggKyAxOworCX0KKwkoLS10bXBfcngpLT5yZGVzMyA9
IGNwdV90b19sZTMyKGRiLT5maXJzdF9yeF9kZXNjX2RtYSk7CisJdG1wX3J4LT5uZXh0X3J4X2Rl
c2MgPSBkYi0+Zmlyc3RfcnhfZGVzYzsKKworCS8qIHByZS1hbGxvY2F0ZSBSeCBidWZmZXIgKi8K
KwlhbGxvY2F0ZV9yeF9idWZmZXIoZGIpOworfQorCisKKy8qCisgKglVcGRhdGUgQ1I2IHZhbHVl
CisgKglGaXJzdGx5IHN0b3AgVUxJNTI2WCAsIHRoZW4gd3JpdHRlbiB2YWx1ZSBhbmQgc3RhcnQK
KyAqLworCitzdGF0aWMgdm9pZCB1cGRhdGVfY3I2KHUzMiBjcjZfZGF0YSwgdW5zaWduZWQgbG9u
ZyBpb2FkZHIpCit7CisKKwlvdXRsKGNyNl9kYXRhLCBpb2FkZHIgKyBEQ1I2KTsKKwl1ZGVsYXko
NSk7Cit9CisKKworLyoKKyAqCVNlbmQgYSBzZXR1cCBmcmFtZSBmb3IgTTUyNjEvTTUyNjMKKyAq
CVRoaXMgc2V0dXAgZnJhbWUgaW5pdGlsaXplIFVMSTUyNlggYWRkcmVzcyBmaWx0ZXIgbW9kZQor
ICovCisKK3N0YXRpYyB2b2lkIHNlbmRfZmlsdGVyX2ZyYW1lKHN0cnVjdCBERVZJQ0UgKmRldiwg
aW50IG1jX2NudCkKK3sKKwlzdHJ1Y3QgdWxpNTI2eF9ib2FyZF9pbmZvICpkYiA9IG5ldGRldl9w
cml2KGRldik7CisJc3RydWN0IGRldl9tY19saXN0ICptY3B0cjsKKwlzdHJ1Y3QgdHhfZGVzYyAq
dHhwdHI7CisJdTE2ICogYWRkcnB0cjsKKwl1MzIgKiBzdXB0cjsKKwlpbnQgaTsKKworCVVMSTUy
NlhfREJVRygwLCAic2VuZF9maWx0ZXJfZnJhbWUoKSIsIDApOworCisJdHhwdHIgPSBkYi0+dHhf
aW5zZXJ0X3B0cjsKKwlzdXB0ciA9ICh1MzIgKikgdHhwdHItPnR4X2J1Zl9wdHI7CisKKwkvKiBO
b2RlIGFkZHJlc3MgKi8KKwlhZGRycHRyID0gKHUxNiAqKSBkZXYtPmRldl9hZGRyOworCSpzdXB0
cisrID0gYWRkcnB0clswXTsKKwkqc3VwdHIrKyA9IGFkZHJwdHJbMV07CisJKnN1cHRyKysgPSBh
ZGRycHRyWzJdOworCisJLyogYnJvYWRjYXN0IGFkZHJlc3MgKi8KKwkqc3VwdHIrKyA9IDB4ZmZm
ZjsKKwkqc3VwdHIrKyA9IDB4ZmZmZjsKKwkqc3VwdHIrKyA9IDB4ZmZmZjsKKworCS8qIGZpdCB0
aGUgbXVsdGljYXN0IGFkZHJlc3MgKi8KKwlmb3IgKG1jcHRyID0gZGV2LT5tY19saXN0LCBpID0g
MDsgaSA8IG1jX2NudDsgaSsrLCBtY3B0ciA9IG1jcHRyLT5uZXh0KSB7CisJCWFkZHJwdHIgPSAo
dTE2ICopIG1jcHRyLT5kbWlfYWRkcjsKKwkJKnN1cHRyKysgPSBhZGRycHRyWzBdOworCQkqc3Vw
dHIrKyA9IGFkZHJwdHJbMV07CisJCSpzdXB0cisrID0gYWRkcnB0clsyXTsKKwl9CisKKwlmb3Ig
KDsgaTwxNDsgaSsrKSB7CisJCSpzdXB0cisrID0gMHhmZmZmOworCQkqc3VwdHIrKyA9IDB4ZmZm
ZjsKKwkJKnN1cHRyKysgPSAweGZmZmY7CisJfQorCisJLyogcHJlcGFyZSB0aGUgc2V0dXAgZnJh
bWUgKi8KKwlkYi0+dHhfaW5zZXJ0X3B0ciA9IHR4cHRyLT5uZXh0X3R4X2Rlc2M7CisJdHhwdHIt
PnRkZXMxID0gY3B1X3RvX2xlMzIoMHg4OTAwMDBjMCk7CisKKwkvKiBSZXNvdXJjZSBDaGVjayBh
bmQgU2VuZCB0aGUgc2V0dXAgcGFja2V0ICovCisJaWYgKGRiLT50eF9wYWNrZXRfY250IDwgVFhf
REVTQ19DTlQpIHsKKwkJLyogUmVzb3VyY2UgRW1wdHkgKi8KKwkJZGItPnR4X3BhY2tldF9jbnQr
KzsKKwkJdHhwdHItPnRkZXMwID0gY3B1X3RvX2xlMzIoMHg4MDAwMDAwMCk7CisJCXVwZGF0ZV9j
cjYoZGItPmNyNl9kYXRhIHwgMHgyMDAwLCBkZXYtPmJhc2VfYWRkcik7CisJCW91dGwoMHgxLCBk
ZXYtPmJhc2VfYWRkciArIERDUjEpOwkvKiBJc3N1ZSBUeCBwb2xsaW5nICovCisJCXVwZGF0ZV9j
cjYoZGItPmNyNl9kYXRhLCBkZXYtPmJhc2VfYWRkcik7CisJCWRldi0+dHJhbnNfc3RhcnQgPSBq
aWZmaWVzOworCX0gZWxzZQorCQlwcmludGsoS0VSTl9FUlIgRFJWX05BTUUgIjogTm8gVHggcmVz
b3VyY2UgLSBTZW5kX2ZpbHRlcl9mcmFtZSFcbiIpOworfQorCisKKy8qCisgKglBbGxvY2F0ZSBy
eCBidWZmZXIsCisgKglBcyBwb3NzaWJsZSBhcyBhbGxvY2F0ZSBtYXhpdW1uIFJ4IGJ1ZmZlcgor
ICovCisKK3N0YXRpYyB2b2lkIGFsbG9jYXRlX3J4X2J1ZmZlcihzdHJ1Y3QgdWxpNTI2eF9ib2Fy
ZF9pbmZvICpkYikKK3sKKwlzdHJ1Y3QgcnhfZGVzYyAqcnhwdHI7CisJc3RydWN0IHNrX2J1ZmYg
KnNrYjsKKworCXJ4cHRyID0gZGItPnJ4X2luc2VydF9wdHI7CisKKwl3aGlsZShkYi0+cnhfYXZh
aWxfY250IDwgUlhfREVTQ19DTlQpIHsKKwkJaWYgKCAoIHNrYiA9IGRldl9hbGxvY19za2IoUlhf
QUxMT0NfU0laRSkgKSA9PSBOVUxMICkKKwkJCWJyZWFrOworCQlyeHB0ci0+cnhfc2tiX3B0ciA9
IHNrYjsgLyogRklYTUUgKD8pICovCisJCXJ4cHRyLT5yZGVzMiA9IGNwdV90b19sZTMyKCBwY2lf
bWFwX3NpbmdsZShkYi0+cGRldiwgc2tiLT50YWlsLCBSWF9BTExPQ19TSVpFLCBQQ0lfRE1BX0ZS
T01ERVZJQ0UpICk7CisJCXdtYigpOworCQlyeHB0ci0+cmRlczAgPSBjcHVfdG9fbGUzMigweDgw
MDAwMDAwKTsKKwkJcnhwdHIgPSByeHB0ci0+bmV4dF9yeF9kZXNjOworCQlkYi0+cnhfYXZhaWxf
Y250Kys7CisJfQorCisJZGItPnJ4X2luc2VydF9wdHIgPSByeHB0cjsKK30KKworCisvKgorICoJ
UmVhZCBvbmUgd29yZCBkYXRhIGZyb20gdGhlIHNlcmlhbCBST00KKyAqLworCitzdGF0aWMgdTE2
IHJlYWRfc3JvbV93b3JkKGxvbmcgaW9hZGRyLCBpbnQgb2Zmc2V0KQoreworCWludCBpOworCXUx
NiBzcm9tX2RhdGEgPSAwOworCWxvbmcgY3I5X2lvYWRkciA9IGlvYWRkciArIERDUjk7CisKKwlv
dXRsKENSOV9TUk9NX1JFQUQsIGNyOV9pb2FkZHIpOworCW91dGwoQ1I5X1NST01fUkVBRCB8IENS
OV9TUkNTLCBjcjlfaW9hZGRyKTsKKworCS8qIFNlbmQgdGhlIFJlYWQgQ29tbWFuZCAxMTBiICov
CisJU1JPTV9DTEtfV1JJVEUoU1JPTV9EQVRBXzEsIGNyOV9pb2FkZHIpOworCVNST01fQ0xLX1dS
SVRFKFNST01fREFUQV8xLCBjcjlfaW9hZGRyKTsKKwlTUk9NX0NMS19XUklURShTUk9NX0RBVEFf
MCwgY3I5X2lvYWRkcik7CisKKwkvKiBTZW5kIHRoZSBvZmZzZXQgKi8KKwlmb3IgKGkgPSA1OyBp
ID49IDA7IGktLSkgeworCQlzcm9tX2RhdGEgPSAob2Zmc2V0ICYgKDEgPDwgaSkpID8gU1JPTV9E
QVRBXzEgOiBTUk9NX0RBVEFfMDsKKwkJU1JPTV9DTEtfV1JJVEUoc3JvbV9kYXRhLCBjcjlfaW9h
ZGRyKTsKKwl9CisKKwlvdXRsKENSOV9TUk9NX1JFQUQgfCBDUjlfU1JDUywgY3I5X2lvYWRkcik7
CisKKwlmb3IgKGkgPSAxNjsgaSA+IDA7IGktLSkgeworCQlvdXRsKENSOV9TUk9NX1JFQUQgfCBD
UjlfU1JDUyB8IENSOV9TUkNMSywgY3I5X2lvYWRkcik7CisJCXVkZWxheSg1KTsKKwkJc3JvbV9k
YXRhID0gKHNyb21fZGF0YSA8PCAxKSB8ICgoaW5sKGNyOV9pb2FkZHIpICYgQ1I5X0NSRE9VVCkg
PyAxIDogMCk7CisJCW91dGwoQ1I5X1NST01fUkVBRCB8IENSOV9TUkNTLCBjcjlfaW9hZGRyKTsK
KwkJdWRlbGF5KDUpOworCX0KKworCW91dGwoQ1I5X1NST01fUkVBRCwgY3I5X2lvYWRkcik7CisJ
cmV0dXJuIHNyb21fZGF0YTsKK30KKworCisvKgorICoJQXV0byBzZW5zZSB0aGUgbWVkaWEgbW9k
ZQorICovCisKK3N0YXRpYyB1OCB1bGk1MjZ4X3NlbnNlX3NwZWVkKHN0cnVjdCB1bGk1MjZ4X2Jv
YXJkX2luZm8gKiBkYikKK3sKKwl1OCBFcnJGbGFnID0gMDsKKwl1MTYgcGh5X21vZGU7CisKKwlw
aHlfbW9kZSA9IHBoeV9yZWFkKGRiLT5pb2FkZHIsIGRiLT5waHlfYWRkciwgMSwgZGItPmNoaXBf
aWQpOworCXBoeV9tb2RlID0gcGh5X3JlYWQoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCAxLCBk
Yi0+Y2hpcF9pZCk7CisKKwlpZiAoIChwaHlfbW9kZSAmIDB4MjQpID09IDB4MjQgKSB7CisJCQor
CQlwaHlfbW9kZSA9ICgocGh5X3JlYWQoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCA1LCBkYi0+
Y2hpcF9pZCkgJiAweDAxZTApPDw3KTsKKwkJaWYocGh5X21vZGUmMHg4MDAwKQorCQkJcGh5X21v
ZGUgPSAweDgwMDA7CisJCWVsc2UgaWYocGh5X21vZGUmMHg0MDAwKQorCQkJcGh5X21vZGUgPSAw
eDQwMDA7CisJCWVsc2UgaWYocGh5X21vZGUmMHgyMDAwKQorCQkJcGh5X21vZGUgPSAweDIwMDA7
CisJCWVsc2UKKwkJCXBoeV9tb2RlID0gMHgxMDAwOworCQkKKwkJLyogcHJpbnRrKERSVl9OQU1F
ICI6IFBoeV9tb2RlICV4ICIscGh5X21vZGUpOyAqLworCQlzd2l0Y2ggKHBoeV9tb2RlKSB7CisJ
CWNhc2UgMHgxMDAwOiBkYi0+b3BfbW9kZSA9IFVMSTUyNlhfMTBNSEY7IGJyZWFrOworCQljYXNl
IDB4MjAwMDogZGItPm9wX21vZGUgPSBVTEk1MjZYXzEwTUZEOyBicmVhazsKKwkJY2FzZSAweDQw
MDA6IGRiLT5vcF9tb2RlID0gVUxJNTI2WF8xMDBNSEY7IGJyZWFrOworCQljYXNlIDB4ODAwMDog
ZGItPm9wX21vZGUgPSBVTEk1MjZYXzEwME1GRDsgYnJlYWs7CisJCWRlZmF1bHQ6IGRiLT5vcF9t
b2RlID0gVUxJNTI2WF8xME1IRjsgRXJyRmxhZyA9IDE7IGJyZWFrOworCQl9CisJfSBlbHNlIHsK
KwkJZGItPm9wX21vZGUgPSBVTEk1MjZYXzEwTUhGOworCQlVTEk1MjZYX0RCVUcoMCwgIkxpbmsg
RmFpbGVkIDoiLCBwaHlfbW9kZSk7CisJCUVyckZsYWcgPSAxOworCX0KKworCXJldHVybiBFcnJG
bGFnOworfQorCisKKy8qCisgKglTZXQgMTAvMTAwIHBoeXhjZXIgY2FwYWJpbGl0eQorICoJQVVU
TyBtb2RlIDogcGh5eGNlciByZWdpc3RlcjQgaXMgTklDIGNhcGFiaWxpdHkKKyAqCUZvcmNlIG1v
ZGU6IHBoeXhjZXIgcmVnaXN0ZXI0IGlzIHRoZSBmb3JjZSBtZWRpYQorICovCisKK3N0YXRpYyB2
b2lkIHVsaTUyNnhfc2V0X3BoeXhjZXIoc3RydWN0IHVsaTUyNnhfYm9hcmRfaW5mbyAqZGIpCit7
CisJdTE2IHBoeV9yZWc7CisJCisJLyogUGh5eGNlciBjYXBhYmlsaXR5IHNldHRpbmcgKi8KKwlw
aHlfcmVnID0gcGh5X3JlYWQoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCA0LCBkYi0+Y2hpcF9p
ZCkgJiB+MHgwMWUwOworCisJaWYgKGRiLT5tZWRpYV9tb2RlICYgVUxJNTI2WF9BVVRPKSB7CisJ
CS8qIEFVVE8gTW9kZSAqLworCQlwaHlfcmVnIHw9IGRiLT5QSFlfcmVnNDsKKwl9IGVsc2Ugewor
CQkvKiBGb3JjZSBNb2RlICovCisJCXN3aXRjaChkYi0+bWVkaWFfbW9kZSkgeworCQljYXNlIFVM
STUyNlhfMTBNSEY6IHBoeV9yZWcgfD0gMHgyMDsgYnJlYWs7CisJCWNhc2UgVUxJNTI2WF8xME1G
RDogcGh5X3JlZyB8PSAweDQwOyBicmVhazsKKwkJY2FzZSBVTEk1MjZYXzEwME1IRjogcGh5X3Jl
ZyB8PSAweDgwOyBicmVhazsKKwkJY2FzZSBVTEk1MjZYXzEwME1GRDogcGh5X3JlZyB8PSAweDEw
MDsgYnJlYWs7CisJCX0KKwkJCisJfQorCisgIAkvKiBXcml0ZSBuZXcgY2FwYWJpbGl0eSB0byBQ
aHl4Y2VyIFJlZzQgKi8KKwlpZiAoICEocGh5X3JlZyAmIDB4MDFlMCkpIHsKKwkJcGh5X3JlZ3w9
ZGItPlBIWV9yZWc0OworCQlkYi0+bWVkaWFfbW9kZXw9VUxJNTI2WF9BVVRPOworCX0KKwlwaHlf
d3JpdGUoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCA0LCBwaHlfcmVnLCBkYi0+Y2hpcF9pZCk7
CisKKyAJLyogUmVzdGFydCBBdXRvLU5lZ290aWF0aW9uICovCisJcGh5X3dyaXRlKGRiLT5pb2Fk
ZHIsIGRiLT5waHlfYWRkciwgMCwgMHgxMjAwLCBkYi0+Y2hpcF9pZCk7CisJdWRlbGF5KDUwKTsK
K30KKworCisvKgorICoJUHJvY2VzcyBvcC1tb2RlCisgCUFVVE8gbW9kZSA6IFBIWSBjb250cm9s
bGVyIGluIEF1dG8tbmVnb3RpYXRpb24gTW9kZQorICoJRm9yY2UgbW9kZTogUEhZIGNvbnRyb2xs
ZXIgaW4gZm9yY2UgbW9kZSB3aXRoIEhVQgorICoJCQlOLXdheSBmb3JjZSBjYXBhYmlsaXR5IHdp
dGggU1dJVENICisgKi8KKworc3RhdGljIHZvaWQgdWxpNTI2eF9wcm9jZXNzX21vZGUoc3RydWN0
IHVsaTUyNnhfYm9hcmRfaW5mbyAqZGIpCit7CisJdTE2IHBoeV9yZWc7CisKKwkvKiBGdWxsIER1
cGxleCBNb2RlIENoZWNrICovCisJaWYgKGRiLT5vcF9tb2RlICYgMHg0KQorCQlkYi0+Y3I2X2Rh
dGEgfD0gQ1I2X0ZETTsJLyogU2V0IEZ1bGwgRHVwbGV4IEJpdCAqLworCWVsc2UKKwkJZGItPmNy
Nl9kYXRhICY9IH5DUjZfRkRNOwkvKiBDbGVhciBGdWxsIER1cGxleCBCaXQgKi8KKworCXVwZGF0
ZV9jcjYoZGItPmNyNl9kYXRhLCBkYi0+aW9hZGRyKTsKKworCS8qIDEwLzEwME0gcGh5eGNlciBm
b3JjZSBtb2RlIG5lZWQgKi8KKwlpZiAoICEoZGItPm1lZGlhX21vZGUgJiAweDgpKSB7CisJCS8q
IEZvcmVjZSBNb2RlICovCisJCXBoeV9yZWcgPSBwaHlfcmVhZChkYi0+aW9hZGRyLCBkYi0+cGh5
X2FkZHIsIDYsIGRiLT5jaGlwX2lkKTsKKwkJaWYgKCAhKHBoeV9yZWcgJiAweDEpICkgeworCQkJ
LyogcGFydGVyIHdpdGhvdXQgTi1XYXkgY2FwYWJpbGl0eSAqLworCQkJcGh5X3JlZyA9IDB4MDsK
KwkJCXN3aXRjaChkYi0+b3BfbW9kZSkgeworCQkJY2FzZSBVTEk1MjZYXzEwTUhGOiBwaHlfcmVn
ID0gMHgwOyBicmVhazsKKwkJCWNhc2UgVUxJNTI2WF8xME1GRDogcGh5X3JlZyA9IDB4MTAwOyBi
cmVhazsKKwkJCWNhc2UgVUxJNTI2WF8xMDBNSEY6IHBoeV9yZWcgPSAweDIwMDA7IGJyZWFrOwor
CQkJY2FzZSBVTEk1MjZYXzEwME1GRDogcGh5X3JlZyA9IDB4MjEwMDsgYnJlYWs7CisJCQl9CisJ
CQlwaHlfd3JpdGUoZGItPmlvYWRkciwgZGItPnBoeV9hZGRyLCAwLCBwaHlfcmVnLCBkYi0+Y2hp
cF9pZCk7CisgICAgICAgCQkJcGh5X3dyaXRlKGRiLT5pb2FkZHIsIGRiLT5waHlfYWRkciwgMCwg
cGh5X3JlZywgZGItPmNoaXBfaWQpOworCQl9CisJfQorfQorCisKKy8qCisgKglXcml0ZSBhIHdv
cmQgdG8gUGh5IHJlZ2lzdGVyCisgKi8KKworc3RhdGljIHZvaWQgcGh5X3dyaXRlKHVuc2lnbmVk
IGxvbmcgaW9iYXNlLCB1OCBwaHlfYWRkciwgdTggb2Zmc2V0LCB1MTYgcGh5X2RhdGEsIHUzMiBj
aGlwX2lkKQoreworCXUxNiBpOworCXVuc2lnbmVkIGxvbmcgaW9hZGRyOworCisJaWYoY2hpcF9p
ZCA9PSBQQ0lfVUxJNTI2M19JRCkKKwl7CisJCXBoeV93cml0ZWJ5X2NyMTAoaW9iYXNlLCBwaHlf
YWRkciwgb2Zmc2V0LCBwaHlfZGF0YSk7CisJCXJldHVybjsKKwl9CisJLyogTTUyNjEvTTUyNjMg
Q2hpcCAqLworCWlvYWRkciA9IGlvYmFzZSArIERDUjk7CisKKwkvKiBTZW5kIDMzIHN5bmNocm9u
aXphdGlvbiBjbG9jayB0byBQaHkgY29udHJvbGxlciAqLworCWZvciAoaSA9IDA7IGkgPCAzNTsg
aSsrKQorCQlwaHlfd3JpdGVfMWJpdChpb2FkZHIsIFBIWV9EQVRBXzEsIGNoaXBfaWQpOworCisJ
LyogU2VuZCBzdGFydCBjb21tYW5kKDAxKSB0byBQaHkgKi8KKwlwaHlfd3JpdGVfMWJpdChpb2Fk
ZHIsIFBIWV9EQVRBXzAsIGNoaXBfaWQpOworCXBoeV93cml0ZV8xYml0KGlvYWRkciwgUEhZX0RB
VEFfMSwgY2hpcF9pZCk7CisKKwkvKiBTZW5kIHdyaXRlIGNvbW1hbmQoMDEpIHRvIFBoeSAqLwor
CXBoeV93cml0ZV8xYml0KGlvYWRkciwgUEhZX0RBVEFfMCwgY2hpcF9pZCk7CisJcGh5X3dyaXRl
XzFiaXQoaW9hZGRyLCBQSFlfREFUQV8xLCBjaGlwX2lkKTsKKworCS8qIFNlbmQgUGh5IGFkZHJl
c3MgKi8KKwlmb3IgKGkgPSAweDEwOyBpID4gMDsgaSA9IGkgPj4gMSkKKwkJcGh5X3dyaXRlXzFi
aXQoaW9hZGRyLCBwaHlfYWRkciAmIGkgPyBQSFlfREFUQV8xIDogUEhZX0RBVEFfMCwgY2hpcF9p
ZCk7CisKKwkvKiBTZW5kIHJlZ2lzdGVyIGFkZHJlc3MgKi8KKwlmb3IgKGkgPSAweDEwOyBpID4g
MDsgaSA9IGkgPj4gMSkKKwkJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBvZmZzZXQgJiBpID8gUEhZ
X0RBVEFfMSA6IFBIWV9EQVRBXzAsIGNoaXBfaWQpOworCisJLyogd3JpdHRlbiB0cmFzbml0aW9u
ICovCisJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBQSFlfREFUQV8xLCBjaGlwX2lkKTsKKwlwaHlf
d3JpdGVfMWJpdChpb2FkZHIsIFBIWV9EQVRBXzAsIGNoaXBfaWQpOworCisJLyogV3JpdGUgYSB3
b3JkIGRhdGEgdG8gUEhZIGNvbnRyb2xsZXIgKi8KKwlmb3IgKCBpID0gMHg4MDAwOyBpID4gMDsg
aSA+Pj0gMSkKKwkJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBwaHlfZGF0YSAmIGkgPyBQSFlfREFU
QV8xIDogUEhZX0RBVEFfMCwgY2hpcF9pZCk7CisJCit9CisKKworLyoKKyAqCVJlYWQgYSB3b3Jk
IGRhdGEgZnJvbSBwaHkgcmVnaXN0ZXIKKyAqLworCitzdGF0aWMgdTE2IHBoeV9yZWFkKHVuc2ln
bmVkIGxvbmcgaW9iYXNlLCB1OCBwaHlfYWRkciwgdTggb2Zmc2V0LCB1MzIgY2hpcF9pZCkKK3sK
KwlpbnQgaTsKKwl1MTYgcGh5X2RhdGE7CisJdW5zaWduZWQgbG9uZyBpb2FkZHI7CisKKwlpZihj
aGlwX2lkID09IFBDSV9VTEk1MjYzX0lEKQorCQlyZXR1cm4gcGh5X3JlYWRieV9jcjEwKGlvYmFz
ZSwgcGh5X2FkZHIsIG9mZnNldCk7CisJLyogTTUyNjEvTTUyNjMgQ2hpcCAqLworCWlvYWRkciA9
IGlvYmFzZSArIERDUjk7CisJCisJLyogU2VuZCAzMyBzeW5jaHJvbml6YXRpb24gY2xvY2sgdG8g
UGh5IGNvbnRyb2xsZXIgKi8KKwlmb3IgKGkgPSAwOyBpIDwgMzU7IGkrKykKKwkJcGh5X3dyaXRl
XzFiaXQoaW9hZGRyLCBQSFlfREFUQV8xLCBjaGlwX2lkKTsKKworCS8qIFNlbmQgc3RhcnQgY29t
bWFuZCgwMSkgdG8gUGh5ICovCisJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBQSFlfREFUQV8wLCBj
aGlwX2lkKTsKKwlwaHlfd3JpdGVfMWJpdChpb2FkZHIsIFBIWV9EQVRBXzEsIGNoaXBfaWQpOwor
CisJLyogU2VuZCByZWFkIGNvbW1hbmQoMTApIHRvIFBoeSAqLworCXBoeV93cml0ZV8xYml0KGlv
YWRkciwgUEhZX0RBVEFfMSwgY2hpcF9pZCk7CisJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBQSFlf
REFUQV8wLCBjaGlwX2lkKTsKKworCS8qIFNlbmQgUGh5IGFkZHJlc3MgKi8KKwlmb3IgKGkgPSAw
eDEwOyBpID4gMDsgaSA9IGkgPj4gMSkKKwkJcGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBwaHlfYWRk
ciAmIGkgPyBQSFlfREFUQV8xIDogUEhZX0RBVEFfMCwgY2hpcF9pZCk7CisKKwkvKiBTZW5kIHJl
Z2lzdGVyIGFkZHJlc3MgKi8KKwlmb3IgKGkgPSAweDEwOyBpID4gMDsgaSA9IGkgPj4gMSkKKwkJ
cGh5X3dyaXRlXzFiaXQoaW9hZGRyLCBvZmZzZXQgJiBpID8gUEhZX0RBVEFfMSA6IFBIWV9EQVRB
XzAsIGNoaXBfaWQpOworCisJLyogU2tpcCB0cmFuc2l0aW9uIHN0YXRlICovCisJcGh5X3JlYWRf
MWJpdChpb2FkZHIsIGNoaXBfaWQpOworCisJLyogcmVhZCAxNmJpdCBkYXRhICovCisJZm9yIChw
aHlfZGF0YSA9IDAsIGkgPSAwOyBpIDwgMTY7IGkrKykgeworCQlwaHlfZGF0YSA8PD0gMTsKKwkJ
cGh5X2RhdGEgfD0gcGh5X3JlYWRfMWJpdChpb2FkZHIsIGNoaXBfaWQpOworCX0KKworCXJldHVy
biBwaHlfZGF0YTsKK30KKworc3RhdGljIHUxNiBwaHlfcmVhZGJ5X2NyMTAodW5zaWduZWQgbG9u
ZyBpb2Jhc2UsIHU4IHBoeV9hZGRyLCB1OCBvZmZzZXQpCit7CisJdW5zaWduZWQgbG9uZyBpb2Fk
ZHIsY3IxMF92YWx1ZTsKKwkKKwlpb2FkZHIgPSBpb2Jhc2UgKyBEQ1IxMDsKKwljcjEwX3ZhbHVl
ID0gcGh5X2FkZHI7CisJY3IxMF92YWx1ZSA9IChjcjEwX3ZhbHVlPDw1KSArIG9mZnNldDsKKwlj
cjEwX3ZhbHVlID0gKGNyMTBfdmFsdWU8PDE2KSArIDB4MDgwMDAwMDA7CisJb3V0bChjcjEwX3Zh
bHVlLGlvYWRkcik7CisJdWRlbGF5KDEpOworCXdoaWxlKDEpCisJeworCQljcjEwX3ZhbHVlID0g
aW5sKGlvYWRkcik7CisJCWlmKGNyMTBfdmFsdWUmMHgxMDAwMDAwMCkKKwkJCWJyZWFrOworCX0K
KwlyZXR1cm4gKGNyMTBfdmFsdWUmMHgwZmZmZik7Cit9CisKK3N0YXRpYyB2b2lkIHBoeV93cml0
ZWJ5X2NyMTAodW5zaWduZWQgbG9uZyBpb2Jhc2UsIHU4IHBoeV9hZGRyLCB1OCBvZmZzZXQsIHUx
NiBwaHlfZGF0YSkKK3sKKwl1bnNpZ25lZCBsb25nIGlvYWRkcixjcjEwX3ZhbHVlOworCQorCWlv
YWRkciA9IGlvYmFzZSArIERDUjEwOworCWNyMTBfdmFsdWUgPSBwaHlfYWRkcjsKKwljcjEwX3Zh
bHVlID0gKGNyMTBfdmFsdWU8PDUpICsgb2Zmc2V0OworCWNyMTBfdmFsdWUgPSAoY3IxMF92YWx1
ZTw8MTYpICsgMHgwNDAwMDAwMCArIHBoeV9kYXRhOworCW91dGwoY3IxMF92YWx1ZSxpb2FkZHIp
OworCXVkZWxheSgxKTsKK30KKy8qCisgKglXcml0ZSBvbmUgYml0IGRhdGEgdG8gUGh5IENvbnRy
b2xsZXIKKyAqLworCitzdGF0aWMgdm9pZCBwaHlfd3JpdGVfMWJpdCh1bnNpZ25lZCBsb25nIGlv
YWRkciwgdTMyIHBoeV9kYXRhLCB1MzIgY2hpcF9pZCkKK3sKKwlvdXRsKHBoeV9kYXRhICwgaW9h
ZGRyKTsJCQkvKiBNSUkgQ2xvY2sgTG93ICovCisJdWRlbGF5KDEpOworCW91dGwocGh5X2RhdGEg
IHwgTURDTEtILCBpb2FkZHIpOwkvKiBNSUkgQ2xvY2sgSGlnaCAqLworCXVkZWxheSgxKTsKKwlv
dXRsKHBoeV9kYXRhICwgaW9hZGRyKTsJCQkvKiBNSUkgQ2xvY2sgTG93ICovCisJdWRlbGF5KDEp
OworfQorCisKKy8qCisgKglSZWFkIG9uZSBiaXQgcGh5IGRhdGEgZnJvbSBQSFkgY29udHJvbGxl
cgorICovCisKK3N0YXRpYyB1MTYgcGh5X3JlYWRfMWJpdCh1bnNpZ25lZCBsb25nIGlvYWRkciwg
dTMyIGNoaXBfaWQpCit7CisJdTE2IHBoeV9kYXRhOworCQorCW91dGwoMHg1MDAwMCAsIGlvYWRk
cik7CisJdWRlbGF5KDEpOworCXBoeV9kYXRhID0gKCBpbmwoaW9hZGRyKSA+PiAxOSApICYgMHgx
OworCW91dGwoMHg0MDAwMCAsIGlvYWRkcik7CisJdWRlbGF5KDEpOworCisJcmV0dXJuIHBoeV9k
YXRhOworfQorCisKK3N0YXRpYyBzdHJ1Y3QgcGNpX2RldmljZV9pZCB1bGk1MjZ4X3BjaV90Ymxb
XSA9IHsKKwl7IDB4MTBCOSwgMHg1MjYxLCBQQ0lfQU5ZX0lELCBQQ0lfQU5ZX0lELCAwLCAwLCBQ
Q0lfVUxJNTI2MV9JRCB9LAorCXsgMHgxMEI5LCAweDUyNjMsIFBDSV9BTllfSUQsIFBDSV9BTllf
SUQsIDAsIDAsIFBDSV9VTEk1MjYzX0lEIH0sCisJeyAwLCB9Cit9OworTU9EVUxFX0RFVklDRV9U
QUJMRShwY2ksIHVsaTUyNnhfcGNpX3RibCk7CisKKworc3RhdGljIHN0cnVjdCBwY2lfZHJpdmVy
IHVsaTUyNnhfZHJpdmVyID0geworCS5uYW1lCQk9ICJ1bGk1MjZ4IiwKKwkuaWRfdGFibGUJPSB1
bGk1MjZ4X3BjaV90YmwsCisJLnByb2JlCQk9IHVsaTUyNnhfaW5pdF9vbmUsCisJLnJlbW92ZQkJ
PSBfX2RldmV4aXRfcCh1bGk1MjZ4X3JlbW92ZV9vbmUpLAorfTsKKworTU9EVUxFX0FVVEhPUigi
UGVlciBDaGVuLCBwZWVyLmNoZW5AdWxpLmNvbS50dyIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJV
TGkgTTUyNjEvTTUyNjMgZmFzdCBldGhlcm5ldCBkcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJH
UEwiKTsKKworTU9EVUxFX1BBUk0oZGVidWcsICJpIik7CitNT0RVTEVfUEFSTShtb2RlLCAiaSIp
OworTU9EVUxFX1BBUk0oY3I2c2V0LCAiaSIpOworTU9EVUxFX1BBUk1fREVTQyhkZWJ1ZywgIlVM
aSBNNTI2MS9NNTI2MyBlbmFibGUgZGVidWdnaW5nICgwLTEpIik7CitNT0RVTEVfUEFSTV9ERVND
KG1vZGUsICJVTGkgTTUyNjEvTTUyNjM6IEJpdCAwOiAxMC8xMDBNYnBzLCBiaXQgMjogZHVwbGV4
LCBiaXQgODogSG9tZVBOQSIpOworCisvKglEZXNjcmlwdGlvbjoKKyAqCXdoZW4gdXNlciB1c2Vk
IGluc21vZCB0byBhZGQgbW9kdWxlLCBzeXN0ZW0gaW52b2tlZCBpbml0X21vZHVsZSgpCisgKgl0
byBpbml0aWxpemUgYW5kIHJlZ2lzdGVyLgorICovCisKK3N0YXRpYyBpbnQgX19pbml0IHVsaTUy
NnhfaW5pdF9tb2R1bGUodm9pZCkKK3sKKwlpbnQgcmM7CisKKwlwcmludGsodmVyc2lvbik7CisJ
cHJpbnRlZF92ZXJzaW9uID0gMTsKKworCVVMSTUyNlhfREJVRygwLCAiaW5pdF9tb2R1bGUoKSAi
LCBkZWJ1Zyk7CisKKwlpZiAoZGVidWcpCisJCXVsaTUyNnhfZGVidWcgPSBkZWJ1ZzsJLyogc2V0
IGRlYnVnIGZsYWcgKi8KKwlpZiAoY3I2c2V0KQorCQl1bGk1MjZ4X2NyNl91c2VyX3NldCA9IGNy
NnNldDsKKworIAlzd2l0Y2gobW9kZSkgeworICAgCWNhc2UgVUxJNTI2WF8xME1IRjoKKwljYXNl
IFVMSTUyNlhfMTAwTUhGOgorCWNhc2UgVUxJNTI2WF8xME1GRDoKKwljYXNlIFVMSTUyNlhfMTAw
TUZEOgorCQl1bGk1MjZ4X21lZGlhX21vZGUgPSBtb2RlOworCQlicmVhazsKKwlkZWZhdWx0OnVs
aTUyNnhfbWVkaWFfbW9kZSA9IFVMSTUyNlhfQVVUTzsKKwkJYnJlYWs7CisJfQorCisJcmMgPSBw
Y2lfbW9kdWxlX2luaXQoJnVsaTUyNnhfZHJpdmVyKTsKKwlpZiAocmMgPCAwKQorCQlyZXR1cm4g
cmM7CisKKwlyZXR1cm4gMDsKK30KKworCisvKgorICoJRGVzY3JpcHRpb246CisgKgl3aGVuIHVz
ZXIgdXNlZCBybW1vZCB0byBkZWxldGUgbW9kdWxlLCBzeXN0ZW0gaW52b2tlZCBjbGVhbl9tb2R1
bGUoKQorICoJdG8gdW4tcmVnaXN0ZXIgYWxsIHJlZ2lzdGVyZWQgc2VydmljZXMuCisgKi8KKwor
c3RhdGljIHZvaWQgX19leGl0IHVsaTUyNnhfY2xlYW51cF9tb2R1bGUodm9pZCkKK3sKKwlVTEk1
MjZYX0RCVUcoMCwgInVsaTUyNnhfY2xlYW5fbW9kdWxlKCkgIiwgZGVidWcpOworCXBjaV91bnJl
Z2lzdGVyX2RyaXZlcigmdWxpNTI2eF9kcml2ZXIpOworfQorCittb2R1bGVfaW5pdCh1bGk1MjZ4
X2luaXRfbW9kdWxlKTsKK21vZHVsZV9leGl0KHVsaTUyNnhfY2xlYW51cF9tb2R1bGUpOwo=

--0__=C7BBFADEDFD3369E8f9e8a93df938690918cC7BBFADEDFD3369E--

