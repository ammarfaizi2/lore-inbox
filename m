Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262495AbUKLIn5@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262495AbUKLIn5 (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 12 Nov 2004 03:43:57 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262491AbUKLIn5
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 12 Nov 2004 03:43:57 -0500
Received: from mail.renesas.com ([202.234.163.13]:28563 "EHLO
	mail02.idc.renesas.com") by vger.kernel.org with ESMTP
	id S262495AbUKLIei (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Fri, 12 Nov 2004 03:34:38 -0500
Date: Fri, 12 Nov 2004 17:34:26 +0900 (JST)
Message-Id: <20041112.173426.971160551.takata.hirokazu@renesas.com>
To: Andrew Morton <akpm@osdl.org>
Cc: linux-kernel@vger.kernel.org, takata@linux-m32r.org
Subject: [PATCH 2.6.10-rc1-bk21] [m32r] Update dot.gdbinit files
From: Hirokazu Takata <takata@linux-m32r.org>
X-Mailer: Mew version 3.3 on XEmacs 21.4.15 (Security Through Obscurity)
Mime-Version: 1.0
Content-Type: Text/Plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hello,

This patch is for updating GDB initalization files (dot.gdbinit*) 
for all m32r target boards.

Currently, part of dot.gdbinit* files are maintained by using 
a "gen_gdbinit" script.
http://www.linux-m32r.org/eng/download.html#othertools

Thanks.

Signed-off-by: Hirokazu Takata <takata@linux-m32r.org>
---

 arch/m32r/m32700ut/dot.gdbinit_200MHz_16MB |   14 -
 arch/m32r/m32700ut/dot.gdbinit_300MHz_32MB |   24 +-
 arch/m32r/m32700ut/dot.gdbinit_400MHz_32MB |  249 +++++++++++++++++++++++++++++
 arch/m32r/mappi/dot.gdbinit                |   16 -
 arch/m32r/mappi/dot.gdbinit.nommu          |    6 
 arch/m32r/mappi/dot.gdbinit.smp            |   12 -
 arch/m32r/mappi2/dot.gdbinit.vdec2         |  233 +++++++++++++++++++++++++++
 arch/m32r/oaks32r/dot.gdbinit.nommu        |   15 -
 arch/m32r/opsput/dot.gdbinit               |   76 ++++++--
 9 files changed, 582 insertions(+), 63 deletions(-)


diff -ruNp a/arch/m32r/m32700ut/dot.gdbinit_200MHz_16MB b/arch/m32r/m32700ut/dot.gdbinit_200MHz_16MB
--- a/arch/m32r/m32700ut/dot.gdbinit_200MHz_16MB	2004-10-19 06:54:32.000000000 +0900
+++ b/arch/m32r/m32700ut/dot.gdbinit_200MHz_16MB	2004-11-12 15:12:19.000000000 +0900
@@ -1,5 +1,5 @@
 # .gdbinit file
-# $Id: dot.gdbinit_200MHz_16MB,v 1.1 2004/08/17 02:58:11 takata Exp $
+# $Id: dot.gdbinit_200MHz_16MB,v 1.2 2004/10/20 03:02:27 fujiwara Exp $
 #-----
 # NOTE: this file is generated by a script, "gen_gdbinit.pl".
 # (Please type "gen_gdbinit.pl --help" and check the help message).
@@ -178,11 +178,11 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x08002000
+  set $param = (void*)0x08001000
   # INITRD_START
-  set *(unsigned long *)($param + 0x0010) = 0x082a0000
+#  set *(unsigned long *)($param + 0x0010) = 0x08300000
   # INITRD_SIZE
-  set *(unsigned long *)($param + 0x0014) = 0x00000000
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
   # M32R_CPUCLK
   set *(unsigned long *)($param + 0x0018) = 0d200000000
   # M32R_BUSCLK
@@ -191,15 +191,15 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x console=tty1 video=s1d13xxxfb:mode:240x320-16 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs,rsize=1024,wsize=1024 nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 mem=16M \0"
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x console=tty1 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs,rsize=1024,wsize=1024 nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 mem=16M \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
   set $fp = 0
-  set $pc = 0x08001000
-  set *(unsigned char *)0xffffffff = 0x03
+  set $pc = 0x08002000
+# set *(unsigned char *)0xffffffff = 0x03
   si
   c
 end
diff -ruNp a/arch/m32r/m32700ut/dot.gdbinit_300MHz_32MB b/arch/m32r/m32700ut/dot.gdbinit_300MHz_32MB
--- a/arch/m32r/m32700ut/dot.gdbinit_300MHz_32MB	2004-10-19 06:54:40.000000000 +0900
+++ b/arch/m32r/m32700ut/dot.gdbinit_300MHz_32MB	2004-11-12 15:12:19.000000000 +0900
@@ -1,5 +1,5 @@
 # .gdbinit file
-# $Id: dot.gdbinit_300MHz_32MB,v 1.1 2004/08/17 02:58:11 takata Exp $
+# $Id: dot.gdbinit_300MHz_32MB,v 1.2 2004/10/20 03:02:27 fujiwara Exp $
 #-----
 # NOTE: this file is generated by a script, "gen_gdbinit.pl".
 # (Please type "gen_gdbinit.pl --help" and check the help message).
@@ -42,8 +42,8 @@ define sdram_init
   set *(unsigned long *)0x00ef602c = 0x00000020
   # Ch0-TR
   set *(unsigned long *)0x00ef6028 = 0x00051502
-  # Ch0-ADR (size:16MB)
-  set *(unsigned long *)0x00ef6020 = 0x08000002
+  # Ch0-ADR (size:32MB)
+  set *(unsigned long *)0x00ef6020 = 0x08000003
   # AutoRef On
   set *(unsigned long *)0x00ef6004 = 0x00010e24
   # Access enable
@@ -51,7 +51,7 @@ define sdram_init
 end
 document sdram_init
   SDRAM controller initialization
-  0x08000000 - 0x08ffffff (16MB)
+  0x08000000 - 0x09ffffff (32MB)
 end
 
 # Initialize BSEL3 for UT-CFC
@@ -161,8 +161,8 @@ define setup
   shell sleep 0.1
   clock_init
   shell sleep 0.1
-  # SDRAM: 16MB
-  set *(unsigned long *)0x00ef6020 = 0x08000002
+  # SDRAM: 32MB
+  set *(unsigned long *)0x00ef6020 = 0x08000003
   cfc_init
   # USB
   set *(unsigned short *)0xb0301000 = 0x100
@@ -178,11 +178,11 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x08002000
+  set $param = (void*)0x08001000
   # INITRD_START
-  set *(unsigned long *)($param + 0x0010) = 0x082a0000
+#  set *(unsigned long *)($param + 0x0010) = 0x08300000
   # INITRD_SIZE
-  set *(unsigned long *)($param + 0x0014) = 0x00000000
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
   # M32R_CPUCLK
   set *(unsigned long *)($param + 0x0018) = 0d300000000
   # M32R_BUSCLK
@@ -191,15 +191,15 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x console=tty1 video=s1d13xxxfb:mode:240x320-16 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs,rsize=1024,wsize=1024 nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 mem=16M \0"
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x console=tty1 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs,rsize=1024,wsize=1024 nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 mem=32M \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
   set $fp = 0
-  set $pc = 0x08001000
-  set *(unsigned char *)0xffffffff = 0x03
+  set $pc = 0x08002000
+# set *(unsigned char *)0xffffffff = 0x03
   si
   c
 end
diff -ruNp a/arch/m32r/m32700ut/dot.gdbinit_400MHz_32MB b/arch/m32r/m32700ut/dot.gdbinit_400MHz_32MB
--- a/arch/m32r/m32700ut/dot.gdbinit_400MHz_32MB	1970-01-01 09:00:00.000000000 +0900
+++ b/arch/m32r/m32700ut/dot.gdbinit_400MHz_32MB	2004-11-12 15:12:19.000000000 +0900
@@ -0,0 +1,249 @@
+# .gdbinit file
+# $Id: dot.gdbinit_400MHz_32MB,v 1.1 2004/10/21 01:41:27 fujiwara Exp $
+#-----
+# NOTE: this file is generated by a script, "gen_gdbinit.pl".
+# (Please type "gen_gdbinit.pl --help" and check the help message).
+# $ Id: gen_gdbinit.pl,v 1.12 2004/07/26 09:56:10 takata Exp $
+#-----
+# target platform: m32700ut
+
+# setting
+set width 0d70
+set radix 0d16
+
+debug_chaos
+
+# clk xin:cpu:bif:bus=25:400:100:50
+define clock_init
+  set *(unsigned long *)0x00ef4008 = 0x00000000
+  set *(unsigned long *)0x00ef4004 = 0
+  shell sleep 0.1
+  # NOTE: Please change the master clock source from PLL-clock to Xin-clock
+  # and switch off PLL, before resetting the clock gear ratio.
+
+  set *(unsigned long *)0x00ef4024 = 3
+  set *(unsigned long *)0x00ef4020 = 2
+  set *(unsigned long *)0x00ef4010 = 0
+  set *(unsigned long *)0x00ef4014 = 0
+  set *(unsigned long *)0x00ef4004 = 7
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4008 = 0x00000200
+end
+
+# Initialize SDRAM controller
+define sdram_init
+  # SDIR0
+  set *(unsigned long *)0x00ef6008 = 0x00000182
+  # SDIR1
+  set *(unsigned long *)0x00ef600c = 0x00000001
+  # Initialize wait
+  shell sleep 0.1
+  # Ch0-MOD
+  set *(unsigned long *)0x00ef602c = 0x00000020
+  # Ch0-TR
+  set *(unsigned long *)0x00ef6028 = 0x00041302
+  # Ch0-ADR (size:32MB)
+  set *(unsigned long *)0x00ef6020 = 0x08000003
+  # AutoRef On
+  set *(unsigned long *)0x00ef6004 = 0x00010517
+  # Access enable
+  set *(unsigned long *)0x00ef6024 = 0x00000001
+end
+document sdram_init
+  SDRAM controller initialization
+  0x08000000 - 0x09ffffff (32MB)
+end
+
+# Initialize BSEL3 for UT-CFC
+define cfc_init
+  set $sfrbase = 0xa0ef0000
+# too fast
+#  set *(unsigned long *)($sfrbase + 0x5300) = 0x0b0b8000
+#  set *(unsigned long *)($sfrbase + 0x5304) = 0x00102204
+#  set *(unsigned long *)($sfrbase + 0x5300) = 0x1f1f8000
+#  set *(unsigned long *)($sfrbase + 0x5300) = 0x1f1f1fdf
+#  set *(unsigned long *)($sfrbase + 0x5304) = 0x0013220f
+#  set *(unsigned long *)($sfrbase + 0x5304) = 0x0013330f
+end
+document cfc_init
+  CF controller initialization
+end
+
+# MMU enable
+define mmu_enable
+  set $evb=0x88000000
+  set *(unsigned long *)0xffff0024=1
+end
+
+# MMU disable
+define mmu_disable
+  set $evb=0
+  set *(unsigned long *)0xffff0024=0
+end
+
+# Show TLB entries
+define show_tlb_entries
+  set $i = 0
+  set $addr = $arg0
+  set $nr_entries = $arg1
+  use_mon_code
+  while ($i < $nr_entries)
+    set $tlb_tag = *(unsigned long*)$addr
+    set $tlb_data = *(unsigned long*)($addr + 4)
+    printf " [%2d] 0x%08lx : 0x%08lx - 0x%08lx\n", $i, $addr, $tlb_tag, $tlb_data
+    set $i = $i + 1
+    set $addr = $addr + 8
+  end
+  use_debug_dma
+end
+define itlb
+  set $itlb=0xfe000000
+  show_tlb_entries $itlb 0d32
+end
+define dtlb
+  set $dtlb=0xfe000800
+  show_tlb_entries $dtlb 0d32
+end
+
+# Initialize TLB entries
+define init_tlb_entries
+  set $i = 0
+  set $addr = $arg0
+  set $nr_entries = $arg1
+  use_mon_code
+  while ($i < $nr_entries)
+    set *(unsigned long *)($addr + 0x4) = 0
+    set $i = $i + 1
+    set $addr = $addr + 8
+  end
+  use_debug_dma
+end
+define tlb_init
+  set $itlb=0xfe000000
+  init_tlb_entries $itlb 0d32
+  set $dtlb=0xfe000800
+  init_tlb_entries $dtlb 0d32
+end
+
+# Show current task structure
+define show_current
+  set $current = $spi & 0xffffe000
+  printf "$current=0x%08lX\n",$current
+  print *(struct task_struct *)$current
+end
+
+# Show user assigned task structure
+define show_task
+  set  = $arg0 & 0xffffe000
+  printf "$task=0x%08lX\n",$task
+  print *(struct task_struct *)$task
+end
+document show_task
+  Show user assigned task structure
+  arg0 : task structure address
+end
+
+# Show M32R registers
+define show_regs
+  printf " R0[0x%08lX]   R1[0x%08lX]   R2[0x%08lX]   R3[0x%08lX]\n",$r0,$r1,$r2,$r3
+  printf " R4[0x%08lX]   R5[0x%08lX]   R6[0x%08lX]   R7[0x%08lX]\n",$r4,$r5,$r6,$r7
+  printf " R8[0x%08lX]   R9[0x%08lX]  R10[0x%08lX]  R11[0x%08lX]\n",$r8,$r9,$r10,$r11
+  printf "R12[0x%08lX]   FP[0x%08lX]   LR[0x%08lX]   SP[0x%08lX]\n",$r12,$fp,$lr,$sp
+  printf "PSW[0x%08lX]  CBR[0x%08lX]  SPI[0x%08lX]  SPU[0x%08lX]\n",$psw,$cbr,$spi,$spu
+  printf "BPC[0x%08lX]   PC[0x%08lX] ACCL[0x%08lX] ACCH[0x%08lX]\n",$bpc,$pc,$accl,$acch
+  printf "EVB[0x%08lX]\n",$evb
+end
+
+# Setup all
+define setup
+  use_mon_code
+  set *(unsigned int)0xfffffffc=0x60
+  shell sleep 0.1
+  clock_init
+  shell sleep 0.1
+  # SDRAM: 32MB
+  set *(unsigned long *)0x00ef6020 = 0x08000003
+  cfc_init
+  # USB
+  set *(unsigned short *)0xb0301000 = 0x100
+
+  set $evb=0x08000000
+end
+
+# Load modules
+define load_modules
+  use_debug_dma
+  load
+end
+
+# Set kernel parameters
+define set_kernel_parameters
+  set $param = (void*)0x08001000
+  # INITRD_START
+#  set *(unsigned long *)($param + 0x0010) = 0x08300000
+  # INITRD_SIZE
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
+  # M32R_CPUCLK
+  set *(unsigned long *)($param + 0x0018) = 0d400000000
+  # M32R_BUSCLK
+  set *(unsigned long *)($param + 0x001c) = 0d50000000
+
+  # M32R_TIMER_DIVIDE
+  set *(unsigned long *)($param + 0x0020) = 0d128
+
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x console=tty1 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs,rsize=1024,wsize=1024 nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 mem=32M \0"
+end
+
+# Boot
+define boot
+  set_kernel_parameters
+  set $fp = 0
+  set $pc = 0x08002000
+# set *(unsigned char *)0xffffffff = 0x03
+  si
+  c
+end
+
+# Set breakpoints
+define set_breakpoints
+  b *0x08000030
+end
+
+# Restart
+define restart
+  sdireset
+  sdireset
+  set $pc = 0
+  b *0x04001000
+  b *0x08001000
+  b *0x08002000
+  si
+  c
+  tlb_init
+  del
+  setup
+  load_modules
+  boot
+end
+
+define si
+  stepi
+  x/i $pc
+  show_reg
+end
+
+sdireset
+sdireset
+file vmlinux
+target m32rsdi
+set $pc = 0
+b *0x04001000
+b *0x08001000
+b *0x08002000
+c
+tlb_init
+del
+setup
+load_modules
+boot
+
diff -ruNp a/arch/m32r/mappi/dot.gdbinit b/arch/m32r/mappi/dot.gdbinit
--- a/arch/m32r/mappi/dot.gdbinit	2004-10-19 06:53:13.000000000 +0900
+++ b/arch/m32r/mappi/dot.gdbinit	2004-11-12 15:12:19.000000000 +0900
@@ -1,9 +1,9 @@
 # .gdbinit file
-# $Id$
+# $Id: dot.gdbinit.mappi,v 1.4 2004/10/20 02:24:37 takata Exp $
 #-----
 # NOTE: this file is generated by a script, "gen_gdbinit.pl".
 # (Please type "gen_gdbinit.pl --help" and check the help message).
-# $ Id: gen_gdbinit.pl,v 1.8 2004/02/27 07:08:32 takata Exp $
+# $ Id: gen_gdbinit.pl,v 1.12 2004/07/26 09:56:10 takata Exp $
 #-----
 # target platform: mappi
 
@@ -192,11 +192,11 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x08002000
+  set $param = (void*)0x08001000
   # INITRD_START
-  set *(unsigned long *)($param + 0x0010) = 0x082a0000
+#  set *(unsigned long *)($param + 0x0010) = 0x08300000
   # INITRD_SIZE
-  set *(unsigned long *)($param + 0x0014) = 0x00000000
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
   # M32R_CPUCLK
   set *(unsigned long *)($param + 0x0018) = 0d360000000
   # M32R_BUSCLK
@@ -205,14 +205,14 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.x nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x console=tty1 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
   set $fp = 0
-  set $pc=0x08001000
+  set $pc = 0x08002000
   si
   c
 end
@@ -236,7 +236,7 @@ sdireset
 file vmlinux
 target m32rsdi
 setup
-#load_module
+#load_modules
 #set_breakpoints
 #boot
 
diff -ruNp a/arch/m32r/mappi/dot.gdbinit.nommu b/arch/m32r/mappi/dot.gdbinit.nommu
--- a/arch/m32r/mappi/dot.gdbinit.nommu	2004-10-19 06:54:08.000000000 +0900
+++ b/arch/m32r/mappi/dot.gdbinit.nommu	2004-11-12 15:12:19.000000000 +0900
@@ -192,7 +192,7 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x00002000
+  set $param = (void*)0x00001000
   # INITRD_START
   #set *(unsigned long *)($param + 0x0010) = 0x082a0000
   # INITRD_SIZE
@@ -205,14 +205,14 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.bbox-httpd nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.bbox-httpd nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
   set $fp = 0
-  set $pc=0x00001000
+  set $pc=0x00002000
   set *(long *)0xfffffff4=0x8080
 #  b load_flat_binary
 #  set *(unsigned char *)0x08001003=0x63
diff -ruNp a/arch/m32r/mappi/dot.gdbinit.smp b/arch/m32r/mappi/dot.gdbinit.smp
--- a/arch/m32r/mappi/dot.gdbinit.smp	2004-10-19 06:53:07.000000000 +0900
+++ b/arch/m32r/mappi/dot.gdbinit.smp	2004-11-12 15:12:19.000000000 +0900
@@ -269,11 +269,11 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x08002000
+  set $param = (void*)0x08001000
   # INITRD_START
 # set *(unsigned long *)($param + 0x0010) = 0x082a0000
   # INITRD_SIZE
-  set *(unsigned long *)($param + 0x0014) = 0x00000000
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
   # M32R_CPUCLK
   set *(unsigned long *)($param + 0x0018) = 0d160000000
 #  set *(unsigned long *)($param + 0x0018) = 0d80000000
@@ -284,14 +284,14 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=tty1 console=ttyD0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.x nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
+  set {char[0x200]}($param + 0x100) = "console=tty1 console=ttyS0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.x nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
 #  set {char[0x200]}($param + 0x100) = "console=tty1 root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.x nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
-  set $pc=0x08001000
+  set $pc=0x08002000
   set *(unsigned char *)0x08001003=0x03
   si
   c
@@ -309,7 +309,7 @@ define boot_mp
   set *(unsigned long *)0x00eff2f8 = 0x2
   x 0x00eff2f8
 
-  set $pc=0x08001000
+  set $pc=0x08002000
   si
   c
 end
@@ -320,7 +320,7 @@ end
 ## Boot UP
 define boot_up
   set_kernel_parameters
-  set $pc=0x08001000
+  set $pc=0x08002000
   si
   c
 end
diff -ruNp a/arch/m32r/mappi2/dot.gdbinit.vdec2 b/arch/m32r/mappi2/dot.gdbinit.vdec2
--- a/arch/m32r/mappi2/dot.gdbinit.vdec2	1970-01-01 09:00:00.000000000 +0900
+++ b/arch/m32r/mappi2/dot.gdbinit.vdec2	2004-11-12 15:12:19.000000000 +0900
@@ -0,0 +1,233 @@
+# .gdbinit file
+# $Id: dot.gdbinit.vdec2,v 1.2 2004/11/11 02:03:15 takata Exp $
+
+# setting
+set width 0d70
+set radix 0d16
+use_debug_dma
+
+# Initialize SDRAM controller for Mappi
+define sdram_init
+  # SDIR0
+  set *(unsigned long *)0x00ef6008=0x00000182
+  # SDIR1
+  set *(unsigned long *)0x00ef600c=0x00000001
+  # Initialize wait
+  shell sleep 1
+  # Ch0-MOD
+  set *(unsigned long *)0x00ef602c=0x00000020
+  # Ch0-TR
+  set *(unsigned long *)0x00ef6028=0x00041302
+  # Ch0-ADR
+  set *(unsigned long *)0x00ef6020=0x08000004
+  # AutoRef On
+  set *(unsigned long *)0x00ef6004=0x00010705
+  # Access enable
+  set *(unsigned long *)0x00ef6024=0x00000001
+end
+document sdram_init
+  Mappi SDRAM controller initialization
+  0x08000000 - 0x0bffffff (64MB)
+end
+
+# Initialize SDRAM controller for Mappi
+define sdram_init2
+  # SDIR0
+  set *(unsigned long *)0x00ef6008=0x00000182
+  # Ch0-MOD
+  set *(unsigned long *)0x00ef602c=0x00000020
+  # Ch0-TR
+  set *(unsigned long *)0x00ef6028=0x00010002
+  # Ch0-ADR
+  set *(unsigned long *)0x00ef6020=0x08000004
+  # AutoRef On
+  set *(unsigned long *)0x00ef6004=0x00010107
+  # SDIR1
+  set *(unsigned long *)0x00ef600c=0x00000001
+  # Initialize wait
+  shell sleep 1
+  # Access enable
+  set *(unsigned long *)0x00ef6024=0x00000001
+  shell sleep 1
+end
+document sdram_init
+  Mappi SDRAM controller initialization
+  0x08000000 - 0x0bffffff (64MB)
+end
+
+# Initialize LAN controller for Mappi
+define lanc_init
+  # Set BSEL1 (BSEL3 for the Chaos's bselc)
+  #set *(unsigned long *)0x00ef5004 = 0x0fff330f
+  #set *(unsigned long *)0x00ef5004 = 0x01113301
+
+#  set *(unsigned long *)0x00ef5004 = 0x02011101
+#  set *(unsigned long *)0x00ef5004 = 0x04441104
+
+  # BSEL5
+#  set *(unsigned long *)0x00ef5014 = 0x0ccc310c
+#  set *(unsigned long *)0x00ef5014 = 0x0303310f
+#  set *(unsigned long *)0x00ef5014 = 0x01011102 -> NG
+#  set *(unsigned long *)0x00ef5014 = 0x03033103
+
+ set *(unsigned long *)0x00ef500c = 0x0b0b1304
+ set *(unsigned long *)0x00ef5010 = 0x03033302
+# set *(unsigned long *)0x00ef5018 = 0x02223302
+end
+
+# MMU enable
+define mmu_enable
+  set $evb=0x88000000
+  set *(unsigned long *)0xffff0024=1
+end
+
+# MMU disable
+define mmu_disable
+  set $evb=0
+  set *(unsigned long *)0xffff0024=0
+end
+
+# Show TLB entries
+define show_tlb_entries
+  set $i = 0
+  set $addr = $arg0
+  while ($i < 0d16 )
+    set $tlb_tag = *(unsigned long*)$addr
+    set $tlb_data = *(unsigned long*)($addr + 4)
+    printf " [%2d] 0x%08lx : 0x%08lx - 0x%08lx\n", $i, $addr, $tlb_tag, $tlb_data
+    set $i = $i + 1
+    set $addr = $addr + 8
+  end
+end
+define itlb
+  set $itlb=0xfe000000
+  show_tlb_entries $itlb
+end
+define dtlb
+  set $dtlb=0xfe000800
+  show_tlb_entries $dtlb
+end
+
+# Cache ON
+define set_cache_type
+  set $mctype = (void*)0xfffffff8
+# chaos
+# set *(unsigned long *)($mctype) = 0x0000c000
+# m32102 i-cache only
+  set *(unsigned long *)($mctype) = 0x00008000
+# m32102 d-cache only
+#  set *(unsigned long *)($mctype) = 0x00004000
+end
+define cache_on
+  set $param = (void*)0x08001000
+  set *(unsigned long *)($param) = 0x60ff6102
+end
+
+
+# Show current task structure
+define show_current
+  set $current = $spi & 0xffffe000
+  printf "$current=0x%08lX\n",$current
+  print *(struct task_struct *)$current
+end
+
+# Show user assigned task structure
+define show_task
+  set $task = $arg0 & 0xffffe000
+  printf "$task=0x%08lX\n",$task
+  print *(struct task_struct *)$task
+end
+document show_task
+  Show user assigned task structure
+  arg0 : task structure address
+end
+
+# Show M32R registers
+define show_regs
+  printf " R0[0x%08lX]   R1[0x%08lX]   R2[0x%08lX]   R3[0x%08lX]\n",$r0,$r1,$r2,$r3 
+  printf " R4[0x%08lX]   R5[0x%08lX]   R6[0x%08lX]   R7[0x%08lX]\n",$r4,$r5,$r6,$r7 
+  printf " R8[0x%08lX]   R9[0x%08lX]  R10[0x%08lX]  R11[0x%08lX]\n",$r8,$r9,$r10,$r11 
+  printf "R12[0x%08lX]   FP[0x%08lX]   LR[0x%08lX]   SP[0x%08lX]\n",$r12,$fp,$lr,$sp
+  printf "PSW[0x%08lX]  CBR[0x%08lX]  SPI[0x%08lX]  SPU[0x%08lX]\n",$psw,$cbr,$spi,$spu
+  printf "BPC[0x%08lX]   PC[0x%08lX] ACCL[0x%08lX] ACCH[0x%08lX]\n",$bpc,$pc,$accl,$acch
+  printf "EVB[0x%08lX]\n",$evb
+
+  set $mests = *(unsigned long *)0xffff000c
+  set $mdeva = *(unsigned long *)0xffff0010
+  printf "MESTS[0x%08lX] MDEVA[0x%08lX]\n",$mests,$mdeva
+end
+
+
+# Setup all
+define setup
+  sdram_init
+#  lanc_init
+#  dispc_init
+#  set $evb=0x08000000
+end
+
+# Load modules
+define load_modules
+  use_debug_dma
+  load
+#  load busybox.mot
+end
+
+# Set kernel parameters
+define set_kernel_parameters
+  set $param = (void*)0x08001000
+
+  ## MOUNT_ROOT_RDONLY
+  set {long}($param+0x00)=0
+  ## RAMDISK_FLAGS
+  #set {long}($param+0x04)=0
+  ## ORIG_ROOT_DEV
+  #set {long}($param+0x08)=0x00000100
+  ## LOADER_TYPE
+  #set {long}($param+0x0C)=0
+  ## INITRD_START
+  set {long}($param+0x10)=0x082a0000
+  ## INITRD_SIZE
+  set {long}($param+0x14)=0d6200000
+
+  # M32R_CPUCLK
+  set *(unsigned long *)($param + 0x0018) = 0d25000000
+  # M32R_BUSCLK
+  set *(unsigned long *)($param + 0x001c) = 0d25000000
+  # M32R_TIMER_DIVIDE
+  set *(unsigned long *)($param + 0x0020) = 0d128
+
+
+ set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.2.6 nfsaddrs=192.168.0.102:192.168.0.1:192.168.0.1:255.255.255.0:mappi: \0"
+
+
+end
+
+# Boot
+define boot
+  set_kernel_parameters
+  debug_chaos
+  set $pc=0x08002000
+  set $fp=0
+  del b
+  si
+end
+
+# Restart
+define restart
+  sdireset
+  sdireset
+  setup
+  load_modules
+  boot
+end
+
+sdireset
+sdireset
+file vmlinux
+target m32rsdi
+
+restart
+boot
+
+
diff -ruNp a/arch/m32r/oaks32r/dot.gdbinit.nommu b/arch/m32r/oaks32r/dot.gdbinit.nommu
--- a/arch/m32r/oaks32r/dot.gdbinit.nommu	2004-10-19 06:53:06.000000000 +0900
+++ b/arch/m32r/oaks32r/dot.gdbinit.nommu	2004-11-12 15:12:19.000000000 +0900
@@ -1,9 +1,9 @@
 # .gdbinit file
-# $Id: dot.gdbinit.oaks32r,v 1.2 2004/04/15 02:33:14 takata Exp $
+# $Id: dot.gdbinit.oaks32r,v 1.4 2004/10/20 02:24:37 takata Exp $
 #-----
 # NOTE: this file is generated by a script, "gen_gdbinit.pl".
 # (Please type "gen_gdbinit.pl --help" and check the help message).
-# $ Id: gen_gdbinit.pl,v 1.10 2004/04/15 02:10:45 takata Exp $
+# $ Id: gen_gdbinit.pl,v 1.12 2004/07/26 09:56:10 takata Exp $
 #-----
 # target platform: oaks32r
 
@@ -103,11 +103,11 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x01002000
+  set $param = (void*)0x01001000
   # INITRD_START
-  set *(unsigned long *)($param + 0x0010) = 0x00000000
+#  set *(unsigned long *)($param + 0x0010) = 0x00000000
   # INITRD_SIZE
-  set *(unsigned long *)($param + 0x0014) = 0x00000000
+#  set *(unsigned long *)($param + 0x0014) = 0x00000000
   # M32R_CPUCLK
   set *(unsigned long *)($param + 0x0018) = 0d66666667
   # M32R_BUSCLK
@@ -116,15 +116,14 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-#  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/root.busybox.flat nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x root=/dev/nfsroot nfsroot=192.168.0.1:/project/m32r-linux/export/rootfs nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \0"
 end
 
 # Boot
 define boot
   set_kernel_parameters
   set $fp = 0
-  set $pc = 0x01001000
+  set $pc = 0x01002000
   si
   c
 end
diff -ruNp a/arch/m32r/opsput/dot.gdbinit b/arch/m32r/opsput/dot.gdbinit
--- a/arch/m32r/opsput/dot.gdbinit	2004-10-19 06:54:27.000000000 +0900
+++ b/arch/m32r/opsput/dot.gdbinit	2004-11-12 15:12:19.000000000 +0900
@@ -7,6 +7,39 @@ set radix 0d16
 set height 0
 debug_chaos
 
+# clk xin:cpu:bus=1:8:1
+define clock_init_on_181
+  set *(unsigned long *)0x00ef400c = 0x2
+  set *(unsigned long *)0x00ef4004 = 0x1
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4000 = 0x101
+end
+# clk xin:cpu:bus=1:8:2
+define clock_init_on_182
+  set *(unsigned long *)0x00ef400c = 0x1
+  set *(unsigned long *)0x00ef4004 = 0x1
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4000 = 0x101
+end
+
+# clk xin:cpu:bus=1:8:4
+define clock_init_on_184
+  set *(unsigned long *)0x00ef400c = 0x0
+  set *(unsigned long *)0x00ef4004 = 0x1
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4000 = 0x101
+end
+
+# clk xin:cpu:bus=1:1:1
+define clock_init_off
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4000 = 0x0
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef4004 = 0x0
+  shell sleep 0.1
+  set *(unsigned long *)0x00ef400c = 0x0
+end
+
 define tlb_init
   set $tlbbase = 0xfe000000
   set *(unsigned long *)($tlbbase + 0x04) = 0x0
@@ -83,7 +116,7 @@ end
 
 # Set kernel parameters
 define set_kernel_parameters
-  set $param = (void*)0x88002000
+  set $param = (void*)0x88001000
   # INITRD_START
 #  set *(unsigned long *)($param + 0x0010) = 0x08300000
   # INITRD_SIZE
@@ -97,7 +130,7 @@ define set_kernel_parameters
   # M32R_TIMER_DIVIDE
   set *(unsigned long *)($param + 0x0020) = 0d128
 
-  set {char[0x200]}($param + 0x100) = "console=ttyD0,115200n8x\
+  set {char[0x200]}($param + 0x100) = "console=ttyS0,115200n8x console=tty1 \
   root=/dev/nfsroot \
   nfsroot=192.168.0.1:/project/m32r-linux/export/root.2.6 \
   nfsaddrs=192.168.0.101:192.168.0.1:192.168.0.1:255.255.255.0:mappi001 \
@@ -106,16 +139,11 @@ end
 
 define boot
   set_kernel_parameters
-  set $pc=0x88001000
+  set $pc=0x88002000
   set $fp=0
   set $evb=0x88000000
-  # I/D-Cache ON
-
-# IPI
-#  set *(long *)0x00eff2f8 = 0x2
-  set $fp=0
-#  set *(unsigned long *)0xa0ef4000 = 0x100
   si
+  c
 end
 
 # Show TLB entries
@@ -151,11 +179,29 @@ define show_regs
   printf "EVB[%08lx]\n",$evb
 end
 
+define restart
+  sdireset
+  sdireset
+  en 1
+  set $pc=0x0
+  c
+  tlb_init
+  setup
+  load_modules
+  boot
+end
+
 define setup
   debug_chaos
+# Clock
+#  shell sleep 0.1
+#  clock_init_off
+#  shell sleep 1
+#  clock_init_on_182
+#  shell sleep 0.1
+# SDRAM
   set *(unsigned long *)0xa0ef6004 = 0x0001053f
   set *(unsigned long *)0xa0ef6028 = 0x00031102
-#  set *(unsigned long *)0xa0ef400c = 0x2
 end
 
 sdireset
@@ -165,16 +211,8 @@ target m32rsdi
 set $pc=0x0
 b *0x30000
 c
+dis 1
 setup
 tlb_init
 load_modules
-#set *(long *)0xa0ef4000=0x101
-#set *(long *)0xa0ef400c=0x002
-
 boot
-#b tme_handler
-b *0x88000020
-
-
-
-

--
Hirokazu Takata <takata@linux-m32r.org>
Linux/M32R Project:  http://www.linux-m32r.org/

