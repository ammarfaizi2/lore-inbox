Return-Path: <linux-kernel-owner+willy=40w.ods.org-S266526AbUFUX1Y@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266526AbUFUX1Y (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 21 Jun 2004 19:27:24 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266527AbUFUX1Q
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 21 Jun 2004 19:27:16 -0400
Received: from crete.csd.uch.gr ([147.52.16.2]:14322 "EHLO crete.csd.uch.gr")
	by vger.kernel.org with ESMTP id S266526AbUFUXZr (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 21 Jun 2004 19:25:47 -0400
Organization: 
Date: Tue, 22 Jun 2004 02:25:25 +0300 (EEST)
From: Panagiotis Papadakos <papadako@csd.uoc.gr>
To: kernel@kolivas.org
cc: linux-kernel@vger.kernel.org
Subject: [PATCH] Staircase 7.1 for 2.6.7-mm1
Message-ID: <Pine.GSO.4.58.0406220223430.20157@thanatos.csd.uoc.gr>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-851401618-1087860325=:20157"
X-Spam-Flag: NO
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---559023410-851401618-1087860325=:20157
Content-Type: TEXT/PLAIN; charset=US-ASCII

Here is a patch for 2.6.7-mm1.

Regards
	Panagiotis Papadakos
---559023410-851401618-1087860325=:20157
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="from-2.6.7-mm1_to_staircase7.1"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.GSO.4.58.0406220225250.20157@thanatos.csd.uoc.gr>
Content-Description: 
Content-Disposition: attachment; filename="from-2.6.7-mm1_to_staircase7.1"

ZGlmZiAtTmF1cnAgbGludXgtMi42LjctbW0xLW5vL2ZzL3Byb2MvYXJyYXku
YyBsaW51eC0yLjYuNy1tbTEvZnMvcHJvYy9hcnJheS5jDQotLS0gbGludXgt
Mi42LjctbW0xLW5vL2ZzL3Byb2MvYXJyYXkuYwkyMDA0LTA2LTE5IDAyOjQ1
OjQ3LjAwMDAwMDAwMCArMDMwMA0KKysrIGxpbnV4LTIuNi43LW1tMS9mcy9w
cm9jL2FycmF5LmMJMjAwNC0wNi0yMiAwMToxMDoyOS4wMDAwMDAwMDAgKzAz
MDANCkBAIC0xNTUsNyArMTU1LDcgQEAgc3RhdGljIGlubGluZSBjaGFyICog
dGFza19zdGF0ZShzdHJ1Y3QgdA0KIAlyZWFkX2xvY2soJnRhc2tsaXN0X2xv
Y2spOw0KIAlidWZmZXIgKz0gc3ByaW50ZihidWZmZXIsDQogCQkiU3RhdGU6
XHQlc1xuIg0KLQkJIlNsZWVwQVZHOlx0JWx1JSVcbiINCisJCSJCdXJzdDpc
dCVkXG4iDQogCQkiVGdpZDpcdCVkXG4iDQogCQkiUGlkOlx0JWRcbiINCiAJ
CSJQUGlkOlx0JWRcbiINCkBAIC0xNjMsNyArMTYzLDcgQEAgc3RhdGljIGlu
bGluZSBjaGFyICogdGFza19zdGF0ZShzdHJ1Y3QgdA0KIAkJIlVpZDpcdCVk
XHQlZFx0JWRcdCVkXG4iDQogCQkiR2lkOlx0JWRcdCVkXHQlZFx0JWRcbiIs
DQogCQlnZXRfdGFza19zdGF0ZShwKSwNCi0JCShwLT5zbGVlcF9hdmcvMTAy
NCkqMTAwLygxMDIwMDAwMDAwLzEwMjQpLA0KKwkJcC0+YnVyc3QsDQogCSAg
ICAgICAJcC0+dGdpZCwNCiAJCXAtPnBpZCwgcC0+cGlkID8gcC0+cmVhbF9w
YXJlbnQtPnBpZCA6IDAsDQogCQlwLT5waWQgJiYgcC0+cHRyYWNlID8gcC0+
cGFyZW50LT5waWQgOiAwLA0KZGlmZiAtTmF1cnAgbGludXgtMi42LjctbW0x
LW5vL2luY2x1ZGUvbGludXgvc2NoZWQuaCBsaW51eC0yLjYuNy1tbTEvaW5j
bHVkZS9saW51eC9zY2hlZC5oDQotLS0gbGludXgtMi42LjctbW0xLW5vL2lu
Y2x1ZGUvbGludXgvc2NoZWQuaAkyMDA0LTA2LTIyIDAxOjMwOjI2LjAwMDAw
MDAwMCArMDMwMA0KKysrIGxpbnV4LTIuNi43LW1tMS9pbmNsdWRlL2xpbnV4
L3NjaGVkLmgJMjAwNC0wNi0yMiAwMToxMDoyOS4wMDAwMDAwMDAgKzAzMDAN
CkBAIC0xNzIsNiArMTcyLDcgQEAgZXh0ZXJuIHZvaWQgc2hvd19zdGFjayhz
dHJ1Y3QgdGFza19zdHJ1Yw0KIA0KIHZvaWQgaW9fc2NoZWR1bGUodm9pZCk7
DQogbG9uZyBpb19zY2hlZHVsZV90aW1lb3V0KGxvbmcgdGltZW91dCk7DQor
ZXh0ZXJuIGludCBpbnRlcmFjdGl2ZSwgY29tcHV0ZTsNCiANCiBleHRlcm4g
dm9pZCBjcHVfaW5pdCAodm9pZCk7DQogZXh0ZXJuIHZvaWQgdHJhcF9pbml0
KHZvaWQpOw0KQEAgLTMzNCw3ICszMzUsNiBAQCBleHRlcm4gc3RydWN0IHVz
ZXJfc3RydWN0ICpmaW5kX3VzZXIodWlkDQogZXh0ZXJuIHN0cnVjdCB1c2Vy
X3N0cnVjdCByb290X3VzZXI7DQogI2RlZmluZSBJTklUX1VTRVIgKCZyb290
X3VzZXIpDQogDQotdHlwZWRlZiBzdHJ1Y3QgcHJpb19hcnJheSBwcmlvX2Fy
cmF5X3Q7DQogc3RydWN0IGJhY2tpbmdfZGV2X2luZm87DQogc3RydWN0IHJl
Y2xhaW1fc3RhdGU7DQogDQpAQCAtNDA2LDE2ICs0MDYsMTMgQEAgc3RydWN0
IHRhc2tfc3RydWN0IHsNCiANCiAJaW50IHByaW8sIHN0YXRpY19wcmlvOw0K
IAlzdHJ1Y3QgbGlzdF9oZWFkIHJ1bl9saXN0Ow0KLQlwcmlvX2FycmF5X3Qg
KmFycmF5Ow0KLQ0KLQl1bnNpZ25lZCBsb25nIHNsZWVwX2F2ZzsNCi0JbG9u
ZyBpbnRlcmFjdGl2ZV9jcmVkaXQ7DQogCXVuc2lnbmVkIGxvbmcgbG9uZyB0
aW1lc3RhbXA7DQotCWludCBhY3RpdmF0ZWQ7DQorCXVuc2lnbmVkIGxvbmcg
cnVudGltZSwgdG90YWxydW47DQorCXVuc2lnbmVkIGludCBidXJzdDsNCiAN
CiAJdW5zaWduZWQgbG9uZyBwb2xpY3k7DQogCWNwdW1hc2tfdCBjcHVzX2Fs
bG93ZWQ7DQotCXVuc2lnbmVkIGludCB0aW1lX3NsaWNlLCBmaXJzdF90aW1l
X3NsaWNlOw0KKwl1bnNpZ25lZCBpbnQgc2xpY2UsIHRpbWVfc2xpY2U7DQog
DQogCXN0cnVjdCBsaXN0X2hlYWQgdGFza3M7DQogCXN0cnVjdCBsaXN0X2hl
YWQgcHRyYWNlX2NoaWxkcmVuOw0KQEAgLTc5MCw3ICs3ODcsNiBAQCBleHRl
cm4gdm9pZCBGQVNUQ0FMTCh3YWtlX3VwX2ZvcmtlZF9wcm9jDQogIH0NCiAj
ZW5kaWYNCiBleHRlcm4gdm9pZCBGQVNUQ0FMTChzY2hlZF9mb3JrKHRhc2tf
dCAqIHApKTsNCi1leHRlcm4gdm9pZCBGQVNUQ0FMTChzY2hlZF9leGl0KHRh
c2tfdCAqIHApKTsNCiANCiBleHRlcm4gaW50IGluX2dyb3VwX3AoZ2lkX3Qp
Ow0KIGV4dGVybiBpbnQgaW5fZWdyb3VwX3AoZ2lkX3QpOw0KZGlmZiAtTmF1
cnAgbGludXgtMi42LjctbW0xLW5vL2luY2x1ZGUvbGludXgvc3lzY3RsLmgg
bGludXgtMi42LjctbW0xL2luY2x1ZGUvbGludXgvc3lzY3RsLmgNCi0tLSBs
aW51eC0yLjYuNy1tbTEtbm8vaW5jbHVkZS9saW51eC9zeXNjdGwuaAkyMDA0
LTA2LTIyIDAxOjMwOjI2LjAwMDAwMDAwMCArMDMwMA0KKysrIGxpbnV4LTIu
Ni43LW1tMS9pbmNsdWRlL2xpbnV4L3N5c2N0bC5oCTIwMDQtMDYtMjIgMDE6
MTA6MjkuMDAwMDAwMDAwICswMzAwDQpAQCAtMTMzLDYgKzEzMyw4IEBAIGVu
dW0NCiAJS0VSTl9OR1JPVVBTX01BWD02MywJLyogaW50OiBOR1JPVVBTX01B
WCAqLw0KIAlLRVJOX1NQQVJDX1NDT05TX1BXUk9GRj02NCwgLyogaW50OiBz
ZXJpYWwgY29uc29sZSBwb3dlci1vZmYgaGFsdCAqLw0KIAlLRVJOX0haX1RJ
TUVSPTY1LAkvKiBpbnQ6IGh6IHRpbWVyIG9uIG9yIG9mZiAqLw0KKwlLRVJO
X0lOVEVSQUNUSVZFPTY2LAkvKiBpbnRlcmFjdGl2ZSB0YXNrcyBjYW4gaGF2
ZSBjcHUgYnVyc3RzICovDQorCUtFUk5fQ09NUFVURT02NywJLyogYWRqdXN0
IHRpbWVzbGljZXMgZm9yIGEgY29tcHV0ZSBzZXJ2ZXIgKi8NCiB9Ow0KIA0K
IA0KZGlmZiAtTmF1cnAgbGludXgtMi42LjctbW0xLW5vL2luaXQvbWFpbi5j
IGxpbnV4LTIuNi43LW1tMS9pbml0L21haW4uYw0KLS0tIGxpbnV4LTIuNi43
LW1tMS1uby9pbml0L21haW4uYwkyMDA0LTA2LTIyIDAxOjMwOjI2LjAwMDAw
MDAwMCArMDMwMA0KKysrIGxpbnV4LTIuNi43LW1tMS9pbml0L21haW4uYwky
MDA0LTA2LTIyIDAxOjEwOjI5LjAwMDAwMDAwMCArMDMwMA0KQEAgLTMyNiw4
ICszMjYsMTUgQEAgc3RhdGljIHZvaWQgX19pbml0IHNtcF9pbml0KHZvaWQp
DQogI2RlZmluZSBzbXBfaW5pdCgpCWRvIHsgfSB3aGlsZSAoMCkNCiAjZW5k
aWYNCiANCit1bnNpZ25lZCBsb25nIGNhY2hlX2RlY2F5X3RpY2tzOw0KIHN0
YXRpYyBpbmxpbmUgdm9pZCBzZXR1cF9wZXJfY3B1X2FyZWFzKHZvaWQpIHsg
fQ0KLXN0YXRpYyBpbmxpbmUgdm9pZCBzbXBfcHJlcGFyZV9jcHVzKHVuc2ln
bmVkIGludCBtYXhjcHVzKSB7IH0NCitzdGF0aWMgdm9pZCBzbXBfcHJlcGFy
ZV9jcHVzKHVuc2lnbmVkIGludCBtYXhjcHVzKQ0KK3sNCisJLy8gR2VuZXJp
YyAyIHRpY2sgY2FjaGVfZGVjYXkgZm9yIHVuaXByb2Nlc3Nvcg0KKwljYWNo
ZV9kZWNheV90aWNrcyA9IDI7DQorCXByaW50aygiR2VuZXJpYyBjYWNoZSBk
ZWNheSB0aW1lb3V0OiAlbGQgbXNlY3MuXG4iLA0KKwkJKGNhY2hlX2RlY2F5
X3RpY2tzICogMTAwMCAvIEhaKSk7DQorfQ0KIA0KICNlbHNlDQogDQpkaWZm
IC1OYXVycCBsaW51eC0yLjYuNy1tbTEtbm8va2VybmVsL2V4aXQuYyBsaW51
eC0yLjYuNy1tbTEva2VybmVsL2V4aXQuYw0KLS0tIGxpbnV4LTIuNi43LW1t
MS1uby9rZXJuZWwvZXhpdC5jCTIwMDQtMDYtMjIgMDE6MzA6MjYuMDAwMDAw
MDAwICswMzAwDQorKysgbGludXgtMi42LjctbW0xL2tlcm5lbC9leGl0LmMJ
MjAwNC0wNi0yMiAwMToxMDoyOS4wMDAwMDAwMDAgKzAzMDANCkBAIC05Niw3
ICs5Niw2IEBAIHJlcGVhdDogDQogCXAtPnBhcmVudC0+Y21hal9mbHQgKz0g
cC0+bWFqX2ZsdCArIHAtPmNtYWpfZmx0Ow0KIAlwLT5wYXJlbnQtPmNudmNz
dyArPSBwLT5udmNzdyArIHAtPmNudmNzdzsNCiAJcC0+cGFyZW50LT5jbml2
Y3N3ICs9IHAtPm5pdmNzdyArIHAtPmNuaXZjc3c7DQotCXNjaGVkX2V4aXQo
cCk7DQogCXdyaXRlX3VubG9ja19pcnEoJnRhc2tsaXN0X2xvY2spOw0KIAlz
cGluX3VubG9jaygmcC0+cHJvY19sb2NrKTsNCiAJcHJvY19waWRfZmx1c2go
cHJvY19kZW50cnkpOw0KZGlmZiAtTmF1cnAgbGludXgtMi42LjctbW0xLW5v
L2tlcm5lbC9zY2hlZC5jIGxpbnV4LTIuNi43LW1tMS9rZXJuZWwvc2NoZWQu
Yw0KLS0tIGxpbnV4LTIuNi43LW1tMS1uby9rZXJuZWwvc2NoZWQuYwkyMDA0
LTA2LTIyIDAxOjMwOjI2LjAwMDAwMDAwMCArMDMwMA0KKysrIGxpbnV4LTIu
Ni43LW1tMS9rZXJuZWwvc2NoZWQuYwkyMDA0LTA2LTIyIDAxOjI2OjAwLjAw
MDAwMDAwMCArMDMwMA0KQEAgLTE2LDYgKzE2LDggQEANCiAgKgkJYnkgRGF2
aWRlIExpYmVuemksIHByZWVtcHRpYmxlIGtlcm5lbCBiaXRzIGJ5IFJvYmVy
dCBMb3ZlLg0KICAqICAyMDAzLTA5LTAzCUludGVyYWN0aXZpdHkgdHVuaW5n
IGJ5IENvbiBLb2xpdmFzLg0KICAqICAyMDA0LTA0LTAyCVNjaGVkdWxlciBk
b21haW5zIGNvZGUgYnkgTmljayBQaWdnaW4NCisgKiAgMjAwNC0wNi0xMQlO
ZXcgc3RhaXJjYXNlIHNjaGVkdWxpbmcgcG9saWN5IGJ5IENvbiBLb2xpdmFz
IHdpdGggaGVscA0KKyAqCQlmcm9tIFdpbGxpYW0gTGVlIElyd2luIElJSSwg
WndhbmUgTXdhaWthbWJvICYgUGV0ZXIgV2lsbGlhbXMuDQogICovDQogDQog
I2luY2x1ZGUgPGxpbnV4L21tLmg+DQpAQCAtNDcsMTIgKzQ5LDYgQEANCiAN
CiAjaW5jbHVkZSA8YXNtL3VuaXN0ZC5oPg0KIA0KLSNpZmRlZiBDT05GSUdf
TlVNQQ0KLSNkZWZpbmUgY3B1X3RvX25vZGVfbWFzayhjcHUpIG5vZGVfdG9f
Y3B1bWFzayhjcHVfdG9fbm9kZShjcHUpKQ0KLSNlbHNlDQotI2RlZmluZSBj
cHVfdG9fbm9kZV9tYXNrKGNwdSkgKGNwdV9vbmxpbmVfbWFwKQ0KLSNlbmRp
Zg0KLQ0KIC8qDQogICogQ29udmVydCB1c2VyLW5pY2UgdmFsdWVzIFsgLTIw
IC4uLiAwIC4uLiAxOSBdDQogICogdG8gc3RhdGljIHByaW9yaXR5IFsgTUFY
X1JUX1BSSU8uLk1BWF9QUklPLTEgXSwNCkBAIC03MCwxMTggKzY2LDIwIEBA
DQogI2RlZmluZSBVU0VSX1BSSU8ocCkJCSgocCktTUFYX1JUX1BSSU8pDQog
I2RlZmluZSBUQVNLX1VTRVJfUFJJTyhwKQlVU0VSX1BSSU8oKHApLT5zdGF0
aWNfcHJpbykNCiAjZGVmaW5lIE1BWF9VU0VSX1BSSU8JCShVU0VSX1BSSU8o
TUFYX1BSSU8pKQ0KLSNkZWZpbmUgQVZHX1RJTUVTTElDRQkoTUlOX1RJTUVT
TElDRSArICgoTUFYX1RJTUVTTElDRSAtIE1JTl9USU1FU0xJQ0UpICpcDQot
CQkJKE1BWF9QUklPLTEtTklDRV9UT19QUklPKDApKS8oTUFYX1VTRVJfUFJJ
TyAtIDEpKSkNCiANCiAvKg0KICAqIFNvbWUgaGVscGVycyBmb3IgY29udmVy
dGluZyBuYW5vc2Vjb25kIHRpbWluZyB0byBqaWZmeSByZXNvbHV0aW9uDQog
ICovDQogI2RlZmluZSBOU19UT19KSUZGSUVTKFRJTUUpCSgoVElNRSkgLyAo
MTAwMDAwMDAwMCAvIEhaKSkNCi0jZGVmaW5lIEpJRkZJRVNfVE9fTlMoVElN
RSkJKChUSU1FKSAqICgxMDAwMDAwMDAwIC8gSFopKQ0KLQ0KLS8qDQotICog
VGhlc2UgYXJlIHRoZSAndHVuaW5nIGtub2JzJyBvZiB0aGUgc2NoZWR1bGVy
Og0KLSAqDQotICogTWluaW11bSB0aW1lc2xpY2UgaXMgMTAgbXNlY3MsIGRl
ZmF1bHQgdGltZXNsaWNlIGlzIDEwMCBtc2VjcywNCi0gKiBtYXhpbXVtIHRp
bWVzbGljZSBpcyAyMDAgbXNlY3MuIFRpbWVzbGljZXMgZ2V0IHJlZmlsbGVk
IGFmdGVyDQotICogdGhleSBleHBpcmUuDQotICovDQotI2RlZmluZSBNSU5f
VElNRVNMSUNFCQkoIDEwICogSFogLyAxMDAwKQ0KLSNkZWZpbmUgTUFYX1RJ
TUVTTElDRQkJKDIwMCAqIEhaIC8gMTAwMCkNCi0jZGVmaW5lIE9OX1JVTlFV
RVVFX1dFSUdIVAkgMzANCi0jZGVmaW5lIENISUxEX1BFTkFMVFkJCSA5NQ0K
LSNkZWZpbmUgUEFSRU5UX1BFTkFMVFkJCTEwMA0KLSNkZWZpbmUgRVhJVF9X
RUlHSFQJCSAgMw0KLSNkZWZpbmUgUFJJT19CT05VU19SQVRJTwkgMjUNCi0j
ZGVmaW5lIE1BWF9CT05VUwkJKE1BWF9VU0VSX1BSSU8gKiBQUklPX0JPTlVT
X1JBVElPIC8gMTAwKQ0KLSNkZWZpbmUgSU5URVJBQ1RJVkVfREVMVEEJICAy
DQotI2RlZmluZSBNQVhfU0xFRVBfQVZHCQkoQVZHX1RJTUVTTElDRSAqIE1B
WF9CT05VUykNCi0jZGVmaW5lIFNUQVJWQVRJT05fTElNSVQJKE1BWF9TTEVF
UF9BVkcpDQotI2RlZmluZSBOU19NQVhfU0xFRVBfQVZHCShKSUZGSUVTX1RP
X05TKE1BWF9TTEVFUF9BVkcpKQ0KLSNkZWZpbmUgQ1JFRElUX0xJTUlUCQkx
MDANCi0NCi0vKg0KLSAqIElmIGEgdGFzayBpcyAnaW50ZXJhY3RpdmUnIHRo
ZW4gd2UgcmVpbnNlcnQgaXQgaW4gdGhlIGFjdGl2ZQ0KLSAqIGFycmF5IGFm
dGVyIGl0IGhhcyBleHBpcmVkIGl0cyBjdXJyZW50IHRpbWVzbGljZS4gKGl0
IHdpbGwgbm90DQotICogY29udGludWUgdG8gcnVuIGltbWVkaWF0ZWx5LCBp
dCB3aWxsIHN0aWxsIHJvdW5kcm9iaW4gd2l0aA0KLSAqIG90aGVyIGludGVy
YWN0aXZlIHRhc2tzLikNCi0gKg0KLSAqIFRoaXMgcGFydCBzY2FsZXMgdGhl
IGludGVyYWN0aXZpdHkgbGltaXQgZGVwZW5kaW5nIG9uIG5pY2VuZXNzLg0K
LSAqDQotICogV2Ugc2NhbGUgaXQgbGluZWFybHksIG9mZnNldCBieSB0aGUg
SU5URVJBQ1RJVkVfREVMVEEgZGVsdGEuDQotICogSGVyZSBhcmUgYSBmZXcg
ZXhhbXBsZXMgb2YgZGlmZmVyZW50IG5pY2UgbGV2ZWxzOg0KLSAqDQotICog
IFRBU0tfSU5URVJBQ1RJVkUoLTIwKTogWzEsMSwxLDEsMSwxLDEsMSwxLDAs
MF0NCi0gKiAgVEFTS19JTlRFUkFDVElWRSgtMTApOiBbMSwxLDEsMSwxLDEs
MSwwLDAsMCwwXQ0KLSAqICBUQVNLX0lOVEVSQUNUSVZFKCAgMCk6IFsxLDEs
MSwxLDAsMCwwLDAsMCwwLDBdDQotICogIFRBU0tfSU5URVJBQ1RJVkUoIDEw
KTogWzEsMSwwLDAsMCwwLDAsMCwwLDAsMF0NCi0gKiAgVEFTS19JTlRFUkFD
VElWRSggMTkpOiBbMCwwLDAsMCwwLDAsMCwwLDAsMCwwXQ0KLSAqDQotICog
KHRoZSBYIGF4aXMgcmVwcmVzZW50cyB0aGUgcG9zc2libGUgLTUgLi4uIDAg
Li4uICs1IGR5bmFtaWMNCi0gKiAgcHJpb3JpdHkgcmFuZ2UgYSB0YXNrIGNh
biBleHBsb3JlLCBhIHZhbHVlIG9mICcxJyBtZWFucyB0aGUNCi0gKiAgdGFz
ayBpcyByYXRlZCBpbnRlcmFjdGl2ZS4pDQotICoNCi0gKiBJZS4gbmljZSAr
MTkgdGFza3MgY2FuIG5ldmVyIGdldCAnaW50ZXJhY3RpdmUnIGVub3VnaCB0
byBiZQ0KLSAqIHJlaW5zZXJ0ZWQgaW50byB0aGUgYWN0aXZlIGFycmF5LiBB
bmQgb25seSBoZWF2aWx5IENQVS1ob2cgbmljZSAtMjANCi0gKiB0YXNrcyB3
aWxsIGJlIGV4cGlyZWQuIERlZmF1bHQgbmljZSAwIHRhc2tzIGFyZSBzb21l
d2hlcmUgYmV0d2VlbiwNCi0gKiBpdCB0YWtlcyBzb21lIGVmZm9ydCBmb3Ig
dGhlbSB0byBnZXQgaW50ZXJhY3RpdmUsIGJ1dCBpdCdzIG5vdA0KLSAqIHRv
byBoYXJkLg0KLSAqLw0KLQ0KLSNkZWZpbmUgQ1VSUkVOVF9CT05VUyhwKSBc
DQotCShOU19UT19KSUZGSUVTKChwKS0+c2xlZXBfYXZnKSAqIE1BWF9CT05V
UyAvIFwNCi0JCU1BWF9TTEVFUF9BVkcpDQotDQotI2lmZGVmIENPTkZJR19T
TVANCi0jZGVmaW5lIFRJTUVTTElDRV9HUkFOVUxBUklUWShwKQkoTUlOX1RJ
TUVTTElDRSAqIFwNCi0JCSgxIDw8ICgoKE1BWF9CT05VUyAtIENVUlJFTlRf
Qk9OVVMocCkpID8gOiAxKSAtIDEpKSAqIFwNCi0JCQludW1fb25saW5lX2Nw
dXMoKSkNCi0jZWxzZQ0KLSNkZWZpbmUgVElNRVNMSUNFX0dSQU5VTEFSSVRZ
KHApCShNSU5fVElNRVNMSUNFICogXA0KLQkJKDEgPDwgKCgoTUFYX0JPTlVT
IC0gQ1VSUkVOVF9CT05VUyhwKSkgPyA6IDEpIC0gMSkpKQ0KLSNlbmRpZg0K
LQ0KLSNkZWZpbmUgU0NBTEUodjEsdjFfbWF4LHYyX21heCkgXA0KLQkodjEp
ICogKHYyX21heCkgLyAodjFfbWF4KQ0KLQ0KLSNkZWZpbmUgREVMVEEocCkg
XA0KLQkoU0NBTEUoVEFTS19OSUNFKHApLCA0MCwgTUFYX0JPTlVTKSArIElO
VEVSQUNUSVZFX0RFTFRBKQ0KIA0KLSNkZWZpbmUgVEFTS19JTlRFUkFDVElW
RShwKSBcDQotCSgocCktPnByaW8gPD0gKHApLT5zdGF0aWNfcHJpbyAtIERF
TFRBKHApKQ0KLQ0KLSNkZWZpbmUgSU5URVJBQ1RJVkVfU0xFRVAocCkgXA0K
LQkoSklGRklFU19UT19OUyhNQVhfU0xFRVBfQVZHICogXA0KLQkJKE1BWF9C
T05VUyAvIDIgKyBERUxUQSgocCkpICsgMSkgLyBNQVhfQk9OVVMgLSAxKSkN
Ci0NCi0jZGVmaW5lIEhJR0hfQ1JFRElUKHApIFwNCi0JKChwKS0+aW50ZXJh
Y3RpdmVfY3JlZGl0ID4gQ1JFRElUX0xJTUlUKQ0KLQ0KLSNkZWZpbmUgTE9X
X0NSRURJVChwKSBcDQotCSgocCktPmludGVyYWN0aXZlX2NyZWRpdCA8IC1D
UkVESVRfTElNSVQpDQotDQotI2RlZmluZSBUQVNLX1BSRUVNUFRTX0NVUlIo
cCwgcnEpIFwNCi0JKChwKS0+cHJpbyA8IChycSktPmN1cnItPnByaW8pDQot
DQotLyoNCi0gKiBCQVNFX1RJTUVTTElDRSBzY2FsZXMgdXNlci1uaWNlIHZh
bHVlcyBbIC0yMCAuLi4gMTkgXQ0KLSAqIHRvIHRpbWUgc2xpY2UgdmFsdWVz
Lg0KLSAqDQotICogVGhlIGhpZ2hlciBhIHRocmVhZCdzIHByaW9yaXR5LCB0
aGUgYmlnZ2VyIHRpbWVzbGljZXMNCi0gKiBpdCBnZXRzIGR1cmluZyBvbmUg
cm91bmQgb2YgZXhlY3V0aW9uLiBCdXQgZXZlbiB0aGUgbG93ZXN0DQotICog
cHJpb3JpdHkgdGhyZWFkIGdldHMgTUlOX1RJTUVTTElDRSB3b3J0aCBvZiBl
eGVjdXRpb24gdGltZS4NCi0gKg0KLSAqIHRhc2tfdGltZXNsaWNlKCkgaXMg
dGhlIGludGVyZmFjZSB0aGF0IGlzIHVzZWQgYnkgdGhlIHNjaGVkdWxlci4N
CitpbnQgY29tcHV0ZSA9IDA7DQorLyogDQorICpUaGlzIGlzIHRoZSB0aW1l
IGFsbCB0YXNrcyB3aXRoaW4gdGhlIHNhbWUgcHJpb3JpdHkgcm91bmQgcm9i
aW4uDQorICpjb21wdXRlIHNldHRpbmcgaXMgcmVzZXJ2ZWQgZm9yIGRlZGlj
YXRlZCBjb21wdXRhdGlvbmFsIHNjaGVkdWxpbmcNCisgKmFuZCBoYXMgdGVu
IHRpbWVzIGxhcmdlciBpbnRlcnZhbHMuDQogICovDQotDQotI2RlZmluZSBC
QVNFX1RJTUVTTElDRShwKSAoTUlOX1RJTUVTTElDRSArIFwNCi0JCSgoTUFY
X1RJTUVTTElDRSAtIE1JTl9USU1FU0xJQ0UpICogXA0KLQkJCShNQVhfUFJJ
Ty0xIC0gKHApLT5zdGF0aWNfcHJpbykgLyAoTUFYX1VTRVJfUFJJTy0xKSkp
DQotDQotc3RhdGljIHVuc2lnbmVkIGludCB0YXNrX3RpbWVzbGljZSh0YXNr
X3QgKnApDQotew0KLQlyZXR1cm4gQkFTRV9USU1FU0xJQ0UocCk7DQotfQ0K
KyNkZWZpbmUgX1JSX0lOVEVSVkFMCQkoKDEwICogSFogLyAxMDAwKSA/IDog
MSkNCisjZGVmaW5lIFJSX0lOVEVSVkFMCQkoX1JSX0lOVEVSVkFMICogKDEg
KyA5ICogY29tcHV0ZSkpDQogDQogI2RlZmluZSB0YXNrX2hvdChwLCBub3cs
IHNkKSAoKG5vdykgLSAocCktPnRpbWVzdGFtcCA8IChzZCktPmNhY2hlX2hv
dF90aW1lKQ0KIA0KQEAgLTE4OSwxNiArODcsOCBAQCBzdGF0aWMgdW5zaWdu
ZWQgaW50IHRhc2tfdGltZXNsaWNlKHRhc2tfDQogICogVGhlc2UgYXJlIHRo
ZSBydW5xdWV1ZSBkYXRhIHN0cnVjdHVyZXM6DQogICovDQogDQotI2RlZmlu
ZSBCSVRNQVBfU0laRSAoKCgoTUFYX1BSSU8rMSs3KS84KStzaXplb2YobG9u
ZyktMSkvc2l6ZW9mKGxvbmcpKQ0KLQ0KIHR5cGVkZWYgc3RydWN0IHJ1bnF1
ZXVlIHJ1bnF1ZXVlX3Q7DQogDQotc3RydWN0IHByaW9fYXJyYXkgew0KLQl1
bnNpZ25lZCBpbnQgbnJfYWN0aXZlOw0KLQl1bnNpZ25lZCBsb25nIGJpdG1h
cFtCSVRNQVBfU0laRV07DQotCXN0cnVjdCBsaXN0X2hlYWQgcXVldWVbTUFY
X1BSSU9dOw0KLX07DQotDQogLyoNCiAgKiBUaGlzIGlzIHRoZSBtYWluLCBw
ZXItQ1BVIHJ1bnF1ZXVlIGRhdGEgc3RydWN0dXJlLg0KICAqDQpAQCAtMjE4
LDEzICsxMDgsMTMgQEAgc3RydWN0IHJ1bnF1ZXVlIHsNCiAJdW5zaWduZWQg
bG9uZyBjcHVfbG9hZDsNCiAjZW5kaWYNCiAJdW5zaWduZWQgbG9uZyBsb25n
IG5yX3N3aXRjaGVzOw0KLQl1bnNpZ25lZCBsb25nIGV4cGlyZWRfdGltZXN0
YW1wLCBucl91bmludGVycnVwdGlibGU7DQorCXVuc2lnbmVkIGxvbmcgbnJf
dW5pbnRlcnJ1cHRpYmxlOw0KIAl1bnNpZ25lZCBsb25nIGxvbmcgdGltZXN0
YW1wX2xhc3RfdGljazsNCisJdW5zaWduZWQgaW50IGNhY2hlX3RpY2tzLCBw
cmVlbXB0ZWQ7DQogCXRhc2tfdCAqY3VyciwgKmlkbGU7DQotDQogCXN0cnVj
dCBtbV9zdHJ1Y3QgKnByZXZfbW07DQotCXByaW9fYXJyYXlfdCAqYWN0aXZl
LCAqZXhwaXJlZCwgYXJyYXlzWzJdOw0KLQlpbnQgYmVzdF9leHBpcmVkX3By
aW87DQorCXVuc2lnbmVkIGxvbmcgYml0bWFwW0JJVFNfVE9fTE9OR1MoTUFY
X1BSSU8rMSldOw0KKwlzdHJ1Y3QgbGlzdF9oZWFkIHF1ZXVlW01BWF9QUklP
ICsgMV07DQogCWF0b21pY190IG5yX2lvd2FpdDsNCiANCiAjaWZkZWYgQ09O
RklHX1NNUA0KQEAgLTQwMyw2NyArMjkzLDQ3IEBAIHN0YXRpYyBpbmxpbmUg
dm9pZCBycV91bmxvY2socnVucXVldWVfdCANCiAJc3Bpbl91bmxvY2tfaXJx
KCZycS0+bG9jayk7DQogfQ0KIA0KLS8qDQotICogQWRkaW5nL3JlbW92aW5n
IGEgdGFzayB0by9mcm9tIGEgcHJpb3JpdHkgYXJyYXk6DQotICovDQotc3Rh
dGljIHZvaWQgZGVxdWV1ZV90YXNrKHN0cnVjdCB0YXNrX3N0cnVjdCAqcCwg
cHJpb19hcnJheV90ICphcnJheSkNCitzdGF0aWMgaW50IHRhc2tfcHJlZW1w
dHNfY3VycihzdHJ1Y3QgdGFza19zdHJ1Y3QgKnAsIHJ1bnF1ZXVlX3QgKnJx
KQ0KIHsNCi0JYXJyYXktPm5yX2FjdGl2ZS0tOw0KLQlsaXN0X2RlbCgmcC0+
cnVuX2xpc3QpOw0KLQlpZiAobGlzdF9lbXB0eShhcnJheS0+cXVldWUgKyBw
LT5wcmlvKSkNCi0JCV9fY2xlYXJfYml0KHAtPnByaW8sIGFycmF5LT5iaXRt
YXApOw0KKwlpZiAocC0+cHJpbyA+PSBycS0+Y3Vyci0+cHJpbykNCisJCXJl
dHVybiAwOw0KKwlpZiAoIWNvbXB1dGUgfHwgcnEtPmNhY2hlX3RpY2tzID49
IGNhY2hlX2RlY2F5X3RpY2tzIHx8DQorCQlydF90YXNrKHApIHx8ICFwLT5t
bSB8fCBycS0+Y3VyciA9PSBycS0+aWRsZSkNCisJCQlyZXR1cm4gMTsNCisJ
cnEtPnByZWVtcHRlZCA9IDE7DQorCQlyZXR1cm4gMDsNCiB9DQogDQotc3Rh
dGljIHZvaWQgZW5xdWV1ZV90YXNrKHN0cnVjdCB0YXNrX3N0cnVjdCAqcCwg
cHJpb19hcnJheV90ICphcnJheSkNCitzdGF0aWMgaW5saW5lIGludCB0YXNr
X3F1ZXVlZCh0YXNrX3QgKnRhc2spDQogew0KLQlsaXN0X2FkZF90YWlsKCZw
LT5ydW5fbGlzdCwgYXJyYXktPnF1ZXVlICsgcC0+cHJpbyk7DQotCV9fc2V0
X2JpdChwLT5wcmlvLCBhcnJheS0+Yml0bWFwKTsNCi0JYXJyYXktPm5yX2Fj
dGl2ZSsrOw0KLQlwLT5hcnJheSA9IGFycmF5Ow0KKwlyZXR1cm4gIWxpc3Rf
ZW1wdHkoJnRhc2stPnJ1bl9saXN0KTsNCiB9DQogDQogLyoNCi0gKiBVc2Vk
IGJ5IHRoZSBtaWdyYXRpb24gY29kZSAtIHdlIHB1bGwgdGFza3MgZnJvbSB0
aGUgaGVhZCBvZiB0aGUNCi0gKiByZW1vdGUgcXVldWUgc28gd2Ugd2FudCB0
aGVzZSB0YXNrcyB0byBzaG93IHVwIGF0IHRoZSBoZWFkIG9mIHRoZQ0KLSAq
IGxvY2FsIHF1ZXVlOg0KKyAqIEFkZGluZy9yZW1vdmluZyBhIHRhc2sgdG8v
ZnJvbSBhIHJ1bnF1ZXVlOg0KICAqLw0KLXN0YXRpYyBpbmxpbmUgdm9pZCBl
bnF1ZXVlX3Rhc2tfaGVhZChzdHJ1Y3QgdGFza19zdHJ1Y3QgKnAsIHByaW9f
YXJyYXlfdCAqYXJyYXkpDQorc3RhdGljIHZvaWQgZGVxdWV1ZV90YXNrKHN0
cnVjdCB0YXNrX3N0cnVjdCAqcCwgcnVucXVldWVfdCAqcnEpDQorew0KKwls
aXN0X2RlbF9pbml0KCZwLT5ydW5fbGlzdCk7DQorCWlmIChsaXN0X2VtcHR5
KHJxLT5xdWV1ZSArIHAtPnByaW8pKQ0KKwkJX19jbGVhcl9iaXQocC0+cHJp
bywgcnEtPmJpdG1hcCk7DQorfQ0KKw0KK3N0YXRpYyB2b2lkIGVucXVldWVf
dGFzayhzdHJ1Y3QgdGFza19zdHJ1Y3QgKnAsIHJ1bnF1ZXVlX3QgKnJxKQ0K
IHsNCi0JbGlzdF9hZGQoJnAtPnJ1bl9saXN0LCBhcnJheS0+cXVldWUgKyBw
LT5wcmlvKTsNCi0JX19zZXRfYml0KHAtPnByaW8sIGFycmF5LT5iaXRtYXAp
Ow0KLQlhcnJheS0+bnJfYWN0aXZlKys7DQotCXAtPmFycmF5ID0gYXJyYXk7
DQorCWxpc3RfYWRkX3RhaWwoJnAtPnJ1bl9saXN0LCBycS0+cXVldWUgKyBw
LT5wcmlvKTsNCisJX19zZXRfYml0KHAtPnByaW8sIHJxLT5iaXRtYXApOw0K
IH0NCiANCiAvKg0KLSAqIGVmZmVjdGl2ZV9wcmlvIC0gcmV0dXJuIHRoZSBw
cmlvcml0eSB0aGF0IGlzIGJhc2VkIG9uIHRoZSBzdGF0aWMNCi0gKiBwcmlv
cml0eSBidXQgaXMgbW9kaWZpZWQgYnkgYm9udXNlcy9wZW5hbHRpZXMuDQot
ICoNCi0gKiBXZSBzY2FsZSB0aGUgYWN0dWFsIHNsZWVwIGF2ZXJhZ2UgWzAg
Li4uLiBNQVhfU0xFRVBfQVZHXQ0KLSAqIGludG8gdGhlIC01IC4uLiAwIC4u
LiArNSBib251cy9wZW5hbHR5IHJhbmdlLg0KLSAqDQotICogV2UgdXNlIDI1
JSBvZiB0aGUgZnVsbCAwLi4uMzkgcHJpb3JpdHkgcmFuZ2Ugc28gdGhhdDoN
Ci0gKg0KLSAqIDEpIG5pY2UgKzE5IGludGVyYWN0aXZlIHRhc2tzIGRvIG5v
dCBwcmVlbXB0IG5pY2UgMCBDUFUgaG9ncy4NCi0gKiAyKSBuaWNlIC0yMCBD
UFUgaG9ncyBkbyBub3QgZ2V0IHByZWVtcHRlZCBieSBuaWNlIDAgdGFza3Mu
DQotICoNCi0gKiBCb3RoIHByb3BlcnRpZXMgYXJlIGltcG9ydGFudCB0byBj
ZXJ0YWluIHdvcmtsb2Fkcy4NCisgKiBVc2VkIGJ5IHRoZSBtaWdyYXRpb24g
Y29kZSAtIHdlIHB1bGwgdGFza3MgZnJvbSB0aGUgaGVhZCBvZiB0aGUNCisg
KiByZW1vdGUgcXVldWUgc28gd2Ugd2FudCB0aGVzZSB0YXNrcyB0byBzaG93
IHVwIGF0IHRoZSBoZWFkIG9mIHRoZQ0KKyAqIGxvY2FsIHF1ZXVlOg0KICAq
Lw0KLXN0YXRpYyBpbnQgZWZmZWN0aXZlX3ByaW8odGFza190ICpwKQ0KK3N0
YXRpYyBpbmxpbmUgdm9pZCBlbnF1ZXVlX3Rhc2tfaGVhZChzdHJ1Y3QgdGFz
a19zdHJ1Y3QgKnAsIHJ1bnF1ZXVlX3QgKnJxKQ0KIHsNCi0JaW50IGJvbnVz
LCBwcmlvOw0KLQ0KLQlpZiAocnRfdGFzayhwKSkNCi0JCXJldHVybiBwLT5w
cmlvOw0KLQ0KLQlib251cyA9IENVUlJFTlRfQk9OVVMocCkgLSBNQVhfQk9O
VVMgLyAyOw0KLQ0KLQlwcmlvID0gcC0+c3RhdGljX3ByaW8gLSBib251czsN
Ci0JaWYgKHByaW8gPCBNQVhfUlRfUFJJTykNCi0JCXByaW8gPSBNQVhfUlRf
UFJJTzsNCi0JaWYgKHByaW8gPiBNQVhfUFJJTy0xKQ0KLQkJcHJpbyA9IE1B
WF9QUklPLTE7DQotCXJldHVybiBwcmlvOw0KKwlsaXN0X2FkZCgmcC0+cnVu
X2xpc3QsIHJxLT5xdWV1ZSArIHAtPnByaW8pOw0KKwlfX3NldF9iaXQocC0+
cHJpbywgcnEtPmJpdG1hcCk7DQogfQ0KIA0KIC8qDQpAQCAtNDcxLDcgKzM0
MSw3IEBAIHN0YXRpYyBpbnQgZWZmZWN0aXZlX3ByaW8odGFza190ICpwKQ0K
ICAqLw0KIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2FjdGl2YXRlX3Rhc2sodGFz
a190ICpwLCBydW5xdWV1ZV90ICpycSkNCiB7DQotCWVucXVldWVfdGFzayhw
LCBycS0+YWN0aXZlKTsNCisJZW5xdWV1ZV90YXNrKHAsIHJxKTsNCiAJcnEt
Pm5yX3J1bm5pbmcrKzsNCiB9DQogDQpAQCAtNDgwLDk1ICszNTAsMTA3IEBA
IHN0YXRpYyBpbmxpbmUgdm9pZCBfX2FjdGl2YXRlX3Rhc2sodGFza18NCiAg
Ki8NCiBzdGF0aWMgaW5saW5lIHZvaWQgX19hY3RpdmF0ZV9pZGxlX3Rhc2so
dGFza190ICpwLCBydW5xdWV1ZV90ICpycSkNCiB7DQotCWVucXVldWVfdGFz
a19oZWFkKHAsIHJxLT5hY3RpdmUpOw0KKwllbnF1ZXVlX3Rhc2tfaGVhZChw
LCBycSk7DQogCXJxLT5ucl9ydW5uaW5nKys7DQogfQ0KIA0KLXN0YXRpYyB2
b2lkIHJlY2FsY190YXNrX3ByaW8odGFza190ICpwLCB1bnNpZ25lZCBsb25n
IGxvbmcgbm93KQ0KKy8vIGJ1cnN0IC0gZXh0cmEgaW50ZXJ2YWxzIGFuIGlu
dGVyYWN0aXZlIHRhc2sgY2FuIHJ1biBmb3IgYXQgYmVzdCBwcmlvcml0eQ0K
K3N0YXRpYyB1bnNpZ25lZCBpbnQgYnVyc3QodGFza190ICpwKQ0KIHsNCi0J
dW5zaWduZWQgbG9uZyBsb25nIF9fc2xlZXBfdGltZSA9IG5vdyAtIHAtPnRp
bWVzdGFtcDsNCi0JdW5zaWduZWQgbG9uZyBzbGVlcF90aW1lOw0KLQ0KLQlp
ZiAoX19zbGVlcF90aW1lID4gTlNfTUFYX1NMRUVQX0FWRykNCi0JCXNsZWVw
X3RpbWUgPSBOU19NQVhfU0xFRVBfQVZHOw0KKwl1bnNpZ25lZCBpbnQgdGFz
a191c2VyX3ByaW87DQorCWlmIChydF90YXNrKHApKQ0KKwkJcmV0dXJuIHAt
PmJ1cnN0Ow0KKwl0YXNrX3VzZXJfcHJpbyA9IFRBU0tfVVNFUl9QUklPKHAp
Ow0KKwlpZiAobGlrZWx5KHRhc2tfdXNlcl9wcmlvIDwgNDApKQ0KKwkJcmV0
dXJuIDM5IC0gdGFza191c2VyX3ByaW87DQogCWVsc2UNCi0JCXNsZWVwX3Rp
bWUgPSAodW5zaWduZWQgbG9uZylfX3NsZWVwX3RpbWU7DQorCQlyZXR1cm4g
MDsNCit9DQogDQotCWlmIChsaWtlbHkoc2xlZXBfdGltZSA+IDApKSB7DQot
CQkvKg0KLQkJICogVXNlciB0YXNrcyB0aGF0IHNsZWVwIGEgbG9uZyB0aW1l
IGFyZSBjYXRlZ29yaXNlZCBhcw0KLQkJICogaWRsZSBhbmQgd2lsbCBnZXQg
anVzdCBpbnRlcmFjdGl2ZSBzdGF0dXMgdG8gc3RheSBhY3RpdmUgJg0KLQkJ
ICogcHJldmVudCB0aGVtIHN1ZGRlbmx5IGJlY29taW5nIGNwdSBob2dzIGFu
ZCBzdGFydmluZw0KLQkJICogb3RoZXIgcHJvY2Vzc2VzLg0KLQkJICovDQot
CQlpZiAocC0+bW0gJiYgcC0+YWN0aXZhdGVkICE9IC0xICYmDQotCQkJc2xl
ZXBfdGltZSA+IElOVEVSQUNUSVZFX1NMRUVQKHApKSB7DQotCQkJCXAtPnNs
ZWVwX2F2ZyA9IEpJRkZJRVNfVE9fTlMoTUFYX1NMRUVQX0FWRyAtDQotCQkJ
CQkJQVZHX1RJTUVTTElDRSk7DQotCQkJCWlmICghSElHSF9DUkVESVQocCkp
DQotCQkJCQlwLT5pbnRlcmFjdGl2ZV9jcmVkaXQrKzsNCi0JCX0gZWxzZSB7
DQotCQkJLyoNCi0JCQkgKiBUaGUgbG93ZXIgdGhlIHNsZWVwIGF2ZyBhIHRh
c2sgaGFzIHRoZSBtb3JlDQotCQkJICogcmFwaWRseSBpdCB3aWxsIHJpc2Ug
d2l0aCBzbGVlcCB0aW1lLg0KLQkJCSAqLw0KLQkJCXNsZWVwX3RpbWUgKj0g
KE1BWF9CT05VUyAtIENVUlJFTlRfQk9OVVMocCkpID8gOiAxOw0KK3N0YXRp
YyB2b2lkIGluY19idXJzdCh0YXNrX3QgKnApDQorew0KKwl1bnNpZ25lZCBp
bnQgYmVzdF9idXJzdDsNCisJYmVzdF9idXJzdCA9IGJ1cnN0KHApOw0KKwlp
ZiAocC0+YnVyc3QgPCBiZXN0X2J1cnN0KQ0KKwkJcC0+YnVyc3QrKzsNCit9
DQogDQotCQkJLyoNCi0JCQkgKiBUYXNrcyB3aXRoIGxvdyBpbnRlcmFjdGl2
ZV9jcmVkaXQgYXJlIGxpbWl0ZWQgdG8NCi0JCQkgKiBvbmUgdGltZXNsaWNl
IHdvcnRoIG9mIHNsZWVwIGF2ZyBib251cy4NCi0JCQkgKi8NCi0JCQlpZiAo
TE9XX0NSRURJVChwKSAmJg0KLQkJCSAgICBzbGVlcF90aW1lID4gSklGRklF
U19UT19OUyh0YXNrX3RpbWVzbGljZShwKSkpDQotCQkJCXNsZWVwX3RpbWUg
PSBKSUZGSUVTX1RPX05TKHRhc2tfdGltZXNsaWNlKHApKTsNCitzdGF0aWMg
dm9pZCBkZWNfYnVyc3QodGFza190ICpwKQ0KK3sNCisJaWYgKHAtPmJ1cnN0
KQ0KKwkJcC0+YnVyc3QtLTsNCit9DQogDQotCQkJLyoNCi0JCQkgKiBOb24g
aGlnaF9jcmVkaXQgdGFza3Mgd2FraW5nIGZyb20gdW5pbnRlcnJ1cHRpYmxl
DQotCQkJICogc2xlZXAgYXJlIGxpbWl0ZWQgaW4gdGhlaXIgc2xlZXBfYXZn
IHJpc2UgYXMgdGhleQ0KLQkJCSAqIGFyZSBsaWtlbHkgdG8gYmUgY3B1IGhv
Z3Mgd2FpdGluZyBvbiBJL08NCi0JCQkgKi8NCi0JCQlpZiAocC0+YWN0aXZh
dGVkID09IC0xICYmICFISUdIX0NSRURJVChwKSAmJiBwLT5tbSkgew0KLQkJ
CQlpZiAocC0+c2xlZXBfYXZnID49IElOVEVSQUNUSVZFX1NMRUVQKHApKQ0K
LQkJCQkJc2xlZXBfdGltZSA9IDA7DQotCQkJCWVsc2UgaWYgKHAtPnNsZWVw
X2F2ZyArIHNsZWVwX3RpbWUgPj0NCi0JCQkJCQlJTlRFUkFDVElWRV9TTEVF
UChwKSkgew0KLQkJCQkJcC0+c2xlZXBfYXZnID0gSU5URVJBQ1RJVkVfU0xF
RVAocCk7DQotCQkJCQlzbGVlcF90aW1lID0gMDsNCi0JCQkJfQ0KLQkJCX0N
CisvLyBzbGljZSAtIHRoZSBkdXJhdGlvbiBhIHRhc2sgcnVucyBiZWZvcmUg
bG9zaW5nIGJ1cnN0DQorc3RhdGljIHVuc2lnbmVkIGludCBzbGljZSh0YXNr
X3QgKnApDQorew0KKwl1bnNpZ25lZCBpbnQgc2xpY2UgPSBSUl9JTlRFUlZB
TDsNCisJaWYgKCFydF90YXNrKHApKQ0KKwkJc2xpY2UgKz0gYnVyc3QocCkg
KiBSUl9JTlRFUlZBTDsNCisJcmV0dXJuIHNsaWNlOw0KK30NCiANCi0JCQkv
Kg0KLQkJCSAqIFRoaXMgY29kZSBnaXZlcyBhIGJvbnVzIHRvIGludGVyYWN0
aXZlIHRhc2tzLg0KLQkJCSAqDQotCQkJICogVGhlIGJvb3N0IHdvcmtzIGJ5
IHVwZGF0aW5nIHRoZSAnYXZlcmFnZSBzbGVlcCB0aW1lJw0KLQkJCSAqIHZh
bHVlIGhlcmUsIGJhc2VkIG9uIC0+dGltZXN0YW1wLiBUaGUgbW9yZSB0aW1l
IGENCi0JCQkgKiB0YXNrIHNwZW5kcyBzbGVlcGluZywgdGhlIGhpZ2hlciB0
aGUgYXZlcmFnZSBnZXRzIC0NCi0JCQkgKiBhbmQgdGhlIGhpZ2hlciB0aGUg
cHJpb3JpdHkgYm9vc3QgZ2V0cyBhcyB3ZWxsLg0KLQkJCSAqLw0KLQkJCXAt
PnNsZWVwX2F2ZyArPSBzbGVlcF90aW1lOw0KKy8vIGludGVyYWN0aXZlIC0g
aW50ZXJhY3RpdmUgdGFza3MgZ2V0IGxvbmdlciBpbnRlcnZhbHMgYXQgYmVz
dCBwcmlvcml0eQ0KK2ludCBpbnRlcmFjdGl2ZSA9IDE7DQogDQotCQkJaWYg
KHAtPnNsZWVwX2F2ZyA+IE5TX01BWF9TTEVFUF9BVkcpIHsNCi0JCQkJcC0+
c2xlZXBfYXZnID0gTlNfTUFYX1NMRUVQX0FWRzsNCi0JCQkJaWYgKCFISUdI
X0NSRURJVChwKSkNCi0JCQkJCXAtPmludGVyYWN0aXZlX2NyZWRpdCsrOw0K
LQkJCX0NCisvKg0KKyAqIGVmZmVjdGl2ZV9wcmlvIC0gZHluYW1pYyBwcmlv
cml0eSBkZXBlbmRlbnQgb24gYnVyc3QuDQorICogVGhlIHByaW9yaXR5IG5v
cm1hbGx5IGRlY3JlYXNlcyBieSBvbmUgZWFjaCBSUl9JTlRFUlZBTC4NCisg
KiBBcyB0aGUgYnVyc3QgaW5jcmVhc2VzIHRoZSBwcmlvcml0eSBzdGF5cyBh
dCB0aGUgdG9wICJzdGFpciIgb3INCisgKiBwcmlvcml0eSBmb3IgbG9uZ2Vy
Lg0KKyAqLw0KK3N0YXRpYyBpbnQgZWZmZWN0aXZlX3ByaW8odGFza190ICpw
KQ0KK3sNCisJaW50IHByaW87DQorCXVuc2lnbmVkIGludCBmdWxsX3NsaWNl
LCB1c2VkX3NsaWNlLCBmaXJzdF9zbGljZTsNCisJdW5zaWduZWQgaW50IGJl
c3RfYnVyc3Q7DQorCWlmIChydF90YXNrKHApKQ0KKwkJcmV0dXJuIHAtPnBy
aW87DQorDQorCWJlc3RfYnVyc3QgPSBidXJzdChwKTsNCisJZnVsbF9zbGlj
ZSA9IHNsaWNlKHApOw0KKwl1c2VkX3NsaWNlID0gZnVsbF9zbGljZSAtIHAt
PnNsaWNlOw0KKwlpZiAocC0+YnVyc3QgPiBiZXN0X2J1cnN0KQ0KKwkJcC0+
YnVyc3QgPSBiZXN0X2J1cnN0Ow0KKwlmaXJzdF9zbGljZSA9IFJSX0lOVEVS
VkFMOw0KKwlpZiAoaW50ZXJhY3RpdmUgJiYgIWNvbXB1dGUpDQorCQlmaXJz
dF9zbGljZSAqPSAocC0+YnVyc3QgKyAxKTsNCisJcHJpbyA9IE1BWF9QUklP
IC0gMSAtIGJlc3RfYnVyc3Q7DQorDQorCWlmICh1c2VkX3NsaWNlIDwgZmly
c3Rfc2xpY2UpDQorCQlyZXR1cm4gcHJpbzsNCisJcHJpbyArPSAxICsgKHVz
ZWRfc2xpY2UgLSBmaXJzdF9zbGljZSkgLyBSUl9JTlRFUlZBTDsNCisJaWYg
KHByaW8gPiBNQVhfUFJJTyAtIDEpDQorCQlwcmlvID0gTUFYX1BSSU8gLSAx
Ow0KKwlyZXR1cm4gcHJpbzsNCit9DQorDQorc3RhdGljIHZvaWQgcmVjYWxj
X3Rhc2tfcHJpbyh0YXNrX3QgKnAsIHVuc2lnbmVkIGxvbmcgbG9uZyBub3cp
DQorew0KKwl1bnNpZ25lZCBsb25nIHNsZWVwX3RpbWUgPSBub3cgLSBwLT50
aW1lc3RhbXA7DQorCXVuc2lnbmVkIGxvbmcgcnVuX3RpbWUgPSBOU19UT19K
SUZGSUVTKHAtPnJ1bnRpbWUpOw0KKwl1bnNpZ25lZCBsb25nIHRvdGFsX3J1
biA9IE5TX1RPX0pJRkZJRVMocC0+dG90YWxydW4pICsgcnVuX3RpbWU7DQor
CWlmICghcnVuX3RpbWUgJiYgTlNfVE9fSklGRklFUyhwLT5ydW50aW1lICsg
c2xlZXBfdGltZSkgPCBSUl9JTlRFUlZBTCkgew0KKwkJaWYgKHAtPnNsaWNl
IC0gdG90YWxfcnVuIDwgMSkgew0KKwkJCXAtPnRvdGFscnVuID0gMDsNCisJ
CQlkZWNfYnVyc3QocCk7DQorCQl9IGVsc2Ugew0KKwkJCXAtPnRvdGFscnVu
ICs9IHAtPnJ1bnRpbWU7DQorCQkJcC0+c2xpY2UgLT0gTlNfVE9fSklGRklF
UyhwLT50b3RhbHJ1bik7DQogCQl9DQorCX0gZWxzZSB7DQorCQlpbmNfYnVy
c3QocCk7DQorCQlwLT5ydW50aW1lID0gMDsNCisJCXAtPnRvdGFscnVuID0g
MDsNCiAJfQ0KLQ0KLQlwLT5wcmlvID0gZWZmZWN0aXZlX3ByaW8ocCk7DQog
fQ0KIA0KIC8qDQogICogYWN0aXZhdGVfdGFzayAtIG1vdmUgYSB0YXNrIHRv
IHRoZSBydW5xdWV1ZSBhbmQgZG8gcHJpb3JpdHkgcmVjYWxjdWxhdGlvbg0K
LSAqDQotICogVXBkYXRlIGFsbCB0aGUgc2NoZWR1bGluZyBzdGF0aXN0aWNz
IHN0dWZmLiAoc2xlZXAgYXZlcmFnZQ0KLSAqIGNhbGN1bGF0aW9uLCBwcmlv
cml0eSBtb2RpZmllcnMsIGV0Yy4pDQogICovDQogc3RhdGljIHZvaWQgYWN0
aXZhdGVfdGFzayh0YXNrX3QgKnAsIHJ1bnF1ZXVlX3QgKnJxLCBpbnQgbG9j
YWwpDQogew0KLQl1bnNpZ25lZCBsb25nIGxvbmcgbm93Ow0KLQ0KLQlub3cg
PSBzY2hlZF9jbG9jaygpOw0KKwl1bnNpZ25lZCBsb25nIGxvbmcgbm93ID0g
c2NoZWRfY2xvY2soKTsNCiAjaWZkZWYgQ09ORklHX1NNUA0KIAlpZiAoIWxv
Y2FsKSB7DQogCQkvKiBDb21wZW5zYXRlIGZvciBkcmlmdGluZyBzY2hlZF9j
bG9jayAqLw0KQEAgLTU3NywzMyArNDU5LDExIEBAIHN0YXRpYyB2b2lkIGFj
dGl2YXRlX3Rhc2sodGFza190ICpwLCBydW4NCiAJCQkrIHJxLT50aW1lc3Rh
bXBfbGFzdF90aWNrOw0KIAl9DQogI2VuZGlmDQotDQorCXAtPnNsaWNlID0g
c2xpY2UocCk7DQogCXJlY2FsY190YXNrX3ByaW8ocCwgbm93KTsNCi0NCi0J
LyoNCi0JICogVGhpcyBjaGVja3MgdG8gbWFrZSBzdXJlIGl0J3Mgbm90IGFu
IHVuaW50ZXJydXB0aWJsZSB0YXNrDQotCSAqIHRoYXQgaXMgbm93IHdha2lu
ZyB1cC4NCi0JICovDQotCWlmICghcC0+YWN0aXZhdGVkKSB7DQotCQkvKg0K
LQkJICogVGFza3Mgd2hpY2ggd2VyZSB3b2tlbiB1cCBieSBpbnRlcnJ1cHRz
IChpZS4gaHcgZXZlbnRzKQ0KLQkJICogYXJlIG1vc3QgbGlrZWx5IG9mIGlu
dGVyYWN0aXZlIG5hdHVyZS4gU28gd2UgZ2l2ZSB0aGVtDQotCQkgKiB0aGUg
Y3JlZGl0IG9mIGV4dGVuZGluZyB0aGVpciBzbGVlcCB0aW1lIHRvIHRoZSBw
ZXJpb2QNCi0JCSAqIG9mIHRpbWUgdGhleSBzcGVuZCBvbiB0aGUgcnVucXVl
dWUsIHdhaXRpbmcgZm9yIGV4ZWN1dGlvbg0KLQkJICogb24gYSBDUFUsIGZp
cnN0IHRpbWUgYXJvdW5kOg0KLQkJICovDQotCQlpZiAoaW5faW50ZXJydXB0
KCkpDQotCQkJcC0+YWN0aXZhdGVkID0gMjsNCi0JCWVsc2Ugew0KLQkJCS8q
DQotCQkJICogTm9ybWFsIGZpcnN0LXRpbWUgd2FrZXVwcyBnZXQgYSBjcmVk
aXQgdG9vIGZvcg0KLQkJCSAqIG9uLXJ1bnF1ZXVlIHRpbWUsIGJ1dCBpdCB3
aWxsIGJlIHdlaWdodGVkIGRvd246DQotCQkJICovDQotCQkJcC0+YWN0aXZh
dGVkID0gMTsNCi0JCX0NCi0JfQ0KKwlwLT5wcmlvID0gZWZmZWN0aXZlX3By
aW8ocCk7DQorCXAtPnRpbWVfc2xpY2UgPSBSUl9JTlRFUlZBTDsNCiAJcC0+
dGltZXN0YW1wID0gbm93Ow0KLQ0KIAlfX2FjdGl2YXRlX3Rhc2socCwgcnEp
Ow0KIH0NCiANCkBAIC02MTUsOCArNDc1LDcgQEAgc3RhdGljIHZvaWQgZGVh
Y3RpdmF0ZV90YXNrKHN0cnVjdCB0YXNrXw0KIAlycS0+bnJfcnVubmluZy0t
Ow0KIAlpZiAocC0+c3RhdGUgPT0gVEFTS19VTklOVEVSUlVQVElCTEUpDQog
CQlycS0+bnJfdW5pbnRlcnJ1cHRpYmxlKys7DQotCWRlcXVldWVfdGFzayhw
LCBwLT5hcnJheSk7DQotCXAtPmFycmF5ID0gTlVMTDsNCisJZGVxdWV1ZV90
YXNrKHAsIHJxKTsNCiB9DQogDQogLyoNCkBAIC02ODksNyArNTQ4LDcgQEAg
c3RhdGljIGludCBtaWdyYXRlX3Rhc2sodGFza190ICpwLCBpbnQgZA0KIAkg
KiBJZiB0aGUgdGFzayBpcyBub3Qgb24gYSBydW5xdWV1ZSAoYW5kIG5vdCBy
dW5uaW5nKSwgdGhlbg0KIAkgKiBpdCBpcyBzdWZmaWNpZW50IHRvIHNpbXBs
eSB1cGRhdGUgdGhlIHRhc2sncyBjcHUgZmllbGQuDQogCSAqLw0KLQlpZiAo
IXAtPmFycmF5ICYmICF0YXNrX3J1bm5pbmcocnEsIHApKSB7DQorCWlmICgh
dGFza19xdWV1ZWQocCkgJiYgIXRhc2tfcnVubmluZyhycSwgcCkpIHsNCiAJ
CXNldF90YXNrX2NwdShwLCBkZXN0X2NwdSk7DQogCQlyZXR1cm4gMDsNCiAJ
fQ0KQEAgLTcyMCw3ICs1NzksNyBAQCB2b2lkIHdhaXRfdGFza19pbmFjdGl2
ZSh0YXNrX3QgKiBwKQ0KIHJlcGVhdDoNCiAJcnEgPSB0YXNrX3JxX2xvY2so
cCwgJmZsYWdzKTsNCiAJLyogTXVzdCBiZSBvZmYgcnVucXVldWUgZW50aXJl
bHksIG5vdCBwcmVlbXB0ZWQuICovDQotCWlmICh1bmxpa2VseShwLT5hcnJh
eSkpIHsNCisJaWYgKHVubGlrZWx5KHRhc2tfcXVldWVkKHApKSkgew0KIAkJ
LyogSWYgaXQncyBwcmVlbXB0ZWQsIHdlIHlpZWxkLiAgSXQgY291bGQgYmUg
YSB3aGlsZS4gKi8NCiAJCXByZWVtcHRlZCA9ICF0YXNrX3J1bm5pbmcocnEs
IHApOw0KIAkJdGFza19ycV91bmxvY2socnEsICZmbGFncyk7DQpAQCAtODQ5
LDcgKzcwOCw3IEBAIHN0YXRpYyBpbnQgdHJ5X3RvX3dha2VfdXAodGFza190
ICogcCwgdW4NCiAJaWYgKCEob2xkX3N0YXRlICYgc3RhdGUpKQ0KIAkJZ290
byBvdXQ7DQogDQotCWlmIChwLT5hcnJheSkNCisJaWYgKHRhc2tfcXVldWVk
KHApKQ0KIAkJZ290byBvdXRfcnVubmluZzsNCiANCiAJY3B1ID0gdGFza19j
cHUocCk7DQpAQCAtOTQzLDcgKzgwMiw3IEBAIG91dF9zZXRfY3B1Og0KIAkJ
b2xkX3N0YXRlID0gcC0+c3RhdGU7DQogCQlpZiAoIShvbGRfc3RhdGUgJiBz
dGF0ZSkpDQogCQkJZ290byBvdXQ7DQotCQlpZiAocC0+YXJyYXkpDQorCQlp
ZiAodGFza19xdWV1ZWQocCkpDQogCQkJZ290byBvdXRfcnVubmluZzsNCiAN
CiAJCXRoaXNfY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOw0KQEAgLTk1Miwx
NCArODExLDggQEAgb3V0X3NldF9jcHU6DQogDQogb3V0X2FjdGl2YXRlOg0K
ICNlbmRpZiAvKiBDT05GSUdfU01QICovDQotCWlmIChvbGRfc3RhdGUgPT0g
VEFTS19VTklOVEVSUlVQVElCTEUpIHsNCisJaWYgKG9sZF9zdGF0ZSA9PSBU
QVNLX1VOSU5URVJSVVBUSUJMRSkNCiAJCXJxLT5ucl91bmludGVycnVwdGli
bGUtLTsNCi0JCS8qDQotCQkgKiBUYXNrcyBvbiBpbnZvbHVudGFyeSBzbGVl
cCBkb24ndCBlYXJuDQotCQkgKiBzbGVlcF9hdmcgYmV5b25kIGp1c3QgaW50
ZXJhY3RpdmUgc3RhdGUuDQotCQkgKi8NCi0JCXAtPmFjdGl2YXRlZCA9IC0x
Ow0KLQl9DQogDQogCS8qDQogCSAqIFN5bmMgd2FrZXVwcyAoaS5lLiB0aG9z
ZSB0eXBlcyBvZiB3YWtldXBzIHdoZXJlIHRoZSB3YWtlcg0KQEAgLTk3MSw3
ICs4MjQsNyBAQCBvdXRfYWN0aXZhdGU6DQogCSAqLw0KIAlhY3RpdmF0ZV90
YXNrKHAsIHJxLCBjcHUgPT0gdGhpc19jcHUpOw0KIAlpZiAoIXN5bmMgfHwg
Y3B1ICE9IHRoaXNfY3B1KSB7DQotCQlpZiAoVEFTS19QUkVFTVBUU19DVVJS
KHAsIHJxKSkNCisJCWlmICh0YXNrX3ByZWVtcHRzX2N1cnIocCwgcnEpKQ0K
IAkJCXJlc2NoZWRfdGFzayhycS0+Y3Vycik7DQogCX0NCiAJc3VjY2VzcyA9
IDE7DQpAQCAtMTAxMSw3ICs4NjQsNiBAQCB2b2lkIGZhc3RjYWxsIHNjaGVk
X2ZvcmsodGFza190ICpwKQ0KIAkgKi8NCiAJcC0+c3RhdGUgPSBUQVNLX1JV
Tk5JTkc7DQogCUlOSVRfTElTVF9IRUFEKCZwLT5ydW5fbGlzdCk7DQotCXAt
PmFycmF5ID0gTlVMTDsNCiAJc3Bpbl9sb2NrX2luaXQoJnAtPnN3aXRjaF9s
b2NrKTsNCiAjaWZkZWYgQ09ORklHX1BSRUVNUFQNCiAJLyoNCkBAIC0xMDIy
LDMzICs4NzQsNiBAQCB2b2lkIGZhc3RjYWxsIHNjaGVkX2ZvcmsodGFza190
ICpwKQ0KIAkgKi8NCiAJcC0+dGhyZWFkX2luZm8tPnByZWVtcHRfY291bnQg
PSAxOw0KICNlbmRpZg0KLQkvKg0KLQkgKiBTaGFyZSB0aGUgdGltZXNsaWNl
IGJldHdlZW4gcGFyZW50IGFuZCBjaGlsZCwgdGh1cyB0aGUNCi0JICogdG90
YWwgYW1vdW50IG9mIHBlbmRpbmcgdGltZXNsaWNlcyBpbiB0aGUgc3lzdGVt
IGRvZXNuJ3QgY2hhbmdlLA0KLQkgKiByZXN1bHRpbmcgaW4gbW9yZSBzY2hl
ZHVsaW5nIGZhaXJuZXNzLg0KLQkgKi8NCi0JbG9jYWxfaXJxX2Rpc2FibGUo
KTsNCi0JcC0+dGltZV9zbGljZSA9IChjdXJyZW50LT50aW1lX3NsaWNlICsg
MSkgPj4gMTsNCi0JLyoNCi0JICogVGhlIHJlbWFpbmRlciBvZiB0aGUgZmly
c3QgdGltZXNsaWNlIG1pZ2h0IGJlIHJlY292ZXJlZCBieQ0KLQkgKiB0aGUg
cGFyZW50IGlmIHRoZSBjaGlsZCBleGl0cyBlYXJseSBlbm91Z2guDQotCSAq
Lw0KLQlwLT5maXJzdF90aW1lX3NsaWNlID0gMTsNCi0JY3VycmVudC0+dGlt
ZV9zbGljZSA+Pj0gMTsNCi0JcC0+dGltZXN0YW1wID0gc2NoZWRfY2xvY2so
KTsNCi0JaWYgKCFjdXJyZW50LT50aW1lX3NsaWNlKSB7DQotCQkvKg0KLQkJ
ICogVGhpcyBjYXNlIGlzIHJhcmUsIGl0IGhhcHBlbnMgd2hlbiB0aGUgcGFy
ZW50IGhhcyBvbmx5DQotCQkgKiBhIHNpbmdsZSBqaWZmeSBsZWZ0IGZyb20g
aXRzIHRpbWVzbGljZS4gVGFraW5nIHRoZQ0KLQkJICogcnVucXVldWUgbG9j
ayBpcyBub3QgYSBwcm9ibGVtLg0KLQkJICovDQotCQljdXJyZW50LT50aW1l
X3NsaWNlID0gMTsNCi0JCXByZWVtcHRfZGlzYWJsZSgpOw0KLQkJc2NoZWR1
bGVyX3RpY2soMCwgMCk7DQotCQlsb2NhbF9pcnFfZW5hYmxlKCk7DQotCQlw
cmVlbXB0X2VuYWJsZSgpOw0KLQl9IGVsc2UNCi0JCWxvY2FsX2lycV9lbmFi
bGUoKTsNCiB9DQogDQogLyoNCkBAIC0xMDYyLDY2ICs4ODcsMTMgQEAgdm9p
ZCBmYXN0Y2FsbCB3YWtlX3VwX2ZvcmtlZF9wcm9jZXNzKHRhcw0KIAl1bnNp
Z25lZCBsb25nIGZsYWdzOw0KIAlydW5xdWV1ZV90ICpycSA9IHRhc2tfcnFf
bG9jayhjdXJyZW50LCAmZmxhZ3MpOw0KIA0KKwkvLyBGb3JrZWQgcHJvY2Vz
cyBnZXRzIG5vIGJ1cnN0IHRvIHByZXZlbnQgZm9yayBib21icy4NCisJcC0+
YnVyc3QgPSAwOw0KIAlCVUdfT04ocC0+c3RhdGUgIT0gVEFTS19SVU5OSU5H
KTsNCiANCi0JLyoNCi0JICogV2UgZGVjcmVhc2UgdGhlIHNsZWVwIGF2ZXJh
Z2Ugb2YgZm9ya2luZyBwYXJlbnRzDQotCSAqIGFuZCBjaGlsZHJlbiBhcyB3
ZWxsLCB0byBrZWVwIG1heC1pbnRlcmFjdGl2ZSB0YXNrcw0KLQkgKiBmcm9t
IGZvcmtpbmcgdGFza3MgdGhhdCBhcmUgbWF4LWludGVyYWN0aXZlLg0KLQkg
Ki8NCi0JY3VycmVudC0+c2xlZXBfYXZnID0gSklGRklFU19UT19OUyhDVVJS
RU5UX0JPTlVTKGN1cnJlbnQpICoNCi0JCVBBUkVOVF9QRU5BTFRZIC8gMTAw
ICogTUFYX1NMRUVQX0FWRyAvIE1BWF9CT05VUyk7DQotDQotCXAtPnNsZWVw
X2F2ZyA9IEpJRkZJRVNfVE9fTlMoQ1VSUkVOVF9CT05VUyhwKSAqDQotCQlD
SElMRF9QRU5BTFRZIC8gMTAwICogTUFYX1NMRUVQX0FWRyAvIE1BWF9CT05V
Uyk7DQotDQotCXAtPmludGVyYWN0aXZlX2NyZWRpdCA9IDA7DQotDQotCXAt
PnByaW8gPSBlZmZlY3RpdmVfcHJpbyhwKTsNCiAJc2V0X3Rhc2tfY3B1KHAs
IHNtcF9wcm9jZXNzb3JfaWQoKSk7DQogDQotCWlmICh1bmxpa2VseSghY3Vy
cmVudC0+YXJyYXkpKQ0KLQkJX19hY3RpdmF0ZV90YXNrKHAsIHJxKTsNCi0J
ZWxzZSB7DQotCQlwLT5wcmlvID0gY3VycmVudC0+cHJpbzsNCi0JCWxpc3Rf
YWRkX3RhaWwoJnAtPnJ1bl9saXN0LCAmY3VycmVudC0+cnVuX2xpc3QpOw0K
LQkJcC0+YXJyYXkgPSBjdXJyZW50LT5hcnJheTsNCi0JCXAtPmFycmF5LT5u
cl9hY3RpdmUrKzsNCi0JCXJxLT5ucl9ydW5uaW5nKys7DQotCX0NCi0JdGFz
a19ycV91bmxvY2socnEsICZmbGFncyk7DQotfQ0KLQ0KLS8qDQotICogUG90
ZW50aWFsbHkgYXZhaWxhYmxlIGV4aXRpbmctY2hpbGQgdGltZXNsaWNlcyBh
cmUNCi0gKiByZXRyaWV2ZWQgaGVyZSAtIHRoaXMgd2F5IHRoZSBwYXJlbnQg
ZG9lcyBub3QgZ2V0DQotICogcGVuYWxpemVkIGZvciBjcmVhdGluZyB0b28g
bWFueSB0aHJlYWRzLg0KLSAqDQotICogKHRoaXMgY2Fubm90IGJlIHVzZWQg
dG8gJ2dlbmVyYXRlJyB0aW1lc2xpY2VzDQotICogYXJ0aWZpY2lhbGx5LCBi
ZWNhdXNlIGFueSB0aW1lc2xpY2UgcmVjb3ZlcmVkIGhlcmUNCi0gKiB3YXMg
Z2l2ZW4gYXdheSBieSB0aGUgcGFyZW50IGluIHRoZSBmaXJzdCBwbGFjZS4p
DQotICovDQotdm9pZCBmYXN0Y2FsbCBzY2hlZF9leGl0KHRhc2tfdCAqIHAp
DQotew0KLQl1bnNpZ25lZCBsb25nIGZsYWdzOw0KLQlydW5xdWV1ZV90ICpy
cTsNCi0NCi0JbG9jYWxfaXJxX3NhdmUoZmxhZ3MpOw0KLQlpZiAocC0+Zmly
c3RfdGltZV9zbGljZSkgew0KLQkJcC0+cGFyZW50LT50aW1lX3NsaWNlICs9
IHAtPnRpbWVfc2xpY2U7DQotCQlpZiAodW5saWtlbHkocC0+cGFyZW50LT50
aW1lX3NsaWNlID4gTUFYX1RJTUVTTElDRSkpDQotCQkJcC0+cGFyZW50LT50
aW1lX3NsaWNlID0gTUFYX1RJTUVTTElDRTsNCi0JfQ0KLQlsb2NhbF9pcnFf
cmVzdG9yZShmbGFncyk7DQotCS8qDQotCSAqIElmIHRoZSBjaGlsZCB3YXMg
YSAocmVsYXRpdmUtKSBDUFUgaG9nIHRoZW4gZGVjcmVhc2UNCi0JICogdGhl
IHNsZWVwX2F2ZyBvZiB0aGUgcGFyZW50IGFzIHdlbGwuDQotCSAqLw0KLQly
cSA9IHRhc2tfcnFfbG9jayhwLT5wYXJlbnQsICZmbGFncyk7DQotCWlmIChw
LT5zbGVlcF9hdmcgPCBwLT5wYXJlbnQtPnNsZWVwX2F2ZykNCi0JCXAtPnBh
cmVudC0+c2xlZXBfYXZnID0gcC0+cGFyZW50LT5zbGVlcF9hdmcgLw0KLQkJ
KEVYSVRfV0VJR0hUICsgMSkgKiBFWElUX1dFSUdIVCArIHAtPnNsZWVwX2F2
ZyAvDQotCQkoRVhJVF9XRUlHSFQgKyAxKTsNCisJX19hY3RpdmF0ZV90YXNr
KHAsIHJxKTsNCiAJdGFza19ycV91bmxvY2socnEsICZmbGFncyk7DQogfQ0K
IA0KQEAgLTEzODUsMzAgKzExNTcsMTYgQEAgbG9ja19hZ2FpbjoNCiAJCWRv
dWJsZV9ycV91bmxvY2sodGhpc19ycSwgcnEpOw0KIAkJZ290byBsb2NrX2Fn
YWluOw0KIAl9DQotCS8qDQotCSAqIFdlIGRlY3JlYXNlIHRoZSBzbGVlcCBh
dmVyYWdlIG9mIGZvcmtpbmcgcGFyZW50cw0KLQkgKiBhbmQgY2hpbGRyZW4g
YXMgd2VsbCwgdG8ga2VlcCBtYXgtaW50ZXJhY3RpdmUgdGFza3MNCi0JICog
ZnJvbSBmb3JraW5nIHRhc2tzIHRoYXQgYXJlIG1heC1pbnRlcmFjdGl2ZS4N
Ci0JICovDQotCWN1cnJlbnQtPnNsZWVwX2F2ZyA9IEpJRkZJRVNfVE9fTlMo
Q1VSUkVOVF9CT05VUyhjdXJyZW50KSAqDQotCQlQQVJFTlRfUEVOQUxUWSAv
IDEwMCAqIE1BWF9TTEVFUF9BVkcgLyBNQVhfQk9OVVMpOw0KLQ0KLQlwLT5z
bGVlcF9hdmcgPSBKSUZGSUVTX1RPX05TKENVUlJFTlRfQk9OVVMocCkgKg0K
LQkJQ0hJTERfUEVOQUxUWSAvIDEwMCAqIE1BWF9TTEVFUF9BVkcgLyBNQVhf
Qk9OVVMpOw0KLQ0KLQlwLT5pbnRlcmFjdGl2ZV9jcmVkaXQgPSAwOw0KIA0K
IAlwLT5wcmlvID0gZWZmZWN0aXZlX3ByaW8ocCk7DQogCXNldF90YXNrX2Nw
dShwLCBjcHUpOw0KIA0KIAlpZiAoY3B1ID09IHRoaXNfY3B1KSB7DQotCQlp
ZiAodW5saWtlbHkoIWN1cnJlbnQtPmFycmF5KSkNCisJCWlmICh1bmxpa2Vs
eSghdGFza19xdWV1ZWQoY3VycmVudCkpKQ0KIAkJCV9fYWN0aXZhdGVfdGFz
ayhwLCBycSk7DQogCQllbHNlIHsNCiAJCQlwLT5wcmlvID0gY3VycmVudC0+
cHJpbzsNCiAJCQlsaXN0X2FkZF90YWlsKCZwLT5ydW5fbGlzdCwgJmN1cnJl
bnQtPnJ1bl9saXN0KTsNCi0JCQlwLT5hcnJheSA9IGN1cnJlbnQtPmFycmF5
Ow0KLQkJCXAtPmFycmF5LT5ucl9hY3RpdmUrKzsNCiAJCQlycS0+bnJfcnVu
bmluZysrOw0KIAkJfQ0KIAl9IGVsc2Ugew0KQEAgLTE0MTcsNyArMTE3NSw3
IEBAIGxvY2tfYWdhaW46DQogCQlwLT50aW1lc3RhbXAgPSAocC0+dGltZXN0
YW1wIC0gdGhpc19ycS0+dGltZXN0YW1wX2xhc3RfdGljaykNCiAJCQkJCSsg
cnEtPnRpbWVzdGFtcF9sYXN0X3RpY2s7DQogCQlfX2FjdGl2YXRlX3Rhc2so
cCwgcnEpOw0KLQkJaWYgKFRBU0tfUFJFRU1QVFNfQ1VSUihwLCBycSkpDQor
CQlpZiAodGFza19wcmVlbXB0c19jdXJyKHAsIHJxKSkNCiAJCQlyZXNjaGVk
X3Rhc2socnEtPmN1cnIpOw0KIAl9DQogDQpAQCAtMTUxMSwyMiArMTI2OSwy
MiBAQCBzdGF0aWMgdm9pZCBkb3VibGVfbG9ja19iYWxhbmNlKHJ1bnF1ZXVl
DQogICogcHVsbF90YXNrIC0gbW92ZSBhIHRhc2sgZnJvbSBhIHJlbW90ZSBy
dW5xdWV1ZSB0byB0aGUgbG9jYWwgcnVucXVldWUuDQogICogQm90aCBydW5x
dWV1ZXMgbXVzdCBiZSBsb2NrZWQuDQogICovDQotc3RhdGljIGlubGluZQ0K
LXZvaWQgcHVsbF90YXNrKHJ1bnF1ZXVlX3QgKnNyY19ycSwgcHJpb19hcnJh
eV90ICpzcmNfYXJyYXksIHRhc2tfdCAqcCwNCi0JICAgICAgIHJ1bnF1ZXVl
X3QgKnRoaXNfcnEsIHByaW9fYXJyYXlfdCAqdGhpc19hcnJheSwgaW50IHRo
aXNfY3B1KQ0KK3N0YXRpYyBpbmxpbmUgDQordm9pZCBwdWxsX3Rhc2socnVu
cXVldWVfdCAqc3JjX3JxLCB0YXNrX3QgKnAsIA0KKwkJcnVucXVldWVfdCAq
dGhpc19ycSwgaW50IHRoaXNfY3B1KQ0KIHsNCi0JZGVxdWV1ZV90YXNrKHAs
IHNyY19hcnJheSk7DQorCWRlcXVldWVfdGFzayhwLCBzcmNfcnEpOw0KIAlz
cmNfcnEtPm5yX3J1bm5pbmctLTsNCiAJc2V0X3Rhc2tfY3B1KHAsIHRoaXNf
Y3B1KTsNCiAJdGhpc19ycS0+bnJfcnVubmluZysrOw0KLQllbnF1ZXVlX3Rh
c2socCwgdGhpc19hcnJheSk7DQorCWVucXVldWVfdGFzayhwLCB0aGlzX3Jx
KTsNCiAJcC0+dGltZXN0YW1wID0gKHAtPnRpbWVzdGFtcCAtIHNyY19ycS0+
dGltZXN0YW1wX2xhc3RfdGljaykNCiAJCQkJKyB0aGlzX3JxLT50aW1lc3Rh
bXBfbGFzdF90aWNrOw0KIAkvKg0KIAkgKiBOb3RlIHRoYXQgaWRsZSB0aHJl
YWRzIGhhdmUgYSBwcmlvIG9mIE1BWF9QUklPLCBmb3IgdGhpcyB0ZXN0DQog
CSAqIHRvIGJlIGFsd2F5cyB0cnVlIGZvciB0aGVtLg0KIAkgKi8NCi0JaWYg
KFRBU0tfUFJFRU1QVFNfQ1VSUihwLCB0aGlzX3JxKSkNCisJaWYgKHRhc2tf
cHJlZW1wdHNfY3VycihwLCB0aGlzX3JxKSkNCiAJCXJlc2NoZWRfdGFzayh0
aGlzX3JxLT5jdXJyKTsNCiB9DQogDQpAQCAtMTU3Niw3ICsxMzM0LDYgQEAg
c3RhdGljIGludCBtb3ZlX3Rhc2tzKHJ1bnF1ZXVlX3QgKnRoaXNfcg0KIAkJ
ICAgICAgdW5zaWduZWQgbG9uZyBtYXhfbnJfbW92ZSwgc3RydWN0IHNjaGVk
X2RvbWFpbiAqc2QsDQogCQkgICAgICBlbnVtIGlkbGVfdHlwZSBpZGxlKQ0K
IHsNCi0JcHJpb19hcnJheV90ICphcnJheSwgKmRzdF9hcnJheTsNCiAJc3Ry
dWN0IGxpc3RfaGVhZCAqaGVhZCwgKmN1cnI7DQogCWludCBpZHgsIHB1bGxl
ZCA9IDA7DQogCXRhc2tfdCAqdG1wOw0KQEAgLTE1ODQsMzggKzEzNDEsMTcg
QEAgc3RhdGljIGludCBtb3ZlX3Rhc2tzKHJ1bnF1ZXVlX3QgKnRoaXNfcg0K
IAlpZiAobWF4X25yX21vdmUgPD0gMCB8fCBidXNpZXN0LT5ucl9ydW5uaW5n
IDw9IDEpDQogCQlnb3RvIG91dDsNCiANCi0JLyoNCi0JICogV2UgZmlyc3Qg
Y29uc2lkZXIgZXhwaXJlZCB0YXNrcy4gVGhvc2Ugd2lsbCBsaWtlbHkgbm90
IGJlDQotCSAqIGV4ZWN1dGVkIGluIHRoZSBuZWFyIGZ1dHVyZSwgYW5kIHRo
ZXkgYXJlIG1vc3QgbGlrZWx5IHRvDQotCSAqIGJlIGNhY2hlLWNvbGQsIHRo
dXMgc3dpdGNoaW5nIENQVXMgaGFzIHRoZSBsZWFzdCBlZmZlY3QNCi0JICog
b24gdGhlbS4NCi0JICovDQotCWlmIChidXNpZXN0LT5leHBpcmVkLT5ucl9h
Y3RpdmUpIHsNCi0JCWFycmF5ID0gYnVzaWVzdC0+ZXhwaXJlZDsNCi0JCWRz
dF9hcnJheSA9IHRoaXNfcnEtPmV4cGlyZWQ7DQotCX0gZWxzZSB7DQotCQlh
cnJheSA9IGJ1c2llc3QtPmFjdGl2ZTsNCi0JCWRzdF9hcnJheSA9IHRoaXNf
cnEtPmFjdGl2ZTsNCi0JfQ0KLQ0KLW5ld19hcnJheToNCiAJLyogU3RhcnQg
c2VhcmNoaW5nIGF0IHByaW9yaXR5IDA6ICovDQogCWlkeCA9IDA7DQogc2tp
cF9iaXRtYXA6DQogCWlmICghaWR4KQ0KLQkJaWR4ID0gc2NoZWRfZmluZF9m
aXJzdF9iaXQoYXJyYXktPmJpdG1hcCk7DQorCQlpZHggPSBzY2hlZF9maW5k
X2ZpcnN0X2JpdChidXNpZXN0LT5iaXRtYXApOw0KIAllbHNlDQotCQlpZHgg
PSBmaW5kX25leHRfYml0KGFycmF5LT5iaXRtYXAsIE1BWF9QUklPLCBpZHgp
Ow0KLQlpZiAoaWR4ID49IE1BWF9QUklPKSB7DQotCQlpZiAoYXJyYXkgPT0g
YnVzaWVzdC0+ZXhwaXJlZCAmJiBidXNpZXN0LT5hY3RpdmUtPm5yX2FjdGl2
ZSkgew0KLQkJCWFycmF5ID0gYnVzaWVzdC0+YWN0aXZlOw0KLQkJCWRzdF9h
cnJheSA9IHRoaXNfcnEtPmFjdGl2ZTsNCi0JCQlnb3RvIG5ld19hcnJheTsN
Ci0JCX0NCisJCWlkeCA9IGZpbmRfbmV4dF9iaXQoYnVzaWVzdC0+Yml0bWFw
LCBNQVhfUFJJTywgaWR4KTsNCisJaWYgKGlkeCA+PSBNQVhfUFJJTykgDQog
CQlnb3RvIG91dDsNCi0JfQ0KIA0KLQloZWFkID0gYXJyYXktPnF1ZXVlICsg
aWR4Ow0KKwloZWFkID0gYnVzaWVzdC0+cXVldWUgKyBpZHg7DQogCWN1cnIg
PSBoZWFkLT5wcmV2Ow0KIHNraXBfcXVldWU6DQogCXRtcCA9IGxpc3RfZW50
cnkoY3VyciwgdGFza190LCBydW5fbGlzdCk7DQpAQCAtMTYyOCw3ICsxMzY0
LDcgQEAgc2tpcF9xdWV1ZToNCiAJCWlkeCsrOw0KIAkJZ290byBza2lwX2Jp
dG1hcDsNCiAJfQ0KLQlwdWxsX3Rhc2soYnVzaWVzdCwgYXJyYXksIHRtcCwg
dGhpc19ycSwgZHN0X2FycmF5LCB0aGlzX2NwdSk7DQorCXB1bGxfdGFzayhi
dXNpZXN0LCB0bXAsIHRoaXNfcnEsIHRoaXNfY3B1KTsNCiAJcHVsbGVkKys7
DQogDQogCS8qIFdlIG9ubHkgd2FudCB0byBzdGVhbCB1cCB0byB0aGUgcHJl
c2NyaWJlZCBudW1iZXIgb2YgdGFza3MuICovDQpAQCAtMjEyMCwyMiArMTg1
Niw2IEBAIERFRklORV9QRVJfQ1BVKHN0cnVjdCBrZXJuZWxfc3RhdCwga3N0
YXQNCiBFWFBPUlRfUEVSX0NQVV9TWU1CT0woa3N0YXQpOw0KIA0KIC8qDQot
ICogV2UgcGxhY2UgaW50ZXJhY3RpdmUgdGFza3MgYmFjayBpbnRvIHRoZSBh
Y3RpdmUgYXJyYXksIGlmIHBvc3NpYmxlLg0KLSAqDQotICogVG8gZ3VhcmFu
dGVlIHRoYXQgdGhpcyBkb2VzIG5vdCBzdGFydmUgZXhwaXJlZCB0YXNrcyB3
ZSBpZ25vcmUgdGhlDQotICogaW50ZXJhY3Rpdml0eSBvZiBhIHRhc2sgaWYg
dGhlIGZpcnN0IGV4cGlyZWQgdGFzayBoYWQgdG8gd2FpdCBtb3JlDQotICog
dGhhbiBhICdyZWFzb25hYmxlJyBhbW91bnQgb2YgdGltZS4gVGhpcyBkZWFk
bGluZSB0aW1lb3V0IGlzDQotICogbG9hZC1kZXBlbmRlbnQsIGFzIHRoZSBm
cmVxdWVuY3kgb2YgYXJyYXkgc3dpdGNoZWQgZGVjcmVhc2VzIHdpdGgNCi0g
KiBpbmNyZWFzaW5nIG51bWJlciBvZiBydW5uaW5nIHRhc2tzLiBXZSBhbHNv
IGlnbm9yZSB0aGUgaW50ZXJhY3Rpdml0eQ0KLSAqIGlmIGEgYmV0dGVyIHN0
YXRpY19wcmlvIHRhc2sgaGFzIGV4cGlyZWQ6DQotICovDQotI2RlZmluZSBF
WFBJUkVEX1NUQVJWSU5HKHJxKSBcDQotCSgoU1RBUlZBVElPTl9MSU1JVCAm
JiAoKHJxKS0+ZXhwaXJlZF90aW1lc3RhbXAgJiYgXA0KLQkJKGppZmZpZXMg
LSAocnEpLT5leHBpcmVkX3RpbWVzdGFtcCA+PSBcDQotCQkJU1RBUlZBVElP
Tl9MSU1JVCAqICgocnEpLT5ucl9ydW5uaW5nKSArIDEpKSkgfHwgXA0KLQkJ
CSgocnEpLT5jdXJyLT5zdGF0aWNfcHJpbyA+IChycSktPmJlc3RfZXhwaXJl
ZF9wcmlvKSkNCi0NCi0vKg0KICAqIFRoaXMgZnVuY3Rpb24gZ2V0cyBjYWxs
ZWQgYnkgdGhlIHRpbWVyIGNvZGUsIHdpdGggSFogZnJlcXVlbmN5Lg0KICAq
IFdlIGNhbGwgaXQgd2l0aCBpbnRlcnJ1cHRzIGRpc2FibGVkLg0KICAqDQpA
QCAtMjE3OSw3OCArMTg5OSwzNiBAQCB2b2lkIHNjaGVkdWxlcl90aWNrKGlu
dCB1c2VyX3RpY2tzLCBpbnQgDQogCQljcHVzdGF0LT51c2VyICs9IHVzZXJf
dGlja3M7DQogCWNwdXN0YXQtPnN5c3RlbSArPSBzeXNfdGlja3M7DQogDQot
CS8qIFRhc2sgbWlnaHQgaGF2ZSBleHBpcmVkIGFscmVhZHksIGJ1dCBub3Qg
c2NoZWR1bGVkIG9mZiB5ZXQgKi8NCi0JaWYgKHAtPmFycmF5ICE9IHJxLT5h
Y3RpdmUpIHsNCisJc3Bpbl9sb2NrKCZycS0+bG9jayk7DQorCS8vIFNDSEVE
X0ZJRk8gdGFza3MgbmV2ZXIgcnVuIG91dCBvZiB0aW1lc2xpY2UuDQorCWlm
ICh1bmxpa2VseShwLT5wb2xpY3kgPT0gU0NIRURfRklGTykpDQorCQlnb3Rv
IG91dF91bmxvY2s7DQorCXJxLT5jYWNoZV90aWNrcysrOw0KKwkvLyBUYXNr
cyBsb3NlIGJ1cnN0IGVhY2ggdGltZSB0aGV5IHVzZSB1cCBhIGZ1bGwgc2xp
Y2UoKS4NCisJaWYgKCEtLXAtPnNsaWNlKSB7DQogCQlzZXRfdHNrX25lZWRf
cmVzY2hlZChwKTsNCi0JCWdvdG8gb3V0Ow0KKwkJZGVxdWV1ZV90YXNrKHAs
IHJxKTsNCisJCWRlY19idXJzdChwKTsNCisJCXAtPnNsaWNlID0gc2xpY2Uo
cCk7DQorCQlwLT5wcmlvID0gZWZmZWN0aXZlX3ByaW8ocCk7DQorCQlwLT50
aW1lX3NsaWNlID0gUlJfSU5URVJWQUw7DQorCQllbnF1ZXVlX3Rhc2socCwg
cnEpOw0KKwkJZ290byBvdXRfdW5sb2NrOw0KIAl9DQotCXNwaW5fbG9jaygm
cnEtPmxvY2spOw0KIAkvKg0KLQkgKiBUaGUgdGFzayB3YXMgcnVubmluZyBk
dXJpbmcgdGhpcyB0aWNrIC0gdXBkYXRlIHRoZQ0KLQkgKiB0aW1lIHNsaWNl
IGNvdW50ZXIuIE5vdGU6IHdlIGRvIG5vdCB1cGRhdGUgYSB0aHJlYWQncw0K
LQkgKiBwcmlvcml0eSB1bnRpbCBpdCBlaXRoZXIgZ29lcyB0byBzbGVlcCBv
ciB1c2VzIHVwIGl0cw0KLQkgKiB0aW1lc2xpY2UuIFRoaXMgbWFrZXMgaXQg
cG9zc2libGUgZm9yIGludGVyYWN0aXZlIHRhc2tzDQotCSAqIHRvIHVzZSB1
cCB0aGVpciB0aW1lc2xpY2VzIGF0IHRoZWlyIGhpZ2hlc3QgcHJpb3JpdHkg
bGV2ZWxzLg0KKwkgKiBUYXNrcyB0aGF0IHJ1biBvdXQgb2YgdGltZV9zbGlj
ZSBidXQgc3RpbGwgaGF2ZSBzbGljZSBsZWZ0IGdldA0KKwkgKiByZXF1ZXVl
ZCB3aXRoIGEgbG93ZXIgcHJpb3JpdHkgJiYgUlJfSU5URVJWQUwgdGltZV9z
bGljZS4NCiAJICovDQotCWlmICh1bmxpa2VseShydF90YXNrKHApKSkgew0K
LQkJLyoNCi0JCSAqIFJSIHRhc2tzIG5lZWQgYSBzcGVjaWFsIGZvcm0gb2Yg
dGltZXNsaWNlIG1hbmFnZW1lbnQuDQotCQkgKiBGSUZPIHRhc2tzIGhhdmUg
bm8gdGltZXNsaWNlcy4NCi0JCSAqLw0KLQkJaWYgKChwLT5wb2xpY3kgPT0g
U0NIRURfUlIpICYmICEtLXAtPnRpbWVfc2xpY2UpIHsNCi0JCQlwLT50aW1l
X3NsaWNlID0gdGFza190aW1lc2xpY2UocCk7DQotCQkJcC0+Zmlyc3RfdGlt
ZV9zbGljZSA9IDA7DQotCQkJc2V0X3Rza19uZWVkX3Jlc2NoZWQocCk7DQot
DQotCQkJLyogcHV0IGl0IGF0IHRoZSBlbmQgb2YgdGhlIHF1ZXVlOiAqLw0K
LQkJCWRlcXVldWVfdGFzayhwLCBycS0+YWN0aXZlKTsNCi0JCQllbnF1ZXVl
X3Rhc2socCwgcnEtPmFjdGl2ZSk7DQotCQl9DQotCQlnb3RvIG91dF91bmxv
Y2s7DQotCX0NCiAJaWYgKCEtLXAtPnRpbWVfc2xpY2UpIHsNCi0JCWRlcXVl
dWVfdGFzayhwLCBycS0+YWN0aXZlKTsNCiAJCXNldF90c2tfbmVlZF9yZXNj
aGVkKHApOw0KKwkJZGVxdWV1ZV90YXNrKHAsIHJxKTsNCiAJCXAtPnByaW8g
PSBlZmZlY3RpdmVfcHJpbyhwKTsNCi0JCXAtPnRpbWVfc2xpY2UgPSB0YXNr
X3RpbWVzbGljZShwKTsNCi0JCXAtPmZpcnN0X3RpbWVfc2xpY2UgPSAwOw0K
LQ0KLQkJaWYgKCFycS0+ZXhwaXJlZF90aW1lc3RhbXApDQotCQkJcnEtPmV4
cGlyZWRfdGltZXN0YW1wID0gamlmZmllczsNCi0JCWlmICghVEFTS19JTlRF
UkFDVElWRShwKSB8fCBFWFBJUkVEX1NUQVJWSU5HKHJxKSkgew0KLQkJCWVu
cXVldWVfdGFzayhwLCBycS0+ZXhwaXJlZCk7DQotCQkJaWYgKHAtPnN0YXRp
Y19wcmlvIDwgcnEtPmJlc3RfZXhwaXJlZF9wcmlvKQ0KLQkJCQlycS0+YmVz
dF9leHBpcmVkX3ByaW8gPSBwLT5zdGF0aWNfcHJpbzsNCi0JCX0gZWxzZQ0K
LQkJCWVucXVldWVfdGFzayhwLCBycS0+YWN0aXZlKTsNCi0JfSBlbHNlIHsN
Ci0JCS8qDQotCQkgKiBQcmV2ZW50IGEgdG9vIGxvbmcgdGltZXNsaWNlIGFs
bG93aW5nIGEgdGFzayB0byBtb25vcG9saXplDQotCQkgKiB0aGUgQ1BVLiBX
ZSBkbyB0aGlzIGJ5IHNwbGl0dGluZyB1cCB0aGUgdGltZXNsaWNlIGludG8N
Ci0JCSAqIHNtYWxsZXIgcGllY2VzLg0KLQkJICoNCi0JCSAqIE5vdGU6IHRo
aXMgZG9lcyBub3QgbWVhbiB0aGUgdGFzaydzIHRpbWVzbGljZXMgZXhwaXJl
IG9yDQotCQkgKiBnZXQgbG9zdCBpbiBhbnkgd2F5LCB0aGV5IGp1c3QgbWln
aHQgYmUgcHJlZW1wdGVkIGJ5DQotCQkgKiBhbm90aGVyIHRhc2sgb2YgZXF1
YWwgcHJpb3JpdHkuIChvbmUgd2l0aCBoaWdoZXINCi0JCSAqIHByaW9yaXR5
IHdvdWxkIGhhdmUgcHJlZW1wdGVkIHRoaXMgdGFzayBhbHJlYWR5LikgV2UN
Ci0JCSAqIHJlcXVldWUgdGhpcyB0YXNrIHRvIHRoZSBlbmQgb2YgdGhlIGxp
c3Qgb24gdGhpcyBwcmlvcml0eQ0KLQkJICogbGV2ZWwsIHdoaWNoIGlzIGlu
IGVzc2VuY2UgYSByb3VuZC1yb2JpbiBvZiB0YXNrcyB3aXRoDQotCQkgKiBl
cXVhbCBwcmlvcml0eS4NCi0JCSAqDQotCQkgKiBUaGlzIG9ubHkgYXBwbGll
cyB0byB0YXNrcyBpbiB0aGUgaW50ZXJhY3RpdmUNCi0JCSAqIGRlbHRhIHJh
bmdlIHdpdGggYXQgbGVhc3QgVElNRVNMSUNFX0dSQU5VTEFSSVRZIHRvIHJl
cXVldWUuDQotCQkgKi8NCi0JCWlmIChUQVNLX0lOVEVSQUNUSVZFKHApICYm
ICEoKHRhc2tfdGltZXNsaWNlKHApIC0NCi0JCQlwLT50aW1lX3NsaWNlKSAl
IFRJTUVTTElDRV9HUkFOVUxBUklUWShwKSkgJiYNCi0JCQkocC0+dGltZV9z
bGljZSA+PSBUSU1FU0xJQ0VfR1JBTlVMQVJJVFkocCkpICYmDQotCQkJKHAt
PmFycmF5ID09IHJxLT5hY3RpdmUpKSB7DQotDQotCQkJZGVxdWV1ZV90YXNr
KHAsIHJxLT5hY3RpdmUpOw0KLQkJCXNldF90c2tfbmVlZF9yZXNjaGVkKHAp
Ow0KLQkJCXAtPnByaW8gPSBlZmZlY3RpdmVfcHJpbyhwKTsNCi0JCQllbnF1
ZXVlX3Rhc2socCwgcnEtPmFjdGl2ZSk7DQotCQl9DQorCQlwLT50aW1lX3Ns
aWNlID0gUlJfSU5URVJWQUw7DQorCQllbnF1ZXVlX3Rhc2socCwgcnEpOw0K
KwkJZ290byBvdXRfdW5sb2NrOw0KIAl9DQorCWlmIChycS0+cHJlZW1wdGVk
ICYmIHJxLT5jYWNoZV90aWNrcyA+PSBjYWNoZV9kZWNheV90aWNrcykNCisJ
CXNldF90c2tfbmVlZF9yZXNjaGVkKHApOw0KIG91dF91bmxvY2s6DQogCXNw
aW5fdW5sb2NrKCZycS0+bG9jayk7DQogb3V0Og0KQEAgLTIzMTMsOCArMTk5
MSw4IEBAIHN0YXRpYyBpbmxpbmUgaW50IGRlcGVuZGVudF9zbGVlcGVyKGlu
dCANCiAJCSAqIHRhc2sgZnJvbSB1c2luZyBhbiB1bmZhaXIgcHJvcG9ydGlv
biBvZiB0aGUNCiAJCSAqIHBoeXNpY2FsIGNwdSdzIHJlc291cmNlcy4gLWNr
DQogCQkgKi8NCi0JCWlmICgoKHNtdF9jdXJyLT50aW1lX3NsaWNlICogKDEw
MCAtIHNkLT5wZXJfY3B1X2dhaW4pIC8gMTAwKSA+DQotCQkJdGFza190aW1l
c2xpY2UocCkgfHwgcnRfdGFzayhzbXRfY3VycikpICYmDQorCQlpZiAoKChz
bXRfY3Vyci0+c2xpY2UgKiAoMTAwIC0gc2QtPnBlcl9jcHVfZ2FpbikgLyAx
MDApID4NCisJCQlzbGljZShwKSB8fCBydF90YXNrKHNtdF9jdXJyKSkgJiYN
CiAJCQlwLT5tbSAmJiBzbXRfY3Vyci0+bW0gJiYgIXJ0X3Rhc2socCkpDQog
CQkJCXJldCA9IDE7DQogDQpAQCAtMjMyMyw4ICsyMDAxLDggQEAgc3RhdGlj
IGlubGluZSBpbnQgZGVwZW5kZW50X3NsZWVwZXIoaW50IA0KIAkJICogb3Ig
d2FrZSBpdCB1cCBpZiBpdCBoYXMgYmVlbiBwdXQgdG8gc2xlZXAgZm9yIHBy
aW9yaXR5DQogCQkgKiByZWFzb25zLg0KIAkJICovDQotCQlpZiAoKCgocC0+
dGltZV9zbGljZSAqICgxMDAgLSBzZC0+cGVyX2NwdV9nYWluKSAvIDEwMCkg
Pg0KLQkJCXRhc2tfdGltZXNsaWNlKHNtdF9jdXJyKSB8fCBydF90YXNrKHAp
KSAmJg0KKwkJaWYgKCgoKHAtPnNsaWNlICogKDEwMCAtIHNkLT5wZXJfY3B1
X2dhaW4pIC8gMTAwKSA+IA0KKwkJCXNsaWNlKHNtdF9jdXJyKSB8fCBydF90
YXNrKHApKSAmJiANCiAJCQlzbXRfY3Vyci0+bW0gJiYgcC0+bW0gJiYgIXJ0
X3Rhc2soc210X2N1cnIpKSB8fA0KIAkJCShzbXRfY3VyciA9PSBzbXRfcnEt
PmlkbGUgJiYgc210X3JxLT5ucl9ydW5uaW5nKSkNCiAJCQkJcmVzY2hlZF90
YXNrKHNtdF9jdXJyKTsNCkBAIC0yMzUwLDEwICsyMDI4LDggQEAgYXNtbGlu
a2FnZSB2b2lkIF9fc2NoZWQgc2NoZWR1bGUodm9pZCkNCiAJbG9uZyAqc3dp
dGNoX2NvdW50Ow0KIAl0YXNrX3QgKnByZXYsICpuZXh0Ow0KIAlydW5xdWV1
ZV90ICpycTsNCi0JcHJpb19hcnJheV90ICphcnJheTsNCiAJc3RydWN0IGxp
c3RfaGVhZCAqcXVldWU7DQogCXVuc2lnbmVkIGxvbmcgbG9uZyBub3c7DQot
CXVuc2lnbmVkIGxvbmcgcnVuX3RpbWU7DQogCWludCBjcHUsIGlkeDsNCiAN
CiAJLyoNCkBAIC0yMzc2LDE5ICsyMDUyLDggQEAgbmVlZF9yZXNjaGVkOg0K
IAlyZWxlYXNlX2tlcm5lbF9sb2NrKHByZXYpOw0KICAJc2NoZWRzdGF0X2lu
YyhycSwgc2NoZWRfY250KTsNCiAJbm93ID0gc2NoZWRfY2xvY2soKTsNCi0J
aWYgKGxpa2VseShub3cgLSBwcmV2LT50aW1lc3RhbXAgPCBOU19NQVhfU0xF
RVBfQVZHKSkNCi0JCXJ1bl90aW1lID0gbm93IC0gcHJldi0+dGltZXN0YW1w
Ow0KLQllbHNlDQotCQlydW5fdGltZSA9IE5TX01BWF9TTEVFUF9BVkc7DQot
DQotCS8qDQotCSAqIFRhc2tzIHdpdGggaW50ZXJhY3RpdmUgY3JlZGl0cyBn
ZXQgY2hhcmdlZCBsZXNzIHJ1bl90aW1lDQotCSAqIGF0IGhpZ2ggc2xlZXBf
YXZnIHRvIGRlbGF5IHRoZW0gbG9zaW5nIHRoZWlyIGludGVyYWN0aXZlDQot
CSAqIHN0YXR1cw0KLQkgKi8NCi0JaWYgKEhJR0hfQ1JFRElUKHByZXYpKQ0K
LQkJcnVuX3RpbWUgLz0gKENVUlJFTlRfQk9OVVMocHJldikgPyA6IDEpOw0K
IA0KKwlwcmV2LT5ydW50aW1lID0gbm93IC0gcHJldi0+dGltZXN0YW1wOw0K
IAlzcGluX2xvY2tfaXJxKCZycS0+bG9jayk7DQogDQogCS8qDQpAQCAtMjQx
MCw2MSArMjA3NSwyNiBAQCBuZWVkX3Jlc2NoZWQ6DQogCQlpZGxlX2JhbGFu
Y2UoY3B1LCBycSk7DQogCQlpZiAoIXJxLT5ucl9ydW5uaW5nKSB7DQogCQkJ
bmV4dCA9IHJxLT5pZGxlOw0KLQkJCXJxLT5leHBpcmVkX3RpbWVzdGFtcCA9
IDA7DQogCQkJd2FrZV9zbGVlcGluZ19kZXBlbmRlbnQoY3B1LCBycSk7DQog
IAkJCXNjaGVkc3RhdF9pbmMocnEsIHNjaGVkX2lkbGUpOw0KIAkJCWdvdG8g
c3dpdGNoX3Rhc2tzOw0KIAkJfQ0KIAl9DQotDQotCWFycmF5ID0gcnEtPmFj
dGl2ZTsNCi0JaWYgKHVubGlrZWx5KCFhcnJheS0+bnJfYWN0aXZlKSkgew0K
LQkJLyoNCi0JCSAqIFN3aXRjaCB0aGUgYWN0aXZlIGFuZCBleHBpcmVkIGFy
cmF5cy4NCi0JCSAqLw0KLQkJc2NoZWRzdGF0X2luYyhycSwgc2NoZWRfc3dp
dGNoKTsNCi0JCXJxLT5hY3RpdmUgPSBycS0+ZXhwaXJlZDsNCi0JCXJxLT5l
eHBpcmVkID0gYXJyYXk7DQotCQlhcnJheSA9IHJxLT5hY3RpdmU7DQotCQly
cS0+ZXhwaXJlZF90aW1lc3RhbXAgPSAwOw0KLQkJcnEtPmJlc3RfZXhwaXJl
ZF9wcmlvID0gTUFYX1BSSU87DQotCX0NCi0NCi0JaWR4ID0gc2NoZWRfZmlu
ZF9maXJzdF9iaXQoYXJyYXktPmJpdG1hcCk7DQotCXF1ZXVlID0gYXJyYXkt
PnF1ZXVlICsgaWR4Ow0KKwlpZHggPSBzY2hlZF9maW5kX2ZpcnN0X2JpdChy
cS0+Yml0bWFwKTsNCisJcXVldWUgPSBycS0+cXVldWUgKyBpZHg7DQogCW5l
eHQgPSBsaXN0X2VudHJ5KHF1ZXVlLT5uZXh0LCB0YXNrX3QsIHJ1bl9saXN0
KTsNCiANCi0JaWYgKGRlcGVuZGVudF9zbGVlcGVyKGNwdSwgcnEsIG5leHQp
KSB7DQorCWlmIChkZXBlbmRlbnRfc2xlZXBlcihjcHUsIHJxLCBuZXh0KSkg
DQogCQluZXh0ID0gcnEtPmlkbGU7DQotCQlnb3RvIHN3aXRjaF90YXNrczsN
Ci0JfQ0KLQ0KLQlpZiAoIXJ0X3Rhc2sobmV4dCkgJiYgbmV4dC0+YWN0aXZh
dGVkID4gMCkgew0KLQkJdW5zaWduZWQgbG9uZyBsb25nIGRlbHRhID0gbm93
IC0gbmV4dC0+dGltZXN0YW1wOw0KLQ0KLQkJaWYgKG5leHQtPmFjdGl2YXRl
ZCA9PSAxKQ0KLQkJCWRlbHRhID0gZGVsdGEgKiAoT05fUlVOUVVFVUVfV0VJ
R0hUICogMTI4IC8gMTAwKSAvIDEyODsNCi0NCi0JCWFycmF5ID0gbmV4dC0+
YXJyYXk7DQotCQlkZXF1ZXVlX3Rhc2sobmV4dCwgYXJyYXkpOw0KLQkJcmVj
YWxjX3Rhc2tfcHJpbyhuZXh0LCBuZXh0LT50aW1lc3RhbXAgKyBkZWx0YSk7
DQotCQllbnF1ZXVlX3Rhc2sobmV4dCwgYXJyYXkpOw0KLQl9DQotCW5leHQt
PmFjdGl2YXRlZCA9IDA7DQogc3dpdGNoX3Rhc2tzOg0KIAlwcmVmZXRjaChu
ZXh0KTsNCiAJY2xlYXJfdHNrX25lZWRfcmVzY2hlZChwcmV2KTsNCiAJUkNV
X3FzY3RyKHRhc2tfY3B1KHByZXYpKSsrOw0KLQ0KLQlwcmV2LT5zbGVlcF9h
dmcgLT0gcnVuX3RpbWU7DQotCWlmICgobG9uZylwcmV2LT5zbGVlcF9hdmcg
PD0gMCkgew0KLQkJcHJldi0+c2xlZXBfYXZnID0gMDsNCi0JCWlmICghKEhJ
R0hfQ1JFRElUKHByZXYpIHx8IExPV19DUkVESVQocHJldikpKQ0KLQkJCXBy
ZXYtPmludGVyYWN0aXZlX2NyZWRpdC0tOw0KLQl9DQogCXByZXYtPnRpbWVz
dGFtcCA9IG5vdzsNCiANCiAJaWYgKGxpa2VseShwcmV2ICE9IG5leHQpKSB7
DQorCQlycS0+cHJlZW1wdGVkID0gMDsNCisJCXJxLT5jYWNoZV90aWNrcyA9
IDA7DQogCQluZXh0LT50aW1lc3RhbXAgPSBub3c7DQogCQlycS0+bnJfc3dp
dGNoZXMrKzsNCiAJCXJxLT5jdXJyID0gbmV4dDsNCkBAIC0yNzI3LDkgKzIz
NTcsOCBAQCBFWFBPUlRfU1lNQk9MKHNsZWVwX29uX3RpbWVvdXQpOw0KIHZv
aWQgc2V0X3VzZXJfbmljZSh0YXNrX3QgKnAsIGxvbmcgbmljZSkNCiB7DQog
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQotCXByaW9fYXJyYXlfdCAqYXJyYXk7
DQogCXJ1bnF1ZXVlX3QgKnJxOw0KLQlpbnQgb2xkX3ByaW8sIG5ld19wcmlv
LCBkZWx0YTsNCisJaW50IHF1ZXVlZCwgb2xkX3ByaW8sIG5ld19wcmlvLCBk
ZWx0YTsNCiANCiAJaWYgKFRBU0tfTklDRShwKSA9PSBuaWNlIHx8IG5pY2Ug
PCAtMjAgfHwgbmljZSA+IDE5KQ0KIAkJcmV0dXJuOw0KQEAgLTI3NDgsOSAr
MjM3Nyw4IEBAIHZvaWQgc2V0X3VzZXJfbmljZSh0YXNrX3QgKnAsIGxvbmcg
bmljZSkNCiAJCXAtPnN0YXRpY19wcmlvID0gTklDRV9UT19QUklPKG5pY2Up
Ow0KIAkJZ290byBvdXRfdW5sb2NrOw0KIAl9DQotCWFycmF5ID0gcC0+YXJy
YXk7DQotCWlmIChhcnJheSkNCi0JCWRlcXVldWVfdGFzayhwLCBhcnJheSk7
DQorCWlmICgocXVldWVkID0gdGFza19xdWV1ZWQocCkpKQ0KKwkJZGVxdWV1
ZV90YXNrKHAsIHJxKTsNCiANCiAJb2xkX3ByaW8gPSBwLT5wcmlvOw0KIAlu
ZXdfcHJpbyA9IE5JQ0VfVE9fUFJJTyhuaWNlKTsNCkBAIC0yNzU4LDggKzIz
ODYsOCBAQCB2b2lkIHNldF91c2VyX25pY2UodGFza190ICpwLCBsb25nIG5p
Y2UpDQogCXAtPnN0YXRpY19wcmlvID0gTklDRV9UT19QUklPKG5pY2UpOw0K
IAlwLT5wcmlvICs9IGRlbHRhOw0KIA0KLQlpZiAoYXJyYXkpIHsNCi0JCWVu
cXVldWVfdGFzayhwLCBhcnJheSk7DQorCWlmIChxdWV1ZWQpIHsNCisJCWVu
cXVldWVfdGFzayhwLCBycSk7DQogCQkvKg0KIAkJICogSWYgdGhlIHRhc2sg
aW5jcmVhc2VkIGl0cyBwcmlvcml0eSBvciBpcyBydW5uaW5nIGFuZA0KIAkJ
ICogbG93ZXJlZCBpdHMgcHJpb3JpdHksIHRoZW4gcmVzY2hlZHVsZSBpdHMg
Q1BVOg0KQEAgLTI4NzEsNyArMjQ5OSw3IEBAIHN0YXRpYyBpbmxpbmUgdGFz
a190ICpmaW5kX3Byb2Nlc3NfYnlfcGkNCiAvKiBBY3R1YWxseSBkbyBwcmlv
cml0eSBjaGFuZ2U6IG11c3QgaG9sZCBycSBsb2NrLiAqLw0KIHN0YXRpYyB2
b2lkIF9fc2V0c2NoZWR1bGVyKHN0cnVjdCB0YXNrX3N0cnVjdCAqcCwgaW50
IHBvbGljeSwgaW50IHByaW8pDQogew0KLQlCVUdfT04ocC0+YXJyYXkpOw0K
KwlCVUdfT04odGFza19xdWV1ZWQocCkpOw0KIAlwLT5wb2xpY3kgPSBwb2xp
Y3k7DQogCXAtPnJ0X3ByaW9yaXR5ID0gcHJpbzsNCiAJaWYgKHBvbGljeSAh
PSBTQ0hFRF9OT1JNQUwpDQpAQCAtMjg4Nyw4ICsyNTE1LDcgQEAgc3RhdGlj
IGludCBzZXRzY2hlZHVsZXIocGlkX3QgcGlkLCBpbnQgcA0KIHsNCiAJc3Ry
dWN0IHNjaGVkX3BhcmFtIGxwOw0KIAlpbnQgcmV0dmFsID0gLUVJTlZBTDsN
Ci0JaW50IG9sZHByaW87DQotCXByaW9fYXJyYXlfdCAqYXJyYXk7DQorCWlu
dCBxdWV1ZWQsIG9sZHByaW87DQogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQog
CXJ1bnF1ZXVlX3QgKnJxOw0KIAl0YXNrX3QgKnA7DQpAQCAtMjk0OCwxMyAr
MjU3NSwxMiBAQCBzdGF0aWMgaW50IHNldHNjaGVkdWxlcihwaWRfdCBwaWQs
IGludCBwDQogCWlmIChyZXR2YWwpDQogCQlnb3RvIG91dF91bmxvY2s7DQog
DQotCWFycmF5ID0gcC0+YXJyYXk7DQotCWlmIChhcnJheSkNCisJaWYgKChx
dWV1ZWQgPSB0YXNrX3F1ZXVlZChwKSkpDQogCQlkZWFjdGl2YXRlX3Rhc2so
cCwgdGFza19ycShwKSk7DQogCXJldHZhbCA9IDA7DQogCW9sZHByaW8gPSBw
LT5wcmlvOw0KIAlfX3NldHNjaGVkdWxlcihwLCBwb2xpY3ksIGxwLnNjaGVk
X3ByaW9yaXR5KTsNCi0JaWYgKGFycmF5KSB7DQorCWlmIChxdWV1ZWQpIHsN
CiAJCV9fYWN0aXZhdGVfdGFzayhwLCB0YXNrX3JxKHApKTsNCiAJCS8qDQog
CQkgKiBSZXNjaGVkdWxlIGlmIHdlIGFyZSBjdXJyZW50bHkgcnVubmluZyBv
biB0aGlzIHJ1bnF1ZXVlIGFuZA0KQEAgLTI5NjQsNyArMjU5MCw3IEBAIHN0
YXRpYyBpbnQgc2V0c2NoZWR1bGVyKHBpZF90IHBpZCwgaW50IHANCiAJCWlm
ICh0YXNrX3J1bm5pbmcocnEsIHApKSB7DQogCQkJaWYgKHAtPnByaW8gPiBv
bGRwcmlvKQ0KIAkJCQlyZXNjaGVkX3Rhc2socnEtPmN1cnIpOw0KLQkJfSBl
bHNlIGlmIChUQVNLX1BSRUVNUFRTX0NVUlIocCwgcnEpKQ0KKwkJfSBlbHNl
IGlmICh0YXNrX3ByZWVtcHRzX2N1cnIocCwgcnEpKQ0KIAkJCXJlc2NoZWRf
dGFzayhycS0+Y3Vycik7DQogCX0NCiANCkBAIC0zMTcyLDMwICsyNzk4LDIw
IEBAIG91dF91bmxvY2s6DQogLyoqDQogICogc3lzX3NjaGVkX3lpZWxkIC0g
eWllbGQgdGhlIGN1cnJlbnQgcHJvY2Vzc29yIHRvIG90aGVyIHRocmVhZHMu
DQogICoNCi0gKiB0aGlzIGZ1bmN0aW9uIHlpZWxkcyB0aGUgY3VycmVudCBD
UFUgYnkgbW92aW5nIHRoZSBjYWxsaW5nIHRocmVhZA0KLSAqIHRvIHRoZSBl
eHBpcmVkIGFycmF5LiBJZiB0aGVyZSBhcmUgbm8gb3RoZXIgdGhyZWFkcyBy
dW5uaW5nIG9uIHRoaXMNCiAgKiBDUFUgdGhlbiB0aGlzIGZ1bmN0aW9uIHdp
bGwgcmV0dXJuLg0KICAqLw0KIGFzbWxpbmthZ2UgbG9uZyBzeXNfc2NoZWRf
eWllbGQodm9pZCkNCiB7DQogCXJ1bnF1ZXVlX3QgKnJxID0gdGhpc19ycV9s
b2NrKCk7DQotCXByaW9fYXJyYXlfdCAqYXJyYXkgPSBjdXJyZW50LT5hcnJh
eTsNCi0JcHJpb19hcnJheV90ICp0YXJnZXQgPSBycS0+ZXhwaXJlZDsNCi0N
Ci0Jc2NoZWRzdGF0X2luYyhycSwgeWxkX2NudCk7DQotCS8qDQotCSAqIFdl
IGltcGxlbWVudCB5aWVsZGluZyBieSBtb3ZpbmcgdGhlIHRhc2sgaW50byB0
aGUgZXhwaXJlZA0KLQkgKiBxdWV1ZS4NCi0JICoNCi0JICogKHNwZWNpYWwg
cnVsZTogUlQgdGFza3Mgd2lsbCBqdXN0IHJvdW5kcm9iaW4gaW4gdGhlIGFj
dGl2ZQ0KLQkgKiAgYXJyYXkuKQ0KLQkgKi8NCi0JaWYgKHVubGlrZWx5KHJ0
X3Rhc2soY3VycmVudCkpKQ0KLQkJdGFyZ2V0ID0gcnEtPmFjdGl2ZTsNCi0N
Ci0JZGVxdWV1ZV90YXNrKGN1cnJlbnQsIGFycmF5KTsNCi0JZW5xdWV1ZV90
YXNrKGN1cnJlbnQsIHRhcmdldCk7DQogDQorCWRlcXVldWVfdGFzayhjdXJy
ZW50LCBycSk7DQorCWN1cnJlbnQtPnNsaWNlID0gUlJfSU5URVJWQUw7DQor
CWN1cnJlbnQtPnRpbWVfc2xpY2UgPSBjdXJyZW50LT5zbGljZTsNCisJaWYg
KCFydF90YXNrKGN1cnJlbnQpKQ0KKwkJY3VycmVudC0+cHJpbyA9IE1BWF9Q
UklPIC0gMTsNCisJaW5jX2J1cnN0KGN1cnJlbnQpOw0KKwllbnF1ZXVlX3Rh
c2soY3VycmVudCwgcnEpOw0KKwkNCiAJLyoNCiAJICogU2luY2Ugd2UgYXJl
IGdvaW5nIHRvIGNhbGwgc2NoZWR1bGUoKSBhbnl3YXksIHRoZXJlJ3MNCiAJ
ICogbm8gbmVlZCB0byBwcmVlbXB0IG9yIGVuYWJsZSBpbnRlcnJ1cHRzOg0K
QEAgLTMzMzMsNyArMjk0OSw3IEBAIGxvbmcgc3lzX3NjaGVkX3JyX2dldF9p
bnRlcnZhbChwaWRfdCBwaWQNCiAJCWdvdG8gb3V0X3VubG9jazsNCiANCiAJ
amlmZmllc190b190aW1lc3BlYyhwLT5wb2xpY3kgJiBTQ0hFRF9GSUZPID8N
Ci0JCQkJMCA6IHRhc2tfdGltZXNsaWNlKHApLCAmdCk7DQorCQkJCTAgOiBz
bGljZShwKSwgJnQpOw0KIAlyZWFkX3VubG9jaygmdGFza2xpc3RfbG9jayk7
DQogCXJldHZhbCA9IGNvcHlfdG9fdXNlcihpbnRlcnZhbCwgJnQsIHNpemVv
Zih0KSkgPyAtRUZBVUxUIDogMDsNCiBvdXRfbm91bmxvY2s6DQpAQCAtMzQ1
MSw5ICszMDY3LDkgQEAgdm9pZCBfX2RldmluaXQgaW5pdF9pZGxlKHRhc2tf
dCAqaWRsZSwgaQ0KIA0KIAlpZGxlX3JxLT5jdXJyID0gaWRsZV9ycS0+aWRs
ZSA9IGlkbGU7DQogCWRlYWN0aXZhdGVfdGFzayhpZGxlLCBycSk7DQotCWlk
bGUtPmFycmF5ID0gTlVMTDsNCiAJaWRsZS0+cHJpbyA9IE1BWF9QUklPOw0K
IAlpZGxlLT5zdGF0ZSA9IFRBU0tfUlVOTklORzsNCisJaWRsZS0+YnVyc3Qg
PSAwOw0KIAlzZXRfdGFza19jcHUoaWRsZSwgY3B1KTsNCiAJZG91YmxlX3Jx
X3VubG9jayhpZGxlX3JxLCBycSk7DQogCXNldF90c2tfbmVlZF9yZXNjaGVk
KGlkbGUpOw0KQEAgLTM1NjUsNyArMzE4MSw3IEBAIHN0YXRpYyB2b2lkIF9f
bWlncmF0ZV90YXNrKHN0cnVjdCB0YXNrX3MNCiAJCWdvdG8gb3V0Ow0KIA0K
IAlzZXRfdGFza19jcHUocCwgZGVzdF9jcHUpOw0KLQlpZiAocC0+YXJyYXkp
IHsNCisJaWYgKHRhc2tfcXVldWVkKHApKSB7DQogCQkvKg0KIAkJICogU3lu
YyB0aW1lc3RhbXAgd2l0aCBycV9kZXN0J3MgYmVmb3JlIGFjdGl2YXRpbmcu
DQogCQkgKiBUaGUgc2FtZSB0aGluZyBjb3VsZCBiZSBhY2hpZXZlZCBieSBk
b2luZyB0aGlzIHN0ZXANCkBAIC0zNTc2LDcgKzMxOTIsNyBAQCBzdGF0aWMg
dm9pZCBfX21pZ3JhdGVfdGFzayhzdHJ1Y3QgdGFza19zDQogCQkJCSsgcnFf
ZGVzdC0+dGltZXN0YW1wX2xhc3RfdGljazsNCiAJCWRlYWN0aXZhdGVfdGFz
ayhwLCBycV9zcmMpOw0KIAkJYWN0aXZhdGVfdGFzayhwLCBycV9kZXN0LCAw
KTsNCi0JCWlmIChUQVNLX1BSRUVNUFRTX0NVUlIocCwgcnFfZGVzdCkpDQor
CQlpZiAodGFza19wcmVlbXB0c19jdXJyKHAsIHJxX2Rlc3QpKQ0KIAkJCXJl
c2NoZWRfdGFzayhycV9kZXN0LT5jdXJyKTsNCiAJfQ0KIA0KQEAgLTQwODYs
NyArMzcwMiw3IEBAIGludCBpbl9zY2hlZF9mdW5jdGlvbnModW5zaWduZWQg
bG9uZyBhZGQNCiB2b2lkIF9faW5pdCBzY2hlZF9pbml0KHZvaWQpDQogew0K
IAlydW5xdWV1ZV90ICpycTsNCi0JaW50IGksIGosIGs7DQorCWludCBpLCBq
Ow0KIA0KICNpZmRlZiBDT05GSUdfU01QDQogCS8qIFNldCB1cCBhbiBpbml0
aWFsIGR1bW15IGRvbWFpbiBmb3IgZWFybHkgYm9vdCAqLw0KQEAgLTQxMDYs
MTMgKzM3MjIsMTEgQEAgdm9pZCBfX2luaXQgc2NoZWRfaW5pdCh2b2lkKQ0K
ICNlbmRpZg0KIA0KIAlmb3IgKGkgPSAwOyBpIDwgTlJfQ1BVUzsgaSsrKSB7
DQotCQlwcmlvX2FycmF5X3QgKmFycmF5Ow0KLQ0KIAkJcnEgPSBjcHVfcnEo
aSk7DQogCQlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOw0KLQkJcnEtPmFj
dGl2ZSA9IHJxLT5hcnJheXM7DQotCQlycS0+ZXhwaXJlZCA9IHJxLT5hcnJh
eXMgKyAxOw0KLQkJcnEtPmJlc3RfZXhwaXJlZF9wcmlvID0gTUFYX1BSSU87
DQorCQkNCisJCXJxLT5jYWNoZV90aWNrcyA9IDA7DQorCQlycS0+cHJlZW1w
dGVkID0gMDsNCiANCiAjaWZkZWYgQ09ORklHX1NNUA0KIAkJcnEtPnNkID0g
JnNjaGVkX2RvbWFpbl9pbml0Ow0KQEAgLTQxMjMsMTYgKzM3MzcsMTEgQEAg
dm9pZCBfX2luaXQgc2NoZWRfaW5pdCh2b2lkKQ0KIAkJSU5JVF9MSVNUX0hF
QUQoJnJxLT5taWdyYXRpb25fcXVldWUpOw0KICNlbmRpZg0KIAkJYXRvbWlj
X3NldCgmcnEtPm5yX2lvd2FpdCwgMCk7DQotDQotCQlmb3IgKGogPSAwOyBq
IDwgMjsgaisrKSB7DQotCQkJYXJyYXkgPSBycS0+YXJyYXlzICsgajsNCi0J
CQlmb3IgKGsgPSAwOyBrIDwgTUFYX1BSSU87IGsrKykgew0KLQkJCQlJTklU
X0xJU1RfSEVBRChhcnJheS0+cXVldWUgKyBrKTsNCi0JCQkJX19jbGVhcl9i
aXQoaywgYXJyYXktPmJpdG1hcCk7DQotCQkJfQ0KLQkJCS8vIGRlbGltaXRl
ciBmb3IgYml0c2VhcmNoDQotCQkJX19zZXRfYml0KE1BWF9QUklPLCBhcnJh
eS0+Yml0bWFwKTsNCi0JCX0NCisJCWZvciAoaiA9IDA7IGogPD0gTUFYX1BS
SU87IGorKykNCisJCQlJTklUX0xJU1RfSEVBRCgmcnEtPnF1ZXVlW2pdKTsN
CisJCW1lbXNldChycS0+Yml0bWFwLCAwLCBCSVRTX1RPX0xPTkdTKE1BWF9Q
UklPKzEpKnNpemVvZihsb25nKSk7DQorCQkvLyBkZWxpbWl0ZXIgZm9yIGJp
dHNlYXJjaA0KKwkJX19zZXRfYml0KE1BWF9QUklPLCBycS0+Yml0bWFwKTsN
CiAJfQ0KIAkvKg0KIAkgKiBXZSBoYXZlIHRvIGRvIGEgbGl0dGxlIG1hZ2lj
IHRvIGdldCB0aGUgZmlyc3QNCmRpZmYgLU5hdXJwIGxpbnV4LTIuNi43LW1t
MS1uby9rZXJuZWwvc3lzY3RsLmMgbGludXgtMi42LjctbW0xL2tlcm5lbC9z
eXNjdGwuYw0KLS0tIGxpbnV4LTIuNi43LW1tMS1uby9rZXJuZWwvc3lzY3Rs
LmMJMjAwNC0wNi0yMiAwMTozMDoyNi4wMDAwMDAwMDAgKzAzMDANCisrKyBs
aW51eC0yLjYuNy1tbTEva2VybmVsL3N5c2N0bC5jCTIwMDQtMDYtMjIgMDE6
MTA6MjkuMDAwMDAwMDAwICswMzAwDQpAQCAtNjIwLDYgKzYyMCwyMiBAQCBz
dGF0aWMgY3RsX3RhYmxlIGtlcm5fdGFibGVbXSA9IHsNCiAJCS5tb2RlCQk9
IDA0NDQsDQogCQkucHJvY19oYW5kbGVyCT0gJnByb2NfZG9pbnR2ZWMsDQog
CX0sDQorCXsNCisJCS5jdGxfbmFtZQk9IEtFUk5fSU5URVJBQ1RJVkUsDQor
CQkucHJvY25hbWUJPSAiaW50ZXJhY3RpdmUiLA0KKwkJLmRhdGEJCT0gJmlu
dGVyYWN0aXZlLA0KKwkJLm1heGxlbgkJPSBzaXplb2YgKGludCksDQorCQku
bW9kZQkJPSAwNjQ0LA0KKwkJLnByb2NfaGFuZGxlcgk9ICZwcm9jX2RvaW50
dmVjLA0KKwl9LA0KKwl7DQorCQkuY3RsX25hbWUJPSBLRVJOX0NPTVBVVEUs
DQorCQkucHJvY25hbWUJPSAiY29tcHV0ZSIsDQorCQkuZGF0YQkJPSAmY29t
cHV0ZSwNCisJCS5tYXhsZW4JCT0gc2l6ZW9mIChpbnQpLA0KKwkJLm1vZGUJ
CT0gMDY0NCwNCisJCS5wcm9jX2hhbmRsZXIJPSAmcHJvY19kb2ludHZlYywN
CisJfSwNCiAJeyAuY3RsX25hbWUgPSAwIH0NCiB9Ow0KIA0K

---559023410-851401618-1087860325=:20157--
