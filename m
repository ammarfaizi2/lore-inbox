Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264423AbTKMUYX (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 13 Nov 2003 15:24:23 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264424AbTKMUYX
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 13 Nov 2003 15:24:23 -0500
Received: from ida.rowland.org ([192.131.102.52]:51716 "HELO ida.rowland.org")
	by vger.kernel.org with SMTP id S264423AbTKMUYU (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Thu, 13 Nov 2003 15:24:20 -0500
Date: Thu, 13 Nov 2003 15:24:19 -0500 (EST)
From: Alan Stern <stern@rowland.harvard.edu>
X-X-Sender: stern@ida.rowland.org
To: =?iso-8859-1?Q?Rog=E9rio?= Brito <rbrito@ime.usp.br>
cc: linux-usb-devel@lists.sourceforge.net,
       <linux-usb-users@lists.sourceforge.net>, <linux-kernel@vger.kernel.org>
Subject: Re: [linux-usb-devel] [BUG] Still having problems with an USB Drive
In-Reply-To: <20031112204609.GA1009@ime.usp.br>
Message-ID: <Pine.LNX.4.44L0.0311131218050.949-100000@ida.rowland.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, 12 Nov 2003, Rogério Brito wrote:

> 
> Dear developers and other users,
> 
> One week ago, I reported problems with my USB Drive (a Leading Driver
> UD-11), when trying to use it with Linux.
> 
> The problems still persist after many different kernel releases, using
> both kernels from the 2.4 and the 2.6 series.
> 
> Unfortunately, it seems that my messages were ignored after some point,
> but if it is for lack of information, then I would like to know which
> information is needed (I even provided a decoded Oops, but if that is
> not sufficient, please let me know).
> 
> The problems that I have is that, despite all my efforts, the drive is
> only part of the time recognized as a valid block device. About 80% of
> the time, it simply is not recognized as a block device and I see many
> error messages generated by the kernel (see attached dmesg).
> 
> I can use my drive without any problems under both MacOS X and under
> Windows and sometimes under Linux, which leads me to think that it is
> not a problem with the drive itself but only with the kernel.
> 
> Using a 2.6.0-test9 kernel, when my drive is not recognized, I remove
> the drive and then plug it again, I see khub enter the "D" state. From
> there on, if I try to disable the hotplug subsystem (via
> /etc/init.d/hotplug stop), hotplug also becomes ininterruptible.
> 
> If you want to see my earlier messages about the problem, please see:
> http://www.ussg.iu.edu/hypermail/linux/kernel/0311.0/0650.html
> http://www.ussg.iu.edu/hypermail/linux/kernel/0311.0/0652.html
> http://www.ussg.iu.edu/hypermail/linux/kernel/0311.0/0850.html
> http://www.ussg.iu.edu/hypermail/linux/kernel/0311.0/0998.html
> 
> I put here attached both a dmesg after a fresh boot (and the device
> ignored) and a dmesg of the system after I remove and reinsert the USB
> Drive.
> 
> Please, help.
> 
> 
> Thanks in advance, Rogério Brito.

The dmesg files you included and posted don't contain much useful 
information relating to this problem.

Forget about usb-storage and hotplug scripts.  If you can't even get to
the point where your device show up in /proc/bus/usb/devices then nothing
else will work.

Judging from your dmesg output, you have an external hub (ALCOR Generic 
USB Hub) into which your device is plugged.  The device contains an 
internal hub (Leading Driver Co., LTD. USB Embedded Hub) and the drive is 
attached through that internal hub.  But an attempt to communicate with 
the drive failed.  It could be a problem with the external hub, the 
internal hub, or the drive itself; it's not likely to be a problem with 
the kernel.  The error message

	hub 2-2.2:1.0: transfer --> -75

indicates a problem with the internal hub, but there's no way to tell what 
that problem is.  The other error message

	usb 2-2.2.1: control timeout on ep0in

indicates a problem communicating with the drive, but that could be caused 
by the internal hub not working right.

You might try plugging your device directly into the PC to see if that 
makes a difference.  Better yet, try plugging your device into a 
completely different PC running Linux 2.6 and see what happens.

Alan Stern


