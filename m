Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262434AbULOSVE@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262434AbULOSVE (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 15 Dec 2004 13:21:04 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262432AbULOSVE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 15 Dec 2004 13:21:04 -0500
Received: from mail-ex.suse.de ([195.135.220.2]:18848 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S262434AbULOSUj (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 15 Dec 2004 13:20:39 -0500
Date: Wed, 15 Dec 2004 19:20:40 +0100
Message-ID: <s5hbrcvqv7r.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Michael S. Tsirkin" <mst@mellanox.co.il>
Cc: Andi Kleen <ak@suse.de>, linux-kernel@vger.kernel.org, pavel@suse.cz,
       discuss@x86-64.org, gordon.jin@intel.com
Subject: Re: unregister_ioctl32_conversion and modules. ioctl32 revisited.
In-Reply-To: <20041215074635.GC11501@mellanox.co.il>
References: <20041215065650.GM27225@wotan.suse.de>
	<20041215074635.GC11501@mellanox.co.il>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 15 Dec 2004 09:46:35 +0200,
Michael S. Tsirkin wrote:
> 
> There were two additional motivations for my patch:
> 1. Make it possible to avoid the BKL completely by writing
>    an ioctl with proper internal locking.
> 2. As noted by  Juergen Kreileder, the compat hash does not work
>    for ioctls that encode additional information in the command, like this:
> 
> #define EVIOCGBIT(ev,len)  _IOC(_IOC_READ, 'E', 0x20 + ev, len)

I like the idea very well.  Other benifits in addition:

3. Can avoid conflict of ioctls with the same value since the
   convertor is registered locally.

4. Can reject unsupported ioctls for the device (but may be valid for
   other devices) before converting the data - the same reason as
   above.

--
Takashi Iwai <tiwai@suse.de>		ALSA Developer - www.alsa-project.org
