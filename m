Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932197AbWJASym@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932197AbWJASym (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 1 Oct 2006 14:54:42 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932199AbWJASym
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 1 Oct 2006 14:54:42 -0400
Received: from mout2.freenet.de ([194.97.50.155]:18652 "EHLO mout2.freenet.de")
	by vger.kernel.org with ESMTP id S932197AbWJASyk (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 1 Oct 2006 14:54:40 -0400
Date: Sun, 01 Oct 2006 20:55:25 +0200
To: "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
Subject: [PATCH 4/4] 2.6.18-mm2 pktcdvd: sysfs + debugfs interface, bio write congestion handling
Reply-To: balagi@justmail.de
From: "Thomas Maier" <balagi@justmail.de>
Cc: "petero2@telia.com" <petero2@telia.com>, akpm@osdl.org
Content-Type: multipart/mixed; boundary=----------Rm46s5dEblEx1CEmXk26Vb
MIME-Version: 1.0
Message-ID: <op.tgraunhniudtyh@master>
User-Agent: Opera Mail/9.00 (Win32)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------------Rm46s5dEblEx1CEmXk26Vb
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit

Hi,

this patch 4/4 for pktcdvd against Linux 2.6.18 (stable)
or 2.6.18-mm2 adds a sysfs and a debugfs interface. Also it adds
the ability to control the bio write queue of the driver (write
congestion control).
For more infos see the Documentation/* files in the patch.

You must first apply patch 1/4, 2/4 and 3/4 !

Sorry, my mail client damages the patch, so please use the (text) attachment
or get the patch from
http://people.freenet.de/BalaGi/download/4-sysfs-pktcdvd-patch-2.6.18

The merged patch (parts 1 to 4) is available at:
http://people.freenet.de/BalaGi/download/pktcdvd-patch-2.6.18

There is also a tool available to control the pktcdvd driver using
the new sysfs interface:
http://people.freenet.de/BalaGi/download/pktcdvd
http://people.freenet.de/BalaGi#pktcdvd

Signed-off-by: Thomas Maier<balagi@justmail.de>
------------Rm46s5dEblEx1CEmXk26Vb
Content-Disposition: attachment; filename=4-sysfs-pktcdvd-patch-2.6.18
Content-Type: application/octet-stream; name=4-sysfs-pktcdvd-patch-2.6.18
Content-Transfer-Encoding: Base64

ZGlmZiAtdXJwTiBwMy1yZXN0cnVjdC9Eb2N1bWVudGF0aW9uL0FCSS90ZXN0aW5n
L2RlYnVnZnMtcGt0Y2R2ZCBwNC1zeXNmcy9Eb2N1bWVudGF0aW9uL0FCSS90ZXN0
aW5nL2RlYnVnZnMtcGt0Y2R2ZAotLS0gcDMtcmVzdHJ1Y3QvRG9jdW1lbnRhdGlv
bi9BQkkvdGVzdGluZy9kZWJ1Z2ZzLXBrdGNkdmQJMTk3MC0wMS0wMSAwMTowMDow
MC4wMDAwMDAwMDAgKzAxMDAKKysrIHA0LXN5c2ZzL0RvY3VtZW50YXRpb24vQUJJ
L3Rlc3RpbmcvZGVidWdmcy1wa3RjZHZkCTIwMDYtMTAtMDEgMTg6Mjc6MTkuMDAw
MDAwMDAwICswMjAwCkBAIC0wLDAgKzEsMjAgQEAKK1doYXQ6ICAgICAgICAgICAv
ZGVidWcvcGt0Y2R2ZFswLTddCitEYXRlOiAgICAgICAgICAgU2VwLiAyMDA2CitL
ZXJuZWxWZXJzaW9uOiAgMi42LjE5CitDb250YWN0OiAgICAgICAgVGhvbWFzIE1h
aWVyIDxiYWxhZ2lAanVzdG1haWwuZGU+CitEZXNjcmlwdGlvbjoKKworZGVidWdm
cyBpbnRlcmZhY2UKKy0tLS0tLS0tLS0tLS0tLS0tCisKK1RoZSBwa3RjZHZkIG1v
ZHVsZSAocGFja2V0IHdyaXRpbmcgZHJpdmVyKSBjcmVhdGVzCit0aGVzZSBmaWxl
cyBpbiBkZWJ1Z2ZzOgorCisvZGVidWcvcGt0Y2R2ZFswLTddLworICAgIGluZm8g
ICAgICAgICAgICAoMDQ0NCkgTG90cyBvZiBodW1hbiByZWFkYWJsZSBkcml2ZXIK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MgYW5kIGluZm9z
LiBNdWx0aXBsZSBsaW5lcyEKKworRXhhbXBsZToKKy0tLS0tLS0KKworY2F0IC9k
ZWJ1Zy9wa3RjZHZkMy9pbmZvCmRpZmYgLXVycE4gcDMtcmVzdHJ1Y3QvRG9jdW1l
bnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1jbGFzcy1wa3RjZHZkIHA0LXN5c2Zz
L0RvY3VtZW50YXRpb24vQUJJL3Rlc3Rpbmcvc3lzZnMtY2xhc3MtcGt0Y2R2ZAot
LS0gcDMtcmVzdHJ1Y3QvRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1j
bGFzcy1wa3RjZHZkCTE5NzAtMDEtMDEgMDE6MDA6MDAuMDAwMDAwMDAwICswMTAw
CisrKyBwNC1zeXNmcy9Eb2N1bWVudGF0aW9uL0FCSS90ZXN0aW5nL3N5c2ZzLWNs
YXNzLXBrdGNkdmQJMjAwNi0xMC0wMSAxODoyNzoyNS4wMDAwMDAwMDAgKzAyMDAK
QEAgLTAsMCArMSw3OCBAQAorV2hhdDogICAgICAgICAgIC9zeXMvY2xhc3MvcGt0
Y2R2ZC8KK0RhdGU6ICAgICAgICAgICBTZXAuIDIwMDYKK0tlcm5lbFZlcnNpb246
ICAyLjYuMTkKK0NvbnRhY3Q6ICAgICAgICBUaG9tYXMgTWFpZXIgPGJhbGFnaUBq
dXN0bWFpbC5kZT4KK0Rlc2NyaXB0aW9uOgorCitzeXNmcyBpbnRlcmZhY2UKKy0t
LS0tLS0tLS0tLS0tLQorCitUaGUgcGt0Y2R2ZCBtb2R1bGUgKHBhY2tldCB3cml0
aW5nIGRyaXZlcikgY3JlYXRlcwordGhlc2UgZmlsZXMgaW4gdGhlIHN5c2ZzOgor
KDxkZXZpZD4gaXMgaW4gZm9ybWF0ICBtYWpvcjptaW5vciApCisKKy9zeXMvY2xh
c3MvcGt0Y2R2ZC8KKyAgICBhZGQgICAgICAgICAgICAoMDIwMCkgIFdyaXRlIGEg
YmxvY2sgZGV2aWNlIGlkIHRvIGNyZWF0ZSBhCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICBuZXcgcGt0Y2R2ZCBkZXZpY2UgYW5kIG1hcCBpdCB0byB0aGUKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrIGRldmljZS4KKworICAgIHJl
bW92ZSAgICAgICAgICgwMjAwKSAgV3JpdGUgdGhlIHBrdGNkdmQgZGV2aWNlIGlk
IG9yIHRoZQorICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkIGJsb2Nr
IGRldmljZSBpZCB0byBpdCwgdG8KKyAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJlbW92ZSB0aGUgcGt0Y2R2ZCBkZXZpY2UuCisKKyAgICBkZXZpY2VfbWFwICAg
ICAoMDQ0NCkgIFNob3dzIHRoZSBkZXZpY2UgbWFwcGluZyBpbiBmb3JtYXQ6Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrdGNkdmRbMC03XSA8cGt0ZGV2
aWQ+IDxibGtkZXZpZD4KKworICAgIHBhY2tldF9idWZmZXJzICgwNjQ0KSAgTnVt
YmVyIG9mIGNvbmN1cnJlbnQgcGFja2V0cyBwZXIKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBrdGNkdmQgZGV2aWNlLiBVc2VkIGZvciBuZXcgY3JlYXRlZAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcy4KKwkKKy9zeXMvY2xh
c3MvcGt0Y2R2ZC9wa3RjZHZkWzAtN10vCisgICAgZGV2ICAgICAgICAgICAgICAg
ICAgICgwNDQ0KSBEZXZpY2UgaWQKKyAgICB1ZXZlbnQgICAgICAgICAgICAgICAg
KDAyMDApIFRvIHNlbmQgYW4gdWV2ZW50LgorICAgIAorL3N5cy9jbGFzcy9wa3Rj
ZHZkL3BrdGNkdmRbMC03XS9zdGF0LworICAgIHBhY2tldHNfc3RhcnRlZCAgICAg
ICAoMDQ0NCkgTnVtYmVyIG9mIHN0YXJ0ZWQgcGFja2V0cy4KKyAgICBwYWNrZXRz
X2ZpbmlzaGVkICAgICAgKDA0NDQpIE51bWJlciBvZiBmaW5pc2hlZCBwYWNrZXRz
LgorCisgICAga2Jfd3JpdHRlbiAgICAgICAgICAgICgwNDQ0KSBrQnl0ZXMgd3Jp
dHRlbi4KKyAgICBrYl9yZWFkICAgICAgICAgICAgICAgKDA0NDQpIGtCeXRlcyBy
ZWFkLgorICAgIGtiX3JlYWRfZ2F0aGVyICAgICAgICAoMDQ0NCkga0J5dGVzIHJl
YWQgdG8gZmlsbCB3cml0ZSBwYWNrZXRzLgorICAgIAorICAgIHJlc2V0ICAgICAg
ICAgICAgICAgICAoMDIwMCkgV3JpdGUgYW55IHZhbHVlIHRvIGl0IHRvIHJlc2V0
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwa3RjZHZkIGRldmlj
ZSBzdGF0aXN0aWMgdmFsdWVzLCBsaWtlCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBieXRlcyByZWFkL3dyaXR0ZW4uCisgICAgCisvc3lzL2NsYXNz
L3BrdGNkdmQvcGt0Y2R2ZFswLTddL3dyaXRlX3F1ZXVlLworICAgIHNpemUgICAg
ICAgICAgICAgICAgICAoMDQ0NCkgQ29udGFpbnMgdGhlIHNpemUgb2YgdGhlIGJp
byB3cml0ZQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUu
CisKKyAgICBjb25nZXN0aW9uX29mZiAgICAgICAgKDA2NDQpIElmIGJpbyB3cml0
ZSBxdWV1ZSBzaXplIGlzIGJlbG93CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB0aGlzIG1hcmssIGFjY2VwdCBuZXcgYmlvIHJlcXVlc3RzCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIHRoZSBibG9jayBsYXll
ci4KKworICAgIGNvbmdlc3Rpb25fb24gICAgICAgICAoMDY0NCkgSWYgYmlvIHdy
aXRlIHF1ZXVlIHNpemUgaXMgaGlnaGVyCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBhcyB0aGlzIG1hcmssIGRvIG5vIGxvbmdlciBhY2NlcHQKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbyB3cml0ZSByZXF1ZXN0
cyBmcm9tIHRoZSBibG9jaworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbGF5ZXIgYW5kIHdhaXQgdGlsbCB0aGUgcGt0Y2R2ZAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZGV2aWNlIGhhcyBwcm9jZXNzZWQgZW5vdWdo
IGJpbydzCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbyB0aGF0
IGJpbyB3cml0ZSBxdWV1ZSBzaXplIGlzCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBiZWxvdyBjb25nZXN0aW9uIG9mZiBtYXJrLgorCisgCisKK0V4
YW1wbGU6CistLS0tLS0tLQorVG8gdXNlIHRoZSBwa3RjZHZkIHN5c2ZzIGludGVy
ZmFjZSBkaXJlY3RseSwgeW91IGNhbiBkbzoKKworIyBjcmVhdGUgYSBuZXcgcGt0
Y2R2ZCBkZXZpY2UgbWFwcGVkIHRvIC9kZXYvaGRjCitlY2hvICIyMjowIiA+L3N5
cy9jbGFzcy9wa3RjZHZkL2FkZAorY2F0IC9zeXMvY2xhc3MvcGt0Y2R2ZC9kZXZp
Y2VfbWFwCisjIGFzc3VtaW5nIGRldmljZSBwa3RjZHZkMCB3YXMgY3JlYXRlZCwg
bG9vayBhdCBzdGF0J3MKK2NhdCAvc3lzL2NsYXNzL3BrdGNkdmQvcGt0Y2R2ZDAv
c3RhdC9rYl93cml0dGVuCisjIHByaW50IHRoZSBkZXZpY2UgaWQgb2YgdGhlIG1h
cHBlZCBibG9jayBkZXZpY2UKK2ZncmVwIHBrdGNkdmQwIC9zeXMvY2xhc3MvcGt0
Y2R2ZC9kZXZpY2VfbWFwCisjIHJlbW92ZSBkZXZpY2UsIHVzaW5nIHBrdGNkdmQw
IGRldmljZSBpZCAgIDI1MzowCitlY2hvICIyNTM6MCIgPi9zeXMvY2xhc3MvcGt0
Y2R2ZC9yZW1vdmUKKyMgc2FtZSBhcyB1c2luZyB0aGUgbWFwcGVkIGJsb2NrIGRl
dmljZSBpZCAgMjI6MAorZWNobyAiMjI6MCIgPi9zeXMvY2xhc3MvcGt0Y2R2ZC9y
ZW1vdmUKZGlmZiAtdXJwTiBwMy1yZXN0cnVjdC9Eb2N1bWVudGF0aW9uL2Nkcm9t
L3BhY2tldC13cml0aW5nLnR4dCBwNC1zeXNmcy9Eb2N1bWVudGF0aW9uL2Nkcm9t
L3BhY2tldC13cml0aW5nLnR4dAotLS0gcDMtcmVzdHJ1Y3QvRG9jdW1lbnRhdGlv
bi9jZHJvbS9wYWNrZXQtd3JpdGluZy50eHQJMjAwNi0xMC0wMSAxNjo0MTo0NS4w
MDAwMDAwMDAgKzAyMDAKKysrIHA0LXN5c2ZzL0RvY3VtZW50YXRpb24vY2Ryb20v
cGFja2V0LXdyaXRpbmcudHh0CTIwMDYtMTAtMDEgMTg6MjY6MjYuMDAwMDAwMDAw
ICswMjAwCkBAIC0xLDEzICsxLDE1IEBACiBHZXR0aW5nIHN0YXJ0ZWQgcXVpY2sK
IC0tLS0tLS0tLS0tLS0tLS0tLS0tLQogCi0tIFNlbGVjdCBwYWNrZXQgc3VwcG9y
dCBpbiB0aGUgYmxvY2sgZGV2aWNlIHNlY3Rpb24gYW5kIFVERiBzdXBwb3J0IGlu
Ci0gIHRoZSBmaWxlIHN5c3RlbSBzZWN0aW9uLgorLSBTZWxlY3QgcGFja2V0IHN1
cHBvcnQgaW4gdGhlIGJsb2NrIGRldmljZSBzZWN0aW9uIChhbmQgZW5hYmxlCisg
IHRoZSBwa3RjZHZkIHByb2NmcyBpbnRlcmZhY2UpIGFuZCBVREYgc3VwcG9ydCBp
biB0aGUgZmlsZQorICBzeXN0ZW0gc2VjdGlvbi4KIAogLSBDb21waWxlIGFuZCBp
bnN0YWxsIGtlcm5lbCBhbmQgbW9kdWxlcywgcmVib290LgogCiAtIFlvdSBuZWVk
IHRoZSB1ZGZ0b29scyBwYWNrYWdlIChwa3RzZXR1cCwgbWt1ZGZmcywgY2Ryd3Rv
b2wpLgogICBEb3dubG9hZCBmcm9tIGh0dHA6Ly9zb3VyY2Vmb3JnZS5uZXQvcHJv
amVjdHMvbGludXgtdWRmLworICBOb3RlOiBwa3RzZXR1cCBuZWVkcyB0aGUgcGt0
Y2R2ZCBwcm9jZnMgaW50ZXJmYWNlIQogCiAtIEdyYWIgYSBuZXcgQ0QtUlcgZGlz
YyBhbmQgZm9ybWF0IGl0IChhc3N1bWluZyBDRC1SVyBpcyBoZGMsIHN1YnN0aXR1
dGUKICAgYXMgYXBwcm9wcmlhdGUpOgpAQCAtOTAsNiArOTIsNTkgQEAgTm90ZXMK
ICAgdG8gY3JlYXRlIGFuIGV4dDIgZmlsZXN5c3RlbSBvbiB0aGUgZGlzYy4KIAog
CisKK1VzaW5nIHRoZSBwa3RjZHZkIHN5c2ZzIGludGVyZmFjZQorLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKK1RoZSBwa3RjZHZkIG1vZHVsZSBo
YXMgYSBzeXNmcyBpbnRlcmZhY2UgYW5kIGNhbiBiZSBjb250cm9sbGVkCitieSB0
aGUgdG9vbCAicGt0Y2R2ZCIgdGhhdCB1c2VzIHN5c2ZzLgorKHNlZSBodHRwOi8v
cGVvcGxlLmZyZWVuZXQuZGUvQmFsYUdpI3BrdGNkdmQgKQorCisicGt0Y2R2ZCIg
d29ya3Mgc2ltaWxhciB0byAicGt0c2V0dXAiLCBlLmcuOgorCisJIyBwa3RjZHZk
IC1hIGRldl9uYW1lIC9kZXYvaGRjCisJIyBta3VkZmZzIC9kZXYvcGt0Y2R2ZC9k
ZXZfbmFtZQorCSMgbW91bnQgLXQgdWRmIC1vIHJ3LG5vYXRpbWUgL2Rldi9wa3Rj
ZHZkL2Rldl9uYW1lIC9kdmRyYW0KKwkjIGNwIGZpbGVzIC9kdmRyYW0KKwkjIHVt
b3VudCAvZHZkcmFtCisJIyBwa3RjZHZkIC1yIGRldl9uYW1lCisKKworRm9yIGEg
ZGVzY3JpcHRpb24gb2YgdGhlIHN5c2ZzIGludGVyZmFjZSBsb29rIGludG8gdGhl
IGZpbGU6CisKKyAgRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1ibG9j
ay1wa3RjZHZkCisKKworVXNpbmcgdGhlIHBrdGNkdmQgZGVidWdmcyBpbnRlcmZh
Y2UKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKK1RvIHJl
YWQgcGt0Y2R2ZCBkZXZpY2UgaW5mb3MgaW4gaHVtYW4gcmVhZGFibGUgZm9ybSwg
ZG86CisKKwkjIGNhdCAvZGVidWcvcGt0Y2R2ZFswLTddL2luZm8KKworRm9yIGEg
ZGVzY3JpcHRpb24gb2YgdGhlIGRlYnVnZnMgaW50ZXJmYWNlIGxvb2sgaW50byB0
aGUgZmlsZToKKworICBEb2N1bWVudGF0aW9uL0FCSS90ZXN0aW5nL2RlYnVnZnMt
cGt0Y2R2ZAorCisKKworQmlvIHdyaXRlIHF1ZXVlIGNvbmdlc3Rpb24gbWFya3MK
Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCitUaGUgcGt0Y2R2ZCBk
cml2ZXIgYWxsb3dzIG5vdyB0byBhZGp1c3QgdGhlIGJlaGF2aW91ciBvZiB0aGUK
K2ludGVybmFsIGJpbyB3cml0ZSBxdWV1ZS4KK1RoaXMgY2FuIGJlIGRvbmUgd2l0
aCB0aGUgdHdvIHdyaXRlX2Nvbmdlc3Rpb25fW29ufG9mZl0gbWFya3MuCitUaGUg
ZHJpdmVyIGRvZXMgb25seSBhY2NlcHQgdXAgdG8gd3JpdGVfY29uZ2VzdGlvbl9v
biBiaW8KK3dyaXRlIHJlcXVlc3QgZnJvbSB0aGUgaS9vIGJsb2NrIGxheWVyLCBh
bmQgd2FpdHMgdGlsbCB0aGUKK3JlcXVlc3RzIGFyZSBwcm9jZXNzZWQgYnkgdGhl
IG1hcHBlZCBibG9jayBkZXZpY2UgYW5kCit0aGUgcXVldWUgc2l6ZSBpcyBiZWxv
dyB0aGUgd3JpdGVfY29uZ2VzdGlvbl9vZmYgbWFyay4KK0luIHByZXZpb3VzIHZl
cnNpb25zIG9mIHBrdGNkdmQsIHRoZSBkcml2ZXIgYWNjZXB0ZWQgYWxsCitpbmNv
bWluZyBiaW8gd3JpdGUgcmVxdWVzdC4gVGhpcyBsZWQgc29tZXRpbWVzIHRvIGtl
cm5lbAorb3V0IG9mIG1lbW9yeSBvb3BzIChtYXliZSBzb21lIGJ1Z3MgaW4gdGhl
IGxpbnV4IGtlcm5lbCA7KQorQ0FVVElPTjogdXNlIHRoaXMgb3B0aW9ucyBvbmx5
IGlmIHlvdSBrbm93IHdoYXQgeW91IGRvIQorVGhlIGRlZmF1bHQgc2V0dGluZ3Mg
Zm9yIHRoZSBjb25nZXN0aW9uIG1hcmtzIHNob3VsZCBiZSBvaworZm9yIGV2ZXJ5
b25lLgorCSAgICAgICAgICAgICAgICAgCisgIAogTGlua3MKIC0tLS0tCiAKZGlm
ZiAtdXJwTiBwMy1yZXN0cnVjdC9kcml2ZXJzL2Jsb2NrL0tjb25maWcgcDQtc3lz
ZnMvZHJpdmVycy9ibG9jay9LY29uZmlnCi0tLSBwMy1yZXN0cnVjdC9kcml2ZXJz
L2Jsb2NrL0tjb25maWcJMjAwNi0xMC0wMSAxNjo0MTo0NS4wMDAwMDAwMDAgKzAy
MDAKKysrIHA0LXN5c2ZzL2RyaXZlcnMvYmxvY2svS2NvbmZpZwkyMDA2LTEwLTAx
IDE5OjAxOjAxLjAwMDAwMDAwMCArMDIwMApAQCAtNDI4LDE3ICs0MjgsMjIgQEAg
Y29uZmlnIENEUk9NX1BLVENEVkQKIAl0cmlzdGF0ZSAiUGFja2V0IHdyaXRpbmcg
b24gQ0QvRFZEIG1lZGlhIgogCWRlcGVuZHMgb24gIVVNTAogCWhlbHAKLQkgIElm
IHlvdSBoYXZlIGEgQ0RST00gZHJpdmUgdGhhdCBzdXBwb3J0cyBwYWNrZXQgd3Jp
dGluZywgc2F5IFkgdG8KLQkgIGluY2x1ZGUgcHJlbGltaW5hcnkgc3VwcG9ydC4g
SXQgc2hvdWxkIHdvcmsgd2l0aCBhbnkgTU1DL010IEZ1amkKLQkgIGNvbXBsaWFu
dCBBVEFQSSBvciBTQ1NJIGRyaXZlLCB3aGljaCBpcyBqdXN0IGFib3V0IGFueSBu
ZXdlciBDRAotCSAgd3JpdGVyLgorCSAgSWYgeW91IGhhdmUgYSBDRFJPTS9EVkQg
ZHJpdmUgdGhhdCBzdXBwb3J0cyBwYWNrZXQgd3JpdGluZywgc2F5CisJICBZIHRv
IGluY2x1ZGUgcHJlbGltaW5hcnkgc3VwcG9ydC4gSXQgc2hvdWxkIHdvcmsgd2l0
aCBhbnkKKwkgIE1NQy9NdCBGdWppIGNvbXBsaWFudCBBVEFQSSBvciBTQ1NJIGRy
aXZlLCB3aGljaCBpcyBqdXN0IGFib3V0CisJICBhbnkgbmV3ZXIgRFZEL0NEIHdy
aXRlci4KIAotCSAgQ3VycmVudGx5IG9ubHkgd3JpdGluZyB0byBDRC1SVywgRFZE
LVJXIGFuZCBEVkQrUlcgZGlzY3MgaXMgcG9zc2libGUuCisJICBDdXJyZW50bHkg
b25seSB3cml0aW5nIHRvIENELVJXLCBEVkQtUlcsIERWRCtSVyBhbmQgRFZEUkFN
IGRpc2NzCisJICBpcyBwb3NzaWJsZS4KIAkgIERWRC1SVyBkaXNrcyBtdXN0IGJl
IGluIHJlc3RyaWN0ZWQgb3ZlcndyaXRlIG1vZGUuCiAKIAkgIFRvIGNvbXBpbGUg
dGhpcyBkcml2ZXIgYXMgYSBtb2R1bGUsIGNob29zZSBNIGhlcmU6IHRoZQogCSAg
bW9kdWxlIHdpbGwgYmUgY2FsbGVkIHBrdGNkdmQuCiAKKwkgIEZvciBmdXJ0aGVy
IGluZm9ybWF0aW9uIHNlZSB0aGUgZmlsZQorCisJICAgIERvY3VtZW50YXRpb24v
Y2Ryb20vcGFja2V0LXdyaXRpbmcudHh0CisJICAKIGNvbmZpZyBDRFJPTV9QS1RD
RFZEX0JVRkZFUlMKIAlpbnQgIkZyZWUgYnVmZmVycyBmb3IgZGF0YSBnYXRoZXJp
bmciCiAJZGVwZW5kcyBvbiBDRFJPTV9QS1RDRFZECmRpZmYgLXVycE4gcDMtcmVz
dHJ1Y3QvZHJpdmVycy9ibG9jay9wa3RjZHZkLmMgcDQtc3lzZnMvZHJpdmVycy9i
bG9jay9wa3RjZHZkLmMKLS0tIHAzLXJlc3RydWN0L2RyaXZlcnMvYmxvY2svcGt0
Y2R2ZC5jCTIwMDYtMTAtMDEgMTk6MTg6MDUuMDAwMDAwMDAwICswMjAwCisrKyBw
NC1zeXNmcy9kcml2ZXJzL2Jsb2NrL3BrdGNkdmQuYwkyMDA2LTEwLTAxIDE5OjE5
OjI3LjAwMDAwMDAwMCArMDIwMApAQCAtNTgsNiArNTgsOCBAQAogI2luY2x1ZGUg
PHNjc2kvc2NzaV9jbW5kLmg+CiAjaW5jbHVkZSA8c2NzaS9zY3NpX2lvY3RsLmg+
CiAjaW5jbHVkZSA8c2NzaS9zY3NpLmg+CisjaW5jbHVkZSA8bGludXgvZGVidWdm
cy5oPgorI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgogCiAjaWYgUEtUX1VTRV9Q
Uk9DRlMKICNpbmNsdWRlIDxsaW51eC9wcm9jX2ZzLmg+CkBAIC04NiwxMiArODgs
MTcgQEAKIAogLyogbW9kdWxlIHBhcmFtZXRlcnMgKi8KIHN0YXRpYyBpbnQgcGt0
ZGV2X21ham9yID0gMDsgLyogZGVmYXVsdDogZHluYW1pYyBtYWpvciBudW1iZXIg
Ki8KLQorc3RhdGljIGludCB3cml0ZV9jb25nZXN0aW9uX29uICA9IFBLVF9XUklU
RV9DT05HRVNUSU9OX09OOworc3RhdGljIGludCB3cml0ZV9jb25nZXN0aW9uX29m
ZiA9IFBLVF9XUklURV9DT05HRVNUSU9OX09GRjsKK3N0YXRpYyBpbnQgcGFja2V0
X2J1ZmZlcnMgPSBQS1RfQlVGRkVSU19ERUZBVUxUOwogCiBzdGF0aWMgc3RydWN0
IHBrdGNkdmRfZGV2aWNlICpwa3RfZGV2c1tNQVhfV1JJVEVSU107CiBzdGF0aWMg
c3RydWN0IG11dGV4IGN0bF9tdXRleDsJLyogU2VyaWFsaXplIG9wZW4vY2xvc2Uv
c2V0dXAvdGVhcmRvd24gKi8KIHN0YXRpYyBtZW1wb29sX3QgKnBzZF9wb29sOwog
CitzdGF0aWMgc3RydWN0IGNsYXNzCSpjbGFzc19wa3RjZHZkID0gTlVMTDsKK3N0
YXRpYyBzdHJ1Y3QgZGVudHJ5CSpwa3RfZGVidWdmc19yb290ID0gTlVMTDsKKwog
CiAvKiBmb3J3YXJkIGRlY2xhcmF0aW9uICovCiBzdGF0aWMgaW50IHBrdF9zZXR1
cF9kZXYoZGV2X3QgZGV2LCBkZXZfdCogcGt0X2Rldik7CkBAIC0xNDEsNiArMTQ4
LDMxIEBAIHN0YXRpYyBzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBrdF9maW5kX2QK
IAlyZXR1cm4gTlVMTDsKIH0KIAorc3RhdGljIHZvaWQgaW5pdF9jb25nZXN0aW9u
KGludCogbG8sIGludCogaGkpCit7CisJaWYgKCpoaSA+IDApIHsKKwkJKmhpID0g
bWF4KCpoaSwgUEtUX1dSSVRFX0NPTkdFU1RJT05fTUlOKTsKKwkJKmhpID0gbWlu
KCpoaSwgUEtUX1dSSVRFX0NPTkdFU1RJT05fTUFYKTsKKwkJaWYgKCpsbyA8PSAw
KQorCQkJKmxvID0gKmhpIC0gUEtUX1dSSVRFX0NPTkdFU1RJT05fVEhSRVNIT0xE
OworCQllbHNlIHsKKwkJCSpsbyA9IG1pbigqbG8sICpoaSAtIFBLVF9XUklURV9D
T05HRVNUSU9OX1RIUkVTSE9MRCk7CisJCQkqbG8gPSBtYXgoKmxvLCBQS1RfV1JJ
VEVfQ09OR0VTVElPTl9NSU4vNCk7CisJCX0KKwl9IGVsc2UgeworCQkqaGkgPSAt
MTsKKwkJKmxvID0gLTE7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbml0X3BhY2tl
dF9idWZmZXJzKGludCAqbikKK3sKKwlpZiAoKm4gPCAxKQorCQkqbiA9IDE7CisJ
ZWxzZSBpZiAoKm4gPiAxMjgpCisJCSpuID0gMTI4OworfQorCiBzdGF0aWMgdm9p
ZCBwa3RfY291bnRfc3RhdGVzKHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQsIGlu
dCAqc3RhdGVzKQogewogCXN0cnVjdCBwYWNrZXRfZGF0YSAqcGt0OwpAQCAtMTg5
LDYgKzIyMSw3IEBAIHN0YXRpYyBpbnQgcGt0X3ByaW50X2luZm8oc3RydWN0IHBr
dGNkdmQKIAllbHNlCiAJCW1zZyA9ICJVbmtub3duIjsKIAlQUklOVChCQywgIlx0
YmxvY2sgbW9kZTpcdFx0JXNcbiIsIG1zZyk7CisJUFJJTlQoQkMsICJcdGNvbmN1
cnJlbnQgcGFja2V0czpcdCVkXG4iLCBwYWNrZXRfYnVmZmVycyk7CiAKIAlQUklO
VChCQywgIlxuU3RhdGlzdGljczpcbiIpOwogCVBSSU5UKEJDLCAiXHRwYWNrZXRz
IHN0YXJ0ZWQ6XHQlbHVcbiIsIHBkLT5zdGF0cy5wa3Rfc3RhcnRlZCk7CkBAIC0y
MTQsMTIgKzI0Nyw0MTUgQEAgc3RhdGljIGludCBwa3RfcHJpbnRfaW5mbyhzdHJ1
Y3QgcGt0Y2R2ZAogCXBrdF9jb3VudF9zdGF0ZXMocGQsIHN0YXRlcyk7CiAJUFJJ
TlQoQkMsICJcdHN0YXRlOlx0XHRcdGk6JWQgb3c6JWQgcnc6JWQgd3c6JWQgcmVj
OiVkIGZpbjolZFxuIiwKIAkgICAgICBzdGF0ZXNbMF0sIHN0YXRlc1sxXSwgc3Rh
dGVzWzJdLCBzdGF0ZXNbM10sIHN0YXRlc1s0XSwgc3RhdGVzWzVdKTsKKwkJICAg
CisJUFJJTlQoQkMsICJcdHdyaXRlIGNvbmdlc3Rpb24gbWFya3M6XHRvZmY9JWQg
b249JWRcbiIsCisJCQlwZC0+d3JpdGVfY29uZ2VzdGlvbl9vZmYsCisJCQlwZC0+
d3JpdGVfY29uZ2VzdGlvbl9vbik7CiAjdW5kZWYgUFJJTlQKICN1bmRlZiBCQwog
CWJ1ZltibGVuLTFdID0gMDsKIAlyZXR1cm4gbjsKIH0KIAorc3RhdGljIHN0cnVj
dCBwa3RjZHZkX2Rldl9rb2JqKiBwa3Rfa29ial9jcmVhdGUoc3RydWN0IHBrdGNk
dmRfZGV2aWNlICpwZCwKKwkJCQljb25zdCBjaGFyKiBuYW1lLAorCQkJCXN0cnVj
dCBrb2JqZWN0KiBwYXJlbnQsCisJCQkJc3RydWN0IGtvYmpfdHlwZSoga3R5cGUp
Cit7CisJc3RydWN0IHBrdGNkdmRfZGV2X2tvYmogKnA7CisJcCA9IGt6YWxsb2Mo
c2l6ZW9mKCpwKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwKQorCQlyZXR1cm4gTlVM
TDsKKwlrb2JqZWN0X3NldF9uYW1lKCZwLT5rb2JqLCAiJXMiLCBuYW1lKTsKKwlw
LT5rb2JqLnBhcmVudCA9IHBhcmVudDsKKwlwLT5rb2JqLmt0eXBlID0ga3R5cGU7
CisJcC0+cGQgPSBwZDsKKwlpZiAoa29iamVjdF9yZWdpc3RlcigmcC0+a29iaikg
IT0gMCkKKwkJcmV0dXJuIE5VTEw7CisJcmV0dXJuIHA7Cit9CitzdGF0aWMgdm9p
ZCBwa3Rfa29ial9yZW1vdmUoc3RydWN0IHBrdGNkdmRfZGV2X2tvYmogKnApCit7
CisJaWYgKHApCisJCWtvYmplY3RfdW5yZWdpc3RlcigmcC0+a29iaik7Cit9Citz
dGF0aWMgdm9pZCBwa3Rfa29ial9yZWxlYXNlKHN0cnVjdCBrb2JqZWN0ICprb2Jq
KQoreworCWtmcmVlKHRvX3BrdGRldmtvYmooa29iaikpOworfQorLyoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioKKyAqCisgKiBzeXNmcyBpbnRlcmZhY2UgZm9yIHBrdGNkdmQKKyAqIGJ5IChD
KSAyMDA2ICBUaG9tYXMgTWFpZXIgPGJhbGFnaUBqdXN0bWFpbC5kZT4KKyAqCisg
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKi8KKworI2RlZmluZSBERUZfQVRUUihfb2JqLF9uYW1lLF9tb2Rl
KSBcCisJc3RhdGljIHN0cnVjdCBhdHRyaWJ1dGUgX29iaiA9IHsgXAorCQkubmFt
ZSA9IF9uYW1lLCAub3duZXIgPSBUSElTX01PRFVMRSwgLm1vZGUgPSBfbW9kZSB9
CisKKy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqCisgIC9zeXMvY2xhc3MvcGt0Y2R2ZC9wa3RjZHZkWzAt
N10vCisgICAgICAgICAgICAgICAgICAgICB3cml0ZV9xdWV1ZS9zaXplCisgICAg
ICAgICAgICAgICAgICAgICB3cml0ZV9xdWV1ZS9jb25nZXN0aW9uX29mZgorICAg
ICAgICAgICAgICAgICAgICAgd3JpdGVfcXVldWUvY29uZ2VzdGlvbl9vbgorICAg
ICAgICAgICAgICAgICAgICAgc3RhdC9yZXNldAorICAgICAgICAgICAgICAgICAg
ICAgc3RhdC9wYWNrZXRzX3N0YXJ0ZWQKKyAgICAgICAgICAgICAgICAgICAgIHN0
YXQvcGFja2V0c19maW5pc2hlZAorICAgICAgICAgICAgICAgICAgICAgc3RhdC9r
Yl93cml0dGVuCisgICAgICAgICAgICAgICAgICAgICBzdGF0L2tiX3JlYWQKKyAg
ICAgICAgICAgICAgICAgICAgIHN0YXQva2JfcmVhZF9nYXRoZXIKKyAqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqLworCitERUZfQVRUUihrb2JqX3BrdF9hdHRyX3dxMSwgInNpemUiLCAwNDQ0
KTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfd3EyLCAiY29uZ2VzdGlvbl9vZmYi
LCAwNjQ0KTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfd3EzLCAiY29uZ2VzdGlv
bl9vbiIsICAwNjQ0KTsKKworc3RhdGljIHN0cnVjdCBhdHRyaWJ1dGUgKmtvYmpf
cGt0X2F0dHJzX3dxdWV1ZVtdID0geworCSZrb2JqX3BrdF9hdHRyX3dxMSwKKwkm
a29ial9wa3RfYXR0cl93cTIsCisJJmtvYmpfcGt0X2F0dHJfd3EzLAorCU5VTEwK
K307CisKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3QxLCAicmVzZXQiLCAwMjAw
KTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3QyLCAicGFja2V0c19zdGFydGVk
IiwgMDQ0NCk7CitERUZfQVRUUihrb2JqX3BrdF9hdHRyX3N0MywgInBhY2tldHNf
ZmluaXNoZWQiLCAwNDQ0KTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3Q0LCAi
a2Jfd3JpdHRlbiIsIDA0NDQpOworREVGX0FUVFIoa29ial9wa3RfYXR0cl9zdDUs
ICJrYl9yZWFkIiwgMDQ0NCk7CitERUZfQVRUUihrb2JqX3BrdF9hdHRyX3N0Niwg
ImtiX3JlYWRfZ2F0aGVyIiwgMDQ0NCk7CisKK3N0YXRpYyBzdHJ1Y3QgYXR0cmli
dXRlICprb2JqX3BrdF9hdHRyc19zdGF0W10gPSB7CisJJmtvYmpfcGt0X2F0dHJf
c3QxLAorCSZrb2JqX3BrdF9hdHRyX3N0MiwKKwkma29ial9wa3RfYXR0cl9zdDMs
CisJJmtvYmpfcGt0X2F0dHJfc3Q0LAorCSZrb2JqX3BrdF9hdHRyX3N0NSwKKwkm
a29ial9wa3RfYXR0cl9zdDYsCisJTlVMTAorfTsKKworCisjZGVmaW5lIERFQ0xB
UkVfQlVGX0FTX1NUUklORyhfZGJ1ZiwgX2IsIF9sKSBcCisJY2hhciBfZGJ1Zls2
NF07IGludCBkbGVuID0gKF9sKSA8IDAgPyAwIDogKF9sKTsgXAorCWlmIChkbGVu
ID49IHNpemVvZihfZGJ1ZikpIGRsZW4gPSBzaXplb2YoX2RidWYpLTE7IFwKKwlt
ZW1jcHkoX2RidWYsIF9iLCBkbGVuKTsgX2RidWZbZGxlbl0gPSAwCisJCisKK3N0
YXRpYyBzc2l6ZV90IGtvYmpfcGt0X3Nob3coc3RydWN0IGtvYmplY3QgKmtvYmos
CisJCQlzdHJ1Y3QgYXR0cmlidXRlICphdHRyLCBjaGFyICpkYXRhKQoreworCXN0
cnVjdCBwa3RjZHZkX2RldmljZSAqcGQ7CisJaW50IG4gPSAwOworCWludCB2Owor
CisJZGF0YVswXSA9IDA7CisJcGQgPSB0b19wa3RkZXZrb2JqKGtvYmopLT5wZDsK
KworCWlmIChzdHJjbXAoYXR0ci0+bmFtZSwgInBhY2tldHNfc3RhcnRlZCIpID09
IDApIHsKKwkJbiA9IHNwcmludGYoZGF0YSwgIiVsdVxuIiwgcGQtPnN0YXRzLnBr
dF9zdGFydGVkKTsKKworCX0gZWxzZSBpZiAoc3RyY21wKGF0dHItPm5hbWUsICJw
YWNrZXRzX2ZpbmlzaGVkIikgPT0gMCkgeworCQluID0gc3ByaW50ZihkYXRhLCAi
JWx1XG4iLCBwZC0+c3RhdHMucGt0X2VuZGVkKTsKKworCX0gZWxzZSBpZiAoc3Ry
Y21wKGF0dHItPm5hbWUsICJrYl93cml0dGVuIikgPT0gMCkgeworCQluID0gc3By
aW50ZihkYXRhLCAiJWx1XG4iLCBwZC0+c3RhdHMuc2Vjc193ID4+IDEpOworCisJ
fSBlbHNlIGlmIChzdHJjbXAoYXR0ci0+bmFtZSwgImtiX3JlYWQiKSA9PSAwKSB7
CisJCW4gPSBzcHJpbnRmKGRhdGEsICIlbHVcbiIsIHBkLT5zdGF0cy5zZWNzX3Ig
Pj4gMSk7CisKKwl9IGVsc2UgaWYgKHN0cmNtcChhdHRyLT5uYW1lLCAia2JfcmVh
ZF9nYXRoZXIiKSA9PSAwKSB7CisJCW4gPSBzcHJpbnRmKGRhdGEsICIlbHVcbiIs
IHBkLT5zdGF0cy5zZWNzX3JnID4+IDEpOworCQorCX0gZWxzZSBpZiAoc3RyY21w
KGF0dHItPm5hbWUsICJzaXplIikgPT0gMCkgeworCQlzcGluX2xvY2soJnBkLT5s
b2NrKTsKKwkJdiA9IHBkLT5iaW9fcXVldWVfc2l6ZTsKKwkJc3Bpbl91bmxvY2so
JnBkLT5sb2NrKTsKKwkJbiA9IHNwcmludGYoZGF0YSwgIiVkXG4iLCB2KTsKKwkJ
CisJfSBlbHNlIGlmIChzdHJjbXAoYXR0ci0+bmFtZSwgImNvbmdlc3Rpb25fb2Zm
IikgPT0gMCkgeworCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKKwkJdiA9IHBkLT53
cml0ZV9jb25nZXN0aW9uX29mZjsKKwkJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsK
KwkJbiA9IHNwcmludGYoZGF0YSwgIiVkXG4iLCB2KTsKKworCX0gZWxzZSBpZiAo
c3RyY21wKGF0dHItPm5hbWUsICJjb25nZXN0aW9uX29uIikgPT0gMCkgeworCQlz
cGluX2xvY2soJnBkLT5sb2NrKTsKKwkJdiA9IHBkLT53cml0ZV9jb25nZXN0aW9u
X29uOworCQlzcGluX3VubG9jaygmcGQtPmxvY2spOworCQluID0gc3ByaW50Zihk
YXRhLCAiJWRcbiIsIHYpOworCX0KKwlyZXR1cm4gbjsKK30KKworc3RhdGljIHNz
aXplX3Qga29ial9wa3Rfc3RvcmUoc3RydWN0IGtvYmplY3QgKmtvYmosCisJCQlz
dHJ1Y3QgYXR0cmlidXRlICphdHRyLAorCQkJY29uc3QgY2hhciAqZGF0YSwgc2l6
ZV90IGxlbikKK3sKKwlpbnQgdmFsOworCXN0cnVjdCBwa3RjZHZkX2RldmljZSAq
cGQ7CisJREVDTEFSRV9CVUZfQVNfU1RSSU5HKGRidWYsIGRhdGEsIGxlbik7CisK
KwlwZCA9IHRvX3BrdGRldmtvYmooa29iaiktPnBkOworCisJaWYgKHN0cmNtcChh
dHRyLT5uYW1lLCAicmVzZXQiKSA9PSAwICYmIGRsZW4gPiAwKSB7CisJCXBkLT5z
dGF0cy5wa3Rfc3RhcnRlZCA9IDA7CisJCXBkLT5zdGF0cy5wa3RfZW5kZWQgPSAw
OworCQlwZC0+c3RhdHMuc2Vjc193ID0gMDsKKwkJcGQtPnN0YXRzLnNlY3Nfcmcg
PSAwOworCQlwZC0+c3RhdHMuc2Vjc19yID0gMDsKKwkJCisJfSBlbHNlIGlmIChz
dHJjbXAoYXR0ci0+bmFtZSwgImNvbmdlc3Rpb25fb2ZmIikgPT0gMAorCQkgICAm
JiBzc2NhbmYoZGJ1ZiwgIiVkIiwgJnZhbCkgPT0gMSkgeworCQlzcGluX2xvY2so
JnBkLT5sb2NrKTsKKwkJcGQtPndyaXRlX2Nvbmdlc3Rpb25fb2ZmID0gdmFsOwor
CQlpbml0X2Nvbmdlc3Rpb24oJnBkLT53cml0ZV9jb25nZXN0aW9uX29mZiwKKwkJ
CQkmcGQtPndyaXRlX2Nvbmdlc3Rpb25fb24pOworCQlzcGluX3VubG9jaygmcGQt
PmxvY2spOworCX0gZWxzZSBpZiAoc3RyY21wKGF0dHItPm5hbWUsICJjb25nZXN0
aW9uX29uIikgPT0gMAorCQkgICAmJiBzc2NhbmYoZGJ1ZiwgIiVkIiwgJnZhbCkg
PT0gMSkgeworCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKKwkJcGQtPndyaXRlX2Nv
bmdlc3Rpb25fb24gPSB2YWw7CisJCWluaXRfY29uZ2VzdGlvbigmcGQtPndyaXRl
X2Nvbmdlc3Rpb25fb2ZmLAorCQkJCSZwZC0+d3JpdGVfY29uZ2VzdGlvbl9vbik7
CisJCXNwaW5fdW5sb2NrKCZwZC0+bG9jayk7CisJfQorCisJcmV0dXJuIGxlbjsK
K30KKworc3RhdGljIHN0cnVjdCBzeXNmc19vcHMga29ial9wa3Rfb3BzID0gewor
CS5zaG93ID0ga29ial9wa3Rfc2hvdywKKwkuc3RvcmUgPSBrb2JqX3BrdF9zdG9y
ZQorfTsKK3N0YXRpYyBzdHJ1Y3Qga29ial90eXBlIGtvYmpfcGt0X3R5cGVfc3Rh
dCA9IHsKKwkucmVsZWFzZSA9IHBrdF9rb2JqX3JlbGVhc2UsCisJLnN5c2ZzX29w
cyA9ICZrb2JqX3BrdF9vcHMsCisJLmRlZmF1bHRfYXR0cnMgPSBrb2JqX3BrdF9h
dHRyc19zdGF0Cit9Oworc3RhdGljIHN0cnVjdCBrb2JqX3R5cGUga29ial9wa3Rf
dHlwZV93cXVldWUgPSB7CisJLnJlbGVhc2UgPSBwa3Rfa29ial9yZWxlYXNlLAor
CS5zeXNmc19vcHMgPSAma29ial9wa3Rfb3BzLAorCS5kZWZhdWx0X2F0dHJzID0g
a29ial9wa3RfYXR0cnNfd3F1ZXVlCit9OworCisKK3N0YXRpYyB2b2lkIHBrdF9z
eXNmc19kZXZfbmV3KHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQpCit7CisJaWYg
KGNsYXNzX3BrdGNkdmQpIHsKKwkJcGQtPmNsc2RldiA9IGNsYXNzX2RldmljZV9j
cmVhdGUoY2xhc3NfcGt0Y2R2ZCwKKwkJCQkJTlVMTCwgcGQtPnBrdF9kZXYsCisJ
CQkJCU5VTEwsICIlcyIsIHBkLT5uYW1lKTsKKwkJaWYgKElTX0VSUihwZC0+Y2xz
ZGV2KSkKKwkJCXBkLT5jbHNkZXYgPSBOVUxMOworCX0KKwlpZiAocGQtPmNsc2Rl
dikgeworCQlwZC0+a29ial9zdGF0ID0gcGt0X2tvYmpfY3JlYXRlKHBkLCAic3Rh
dCIsCisJCQkJCSZwZC0+Y2xzZGV2LT5rb2JqLAorCQkJCQkma29ial9wa3RfdHlw
ZV9zdGF0KTsKKwkJcGQtPmtvYmpfd3F1ZXVlID0gcGt0X2tvYmpfY3JlYXRlKHBk
LCAid3JpdGVfcXVldWUiLAorCQkJCQkmcGQtPmNsc2Rldi0+a29iaiwKKwkJCQkJ
JmtvYmpfcGt0X3R5cGVfd3F1ZXVlKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIHBr
dF9zeXNmc19kZXZfcmVtb3ZlKHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQpCit7
CisJcGt0X2tvYmpfcmVtb3ZlKHBkLT5rb2JqX3N0YXQpOworCXBrdF9rb2JqX3Jl
bW92ZShwZC0+a29ial93cXVldWUpOworCWlmIChjbGFzc19wa3RjZHZkKQorCQlj
bGFzc19kZXZpY2VfZGVzdHJveShjbGFzc19wa3RjZHZkLCBwZC0+cGt0X2Rldik7
Cit9CisKKworLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCisgIC9zeXMvY2xhc3MvcGt0
Y2R2ZC8KKyAgICAgICAgICAgICAgICAgICAgIGFkZCAgICAgICAgICAgIG1hcCBi
bG9jayBkZXZpY2UKKyAgICAgICAgICAgICAgICAgICAgIHJlbW92ZSAgICAgICAg
IHVubWFwIHBhY2tldCBkZXYKKyAgICAgICAgICAgICAgICAgICAgIGRldmljZV9t
YXAgICAgIHNob3cgbWFwcGluZ3MKKyAgICAgICAgICAgICAgICAgICAgIHBhY2tl
dF9idWZmZXJzIG51bWJlciBvZiBwYWNrZXQgYnVmZmVycyBwZXIgZGV2CisgKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKi8KKworc3RhdGljIHZvaWQgY2xhc3NfcGt0Y2R2ZF9y
ZWxlYXNlKHN0cnVjdCBjbGFzcyAqY2xzKQoreworCWtmcmVlKGNscyk7Cit9Citz
dGF0aWMgc3NpemVfdCBjbGFzc19wa3RjZHZkX3Nob3dfbWFwKHN0cnVjdCBjbGFz
cyAqYywgY2hhciAqZGF0YSkKK3sKKwlpbnQgbiA9IDA7CisJaW50IGlkeDsKKwlk
YXRhWzBdID0gMDsKKwltdXRleF9sb2NrX25lc3RlZCgmY3RsX211dGV4LCBTSU5H
TEVfREVQVEhfTkVTVElORyk7CisJZm9yIChpZHggPSAwOyBpZHggPCBNQVhfV1JJ
VEVSUzsgaWR4KyspIHsKKwkJc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCA9IHBr
dF9kZXZzW2lkeF07CisJCWlmICghcGQpCisJCQljb250aW51ZTsKKwkJbiArPSBz
cHJpbnRmKGRhdGErbiwgIiVzICV1OiV1ICV1OiV1XG4iLAorCQkJcGQtPm5hbWUs
CisJCQlNQUpPUihwZC0+cGt0X2RldiksIE1JTk9SKHBkLT5wa3RfZGV2KSwKKwkJ
CU1BSk9SKHBkLT5iZGV2LT5iZF9kZXYpLAorCQkJTUlOT1IocGQtPmJkZXYtPmJk
X2RldikpOworCX0KKwltdXRleF91bmxvY2soJmN0bF9tdXRleCk7CisJcmV0dXJu
IG47Cit9CitzdGF0aWMgc3NpemVfdCBjbGFzc19wa3RjZHZkX3Nob3dfcGIoc3Ry
dWN0IGNsYXNzICpjLCBjaGFyICpkYXRhKQoreworCXJldHVybiBzcHJpbnRmKGRh
dGEsICIlZFxuIiwgcGFja2V0X2J1ZmZlcnMpOworfQorCQorc3RhdGljIHNzaXpl
X3QgY2xhc3NfcGt0Y2R2ZF9zdG9yZV9hZGQoc3RydWN0IGNsYXNzICpjLCBjb25z
dCBjaGFyICpidWYsCisJCQkJCXNpemVfdCBjb3VudCkKK3sKKwl1bnNpZ25lZCBp
bnQgbWFqb3IsIG1pbm9yOworCURFQ0xBUkVfQlVGX0FTX1NUUklORyhkYnVmLCBi
dWYsIGNvdW50KTsKKwlpZiAoc3NjYW5mKGRidWYsICIldToldSIsICZtYWpvciwg
Jm1pbm9yKSA9PSAyKSB7CisJCXBrdF9zZXR1cF9kZXYoTUtERVYobWFqb3IsIG1p
bm9yKSwgTlVMTCk7CisJCXJldHVybiBjb3VudDsKKwl9CisJcmV0dXJuIC1FSU5W
QUw7Cit9CitzdGF0aWMgc3NpemVfdCBjbGFzc19wa3RjZHZkX3N0b3JlX3JlbW92
ZShzdHJ1Y3QgY2xhc3MgKmMsIGNvbnN0IGNoYXIgKmJ1ZiwKKwkJCQkJc2l6ZV90
IGNvdW50KQoreworCXVuc2lnbmVkIGludCBtYWpvciwgbWlub3I7CisJREVDTEFS
RV9CVUZfQVNfU1RSSU5HKGRidWYsIGJ1ZiwgY291bnQpOworCWlmIChzc2NhbmYo
ZGJ1ZiwgIiV1OiV1IiwgJm1ham9yLCAmbWlub3IpID09IDIpIHsKKwkJcGt0X3Jl
bW92ZV9kZXYoTUtERVYobWFqb3IsIG1pbm9yKSk7CisJCXJldHVybiBjb3VudDsK
Kwl9CisJcmV0dXJuIC1FSU5WQUw7Cit9CitzdGF0aWMgc3NpemVfdCBjbGFzc19w
a3RjZHZkX3N0b3JlX3BiKHN0cnVjdCBjbGFzcyAqYywgY29uc3QgY2hhciAqYnVm
LAorCQkJCQlzaXplX3QgY291bnQpCit7CisJaW50IHZhbDsKKwlERUNMQVJFX0JV
Rl9BU19TVFJJTkcoZGJ1ZiwgYnVmLCBjb3VudCk7CisJaWYgKHNzY2FuZihkYnVm
LCAiJWQiLCAmdmFsKSA9PSAxKSB7CisJCW11dGV4X2xvY2tfbmVzdGVkKCZjdGxf
bXV0ZXgsIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKKwkJaW5pdF9wYWNrZXRfYnVm
ZmVycygmdmFsKTsKKwkJcGFja2V0X2J1ZmZlcnMgPSB2YWw7CisJCW11dGV4X3Vu
bG9jaygmY3RsX211dGV4KTsKKwkJcmV0dXJuIGNvdW50OworCX0KKwlyZXR1cm4g
LUVJTlZBTDsKK30KKworc3RhdGljIHN0cnVjdCBjbGFzc19hdHRyaWJ1dGUgY2xh
c3NfcGt0Y2R2ZF9hdHRyc1tdID0geworIF9fQVRUUihhZGQsICAgICAgICAgICAg
MDIwMCwgTlVMTCwgY2xhc3NfcGt0Y2R2ZF9zdG9yZV9hZGQpLAorIF9fQVRUUihy
ZW1vdmUsICAgICAgICAgMDIwMCwgTlVMTCwgY2xhc3NfcGt0Y2R2ZF9zdG9yZV9y
ZW1vdmUpLAorIF9fQVRUUihkZXZpY2VfbWFwLCAgICAgMDQ0NCwgY2xhc3NfcGt0
Y2R2ZF9zaG93X21hcCwgTlVMTCksCisgX19BVFRSKHBhY2tldF9idWZmZXJzLCAw
NjQ0LCBjbGFzc19wa3RjZHZkX3Nob3dfcGIsIGNsYXNzX3BrdGNkdmRfc3RvcmVf
cGIpLAorIF9fQVRUUl9OVUxMCit9OworCisKK3N0YXRpYyBpbnQgcGt0X3N5c2Zz
X2luaXQodm9pZCkKK3sKKwlpbnQgcmV0ID0gMDsKKwkKKwkvKgorCSAqIGNyZWF0
ZSBjb250cm9sIGZpbGVzIGluIHN5c2ZzCisJICogL3N5cy9jbGFzcy9wa3RjZHZk
Ly4uLgorCSAqLworCWNsYXNzX3BrdGNkdmQgPSBremFsbG9jKHNpemVvZigqY2xh
c3NfcGt0Y2R2ZCksIEdGUF9LRVJORUwpOworCWlmICghY2xhc3NfcGt0Y2R2ZCkK
KwkJcmV0dXJuIC1FTk9NRU07CisJY2xhc3NfcGt0Y2R2ZC0+bmFtZSA9IERSSVZF
Ul9OQU1FOworCWNsYXNzX3BrdGNkdmQtPm93bmVyID0gVEhJU19NT0RVTEU7CisJ
Y2xhc3NfcGt0Y2R2ZC0+Y2xhc3NfcmVsZWFzZSA9IGNsYXNzX3BrdGNkdmRfcmVs
ZWFzZTsKKwljbGFzc19wa3RjZHZkLT5jbGFzc19hdHRycyA9IGNsYXNzX3BrdGNk
dmRfYXR0cnM7CisJcmV0ID0gY2xhc3NfcmVnaXN0ZXIoY2xhc3NfcGt0Y2R2ZCk7
CisJaWYgKHJldCkgeworCQlrZnJlZShjbGFzc19wa3RjZHZkKTsKKwkJY2xhc3Nf
cGt0Y2R2ZCA9IE5VTEw7CisJCXByaW50ayhEUklWRVJfTkFNRSI6IGZhaWxlZCB0
byBjcmVhdGUgY2xhc3MgcGt0Y2R2ZFxuIik7CisJCXJldHVybiByZXQ7CisJfQor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBwa3Rfc3lzZnNfY2xlYW51cCh2
b2lkKQoreworCWlmIChjbGFzc19wa3RjZHZkKQorCQljbGFzc19kZXN0cm95KGNs
YXNzX3BrdGNkdmQpOworCWNsYXNzX3BrdGNkdmQgPSBOVUxMOworfQorCisvKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioKKyAgZW50cmllcyBpbiBkZWJ1Z2ZzCisKKyAgL2Rl
YnVnZnMvcGt0Y2R2ZFswLTddLworCQkJaW5mbworICAKKyAqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqLworc3RhdGljIGludCBwa3RfZGVidWdmc19zZXFfc2hvdyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKnApCit7CisJc3RydWN0IHBrdGNkdmRfZGV2aWNl
ICpwZCA9IG0tPnByaXZhdGU7CisJY2hhciBidWZbMTAyNF07CisJCisJcGt0X3By
aW50X2luZm8ocGQsIGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCXNlcV9wcmludGYobSwg
IiVzIiwgYnVmKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBwa3RfZGVi
dWdmc19mb3BzX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUg
KmZpbGUpCit7CisJcmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIHBrdF9kZWJ1Z2Zz
X3NlcV9zaG93LCBpbm9kZS0+dS5nZW5lcmljX2lwKTsKK30KKworc3RhdGljIHN0
cnVjdCBmaWxlX29wZXJhdGlvbnMgZGVidWdfZm9wcyA9IHsKKwkub3BlbgkJPSBw
a3RfZGVidWdmc19mb3BzX29wZW4sCisJLnJlYWQJCT0gc2VxX3JlYWQsCisJLmxs
c2VlawkJPSBzZXFfbHNlZWssCisJLnJlbGVhc2UJPSBzaW5nbGVfcmVsZWFzZSwK
Kwkub3duZXIJCT0gVEhJU19NT0RVTEUsCit9OworIAorc3RhdGljIHZvaWQgcGt0
X2RlYnVnZnNfZGV2X25ldyhzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkKQorewor
CWlmICghcGt0X2RlYnVnZnNfcm9vdCkKKwkJcmV0dXJuOworCXBkLT5kZnNfZF9y
b290ID0gZGVidWdmc19jcmVhdGVfZGlyKHBkLT5uYW1lLCBwa3RfZGVidWdmc19y
b290KTsKKwlpZiAoSVNfRVJSKHBkLT5kZnNfZF9yb290KSkgeworCQlwZC0+ZGZz
X2Rfcm9vdCA9IE5VTEw7CisJCXJldHVybjsKKwl9CisJcGQtPmRmc19mX2luZm8g
PSBkZWJ1Z2ZzX2NyZWF0ZV9maWxlKCJpbmZvIiwgU19JUlVHTywKKwkJCQlwZC0+
ZGZzX2Rfcm9vdCwgcGQsICZkZWJ1Z19mb3BzKTsKKwlpZiAoSVNfRVJSKHBkLT5k
ZnNfZl9pbmZvKSkgeworCQlwZC0+ZGZzX2ZfaW5mbyA9IE5VTEw7CisJCXJldHVy
bjsKKwl9Cit9CitzdGF0aWMgdm9pZCBwa3RfZGVidWdmc19kZXZfcmVtb3ZlKHN0
cnVjdCBwa3RjZHZkX2RldmljZSAqcGQpCit7CisJaWYgKCFwa3RfZGVidWdmc19y
b290KQorCQlyZXR1cm47CisJaWYgKHBkLT5kZnNfZl9pbmZvKQorCQlkZWJ1Z2Zz
X3JlbW92ZShwZC0+ZGZzX2ZfaW5mbyk7CisJcGQtPmRmc19mX2luZm8gPSBOVUxM
OworCWlmIChwZC0+ZGZzX2Rfcm9vdCkKKwkJZGVidWdmc19yZW1vdmUocGQtPmRm
c19kX3Jvb3QpOworCXBkLT5kZnNfZF9yb290ID0gTlVMTDsKK30KK3N0YXRpYyB2
b2lkIHBrdF9kZWJ1Z2ZzX2luaXQodm9pZCkKK3sKKwlwa3RfZGVidWdmc19yb290
ID0gZGVidWdmc19jcmVhdGVfZGlyKERSSVZFUl9OQU1FLCBOVUxMKTsKKwlpZiAo
SVNfRVJSKHBrdF9kZWJ1Z2ZzX3Jvb3QpKSB7CisJCXBrdF9kZWJ1Z2ZzX3Jvb3Qg
PSBOVUxMOworCQlyZXR1cm47CisJfQorfQorc3RhdGljIHZvaWQgcGt0X2RlYnVn
ZnNfY2xlYW51cCh2b2lkKQoreworCWlmICghcGt0X2RlYnVnZnNfcm9vdCkKKwkJ
cmV0dXJuOworCWRlYnVnZnNfcmVtb3ZlKHBrdF9kZWJ1Z2ZzX3Jvb3QpOworCXBr
dF9kZWJ1Z2ZzX3Jvb3QgPSBOVUxMOworfQorCisKIC8qKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICoKICAq
IChvbGQpIHByb2NmcyBpbnRlcmZhY2UKQEAgLTExMzMsNiArMTU2OSw3IEBAIHN0
YXRpYyBpbnQgcGt0X2hhbmRsZV9xdWV1ZShzdHJ1Y3QgcGt0Y2QKIAlzZWN0b3Jf
dCB6b25lID0gMDsgLyogU3VwcHJlc3MgZ2NjIHdhcm5pbmcgKi8KIAlzdHJ1Y3Qg
cGt0X3JiX25vZGUgKm5vZGUsICpmaXJzdF9ub2RlOwogCXN0cnVjdCByYl9ub2Rl
ICpuOworCWludCB3YWtldXA7CiAKIAlWUFJJTlRLKCJoYW5kbGVfcXVldWVcbiIp
OwogCkBAIC0xMjA1LDcgKzE2NDIsMTQgQEAgdHJ5X25leHRfYmlvOgogCQlwa3Qt
PndyaXRlX3NpemUgKz0gYmlvLT5iaV9zaXplIC8gQ0RfRlJBTUVTSVpFOwogCQlz
cGluX3VubG9jaygmcGt0LT5sb2NrKTsKIAl9CisJLyogY2hlY2sgd3JpdGUgY29u
Z2VzdGlvbiBtYXJrcywgYW5kIGlmIGJpb19xdWV1ZV9zaXplIGlzCisJICAgYmVs
b3csIHdha2UgdXAgYW55IHdhaXRlcnMgKi8KKwl3YWtldXAgPSAocGQtPndyaXRl
X2Nvbmdlc3Rpb25fb24gPiAwCisJIAkJJiYgcGQtPmJpb19xdWV1ZV9zaXplIDw9
IHBkLT53cml0ZV9jb25nZXN0aW9uX29mZgorCQkJJiYgd2FpdHF1ZXVlX2FjdGl2
ZSgmcGQtPndyaXRlX2Nvbmdlc3Rpb25fd3F1ZXVlKSk7CiAJc3Bpbl91bmxvY2so
JnBkLT5sb2NrKTsKKwlpZiAod2FrZXVwKQorCQl3YWtlX3VwKCZwZC0+d3JpdGVf
Y29uZ2VzdGlvbl93cXVldWUpOwogCiAJcGt0LT5zbGVlcF90aW1lID0gbWF4KFBB
Q0tFVF9XQUlUX1RJTUUsIDEpOwogCXBrdF9zZXRfc3RhdGUocGt0LCBQQUNLRVRf
V0FJVElOR19TVEFURSk7CkBAIC0yMjUwLDYgKzI2OTQsMzIgQEAgc3RhdGljIGlu
dCBwa3RfbWFrZV9yZXF1ZXN0KHJlcXVlc3RfcXVldQogCXNwaW5fdW5sb2NrKCZw
ZC0+Y2Rydy5hY3RpdmVfbGlzdF9sb2NrKTsKIAogCS8qCisJICogVGVzdCBpZiB0
aGVyZSBpcyBlbm91Z2ggcm9vbSBsZWZ0IGluIHRoZSBiaW8gd29yayBxdWV1ZQor
CSAqIChxdWV1ZSBzaXplID49IGNvbmdlc3Rpb24gb24gbWFyaykuCisJICogSWYg
bm90LCB3YWl0IHRpbGwgdGhlIHdvcmsgcXVldWUgc2l6ZSBpcyBiZWxvdyB0aGUg
Y29uZ2VzdGlvbiBvZmYgbWFyay4KKwkgKiBUaGlzIGlzIHNpbWlsYXIgdG8gdGhl
IGdldF9yZXF1ZXN0X3dhaXQoKSBjYWxsIG1hZGUgaW4gdGhlIGJsb2NrCisJICog
bGF5ZXIgZnVuY3Rpb24gX19tYWtlX3JlcXVlc3QoKSB1c2VkIGZvciBub3JtYWwg
YmxvY2sgaS9vIHJlcXVlc3QKKwkgKiBoYW5kbGluZy4KKwkgKi8KKwlzcGluX2xv
Y2soJnBkLT5sb2NrKTsKKwlpZiAocGQtPndyaXRlX2Nvbmdlc3Rpb25fb24gPiAw
CisJICAgICAmJiBwZC0+YmlvX3F1ZXVlX3NpemUgPj0gcGQtPndyaXRlX2Nvbmdl
c3Rpb25fb24pIHsKKwkJREVGSU5FX1dBSVQod2FpdCk7CisJCS8qIHdhaXQgdGls
bCBudW1iZXIgb2YgYmlvIHJlcXVlc3RzIGlzIGxvdyBlbm91Z2ggKi8KKwkJZG8g
eworCQkJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKKwkJCXByZXBhcmVfdG9fd2Fp
dF9leGNsdXNpdmUoJnBkLT53cml0ZV9jb25nZXN0aW9uX3dxdWV1ZSwKKwkJCQkJ
JndhaXQsIFRBU0tfVU5JTlRFUlJVUFRJQkxFKTsKKwkJCWlvX3NjaGVkdWxlKCk7
CisJCQkvKiBpZiB3ZSBhcmUgaGVyZSwgYmlvX3F1ZXVlX3NpemUgc2hvdWxkIGJl
IGJlbG93CisJCQkgICBjb25nZXN0aW9uX29mZiwgYnV0IGJlIHN1cmUgYW5kIGRv
IGEgdGVzdCAqLworCQkJc3Bpbl9sb2NrKCZwZC0+bG9jayk7CisJCX0gd2hpbGUo
cGQtPmJpb19xdWV1ZV9zaXplID4gcGQtPndyaXRlX2Nvbmdlc3Rpb25fb2ZmKTsK
KwkJZmluaXNoX3dhaXQoJnBkLT53cml0ZV9jb25nZXN0aW9uX3dxdWV1ZSwgJndh
aXQpOworCX0KKwlzcGluX3VubG9jaygmcGQtPmxvY2spOworCisJLyoKIAkgKiBO
byBtYXRjaGluZyBwYWNrZXQgZm91bmQuIFN0b3JlIHRoZSBiaW8gaW4gdGhlIHdv
cmsgcXVldWUuCiAJICovCiAJbm9kZSA9IG1lbXBvb2xfYWxsb2MocGQtPnJiX3Bv
b2wsIEdGUF9OT0lPKTsKQEAgLTIzNTEsNyArMjgyMSw3IEBAIHN0YXRpYyBpbnQg
cGt0X29wZW5fZGV2KHN0cnVjdCBwa3RjZHZkX2QKIAkJZ290byBvdXRfdW5jbGFp
bTsKIAogCWlmICh3cml0ZSkgewotCQlpZiAoIXBrdF9ncm93X3BrdGxpc3QocGQs
IENPTkZJR19DRFJPTV9QS1RDRFZEX0JVRkZFUlMpKSB7CisJCWlmICghcGt0X2dy
b3dfcGt0bGlzdChwZCwgcGFja2V0X2J1ZmZlcnMpKSB7CiAJCQlwcmludGsoRFJJ
VkVSX05BTUUiOiBub3QgZW5vdWdoIG1lbW9yeSBmb3IgYnVmZmVyc1xuIik7CiAJ
CQlyZXQgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfdW5jbGFpbTsKQEAgLTI1NzAs
NiArMzA0MCwxNSBAQCBzdGF0aWMgaW50IHBrdF9uZXdfZGV2KHN0cnVjdCBwa3Rj
ZHZkX2RlCiAJLyogVGhpcyBpcyBzYWZlLCBzaW5jZSB3ZSBoYXZlIGEgcmVmZXJl
bmNlIGZyb20gb3BlbigpLiAqLwogCV9fbW9kdWxlX2dldChUSElTX01PRFVMRSk7
CiAKKwkvKiB0aGUgYmxvY2sgZGV2aWNlIG11c3QgaGF2ZSBhIHF1ZXVlICEgZWxz
ZSBtYW55IG9mIHRoZQorCSAgIHBrdGNkdmQgY29kZSBicmVha3MuICovCisJaWYg
KCFiZGV2X2dldF9xdWV1ZShiZGV2KSkgeworCQlwcmludGsoRFJJVkVSX05BTUUi
OiBibG9jayBkZXZpY2UgJXMgaGFzIG5vIHJlcXVlc3QgcXVldWUsIGFib3J0aW5n
XG4iLAorCQkJYmRldm5hbWUoYmRldiwgYikpOworCQlyZXQgPSAtRU5YSU87CisJ
CWdvdG8gb3V0X21lbTsKKwl9CisKIAlwZC0+YmRldiA9IGJkZXY7CiAJc2V0X2Js
b2Nrc2l6ZShiZGV2LCBDRF9GUkFNRVNJWkUpOwogCkBAIC0yNjQzLDYgKzMxMjIs
MTAgQEAgc3RhdGljIGludCBwa3Rfc2V0dXBfZGV2KGRldl90IGRldiwgZGV2Xwog
CWluaXRfd2FpdHF1ZXVlX2hlYWQoJnBkLT53cXVldWUpOwogCXBkLT5iaW9fcXVl
dWUgPSBSQl9ST09UOwogCisJaW5pdF93YWl0cXVldWVfaGVhZCgmcGQtPndyaXRl
X2Nvbmdlc3Rpb25fd3F1ZXVlKTsKKwlwZC0+d3JpdGVfY29uZ2VzdGlvbl9vbiAg
PSB3cml0ZV9jb25nZXN0aW9uX29uOworCXBkLT53cml0ZV9jb25nZXN0aW9uX29m
ZiA9IHdyaXRlX2Nvbmdlc3Rpb25fb2ZmOworCiAJZGlzayA9IGFsbG9jX2Rpc2so
MSk7CiAJaWYgKCFkaXNrKQogCQlnb3RvIG91dF9tZW07CkBAIC0yNjY0LDEwICsz
MTQ3LDE0IEBAIHN0YXRpYyBpbnQgcGt0X3NldHVwX2RldihkZXZfdCBkZXYsIGRl
dl8KIAogCWFkZF9kaXNrKGRpc2spOwogCQorCXBrdF9zeXNmc19kZXZfbmV3KHBk
KTsKKwogCXBrdF9kZXZzW2lkeF0gPSBwZDsKIAlpZiAocGt0X2RldikKIAkJKnBr
dF9kZXYgPSBwZC0+cGt0X2RldjsKIAorCXBrdF9kZWJ1Z2ZzX2Rldl9uZXcocGQp
OworCQogCW11dGV4X3VubG9jaygmY3RsX211dGV4KTsKIAlyZXR1cm4gMDsKIApA
QCAtMjcxNiw2ICszMjAzLDEwIEBAIHN0YXRpYyBpbnQgcGt0X3JlbW92ZV9kZXYo
ZGV2X3QgcGt0X2RldikKIAkKIAlwa3RfZGV2c1tpZHhdID0gTlVMTDsKIAkKKwlw
a3RfZGVidWdmc19kZXZfcmVtb3ZlKHBkKTsKKworCXBrdF9zeXNmc19kZXZfcmVt
b3ZlKHBkKTsKKwkKIAlibGtkZXZfcHV0KHBkLT5iZGV2KTsKIAogI2lmIFBLVF9V
U0VfUFJPQ0ZTCkBAIC0yNzQ4LDYgKzMyMzksMTAgQEAgc3RhdGljIGludCBfX2lu
aXQgcGt0X2luaXQodm9pZCkKIHsKIAlpbnQgcmV0OwogCisJLyogY2hlY2sgbW9k
dWxlIHBhcmFtZXRlcnMgKi8KKwlpbml0X2Nvbmdlc3Rpb24oJndyaXRlX2Nvbmdl
c3Rpb25fb2ZmLCAmd3JpdGVfY29uZ2VzdGlvbl9vbik7CisJaW5pdF9wYWNrZXRf
YnVmZmVycygmcGFja2V0X2J1ZmZlcnMpOworCiAJbXV0ZXhfaW5pdCgmY3RsX211
dGV4KTsKIAogCXBzZF9wb29sID0gbWVtcG9vbF9jcmVhdGVfa21hbGxvY19wb29s
KFBTRF9QT09MX1NJWkUsCkBAIC0yNzYzLDE3ICszMjU4LDI2IEBAIHN0YXRpYyBp
bnQgX19pbml0IHBrdF9pbml0KHZvaWQpCiAJaWYgKCFwa3RkZXZfbWFqb3IpCiAJ
CXBrdGRldl9tYWpvciA9IHJldDsKIAorCXJldCA9IHBrdF9zeXNmc19pbml0KCk7
CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKICNpZiBQS1RfVVNFX1BST0NGUwog
CXJldCA9IG1pc2NfcmVnaXN0ZXIoJnBrdF9taXNjKTsKIAlpZiAocmV0KSB7CiAJ
CXByaW50ayhEUklWRVJfTkFNRSI6IFVuYWJsZSB0byByZWdpc3RlciBtaXNjIGRl
dmljZVxuIik7Ci0JCWdvdG8gb3V0OworCQlnb3RvIG91dF9taXNjOwogCX0KIAlw
a3RfcHJvYyA9IHByb2NfbWtkaXIoRFJJVkVSX05BTUUsIHByb2Nfcm9vdF9kcml2
ZXIpOwogI2VuZGlmCi0KKwlwa3RfZGVidWdmc19pbml0KCk7CiAJcmV0dXJuIDA7
CiAKKyNpZiBQS1RfVVNFX1BST0NGUworb3V0X21pc2M6CisJY2xhc3NfZGVzdHJv
eShjbGFzc19wa3RjZHZkKTsKKwljbGFzc19wa3RjZHZkID0gTlVMTDsKKyNlbmRp
Zgogb3V0OgogCXVucmVnaXN0ZXJfYmxrZGV2KHBrdGRldl9tYWpvciwgRFJJVkVS
X05BTUUpOwogb3V0MjoKQEAgLTI3ODMsNiArMzI4Nyw5IEBAIG91dDI6CiAKIHN0
YXRpYyB2b2lkIF9fZXhpdCBwa3RfZXhpdCh2b2lkKQogeworCXBrdF9kZWJ1Z2Zz
X2NsZWFudXAoKTsKKwlwa3Rfc3lzZnNfY2xlYW51cCgpOworCQogI2lmIFBLVF9V
U0VfUFJPQ0ZTCiAJcmVtb3ZlX3Byb2NfZW50cnkoRFJJVkVSX05BTUUsIHByb2Nf
cm9vdF9kcml2ZXIpOwogCW1pc2NfZGVyZWdpc3RlcigmcGt0X21pc2MpOwpAQCAt
Mjc5MSw2ICszMjk4LDEwIEBAIHN0YXRpYyB2b2lkIF9fZXhpdCBwa3RfZXhpdCh2
b2lkKQogCW1lbXBvb2xfZGVzdHJveShwc2RfcG9vbCk7CiB9CiAKKy8qKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioKKyAqIG1vZHVsZSBkZWNsYXJhdGlvbgorICoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
LworCiBNT0RVTEVfREVTQ1JJUFRJT04oIlBhY2tldCB3cml0aW5nIGxheWVyIGZv
ciBDRC9EVkQgZHJpdmVzIik7CiBNT0RVTEVfQVVUSE9SKCJKZW5zIEF4Ym9lIDxh
eGJvZUBzdXNlLmRlPixQZXRlciBPc3Rlcmx1bmQgPHBldGVybzJAdGVsaWEuY29t
PiwiCiAgICAgICAgICAgICAgICJUaG9tYXMgTWFpZXIgPGJhbGFnaUBqdXN0bWFp
bC5kZT4iKTsKQEAgLTI4MDAsMyArMzMxMSw2IEBAIG1vZHVsZV9pbml0KHBrdF9p
bml0KTsKIG1vZHVsZV9leGl0KHBrdF9leGl0KTsKIAogbW9kdWxlX3BhcmFtKHBr
dGRldl9tYWpvciwgaW50LCAwKTsKK21vZHVsZV9wYXJhbSh3cml0ZV9jb25nZXN0
aW9uX29uLCBpbnQsIDApOworbW9kdWxlX3BhcmFtKHdyaXRlX2Nvbmdlc3Rpb25f
b2ZmLCBpbnQsIDApOworbW9kdWxlX3BhcmFtKHBhY2tldF9idWZmZXJzLCBpbnQs
IDApOwpkaWZmIC11cnBOIHAzLXJlc3RydWN0L2luY2x1ZGUvbGludXgvcGt0Y2R2
ZC5oIHA0LXN5c2ZzL2luY2x1ZGUvbGludXgvcGt0Y2R2ZC5oCi0tLSBwMy1yZXN0
cnVjdC9pbmNsdWRlL2xpbnV4L3BrdGNkdmQuaAkyMDA2LTEwLTAxIDE3OjQ1OjUy
LjAwMDAwMDAwMCArMDIwMAorKysgcDQtc3lzZnMvaW5jbHVkZS9saW51eC9wa3Rj
ZHZkLmgJMjAwNi0xMC0wMSAxNzo1ODo0Ni4wMDAwMDAwMDAgKzAyMDAKQEAgLTEs
NiArMSw3IEBACiAvKgogICogQ29weXJpZ2h0IChDKSAyMDAwIEplbnMgQXhib2Ug
PGF4Ym9lQHN1c2UuZGU+CiAgKiBDb3B5cmlnaHQgKEMpIDIwMDEtMjAwNCBQZXRl
ciBPc3Rlcmx1bmQgPHBldGVybzJAdGVsaWEuY29tPgorICogQ29weXJpZ2h0IChD
KSAyMDA2IFRob21hcyBNYWllciA8YmFsYWdpQGp1c3RtYWlsLmRlPgogICoKICAq
IE1heSBiZSBjb3BpZWQgb3IgbW9kaWZpZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRo
ZSBHTlUgR2VuZXJhbCBQdWJsaWMKICAqIExpY2Vuc2UuICBTZWUgbGludXgvQ09Q
WUlORyBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KQEAgLTM5LDEwICs0MCwxMiBAQCBz
dHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCB7CiAgKiBkZWZpbmVzIGFuZCBzdHJ1Y3Rz
IHVzZWQgaW4gdGhlIGtlcm5lbCBvbmx5CiAgKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKi8KICNpZmRlZiBfX0tFUk5FTF9fCisjaW5jbHVkZSA8bGludXgvY29uZmln
Lmg+CiAjaW5jbHVkZSA8bGludXgvYmxrZGV2Lmg+CiAjaW5jbHVkZSA8bGludXgv
Y29tcGxldGlvbi5oPgogI2luY2x1ZGUgPGxpbnV4L2Nkcm9tLmg+Ci0KKyNpbmNs
dWRlIDxsaW51eC9rb2JqZWN0Lmg+CisjaW5jbHVkZSA8bGludXgvc3lzZnMuaD4K
IAogLyoKICAqIDEgZm9yIG5vcm1hbCBkZWJ1ZyBtZXNzYWdlcywgMiBpcyB2ZXJ5
IHZlcmJvc2UuIDAgdG8gdHVybiBpdCBvZmYuCkBAIC03Niw2ICs3OSwyMCBAQCBz
dHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCB7CiAjZGVmaW5lIFBLVF9VU0VfUFJPQ0ZT
ICAwCiAjZW5kaWYKIAorLyogdXNlIGNvbmN1cnJlbnQgcGFja2V0cyBwZXIgZGV2
aWNlICovCisjaWZkZWYgQ09ORklHX0NEUk9NX1BLVENEVkRfQlVGRkVSUworI2Rl
ZmluZSBQS1RfQlVGRkVSU19ERUZBVUxUIENPTkZJR19DRFJPTV9QS1RDRFZEX0JV
RkZFUlMKKyNlbHNlCisjZGVmaW5lIFBLVF9CVUZGRVJTX0RFRkFVTFQgOAorI2Vu
ZGlmCisKKy8qIGRlZmF1bHQgYmlvIHdyaXRlIHF1ZXVlIGNvbmdlc3Rpb24gbWFy
a3MgKi8KKyNkZWZpbmUgUEtUX1dSSVRFX0NPTkdFU1RJT05fT04gNTAwMAorI2Rl
ZmluZSBQS1RfV1JJVEVfQ09OR0VTVElPTl9PRkYgNDUwMAorI2RlZmluZSBQS1Rf
V1JJVEVfQ09OR0VTVElPTl9NQVggKDEwMjQqMTAyNCkKKyNkZWZpbmUgUEtUX1dS
SVRFX0NPTkdFU1RJT05fTUlOIDEwMAorI2RlZmluZSBQS1RfV1JJVEVfQ09OR0VT
VElPTl9USFJFU0hPTEQgMjUKKwogCiAvKgogICogZGV2aWNlIHR5cGVzCkBAIC0y
NTEsNiArMjY4LDE1IEBAIHN0cnVjdCBwYWNrZXRfc3RhY2tlZF9kYXRhCiB9Owog
I2RlZmluZSBQU0RfUE9PTF9TSVpFCQk2NAogCisKK3N0cnVjdCBwa3RjZHZkX2Rl
dl9rb2JqCit7CisJc3RydWN0IGtvYmplY3QJCWtvYmo7CisJc3RydWN0IHBrdGNk
dmRfZGV2aWNlCSpwZDsKK307CisjZGVmaW5lIHRvX3BrdGRldmtvYmooX2spIFwK
KyAgKChzdHJ1Y3QgcGt0Y2R2ZF9kZXZfa29iaiopY29udGFpbmVyX29mKF9rLHN0
cnVjdCBwa3RjZHZkX2Rldl9rb2JqLGtvYmopKQorCiBzdHJ1Y3QgcGt0Y2R2ZF9k
ZXZpY2UKIHsKIAlzdHJ1Y3QgYmxvY2tfZGV2aWNlCSpiZGV2OwkJLyogZGV2IGF0
dGFjaGVkICovCkBAIC0yODEsNiArMzA3LDE3IEBAIHN0cnVjdCBwa3RjZHZkX2Rl
dmljZQogCiAJc3RydWN0IHBhY2tldF9pb3NjaGVkICAgaW9zY2hlZDsKIAlzdHJ1
Y3QgZ2VuZGlzawkJKmRpc2s7CisJCisJd2FpdF9xdWV1ZV9oZWFkX3QJd3JpdGVf
Y29uZ2VzdGlvbl93cXVldWU7CisJaW50CQkJd3JpdGVfY29uZ2VzdGlvbl9vZmY7
CisJaW50CQkJd3JpdGVfY29uZ2VzdGlvbl9vbjsKKworCXN0cnVjdCBjbGFzc19k
ZXZpY2UJKmNsc2RldjsJLyogc3lzZnMgcGt0Y2R2ZFswLTddIGNsYXNzIGRldiAq
LyAKKwlzdHJ1Y3QgcGt0Y2R2ZF9kZXZfa29iagkqa29ial9zdGF0OwkvKiBzeXNm
cyBwa3RjZHZkWzAtN10vc3RhdC8gICAgICovCisJc3RydWN0IHBrdGNkdmRfZGV2
X2tvYmoJKmtvYmpfd3F1ZXVlOwkvKiBzeXNmcyBwa3RjZHZkWzAtN10vd3JpdGVf
cXVldWUvICovCisJCisJc3RydWN0IGRlbnRyeQkJKmRmc19kX3Jvb3Q7CS8qIGRl
YnVnZnM6IGRldm5hbWUgZGlyZWN0b3J5ICovCisJc3RydWN0IGRlbnRyeQkJKmRm
c19mX2luZm87CS8qIGRlYnVnZnM6IGluZm8gZmlsZSAqLwogfTsKIAogI2VuZGlm
IC8qIF9fS0VSTkVMX18gKi8K
------------Rm46s5dEblEx1CEmXk26Vb--

