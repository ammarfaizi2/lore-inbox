Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264063AbUDQWdF (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 17 Apr 2004 18:33:05 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264067AbUDQWdF
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 17 Apr 2004 18:33:05 -0400
Received: from adsl-207-214-87-84.dsl.snfc21.pacbell.net ([207.214.87.84]:2944
	"EHLO lade.trondhjem.org") by vger.kernel.org with ESMTP
	id S264063AbUDQWcx (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sat, 17 Apr 2004 18:32:53 -0400
Subject: Re: NFS and kernel 2.6.x
From: Trond Myklebust <trond.myklebust@fys.uio.no>
To: Jamie Lokier <jamie@shareable.org>
Cc: linux-kernel@vger.kernel.org
In-Reply-To: <20040416193914.GA25792@mail.shareable.org>
References: <20040416011401.GD18329@widomaker.com>
	 <1082079061.7141.85.camel@lade.trondhjem.org>
	 <20040415185355.1674115b.akpm@osdl.org>
	 <20040416090331.GC22226@mail.shareable.org>
	 <1082130906.2581.10.camel@lade.trondhjem.org>
	 <20040416184821.GA25402@mail.shareable.org>
	 <1082142401.2581.131.camel@lade.trondhjem.org>
	 <20040416193914.GA25792@mail.shareable.org>
Content-Type: multipart/mixed; boundary="=-rayZ5xVV0KpkWMlkGJ+z"
Message-Id: <1082241169.3930.14.camel@lade.trondhjem.org>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.6 
Date: Sat, 17 Apr 2004 15:32:50 -0700
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


--=-rayZ5xVV0KpkWMlkGJ+z
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Fri, 2004-04-16 at 12:39, Jamie Lokier wrote:

> > That's something that is dead easy to do...
> 
> I'll test a patch for 2.6.5 if you provide one.

Here you go...

With this patch
        - the major timeout is of fixed length "timeo<<retrans", and the
        clock starts at the first attempt to send the packet.
        - If a major timeout occurs, we now reset the RTT estimator so
        as to "slow start" when the server becomes available again.

For the moment it does use the timeo + retrans values, because the
former is in fact wanted in order to initialize the RTT estimator.
However, it no longer uses the count of the number of actual
retransmissions in order to determine whether or not a major timeout
occurred.

Cheers,
  Trond



--=-rayZ5xVV0KpkWMlkGJ+z
Content-Disposition: attachment; filename=linux-2.6.6-01-soft.dif
Content-Transfer-Encoding: base64
Content-Type: text/plain; name=linux-2.6.6-01-soft.dif; charset=iso-8859-1

IGluY2x1ZGUvbGludXgvc3VucnBjL3hwcnQuaCAgICB8ICAgMTAgKystLQ0KIG5ldC9zdW5ycGMv
YXV0aF9nc3MvYXV0aF9nc3MuYyB8ICAgIDIgDQogbmV0L3N1bnJwYy9jbG50LmMgICAgICAgICAg
ICAgIHwgICAgNCAtDQogbmV0L3N1bnJwYy90aW1lci5jICAgICAgICAgICAgIHwgICAgMSANCiBu
ZXQvc3VucnBjL3hwcnQuYyAgICAgICAgICAgICAgfCAgIDkxICsrKysrKysrKysrKysrKysrKysr
KysrKystLS0tLS0tLS0tLS0tLS0tDQogNSBmaWxlcyBjaGFuZ2VkLCA2MyBpbnNlcnRpb25zKCsp
LCA0NSBkZWxldGlvbnMoLSkNCg0KZGlmZiAtdSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxlIC0tc2hv
dy1jLWZ1bmN0aW9uIGxpbnV4LTIuNi42LXByZTEvaW5jbHVkZS9saW51eC9zdW5ycGMveHBydC5o
IGxpbnV4LTIuNi42LTAxLXNvZnQvaW5jbHVkZS9saW51eC9zdW5ycGMveHBydC5oDQotLS0gbGlu
dXgtMi42LjYtcHJlMS9pbmNsdWRlL2xpbnV4L3N1bnJwYy94cHJ0LmgJMjAwNC0wNC0xNyAxMTow
NToxMC4wMDAwMDAwMDAgLTA3MDANCisrKyBsaW51eC0yLjYuNi0wMS1zb2Z0L2luY2x1ZGUvbGlu
dXgvc3VucnBjL3hwcnQuaAkyMDA0LTA0LTE3IDEzOjU1OjQwLjAwMDAwMDAwMCAtMDcwMA0KQEAg
LTY5LDggKzY5LDcgQEAgZXh0ZXJuIHVuc2lnbmVkIGludCB4cHJ0X3RjcF9zbG90X3RhYmxlXw0K
ICAqIFRoaXMgZGVzY3JpYmVzIGEgdGltZW91dCBzdHJhdGVneQ0KICAqLw0KIHN0cnVjdCBycGNf
dGltZW91dCB7DQotCXVuc2lnbmVkIGxvbmcJCXRvX2N1cnJlbnQsCQkvKiBjdXJyZW50IHRpbWVv
dXQgKi8NCi0JCQkJdG9faW5pdHZhbCwJCS8qIGluaXRpYWwgdGltZW91dCAqLw0KKwl1bnNpZ25l
ZCBsb25nCQl0b19pbml0dmFsLAkJLyogaW5pdGlhbCB0aW1lb3V0ICovDQogCQkJCXRvX21heHZh
bCwJCS8qIG1heCB0aW1lb3V0ICovDQogCQkJCXRvX2luY3JlbWVudDsJCS8qIGlmICFleHBvbmVu
dGlhbCAqLw0KIAl1bnNpZ25lZCBpbnQJCXRvX3JldHJpZXM7CQkvKiBtYXggIyBvZiByZXRyaWVz
ICovDQpAQCAtODUsNyArODQsNiBAQCBzdHJ1Y3QgcnBjX3Jxc3Qgew0KIAkgKiBUaGlzIGlzIHRo
ZSB1c2VyLXZpc2libGUgcGFydA0KIAkgKi8NCiAJc3RydWN0IHJwY194cHJ0ICoJcnFfeHBydDsJ
CS8qIFJQQyBjbGllbnQgKi8NCi0Jc3RydWN0IHJwY190aW1lb3V0CXJxX3RpbWVvdXQ7CQkvKiB0
aW1lb3V0IHBhcm1zICovDQogCXN0cnVjdCB4ZHJfYnVmCQlycV9zbmRfYnVmOwkJLyogc2VuZCBi
dWZmZXIgKi8NCiAJc3RydWN0IHhkcl9idWYJCXJxX3Jjdl9idWY7CQkvKiByZWN2IGJ1ZmZlciAq
Lw0KIA0KQEAgLTEwMyw2ICsxMDEsOSBAQCBzdHJ1Y3QgcnBjX3Jxc3Qgew0KIAlzdHJ1Y3QgeGRy
X2J1ZgkJcnFfcHJpdmF0ZV9idWY7CQkvKiBUaGUgcmVjZWl2ZSBidWZmZXINCiAJCQkJCQkJICog
dXNlZCBpbiB0aGUgc29mdGlycS4NCiAJCQkJCQkJICovDQorCXVuc2lnbmVkIGxvbmcJCXJxX21h
am9ydGltZW87CS8qIG1ham9yIHRpbWVvdXQgYWxhcm0gKi8NCisJdW5zaWduZWQgbG9uZwkJcnFf
dGltZW91dDsJLyogQ3VycmVudCB0aW1lb3V0IHZhbHVlICovDQorCXVuc2lnbmVkIGludAkJcnFf
cmV0cmllczsJLyogIyBvZiByZXRyaWVzICovDQogCS8qDQogCSAqIEZvciBhdXRoZW50aWNhdGlv
biAoZS5nLiBhdXRoX2RlcykNCiAJICovDQpAQCAtMTE1LDcgKzExNiw2IEBAIHN0cnVjdCBycGNf
cnFzdCB7DQogCXUzMgkJCXJxX2J5dGVzX3NlbnQ7CS8qIEJ5dGVzIHdlIGhhdmUgc2VudCAqLw0K
IA0KIAl1bnNpZ25lZCBsb25nCQlycV94dGltZTsJLyogd2hlbiB0cmFuc21pdHRlZCAqLw0KLQlp
bnQJCQlycV9udGltZW87DQogCWludAkJCXJxX250cmFuczsNCiB9Ow0KICNkZWZpbmUgcnFfc3Zl
YwkJCXJxX3NuZF9idWYuaGVhZA0KQEAgLTIxMCw3ICsyMTAsNyBAQCB2b2lkCQkJeHBydF9yZXNl
cnZlKHN0cnVjdCBycGNfdGFzayAqKTsNCiBpbnQJCQl4cHJ0X3ByZXBhcmVfdHJhbnNtaXQoc3Ry
dWN0IHJwY190YXNrICopOw0KIHZvaWQJCQl4cHJ0X3RyYW5zbWl0KHN0cnVjdCBycGNfdGFzayAq
KTsNCiB2b2lkCQkJeHBydF9yZWNlaXZlKHN0cnVjdCBycGNfdGFzayAqKTsNCi1pbnQJCQl4cHJ0
X2FkanVzdF90aW1lb3V0KHN0cnVjdCBycGNfdGltZW91dCAqKTsNCitpbnQJCQl4cHJ0X2FkanVz
dF90aW1lb3V0KHN0cnVjdCBycGNfcnFzdCAqcmVxKTsNCiB2b2lkCQkJeHBydF9yZWxlYXNlKHN0
cnVjdCBycGNfdGFzayAqKTsNCiB2b2lkCQkJeHBydF9jb25uZWN0KHN0cnVjdCBycGNfdGFzayAq
KTsNCiBpbnQJCQl4cHJ0X2NsZWFyX2JhY2tsb2coc3RydWN0IHJwY194cHJ0ICopOw0KZGlmZiAt
dSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxlIC0tc2hvdy1jLWZ1bmN0aW9uIGxpbnV4LTIuNi42LXBy
ZTEvbmV0L3N1bnJwYy9hdXRoX2dzcy9hdXRoX2dzcy5jIGxpbnV4LTIuNi42LTAxLXNvZnQvbmV0
L3N1bnJwYy9hdXRoX2dzcy9hdXRoX2dzcy5jDQotLS0gbGludXgtMi42LjYtcHJlMS9uZXQvc3Vu
cnBjL2F1dGhfZ3NzL2F1dGhfZ3NzLmMJMjAwNC0wNC0xNyAxMTowNDo1OS4wMDAwMDAwMDAgLTA3
MDANCisrKyBsaW51eC0yLjYuNi0wMS1zb2Z0L25ldC9zdW5ycGMvYXV0aF9nc3MvYXV0aF9nc3Mu
YwkyMDA0LTA0LTE3IDE0OjMxOjI5LjAwMDAwMDAwMCAtMDcwMA0KQEAgLTczNiwxMCArNzM2LDgg
QEAgc3RhdGljIGludA0KIGdzc19yZWZyZXNoKHN0cnVjdCBycGNfdGFzayAqdGFzaykNCiB7DQog
CXN0cnVjdCBycGNfY2xudCAqY2xudCA9IHRhc2stPnRrX2NsaWVudDsNCi0Jc3RydWN0IHJwY194
cHJ0ICp4cHJ0ID0gdGFzay0+dGtfeHBydDsNCiAJc3RydWN0IHJwY19jcmVkICpjcmVkID0gdGFz
ay0+dGtfbXNnLnJwY19jcmVkOw0KIA0KLQl0YXNrLT50a190aW1lb3V0ID0geHBydC0+dGltZW91
dC50b19jdXJyZW50Ow0KIAlpZiAoIWdzc19jcmVkX2lzX3VwdG9kYXRlX2N0eChjcmVkKSkNCiAJ
CXJldHVybiBnc3NfdXBjYWxsKGNsbnQsIHRhc2ssIGNyZWQpOw0KIAlyZXR1cm4gMDsNCmRpZmYg
LXUgLS1yZWN1cnNpdmUgLS1uZXctZmlsZSAtLXNob3ctYy1mdW5jdGlvbiBsaW51eC0yLjYuNi1w
cmUxL25ldC9zdW5ycGMvY2xudC5jIGxpbnV4LTIuNi42LTAxLXNvZnQvbmV0L3N1bnJwYy9jbG50
LmMNCi0tLSBsaW51eC0yLjYuNi1wcmUxL25ldC9zdW5ycGMvY2xudC5jCTIwMDQtMDQtMTcgMTE6
MDQ6NTcuMDAwMDAwMDAwIC0wNzAwDQorKysgbGludXgtMi42LjYtMDEtc29mdC9uZXQvc3VucnBj
L2NsbnQuYwkyMDA0LTA0LTE3IDE1OjA1OjE0LjAwMDAwMDAwMCAtMDcwMA0KQEAgLTc4OCwxMyAr
Nzg4LDExIEBAIHN0YXRpYyB2b2lkDQogY2FsbF90aW1lb3V0KHN0cnVjdCBycGNfdGFzayAqdGFz
aykNCiB7DQogCXN0cnVjdCBycGNfY2xudAkqY2xudCA9IHRhc2stPnRrX2NsaWVudDsNCi0Jc3Ry
dWN0IHJwY190aW1lb3V0ICp0byA9ICZ0YXNrLT50a19ycXN0cC0+cnFfdGltZW91dDsNCiANCi0J
aWYgKHhwcnRfYWRqdXN0X3RpbWVvdXQodG8pKSB7DQorCWlmICh4cHJ0X2FkanVzdF90aW1lb3V0
KHRhc2stPnRrX3Jxc3RwKSA9PSAwKSB7DQogCQlkcHJpbnRrKCJSUEM6ICU0ZCBjYWxsX3RpbWVv
dXQgKG1pbm9yKVxuIiwgdGFzay0+dGtfcGlkKTsNCiAJCWdvdG8gcmV0cnk7DQogCX0NCi0JdG8t
PnRvX3JldHJpZXMgPSBjbG50LT5jbF90aW1lb3V0LnRvX3JldHJpZXM7DQogDQogCWRwcmludGso
IlJQQzogJTRkIGNhbGxfdGltZW91dCAobWFqb3IpXG4iLCB0YXNrLT50a19waWQpOw0KIAlpZiAo
UlBDX0lTX1NPRlQodGFzaykpIHsNCmRpZmYgLXUgLS1yZWN1cnNpdmUgLS1uZXctZmlsZSAtLXNo
b3ctYy1mdW5jdGlvbiBsaW51eC0yLjYuNi1wcmUxL25ldC9zdW5ycGMvdGltZXIuYyBsaW51eC0y
LjYuNi0wMS1zb2Z0L25ldC9zdW5ycGMvdGltZXIuYw0KLS0tIGxpbnV4LTIuNi42LXByZTEvbmV0
L3N1bnJwYy90aW1lci5jCTIwMDQtMDQtMTcgMTE6MDU6MjMuMDAwMDAwMDAwIC0wNzAwDQorKysg
bGludXgtMi42LjYtMDEtc29mdC9uZXQvc3VucnBjL3RpbWVyLmMJMjAwNC0wNC0xNyAxNTowMjoz
My4wMDAwMDAwMDAgLTA3MDANCkBAIC0zOSw2ICszOSw3IEBAIHJwY19pbml0X3J0dChzdHJ1Y3Qg
cnBjX3J0dCAqcnQsIHVuc2lnbmUNCiAJZm9yIChpID0gMDsgaSA8IDU7IGkrKykgew0KIAkJcnQt
PnNydHRbaV0gPSBpbml0Ow0KIAkJcnQtPnNkcnR0W2ldID0gUlBDX1JUT19JTklUOw0KKwkJcnQt
Pm50aW1lb3V0c1tpXSA9IDA7DQogCX0NCiB9DQogDQpkaWZmIC11IC0tcmVjdXJzaXZlIC0tbmV3
LWZpbGUgLS1zaG93LWMtZnVuY3Rpb24gbGludXgtMi42LjYtcHJlMS9uZXQvc3VucnBjL3hwcnQu
YyBsaW51eC0yLjYuNi0wMS1zb2Z0L25ldC9zdW5ycGMveHBydC5jDQotLS0gbGludXgtMi42LjYt
cHJlMS9uZXQvc3VucnBjL3hwcnQuYwkyMDA0LTA0LTE3IDExOjA1OjA5LjAwMDAwMDAwMCAtMDcw
MA0KKysrIGxpbnV4LTIuNi42LTAxLXNvZnQvbmV0L3N1bnJwYy94cHJ0LmMJMjAwNC0wNC0xNyAx
NToyMTo1Ni4wMDAwMDAwMDAgLTA3MDANCkBAIC0zNTIsMzUgKzM1Miw1OSBAQCB4cHJ0X2FkanVz
dF9jd25kKHN0cnVjdCBycGNfeHBydCAqeHBydCwgDQogfQ0KIA0KIC8qDQorICogUmVzZXQgdGhl
IG1ham9yIHRpbWVvdXQgdmFsdWUNCisgKi8NCitzdGF0aWMgdm9pZCB4cHJ0X3Jlc2V0X21ham9y
dGltZW8oc3RydWN0IHJwY19ycXN0ICpyZXEpDQorew0KKwlzdHJ1Y3QgcnBjX3RpbWVvdXQgKnRv
ID0gJnJlcS0+cnFfeHBydC0+dGltZW91dDsNCisNCisJcmVxLT5ycV9tYWpvcnRpbWVvID0gcmVx
LT5ycV90aW1lb3V0Ow0KKwlpZiAodG8tPnRvX2V4cG9uZW50aWFsKQ0KKwkJcmVxLT5ycV9tYWpv
cnRpbWVvIDw8PSB0by0+dG9fcmV0cmllczsNCisJZWxzZQ0KKwkJcmVxLT5ycV9tYWpvcnRpbWVv
ICs9IHRvLT50b19pbmNyZW1lbnQgKiB0by0+dG9fcmV0cmllczsNCisJaWYgKHJlcS0+cnFfbWFq
b3J0aW1lbyA+IHRvLT50b19tYXh2YWwgfHwgcmVxLT5ycV9tYWpvcnRpbWVvID09IDApDQorCQly
ZXEtPnJxX21ham9ydGltZW8gPSB0by0+dG9fbWF4dmFsOw0KKwlyZXEtPnJxX21ham9ydGltZW8g
Kz0gamlmZmllczsNCit9DQorDQorLyoNCiAgKiBBZGp1c3QgdGltZW91dCB2YWx1ZXMgZXRjIGZv
ciBuZXh0IHJldHJhbnNtaXQNCiAgKi8NCi1pbnQNCi14cHJ0X2FkanVzdF90aW1lb3V0KHN0cnVj
dCBycGNfdGltZW91dCAqdG8pDQoraW50IHhwcnRfYWRqdXN0X3RpbWVvdXQoc3RydWN0IHJwY19y
cXN0ICpyZXEpDQogew0KLQlpZiAodG8tPnRvX3JldHJpZXMgPiAwKSB7DQotCQlpZiAodG8tPnRv
X2V4cG9uZW50aWFsKQ0KLQkJCXRvLT50b19jdXJyZW50IDw8PSAxOw0KLQkJZWxzZQ0KLQkJCXRv
LT50b19jdXJyZW50ICs9IHRvLT50b19pbmNyZW1lbnQ7DQotCQlpZiAodG8tPnRvX21heHZhbCAm
JiB0by0+dG9fY3VycmVudCA+PSB0by0+dG9fbWF4dmFsKQ0KLQkJCXRvLT50b19jdXJyZW50ID0g
dG8tPnRvX21heHZhbDsNCisJc3RydWN0IHJwY194cHJ0ICp4cHJ0ID0gcmVxLT5ycV94cHJ0Ow0K
KwlzdHJ1Y3QgcnBjX3RpbWVvdXQgKnRvID0gJnhwcnQtPnRpbWVvdXQ7DQorCWludCBzdGF0dXMg
PSAwOw0KKw0KKwlpZiAodGltZV9iZWZvcmUoamlmZmllcywgcmVxLT5ycV9tYWpvcnRpbWVvKSkg
ew0KKwkJaWYgKHJlcS0+cnFfcmV0cmllcyA8IHRvLT50b19yZXRyaWVzKSB7DQorCQkJaWYgKHRv
LT50b19leHBvbmVudGlhbCkNCisJCQkJcmVxLT5ycV90aW1lb3V0IDw8PSAxOw0KKwkJCWVsc2UN
CisJCQkJcmVxLT5ycV90aW1lb3V0ICs9IHRvLT50b19pbmNyZW1lbnQ7DQorCQkJaWYgKHRvLT50
b19tYXh2YWwgJiYgcmVxLT5ycV90aW1lb3V0ID49IHRvLT50b19tYXh2YWwpDQorCQkJCXJlcS0+
cnFfdGltZW91dCA9IHRvLT50b19tYXh2YWw7DQorCQkJcmVxLT5ycV9yZXRyaWVzKys7DQorCQl9
DQorCQlwcHJpbnRrKCJSUEM6ICVsdSByZXRyYW5zXG4iLCBqaWZmaWVzKTsNCiAJfSBlbHNlIHsN
Ci0JCWlmICh0by0+dG9fZXhwb25lbnRpYWwpDQotCQkJdG8tPnRvX2luaXR2YWwgPDw9IDE7DQot
CQllbHNlDQotCQkJdG8tPnRvX2luaXR2YWwgKz0gdG8tPnRvX2luY3JlbWVudDsNCi0JCWlmICh0
by0+dG9fbWF4dmFsICYmIHRvLT50b19pbml0dmFsID49IHRvLT50b19tYXh2YWwpDQotCQkJdG8t
PnRvX2luaXR2YWwgPSB0by0+dG9fbWF4dmFsOw0KLQkJdG8tPnRvX2N1cnJlbnQgPSB0by0+dG9f
aW5pdHZhbDsNCi0JfQ0KLQ0KLQlpZiAoIXRvLT50b19jdXJyZW50KSB7DQotCQlwcmludGsoS0VS
Tl9XQVJOSU5HICJ4cHJ0X2FkanVzdF90aW1lb3V0OiB0b19jdXJyZW50ID0gMCFcbiIpOw0KLQkJ
dG8tPnRvX2N1cnJlbnQgPSA1ICogSFo7DQotCX0NCi0JcHByaW50aygiUlBDOiAlbHUgJXNcbiIs
IGppZmZpZXMsDQotCQkJdG8tPnRvX3JldHJpZXM/ICJyZXRyYW5zIiA6ICJ0aW1lb3V0Iik7DQot
CXJldHVybiB0by0+dG9fcmV0cmllcy0tID4gMDsNCisJCXJlcS0+cnFfdGltZW91dCA9IHRvLT50
b19pbml0dmFsOw0KKwkJcmVxLT5ycV9yZXRyaWVzID0gMDsNCisJCXhwcnRfcmVzZXRfbWFqb3J0
aW1lbyhyZXEpOw0KKwkJLyogUmVzZXQgdGhlIFJUVCBjb3VudGVycyA9PSAic2xvdyBzdGFydCIg
Ki8NCisJCXNwaW5fbG9ja19iaCgmeHBydC0+c29ja19sb2NrKTsNCisJCXJwY19pbml0X3J0dChy
ZXEtPnJxX3Rhc2stPnRrX2NsaWVudC0+Y2xfcnR0LCB0by0+dG9faW5pdHZhbCk7DQorCQlzcGlu
X3VubG9ja19iaCgmeHBydC0+c29ja19sb2NrKTsNCisJCXBwcmludGsoIlJQQzogJWx1IHRpbWVv
dXRcbiIsIGppZmZpZXMpOw0KKwkJc3RhdHVzID0gLUVUSU1FRE9VVDsNCisJfQ0KKw0KKwlpZiAo
cmVxLT5ycV90aW1lb3V0ID09IDApIHsNCisJCXByaW50ayhLRVJOX1dBUk5JTkcgInhwcnRfYWRq
dXN0X3RpbWVvdXQ6IHJxX3RpbWVvdXQgPSAwIVxuIik7DQorCQlyZXEtPnJxX3RpbWVvdXQgPSA1
ICogSFo7DQorCX0NCisJcmV0dXJuIHN0YXR1czsNCiB9DQogDQogLyoNCkBAIC0xMTY2LDYgKzEx
OTAsNyBAQCB4cHJ0X3RyYW5zbWl0KHN0cnVjdCBycGNfdGFzayAqdGFzaykNCiAJCQkvKiBBZGQg
cmVxdWVzdCB0byB0aGUgcmVjZWl2ZSBsaXN0ICovDQogCQkJbGlzdF9hZGRfdGFpbCgmcmVxLT5y
cV9saXN0LCAmeHBydC0+cmVjdik7DQogCQkJc3Bpbl91bmxvY2tfYmgoJnhwcnQtPnNvY2tfbG9j
ayk7DQorCQkJeHBydF9yZXNldF9tYWpvcnRpbWVvKHJlcSk7DQogCQl9DQogCX0gZWxzZSBpZiAo
IXJlcS0+cnFfYnl0ZXNfc2VudCkNCiAJCXJldHVybjsNCkBAIC0xMjIxLDcgKzEyNDYsNyBAQCB4
cHJ0X3RyYW5zbWl0KHN0cnVjdCBycGNfdGFzayAqdGFzaykNCiAJCQlpZiAoIXhwcnRfY29ubmVj
dGVkKHhwcnQpKQ0KIAkJCQl0YXNrLT50a19zdGF0dXMgPSAtRU5PVENPTk47DQogCQkJZWxzZSBp
ZiAodGVzdF9iaXQoU09DS19OT1NQQUNFLCAmeHBydC0+c29jay0+ZmxhZ3MpKSB7DQotCQkJCXRh
c2stPnRrX3RpbWVvdXQgPSByZXEtPnJxX3RpbWVvdXQudG9fY3VycmVudDsNCisJCQkJdGFzay0+
dGtfdGltZW91dCA9IHJlcS0+cnFfdGltZW91dDsNCiAJCQkJcnBjX3NsZWVwX29uKCZ4cHJ0LT5w
ZW5kaW5nLCB0YXNrLCBOVUxMLCBOVUxMKTsNCiAJCQl9DQogCQkJc3Bpbl91bmxvY2tfYmgoJnhw
cnQtPnNvY2tfbG9jayk7DQpAQCAtMTI0OCwxMyArMTI3MywxMSBAQCB4cHJ0X3RyYW5zbWl0KHN0
cnVjdCBycGNfdGFzayAqdGFzaykNCiAJaWYgKCF4cHJ0LT5ub2NvbmcpIHsNCiAJCWludCB0aW1l
ciA9IHRhc2stPnRrX21zZy5ycGNfcHJvYy0+cF90aW1lcjsNCiAJCXRhc2stPnRrX3RpbWVvdXQg
PSBycGNfY2FsY19ydG8oY2xudC0+Y2xfcnR0LCB0aW1lcik7DQotCQl0YXNrLT50a190aW1lb3V0
IDw8PSBycGNfbnRpbWVvKGNsbnQtPmNsX3J0dCwgdGltZXIpOw0KLQkJdGFzay0+dGtfdGltZW91
dCA8PD0gY2xudC0+Y2xfdGltZW91dC50b19yZXRyaWVzDQotCQkJLSByZXEtPnJxX3RpbWVvdXQu
dG9fcmV0cmllczsNCi0JCWlmICh0YXNrLT50a190aW1lb3V0ID4gcmVxLT5ycV90aW1lb3V0LnRv
X21heHZhbCkNCi0JCQl0YXNrLT50a190aW1lb3V0ID0gcmVxLT5ycV90aW1lb3V0LnRvX21heHZh
bDsNCisJCXRhc2stPnRrX3RpbWVvdXQgPDw9IHJwY19udGltZW8oY2xudC0+Y2xfcnR0LCB0aW1l
cikgKyByZXEtPnJxX3JldHJpZXM7DQorCQlpZiAodGFzay0+dGtfdGltZW91dCA+IHhwcnQtPnRp
bWVvdXQudG9fbWF4dmFsIHx8IHRhc2stPnRrX3RpbWVvdXQgPT0gMCkNCisJCQl0YXNrLT50a190
aW1lb3V0ID0geHBydC0+dGltZW91dC50b19tYXh2YWw7DQogCX0gZWxzZQ0KLQkJdGFzay0+dGtf
dGltZW91dCA9IHJlcS0+cnFfdGltZW91dC50b19jdXJyZW50Ow0KKwkJdGFzay0+dGtfdGltZW91
dCA9IHJlcS0+cnFfdGltZW91dDsNCiAJLyogRG9uJ3QgcmFjZSB3aXRoIGRpc2Nvbm5lY3QgKi8N
CiAJaWYgKCF4cHJ0X2Nvbm5lY3RlZCh4cHJ0KSkNCiAJCXRhc2stPnRrX3N0YXR1cyA9IC1FTk9U
Q09OTjsNCkBAIC0xMzI0LDcgKzEzNDcsNyBAQCB4cHJ0X3JlcXVlc3RfaW5pdChzdHJ1Y3QgcnBj
X3Rhc2sgKnRhc2ssDQogew0KIAlzdHJ1Y3QgcnBjX3Jxc3QJKnJlcSA9IHRhc2stPnRrX3Jxc3Rw
Ow0KIA0KLQlyZXEtPnJxX3RpbWVvdXQgPSB4cHJ0LT50aW1lb3V0Ow0KKwlyZXEtPnJxX3RpbWVv
dXQgPSB4cHJ0LT50aW1lb3V0LnRvX2luaXR2YWw7DQogCXJlcS0+cnFfdGFzawk9IHRhc2s7DQog
CXJlcS0+cnFfeHBydCAgICA9IHhwcnQ7DQogCXJlcS0+cnFfeGlkICAgICA9IHhwcnRfYWxsb2Nf
eGlkKHhwcnQpOw0KQEAgLTEzODEsNyArMTQwNCw2IEBAIHhwcnRfZGVmYXVsdF90aW1lb3V0KHN0
cnVjdCBycGNfdGltZW91dCANCiB2b2lkDQogeHBydF9zZXRfdGltZW91dChzdHJ1Y3QgcnBjX3Rp
bWVvdXQgKnRvLCB1bnNpZ25lZCBpbnQgcmV0ciwgdW5zaWduZWQgbG9uZyBpbmNyKQ0KIHsNCi0J
dG8tPnRvX2N1cnJlbnQgICA9IA0KIAl0by0+dG9faW5pdHZhbCAgID0gDQogCXRvLT50b19pbmNy
ZW1lbnQgPSBpbmNyOw0KIAl0by0+dG9fbWF4dmFsICAgID0gaW5jciAqIHJldHI7DQpAQCAtMTQ0
Niw3ICsxNDY4LDYgQEAgeHBydF9zZXR1cChpbnQgcHJvdG8sIHN0cnVjdCBzb2NrYWRkcl9pbg0K
IAkvKiBTZXQgdGltZW91dCBwYXJhbWV0ZXJzICovDQogCWlmICh0bykgew0KIAkJeHBydC0+dGlt
ZW91dCA9ICp0bzsNCi0JCXhwcnQtPnRpbWVvdXQudG9fY3VycmVudCA9IHRvLT50b19pbml0dmFs
Ow0KIAl9IGVsc2UNCiAJCXhwcnRfZGVmYXVsdF90aW1lb3V0KCZ4cHJ0LT50aW1lb3V0LCB4cHJ0
LT5wcm90KTsNCiANCg==

--=-rayZ5xVV0KpkWMlkGJ+z--
