Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261359AbVBZAjW@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261359AbVBZAjW (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 25 Feb 2005 19:39:22 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261368AbVBZAjW
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 25 Feb 2005 19:39:22 -0500
Received: from mail.ocs.com.au ([202.147.117.210]:7623 "EHLO mail.ocs.com.au")
	by vger.kernel.org with ESMTP id S261359AbVBZAhn (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 25 Feb 2005 19:37:43 -0500
X-Mailer: exmh version 2.6.3_20040314 03/14/2004 with nmh-1.0.4
From: Keith Owens <kaos@ocs.com.au>
To: Geert Uytterhoeven <geert@linux-m68k.org>
Cc: Linux Kernel Development <linux-kernel@vger.kernel.org>,
       Linux/m68k <linux-m68k@vger.kernel.org>
Subject: Re: Inconsistent kallsyms data (since 2.6.11-rc3 or so) 
In-reply-to: Your message of "Fri, 25 Feb 2005 11:33:48 BST."
             <Pine.LNX.4.62.0502251126090.28108@anakin> 
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Date: Sat, 26 Feb 2005 11:37:35 +1100
Message-ID: <1218.1109378255@ocs3.ocs.com.au>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, 25 Feb 2005 11:33:48 +0100 (CET), 
Geert Uytterhoeven <geert@linux-m68k.org> wrote:
>
>One of my m68k configs has been giving
>
>| Inconsistent kallsyms data
>| Try setting CONFIG_KALLSYMS_EXTRA_PASS
>
>since 2.6.11-rc3 or so. Setting CONFIG_KALLSYMS_EXTRA_PASS, or applying Keith
>Owen's patch to fix an issue for SH
>(http://seclists.org/lists/linux-kernel/2005/Jan/0017.html) doesn't help.
>
>The diffs between the human-readable tables (as generated by Keith's
>kallsyms_uncompress.pl) show lots of changes (see below).
>
>Related config settings:
>
>| anakin$ grep kallsyms .config
>| CONFIG_KALLSYMS=y
>| # CONFIG_KALLSYMS_ALL is not set
>| CONFIG_KALLSYMS_EXTRA_PASS=y
>| anakin$
>
>Any other info that's needed to solve this issue? Thanks!

Apply the patch below to preserve the .S files, turn off
CONFIG_KALLSYMS_EXTRA_PASS, make vmlinux and send me the tarball from
these commands

objdump -h .tmp_vmlinux* > .tmp_objdump
nm -A .tmp_vmlinux* > .tmp_nm
tar czvf kallsyms-m68k.tar.gz .tmp_kallsyms* .tmp_objdump .tmp_nm

Index: linux/Makefile
===================================================================
--- linux.orig/Makefile	2005-02-12 18:40:12.000000000 +1100
+++ linux/Makefile	2005-02-26 11:32:19.300871801 +1100
@@ -685,7 +685,7 @@ define verify_kallsyms
 	$(Q)cmp -s System.map .tmp_System.map ||              \
 		(echo Inconsistent kallsyms data;             \
 		 echo Try setting CONFIG_KALLSYMS_EXTRA_PASS; \
-		 rm .tmp_kallsyms* ; /bin/false )
+		 rm .tmp_kallsyms*.o ; /bin/false )
 endef
 
 # Update vmlinux version before link


