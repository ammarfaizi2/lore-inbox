Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261294AbUKVL6I@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261294AbUKVL6I (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 22 Nov 2004 06:58:08 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261449AbUKVL6H
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 22 Nov 2004 06:58:07 -0500
Received: from news.suse.de ([195.135.220.2]:35974 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S261294AbUKVL6D (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 22 Nov 2004 06:58:03 -0500
Date: Mon, 22 Nov 2004 12:58:02 +0100
Message-ID: <s5his7ydrjp.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Lee Revell <rlrevell@joe-job.com>
Cc: Pavel Machek <pavel@ucw.cz>, John Mock <kd6pag@qsl.net>,
       linux-kernel@vger.kernel.org, perex@suse.cz,
       alsa-devel <alsa-devel@lists.sourceforge.net>
Subject: Re: 2.6.10-rc2 on VAIO laptop and PowerMac 8500/G3
In-Reply-To: <1100977903.6879.56.camel@krustophenia.net>
References: <E1CVYZM-0000Fi-00@penngrove.fdns.net>
	<20041120185100.GA1205@elf.ucw.cz>
	<1100977903.6879.56.camel@krustophenia.net>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Sat, 20 Nov 2004 14:11:42 -0500,
Lee Revell wrote:
> 
> Please cc: alsa-devel on ALSA issues (we now allow posts from non
> subscribers! :-P).

It's a known problem and already fixed on ALSA CVS.
Sice 2.6.10-rc2, pci_save_state() is no longer called as default when
suspend callback is set.  The patch is below.


Takashi

--- linux/sound/core/init.c	8 Nov 2004 11:37:08 -0000	1.48
+++ linux/sound/core/init.c	12 Nov 2004 13:56:32 -0000
@@ -782,12 +782,15 @@
 int snd_card_pci_suspend(struct pci_dev *dev, u32 state)
 {
 	snd_card_t *card = pci_get_drvdata(dev);
+	int err;
 	if (! card || ! card->pm_suspend)
 		return 0;
 	if (card->power_state == SNDRV_CTL_POWER_D3hot)
 		return 0;
 	/* FIXME: correct state value? */
-	return card->pm_suspend(card, 0);
+	err = card->pm_suspend(card, 0);
+	pci_save_state(dev);
+	return err;
 }
 
 int snd_card_pci_resume(struct pci_dev *dev)
