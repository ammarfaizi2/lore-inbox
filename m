Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1751463AbWETTM3@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751463AbWETTM3 (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 20 May 2006 15:12:29 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751472AbWETTM3
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 20 May 2006 15:12:29 -0400
Received: from stingr.net ([212.193.32.15]:13975 "EHLO stingr.net")
	by vger.kernel.org with ESMTP id S1751463AbWETTM2 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sat, 20 May 2006 15:12:28 -0400
Date: Sat, 20 May 2006 23:11:53 +0400
From: Paul P Komkoff Jr <i@stingr.net>
To: Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: Was change to ip_push_pending_frames intended to break udp (more specifically, WCCP?)
Message-ID: <20060520191153.GV3776@stingr.net>
Mail-Followup-To: Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=koi8-r
Content-Disposition: inline
User-Agent: Agent Darien Fawkes
X-Mailer: Intel Ultra ATA Storage Driver
X-RealName: Stingray Greatest Jr
Organization: Department of Fish & Wildlife
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hello!

I have a userspace application, which talks WCCP2 with cisco routers.
It sends and receives UDP packets on port 2048. After I've updated my
server to 2.6.16, it stopped working.

Examining logs and packet dumps of previous (2.6.15 kernel) vs.
current, I found, that cisco will not understand packets generated by
2.6.16. The only difference in that packets was IP id field, which was
increasing (1, 2, ...) with old kernel, and always 0 with 2.6.16.

Looking thru the changelog, I've found a suspect. It was this commit:
http://kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=1a55d57b107c3e06935763905dc0fb235214569d

Reverting this patch fixes my problems - the router understands
packets again.

I took a look through the code and ip_select_ident codepath but still
don't understand why it setting id to 0.
-- 
Paul P 'Stingray' Komkoff Jr // http://stingr.net/key <- my pgp key
 This message represents the official view of the voices in my head
