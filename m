Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261550AbUBUMsf (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 21 Feb 2004 07:48:35 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261556AbUBUMsf
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 21 Feb 2004 07:48:35 -0500
Received: from p062096.ppp.asahi-net.or.jp ([221.113.62.96]:6394 "EHLO
	mitou.ysato.dip.jp") by vger.kernel.org with ESMTP id S261550AbUBUMse
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sat, 21 Feb 2004 07:48:34 -0500
Date: Sat, 21 Feb 2004 21:47:30 +0900
Message-ID: <m2hdxkbnvh.wl%ysato@users.sourceforge.jp>
From: Yoshinori Sato <ysato@users.sourceforge.jp>
To: Linus Torvalds <torvalds@osdl.org>
Cc: linux kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: [PATCH] H8/300 start_thread problem fix
User-Agent: Wanderlust/2.11.20 (Wonderwall) SEMI/1.14.5 (Awara-Onsen)
 LIMIT/1.14.7 (Fujiidera) APEL/10.6 Emacs/21.3 (i386-pc-linux-gnu)
 MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Illegal usp corrected a set problem in starting of thread.

diff -X .exclude-diff -Nru linux-2.6.3/include/asm-h8300/processor.h linux-2.6.3-h8300/include/asm-h8300/processor.h
--- linux-2.6.3/include/asm-h8300/processor.h	2004-01-09 15:59:09.000000000 +0900
+++ linux-2.6.3-h8300/include/asm-h8300/processor.h	2004-02-20 02:45:46.000000000 +0900
@@ -75,6 +75,7 @@
 	set_fs(USER_DS);           /* reads from user space */  \
   	(_regs)->pc = (_pc);				        \
 	(_regs)->ccr &= 0x00;	   /* clear kernel flag */      \
+	wrusp((unsigned long)(_usp) - sizeof(unsigned long)*3);	\
 } while(0)
 #endif
 #if defined(__H8300S__)

-- 
Yoshinori Sato
<ysato@users.sourceforge.jp>
