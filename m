Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S284156AbRLKWe7>; Tue, 11 Dec 2001 17:34:59 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S284164AbRLKWet>; Tue, 11 Dec 2001 17:34:49 -0500
Received: from inje.iskon.hr ([213.191.128.16]:27059 "EHLO inje.iskon.hr")
	by vger.kernel.org with ESMTP id <S284141AbRLKWec>;
	Tue, 11 Dec 2001 17:34:32 -0500
To: Rui Sousa <rui.p.m.sousa@clix.pt>
Cc: <linux-kernel@vger.kernel.org>
Subject: Re: emu10k1 - interrupt storm?
In-Reply-To: <Pine.LNX.4.33.0112101127420.2868-100000@sophia-sousar2.nice.mindspeed.com>
Reply-To: zlatko.calusic@iskon.hr
X-Face: s71Vs\G4I3mB$X2=P4h[aszUL\%"`1!YRYl[JGlC57kU-`kxADX}T/Bq)Q9.$fGh7lFNb.s
 i&L3xVb:q_Pr}>Eo(@kU,c:3:64cR]m@27>1tGl1):#(bs*Ip0c}N{:JGcgOXd9H'Nwm:}jLr\FZtZ
 pri/C@\,4lW<|jrq^<):Nk%Hp@G&F"r+n1@BoH
From: Zlatko Calusic <zlatko.calusic@iskon.hr>
Date: 11 Dec 2001 21:03:41 +0100
In-Reply-To: <Pine.LNX.4.33.0112101127420.2868-100000@sophia-sousar2.nice.mindspeed.com> (Rui Sousa's message of "Mon, 10 Dec 2001 11:39:46 +0100 (CET)")
Message-ID: <87ofl534o2.fsf@atlas.iskon.hr>
User-Agent: Gnus/5.090003 (Oort Gnus v0.03) XEmacs/21.4 (Civil Service)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Rui Sousa <rui.p.m.sousa@clix.pt> writes:

> On 9 Dec 2001, Zlatko Calusic wrote:
> 
> The emu10k1 only generates interrupts when playing pcm sound.
> The interrupt rate depends on the "fragment" size and is usually
> smaller than ~1000interrupts/s (this is 256bytes fragment 48Khz sample 
> rate, 16bit, stereo).
> 
> Is it possible there is another device producing these interrupts?
> On-board devices (usb, ...) that you don't use?
> Does this happen with this kernel only?

Hm, looks like it is really emu10k1. But...

When I booted into single user mode, the kernel wasn't reporting
interrupts. Then I started Gnome, and there they were. Finally I found
that killing/starting esd changes things. Whenever esd was up,
interrupts were generated, when I killed it interrupts would stop.

Then I straced esd daemon, just to find it was blocked on select().

{atlas} [~]# strace -p 705
select(12, [4 6 7 8 9 10 11], NULL, NULL, NULL

Strange, if esd is not doing any work (just sleeping) who generates
interrupts then?

Also, we don't know now is it the driver to blame, or silly esd daemon.

> 
> Which functions do you see listed? If it's only "emu10k1_interrupt()"
> then the interrupt was not generated by the emu10k1.
> 

Top 5 entries in the kernel profile:

   475 __rdtsc_delay                             16.9643
   309 handle_IRQ_event                           2.4919
   178 do_softirq                                 0.8725
   148 emu10k1_waveout_bh                         0.7872
   135 emu10k1_interrupt                          0.6490

As time goes by, the numbers get bigger (that is only 15min after
reboot)...

Maybe it's time to enable debug option in the driver?

Sorry for late answer, I got busy yesterday...
-- 
Zlatko
