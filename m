Return-Path: <linux-kernel-owner+willy=40w.ods.org-S267785AbUG3SrY@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S267785AbUG3SrY (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 30 Jul 2004 14:47:24 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S267783AbUG3SrY
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 30 Jul 2004 14:47:24 -0400
Received: from cantor.suse.de ([195.135.220.2]:15570 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S267787AbUG3SrW (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 30 Jul 2004 14:47:22 -0400
Date: Fri, 30 Jul 2004 20:47:21 +0200
Message-ID: <s5hisc5tjra.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jeff Garzik <jgarzik@pobox.com>
Cc: Andi Kleen <ak@suse.de>, akpm@osdl.org, linux-kernel@vger.kernel.org,
       James.Bottomley@HansenPartnership.com
Subject: Re: [PATCH] Improve pci_alloc_consistent wrapper on preemptive kernels
In-Reply-To: <410A8E7D.2030009@pobox.com>
References: <20040730190227.29913e23.ak@suse.de>
	<410A826C.4000508@pobox.com>
	<20040730194304.2c27f48c.ak@suse.de>
	<410A8E7D.2030009@pobox.com>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Fri, 30 Jul 2004 14:07:57 -0400,
Jeff Garzik wrote:
> 
> Andi Kleen wrote:
> > On Fri, 30 Jul 2004 13:16:28 -0400
> > Jeff Garzik <jgarzik@pobox.com> wrote:
> > 
> > 
> > 
> >>1) Changing from GFP_ATOMIC to <something else> may break code
> > 
> > 
> > x86-64 did it for a long time and I am not aware of problems with it
> > (however I don't know how widespread CONFIG_PREEMPT use on x86-64 is) 
> > 
> > 
> >>2) Conversely from #1, I also worry why GFP_ATOMIC would be needed at 
> >>all.  I code all my drivers to require that pci_alloc_consistent() be 
> >>called from somewhere that is allowed to sleep.
> > 
> > 
> > Maybe you do, but others don't.
> 
> Certainly.  Therefore, changing from GFP_ATOMIC will increase likelihood 
> of breakage, no?

pci_alloc_consistent() was GFP_ATOMIC only on 2.4 anyway, so I don't
expect there would be any breakage...


Takashi
