Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S280831AbRKGPci>; Wed, 7 Nov 2001 10:32:38 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S280829AbRKGPc2>; Wed, 7 Nov 2001 10:32:28 -0500
Received: from t2.redhat.com ([199.183.24.243]:51184 "HELO
	executor.cambridge.redhat.com") by vger.kernel.org with SMTP
	id <S280827AbRKGPcP>; Wed, 7 Nov 2001 10:32:15 -0500
To: Alan Cox <alan@lxorguk.ukuu.org.uk>
Cc: Linux Torvalds <torvalds@transmeta.com>, bcrl@redhat.com,
        linux-kernel@vger.kernel.org
Subject: Re: Using %cr2 to reference "current" 
In-Reply-To: Message from Alan Cox <alan@lxorguk.ukuu.org.uk> 
   of "Wed, 07 Nov 2001 14:54:00 GMT." <E161U5Y-0004Lc-00@the-village.bc.nu> 
User-Agent: EMH/1.14.1 SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/20.7
 (i386-redhat-linux-gnu) MULE/4.0 (HANANOEN)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Date: Wed, 07 Nov 2001 15:32:07 +0000
Message-ID: <1820.1005147127@warthog.cambridge.redhat.com>
From: David Howells <dhowells@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


Instead of using %cr2, how about giving each CPU it's own GDT (the GDT doesn't
need to contain many entries). Have one segment number point to a CPU specific
data area that contains things like the current task pointer for that CPU, the
CPU number, etc, etc. This same segment number will be used on all CPU's, but
will be multiplexed via the per-CPU GDTs instead.

Then you can load up a segment register with this segment on entry to the
kernel, and then make CPU data accesses relative to that.

David
