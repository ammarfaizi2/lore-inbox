Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S132115AbRAUB0P>; Sat, 20 Jan 2001 20:26:15 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S132569AbRAUB0F>; Sat, 20 Jan 2001 20:26:05 -0500
Received: from [210.74.191.34] ([210.74.191.34]:9980 "EHLO
	bfrey.turbolinux.com.cn") by vger.kernel.org with ESMTP
	id <S132115AbRAUBZy>; Sat, 20 Jan 2001 20:25:54 -0500
Date: Sun, 21 Jan 2001 09:32:43 +0800
From: Bob Frey <bfrey@turbolinux.com.cn>
To: Stephen Kitchener <stephen@g6dzj.demon.co.uk>
Cc: linux-scsi@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: Re: Scanning problems - machine lockups
Message-ID: <20010121093243.B22593@bfrey.dev.cn.tlan>
In-Reply-To: <01011823245400.01549@statler.ether-net> <20010119094130.A7816@bfrey.dev.cn.tlan> <01012015542200.01503@statler.ether-net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 1.0us
In-Reply-To: <01012015542200.01503@statler.ether-net>; from stephen@g6dzj.demon.co.uk on Sat, Jan 20, 2001 at 03:54:22PM +0000
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sat, Jan 20, 2001 at 03:54:22PM +0000, Stephen Kitchener wrote:
> Any, I thought that it had cured the problem, but after a few scans, 
> admittedly more than before, the scan head didn't return on the last scan 
> that was successfully started.
It sounds like you did solve the "lock the machine solid" problem by putting
the video card on its own interrupt. Does anyone specifically maintain
kernel/irq.c? - please submit some spurious interrupt handling (interrupts
generated by devices that don't have a handler) along the lines of what
David Woodhouse suggested. I would expect it to deactivate the IRQ and report
the problem to the user so they can fix it themselves probably by changing
the IRQ configuration - not perfect but better than locking up the machine
with no message.

> Trying to scan again, hoping that it would reset the scanner and carry on, 
> ... nothing, no response from scanner.
So now apparently the scanner doesn't respond after a few scans, but the
system continues to work OK. This sounds like a problem with either
the scanner sw, advansys driver, or the scanner.

1) I'm not familiar with SANE (is that what you're using?), but it probably
has some test programs. Please try them if they exist and report the
results.
2) Please send the output of /proc/scsi/advansys/1 file after the hang. Also
you said you have another advansys card (/proc/scsi/advansys/0) with a lot
of devices attached. Do they all work correctly after the scanner hang? If
so, the problem is isolated to the second card and it's not a general driver
problem.
3) Another experiment is to compile the advansys driver as a module if you
can and after the hang, rmmod/insmod it to see if the scanner starts working
again. I would expect it to because this will reset the driver, adapter, and
SCSI bus.

-- 
Bob Frey
bfrey@turbolinux.com.cn
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at http://www.tux.org/lkml/
