Return-Path: <linux-kernel-owner+willy=40w.ods.org-S267893AbUJSC63@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S267893AbUJSC63 (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 18 Oct 2004 22:58:29 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S267890AbUJSC63
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 18 Oct 2004 22:58:29 -0400
Received: from fmr12.intel.com ([134.134.136.15]:47799 "EHLO
	orsfmr001.jf.intel.com") by vger.kernel.org with ESMTP
	id S267893AbUJSC6C (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 18 Oct 2004 22:58:02 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5.7226.0
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C4B587.5C339AA7"
Subject: [patch]Replace some sys32 functions with compat ones on em64T
Date: Tue, 19 Oct 2004 10:57:24 +0800
Message-ID: <3ACA40606221794F80A5670F0AF15F8405460215@pdsmsx403>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: [patch]Replace some sys32 functions with compat ones on em64T
Thread-Index: AcS1h1wz72iR9NlySveFEcN1wXCs5Q==
From: "Pu, Long" <long.pu@intel.com>
To: <discuss@x86-64.org>, <linux-kernel@vger.kernel.org>
Cc: <ak@muc.de>
X-OriginalArrivalTime: 19 Oct 2004 02:57:26.0653 (UTC) FILETIME=[5D7752D0:01C4B587]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------_=_NextPart_001_01C4B587.5C339AA7
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

 <<x68_64_sys32_to_compat.diff>> This patch replaced some sys32 syscall
functions of X86_64 with the corresponding compat version.
It is against 2.6.9-rc4-mm1.

Signed-off-by: Pu Long	<long.pu@intel.com>


------_=_NextPart_001_01C4B587.5C339AA7
Content-Type: application/octet-stream;
	name="x68_64_sys32_to_compat.diff"
Content-Transfer-Encoding: base64
Content-Description: x68_64_sys32_to_compat.diff
Content-Disposition: attachment;
	filename="x68_64_sys32_to_compat.diff"

ZGlmZiAtTnJ1IGEvYXJjaC94ODZfNjQvaWEzMi9pYTMyZW50cnkuUyBiL2FyY2gveDg2XzY0L2lh
MzIvaWEzMmVudHJ5LlMKLS0tIGEvYXJjaC94ODZfNjQvaWEzMi9pYTMyZW50cnkuUwkyMDA0LTEw
LTE0IDE0OjEyOjM1LjAwMDAwMDAwMCArMDgwMAorKysgYi9hcmNoL3g4Nl82NC9pYTMyL2lhMzJl
bnRyeS5TCTIwMDQtMTAtMTQgMTg6NDQ6NTUuMDAwMDAwMDAwICswODAwCkBAIC0zOTEsNyArMzkx
LDcgQEAKIAkucXVhZCBzeXNfdXNlbGliCiAJLnF1YWQgc3lzX3N3YXBvbgogCS5xdWFkIHN5c19y
ZWJvb3QKLQkucXVhZCBzeXMzMl9vbGRyZWFkZGlyCisJLnF1YWQgY29tcGF0X29sZF9yZWFkZGly
CiAJLnF1YWQgc3lzMzJfbW1hcAkJLyogOTAgKi8KIAkucXVhZCBzeXNfbXVubWFwCiAJLnF1YWQg
c3lzX3RydW5jYXRlCkBAIC00NDMsNyArNDQzLDcgQEAKIAkucXVhZCBzeXNfc2V0ZnN1aWQxNgog
CS5xdWFkIHN5c19zZXRmc2dpZDE2CiAJLnF1YWQgc3lzX2xsc2VlawkJLyogMTQwICovCi0JLnF1
YWQgc3lzMzJfZ2V0ZGVudHMKKwkucXVhZCBjb21wYXRfc3lzX2dldGRlbnRzCiAJLnF1YWQgY29t
cGF0X3N5c19zZWxlY3QKIAkucXVhZCBzeXNfZmxvY2sKIAkucXVhZCBzeXNfbXN5bmMKQEAgLTUy
Miw3ICs1MjIsNyBAQAogCS5xdWFkIHN5c19waXZvdF9yb290CiAJLnF1YWQgc3lzX21pbmNvcmUK
IAkucXVhZCBzeXNfbWFkdmlzZQotCS5xdWFkIHN5c19nZXRkZW50czY0CS8qIDIyMCBnZXRkZW50
czY0ICovIAorCS5xdWFkIGNvbXBhdF9zeXNfZ2V0ZGVudHM2NAkvKiAyMjAgZ2V0ZGVudHM2NCAq
LyAKIAkucXVhZCBjb21wYXRfc3lzX2ZjbnRsNjQJCiAJLnF1YWQgcXVpZXRfbmlfc3lzY2FsbAkJ
LyogdHV4ICovCiAJLnF1YWQgcXVpZXRfbmlfc3lzY2FsbCAgICAJLyogc2VjdXJpdHkgKi8KQEAg
LTU0OSw4ICs1NDksOCBAQAogCS5xdWFkIHN5czMyX2dldF90aHJlYWRfYXJlYQogCS5xdWFkIHN5
czMyX2lvX3NldHVwCQkvKiAyNDUgKi8KIAkucXVhZCBzeXNfaW9fZGVzdHJveQotCS5xdWFkIHN5
czMyX2lvX2dldGV2ZW50cwotCS5xdWFkIHN5czMyX2lvX3N1Ym1pdAorCS5xdWFkIGNvbXBhdF9z
eXNfaW9fZ2V0ZXZlbnRzCisJLnF1YWQgY29tcGF0X3N5c19pb19zdWJtaXQKIAkucXVhZCBzeXNf
aW9fY2FuY2VsCiAJLnF1YWQgc3lzX2ZhZHZpc2U2NAkJLyogMjUwICovCiAJLnF1YWQgcXVpZXRf
bmlfc3lzY2FsbCAJLyogZnJlZV9odWdlX3BhZ2VzICovCmRpZmYgLU5ydSBhL2FyY2gveDg2XzY0
L2lhMzIvc3lzX2lhMzIuYyBiL2FyY2gveDg2XzY0L2lhMzIvc3lzX2lhMzIuYwotLS0gYS9hcmNo
L3g4Nl82NC9pYTMyL3N5c19pYTMyLmMJMjAwNC0xMC0xNCAxNDoxMjozNS4wMDAwMDAwMDAgKzA4
MDAKKysrIGIvYXJjaC94ODZfNjQvaWEzMi9zeXNfaWEzMi5jCTIwMDQtMTAtMTQgMTk6MDA6NDEu
MDUyODg3OTQ0ICswODAwCkBAIC00NzMsMTM0ICs0NzMsNiBAQAogCXJldHVybiBkb19zeXNfc2V0
dGltZW9mZGF5KHR2ID8gJmt0cyA6IE5VTEwsIHR6ID8gJmt0eiA6IE5VTEwpOwogfQogCi1zdHJ1
Y3QgbGludXgzMl9kaXJlbnQgewotCXUzMglkX2lubzsKLQl1MzIJZF9vZmY7Ci0JdTE2CWRfcmVj
bGVuOwotCWNoYXIJZF9uYW1lWzFdOwotfTsKLQotc3RydWN0IG9sZF9saW51eDMyX2RpcmVudCB7
Ci0JdTMyCWRfaW5vOwotCXUzMglkX29mZnNldDsKLQl1MTYJZF9uYW1sZW47Ci0JY2hhcglkX25h
bWVbMV07Ci19OwotCi1zdHJ1Y3QgZ2V0ZGVudHMzMl9jYWxsYmFjayB7Ci0Jc3RydWN0IGxpbnV4
MzJfZGlyZW50IF9fdXNlciAqIGN1cnJlbnRfZGlyOwotCXN0cnVjdCBsaW51eDMyX2RpcmVudCBf
X3VzZXIgKiBwcmV2aW91czsKLQlpbnQgY291bnQ7Ci0JaW50IGVycm9yOwotfTsKLQotc3RydWN0
IHJlYWRkaXIzMl9jYWxsYmFjayB7Ci0Jc3RydWN0IG9sZF9saW51eDMyX2RpcmVudCBfX3VzZXIg
KiBkaXJlbnQ7Ci0JaW50IGNvdW50OwotfTsKLQotc3RhdGljIGludAotZmlsbGRpcjMyICh2b2lk
ICpfX2J1ZiwgY29uc3QgY2hhciAqbmFtZSwgaW50IG5hbWxlbiwgbG9mZl90IG9mZnNldCwgaW5v
X3QgaW5vLAotCSAgIHVuc2lnbmVkIGludCBkX3R5cGUpCi17Ci0Jc3RydWN0IGxpbnV4MzJfZGly
ZW50IF9fdXNlciAqIGRpcmVudDsKLQlzdHJ1Y3QgZ2V0ZGVudHMzMl9jYWxsYmFjayAqIGJ1ZiA9
IChzdHJ1Y3QgZ2V0ZGVudHMzMl9jYWxsYmFjayAqKSBfX2J1ZjsKLQlpbnQgcmVjbGVuID0gUk9V
TkRfVVAoTkFNRV9PRkZTRVQoZGlyZW50KSArIG5hbWxlbiArIDIsIDQpOwotCi0JYnVmLT5lcnJv
ciA9IC1FSU5WQUw7CS8qIG9ubHkgdXNlZCBpZiB3ZSBmYWlsLi4gKi8KLQlpZiAocmVjbGVuID4g
YnVmLT5jb3VudCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JZGlyZW50ID0gYnVmLT5wcmV2aW91czsK
LQlpZiAoZGlyZW50KQotCQlwdXRfdXNlcihvZmZzZXQsICZkaXJlbnQtPmRfb2ZmKTsKLQlkaXJl
bnQgPSBidWYtPmN1cnJlbnRfZGlyOwotCWJ1Zi0+cHJldmlvdXMgPSBkaXJlbnQ7Ci0JcHV0X3Vz
ZXIoaW5vLCAmZGlyZW50LT5kX2lubyk7Ci0JcHV0X3VzZXIocmVjbGVuLCAmZGlyZW50LT5kX3Jl
Y2xlbik7Ci0JY29weV90b191c2VyKGRpcmVudC0+ZF9uYW1lLCBuYW1lLCBuYW1sZW4pOwotCXB1
dF91c2VyKDAsIGRpcmVudC0+ZF9uYW1lICsgbmFtbGVuKTsKLQlwdXRfdXNlcihkX3R5cGUsIChj
aGFyIF9fdXNlciAqKWRpcmVudCArIHJlY2xlbiAtIDEpOyAKLQlkaXJlbnQgPSAoKHZvaWQgX191
c2VyICopZGlyZW50KSArIHJlY2xlbjsKLQlidWYtPmN1cnJlbnRfZGlyID0gZGlyZW50OwotCWJ1
Zi0+Y291bnQgLT0gcmVjbGVuOwotCXJldHVybiAwOwotfQotCi1hc21saW5rYWdlIGxvbmcKLXN5
czMyX2dldGRlbnRzICh1bnNpZ25lZCBpbnQgZmQsIHZvaWQgX191c2VyICogZGlyZW50LCB1bnNp
Z25lZCBpbnQgY291bnQpCi17Ci0Jc3RydWN0IGZpbGUgKiBmaWxlOwotCXN0cnVjdCBsaW51eDMy
X2RpcmVudCBfX3VzZXIgKiBsYXN0ZGlyZW50OwotCXN0cnVjdCBnZXRkZW50czMyX2NhbGxiYWNr
IGJ1ZjsKLQlpbnQgZXJyb3I7Ci0KLQllcnJvciA9IC1FQkFERjsKLQlmaWxlID0gZmdldChmZCk7
Ci0JaWYgKCFmaWxlKQotCQlnb3RvIG91dDsKLQotCWJ1Zi5jdXJyZW50X2RpciA9IChzdHJ1Y3Qg
bGludXgzMl9kaXJlbnQgX191c2VyICopIGRpcmVudDsKLQlidWYucHJldmlvdXMgPSBOVUxMOwot
CWJ1Zi5jb3VudCA9IGNvdW50OwotCWJ1Zi5lcnJvciA9IDA7Ci0KLQllcnJvciA9IHZmc19yZWFk
ZGlyKGZpbGUsIGZpbGxkaXIzMiwgJmJ1Zik7Ci0JaWYgKGVycm9yIDwgMCkKLQkJZ290byBvdXRf
cHV0ZjsKLQllcnJvciA9IGJ1Zi5lcnJvcjsKLQlsYXN0ZGlyZW50ID0gYnVmLnByZXZpb3VzOwot
CWlmIChsYXN0ZGlyZW50KSB7Ci0JCXB1dF91c2VyKGZpbGUtPmZfcG9zLCAmbGFzdGRpcmVudC0+
ZF9vZmYpOwotCQllcnJvciA9IGNvdW50IC0gYnVmLmNvdW50OwotCX0KLQotb3V0X3B1dGY6Ci0J
ZnB1dChmaWxlKTsKLW91dDoKLQlyZXR1cm4gZXJyb3I7Ci19Ci0KLXN0YXRpYyBpbnQKLWZpbGxv
bmVkaXIzMiAodm9pZCAqIF9fYnVmLCBjb25zdCBjaGFyICogbmFtZSwgaW50IG5hbWxlbiwgbG9m
Zl90IG9mZnNldCwgaW5vX3QgaW5vLCB1bnNpZ25lZCBkX3R5cGUpCi17Ci0Jc3RydWN0IHJlYWRk
aXIzMl9jYWxsYmFjayAqIGJ1ZiA9IChzdHJ1Y3QgcmVhZGRpcjMyX2NhbGxiYWNrICopIF9fYnVm
OwotCXN0cnVjdCBvbGRfbGludXgzMl9kaXJlbnQgX191c2VyICogZGlyZW50OwotCi0JaWYgKGJ1
Zi0+Y291bnQpCi0JCXJldHVybiAtRUlOVkFMOwotCWJ1Zi0+Y291bnQrKzsKLQlkaXJlbnQgPSBi
dWYtPmRpcmVudDsKLQlwdXRfdXNlcihpbm8sICZkaXJlbnQtPmRfaW5vKTsKLQlwdXRfdXNlcihv
ZmZzZXQsICZkaXJlbnQtPmRfb2Zmc2V0KTsKLQlwdXRfdXNlcihuYW1sZW4sICZkaXJlbnQtPmRf
bmFtbGVuKTsKLQljb3B5X3RvX3VzZXIoZGlyZW50LT5kX25hbWUsIG5hbWUsIG5hbWxlbik7Ci0J
cHV0X3VzZXIoMCwgZGlyZW50LT5kX25hbWUgKyBuYW1sZW4pOwotCXJldHVybiAwOwotfQotCi1h
c21saW5rYWdlIGxvbmcKLXN5czMyX29sZHJlYWRkaXIgKHVuc2lnbmVkIGludCBmZCwgdm9pZCBf
X3VzZXIgKiBkaXJlbnQsIHVuc2lnbmVkIGludCBjb3VudCkKLXsKLQlpbnQgZXJyb3I7Ci0Jc3Ry
dWN0IGZpbGUgKiBmaWxlOwotCXN0cnVjdCByZWFkZGlyMzJfY2FsbGJhY2sgYnVmOwotCi0JZXJy
b3IgPSAtRUJBREY7Ci0JZmlsZSA9IGZnZXQoZmQpOwotCWlmICghZmlsZSkKLQkJZ290byBvdXQ7
Ci0KLQlidWYuY291bnQgPSAwOwotCWJ1Zi5kaXJlbnQgPSBkaXJlbnQ7Ci0KLQllcnJvciA9IHZm
c19yZWFkZGlyKGZpbGUsIGZpbGxvbmVkaXIzMiwgJmJ1Zik7Ci0JaWYgKGVycm9yID49IDApCi0J
CWVycm9yID0gYnVmLmNvdW50OwotCWZwdXQoZmlsZSk7Ci1vdXQ6Ci0JcmV0dXJuIGVycm9yOwot
fQotCiBzdHJ1Y3Qgc2VsX2FyZ19zdHJ1Y3QgewogCXVuc2lnbmVkIGludCBuOwogCXVuc2lnbmVk
IGludCBpbnA7CkBAIC0xMjAxLDc1ICsxMDczLDYgQEAKIAlyZXR1cm4gcmV0OwogfSAKIAotYXNt
bGlua2FnZSBsb25nIHN5czMyX2lvX3N1Ym1pdChhaW9fY29udGV4dF90IGN0eF9pZCwgaW50IG5y
LAotCQkgICBjb21wYXRfdXB0cl90IF9fdXNlciAqaW9jYnBwKQotewotCXN0cnVjdCBraW9jdHgg
KmN0eDsKLQlsb25nIHJldCA9IDA7Ci0JaW50IGk7Ci0JCi0JaWYgKHVubGlrZWx5KG5yIDwgMCkp
Ci0JCXJldHVybiAtRUlOVkFMOwotCi0JaWYgKHVubGlrZWx5KCFhY2Nlc3Nfb2soVkVSSUZZX1JF
QUQsIGlvY2JwcCwgKG5yKnNpemVvZigqaW9jYnBwKSkpKSkKLQkJcmV0dXJuIC1FRkFVTFQ7Ci0K
LQljdHggPSBsb29rdXBfaW9jdHgoY3R4X2lkKTsKLQlpZiAodW5saWtlbHkoIWN0eCkpIHsKLQkJ
cHJfZGVidWcoIkVJTlZBTDogaW9fc3VibWl0OiBpbnZhbGlkIGNvbnRleHQgaWRcbiIpOwotCQly
ZXR1cm4gLUVJTlZBTDsgCi0JfSAKLQotCWZvciAoaT0wOyBpPG5yOyBpKyspIHsKLQkJY29tcGF0
X3VwdHJfdCBwMzI7Ci0JCXN0cnVjdCBpb2NiIF9fdXNlciAqdXNlcl9pb2NiOwotCQlzdHJ1Y3Qg
aW9jYiB0bXA7Ci0KLQkJaWYgKHVubGlrZWx5KF9fZ2V0X3VzZXIocDMyLCBpb2NicHAgKyBpKSkp
IHsKLQkJCXJldCA9IC1FRkFVTFQ7Ci0JCQlicmVhazsKLQkJfSAKLQkJdXNlcl9pb2NiID0gY29t
cGF0X3B0cihwMzIpOwotCi0JCWlmICh1bmxpa2VseShjb3B5X2Zyb21fdXNlcigmdG1wLCB1c2Vy
X2lvY2IsIHNpemVvZih0bXApKSkpIHsKLQkJCXJldCA9IC1FRkFVTFQ7Ci0JCQlicmVhazsKLQkJ
fQotCi0JCXJldCA9IGlvX3N1Ym1pdF9vbmUoY3R4LCB1c2VyX2lvY2IsICZ0bXApOwotCQlpZiAo
cmV0KQotCQkJYnJlYWs7Ci0JfQotCi0JcHV0X2lvY3R4KGN0eCk7Ci0JcmV0dXJuIGkgPyBpIDog
cmV0OwotfQotCi0KLWFzbWxpbmthZ2UgbG9uZyBzeXMzMl9pb19nZXRldmVudHMoYWlvX2NvbnRl
eHRfdCBjdHhfaWQsCi0JCQkJIHVuc2lnbmVkIGxvbmcgbWluX25yLAotCQkJCSB1bnNpZ25lZCBs
b25nIG5yLAotCQkJCSBzdHJ1Y3QgaW9fZXZlbnQgX191c2VyICpldmVudHMsCi0JCQkJIHN0cnVj
dCBjb21wYXRfdGltZXNwZWMgX191c2VyICp0aW1lb3V0KQoteyAJCi0JbG9uZyByZXQ7Ci0JbW1f
c2VnbWVudF90IG9sZGZzOyAKLQlzdHJ1Y3QgdGltZXNwZWMgdDsKLQkvKiBIYXJkZW4gYWdhaW5z
dCBib2d1cyBwdHJhY2UgKi8KLQlpZiAobnIgPj0gMHhmZmZmZmZmZiB8fCAKLQkgICAgIWFjY2Vz
c19vayhWRVJJRllfV1JJVEUsIGV2ZW50cywgbnIgKiBzaXplb2Yoc3RydWN0IGlvX2V2ZW50KSkp
Ci0JCXJldHVybiAtRUZBVUxUOwotCWlmICh0aW1lb3V0ICYmIGdldF9jb21wYXRfdGltZXNwZWMo
JnQsIHRpbWVvdXQpKQotCQlyZXR1cm4gLUVGQVVMVDsgCi0Jb2xkZnMgPSBnZXRfZnMoKTsKLQlz
ZXRfZnMoS0VSTkVMX0RTKTsgCi0JcmV0ID0gc3lzX2lvX2dldGV2ZW50cyhjdHhfaWQsbWluX25y
LG5yLGV2ZW50cyx0aW1lb3V0ID8gJnQgOiBOVUxMKTsgCi0Jc2V0X2ZzKG9sZGZzKTsgCi0JaWYg
KCFyZXQgJiYgdGltZW91dCAmJiBwdXRfY29tcGF0X3RpbWVzcGVjKCZ0LCB0aW1lb3V0KSkKLQkJ
cmV0dXJuIC1FRkFVTFQ7IAkJCi0JcmV0dXJuIHJldDsKLX0gCi0KIGFzbWxpbmthZ2UgbG9uZyBz
eXMzMl9vcGVuKGNvbnN0IGNoYXIgX191c2VyICogZmlsZW5hbWUsIGludCBmbGFncywgaW50IG1v
ZGUpCiB7CiAJY2hhciAqIHRtcDsK

------_=_NextPart_001_01C4B587.5C339AA7--
