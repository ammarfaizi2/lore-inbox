Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1030215AbVLJXWa@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1030215AbVLJXWa (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 10 Dec 2005 18:22:30 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932427AbVLJXWa
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 10 Dec 2005 18:22:30 -0500
Received: from 1-1-3-46a.gml.gbg.bostream.se ([82.182.110.161]:41671 "EHLO
	kotiaho.net") by vger.kernel.org with ESMTP id S932387AbVLJXW3
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sat, 10 Dec 2005 18:22:29 -0500
Date: Sun, 11 Dec 2005 00:22:22 +0100 (CET)
From: "J.O. Aho" <trizt@iname.com>
X-X-Sender: trizt@lai.local.lan
To: "David S. Miller" <davem@davemloft.net>
cc: linux-kernel@vger.kernel.org, sparclinux@vger.kernel.org
Subject: Re: Sparc: Kernel 2.6.13 to 2.6.15-rc2 bug when running X11
In-Reply-To: <20051210.150034.67577008.davem@davemloft.net>
Message-ID: <Pine.LNX.4.64.0512110020050.4809@lai.local.lan>
References: <Pine.LNX.4.64.0512102314530.4626@lai.local.lan>
 <20051210.143523.106612727.davem@davemloft.net> <Pine.LNX.4.64.0512102350310.4739@lai.local.lan>
 <20051210.150034.67577008.davem@davemloft.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sat, 10 Dec 2005, David S. Miller wrote:

> From: "J.O. Aho" <trizt@iname.com>
> Date: Sat, 10 Dec 2005 23:52:01 +0100 (CET)
>
>> IO[X:6761]:
>> remap_pfn_range(s[71800000]e[71c10000],f[71800000],pfn[1fc0060],sz[2000],prot[80000000000006b0])
>> IO[X:6761]:
>> remap_pfn_range(s[71800000]e[71c10000],f[71802000],pfn[1fc0060],sz[2000],prot[80000000000006b0])
>
> That's the problem, we're being called twice over the same
> area.
>
> Now we need to figure out why.  Please add this patch and give
> us the new log output.

The output got a lot longer now, but that was expected.


> I'm going to a hockey game so I won't be able to look at this until 
> later this evening.

I hope you will have a nice day with the hockey.


Here is the whole output (output generated by the two patches and the bug 
message too):

sbusfb_mmap: start[70400000] size[1010000] off[5000000]
sbusfb_mmap: page[0] map_size[0]
sbusfb_mmap: page[10000] map_size[0]
sbusfb_mmap: page[20000] map_size[0]
sbusfb_mmap: page[30000] map_size[0]
sbusfb_mmap: page[40000] map_size[0]
sbusfb_mmap: page[50000] map_size[0]
sbusfb_mmap: page[60000] map_size[0]
sbusfb_mmap: page[70000] map_size[0]
sbusfb_mmap: page[80000] map_size[0]
sbusfb_mmap: page[90000] map_size[0]
sbusfb_mmap: page[a0000] map_size[0]
sbusfb_mmap: page[b0000] map_size[0]
sbusfb_mmap: page[c0000] map_size[0]
sbusfb_mmap: page[d0000] map_size[0]
sbusfb_mmap: page[e0000] map_size[0]
sbusfb_mmap: page[f0000] map_size[0]
sbusfb_mmap: page[100000] map_size[0]
sbusfb_mmap: page[110000] map_size[0]
sbusfb_mmap: page[120000] map_size[0]
sbusfb_mmap: page[130000] map_size[0]
sbusfb_mmap: page[140000] map_size[0]
sbusfb_mmap: page[150000] map_size[0]
sbusfb_mmap: page[160000] map_size[0]
sbusfb_mmap: page[170000] map_size[0]
sbusfb_mmap: page[180000] map_size[0]
sbusfb_mmap: page[190000] map_size[0]
sbusfb_mmap: page[1a0000] map_size[0]
sbusfb_mmap: page[1b0000] map_size[0]
sbusfb_mmap: page[1c0000] map_size[0]
sbusfb_mmap: page[1d0000] map_size[0]
sbusfb_mmap: page[1e0000] map_size[0]
sbusfb_mmap: page[1f0000] map_size[0]
sbusfb_mmap: page[200000] map_size[0]
sbusfb_mmap: page[210000] map_size[0]
sbusfb_mmap: page[220000] map_size[0]
sbusfb_mmap: page[230000] map_size[0]
sbusfb_mmap: page[240000] map_size[0]
sbusfb_mmap: page[250000] map_size[0]
sbusfb_mmap: page[260000] map_size[0]
sbusfb_mmap: page[270000] map_size[0]
sbusfb_mmap: page[280000] map_size[0]
sbusfb_mmap: page[290000] map_size[0]
sbusfb_mmap: page[2a0000] map_size[0]
sbusfb_mmap: page[2b0000] map_size[0]
sbusfb_mmap: page[2c0000] map_size[0]
sbusfb_mmap: page[2d0000] map_size[0]
sbusfb_mmap: page[2e0000] map_size[0]
sbusfb_mmap: page[2f0000] map_size[0]
sbusfb_mmap: page[300000] map_size[0]
sbusfb_mmap: page[310000] map_size[0]
sbusfb_mmap: page[320000] map_size[0]
sbusfb_mmap: page[330000] map_size[0]
sbusfb_mmap: page[340000] map_size[0]
sbusfb_mmap: page[350000] map_size[0]
sbusfb_mmap: page[360000] map_size[0]
sbusfb_mmap: page[370000] map_size[0]
sbusfb_mmap: page[380000] map_size[0]
sbusfb_mmap: page[390000] map_size[0]
sbusfb_mmap: page[3a0000] map_size[0]
sbusfb_mmap: page[3b0000] map_size[0]
sbusfb_mmap: page[3c0000] map_size[0]
sbusfb_mmap: page[3d0000] map_size[0]
sbusfb_mmap: page[3e0000] map_size[0]
sbusfb_mmap: page[3f0000] map_size[0]
sbusfb_mmap: page[400000] map_size[0]
sbusfb_mmap: page[410000] map_size[0]
sbusfb_mmap: page[420000] map_size[0]
sbusfb_mmap: page[430000] map_size[0]
sbusfb_mmap: page[440000] map_size[0]
sbusfb_mmap: page[450000] map_size[0]
sbusfb_mmap: page[460000] map_size[0]
sbusfb_mmap: page[470000] map_size[0]
sbusfb_mmap: page[480000] map_size[0]
sbusfb_mmap: page[490000] map_size[0]
sbusfb_mmap: page[4a0000] map_size[0]
sbusfb_mmap: page[4b0000] map_size[0]
sbusfb_mmap: page[4c0000] map_size[0]
sbusfb_mmap: page[4d0000] map_size[0]
sbusfb_mmap: page[4e0000] map_size[0]
sbusfb_mmap: page[4f0000] map_size[0]
sbusfb_mmap: page[500000] map_size[0]
sbusfb_mmap: page[510000] map_size[0]
sbusfb_mmap: page[520000] map_size[0]
sbusfb_mmap: page[530000] map_size[0]
sbusfb_mmap: page[540000] map_size[0]
sbusfb_mmap: page[550000] map_size[0]
sbusfb_mmap: page[560000] map_size[0]
sbusfb_mmap: page[570000] map_size[0]
sbusfb_mmap: page[580000] map_size[0]
sbusfb_mmap: page[590000] map_size[0]
sbusfb_mmap: page[5a0000] map_size[0]
sbusfb_mmap: page[5b0000] map_size[0]
sbusfb_mmap: page[5c0000] map_size[0]
sbusfb_mmap: page[5d0000] map_size[0]
sbusfb_mmap: page[5e0000] map_size[0]
sbusfb_mmap: page[5f0000] map_size[0]
sbusfb_mmap: page[600000] map_size[0]
sbusfb_mmap: page[610000] map_size[0]
sbusfb_mmap: page[620000] map_size[0]
sbusfb_mmap: page[630000] map_size[0]
sbusfb_mmap: page[640000] map_size[0]
sbusfb_mmap: page[650000] map_size[0]
sbusfb_mmap: page[660000] map_size[0]
sbusfb_mmap: page[670000] map_size[0]
sbusfb_mmap: page[680000] map_size[0]
sbusfb_mmap: page[690000] map_size[0]
sbusfb_mmap: page[6a0000] map_size[0]
sbusfb_mmap: page[6b0000] map_size[0]
sbusfb_mmap: page[6c0000] map_size[0]
sbusfb_mmap: page[6d0000] map_size[0]
sbusfb_mmap: page[6e0000] map_size[0]
sbusfb_mmap: page[6f0000] map_size[0]
sbusfb_mmap: page[700000] map_size[0]
sbusfb_mmap: page[710000] map_size[0]
sbusfb_mmap: page[720000] map_size[0]
sbusfb_mmap: page[730000] map_size[0]
sbusfb_mmap: page[740000] map_size[0]
sbusfb_mmap: page[750000] map_size[0]
sbusfb_mmap: page[760000] map_size[0]
sbusfb_mmap: page[770000] map_size[0]
sbusfb_mmap: page[780000] map_size[0]
sbusfb_mmap: page[790000] map_size[0]
sbusfb_mmap: page[7a0000] map_size[0]
sbusfb_mmap: page[7b0000] map_size[0]
sbusfb_mmap: page[7c0000] map_size[0]
sbusfb_mmap: page[7d0000] map_size[0]
sbusfb_mmap: page[7e0000] map_size[0]
sbusfb_mmap: page[7f0000] map_size[0]
sbusfb_mmap: page[800000] map_size[0]
sbusfb_mmap: page[810000] map_size[0]
sbusfb_mmap: page[820000] map_size[0]
sbusfb_mmap: page[830000] map_size[0]
sbusfb_mmap: page[840000] map_size[0]
sbusfb_mmap: page[850000] map_size[0]
sbusfb_mmap: page[860000] map_size[0]
sbusfb_mmap: page[870000] map_size[0]
sbusfb_mmap: page[880000] map_size[0]
sbusfb_mmap: page[890000] map_size[0]
sbusfb_mmap: page[8a0000] map_size[0]
sbusfb_mmap: page[8b0000] map_size[0]
sbusfb_mmap: page[8c0000] map_size[0]
sbusfb_mmap: page[8d0000] map_size[0]
sbusfb_mmap: page[8e0000] map_size[0]
sbusfb_mmap: page[8f0000] map_size[0]
sbusfb_mmap: page[900000] map_size[0]
sbusfb_mmap: page[910000] map_size[0]
sbusfb_mmap: page[920000] map_size[0]
sbusfb_mmap: page[930000] map_size[0]
sbusfb_mmap: page[940000] map_size[0]
sbusfb_mmap: page[950000] map_size[0]
sbusfb_mmap: page[960000] map_size[0]
sbusfb_mmap: page[970000] map_size[0]
sbusfb_mmap: page[980000] map_size[0]
sbusfb_mmap: page[990000] map_size[0]
sbusfb_mmap: page[9a0000] map_size[0]
sbusfb_mmap: page[9b0000] map_size[0]
sbusfb_mmap: page[9c0000] map_size[0]
sbusfb_mmap: page[9d0000] map_size[0]
sbusfb_mmap: page[9e0000] map_size[0]
sbusfb_mmap: page[9f0000] map_size[0]
sbusfb_mmap: page[a00000] map_size[0]
sbusfb_mmap: page[a10000] map_size[0]
sbusfb_mmap: page[a20000] map_size[0]
sbusfb_mmap: page[a30000] map_size[0]
sbusfb_mmap: page[a40000] map_size[0]
sbusfb_mmap: page[a50000] map_size[0]
sbusfb_mmap: page[a60000] map_size[0]
sbusfb_mmap: page[a70000] map_size[0]
sbusfb_mmap: page[a80000] map_size[0]
sbusfb_mmap: page[a90000] map_size[0]
sbusfb_mmap: page[aa0000] map_size[0]
sbusfb_mmap: page[ab0000] map_size[0]
sbusfb_mmap: page[ac0000] map_size[0]
sbusfb_mmap: page[ad0000] map_size[0]
sbusfb_mmap: page[ae0000] map_size[0]
sbusfb_mmap: page[af0000] map_size[0]
sbusfb_mmap: page[b00000] map_size[0]
sbusfb_mmap: page[b10000] map_size[0]
sbusfb_mmap: page[b20000] map_size[0]
sbusfb_mmap: page[b30000] map_size[0]
sbusfb_mmap: page[b40000] map_size[0]
sbusfb_mmap: page[b50000] map_size[0]
sbusfb_mmap: page[b60000] map_size[0]
sbusfb_mmap: page[b70000] map_size[0]
sbusfb_mmap: page[b80000] map_size[0]
sbusfb_mmap: page[b90000] map_size[0]
sbusfb_mmap: page[ba0000] map_size[0]
sbusfb_mmap: page[bb0000] map_size[0]
sbusfb_mmap: page[bc0000] map_size[0]
sbusfb_mmap: page[bd0000] map_size[0]
sbusfb_mmap: page[be0000] map_size[0]
sbusfb_mmap: page[bf0000] map_size[0]
sbusfb_mmap: page[c00000] map_size[0]
sbusfb_mmap: page[c10000] map_size[0]
sbusfb_mmap: page[c20000] map_size[0]
sbusfb_mmap: page[c30000] map_size[0]
sbusfb_mmap: page[c40000] map_size[0]
sbusfb_mmap: page[c50000] map_size[0]
sbusfb_mmap: page[c60000] map_size[0]
sbusfb_mmap: page[c70000] map_size[0]
sbusfb_mmap: page[c80000] map_size[0]
sbusfb_mmap: page[c90000] map_size[0]
sbusfb_mmap: page[ca0000] map_size[0]
sbusfb_mmap: page[cb0000] map_size[0]
sbusfb_mmap: page[cc0000] map_size[0]
sbusfb_mmap: page[cd0000] map_size[0]
sbusfb_mmap: page[ce0000] map_size[0]
sbusfb_mmap: page[cf0000] map_size[0]
sbusfb_mmap: page[d00000] map_size[0]
sbusfb_mmap: page[d10000] map_size[0]
sbusfb_mmap: page[d20000] map_size[0]
sbusfb_mmap: page[d30000] map_size[0]
sbusfb_mmap: page[d40000] map_size[0]
sbusfb_mmap: page[d50000] map_size[0]
sbusfb_mmap: page[d60000] map_size[0]
sbusfb_mmap: page[d70000] map_size[0]
sbusfb_mmap: page[d80000] map_size[0]
sbusfb_mmap: page[d90000] map_size[0]
sbusfb_mmap: page[da0000] map_size[0]
sbusfb_mmap: page[db0000] map_size[0]
sbusfb_mmap: page[dc0000] map_size[0]
sbusfb_mmap: page[dd0000] map_size[0]
sbusfb_mmap: page[de0000] map_size[0]
sbusfb_mmap: page[df0000] map_size[0]
sbusfb_mmap: page[e00000] map_size[0]
sbusfb_mmap: page[e10000] map_size[0]
sbusfb_mmap: page[e20000] map_size[0]
sbusfb_mmap: page[e30000] map_size[0]
sbusfb_mmap: page[e40000] map_size[0]
sbusfb_mmap: page[e50000] map_size[0]
sbusfb_mmap: page[e60000] map_size[0]
sbusfb_mmap: page[e70000] map_size[0]
sbusfb_mmap: page[e80000] map_size[0]
sbusfb_mmap: page[e90000] map_size[0]
sbusfb_mmap: page[ea0000] map_size[0]
sbusfb_mmap: page[eb0000] map_size[0]
sbusfb_mmap: page[ec0000] map_size[0]
sbusfb_mmap: page[ed0000] map_size[0]
sbusfb_mmap: page[ee0000] map_size[0]
sbusfb_mmap: page[ef0000] map_size[0]
sbusfb_mmap: page[f00000] map_size[0]
sbusfb_mmap: page[f10000] map_size[0]
sbusfb_mmap: page[f20000] map_size[0]
sbusfb_mmap: page[f30000] map_size[0]
sbusfb_mmap: page[f40000] map_size[0]
sbusfb_mmap: page[f50000] map_size[0]
sbusfb_mmap: page[f60000] map_size[0]
sbusfb_mmap: page[f70000] map_size[0]
sbusfb_mmap: page[f80000] map_size[0]
sbusfb_mmap: page[f90000] map_size[0]
sbusfb_mmap: page[fa0000] map_size[0]
sbusfb_mmap: page[fb0000] map_size[0]
sbusfb_mmap: page[fc0000] map_size[0]
sbusfb_mmap: page[fd0000] map_size[0]
sbusfb_mmap: page[fe0000] map_size[0]
sbusfb_mmap: page[ff0000] map_size[0]
sbusfb_mmap: page[1000000] map_size[0]
sbusfb_mmap: Done
sbusfb_mmap: start[71800000] size[410000] off[4000000]
sbusfb_mmap: page[0] map_size[2000]
sbusfb_mmap: map_size is now 2000
IO[X:6712]: 
remap_pfn_range(s[71800000]e[71c10000],f[71800000],pfn[1fc0060],sz[2000],prot[80000000000006b0])
sbusfb_mmap: page[2000] map_size[2000]
sbusfb_mmap: map_size is now 2000
IO[X:6712]: 
remap_pfn_range(s[71800000]e[71c10000],f[71802000],pfn[1fc0060],sz[2000],prot[80000000000006b0])
kernel BUG at arch/sparc64/mm/generic.c:77!
               \|/ ____ \|/
               "@'/ .. \`@"
               /_| \__/ |_\
                  \__U_/
X(6712): Kernel bad sw trap 5 [#1]
TSTATE: 0000000011009603 TPC: 0000000000434da0 TNPC: 0000000000434da4 Y: 
00000000    Not tainted
TPC: <io_remap_pfn_range+0x400/0x420>
g0: fffff800024df261 g1: 0000000000669400 g2: 0000000000000001 g3: 
00000000000047ff
g4: fffff80001f34fc0 g5: 0000000000000010 g6: fffff800024d0000 g7: 
0000000000000000
o0: 000000000000002f o1: 000000000061f1e8 o2: 000000000000004d o3: 
0000000011812000
o4: 000001fc00610000 o5: fffff80002578c00 sp: fffff800024df241 ret_pc: 
0000000000434d98
RPC: <io_remap_pfn_range+0x3f8/0x420>
l0: 0000000071802000 l1: 000001fb8edfe000 l2: 0000000071804000 l3: 
000001fb8edfe000
l4: 000001fb8edfe000 l5: e000000000000f8a l6: a000000000000f8a l7: 
c000000000000f8a
i0: 0000000071804000 i1: 0000000071802000 i2: 0000000000000000 i3: 
0000000071802000
i4: 80000000000006b0 i5: fffff800010c000c i6: fffff800024df361 i7: 
000000000053b270
I7: <sbusfb_mmap_helper+0x150/0x1a0>
Caller[000000000053b270]: sbusfb_mmap_helper+0x150/0x1a0
Caller[00000000005335b4]: fb_mmap+0x134/0x160
Caller[0000000000478748]: do_mmap_pgoff+0x368/0x720
Caller[00000000004161d8]: sys_mmap+0xf8/0x160
Caller[0000000000406c94]: linux_sparc_syscall32+0x34/0x40
Caller[0000000000286378]: 0x286378
Instruction DUMP: 9210204d  7fff6e02  901221e8 <91d02005> 7ffff76f 
b13ee000  81cfe008  01000000  30680003




-- 
      //Aho

  ------------------------------------------------------------------------
   E-Mail: trizt@iname.com            URL: http://www.kotiaho.net/~trizt/
      ICQ: 13696780
   System: Linux System                        (PPC7447/1000 AMD K7A/2000)
  ------------------------------------------------------------------------
             EU forbids you to send spam without my permission
  ------------------------------------------------------------------------
