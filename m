Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1161061AbWBYTDh@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1161061AbWBYTDh (ORCPT <rfc822;willy@w.ods.org>);
	Sat, 25 Feb 2006 14:03:37 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1161062AbWBYTDh
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sat, 25 Feb 2006 14:03:37 -0500
Received: from pasmtp.tele.dk ([193.162.159.95]:25349 "EHLO pasmtp.tele.dk")
	by vger.kernel.org with ESMTP id S1161061AbWBYTDh (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sat, 25 Feb 2006 14:03:37 -0500
Date: Sat, 25 Feb 2006 20:03:24 +0100
From: Sam Ravnborg <sam@ravnborg.org>
To: Andrew Morton <akpm@osdl.org>
Cc: Chuck Ebbert <76306.1226@compuserve.com>, roland@redhat.com,
       drepper@redhat.com, linux-kernel@vger.kernel.org
Subject: Re: Bogus objdump output from kernel object files?
Message-ID: <20060225190324.GA9326@mars.ravnborg.org>
References: <200602140458_MC3-1-B85E-D2BA@compuserve.com> <20060214125344.6248a60f.akpm@osdl.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20060214125344.6248a60f.akpm@osdl.org>
User-Agent: Mutt/1.5.11
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Tue, Feb 14, 2006 at 12:53:44PM -0800, Andrew Morton wrote:
> Chuck Ebbert <76306.1226@compuserve.com> wrote:
> >
> > On Sun, 12 Feb 2006 at 01:40:46 -0800, Andrew Morton wrote:
> > 
> >  > btw, is something up with `make foo.lst'?  It hasn't worked for me for
> >  some
> >  > time.
> >  > 
> >  > bix:/usr/src/25> make mm/vmscan.lst
> >  >   MKLST   mm/vmscan.lst
> > 
> >  Just doing 'objdump -d -r -l -j .text mm/vmscan.o' gives:
> > 
> >  mm/vmscan.o:     file format elf32-i386
> > 
> >  Disassembly of section .text:
> > 
> >  00000000 <shrink_slab>:
> >  kswapd_init():
> >  ^^^^^^^^^^^^^^
> >  This is actually at offset 0 in .init.text
> > 
> >  mm/vmscan.c:176
> >         0:       55                      push   %ebp
> >  shrink_slab():
> >  ^^^^^^^^^^^^^^
> >  OK, back to the right location.
> 
> Looks like it's a binutils problem.
> 
> 	http://sources.redhat.com/bugzilla/show_bug.cgi?id=2338
> 
> HJ said he'd try to get this fixed for the next binutils release.

I've played a little with make dir/foo.lst and it sort of seems to work
for me. But I dunno how to really check the output.
objdump spits out a warning on my amd64 due to the --adjust-vma=xxx
but that I suppose is again a binutils issue. The value calculated
generate the correct adjust factor.

The --fverbose-asm cannot omprove output of make dir/foo.lst since
the .lst file is created based on the .o file, whereas --fverbose-asm
only have impact on the file generated by gcc.

Let me know if anyone thinks something is bad with the kbuild
make dir/foo.lst functionality and I will ahve a look.

	Sam
