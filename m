Return-Path: <linux-kernel-owner+willy=40w.ods.org-S265281AbUHHLc5@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S265281AbUHHLc5 (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 8 Aug 2004 07:32:57 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S265287AbUHHLcv
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 8 Aug 2004 07:32:51 -0400
Received: from caramon.arm.linux.org.uk ([212.18.232.186]:21266 "EHLO
	caramon.arm.linux.org.uk") by vger.kernel.org with ESMTP
	id S265285AbUHHLce (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sun, 8 Aug 2004 07:32:34 -0400
Date: Sun, 8 Aug 2004 12:32:30 +0100
From: Russell King <rmk+lkml@arm.linux.org.uk>
To: Sam Ravnborg <sam@ravnborg.org>,
       Linux Kernel List <linux-kernel@vger.kernel.org>
Subject: [PATCH] Fix kallsyms dependency
Message-ID: <20040808123230.B7589@flint.arm.linux.org.uk>
Mail-Followup-To: Sam Ravnborg <sam@ravnborg.org>,
	Linux Kernel List <linux-kernel@vger.kernel.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5.1i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi,

It appears that kallsyms data is not updated if the kallsyms program is
changed.  The following patch adds an appropriate dependency.

(if we can make the kallsyms program depend on the targets generated by
it, could we drop it from being always built ?)

diff -up -x BitKeeper -x ChangeSet -x SCCS -x _xlk -x *.orig -x *.rej orig/Makefile linux/Makefile
--- orig/Makefile	Sun Aug  8 12:14:09 2004
+++ linux/Makefile	Sun Aug  8 12:24:27 2004
@@ -581,7 +581,7 @@ cmd_kallsyms = $(NM) -n $< | $(KALLSYMS)
 .tmp_kallsyms1.o .tmp_kallsyms2.o .tmp_kallsyms3.o: %.o: %.S scripts FORCE
 	$(call if_changed_dep,as_o_S)
 
-.tmp_kallsyms%.S: .tmp_vmlinux%
+.tmp_kallsyms%.S: .tmp_vmlinux% $(KALLSYMS)
 	$(call cmd,kallsyms)
 
 .tmp_vmlinux1: $(vmlinux-objs) arch/$(ARCH)/kernel/vmlinux.lds.s FORCE

-- 
Russell King
 Linux kernel    2.6 ARM Linux   - http://www.arm.linux.org.uk/
 maintainer of:  2.6 PCMCIA      - http://pcmcia.arm.linux.org.uk/
                 2.6 Serial core
