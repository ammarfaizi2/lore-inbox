Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S263215AbUDMCme (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 12 Apr 2004 22:42:34 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S263232AbUDMCme
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 12 Apr 2004 22:42:34 -0400
Received: from smtp02.mrf.mail.rcn.net ([207.172.4.61]:30635 "EHLO
	smtp02.mrf.mail.rcn.net") by vger.kernel.org with ESMTP
	id S263215AbUDMCmc (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 12 Apr 2004 22:42:32 -0400
Date: Mon, 12 Apr 2004 21:47:18 -0500
Subject: Re: 2.6.5-mm4
Message-ID: <0cfc7cc572bd097ba649861b6eb5f91c@localhost.localdomain>
MIME-Version: 1.0 (Generated by Pantomime 1.2.0)
From: Michael Baehr <mike@conio.net>
To: Marcus Hartig <m.f.h@web.de>
Cc: Sam Ravnborg <sam@ravnborg.org>, linux-kernel@vger.kernel.org
Reply-To: mike@conio.net
Organization: What Oic Lol
In-Reply-To: <407B00AE.7010306@web.de>
X-Mailer: GNUMail.app (Version 1.2.0)
Content-Type: text/plain; charset="us-ascii"; format="flowed"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On 2004-04-12 15:48:46 -0500 Marcus Hartig <m.f.h@web.de> wrote:

> Sam Ravnborg wrote:
> 
>> I would not be suprised if NVIDIA (and wmware for that matter) takes 
>> some
>> assumptions which it should not. But I need to find out why it break,
>> and for that I need more information!
> 
> Yes. I had cut off the whole nVidia install tree. The GLX driver are 
> working, 
> but only the kernel module is in /usr/src/nv eg. I change to this dir 
> and 
> type "make install" then the Makefile.kbuild for 2.6 tries to build 
> it 
> against an 2.6 kernel. Goes with all included -mm3 and others here.
> 
> LD [M]  /usr/src/nv/nvidia.o
> /bin/sh: line 1: /usr/src/nv/.tmp_versions/nvidia.mod: No such file 
> or 
> directory  Building modules, stage 2.
> make[1]: Leaving directory `/usr/src/linux-2.6.5-mm4'
> nvidia.ko failed to build!
> make: *** [module] Error 1
> 
> strace gives not more.
> Also when I set KBUILD_EXTMOD=/usr/src/nv or to new
> 
> KBUILD_PARAMS := -C $(KERNEL_SOURCES) M=$(PWD)
> 
> in the Makefile of the nVidia source, I get this error above. Hmm.
> 
> Marcus
> -

I had these problems building nvidia driver and vmware drivers today 
after I upgraded to mm4 (with love-sources patchset as well).  I 
traced them down to a single change in the kernel Makefile which, 
after I reversed it, allowed the modules to successfully build (and my 
-mm4 kernel is happily tainted with them right now).

-export MODVERDIR := .tmp_versions
+export MODVERDIR := $(if 
$(KBUILD_EXTMOD),$(KBUILD_EXTMOD)/).tmp_versions
+                .tmp_kallsyms* .tmp_version .tmp_vmlinux*

Likely the problem _is_ nvidia and vmware coders making assumptions 
that they should not.  In any case, I'm glad to see others are 
noticing this problem and it will probably be fixed soon.

This is the sort of error I was getting with nvidia (done manually for 
clarity):

21:45:09 <@root|/usr/src/linux> 
SUBDIRS=/usr/src/archives/nvidia/NVIDIA-Linux-x86-1.0-5336-pkg1/usr/src/nv/ 
make modules
< bunch of text... compiling, etc... >
   LD [M]  
/usr/src/archives/nvidia/NVIDIA-Linux-x86-1.0-5336-pkg1/usr/src/nv//nvidia.o
/bin/sh: line 1: 
/usr/src/archives/nvidia/NVIDIA-Linux-x86-1.0-5336-pkg1/usr/src/nv//.tmp_versions/nvidia.mod: 
No such file or directory

Similar error with vmware (and I don't feel like going through the 
work of reproducing it atm XD)

Cheers,

Mike

