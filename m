Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262047AbTHaOSw (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 31 Aug 2003 10:18:52 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262036AbTHaOSw
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 31 Aug 2003 10:18:52 -0400
Received: from pasky.ji.cz ([213.226.226.138]:23799 "HELO machine.sinus.cz")
	by vger.kernel.org with SMTP id S262469AbTHaORw (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 31 Aug 2003 10:17:52 -0400
Date: Sun, 31 Aug 2003 16:17:48 +0200
From: Petr Baudis <pasky@ucw.cz>
To: linux-kernel@vger.kernel.org
Subject: Re: USB not working correctly in 2.6.0-test4-mm4
Message-ID: <20030831141748.GA1141@pasky.ji.cz>
Mail-Followup-To: linux-kernel@vger.kernel.org
References: <20030831115903.GA2298@pasky.ji.cz>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030831115903.GA2298@pasky.ji.cz>
User-Agent: Mutt/1.4i
X-message-flag: Outlook : A program to spread viri, but it can do mail too.
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Dear diary, on Sun, Aug 31, 2003 at 01:59:03PM CEST, I got a letter,
where Petr Baudis <pasky@ucw.cz> told me, that...
>   Hello,
> 
>   I'm getting an oops when I try to connect my Zaurus (SL5500). When booting,
> hotplug brings up usb without problems:
> 
> drivers/usb/core/usb.c: registered new driver usbfs
> drivers/usb/core/usb.c: registered new driver hub
> drivers/usb/host/uhci-hcd.c: USB Universal Host Controller Interface driver v2.1
> PCI: Found IRQ 5 for device 0000:00:07.2
> PCI: Sharing IRQ 5 with 0000:00:07.3
> uhci-hcd 0000:00:07.2: UHCI Host Controller
> uhci-hcd 0000:00:07.2: irq 5, io base 0000d400
> uhci-hcd 0000:00:07.2: new USB bus registered, assigned bus number 1
> PM: Adding info for usb:usb1
> PM: Adding info for usb:1-0:0
> hub 1-0:0: USB hub found
> hub 1-0:0: 2 ports detected
> PCI: Found IRQ 5 for device 0000:00:07.3
> PCI: Sharing IRQ 5 with 0000:00:07.2
> uhci-hcd 0000:00:07.3: UHCI Host Controller
> uhci-hcd 0000:00:07.3: irq 5, io base 0000d800
> uhci-hcd 0000:00:07.3: new USB bus registered, assigned bus number 2
> PM: Adding info for usb:usb2
> PM: Adding info for usb:2-0:0
> hub 2-0:0: USB hub found
> hub 2-0:0: 2 ports detected
> 
>   However, when I insert Zaurus into the bay...
> 
> Aug 31 13:49:10 machine kernel: hub 2-0:0: debounce: port 2: delay 100ms stable 4 status 0x101
> Aug 31 13:49:10 machine kernel: hub 2-0:0: new USB device on port 2, assigned address 2
> Aug 31 13:49:10 machine kernel: PM: Adding info for usb:2-2
> Aug 31 13:49:10 machine kernel: PM: Adding info for usb:2-2:0
> Aug 31 13:49:10 machine kernel: PM: Adding info for usb:2-2:1
> Unable to handle kernel paging request at virtual address 10783238
>  printing eip:
> c99b5262
> *pde = 00000000
> Oops: 0000 [#1]
> PREEMPT
> CPU:    0
> EIP:    0060:[<c99b5262>]    Not tainted VLI
> EFLAGS: 00010246
> EIP is at cdc_bind+0x116/0x2b0 [usbnet]
> eax: 000000c4   ebx: c73efab2   ecx: c2c12124   edx: 10783236
> esi: 00000005   edi: c226989c   ebp: c2945ec8   esp: c2945ea4
> ds: 007b   es: 007b   ss: 0068
> Process modprobe (pid: 2215, threadinfo=c2944000 task=c30c0080)
> Stack: c1c4b400 c99b716e c99b6ee0 c226989c c1c4b400 c2945ecc c99b716e c1c4b406
>        c2945efc c2945efc c99b6a4f c2269800 c2c12060 c99b81d8 c99b81c0 c99b71e8
>        c2269800 c22690d0 fffffff4 c2269000 c99b6ee0 c29b4d20 c2945f24 c987107b
> Call Trace:
>  [<c99b6a4f>] usbnet_probe+0x1eb/0x3dc [usbnet]
>  [<c987107b>] usb_probe_interface+0x6b/0x98 [usbcore]
>  [<c01cfac6>] bus_match+0x32/0x58
>  [<c01cfbc4>] driver_attach+0x44/0x80
>  [<c01cfe4d>] bus_add_driver+0x85/0xa0
>  [<c01d01e2>] driver_register+0x36/0x38
>  [<c98711a7>] usb_register+0x6f/0xa4 [usbcore]
>  [<c983d027>] usbnet_init+0x27/0x37 [usbnet]
>  [<c012f4ea>] sys_init_module+0x11e/0x250
>  [<c0293757>] syscall_call+0x7/0xb
> 
> Code: 0c 89 57 10 0f b6 43 03 69 c0 c4 00 00 00 01 d0 39 45 0c 0f 85 80 01 00 00 0f b6 43 04 69 c0 c4 00 00 00 8d 0c 10 89 4f 10 8b 11 <8a> 42 02 38 43 04 0f 85 62 01 00 00 80 7a 05 0a 0f 85 58 01 00
> 
>   The kernel survived, though (I'm writing this mail on it yet, at least :).
> After removing Zaurus from the bay, it normally emitted
> 
> Aug 31 13:50:04 machine kernel: usb 2-2: USB disconnect, address 2
> 
>   but it ignores any further events generated by Zaurus - it does not react to
> further inserts or removals (I have no other USB device available).
> 
>   I'm using:
> 
> Linux machine 2.6.0-test4-mm4 #1 Sun Aug 31 12:25:56 CEST 2003 i586 unknown

FYI, it is reproducible with vanilla 2.6.0-test4 as well.

Kind regards,

-- 
 
				Petr "Pasky" Baudis
.
Perfection is reached, not when there is no longer anything to add, but when
there is no longer anything to take away.
	-- Antoine de Saint-Exupery
.
Stuff: http://pasky.ji.cz/
