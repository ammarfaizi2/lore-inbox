Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262006AbTINWKb (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 14 Sep 2003 18:10:31 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261663AbTINWKb
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 14 Sep 2003 18:10:31 -0400
Received: from kweetal.tue.nl ([131.155.3.6]:57102 "EHLO kweetal.tue.nl")
	by vger.kernel.org with ESMTP id S262006AbTINWK2 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 14 Sep 2003 18:10:28 -0400
Date: Mon, 15 Sep 2003 00:10:24 +0200
From: Andries Brouwer <aebr@win.tue.nl>
To: Petr Vandrovec <vandrove@vc.cvut.cz>
Cc: Andries Brouwer <aebr@win.tue.nl>, Zwane Mwaikambo <zwane@linuxpower.ca>,
       vojtech@suse.cz, linux-kernel@vger.kernel.org
Subject: Re: Another keyboard woes with 2.6.0...
Message-ID: <20030915001024.C11134@pclin040.win.tue.nl>
References: <2F284368A@vcnet.vc.cvut.cz> <20030913205244.A3295@pclin040.win.tue.nl> <20030913214047.GF8973@vana.vc.cvut.cz> <20030914121323.B3371@pclin040.win.tue.nl> <20030914123444.D3371@pclin040.win.tue.nl> <20030914195216.GB9200@vana.vc.cvut.cz>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5.1i
In-Reply-To: <20030914195216.GB9200@vana.vc.cvut.cz>; from vandrove@vc.cvut.cz on Sun, Sep 14, 2003 at 09:52:16PM +0200
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, Sep 14, 2003 at 09:52:16PM +0200, Petr Vandrovec wrote:

> > Hmm. Yes. An F7 that is never released.
> > Is that what you see - an infinitely repeated F7 until
> > you hit the next key?
> 
> Yes. It is what I was trying to tell by "confuses everything".
>  
> > And the 0x41 is generated by this switch?
> 
> Yes.
>  
> > And it also occurs on 2.4 but there nothing bad happens?
> 
> It looks to me like that it does. We get one 0x41 when we
> send ED 00, and second time after enabling keyboard by F4,
> like 2.6.x does... But it is not that serious under 2.4.x...

No - it is sent only once (and, I suppose, gives a little bit of garbage
to whatever process eats it in 2.4) but in 2.6 it is repeated.

A separate micro project might be to find out precisely when this
switch sends this code, and whether it can send other codes.

To save this machine for 2.6 no doubt you can invent something
most suitable for you. Replacing input.c:input_repeat_key()
by a dummy routine kills all key repeat.
The key that is repeated is dev->repeat_key, and we have the
keycode there if I am not mistaken, not the scancode, but they
are equal in this case, so you might also add
	if (dev->repeat_key == 65)
		return;
at the start of input_repeat_key().

In the mean time we must invent a real solution instead of a stopgap.

Andries

