Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261509AbTINTwa (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 14 Sep 2003 15:52:30 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261586AbTINTwa
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 14 Sep 2003 15:52:30 -0400
Received: from vana.vc.cvut.cz ([147.32.240.58]:40067 "EHLO vana.vc.cvut.cz")
	by vger.kernel.org with ESMTP id S261509AbTINTw1 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 14 Sep 2003 15:52:27 -0400
Date: Sun, 14 Sep 2003 21:52:16 +0200
From: Petr Vandrovec <vandrove@vc.cvut.cz>
To: Andries Brouwer <aebr@win.tue.nl>
Cc: Zwane Mwaikambo <zwane@linuxpower.ca>, vojtech@suse.cz,
       linux-kernel@vger.kernel.org
Subject: Re: Another keyboard woes with 2.6.0...
Message-ID: <20030914195216.GB9200@vana.vc.cvut.cz>
References: <2F284368A@vcnet.vc.cvut.cz> <20030913205244.A3295@pclin040.win.tue.nl> <20030913214047.GF8973@vana.vc.cvut.cz> <20030914121323.B3371@pclin040.win.tue.nl> <20030914123444.D3371@pclin040.win.tue.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030914123444.D3371@pclin040.win.tue.nl>
User-Agent: Mutt/1.5.4i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, Sep 14, 2003 at 12:34:44PM +0200, Andries Brouwer wrote:
> On Sun, Sep 14, 2003 at 12:13:23PM +0200, Andries Brouwer wrote:
> 
> > > From log it looks like that switch likes 0x41 a lot: it reports ID 0x41AB,
> > > it reports current scan set 0x41, and when we enable it, it returns spurious
> > > 0x41... And the last 0x41 is one which confuses everything.
> > 
> > Yes. ID is OK. Scancode set is OK. But the final one is unexpected.
> > 
> > You say "confuses everything".
> > Is it not treated as a keypress for the F7 key?
> 
> Hmm. Yes. An F7 that is never released.
> Is that what you see - an infinitely repeated F7 until
> you hit the next key?

Yes. It is what I was trying to tell by "confuses everything".
 
> And the 0x41 is generated by this switch?

Yes.
 
> And it also occurs on 2.4 but there nothing bad happens?

It looks to me like that it does. We get one 0x41 when we
send ED 00, and second time after enabling keyboard by F4,
like 2.6.x does... But it is not that serious under 2.4.x...

Full log, including reads from status (0x64) register under 2.4.x is at
http://platan.vc.cvut.cz/cs1016-24.log.
						Petr Vandrovec


Linux version 2.4.22-ac1 (root@placatec) (gcc version 3.3.2 20030908 (Debian prerelease)) #5 SMP Sun Sep 14 21:35:38 CEST 2003
...
Non-volatile memory driver v1.2
WOutput: ED
RInput: FA
WOutput: 00
RInput: FA
RInput: 41                <<<<<<<<<<<<<<<
FDC 0 is a post-1991 82077
RAMDISK driver initialized: 16 RAM disks of 4096K size 1024 blocksize
...
Adding Swap: 1959920k swap-space (priority -1)
e1000: eth0 NIC Link is Up 1000 Mbps Full Duplex
WCmd: A8
WCmd: D4
WOutput: F4
WCmd: 60
RInput: FA
WOutput: 47
WOutput: F4
RInput: FA
RInput: 41		<<<<<<<<<<<<<<<<<<<
WCmd: D4
WOutput: F6
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: C8
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: 64
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: 50
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: C8
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: C8
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: 50
RInput: FA
WCmd: D4
WOutput: E6
RInput: FA
WCmd: D4
WOutput: F3
WCmd: D4
RInput: FA
WOutput: 64
RInput: FA
WCmd: D4
WOutput: F2
RInput: FA
WCmd: D4
WOutput: EA
RInput: FA
WCmd: D4
WOutput: F4
RInput: FA
