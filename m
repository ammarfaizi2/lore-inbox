Return-Path: <linux-kernel-owner+willy=40w.ods.org-S268010AbUHEWGW@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S268010AbUHEWGW (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 5 Aug 2004 18:06:22 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S268002AbUHEWEg
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 5 Aug 2004 18:04:36 -0400
Received: from hqemgate00.nvidia.com ([216.228.112.144]:37636 "EHLO
	hqemgate00.nvidia.com") by vger.kernel.org with ESMTP
	id S268007AbUHEWBc (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 5 Aug 2004 18:01:32 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5.7226.0
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C47B37.C2508C45"
Subject: [PATCH 2.4.27-rc3] sata_nv.c
Date: Thu, 5 Aug 2004 15:01:28 -0700
Message-ID: <DBFABB80F7FD3143A911F9E6CFD477B03F9622@hqemmail02.nvidia.com>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: [PATCH 2.4.27-rc3] sata_nv.c
Thread-Index: AcR0C1TpQP7X89+/TRuAZWllJhA6jAHK0b8A
From: "Andrew Chew" <achew@nvidia.com>
To: "Jeff Garzik" <jgarzik@pobox.com>
Cc: <linux-kernel@vger.kernel.org>, <linux-ide@vger.kernel.org>
X-OriginalArrivalTime: 05 Aug 2004 22:01:29.0485 (UTC) FILETIME=[C2CD03D0:01C47B37]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------_=_NextPart_001_01C47B37.C2508C45
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

The attached patch adds NVIDIA SATA controller support under libata for
the 2.4 series kernel, as well as a patch to libata-core.c that
addresses the following issues.

A minor change to libata-core.c needs to accompany this patch.  This is
in regards to the function ata_pci_remove_one(), where the
host_set->ops->host_stop(host_set) needs to occur before the
iounmap(host_set->mmio_base).  This is because sata_nv's host_stop
callback needs access to the iomapped region.

In addition, in ata_pci_remove_one(), the call to
scsi_unregister_module() seems out of place, since the individual SATA
drivers are doing this in their cleanup routines.

------_=_NextPart_001_01C47B37.C2508C45
Content-Type: application/octet-stream;
	name="sata_nv_2-4.diff"
Content-Transfer-Encoding: base64
Content-Description: sata_nv_2-4.diff
Content-Disposition: attachment;
	filename="sata_nv_2-4.diff"

LS0tIGxpbnV4LTIuNC4yNy1yYzMvZHJpdmVycy9zY3NpL3NhdGFfbnYuYwkxOTY5LTEyLTMxIDE2
OjAwOjAwLjAwMDAwMDAwMCAtMDgwMAorKysgbGludXgvZHJpdmVycy9zY3NpL3NhdGFfbnYuYwky
MDA0LTA4LTA1IDE0OjQ2OjEwLjAwMDAwMDAwMCAtMDcwMApAQCAtMCwwICsxLDU0MyBAQAorLyoK
KyAqICBzYXRhX252LmMgLSBOVklESUEgbkZvcmNlIFNBVEEKKyAqCisgKiAgQ29weXJpZ2h0IDIw
MDQgTlZJRElBIENvcnAuICBBbGwgcmlnaHRzIHJlc2VydmVkLgorICogIENvcHlyaWdodCAyMDA0
IEFuZHJldyBDaGV3CisgKgorICogIFRoZSBjb250ZW50cyBvZiB0aGlzIGZpbGUgYXJlIHN1Ympl
Y3QgdG8gdGhlIE9wZW4KKyAqICBTb2Z0d2FyZSBMaWNlbnNlIHZlcnNpb24gMS4xIHRoYXQgY2Fu
IGJlIGZvdW5kIGF0CisgKiAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9vc2wt
MS4xLnR4dCBhbmQgaXMgaW5jbHVkZWQgaGVyZWluCisgKiAgYnkgcmVmZXJlbmNlLgorICoKKyAq
ICBBbHRlcm5hdGl2ZWx5LCB0aGUgY29udGVudHMgb2YgdGhpcyBmaWxlIG1heSBiZSB1c2VkIHVu
ZGVyIHRoZSB0ZXJtcworICogIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJz
aW9uIDIgKHRoZSAiR1BMIikgYXMgZGlzdHJpYnV0ZWQKKyAqICBpbiB0aGUga2VybmVsIHNvdXJj
ZSBDT1BZSU5HIGZpbGUsIGluIHdoaWNoIGNhc2UgdGhlIHByb3Zpc2lvbnMgb2YKKyAqICB0aGUg
R1BMIGFyZSBhcHBsaWNhYmxlIGluc3RlYWQgb2YgdGhlIGFib3ZlLiAgSWYgeW91IHdpc2ggdG8g
YWxsb3cKKyAqICB0aGUgdXNlIG9mIHlvdXIgdmVyc2lvbiBvZiB0aGlzIGZpbGUgb25seSB1bmRl
ciB0aGUgdGVybXMgb2YgdGhlCisgKiAgR1BMIGFuZCBub3QgdG8gYWxsb3cgb3RoZXJzIHRvIHVz
ZSB5b3VyIHZlcnNpb24gb2YgdGhpcyBmaWxlIHVuZGVyCisgKiAgdGhlIE9TTCwgaW5kaWNhdGUg
eW91ciBkZWNpc2lvbiBieSBkZWxldGluZyB0aGUgcHJvdmlzaW9ucyBhYm92ZSBhbmQKKyAqICBy
ZXBsYWNlIHRoZW0gd2l0aCB0aGUgbm90aWNlIGFuZCBvdGhlciBwcm92aXNpb25zIHJlcXVpcmVk
IGJ5IHRoZSBHUEwuCisgKiAgSWYgeW91IGRvIG5vdCBkZWxldGUgdGhlIHByb3Zpc2lvbnMgYWJv
dmUsIGEgcmVjaXBpZW50IG1heSB1c2UgeW91cgorICogIHZlcnNpb24gb2YgdGhpcyBmaWxlIHVu
ZGVyIGVpdGhlciB0aGUgT1NMIG9yIHRoZSBHUEwuCisgKgorICogIDAuMDIKKyAqICAgICAtIEFk
ZGVkIHN1cHBvcnQgZm9yIENLODA0IFNBVEEgY29udHJvbGxlci4KKyAqCisgKiAgMC4wMQorICog
ICAgIC0gSW5pdGlhbCByZXZpc2lvbi4KKyAqLworCisjaW5jbHVkZSA8bGludXgvY29uZmlnLmg+
CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+Cisj
aW5jbHVkZSA8bGludXgvcGNpLmg+CisjaW5jbHVkZSA8bGludXgvaW5pdC5oPgorI2luY2x1ZGUg
PGxpbnV4L2Jsa2Rldi5oPgorI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGlu
dXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSAic2NzaS5oIgorI2luY2x1ZGUgPHNjc2kvc2NzaV9o
b3N0Lmg+CisjaW5jbHVkZSA8bGludXgvbGliYXRhLmg+CisKKyNkZWZpbmUgRFJWX05BTUUJCQki
c2F0YV9udiIKKyNkZWZpbmUgRFJWX1ZFUlNJT04JCQkiMC4wMiIKKworI2RlZmluZSBOVl9QT1JU
UwkJCTIKKyNkZWZpbmUgTlZfUElPX01BU0sJCQkweDFmCisjZGVmaW5lIE5WX1VETUFfTUFTSwkJ
CTB4N2YKKyNkZWZpbmUgTlZfUE9SVDBfQk1ETUFfUkVHX09GRlNFVAkweDAwCisjZGVmaW5lIE5W
X1BPUlQxX0JNRE1BX1JFR19PRkZTRVQJMHgwOAorI2RlZmluZSBOVl9QT1JUMF9TQ1JfUkVHX09G
RlNFVAkJMHgwMAorI2RlZmluZSBOVl9QT1JUMV9TQ1JfUkVHX09GRlNFVAkJMHg0MAorCisjZGVm
aW5lIE5WX0lOVF9TVEFUVVMJCQkweDEwCisjZGVmaW5lIE5WX0lOVF9TVEFUVVNfQ0s4MDQJCTB4
NDQwCisjZGVmaW5lIE5WX0lOVF9TVEFUVVNfUERFVl9JTlQJCTB4MDEKKyNkZWZpbmUgTlZfSU5U
X1NUQVRVU19QREVWX1BNCQkweDAyCisjZGVmaW5lIE5WX0lOVF9TVEFUVVNfUERFVl9BRERFRAkw
eDA0CisjZGVmaW5lIE5WX0lOVF9TVEFUVVNfUERFVl9SRU1PVkVECTB4MDgKKyNkZWZpbmUgTlZf
SU5UX1NUQVRVU19TREVWX0lOVAkJMHgxMAorI2RlZmluZSBOVl9JTlRfU1RBVFVTX1NERVZfUE0J
CTB4MjAKKyNkZWZpbmUgTlZfSU5UX1NUQVRVU19TREVWX0FEREVECTB4NDAKKyNkZWZpbmUgTlZf
SU5UX1NUQVRVU19TREVWX1JFTU9WRUQJMHg4MAorI2RlZmluZSBOVl9JTlRfU1RBVFVTX1BERVZf
SE9UUExVRwkoTlZfSU5UX1NUQVRVU19QREVWX0FEREVEIHwgXAorCQkJCQlOVl9JTlRfU1RBVFVT
X1BERVZfUkVNT1ZFRCkKKyNkZWZpbmUgTlZfSU5UX1NUQVRVU19TREVWX0hPVFBMVUcJKE5WX0lO
VF9TVEFUVVNfU0RFVl9BRERFRCB8IFwKKwkJCQkJTlZfSU5UX1NUQVRVU19TREVWX1JFTU9WRUQp
CisjZGVmaW5lIE5WX0lOVF9TVEFUVVNfSE9UUExVRwkJKE5WX0lOVF9TVEFUVVNfUERFVl9IT1RQ
TFVHIHwgXAorCQkJCQlOVl9JTlRfU1RBVFVTX1NERVZfSE9UUExVRykKKworI2RlZmluZSBOVl9J
TlRfRU5BQkxFCQkJMHgxMQorI2RlZmluZSBOVl9JTlRfRU5BQkxFX0NLODA0CQkweDQ0MQorI2Rl
ZmluZSBOVl9JTlRfRU5BQkxFX1BERVZfTUFTSwkJMHgwMQorI2RlZmluZSBOVl9JTlRfRU5BQkxF
X1BERVZfUE0JCTB4MDIKKyNkZWZpbmUgTlZfSU5UX0VOQUJMRV9QREVWX0FEREVECTB4MDQKKyNk
ZWZpbmUgTlZfSU5UX0VOQUJMRV9QREVWX1JFTU9WRUQJMHgwOAorI2RlZmluZSBOVl9JTlRfRU5B
QkxFX1NERVZfTUFTSwkJMHgxMAorI2RlZmluZSBOVl9JTlRfRU5BQkxFX1NERVZfUE0JCTB4MjAK
KyNkZWZpbmUgTlZfSU5UX0VOQUJMRV9TREVWX0FEREVECTB4NDAKKyNkZWZpbmUgTlZfSU5UX0VO
QUJMRV9TREVWX1JFTU9WRUQJMHg4MAorI2RlZmluZSBOVl9JTlRfRU5BQkxFX1BERVZfSE9UUExV
RwkoTlZfSU5UX0VOQUJMRV9QREVWX0FEREVEIHwgXAorCQkJCQlOVl9JTlRfRU5BQkxFX1BERVZf
UkVNT1ZFRCkKKyNkZWZpbmUgTlZfSU5UX0VOQUJMRV9TREVWX0hPVFBMVUcJKE5WX0lOVF9FTkFC
TEVfU0RFVl9BRERFRCB8IFwKKwkJCQkJTlZfSU5UX0VOQUJMRV9TREVWX1JFTU9WRUQpCisjZGVm
aW5lIE5WX0lOVF9FTkFCTEVfSE9UUExVRwkJKE5WX0lOVF9FTkFCTEVfUERFVl9IT1RQTFVHIHwg
XAorCQkJCQlOVl9JTlRfRU5BQkxFX1NERVZfSE9UUExVRykKKworI2RlZmluZSBOVl9JTlRfQ09O
RklHCQkJMHgxMgorI2RlZmluZSBOVl9JTlRfQ09ORklHX01FVEhECQkweDAxIC8vIDAgPSBJTlQs
IDEgPSBTTUkKKworLy8gRm9yIFBDSSBjb25maWcgcmVnaXN0ZXIgMjAKKyNkZWZpbmUgTlZfTUNQ
X1NBVEFfQ0ZHXzIwCQkweDUwCisjZGVmaW5lIE5WX01DUF9TQVRBX0NGR18yMF9TQVRBX1NQQUNF
X0VOCTB4MDQKKworc3RhdGljIGludCBudl9pbml0X29uZSAoc3RydWN0IHBjaV9kZXYgKnBkZXYs
IGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICplbnQpOworaXJxcmV0dXJuX3QgbnZfaW50ZXJy
dXB0IChpbnQgaXJxLCB2b2lkICpkZXZfaW5zdGFuY2UsIHN0cnVjdCBwdF9yZWdzICpyZWdzKTsK
K3N0YXRpYyB1MzIgbnZfc2NyX3JlYWQgKHN0cnVjdCBhdGFfcG9ydCAqYXAsIHVuc2lnbmVkIGlu
dCBzY19yZWcpOworc3RhdGljIHZvaWQgbnZfc2NyX3dyaXRlIChzdHJ1Y3QgYXRhX3BvcnQgKmFw
LCB1bnNpZ25lZCBpbnQgc2NfcmVnLCB1MzIgdmFsKTsKK3N0YXRpYyB2b2lkIG52X2hvc3Rfc3Rv
cCAoc3RydWN0IGF0YV9ob3N0X3NldCAqaG9zdF9zZXQpOworc3RhdGljIHZvaWQgbnZfZW5hYmxl
X2hvdHBsdWcoc3RydWN0IGF0YV9wcm9iZV9lbnQgKnByb2JlX2VudCk7CitzdGF0aWMgdm9pZCBu
dl9kaXNhYmxlX2hvdHBsdWcoc3RydWN0IGF0YV9ob3N0X3NldCAqaG9zdF9zZXQpOworc3RhdGlj
IHZvaWQgbnZfY2hlY2tfaG90cGx1ZyhzdHJ1Y3QgYXRhX2hvc3Rfc2V0ICpob3N0X3NldCk7Citz
dGF0aWMgdm9pZCBudl9lbmFibGVfaG90cGx1Z19jazgwNChzdHJ1Y3QgYXRhX3Byb2JlX2VudCAq
cHJvYmVfZW50KTsKK3N0YXRpYyB2b2lkIG52X2Rpc2FibGVfaG90cGx1Z19jazgwNChzdHJ1Y3Qg
YXRhX2hvc3Rfc2V0ICpob3N0X3NldCk7CitzdGF0aWMgdm9pZCBudl9jaGVja19ob3RwbHVnX2Nr
ODA0KHN0cnVjdCBhdGFfaG9zdF9zZXQgKmhvc3Rfc2V0KTsKKworZW51bSBudl9ob3N0X3R5cGUK
K3sKKwlORk9SQ0UyLAorCU5GT1JDRTMsCisJQ0s4MDQKK307CisKK3N0YXRpYyBzdHJ1Y3QgcGNp
X2RldmljZV9pZCBudl9wY2lfdGJsW10gPSB7CisJeyBQQ0lfVkVORE9SX0lEX05WSURJQSwgUENJ
X0RFVklDRV9JRF9OVklESUFfTkZPUkNFMlNfU0FUQSwKKwkJUENJX0FOWV9JRCwgUENJX0FOWV9J
RCwgMCwgMCwgTkZPUkNFMiB9LAorCXsgUENJX1ZFTkRPUl9JRF9OVklESUEsIFBDSV9ERVZJQ0Vf
SURfTlZJRElBX05GT1JDRTNTX1NBVEEsCisJCVBDSV9BTllfSUQsIFBDSV9BTllfSUQsIDAsIDAs
IE5GT1JDRTMgfSwKKwl7IFBDSV9WRU5ET1JfSURfTlZJRElBLCBQQ0lfREVWSUNFX0lEX05WSURJ
QV9ORk9SQ0UzU19TQVRBMiwKKwkJUENJX0FOWV9JRCwgUENJX0FOWV9JRCwgMCwgMCwgTkZPUkNF
MyB9LAorCXsgUENJX1ZFTkRPUl9JRF9OVklESUEsIFBDSV9ERVZJQ0VfSURfTlZJRElBX05GT1JD
RV9DSzgwNF9TQVRBLAorCQlQQ0lfQU5ZX0lELCBQQ0lfQU5ZX0lELCAwLCAwLCBDSzgwNCB9LAor
CXsgUENJX1ZFTkRPUl9JRF9OVklESUEsIFBDSV9ERVZJQ0VfSURfTlZJRElBX05GT1JDRV9DSzgw
NF9TQVRBMiwKKwkJUENJX0FOWV9JRCwgUENJX0FOWV9JRCwgMCwgMCwgQ0s4MDQgfSwKKwl7IFBD
SV9WRU5ET1JfSURfTlZJRElBLCBQQ0lfREVWSUNFX0lEX05WSURJQV9ORk9SQ0VfTUNQMDRfU0FU
QSwKKwkJUENJX0FOWV9JRCwgUENJX0FOWV9JRCwgMCwgMCwgQ0s4MDQgfSwKKwl7IFBDSV9WRU5E
T1JfSURfTlZJRElBLCBQQ0lfREVWSUNFX0lEX05WSURJQV9ORk9SQ0VfTUNQMDRfU0FUQTIsCisJ
CVBDSV9BTllfSUQsIFBDSV9BTllfSUQsIDAsIDAsIENLODA0IH0sCisJeyAwLCB9IC8qIHRlcm1p
bmF0ZSBsaXN0ICovCit9OworCisjZGVmaW5lIE5WX0hPU1RfRkxBR1NfU0NSX01NSU8JMHgwMDAw
MDAwMQorCitzdHJ1Y3QgbnZfaG9zdF9kZXNjCit7CisJZW51bSBudl9ob3N0X3R5cGUJaG9zdF90
eXBlOworCXVuc2lnbmVkIGxvbmcJCWhvc3RfZmxhZ3M7CisJdm9pZAkJCSgqZW5hYmxlX2hvdHBs
dWcpKHN0cnVjdCBhdGFfcHJvYmVfZW50ICpwcm9iZV9lbnQpOworCXZvaWQJCQkoKmRpc2FibGVf
aG90cGx1Zykoc3RydWN0IGF0YV9ob3N0X3NldCAqaG9zdF9zZXQpOworCXZvaWQJCQkoKmNoZWNr
X2hvdHBsdWcpKHN0cnVjdCBhdGFfaG9zdF9zZXQgKmhvc3Rfc2V0KTsKKworfTsKK3N0YXRpYyBz
dHJ1Y3QgbnZfaG9zdF9kZXNjIG52X2RldmljZV90YmxbXSA9IHsKKwl7CisJCS5ob3N0X3R5cGUJ
PSBORk9SQ0UyLAorCQkuaG9zdF9mbGFncwk9IDB4MDAwMDAwMDAsCisJCS5lbmFibGVfaG90cGx1
Zwk9IG52X2VuYWJsZV9ob3RwbHVnLAorCQkuZGlzYWJsZV9ob3RwbHVnPSBudl9kaXNhYmxlX2hv
dHBsdWcsCisJCS5jaGVja19ob3RwbHVnCT0gbnZfY2hlY2tfaG90cGx1ZywKKwl9LAorCXsKKwkJ
Lmhvc3RfdHlwZQk9IE5GT1JDRTMsCisJCS5ob3N0X2ZsYWdzCT0gMHgwMDAwMDAwMCwKKwkJLmVu
YWJsZV9ob3RwbHVnCT0gbnZfZW5hYmxlX2hvdHBsdWcsCisJCS5kaXNhYmxlX2hvdHBsdWc9IG52
X2Rpc2FibGVfaG90cGx1ZywKKwkJLmNoZWNrX2hvdHBsdWcJPSBudl9jaGVja19ob3RwbHVnLAor
CX0sCisJewkuaG9zdF90eXBlCT0gQ0s4MDQsCisJCS5ob3N0X2ZsYWdzCT0gTlZfSE9TVF9GTEFH
U19TQ1JfTU1JTywKKwkJLmVuYWJsZV9ob3RwbHVnCT0gbnZfZW5hYmxlX2hvdHBsdWdfY2s4MDQs
CisJCS5kaXNhYmxlX2hvdHBsdWc9IG52X2Rpc2FibGVfaG90cGx1Z19jazgwNCwKKwkJLmNoZWNr
X2hvdHBsdWcJPSBudl9jaGVja19ob3RwbHVnX2NrODA0LAorCX0sCit9OworCitzdHJ1Y3QgbnZf
aG9zdAoreworCXN0cnVjdCBudl9ob3N0X2Rlc2MJKmhvc3RfZGVzYzsKK307CisKK3N0YXRpYyBz
dHJ1Y3QgcGNpX2RyaXZlciBudl9wY2lfZHJpdmVyID0geworCS5uYW1lCQkJPSBEUlZfTkFNRSwK
KwkuaWRfdGFibGUJCT0gbnZfcGNpX3RibCwKKwkucHJvYmUJCQk9IG52X2luaXRfb25lLAorCS5y
ZW1vdmUJCQk9IGF0YV9wY2lfcmVtb3ZlX29uZSwKK307CisKK3N0YXRpYyBTY3NpX0hvc3RfVGVt
cGxhdGUgbnZfc2h0ID0geworCS5tb2R1bGUJCQk9IFRISVNfTU9EVUxFLAorCS5uYW1lCQkJPSBE
UlZfTkFNRSwKKwkuZGV0ZWN0CQkJPSBhdGFfc2NzaV9kZXRlY3QsCisJLnJlbGVhc2UJCT0gYXRh
X3Njc2lfcmVsZWFzZSwKKwkucXVldWVjb21tYW5kCQk9IGF0YV9zY3NpX3F1ZXVlY21kLAorCS5l
aF9zdHJhdGVneV9oYW5kbGVyCT0gYXRhX3Njc2lfZXJyb3IsCisJLmNhbl9xdWV1ZQkJPSBBVEFf
REVGX1FVRVVFLAorCS50aGlzX2lkCQk9IEFUQV9TSFRfVEhJU19JRCwKKwkuc2dfdGFibGVzaXpl
CQk9IEFUQV9NQVhfUFJELAorCS5tYXhfc2VjdG9ycwkJPSBBVEFfTUFYX1NFQ1RPUlMsCisJLmNt
ZF9wZXJfbHVuCQk9IEFUQV9TSFRfQ01EX1BFUl9MVU4sCisJLnVzZV9uZXdfZWhfY29kZQk9IEFU
QV9TSFRfTkVXX0VIX0NPREUsCisJLmVtdWxhdGVkCQk9IEFUQV9TSFRfRU1VTEFURUQsCisJLnVz
ZV9jbHVzdGVyaW5nCQk9IEFUQV9TSFRfVVNFX0NMVVNURVJJTkcsCisJLnByb2NfbmFtZQkJPSBE
UlZfTkFNRSwKKwkuYmlvc19wYXJhbQkJPSBhdGFfc3RkX2Jpb3NfcGFyYW0sCit9OworCitzdGF0
aWMgc3RydWN0IGF0YV9wb3J0X29wZXJhdGlvbnMgbnZfb3BzID0geworCS5wb3J0X2Rpc2FibGUJ
CT0gYXRhX3BvcnRfZGlzYWJsZSwKKwkudGZfbG9hZAkJPSBhdGFfdGZfbG9hZF9waW8sCisJLnRm
X3JlYWQJCT0gYXRhX3RmX3JlYWRfcGlvLAorCS5leGVjX2NvbW1hbmQJCT0gYXRhX2V4ZWNfY29t
bWFuZF9waW8sCisJLmNoZWNrX3N0YXR1cwkJPSBhdGFfY2hlY2tfc3RhdHVzX3BpbywKKwkucGh5
X3Jlc2V0CQk9IHNhdGFfcGh5X3Jlc2V0LAorCS5ibWRtYV9zZXR1cAkJPSBhdGFfYm1kbWFfc2V0
dXBfcGlvLAorCS5ibWRtYV9zdGFydAkJPSBhdGFfYm1kbWFfc3RhcnRfcGlvLAorCS5maWxsX3Nn
CQk9IGF0YV9maWxsX3NnLAorCS5lbmdfdGltZW91dAkJPSBhdGFfZW5nX3RpbWVvdXQsCisJLmly
cV9oYW5kbGVyCQk9IG52X2ludGVycnVwdCwKKwkuc2NyX3JlYWQJCT0gbnZfc2NyX3JlYWQsCisJ
LnNjcl93cml0ZQkJPSBudl9zY3Jfd3JpdGUsCisJLnBvcnRfc3RhcnQJCT0gYXRhX3BvcnRfc3Rh
cnQsCisJLnBvcnRfc3RvcAkJPSBhdGFfcG9ydF9zdG9wLAorCS5ob3N0X3N0b3AJCT0gbnZfaG9z
dF9zdG9wLAorfTsKKworTU9EVUxFX0FVVEhPUigiTlZJRElBIik7CitNT0RVTEVfREVTQ1JJUFRJ
T04oImxvdy1sZXZlbCBkcml2ZXIgZm9yIE5WSURJQSBuRm9yY2UgU0FUQSBjb250cm9sbGVyIik7
CitNT0RVTEVfTElDRU5TRSgiR1BMIik7CitNT0RVTEVfREVWSUNFX1RBQkxFKHBjaSwgbnZfcGNp
X3RibCk7CisKK2lycXJldHVybl90IG52X2ludGVycnVwdCAoaW50IGlycSwgdm9pZCAqZGV2X2lu
c3RhbmNlLCBzdHJ1Y3QgcHRfcmVncyAqcmVncykKK3sKKwlzdHJ1Y3QgYXRhX2hvc3Rfc2V0ICpo
b3N0X3NldCA9IGRldl9pbnN0YW5jZTsKKwlzdHJ1Y3QgbnZfaG9zdCAqaG9zdCA9IGhvc3Rfc2V0
LT5wcml2YXRlX2RhdGE7CisJdW5zaWduZWQgaW50IGk7CisJdW5zaWduZWQgaW50IGhhbmRsZWQg
PSAwOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaG9zdF9z
ZXQtPmxvY2ssIGZsYWdzKTsKKworCWZvciAoaSA9IDA7IGkgPCBob3N0X3NldC0+bl9wb3J0czsg
aSsrKSB7CisJCXN0cnVjdCBhdGFfcG9ydCAqYXA7CisKKwkJYXAgPSBob3N0X3NldC0+cG9ydHNb
aV07CisJCWlmIChhcCAmJiAoIShhcC0+ZmxhZ3MgJiBBVEFfRkxBR19QT1JUX0RJU0FCTEVEKSkp
IHsKKwkJCXN0cnVjdCBhdGFfcXVldWVkX2NtZCAqcWM7CisKKwkJCXFjID0gYXRhX3FjX2Zyb21f
dGFnKGFwLCBhcC0+YWN0aXZlX3RhZyk7CisJCQlpZiAocWMgJiYgKCEocWMtPnRmLmN0bCAmIEFU
QV9OSUVOKSkpCisJCQkJaGFuZGxlZCArPSBhdGFfaG9zdF9pbnRyKGFwLCBxYyk7CisJCX0KKwor
CX0KKworCWlmIChob3N0LT5ob3N0X2Rlc2MtPmNoZWNrX2hvdHBsdWcpCisJCWhvc3QtPmhvc3Rf
ZGVzYy0+Y2hlY2tfaG90cGx1Zyhob3N0X3NldCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3Jl
KCZob3N0X3NldC0+bG9jaywgZmxhZ3MpOworCisJcmV0dXJuIElSUV9SRVRWQUwoaGFuZGxlZCk7
Cit9CisKK3N0YXRpYyB1MzIgbnZfc2NyX3JlYWQgKHN0cnVjdCBhdGFfcG9ydCAqYXAsIHVuc2ln
bmVkIGludCBzY19yZWcpCit7CisJc3RydWN0IGF0YV9ob3N0X3NldCAqaG9zdF9zZXQgPSBhcC0+
aG9zdF9zZXQ7CisJc3RydWN0IG52X2hvc3QgKmhvc3QgPSBob3N0X3NldC0+cHJpdmF0ZV9kYXRh
OworCisJaWYgKHNjX3JlZyA+IFNDUl9DT05UUk9MKQorCQlyZXR1cm4gMHhmZmZmZmZmZlU7CisK
KwlpZiAoaG9zdC0+aG9zdF9kZXNjLT5ob3N0X2ZsYWdzICYgTlZfSE9TVF9GTEFHU19TQ1JfTU1J
TykKKwkJcmV0dXJuIHJlYWRsKGFwLT5pb2FkZHIuc2NyX2FkZHIgKyAoc2NfcmVnICogNCkpOwor
CWVsc2UKKwkJcmV0dXJuIGlubChhcC0+aW9hZGRyLnNjcl9hZGRyICsgKHNjX3JlZyAqIDQpKTsK
K30KKworc3RhdGljIHZvaWQgbnZfc2NyX3dyaXRlIChzdHJ1Y3QgYXRhX3BvcnQgKmFwLCB1bnNp
Z25lZCBpbnQgc2NfcmVnLCB1MzIgdmFsKQoreworCXN0cnVjdCBhdGFfaG9zdF9zZXQgKmhvc3Rf
c2V0ID0gYXAtPmhvc3Rfc2V0OworCXN0cnVjdCBudl9ob3N0ICpob3N0ID0gaG9zdF9zZXQtPnBy
aXZhdGVfZGF0YTsKKworCWlmIChzY19yZWcgPiBTQ1JfQ09OVFJPTCkKKwkJcmV0dXJuOworCisJ
aWYgKGhvc3QtPmhvc3RfZGVzYy0+aG9zdF9mbGFncyAmIE5WX0hPU1RfRkxBR1NfU0NSX01NSU8p
CisJCXdyaXRlbCh2YWwsIGFwLT5pb2FkZHIuc2NyX2FkZHIgKyAoc2NfcmVnICogNCkpOworCWVs
c2UKKwkJb3V0bCh2YWwsIGFwLT5pb2FkZHIuc2NyX2FkZHIgKyAoc2NfcmVnICogNCkpOworfQor
CitzdGF0aWMgdm9pZCBudl9ob3N0X3N0b3AgKHN0cnVjdCBhdGFfaG9zdF9zZXQgKmhvc3Rfc2V0
KQoreworCXN0cnVjdCBudl9ob3N0ICpob3N0OworCisJaG9zdCA9IGhvc3Rfc2V0LT5wcml2YXRl
X2RhdGE7CisKKwkvLyBEaXNhYmxlIGhvdHBsdWcgZXZlbnQgaW50ZXJydXB0cy4KKwlpZiAoaG9z
dC0+aG9zdF9kZXNjLT5kaXNhYmxlX2hvdHBsdWcpCisJCWhvc3QtPmhvc3RfZGVzYy0+ZGlzYWJs
ZV9ob3RwbHVnKGhvc3Rfc2V0KTsKKworCWtmcmVlKGhvc3QpOworfQorCitzdGF0aWMgaW50IG52
X2luaXRfb25lIChzdHJ1Y3QgcGNpX2RldiAqcGRldiwgY29uc3Qgc3RydWN0IHBjaV9kZXZpY2Vf
aWQgKmVudCkKK3sKKwlzdGF0aWMgaW50IHByaW50ZWRfdmVyc2lvbiA9IDA7CisJc3RydWN0IG52
X2hvc3QgKmhvc3Q7CisJc3RydWN0IGF0YV9wcm9iZV9lbnQgKnByb2JlX2VudCA9IE5VTEw7CisJ
aW50IHJjOworCisJaWYgKCFwcmludGVkX3ZlcnNpb24rKykKKwkJcHJpbnRrKEtFUk5fREVCVUcg
RFJWX05BTUUgIiB2ZXJzaW9uICIgRFJWX1ZFUlNJT04gIlxuIik7CisKKwlyYyA9IHBjaV9lbmFi
bGVfZGV2aWNlKHBkZXYpOworCWlmIChyYykKKwkJcmV0dXJuIHJjOworCisJcmMgPSBwY2lfcmVx
dWVzdF9yZWdpb25zKHBkZXYsIERSVl9OQU1FKTsKKwlpZiAocmMpCisJCWdvdG8gZXJyX291dDsK
KworCXJjID0gcGNpX3NldF9kbWFfbWFzayhwZGV2LCBBVEFfRE1BX01BU0spOworCWlmIChyYykK
KwkJZ290byBlcnJfb3V0X3JlZ2lvbnM7CisKKwlwcm9iZV9lbnQgPSBrbWFsbG9jKHNpemVvZigq
cHJvYmVfZW50KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9iZV9lbnQpIHsKKwkJcmMgPSAtRU5P
TUVNOworCQlnb3RvIGVycl9vdXRfcmVnaW9uczsKKwl9CisKKwlob3N0ID0ga21hbGxvYyhzaXpl
b2Yoc3RydWN0IG52X2hvc3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWhvc3QpIHsKKwkJcmMgPSAt
RU5PTUVNOworCQlnb3RvIGVycl9vdXRfZnJlZV9lbnQ7CisJfQorCisJaG9zdC0+aG9zdF9kZXNj
ID0gJm52X2RldmljZV90YmxbZW50LT5kcml2ZXJfZGF0YV07CisKKwltZW1zZXQocHJvYmVfZW50
LCAwLCBzaXplb2YoKnByb2JlX2VudCkpOworCUlOSVRfTElTVF9IRUFEKCZwcm9iZV9lbnQtPm5v
ZGUpOworCisJcHJvYmVfZW50LT5wZGV2ID0gcGRldjsKKwlwcm9iZV9lbnQtPnNodCA9ICZudl9z
aHQ7CisJcHJvYmVfZW50LT5ob3N0X2ZsYWdzID0gQVRBX0ZMQUdfU0FUQSB8CisJCQkJQVRBX0ZM
QUdfU0FUQV9SRVNFVCB8CisJCQkJQVRBX0ZMQUdfU1JTVCB8CisJCQkJQVRBX0ZMQUdfTk9fTEVH
QUNZOworCisJcHJvYmVfZW50LT5wb3J0X29wcyA9ICZudl9vcHM7CisJcHJvYmVfZW50LT5uX3Bv
cnRzID0gTlZfUE9SVFM7CisJcHJvYmVfZW50LT5pcnEgPSBwZGV2LT5pcnE7CisJcHJvYmVfZW50
LT5pcnFfZmxhZ3MgPSBTQV9TSElSUTsKKwlwcm9iZV9lbnQtPnBpb19tYXNrID0gTlZfUElPX01B
U0s7CisJcHJvYmVfZW50LT51ZG1hX21hc2sgPSBOVl9VRE1BX01BU0s7CisKKwlwcm9iZV9lbnQt
PnBvcnRbMF0uY21kX2FkZHIgPSBwY2lfcmVzb3VyY2Vfc3RhcnQocGRldiwgMCk7CisJYXRhX3N0
ZF9wb3J0cygmcHJvYmVfZW50LT5wb3J0WzBdKTsKKwlwcm9iZV9lbnQtPnBvcnRbMF0uYWx0c3Rh
dHVzX2FkZHIgPQorCXByb2JlX2VudC0+cG9ydFswXS5jdGxfYWRkciA9CisJCXBjaV9yZXNvdXJj
ZV9zdGFydChwZGV2LCAxKSB8IEFUQV9QQ0lfQ1RMX09GUzsKKwlwcm9iZV9lbnQtPnBvcnRbMF0u
Ym1kbWFfYWRkciA9CisJCXBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCA0KSB8IE5WX1BPUlQwX0JN
RE1BX1JFR19PRkZTRVQ7CisKKwlwcm9iZV9lbnQtPnBvcnRbMV0uY21kX2FkZHIgPSBwY2lfcmVz
b3VyY2Vfc3RhcnQocGRldiwgMik7CisJYXRhX3N0ZF9wb3J0cygmcHJvYmVfZW50LT5wb3J0WzFd
KTsKKwlwcm9iZV9lbnQtPnBvcnRbMV0uYWx0c3RhdHVzX2FkZHIgPQorCXByb2JlX2VudC0+cG9y
dFsxXS5jdGxfYWRkciA9CisJCXBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAzKSB8IEFUQV9QQ0lf
Q1RMX09GUzsKKwlwcm9iZV9lbnQtPnBvcnRbMV0uYm1kbWFfYWRkciA9CisJCXBjaV9yZXNvdXJj
ZV9zdGFydChwZGV2LCA0KSB8IE5WX1BPUlQxX0JNRE1BX1JFR19PRkZTRVQ7CisKKwlwcm9iZV9l
bnQtPnByaXZhdGVfZGF0YSA9IGhvc3Q7CisKKwlpZiAoaG9zdC0+aG9zdF9kZXNjLT5ob3N0X2Zs
YWdzICYgTlZfSE9TVF9GTEFHU19TQ1JfTU1JTykgeworCQl1bnNpZ25lZCBsb25nIGJhc2U7CisK
KwkJcHJvYmVfZW50LT5tbWlvX2Jhc2UgPSBpb3JlbWFwKHBjaV9yZXNvdXJjZV9zdGFydChwZGV2
LCA1KSwKKwkJCQlwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDUpKTsKKwkJaWYgKHByb2JlX2VudC0+
bW1pb19iYXNlID09IE5VTEwpCisJCQlnb3RvIGVycl9vdXRfZnJlZV9lbnQ7CisKKwkJYmFzZSA9
ICh1bnNpZ25lZCBsb25nKXByb2JlX2VudC0+bW1pb19iYXNlOworCisJCXByb2JlX2VudC0+cG9y
dFswXS5zY3JfYWRkciA9CisJCQliYXNlICsgTlZfUE9SVDBfU0NSX1JFR19PRkZTRVQ7CisJCXBy
b2JlX2VudC0+cG9ydFsxXS5zY3JfYWRkciA9CisJCQliYXNlICsgTlZfUE9SVDFfU0NSX1JFR19P
RkZTRVQ7CisJfSBlbHNlIHsKKworCQlwcm9iZV9lbnQtPnBvcnRbMF0uc2NyX2FkZHIgPQorCQkJ
cGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYsIDUpIHwgTlZfUE9SVDBfU0NSX1JFR19PRkZTRVQ7CisJ
CXByb2JlX2VudC0+cG9ydFsxXS5zY3JfYWRkciA9CisJCQlwY2lfcmVzb3VyY2Vfc3RhcnQocGRl
diwgNSkgfCBOVl9QT1JUMV9TQ1JfUkVHX09GRlNFVDsKKwl9CisKKwlwY2lfc2V0X21hc3Rlcihw
ZGV2KTsKKworCisJLy8gRW5hYmxlIGhvdHBsdWcgZXZlbnQgaW50ZXJydXB0cy4KKwlpZiAoaG9z
dC0+aG9zdF9kZXNjLT5lbmFibGVfaG90cGx1ZykKKwkJaG9zdC0+aG9zdF9kZXNjLT5lbmFibGVf
aG90cGx1Zyhwcm9iZV9lbnQpOworCisJYXRhX2FkZF90b19wcm9iZV9saXN0KHByb2JlX2VudCk7
CisKKwlyZXR1cm4gMDsKKworZXJyX291dF9mcmVlX2VudDoKKwlrZnJlZShwcm9iZV9lbnQpOwor
CitlcnJfb3V0X3JlZ2lvbnM6CisJcGNpX3JlbGVhc2VfcmVnaW9ucyhwZGV2KTsKKworZXJyX291
dDoKKwlwY2lfZGlzYWJsZV9kZXZpY2UocGRldik7CisJcmV0dXJuIHJjOworfQorCitzdGF0aWMg
dm9pZCBudl9lbmFibGVfaG90cGx1ZyhzdHJ1Y3QgYXRhX3Byb2JlX2VudCAqcHJvYmVfZW50KQor
eworCXU4IGludHJfbWFzazsKKworCW91dGIoTlZfSU5UX1NUQVRVU19IT1RQTFVHLAorCQkodW5z
aWduZWQgbG9uZylwcm9iZV9lbnQtPm1taW9fYmFzZSArIE5WX0lOVF9TVEFUVVMpOworCisJaW50
cl9tYXNrID0gaW5iKCh1bnNpZ25lZCBsb25nKXByb2JlX2VudC0+bW1pb19iYXNlICsgTlZfSU5U
X0VOQUJMRSk7CisJaW50cl9tYXNrIHw9IE5WX0lOVF9FTkFCTEVfSE9UUExVRzsKKworCW91dGIo
aW50cl9tYXNrLCAodW5zaWduZWQgbG9uZylwcm9iZV9lbnQtPm1taW9fYmFzZSArIE5WX0lOVF9F
TkFCTEUpOworfQorCitzdGF0aWMgdm9pZCBudl9kaXNhYmxlX2hvdHBsdWcoc3RydWN0IGF0YV9o
b3N0X3NldCAqaG9zdF9zZXQpCit7CisJdTggaW50cl9tYXNrOworCisJaW50cl9tYXNrID0gaW5i
KCh1bnNpZ25lZCBsb25nKWhvc3Rfc2V0LT5tbWlvX2Jhc2UgKyBOVl9JTlRfRU5BQkxFKTsKKwor
CWludHJfbWFzayAmPSB+KE5WX0lOVF9FTkFCTEVfSE9UUExVRyk7CisKKwlvdXRiKGludHJfbWFz
aywgKHVuc2lnbmVkIGxvbmcpaG9zdF9zZXQtPm1taW9fYmFzZSArIE5WX0lOVF9FTkFCTEUpOwor
fQorCitzdGF0aWMgdm9pZCBudl9jaGVja19ob3RwbHVnKHN0cnVjdCBhdGFfaG9zdF9zZXQgKmhv
c3Rfc2V0KQoreworCXU4IGludHJfc3RhdHVzOworCisJaW50cl9zdGF0dXMgPSBpbmIoKHVuc2ln
bmVkIGxvbmcpaG9zdF9zZXQtPm1taW9fYmFzZSArIE5WX0lOVF9TVEFUVVMpOworCisJLy8gQ2xl
YXIgaW50ZXJydXB0IHN0YXR1cy4KKwlvdXRiKDB4ZmYsICh1bnNpZ25lZCBsb25nKWhvc3Rfc2V0
LT5tbWlvX2Jhc2UgKyBOVl9JTlRfU1RBVFVTKTsKKworCWlmIChpbnRyX3N0YXR1cyAmIE5WX0lO
VF9TVEFUVVNfSE9UUExVRykgeworCQlpZiAoaW50cl9zdGF0dXMgJiBOVl9JTlRfU1RBVFVTX1BE
RVZfQURERUQpCisJCQlwcmludGsoS0VSTl9XQVJOSU5HICJudl9zYXRhOiAiCisJCQkJIlByaW1h
cnkgZGV2aWNlIGFkZGVkXG4iKTsKKworCQlpZiAoaW50cl9zdGF0dXMgJiBOVl9JTlRfU1RBVFVT
X1BERVZfUkVNT1ZFRCkKKwkJCXByaW50ayhLRVJOX1dBUk5JTkcgIm52X3NhdGE6ICIKKwkJCQki
UHJpbWFyeSBkZXZpY2UgcmVtb3ZlZFxuIik7CisKKwkJaWYgKGludHJfc3RhdHVzICYgTlZfSU5U
X1NUQVRVU19TREVWX0FEREVEKQorCQkJcHJpbnRrKEtFUk5fV0FSTklORyAibnZfc2F0YTogIgor
CQkJCSJTZWNvbmRhcnkgZGV2aWNlIGFkZGVkXG4iKTsKKworCQlpZiAoaW50cl9zdGF0dXMgJiBO
Vl9JTlRfU1RBVFVTX1NERVZfUkVNT1ZFRCkKKwkJCXByaW50ayhLRVJOX1dBUk5JTkcgIm52X3Nh
dGE6ICIKKwkJCQkiU2Vjb25kYXJ5IGRldmljZSByZW1vdmVkXG4iKTsKKwl9Cit9CisKK3N0YXRp
YyB2b2lkIG52X2VuYWJsZV9ob3RwbHVnX2NrODA0KHN0cnVjdCBhdGFfcHJvYmVfZW50ICpwcm9i
ZV9lbnQpCit7CisJdTggaW50cl9tYXNrOworCXU4IHJlZ3ZhbDsKKworCXBjaV9yZWFkX2NvbmZp
Z19ieXRlKHByb2JlX2VudC0+cGRldiwgTlZfTUNQX1NBVEFfQ0ZHXzIwLCAmcmVndmFsKTsKKwly
ZWd2YWwgfD0gTlZfTUNQX1NBVEFfQ0ZHXzIwX1NBVEFfU1BBQ0VfRU47CisJcGNpX3dyaXRlX2Nv
bmZpZ19ieXRlKHByb2JlX2VudC0+cGRldiwgTlZfTUNQX1NBVEFfQ0ZHXzIwLCByZWd2YWwpOwor
CisJd3JpdGViKE5WX0lOVF9TVEFUVVNfSE9UUExVRywgcHJvYmVfZW50LT5tbWlvX2Jhc2UgKyBO
Vl9JTlRfU1RBVFVTX0NLODA0KTsKKworCWludHJfbWFzayA9IHJlYWRiKHByb2JlX2VudC0+bW1p
b19iYXNlICsgTlZfSU5UX0VOQUJMRV9DSzgwNCk7CisJaW50cl9tYXNrIHw9IE5WX0lOVF9FTkFC
TEVfSE9UUExVRzsKKworCXdyaXRlYihpbnRyX21hc2ssIHByb2JlX2VudC0+bW1pb19iYXNlICsg
TlZfSU5UX0VOQUJMRV9DSzgwNCk7Cit9CisKK3N0YXRpYyB2b2lkIG52X2Rpc2FibGVfaG90cGx1
Z19jazgwNChzdHJ1Y3QgYXRhX2hvc3Rfc2V0ICpob3N0X3NldCkKK3sKKwl1OCBpbnRyX21hc2s7
CisJdTggcmVndmFsOworCisJaW50cl9tYXNrID0gcmVhZGIoaG9zdF9zZXQtPm1taW9fYmFzZSAr
IE5WX0lOVF9FTkFCTEVfQ0s4MDQpOworCisJaW50cl9tYXNrICY9IH4oTlZfSU5UX0VOQUJMRV9I
T1RQTFVHKTsKKworCXdyaXRlYihpbnRyX21hc2ssIGhvc3Rfc2V0LT5tbWlvX2Jhc2UgKyBOVl9J
TlRfRU5BQkxFX0NLODA0KTsKKworCXBjaV9yZWFkX2NvbmZpZ19ieXRlKGhvc3Rfc2V0LT5wZGV2
LCBOVl9NQ1BfU0FUQV9DRkdfMjAsICZyZWd2YWwpOworCXJlZ3ZhbCAmPSB+TlZfTUNQX1NBVEFf
Q0ZHXzIwX1NBVEFfU1BBQ0VfRU47CisJcGNpX3dyaXRlX2NvbmZpZ19ieXRlKGhvc3Rfc2V0LT5w
ZGV2LCBOVl9NQ1BfU0FUQV9DRkdfMjAsIHJlZ3ZhbCk7Cit9CisKK3N0YXRpYyB2b2lkIG52X2No
ZWNrX2hvdHBsdWdfY2s4MDQoc3RydWN0IGF0YV9ob3N0X3NldCAqaG9zdF9zZXQpCit7CisJdTgg
aW50cl9zdGF0dXM7CisKKwlpbnRyX3N0YXR1cyA9IHJlYWRiKGhvc3Rfc2V0LT5tbWlvX2Jhc2Ug
KyBOVl9JTlRfU1RBVFVTX0NLODA0KTsKKworCS8vIENsZWFyIGludGVycnVwdCBzdGF0dXMuCisJ
d3JpdGViKDB4ZmYsIGhvc3Rfc2V0LT5tbWlvX2Jhc2UgKyBOVl9JTlRfU1RBVFVTX0NLODA0KTsK
KworCWlmIChpbnRyX3N0YXR1cyAmIE5WX0lOVF9TVEFUVVNfSE9UUExVRykgeworCQlpZiAoaW50
cl9zdGF0dXMgJiBOVl9JTlRfU1RBVFVTX1BERVZfQURERUQpCisJCQlwcmludGsoS0VSTl9XQVJO
SU5HICJudl9zYXRhOiAiCisJCQkJIlByaW1hcnkgZGV2aWNlIGFkZGVkXG4iKTsKKworCQlpZiAo
aW50cl9zdGF0dXMgJiBOVl9JTlRfU1RBVFVTX1BERVZfUkVNT1ZFRCkKKwkJCXByaW50ayhLRVJO
X1dBUk5JTkcgIm52X3NhdGE6ICIKKwkJCQkiUHJpbWFyeSBkZXZpY2UgcmVtb3ZlZFxuIik7CisK
KwkJaWYgKGludHJfc3RhdHVzICYgTlZfSU5UX1NUQVRVU19TREVWX0FEREVEKQorCQkJcHJpbnRr
KEtFUk5fV0FSTklORyAibnZfc2F0YTogIgorCQkJCSJTZWNvbmRhcnkgZGV2aWNlIGFkZGVkXG4i
KTsKKworCQlpZiAoaW50cl9zdGF0dXMgJiBOVl9JTlRfU1RBVFVTX1NERVZfUkVNT1ZFRCkKKwkJ
CXByaW50ayhLRVJOX1dBUk5JTkcgIm52X3NhdGE6ICIKKwkJCQkiU2Vjb25kYXJ5IGRldmljZSBy
ZW1vdmVkXG4iKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IG52X2luaXQodm9pZCkKK3sK
KwlpbnQgcmMgPSBwY2lfbW9kdWxlX2luaXQoJm52X3BjaV9kcml2ZXIpOworCWlmIChyYykKKwkJ
cmV0dXJuIHJjOworCisJcmMgPSBzY3NpX3JlZ2lzdGVyX21vZHVsZShNT0RVTEVfU0NTSV9IQSwg
Jm52X3NodCk7CisJaWYgKHJjKSB7CisJCXBjaV91bnJlZ2lzdGVyX2RyaXZlcigmbnZfcGNpX2Ry
aXZlcik7CisJCXJldHVybiAtRU5PREVWOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMg
dm9pZCBfX2V4aXQgbnZfZXhpdCh2b2lkKQoreworCXNjc2lfdW5yZWdpc3Rlcl9tb2R1bGUoTU9E
VUxFX1NDU0lfSEEsICZudl9zaHQpOworCXBjaV91bnJlZ2lzdGVyX2RyaXZlcigmbnZfcGNpX2Ry
aXZlcik7Cit9CisKK21vZHVsZV9pbml0KG52X2luaXQpOworbW9kdWxlX2V4aXQobnZfZXhpdCk7
Cg==

------_=_NextPart_001_01C47B37.C2508C45
Content-Type: application/octet-stream;
	name="libata-core_2-4.diff"
Content-Transfer-Encoding: base64
Content-Description: libata-core_2-4.diff
Content-Disposition: attachment;
	filename="libata-core_2-4.diff"

LS0tIGxpbnV4LTIuNC4yNy1yYzMvZHJpdmVycy9zY3NpL2xpYmF0YS1jb3JlLmMJMjAwNC0wOC0w
NSAxNDo0ODo0Ni4wMDAwMDAwMDAgLTA3MDAKKysrIGxpbnV4L2RyaXZlcnMvc2NzaS9saWJhdGEt
Y29yZS5jCTIwMDQtMDgtMDUgMTQ6NTY6MzIuMDAwMDAwMDAwIC0wNzAwCkBAIC0zMzc5LDE0ICsz
Mzc5LDE0IEBACiAJICovCiAJYXAgPSBob3N0X3NldC0+cG9ydHNbMF07CiAJc2h0ID0gYXAtPmhv
c3QtPmhvc3R0OwotCXJjID0gc2NzaV91bnJlZ2lzdGVyX21vZHVsZShNT0RVTEVfU0NTSV9IQSwg
c2h0KTsKKwogCS8qIEZJWE1FOiBoYW5kbGUgJ3JjJyBmYWlsdXJlPyAqLwogCiAJZnJlZV9pcnEo
aG9zdF9zZXQtPmlycSwgaG9zdF9zZXQpOwotCWlmIChob3N0X3NldC0+bW1pb19iYXNlKQotCQlp
b3VubWFwKGhvc3Rfc2V0LT5tbWlvX2Jhc2UpOwogCWlmIChob3N0X3NldC0+cG9ydHNbMF0tPm9w
cy0+aG9zdF9zdG9wKQogCQlob3N0X3NldC0+cG9ydHNbMF0tPm9wcy0+aG9zdF9zdG9wKGhvc3Rf
c2V0KTsKKwlpZiAoaG9zdF9zZXQtPm1taW9fYmFzZSkKKwkJaW91bm1hcChob3N0X3NldC0+bW1p
b19iYXNlKTsKIAogCXBjaV9yZWxlYXNlX3JlZ2lvbnMocGRldik7CiAK

------_=_NextPart_001_01C47B37.C2508C45--
