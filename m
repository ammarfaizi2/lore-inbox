Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932198AbVJNCIX@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932198AbVJNCIX (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 13 Oct 2005 22:08:23 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932553AbVJNCIX
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 13 Oct 2005 22:08:23 -0400
Received: from e35.co.us.ibm.com ([32.97.110.153]:31687 "EHLO
	e35.co.us.ibm.com") by vger.kernel.org with ESMTP id S932198AbVJNCIX
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 13 Oct 2005 22:08:23 -0400
Subject: [RFC] Generic Timeofday Subsystem Simulator (v1)
From: john stultz <johnstul@us.ibm.com>
To: lkml <linux-kernel@vger.kernel.org>
Cc: Roman Zippel <zippel@linux-m68k.org>,
       Ulrich Windl <ulrich.windl@rz.uni-regensburg.de>,
       George Anzinger <george@mvista.com>,
       Thomas Gleixner <tglx@linutronix.de>,
       Frank Sorenson <frank@tuxrocks.com>,
       Nishanth Aravamudan <nacc@us.ibm.com>, Darren Hart <dvhltc@us.ibm.com>
In-Reply-To: <1129255182.27168.14.camel@cog.beaverton.ibm.com>
References: <1129255182.27168.14.camel@cog.beaverton.ibm.com>
Content-Type: multipart/mixed; boundary="=-Xkbz8fo+Wex9HBFoByPV"
Date: Thu, 13 Oct 2005 19:08:18 -0700
Message-Id: <1129255699.27168.24.camel@cog.beaverton.ibm.com>
Mime-Version: 1.0
X-Mailer: Evolution 2.2.3 (2.2.3-2.fc4) 
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


--=-Xkbz8fo+Wex9HBFoByPV
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

All,
	At Roman's prodding, and inspired by Dave Mills' simulator, I've
scratched out a pretty simple userspace simulator for my timeofday and
NTP changes.

The project is attached. It is pretty simple right now and if you have
any suggestions for changes, please let me know.

To use it:
1. Download my timeofday patches (or just the cumulative one) and apply
them to a current git tree.
2. Untar the simulator.
3. Run ./generate.sh <path to patched kernel tree>
4. Run make
5. Run ./todsim <offset> <ppm skew>

Pretty easy. It will output a whole lot of data providing:

<simulator time> <kernel time> <hardware value> <offset> <ppm adj>

Its not terribly interesting at the moment, but hopefully folks can play
with it and make suggestions for improvements to the simulator,
timeofday code or the ntp changes. 

thanks
-john

--=-Xkbz8fo+Wex9HBFoByPV
Content-Disposition: attachment; filename=simulator.tar.bz2
Content-Type: application/x-bzip-compressed-tar; name=simulator.tar.bz2
Content-Transfer-Encoding: base64

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
OpMA


--=-Xkbz8fo+Wex9HBFoByPV--

