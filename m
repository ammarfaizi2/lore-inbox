Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1751324AbWFBIet@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751324AbWFBIet (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 2 Jun 2006 04:34:49 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751327AbWFBIet
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 2 Jun 2006 04:34:49 -0400
Received: from ev1s-67-15-60-3.ev1servers.net ([67.15.60.3]:18889 "EHLO
	mail.aftek.com") by vger.kernel.org with ESMTP id S1751324AbWFBIel
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Fri, 2 Jun 2006 04:34:41 -0400
X-Antivirus-MYDOMAIN-Mail-From: abum@aftek.com via plain.ev1servers.net
X-Antivirus-MYDOMAIN: 1.22-st-qms (Clear:RC:0(59.95.0.166):SA:0(-102.3/1.7):. Processed in 4.978996 secs Process 31251)
From: "Abu M. Muttalib" <abum@aftek.com>
To: "Jesper Juhl" <jesper.juhl@gmail.com>,
       "Nick Piggin" <nickpiggin@yahoo.com.au>
Cc: "Martin J. Bligh" <mbligh@mbligh.org>,
       "Paulo Marques" <pmarques@grupopie.com>, <linux-kernel@vger.kernel.org>
Subject: RE: Page Allocation Failure, Why?? Bug in kernel??
Date: Fri, 2 Jun 2006 14:11:30 +0530
Message-ID: <BKEKJNIHLJDCFGDBOHGMKEJOCNAA.abum@aftek.com>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook IMO, Build 9.0.2416 (9.0.2910.0)
In-Reply-To: <9a8748490606020053m55e341a1v482c904ee7e423cf@mail.gmail.com>
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4927.1200
Importance: Normal
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi,

Thanks for the responses.

But it seems I am not able to convey my problem statement correctly. My
question is when 128 (((order=5)=32)*4kbytes) contiguous pages are free, as
indicated by

.....
DMA: 106*4kB 11*8kB 5*16kB 3*32kB 2*64kB .....1*128kB..... 0*256kB 0*512kB
0*1024kB = 944kB
.....

WHY IT HAS NOT BEEN ALLOCATED TO THE APPLICATION IN FIRST PLACE.

I am also facing a somwhat similar problem. I get an OOM-KILLER for a
request of 1 page, where as the output generated by OOM-KILLER shows the
following:

.....
DMA: 0*4kB 0*8kB 0*16kB 0*32kB 2*64kB 1*128kB 1*256kB 0*512kB 0*1024kB =
512kB
.....

Is it because the min_free_kbytes in /proc/sys/vm/min_free_kbytes is
configured to be 512? I tried to run the application by setting
/proc/sys/vm/min_free_kbytes to 256, but to no avail. I still got the
OOM-KILLER. Any help to aleviate the problem will be higly appreciated.

Thanks and anticipation,

~Abu.

-----Original Message-----
From: Jesper Juhl [mailto:jesper.juhl@gmail.com]
Sent: Friday, June 02, 2006 1:24 PM
To: Nick Piggin
Cc: Abu M. Muttalib; Martin J. Bligh; Paulo Marques;
linux-kernel@vger.kernel.org
Subject: Re: Page Allocation Failure, Why?? Bug in kernel??


On 02/06/06, Nick Piggin <nickpiggin@yahoo.com.au> wrote:
> Abu M. Muttalib wrote:
> > Hi,
> >
> > I repeat my question, the required no of pages are available, as shown
in
> > the dump produced by kernel, the request is not fulfilled. Its as
follows:
> >
> > DMA: 106*4kB 11*8kB 5*16kB 3*32kB 2*64kB 1*128kB 0*256kB 0*512kB
0*1024kB =
> > 944kB
> >
> > Why this is so??
>
> Because some are kept in "emergency pools" for allocators that cannot
> sleep trying to free up memory.
>
> Teach the sound driver to use smaller buffers or just insert it at boot
> and leave it inserted. Why are you removing it then reinserting it?
>

Or, if the driver just need 32 pages that *appear* to be contiguous
without actually having to be physically contiguous, then allocate the
space with vmalloc(). Not always possible ofcourse, but if it is for
Abu's use, then perhaps that could be a solution.

--
Jesper Juhl <jesper.juhl@gmail.com>
Don't top-post  http://www.catb.org/~esr/jargon/html/T/top-post.html
Plain text mails only, please      http://www.expita.com/nomime.html

