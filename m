Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S267744AbTBGLEK>; Fri, 7 Feb 2003 06:04:10 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S267789AbTBGLEK>; Fri, 7 Feb 2003 06:04:10 -0500
Received: from [195.39.17.254] ([195.39.17.254]:3076 "EHLO Elf.ucw.cz")
	by vger.kernel.org with ESMTP id <S267744AbTBGLEI>;
	Fri, 7 Feb 2003 06:04:08 -0500
Date: Wed, 5 Feb 2003 22:39:19 +0100
From: Pavel Machek <pavel@suse.cz>
To: John Levon <levon@movementarian.org>
Cc: linux-kernel@vger.kernel.org
Subject: Re: Switch APIC to driver model (and make S3 sleep with APIC on)
Message-ID: <20030205213918.GA19615@elf.ucw.cz>
References: <200301280121.CAA13798@harpo.it.uu.se> <20030202124235.GA133@elf.ucw.cz> <20030203103254.GA25619@compsoc.man.ac.uk> <20030203154008.GC480@elf.ucw.cz> <20030203202029.GA99614@compsoc.man.ac.uk> <20030203211858.GA3173@elf.ucw.cz> <20030203234307.GA18528@compsoc.man.ac.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030203234307.GA18528@compsoc.man.ac.uk>
X-Warning: Reading this can be dangerous to your mental health.
User-Agent: Mutt/1.5.3i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi!

> > Unfortunately my systems seems to miss bfd.h, required by libutil++.
> 
> The debian package is apparently called binutils-dev

Thanx. oprofile now seems to work for me.

> > > I haven't seen where you added these checks. They did not exist before:
> > > oprofile took responsibility for the NMI/perfctr handling off the NMI
> > > watchdog entirely, then handed it back when oprofile finished.
> > 
> > Ouch, I did not see that code. It seems not to be in nmi_int.c; where
> > is that?
> 
> oprofile saves the perfctr config when it starts in nmi_int.c, then
> calls the set_nmi_pm_callback. Then the suspend/resume calls oprofile's,
> and we assume we have unique access to controlling the generated NMIs
> (ie it becomes oprofile's job to ensure no NMIs are generated by the
> perfctrs whilst suspended).

I can see set_nmi_pm_callback() in nmi_setup(), but can not see where
nmi.c's pm_callback is restored in nmi_shutdown(). Perhaps that's a
bug?

> It's pretty ugly, so a correct cleanup would be appreciated.
> 
> I suppose this is quite an unusual case for the PM model ?

Yes, it is pretty unusual.
								Pavel
-- 
Worst form of spam? Adding advertisment signatures ala sourceforge.net.
What goes next? Inserting advertisment *into* email?
