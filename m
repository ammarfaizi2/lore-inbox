Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S265063AbTARUqP>; Sat, 18 Jan 2003 15:46:15 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S265074AbTARUqP>; Sat, 18 Jan 2003 15:46:15 -0500
Received: from franka.aracnet.com ([216.99.193.44]:25317 "EHLO
	franka.aracnet.com") by vger.kernel.org with ESMTP
	id <S265063AbTARUqI>; Sat, 18 Jan 2003 15:46:08 -0500
Date: Sat, 18 Jan 2003 12:54:21 -0800
From: "Martin J. Bligh" <mbligh@aracnet.com>
To: Andrew Theurer <habanero@us.ibm.com>
cc: Christoph Hellwig <hch@infradead.org>, Robert Love <rml@tech9.net>,
       Michael Hohnbaum <hohnbaum@us.ibm.com>,
       Andrew Theurer <habanero@us.ibm.com>,
       linux-kernel <linux-kernel@vger.kernel.org>,
       lse-tech <lse-tech@lists.sourceforge.net>,
       Erich Focht <efocht@ess.nec.de>, Ingo Molnar <mingo@elte.hu>
Subject: NUMA sched -> pooling scheduler (inc HT)
Message-ID: <550960000.1042923260@titus>
In-Reply-To: <270920000.1042822723@titus>
References: <Pine.LNX.4.44.0301171607510.10244-100000@localhost.localdomain> <270920000.1042822723@titus>
X-Mailer: Mulberry/2.2.1 (Linux/x86)
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="==========1397890887=========="
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--==========1397890887==========
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

Andrew, hopefully this'll give you a cleaner integration point to do 
the HT scheduler stuff ... I basically did a rename of "node" to "pool" 
on sched.c (OK, it was a little more complex than that), and provided
some hooks for you to attatch to. There's a really hacky version of
the HT stuff in there that I doubt works at all. (sched.h will need
something other than CONFIG_SCHED_NUMA, for starters). 

It's not really finished, but I have to go out ... I thought you or 
someone else might like to have a play with it in the meantime. 
Goes on top of the second half of Ingo's stuff from yesterday 
(also attatched).

I think this should result in a much cleaner integration between the HT
aware stuff and the NUMA stuff. Pools is a concept Erich had in his
scheduler a while back, but it got set aside in the paring down for
integration. We should be able to add multiple levels to this fairly
easily, at some point (eg HT + NUMA), but let's get the basics working
first ;-)

M.

--==========1397890887==========
Content-Type: application/octet-stream; name=01-ingo
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename=01-ingo; size=6829

ZGlmZiAtdXJwTiAtWCAvaG9tZS9mbGV0Y2gvLmRpZmYuZXhjbHVkZSAwMC12aXJnaW4va2VybmVs
L3NjaGVkLmMgMDEtaW5nby9rZXJuZWwvc2NoZWQuYwotLS0gMDAtdmlyZ2luL2tlcm5lbC9zY2hl
ZC5jCUZyaSBKYW4gMTcgMDk6MTg6MzIgMjAwMworKysgMDEtaW5nby9rZXJuZWwvc2NoZWQuYwlT
YXQgSmFuIDE4IDEwOjU4OjU3IDIwMDMKQEAgLTE1MywxMCArMTUzLDkgQEAgc3RydWN0IHJ1bnF1
ZXVlIHsKIAkJCW5yX3VuaW50ZXJydXB0aWJsZTsKIAl0YXNrX3QgKmN1cnIsICppZGxlOwogCXBy
aW9fYXJyYXlfdCAqYWN0aXZlLCAqZXhwaXJlZCwgYXJyYXlzWzJdOwotCWludCBwcmV2X25yX3J1
bm5pbmdbTlJfQ1BVU107CisJaW50IHByZXZfY3B1X2xvYWRbTlJfQ1BVU107CiAjaWZkZWYgQ09O
RklHX05VTUEKIAlhdG9taWNfdCAqbm9kZV9ucl9ydW5uaW5nOwotCXVuc2lnbmVkIGludCBucl9i
YWxhbmNlZDsKIAlpbnQgcHJldl9ub2RlX2xvYWRbTUFYX05VTU5PREVTXTsKICNlbmRpZgogCXRh
c2tfdCAqbWlncmF0aW9uX3RocmVhZDsKQEAgLTc2NSwyOSArNzY0LDYgQEAgc3RhdGljIGludCBm
aW5kX2J1c2llc3Rfbm9kZShpbnQgdGhpc19ubwogCXJldHVybiBub2RlOwogfQogCi1zdGF0aWMg
aW5saW5lIHVuc2lnbmVkIGxvbmcgY3B1c190b19iYWxhbmNlKGludCB0aGlzX2NwdSwgcnVucXVl
dWVfdCAqdGhpc19ycSkKLXsKLQlpbnQgdGhpc19ub2RlID0gX19jcHVfdG9fbm9kZSh0aGlzX2Nw
dSk7Ci0JLyoKLQkgKiBBdm9pZCByZWJhbGFuY2luZyBiZXR3ZWVuIG5vZGVzIHRvbyBvZnRlbi4K
LQkgKiBXZSByZWJhbGFuY2UgZ2xvYmFsbHkgb25jZSBldmVyeSBOT0RFX0JBTEFOQ0VfUkFURSBs
b2FkIGJhbGFuY2VzLgotCSAqLwotCWlmICgrKyh0aGlzX3JxLT5ucl9iYWxhbmNlZCkgPT0gTk9E
RV9CQUxBTkNFX1JBVEUpIHsKLQkJaW50IG5vZGUgPSBmaW5kX2J1c2llc3Rfbm9kZSh0aGlzX25v
ZGUpOwotCQl0aGlzX3JxLT5ucl9iYWxhbmNlZCA9IDA7Ci0JCWlmIChub2RlID49IDApCi0JCQly
ZXR1cm4gKF9fbm9kZV90b19jcHVfbWFzayhub2RlKSB8ICgxVUwgPDwgdGhpc19jcHUpKTsKLQl9
Ci0JcmV0dXJuIF9fbm9kZV90b19jcHVfbWFzayh0aGlzX25vZGUpOwotfQotCi0jZWxzZSAvKiAh
Q09ORklHX05VTUEgKi8KLQotc3RhdGljIGlubGluZSB1bnNpZ25lZCBsb25nIGNwdXNfdG9fYmFs
YW5jZShpbnQgdGhpc19jcHUsIHJ1bnF1ZXVlX3QgKnRoaXNfcnEpCi17Ci0JcmV0dXJuIGNwdV9v
bmxpbmVfbWFwOwotfQotCiAjZW5kaWYgLyogQ09ORklHX05VTUEgKi8KIAogI2lmIENPTkZJR19T
TVAKQEAgLTgwNywxMCArNzgzLDEwIEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IGRvdWJs
ZV9sb2NrX2IKIAkJCXNwaW5fbG9jaygmYnVzaWVzdC0+bG9jayk7CiAJCQlzcGluX2xvY2soJnRo
aXNfcnEtPmxvY2spOwogCQkJLyogTmVlZCB0byByZWNhbGN1bGF0ZSBucl9ydW5uaW5nICovCi0J
CQlpZiAoaWRsZSB8fCAodGhpc19ycS0+bnJfcnVubmluZyA+IHRoaXNfcnEtPnByZXZfbnJfcnVu
bmluZ1t0aGlzX2NwdV0pKQorCQkJaWYgKGlkbGUgfHwgKHRoaXNfcnEtPm5yX3J1bm5pbmcgPiB0
aGlzX3JxLT5wcmV2X2NwdV9sb2FkW3RoaXNfY3B1XSkpCiAJCQkJbnJfcnVubmluZyA9IHRoaXNf
cnEtPm5yX3J1bm5pbmc7CiAJCQllbHNlCi0JCQkJbnJfcnVubmluZyA9IHRoaXNfcnEtPnByZXZf
bnJfcnVubmluZ1t0aGlzX2NwdV07CisJCQkJbnJfcnVubmluZyA9IHRoaXNfcnEtPnByZXZfY3B1
X2xvYWRbdGhpc19jcHVdOwogCQl9IGVsc2UKIAkJCXNwaW5fbG9jaygmYnVzaWVzdC0+bG9jayk7
CiAJfQpAQCAtODQ3LDEwICs4MjMsMTAgQEAgc3RhdGljIGlubGluZSBydW5xdWV1ZV90ICpmaW5k
X2J1c2llc3RfcQogCSAqIHRoYXQgY2FzZSB3ZSBhcmUgbGVzcyBwaWNreSBhYm91dCBtb3Zpbmcg
YSB0YXNrIGFjcm9zcyBDUFVzIGFuZAogCSAqIHRha2Ugd2hhdCBjYW4gYmUgdGFrZW4uCiAJICov
Ci0JaWYgKGlkbGUgfHwgKHRoaXNfcnEtPm5yX3J1bm5pbmcgPiB0aGlzX3JxLT5wcmV2X25yX3J1
bm5pbmdbdGhpc19jcHVdKSkKKwlpZiAoaWRsZSB8fCAodGhpc19ycS0+bnJfcnVubmluZyA+IHRo
aXNfcnEtPnByZXZfY3B1X2xvYWRbdGhpc19jcHVdKSkKIAkJbnJfcnVubmluZyA9IHRoaXNfcnEt
Pm5yX3J1bm5pbmc7CiAJZWxzZQotCQlucl9ydW5uaW5nID0gdGhpc19ycS0+cHJldl9ucl9ydW5u
aW5nW3RoaXNfY3B1XTsKKwkJbnJfcnVubmluZyA9IHRoaXNfcnEtPnByZXZfY3B1X2xvYWRbdGhp
c19jcHVdOwogCiAJYnVzaWVzdCA9IE5VTEw7CiAJbWF4X2xvYWQgPSAxOwpAQCAtODU5LDExICs4
MzUsMTEgQEAgc3RhdGljIGlubGluZSBydW5xdWV1ZV90ICpmaW5kX2J1c2llc3RfcQogCQkJY29u
dGludWU7CiAKIAkJcnFfc3JjID0gY3B1X3JxKGkpOwotCQlpZiAoaWRsZSB8fCAocnFfc3JjLT5u
cl9ydW5uaW5nIDwgdGhpc19ycS0+cHJldl9ucl9ydW5uaW5nW2ldKSkKKwkJaWYgKGlkbGUgfHwg
KHJxX3NyYy0+bnJfcnVubmluZyA8IHRoaXNfcnEtPnByZXZfY3B1X2xvYWRbaV0pKQogCQkJbG9h
ZCA9IHJxX3NyYy0+bnJfcnVubmluZzsKIAkJZWxzZQotCQkJbG9hZCA9IHRoaXNfcnEtPnByZXZf
bnJfcnVubmluZ1tpXTsKLQkJdGhpc19ycS0+cHJldl9ucl9ydW5uaW5nW2ldID0gcnFfc3JjLT5u
cl9ydW5uaW5nOworCQkJbG9hZCA9IHRoaXNfcnEtPnByZXZfY3B1X2xvYWRbaV07CisJCXRoaXNf
cnEtPnByZXZfY3B1X2xvYWRbaV0gPSBycV9zcmMtPm5yX3J1bm5pbmc7CiAKIAkJaWYgKChsb2Fk
ID4gbWF4X2xvYWQpICYmIChycV9zcmMgIT0gdGhpc19ycSkpIHsKIAkJCWJ1c2llc3QgPSBycV9z
cmM7CkBAIC05MjIsNyArODk4LDcgQEAgc3RhdGljIGlubGluZSB2b2lkIHB1bGxfdGFzayhydW5x
dWV1ZV90IAogICogV2UgY2FsbCB0aGlzIHdpdGggdGhlIGN1cnJlbnQgcnVucXVldWUgbG9ja2Vk
LAogICogaXJxcyBkaXNhYmxlZC4KICAqLwotc3RhdGljIHZvaWQgbG9hZF9iYWxhbmNlKHJ1bnF1
ZXVlX3QgKnRoaXNfcnEsIGludCBpZGxlKQorc3RhdGljIHZvaWQgbG9hZF9iYWxhbmNlKHJ1bnF1
ZXVlX3QgKnRoaXNfcnEsIGludCBpZGxlLCB1bnNpZ25lZCBsb25nIGNwdW1hc2spCiB7CiAJaW50
IGltYmFsYW5jZSwgaWR4LCB0aGlzX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKIAlydW5xdWV1
ZV90ICpidXNpZXN0OwpAQCAtOTMwLDggKzkwNiw3IEBAIHN0YXRpYyB2b2lkIGxvYWRfYmFsYW5j
ZShydW5xdWV1ZV90ICp0aGkKIAlzdHJ1Y3QgbGlzdF9oZWFkICpoZWFkLCAqY3VycjsKIAl0YXNr
X3QgKnRtcDsKIAotCWJ1c2llc3QgPSBmaW5kX2J1c2llc3RfcXVldWUodGhpc19ycSwgdGhpc19j
cHUsIGlkbGUsICZpbWJhbGFuY2UsCi0JCQkJCWNwdXNfdG9fYmFsYW5jZSh0aGlzX2NwdSwgdGhp
c19ycSkpOworCWJ1c2llc3QgPSBmaW5kX2J1c2llc3RfcXVldWUodGhpc19ycSwgdGhpc19jcHUs
IGlkbGUsICZpbWJhbGFuY2UsIGNwdW1hc2spOwogCWlmICghYnVzaWVzdCkKIAkJZ290byBvdXQ7
CiAKQEAgLTEwMDYsMjEgKzk4MSw3NSBAQCBvdXQ6CiAgKiBmcmVxdWVuY3kgYW5kIGJhbGFuY2lu
ZyBhZ3Jlc3Npdml0eSBkZXBlbmRzIG9uIHdoZXRoZXIgdGhlIENQVSBpcwogICogaWRsZSBvciBu
b3QuCiAgKgotICogYnVzeS1yZWJhbGFuY2UgZXZlcnkgMjUwIG1zZWNzLiBpZGxlLXJlYmFsYW5j
ZSBldmVyeSAxIG1zZWMuIChvciBvbgorICogYnVzeS1yZWJhbGFuY2UgZXZlcnkgMjAwIG1zZWNz
LiBpZGxlLXJlYmFsYW5jZSBldmVyeSAxIG1zZWMuIChvciBvbgogICogc3lzdGVtcyB3aXRoIEha
PTEwMCwgZXZlcnkgMTAgbXNlY3MuKQorICoKKyAqIE9uIE5VTUEsIGRvIGEgbm9kZS1yZWJhbGFu
Y2UgZXZlcnkgNDAwIG1zZWNzLgogICovCi0jZGVmaW5lIEJVU1lfUkVCQUxBTkNFX1RJQ0sgKEha
LzQgPzogMSkKICNkZWZpbmUgSURMRV9SRUJBTEFOQ0VfVElDSyAoSFovMTAwMCA/OiAxKQorI2Rl
ZmluZSBCVVNZX1JFQkFMQU5DRV9USUNLIChIWi81ID86IDEpCisjZGVmaW5lIElETEVfTk9ERV9S
RUJBTEFOQ0VfVElDSyAoSURMRV9SRUJBTEFOQ0VfVElDSyAqIDIpCisjZGVmaW5lIEJVU1lfTk9E
RV9SRUJBTEFOQ0VfVElDSyAoQlVTWV9SRUJBTEFOQ0VfVElDSyAqIDIpCiAKLXN0YXRpYyBpbmxp
bmUgdm9pZCBpZGxlX3RpY2socnVucXVldWVfdCAqcnEpCisjaWYgQ09ORklHX05VTUEKK3N0YXRp
YyB2b2lkIGJhbGFuY2Vfbm9kZShydW5xdWV1ZV90ICp0aGlzX3JxLCBpbnQgaWRsZSwgaW50IHRo
aXNfY3B1KQogewotCWlmIChqaWZmaWVzICUgSURMRV9SRUJBTEFOQ0VfVElDSykKLQkJcmV0dXJu
OwotCXNwaW5fbG9jaygmcnEtPmxvY2spOwotCWxvYWRfYmFsYW5jZShycSwgMSk7Ci0Jc3Bpbl91
bmxvY2soJnJxLT5sb2NrKTsKKwlpbnQgbm9kZSA9IGZpbmRfYnVzaWVzdF9ub2RlKF9fY3B1X3Rv
X25vZGUodGhpc19jcHUpKTsKKwl1bnNpZ25lZCBsb25nIGNwdW1hc2ssIHRoaXNfY3B1bWFzayA9
IDFVTCA8PCB0aGlzX2NwdTsKKworCWlmIChub2RlID49IDApIHsKKwkJY3B1bWFzayA9IF9fbm9k
ZV90b19jcHVfbWFzayhub2RlKSB8IHRoaXNfY3B1bWFzazsKKwkJc3Bpbl9sb2NrKCZ0aGlzX3Jx
LT5sb2NrKTsKKwkJbG9hZF9iYWxhbmNlKHRoaXNfcnEsIGlkbGUsIGNwdW1hc2spOworCQlzcGlu
X3VubG9jaygmdGhpc19ycS0+bG9jayk7CisJfQogfQorI2VuZGlmCiAKK3N0YXRpYyB2b2lkIHJl
YmFsYW5jZV90aWNrKHJ1bnF1ZXVlX3QgKnRoaXNfcnEsIGludCBpZGxlKQoreworI2lmIENPTkZJ
R19OVU1BCisJaW50IHRoaXNfY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOworI2VuZGlmCisJdW5z
aWduZWQgbG9uZyBqID0gamlmZmllczsKKworCS8qCisJICogRmlyc3QgZG8gaW50ZXItbm9kZSBy
ZWJhbGFuY2luZywgdGhlbiBpbnRyYS1ub2RlIHJlYmFsYW5jaW5nLAorCSAqIGlmIGJvdGggZXZl
bnRzIGhhcHBlbiBpbiB0aGUgc2FtZSB0aWNrLiBUaGUgaW50ZXItbm9kZQorCSAqIHJlYmFsYW5j
aW5nIGRvZXMgbm90IG5lY2Vzc2FyaWx5IGhhdmUgdG8gY3JlYXRlIGEgcGVyZmVjdAorCSAqIGJh
bGFuY2Ugd2l0aGluIHRoZSBub2RlLCBzaW5jZSB3ZSBsb2FkLWJhbGFuY2UgdGhlIG1vc3QgbG9h
ZGVkCisJICogbm9kZSB3aXRoIHRoZSBjdXJyZW50IENQVS4gKGllLiBvdGhlciBDUFVzIGluIHRo
ZSBsb2NhbCBub2RlCisJICogYXJlIG5vdCBiYWxhbmNlZC4pCisJICovCisJaWYgKGlkbGUpIHsK
KyNpZiBDT05GSUdfTlVNQQorCQlpZiAoIShqICUgSURMRV9OT0RFX1JFQkFMQU5DRV9USUNLKSkK
KwkJCWJhbGFuY2Vfbm9kZSh0aGlzX3JxLCBpZGxlLCB0aGlzX2NwdSk7CisjZW5kaWYKKwkJaWYg
KCEoaiAlIElETEVfUkVCQUxBTkNFX1RJQ0spKSB7CisJCQlzcGluX2xvY2soJnRoaXNfcnEtPmxv
Y2spOworCQkJbG9hZF9iYWxhbmNlKHRoaXNfcnEsIDAsIF9fY3B1X3RvX25vZGVfbWFzayh0aGlz
X2NwdSkpOworCQkJc3Bpbl91bmxvY2soJnRoaXNfcnEtPmxvY2spOworCQl9CisJCXJldHVybjsK
Kwl9CisjaWYgQ09ORklHX05VTUEKKwlpZiAoIShqICUgQlVTWV9OT0RFX1JFQkFMQU5DRV9USUNL
KSkKKwkJYmFsYW5jZV9ub2RlKHRoaXNfcnEsIGlkbGUsIHRoaXNfY3B1KTsKKyNlbmRpZgorCWlm
ICghKGogJSBCVVNZX1JFQkFMQU5DRV9USUNLKSkgeworCQlzcGluX2xvY2soJnRoaXNfcnEtPmxv
Y2spOworCQlsb2FkX2JhbGFuY2UodGhpc19ycSwgaWRsZSwgX19jcHVfdG9fbm9kZV9tYXNrKHRo
aXNfY3B1KSk7CisJCXNwaW5fdW5sb2NrKCZ0aGlzX3JxLT5sb2NrKTsKKwl9Cit9CisjZWxzZQor
LyoKKyAqIG9uIFVQIHdlIGRvIG5vdCBuZWVkIHRvIGJhbGFuY2UgYmV0d2VlbiBDUFVzOgorICov
CitzdGF0aWMgaW5saW5lIHZvaWQgcmViYWxhbmNlX3RpY2socnVucXVldWVfdCAqdGhpc19ycSwg
aW50IGlkbGUpCit7Cit9CiAjZW5kaWYKIAogREVGSU5FX1BFUl9DUFUoc3RydWN0IGtlcm5lbF9z
dGF0LCBrc3RhdCkgPSB7IHsgMCB9IH07CkBAIC0xMDYzLDkgKzEwOTIsNyBAQCB2b2lkIHNjaGVk
dWxlcl90aWNrKGludCB1c2VyX3RpY2tzLCBpbnQgCiAJCQlrc3RhdF9jcHUoY3B1KS5jcHVzdGF0
Lmlvd2FpdCArPSBzeXNfdGlja3M7CiAJCWVsc2UKIAkJCWtzdGF0X2NwdShjcHUpLmNwdXN0YXQu
aWRsZSArPSBzeXNfdGlja3M7Ci0jaWYgQ09ORklHX1NNUAotCQlpZGxlX3RpY2socnEpOwotI2Vu
ZGlmCisJCXJlYmFsYW5jZV90aWNrKHJxLCAxKTsKIAkJcmV0dXJuOwogCX0KIAlpZiAoVEFTS19O
SUNFKHApID4gMCkKQEAgLTExMjEsMTEgKzExNDgsOCBAQCB2b2lkIHNjaGVkdWxlcl90aWNrKGlu
dCB1c2VyX3RpY2tzLCBpbnQgCiAJCQllbnF1ZXVlX3Rhc2socCwgcnEtPmFjdGl2ZSk7CiAJfQog
b3V0OgotI2lmIENPTkZJR19TTVAKLQlpZiAoIShqaWZmaWVzICUgQlVTWV9SRUJBTEFOQ0VfVElD
SykpCi0JCWxvYWRfYmFsYW5jZShycSwgMCk7Ci0jZW5kaWYKIAlzcGluX3VubG9jaygmcnEtPmxv
Y2spOworCXJlYmFsYW5jZV90aWNrKHJxLCAwKTsKIH0KIAogdm9pZCBzY2hlZHVsaW5nX2Z1bmN0
aW9uc19zdGFydF9oZXJlKHZvaWQpIHsgfQpAQCAtMTE4NCw3ICsxMjA4LDcgQEAgbmVlZF9yZXNj
aGVkOgogcGlja19uZXh0X3Rhc2s6CiAJaWYgKHVubGlrZWx5KCFycS0+bnJfcnVubmluZykpIHsK
ICNpZiBDT05GSUdfU01QCi0JCWxvYWRfYmFsYW5jZShycSwgMSk7CisJCWxvYWRfYmFsYW5jZShy
cSwgMSwgX19jcHVfdG9fbm9kZV9tYXNrKHNtcF9wcm9jZXNzb3JfaWQoKSkpOwogCQlpZiAocnEt
Pm5yX3J1bm5pbmcpCiAJCQlnb3RvIHBpY2tfbmV4dF90YXNrOwogI2VuZGlmCg==

--==========1397890887==========
Content-Type: application/octet-stream; name=02-pools
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename=02-pools; size=12912

ZGlmZiAtdXJwTiAtWCAvaG9tZS9mbGV0Y2gvLmRpZmYuZXhjbHVkZSAwMS1pbmdvL2FyY2gvaTM4
Ni9LY29uZmlnIDAyLXBvb2xzL2FyY2gvaTM4Ni9LY29uZmlnCi0tLSAwMS1pbmdvL2FyY2gvaTM4
Ni9LY29uZmlnCUZyaSBKYW4gMTcgMDk6MTg6MTkgMjAwMworKysgMDItcG9vbHMvYXJjaC9pMzg2
L0tjb25maWcJU2F0IEphbiAxOCAxMTo1OTo1NCAyMDAzCkBAIC00NzYsNiArNDc2LDExIEBAIGNv
bmZpZyBOVU1BCiAJYm9vbCAiTnVtYSBNZW1vcnkgQWxsb2NhdGlvbiBTdXBwb3J0IgogCWRlcGVu
ZHMgb24gWDg2X05VTUFRCiAKK2NvbmZpZyBTQ0hFRF9OVU1BCisJYm9vbCAiTlVNQSBhd2FyZSBz
Y2hlZHVsZXIiCisJZGVwZW5kcyBvbiBOVU1BCisJZGVmYXVsdCB5CisKIGNvbmZpZyBESVNDT05U
SUdNRU0KIAlib29sCiAJZGVwZW5kcyBvbiBOVU1BCmRpZmYgLXVycE4gLVggL2hvbWUvZmxldGNo
Ly5kaWZmLmV4Y2x1ZGUgMDEtaW5nby9hcmNoL2lhNjQvS2NvbmZpZyAwMi1wb29scy9hcmNoL2lh
NjQvS2NvbmZpZwotLS0gMDEtaW5nby9hcmNoL2lhNjQvS2NvbmZpZwlUaHUgSmFuICA5IDE5OjE1
OjU2IDIwMDMKKysrIDAyLXBvb2xzL2FyY2gvaWE2NC9LY29uZmlnCVNhdCBKYW4gMTggMTI6MDA6
MDggMjAwMwpAQCAtMjQ2LDYgKzI0NiwxMSBAQCBjb25maWcgRElTQ09OVElHTUVNCiAJICBvciBo
YXZlIGh1Z2UgaG9sZXMgaW4gdGhlIHBoeXNpY2FsIGFkZHJlc3Mgc3BhY2UgZm9yIG90aGVyIHJl
YXNvbnMuCiAJICBTZWUgPGZpbGU6RG9jdW1lbnRhdGlvbi92bS9udW1hPiBmb3IgbW9yZS4KIAor
Y29uZmlnIFNDSEVEX05VTUEKKwlib29sICJOVU1BIGF3YXJlIHNjaGVkdWxlciIKKwlkZXBlbmRz
IG9uIE5VTUEKKwlkZWZhdWx0IHkKKwogY29uZmlnIFZJUlRVQUxfTUVNX01BUAogCWJvb2wgIkVu
YWJsZSBWaXJ0dWFsIE1lbSBNYXAiCiAJZGVwZW5kcyBvbiAhTlVNQQpkaWZmIC11cnBOIC1YIC9o
b21lL2ZsZXRjaC8uZGlmZi5leGNsdWRlIDAxLWluZ28vaW5jbHVkZS9saW51eC9zY2hlZC5oIDAy
LXBvb2xzL2luY2x1ZGUvbGludXgvc2NoZWQuaAotLS0gMDEtaW5nby9pbmNsdWRlL2xpbnV4L3Nj
aGVkLmgJRnJpIEphbiAxNyAwOToxODozMiAyMDAzCisrKyAwMi1wb29scy9pbmNsdWRlL2xpbnV4
L3NjaGVkLmgJU2F0IEphbiAxOCAxMjoyMTowOSAyMDAzCkBAIC00NDcsMTIgKzQ0NywxMiBAQCBl
eHRlcm4gdm9pZCBzZXRfY3B1c19hbGxvd2VkKHRhc2tfdCAqcCwgCiAjIGRlZmluZSBzZXRfY3B1
c19hbGxvd2VkKHAsIG5ld19tYXNrKSBkbyB7IH0gd2hpbGUgKDApCiAjZW5kaWYKIAotI2lmZGVm
IENPTkZJR19OVU1BCisjaWZkZWYgQ09ORklHX1NDSEVEX05VTUEKIGV4dGVybiB2b2lkIHNjaGVk
X2JhbGFuY2VfZXhlYyh2b2lkKTsKLWV4dGVybiB2b2lkIG5vZGVfbnJfcnVubmluZ19pbml0KHZv
aWQpOworZXh0ZXJuIHZvaWQgcG9vbF9ucl9ydW5uaW5nX2luaXQodm9pZCk7CiAjZWxzZQogI2Rl
ZmluZSBzY2hlZF9iYWxhbmNlX2V4ZWMoKSAgIHt9Ci0jZGVmaW5lIG5vZGVfbnJfcnVubmluZ19p
bml0KCkge30KKyNkZWZpbmUgcG9vbF9ucl9ydW5uaW5nX2luaXQoKSB7fQogI2VuZGlmCiAKIGV4
dGVybiB2b2lkIHNldF91c2VyX25pY2UodGFza190ICpwLCBsb25nIG5pY2UpOwpkaWZmIC11cnBO
IC1YIC9ob21lL2ZsZXRjaC8uZGlmZi5leGNsdWRlIDAxLWluZ28vaW5jbHVkZS9saW51eC9zY2hl
ZF90b3BvX2h0LmggMDItcG9vbHMvaW5jbHVkZS9saW51eC9zY2hlZF90b3BvX2h0LmgKLS0tIDAx
LWluZ28vaW5jbHVkZS9saW51eC9zY2hlZF90b3BvX2h0LmgJV2VkIERlYyAzMSAxNjowMDowMCAx
OTY5CisrKyAwMi1wb29scy9pbmNsdWRlL2xpbnV4L3NjaGVkX3RvcG9faHQuaAlTYXQgSmFuIDE4
IDEyOjIwOjAwIDIwMDMKQEAgLTAsMCArMSwxNyBAQAorI2RlZmluZSBDT05GSUdfU0NIRURfUE9P
TFMgMSAgICAgICAgICAgICAgIC8qIHNob3VsZCBiZSBhIHJlYWwgY29uZmlnIG9wdGlvbiAqLwor
CisvKiAKKyAqIFRoZSBmb2xsb3dpbmcgaXMgYSB0ZW1wb3JhcnkgaGFjaywgZm9yIHdoaWNoIEkg
bWFrZSBubyBhcG9sb2dpZXMgLSBtYmxpZ2gKKyAqIEFzc3VtZXMgQ1BVcyBhcmUgcGFpcmVkIHRv
Z2V0aGVyIHNpYmxpbmdzICgwLDEpICgyLDMpICg0LDUpIC4uLi4gZXRjLgorICogV2Ugc2hvdWxk
IHByb2JhYmx5IGRvIHRoaXMgaW4gYW4gYXJjaCB0b3BvIGZpbGUgYW5kIHVzZSBhcGljaWRzLgor
ICovCisKKyNkZWZpbmUgTUFYX05VTVBPT0xTIE5SX0NQVVMKKyNkZWZpbmUgbnVtcG9vbHMgKG51
bV9vbmxpbmVfY3B1cyAvIDIpCisKKyNkZWZpbmUgcG9vbF90b19jcHVfbWFzayhwb29sKQkoICgx
VUwgPDwgKHBvb2wqMikpIHx8ICgxVUwgPDwgKHBvb2wqMisxKSkgKQorI2RlZmluZSBjcHVfdG9f
cG9vbChjcHUpCShjcHUgLyAyKQorI2RlZmluZSBjcHVfdG9fcG9vbF9tYXNrKGNwdSkJKHBvb2xf
dG9fY3B1X21hc2soY3B1X3RvX3Bvb2woY3B1KSkpCisKKyNkZWZpbmUgSURMRV9SRUJBTEFOQ0Vf
UkFUSU8gMgorI2RlZmluZSBCVVNZX1JFQkFMQU5DRV9SQVRJTyAyCmRpZmYgLXVycE4gLVggL2hv
bWUvZmxldGNoLy5kaWZmLmV4Y2x1ZGUgMDEtaW5nby9pbmNsdWRlL2xpbnV4L3NjaGVkX3RvcG9f
bnVtYS5oIDAyLXBvb2xzL2luY2x1ZGUvbGludXgvc2NoZWRfdG9wb19udW1hLmgKLS0tIDAxLWlu
Z28vaW5jbHVkZS9saW51eC9zY2hlZF90b3BvX251bWEuaAlXZWQgRGVjIDMxIDE2OjAwOjAwIDE5
NjkKKysrIDAyLXBvb2xzL2luY2x1ZGUvbGludXgvc2NoZWRfdG9wb19udW1hLmgJU2F0IEphbiAx
OCAxMjoyMDowNSAyMDAzCkBAIC0wLDAgKzEsMTEgQEAKKyNkZWZpbmUgQ09ORklHX1NDSEVEX1BP
T0xTIDEgICAgICAgICAgICAgICAvKiBzaG91bGQgYmUgYSByZWFsIGNvbmZpZyBvcHRpb24gKi8K
KworI2RlZmluZSBNQVhfTlVNUE9PTFMgTUFYX05VTU5PREVTCisjZGVmaW5lIG51bXBvb2xzIG51
bW5vZGVzCisKKyNkZWZpbmUgcG9vbF90b19jcHVfbWFzawlfX25vZGVfdG9fY3B1X21hc2sKKyNk
ZWZpbmUgY3B1X3RvX3Bvb2wJCV9fY3B1X3RvX25vZGUKKyNkZWZpbmUgY3B1X3RvX3Bvb2xfbWFz
ayhjcHUpCShfX25vZGVfdG9fY3B1X21hc2soX19jcHVfdG9fbm9kZShjcHUpKSkKKworI2RlZmlu
ZSBJRExFX1JFQkFMQU5DRV9SQVRJTyAxMAorI2RlZmluZSBCVVNZX1JFQkFMQU5DRV9SQVRJTyA1
CmRpZmYgLXVycE4gLVggL2hvbWUvZmxldGNoLy5kaWZmLmV4Y2x1ZGUgMDEtaW5nby9pbmNsdWRl
L2xpbnV4L3NjaGVkX3RvcG9sb2d5LmggMDItcG9vbHMvaW5jbHVkZS9saW51eC9zY2hlZF90b3Bv
bG9neS5oCi0tLSAwMS1pbmdvL2luY2x1ZGUvbGludXgvc2NoZWRfdG9wb2xvZ3kuaAlXZWQgRGVj
IDMxIDE2OjAwOjAwIDE5NjkKKysrIDAyLXBvb2xzL2luY2x1ZGUvbGludXgvc2NoZWRfdG9wb2xv
Z3kuaAlTYXQgSmFuIDE4IDExOjU5OjM2IDIwMDMKQEAgLTAsMCArMSwxNCBAQAorI2lmbmRlZiBf
TElOVVhfU0NIRURfVE9QT0xPR1lfSAorI2RlZmluZSBfTElOVVhfU0NIRURfVE9QT0xPR1lfSAor
CisjaWZkZWYgQ09ORklHX1NDSEVEX1RPUE9fQVJDSAorI2luY2x1ZGUgPGFzbS9zY2hlZF90b3Bv
Lmg+CisjZWxpZiBDT05GSUdfU0NIRURfTlVNQQorI2luY2x1ZGUgPGxpbnV4L3NjaGVkX3RvcG9f
bnVtYS5oPgorI2VsaWYgQ09ORklHX1NDSEVEX1RPUE9fSFQKKyNpbmNsdWRlIDxsaW51eC9zY2hl
ZF90b3BvX2h0Lmg+CisjZWxzZQorI2luY2x1ZGUgPGxpbnV4L3NjaGVkX3RvcG9fZmxhdC5oPgor
I2VuZGlmCisKKyNlbmRpZiAvKiBfTElOVVhfU0NIRURfVE9QT0xPR1lfSCAqLwpkaWZmIC11cnBO
IC1YIC9ob21lL2ZsZXRjaC8uZGlmZi5leGNsdWRlIDAxLWluZ28vaW5pdC9tYWluLmMgMDItcG9v
bHMvaW5pdC9tYWluLmMKLS0tIDAxLWluZ28vaW5pdC9tYWluLmMJRnJpIEphbiAxNyAwOToxODoz
MiAyMDAzCisrKyAwMi1wb29scy9pbml0L21haW4uYwlTYXQgSmFuIDE4IDExOjQ4OjEwIDIwMDMK
QEAgLTQ5NSw3ICs0OTUsNyBAQCBzdGF0aWMgdm9pZCBkb19wcmVfc21wX2luaXRjYWxscyh2b2lk
KQogCiAJbWlncmF0aW9uX2luaXQoKTsKICNlbmRpZgotCW5vZGVfbnJfcnVubmluZ19pbml0KCk7
CisJcG9vbF9ucl9ydW5uaW5nX2luaXQoKTsKIAlzcGF3bl9rc29mdGlycWQoKTsKIH0KIApkaWZm
IC11cnBOIC1YIC9ob21lL2ZsZXRjaC8uZGlmZi5leGNsdWRlIDAxLWluZ28va2VybmVsL3NjaGVk
LmMgMDItcG9vbHMva2VybmVsL3NjaGVkLmMKLS0tIDAxLWluZ28va2VybmVsL3NjaGVkLmMJU2F0
IEphbiAxOCAxMDo1ODo1NyAyMDAzCisrKyAwMi1wb29scy9rZXJuZWwvc2NoZWQuYwlTYXQgSmFu
IDE4IDExOjQ5OjAwIDIwMDMKQEAgLTMyLDYgKzMyLDcgQEAKICNpbmNsdWRlIDxsaW51eC9kZWxh
eS5oPgogI2luY2x1ZGUgPGxpbnV4L3RpbWVyLmg+CiAjaW5jbHVkZSA8bGludXgvcmN1cGRhdGUu
aD4KKyNpbmNsdWRlIDxsaW51eC9zY2hlZF90b3BvbG9neS5oPgogCiAvKgogICogQ29udmVydCB1
c2VyLW5pY2UgdmFsdWVzIFsgLTIwIC4uLiAwIC4uLiAxOSBdCkBAIC02Nyw3ICs2OCw3IEBACiAj
ZGVmaW5lIElOVEVSQUNUSVZFX0RFTFRBCTIKICNkZWZpbmUgTUFYX1NMRUVQX0FWRwkJKDIqSFop
CiAjZGVmaW5lIFNUQVJWQVRJT05fTElNSVQJKDIqSFopCi0jZGVmaW5lIE5PREVfVEhSRVNIT0xE
ICAgICAgICAgIDEyNQorI2RlZmluZSBQT09MX1RIUkVTSE9MRCAgICAgICAgICAxMjUKIAogLyoK
ICAqIElmIGEgdGFzayBpcyAnaW50ZXJhY3RpdmUnIHRoZW4gd2UgcmVpbnNlcnQgaXQgaW4gdGhl
IGFjdGl2ZQpAQCAtMTU0LDkgKzE1NSw5IEBAIHN0cnVjdCBydW5xdWV1ZSB7CiAJdGFza190ICpj
dXJyLCAqaWRsZTsKIAlwcmlvX2FycmF5X3QgKmFjdGl2ZSwgKmV4cGlyZWQsIGFycmF5c1syXTsK
IAlpbnQgcHJldl9jcHVfbG9hZFtOUl9DUFVTXTsKLSNpZmRlZiBDT05GSUdfTlVNQQotCWF0b21p
Y190ICpub2RlX25yX3J1bm5pbmc7Ci0JaW50IHByZXZfbm9kZV9sb2FkW01BWF9OVU1OT0RFU107
CisjaWZkZWYgQ09ORklHX1NDSEVEX1BPT0xTCisJYXRvbWljX3QgKnBvb2xfbnJfcnVubmluZzsK
KwlpbnQgcHJldl9wb29sX2xvYWRbTUFYX05VTVBPT0xTXTsKICNlbmRpZgogCXRhc2tfdCAqbWln
cmF0aW9uX3RocmVhZDsKIAlzdHJ1Y3QgbGlzdF9oZWFkIG1pZ3JhdGlvbl9xdWV1ZTsKQEAgLTE4
MSw0NyArMTgyLDQ3IEBAIHN0YXRpYyBzdHJ1Y3QgcnVucXVldWUgcnVucXVldWVzW05SX0NQVVMK
ICMgZGVmaW5lIHRhc2tfcnVubmluZyhycSwgcCkJCSgocnEpLT5jdXJyID09IChwKSkKICNlbmRp
ZgogCi0jaWZkZWYgQ09ORklHX05VTUEKKyNpZmRlZiBDT05GSUdfU0NIRURfUE9PTFMKIAogLyoK
ICAqIEtlZXAgdHJhY2sgb2YgcnVubmluZyB0YXNrcy4KICAqLwogCi1zdGF0aWMgYXRvbWljX3Qg
bm9kZV9ucl9ydW5uaW5nW01BWF9OVU1OT0RFU10gX19fX2NhY2hlbGluZV9tYXhhbGlnbmVkX2lu
X3NtcCA9Ci0Je1swIC4uLk1BWF9OVU1OT0RFUy0xXSA9IEFUT01JQ19JTklUKDApfTsKK3N0YXRp
YyBhdG9taWNfdCBwb29sX25yX3J1bm5pbmdbTUFYX05VTVBPT0xTXSBfX19fY2FjaGVsaW5lX21h
eGFsaWduZWRfaW5fc21wID0KKwl7WzAgLi4uTUFYX05VTVBPT0xTLTFdID0gQVRPTUlDX0lOSVQo
MCl9OwogCiBzdGF0aWMgaW5saW5lIHZvaWQgbnJfcnVubmluZ19pbml0KHN0cnVjdCBydW5xdWV1
ZSAqcnEpCiB7Ci0JcnEtPm5vZGVfbnJfcnVubmluZyA9ICZub2RlX25yX3J1bm5pbmdbMF07CisJ
cnEtPnBvb2xfbnJfcnVubmluZyA9ICZwb29sX25yX3J1bm5pbmdbMF07CiB9CiAKIHN0YXRpYyBp
bmxpbmUgdm9pZCBucl9ydW5uaW5nX2luYyhydW5xdWV1ZV90ICpycSkKIHsKLQlhdG9taWNfaW5j
KHJxLT5ub2RlX25yX3J1bm5pbmcpOworCWF0b21pY19pbmMocnEtPnBvb2xfbnJfcnVubmluZyk7
CiAJcnEtPm5yX3J1bm5pbmcrKzsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIG5yX3J1bm5pbmdf
ZGVjKHJ1bnF1ZXVlX3QgKnJxKQogewotCWF0b21pY19kZWMocnEtPm5vZGVfbnJfcnVubmluZyk7
CisJYXRvbWljX2RlYyhycS0+cG9vbF9ucl9ydW5uaW5nKTsKIAlycS0+bnJfcnVubmluZy0tOwog
fQogCi1fX2luaXQgdm9pZCBub2RlX25yX3J1bm5pbmdfaW5pdCh2b2lkKQorX19pbml0IHZvaWQg
cG9vbF9ucl9ydW5uaW5nX2luaXQodm9pZCkKIHsKIAlpbnQgaTsKIAogCWZvciAoaSA9IDA7IGkg
PCBOUl9DUFVTOyBpKyspCi0JCWNwdV9ycShpKS0+bm9kZV9ucl9ydW5uaW5nID0gJm5vZGVfbnJf
cnVubmluZ1tfX2NwdV90b19ub2RlKGkpXTsKKwkJY3B1X3JxKGkpLT5wb29sX25yX3J1bm5pbmcg
PSAmcG9vbF9ucl9ydW5uaW5nW2NwdV90b19wb29sKGkpXTsKIH0KIAotI2Vsc2UgLyogIUNPTkZJ
R19OVU1BICovCisjZWxzZSAvKiAhQ09ORklHX1NDSEVEX1BPT0xTICovCiAKICMgZGVmaW5lIG5y
X3J1bm5pbmdfaW5pdChycSkgICBkbyB7IH0gd2hpbGUgKDApCiAjIGRlZmluZSBucl9ydW5uaW5n
X2luYyhycSkgICAgZG8geyAocnEpLT5ucl9ydW5uaW5nKys7IH0gd2hpbGUgKDApCiAjIGRlZmlu
ZSBucl9ydW5uaW5nX2RlYyhycSkgICAgZG8geyAocnEpLT5ucl9ydW5uaW5nLS07IH0gd2hpbGUg
KDApCiAKLSNlbmRpZiAvKiBDT05GSUdfTlVNQSAqLworI2VuZGlmIC8qIENPTkZJR19TQ0hFRF9Q
T09MUyAqLwogCiAvKgogICogdGFza19ycV9sb2NrIC0gbG9jayB0aGUgcnVucXVldWUgYSBnaXZl
biB0YXNrIHJlc2lkZXMgb24gYW5kIGRpc2FibGUKQEAgLTY3MCw3ICs2NzEsNyBAQCBzdGF0aWMg
aW5saW5lIHZvaWQgZG91YmxlX3JxX3VubG9jayhydW5xCiAJCXNwaW5fdW5sb2NrKCZycTItPmxv
Y2spOwogfQogCi0jaWYgQ09ORklHX05VTUEKKyNpZiBDT05GSUdfU0NIRURfUE9PTFMKIC8qCiAg
KiBJZiBkZXN0X2NwdSBpcyBhbGxvd2VkIGZvciB0aGlzIHByb2Nlc3MsIG1pZ3JhdGUgdGhlIHRh
c2sgdG8gaXQuCiAgKiBUaGlzIGlzIGFjY29tcGxpc2hlZCBieSBmb3JjaW5nIHRoZSBjcHVfYWxs
b3dlZCBtYXNrIHRvIG9ubHkKQEAgLTY5Nyw3ICs2OTgsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZF9t
aWdyYXRlX3Rhc2sodGFza190ICpwCiAgKi8KIHN0YXRpYyBpbnQgc2NoZWRfYmVzdF9jcHUoc3Ry
dWN0IHRhc2tfc3RydWN0ICpwKQogewotCWludCBpLCBtaW5sb2FkLCBsb2FkLCBiZXN0X2NwdSwg
bm9kZSA9IDA7CisJaW50IGksIG1pbmxvYWQsIGxvYWQsIGJlc3RfY3B1LCBwb29sID0gMDsKIAl1
bnNpZ25lZCBsb25nIGNwdW1hc2s7CiAKIAliZXN0X2NwdSA9IHRhc2tfY3B1KHApOwpAQCAtNzA1
LDE2ICs3MDYsMTYgQEAgc3RhdGljIGludCBzY2hlZF9iZXN0X2NwdShzdHJ1Y3QgdGFza19zdAog
CQlyZXR1cm4gYmVzdF9jcHU7CiAKIAltaW5sb2FkID0gMTAwMDAwMDA7Ci0JZm9yIChpID0gMDsg
aSA8IG51bW5vZGVzOyBpKyspIHsKLQkJbG9hZCA9IGF0b21pY19yZWFkKCZub2RlX25yX3J1bm5p
bmdbaV0pOworCWZvciAoaSA9IDA7IGkgPCBudW1wb29sczsgaSsrKSB7CisJCWxvYWQgPSBhdG9t
aWNfcmVhZCgmcG9vbF9ucl9ydW5uaW5nW2ldKTsKIAkJaWYgKGxvYWQgPCBtaW5sb2FkKSB7CiAJ
CQltaW5sb2FkID0gbG9hZDsKLQkJCW5vZGUgPSBpOworCQkJcG9vbCA9IGk7CiAJCX0KIAl9CiAK
IAltaW5sb2FkID0gMTAwMDAwMDA7Ci0JY3B1bWFzayA9IF9fbm9kZV90b19jcHVfbWFzayhub2Rl
KTsKKwljcHVtYXNrID0gcG9vbF90b19jcHVfbWFzayhwb29sKTsKIAlmb3IgKGkgPSAwOyBpIDwg
TlJfQ1BVUzsgKytpKSB7CiAJCWlmICghKGNwdW1hc2sgJiAoMVVMIDw8IGkpKSkKIAkJCWNvbnRp
bnVlOwpAQCAtNzMwLDcgKzczMSw3IEBAIHZvaWQgc2NoZWRfYmFsYW5jZV9leGVjKHZvaWQpCiB7
CiAJaW50IG5ld19jcHU7CiAKLQlpZiAobnVtbm9kZXMgPiAxKSB7CisJaWYgKG51bXBvb2xzID4g
MSkgewogCQluZXdfY3B1ID0gc2NoZWRfYmVzdF9jcHUoY3VycmVudCk7CiAJCWlmIChuZXdfY3B1
ICE9IHNtcF9wcm9jZXNzb3JfaWQoKSkKIAkJCXNjaGVkX21pZ3JhdGVfdGFzayhjdXJyZW50LCBu
ZXdfY3B1KTsKQEAgLTczOCwzMyArNzM5LDMzIEBAIHZvaWQgc2NoZWRfYmFsYW5jZV9leGVjKHZv
aWQpCiB9CiAKIC8qCi0gKiBGaW5kIHRoZSBidXNpZXN0IG5vZGUuIEFsbCBwcmV2aW91cyBub2Rl
IGxvYWRzIGNvbnRyaWJ1dGUgd2l0aCBhIAorICogRmluZCB0aGUgYnVzaWVzdCBwb29sLiBBbGwg
cHJldmlvdXMgcG9vbCBsb2FkcyBjb250cmlidXRlIHdpdGggYSAKICAqIGdlb21ldHJpY2FsbHkg
ZGVjY2F5aW5nIHdlaWdodCB0byB0aGUgbG9hZCBtZWFzdXJlOgotICogICAgICBsb2FkX3t0fSA9
IGxvYWRfe3QtMX0vMiArIG5yX25vZGVfcnVubmluZ197dH0KKyAqICAgICAgbG9hZF97dH0gPSBs
b2FkX3t0LTF9LzIgKyBucl9wb29sX3J1bm5pbmdfe3R9CiAgKiBUaGlzIHdheSBzdWRkZW4gbG9h
ZCBwZWFrcyBhcmUgZmxhdHRlbmVkIG91dCBhIGJpdC4KICAqLwotc3RhdGljIGludCBmaW5kX2J1
c2llc3Rfbm9kZShpbnQgdGhpc19ub2RlKQorc3RhdGljIGludCBmaW5kX2J1c2llc3RfcG9vbChp
bnQgdGhpc19wb29sKQogewotCWludCBpLCBub2RlID0gLTEsIGxvYWQsIHRoaXNfbG9hZCwgbWF4
bG9hZDsKKwlpbnQgaSwgcG9vbCA9IC0xLCBsb2FkLCB0aGlzX2xvYWQsIG1heGxvYWQ7CiAJCi0J
dGhpc19sb2FkID0gbWF4bG9hZCA9ICh0aGlzX3JxKCktPnByZXZfbm9kZV9sb2FkW3RoaXNfbm9k
ZV0gPj4gMSkKLQkJKyBhdG9taWNfcmVhZCgmbm9kZV9ucl9ydW5uaW5nW3RoaXNfbm9kZV0pOwot
CXRoaXNfcnEoKS0+cHJldl9ub2RlX2xvYWRbdGhpc19ub2RlXSA9IHRoaXNfbG9hZDsKLQlmb3Ig
KGkgPSAwOyBpIDwgbnVtbm9kZXM7IGkrKykgewotCQlpZiAoaSA9PSB0aGlzX25vZGUpCisJdGhp
c19sb2FkID0gbWF4bG9hZCA9ICh0aGlzX3JxKCktPnByZXZfcG9vbF9sb2FkW3RoaXNfcG9vbF0g
Pj4gMSkKKwkJKyBhdG9taWNfcmVhZCgmcG9vbF9ucl9ydW5uaW5nW3RoaXNfcG9vbF0pOworCXRo
aXNfcnEoKS0+cHJldl9wb29sX2xvYWRbdGhpc19wb29sXSA9IHRoaXNfbG9hZDsKKwlmb3IgKGkg
PSAwOyBpIDwgbnVtcG9vbHM7IGkrKykgeworCQlpZiAoaSA9PSB0aGlzX3Bvb2wpCiAJCQljb250
aW51ZTsKLQkJbG9hZCA9ICh0aGlzX3JxKCktPnByZXZfbm9kZV9sb2FkW2ldID4+IDEpCi0JCQkr
IGF0b21pY19yZWFkKCZub2RlX25yX3J1bm5pbmdbaV0pOwotCQl0aGlzX3JxKCktPnByZXZfbm9k
ZV9sb2FkW2ldID0gbG9hZDsKLQkJaWYgKGxvYWQgPiBtYXhsb2FkICYmICgxMDAqbG9hZCA+IE5P
REVfVEhSRVNIT0xEKnRoaXNfbG9hZCkpIHsKKwkJbG9hZCA9ICh0aGlzX3JxKCktPnByZXZfcG9v
bF9sb2FkW2ldID4+IDEpCisJCQkrIGF0b21pY19yZWFkKCZwb29sX25yX3J1bm5pbmdbaV0pOwor
CQl0aGlzX3JxKCktPnByZXZfcG9vbF9sb2FkW2ldID0gbG9hZDsKKwkJaWYgKGxvYWQgPiBtYXhs
b2FkICYmICgxMDAqbG9hZCA+IFBPT0xfVEhSRVNIT0xEKnRoaXNfbG9hZCkpIHsKIAkJCW1heGxv
YWQgPSBsb2FkOwotCQkJbm9kZSA9IGk7CisJCQlwb29sID0gaTsKIAkJfQogCX0KLQlyZXR1cm4g
bm9kZTsKKwlyZXR1cm4gcG9vbDsKIH0KIAotI2VuZGlmIC8qIENPTkZJR19OVU1BICovCisjZW5k
aWYgLyogQ09ORklHX1NDSEVEX1BPT0xTICovCiAKICNpZiBDT05GSUdfU01QCiAKQEAgLTk4Mywy
MiArOTg0LDIwIEBAIG91dDoKICAqCiAgKiBidXN5LXJlYmFsYW5jZSBldmVyeSAyMDAgbXNlY3Mu
IGlkbGUtcmViYWxhbmNlIGV2ZXJ5IDEgbXNlYy4gKG9yIG9uCiAgKiBzeXN0ZW1zIHdpdGggSFo9
MTAwLCBldmVyeSAxMCBtc2Vjcy4pCi0gKgotICogT24gTlVNQSwgZG8gYSBub2RlLXJlYmFsYW5j
ZSBldmVyeSA0MDAgbXNlY3MuCiAgKi8KICNkZWZpbmUgSURMRV9SRUJBTEFOQ0VfVElDSyAoSFov
MTAwMCA/OiAxKQogI2RlZmluZSBCVVNZX1JFQkFMQU5DRV9USUNLIChIWi81ID86IDEpCi0jZGVm
aW5lIElETEVfTk9ERV9SRUJBTEFOQ0VfVElDSyAoSURMRV9SRUJBTEFOQ0VfVElDSyAqIDIpCi0j
ZGVmaW5lIEJVU1lfTk9ERV9SRUJBTEFOQ0VfVElDSyAoQlVTWV9SRUJBTEFOQ0VfVElDSyAqIDIp
CisjZGVmaW5lIElETEVfUE9PTF9SRUJBTEFOQ0VfVElDSyAoSURMRV9SRUJBTEFOQ0VfVElDSyAq
IElETEVfUkVCQUxBTkNFX1JBVElPKQorI2RlZmluZSBCVVNZX1BPT0xfUkVCQUxBTkNFX1RJQ0sg
KEJVU1lfUkVCQUxBTkNFX1RJQ0sgKiBCVVNZX1JFQkFMQU5DRV9SQVRJTykKIAotI2lmIENPTkZJ
R19OVU1BCi1zdGF0aWMgdm9pZCBiYWxhbmNlX25vZGUocnVucXVldWVfdCAqdGhpc19ycSwgaW50
IGlkbGUsIGludCB0aGlzX2NwdSkKKyNpZiBDT05GSUdfU0NIRURfUE9PTFMKK3N0YXRpYyB2b2lk
IGJhbGFuY2VfcG9vbChydW5xdWV1ZV90ICp0aGlzX3JxLCBpbnQgaWRsZSwgaW50IHRoaXNfY3B1
KQogewotCWludCBub2RlID0gZmluZF9idXNpZXN0X25vZGUoX19jcHVfdG9fbm9kZSh0aGlzX2Nw
dSkpOworCWludCBwb29sID0gZmluZF9idXNpZXN0X3Bvb2woY3B1X3RvX3Bvb2wodGhpc19jcHUp
KTsKIAl1bnNpZ25lZCBsb25nIGNwdW1hc2ssIHRoaXNfY3B1bWFzayA9IDFVTCA8PCB0aGlzX2Nw
dTsKIAotCWlmIChub2RlID49IDApIHsKLQkJY3B1bWFzayA9IF9fbm9kZV90b19jcHVfbWFzayhu
b2RlKSB8IHRoaXNfY3B1bWFzazsKKwlpZiAocG9vbCA+PSAwKSB7CisJCWNwdW1hc2sgPSBwb29s
X3RvX2NwdV9tYXNrKHBvb2wpIHwgdGhpc19jcHVtYXNrOwogCQlzcGluX2xvY2soJnRoaXNfcnEt
PmxvY2spOwogCQlsb2FkX2JhbGFuY2UodGhpc19ycSwgaWRsZSwgY3B1bWFzayk7CiAJCXNwaW5f
dW5sb2NrKCZ0aGlzX3JxLT5sb2NrKTsKQEAgLTEwMDgsMzggKzEwMDcsMzggQEAgc3RhdGljIHZv
aWQgYmFsYW5jZV9ub2RlKHJ1bnF1ZXVlX3QgKnRoaQogCiBzdGF0aWMgdm9pZCByZWJhbGFuY2Vf
dGljayhydW5xdWV1ZV90ICp0aGlzX3JxLCBpbnQgaWRsZSkKIHsKLSNpZiBDT05GSUdfTlVNQQor
I2lmIENPTkZJR19TQ0hFRF9QT09MUwogCWludCB0aGlzX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQo
KTsKICNlbmRpZgogCXVuc2lnbmVkIGxvbmcgaiA9IGppZmZpZXM7CiAKIAkvKgotCSAqIEZpcnN0
IGRvIGludGVyLW5vZGUgcmViYWxhbmNpbmcsIHRoZW4gaW50cmEtbm9kZSByZWJhbGFuY2luZywK
LQkgKiBpZiBib3RoIGV2ZW50cyBoYXBwZW4gaW4gdGhlIHNhbWUgdGljay4gVGhlIGludGVyLW5v
ZGUKKwkgKiBGaXJzdCBkbyBpbnRlci1wb29sIHJlYmFsYW5jaW5nLCB0aGVuIGludHJhLXBvb2wg
cmViYWxhbmNpbmcsCisJICogaWYgYm90aCBldmVudHMgaGFwcGVuIGluIHRoZSBzYW1lIHRpY2su
IFRoZSBpbnRlci1wb29sCiAJICogcmViYWxhbmNpbmcgZG9lcyBub3QgbmVjZXNzYXJpbHkgaGF2
ZSB0byBjcmVhdGUgYSBwZXJmZWN0Ci0JICogYmFsYW5jZSB3aXRoaW4gdGhlIG5vZGUsIHNpbmNl
IHdlIGxvYWQtYmFsYW5jZSB0aGUgbW9zdCBsb2FkZWQKLQkgKiBub2RlIHdpdGggdGhlIGN1cnJl
bnQgQ1BVLiAoaWUuIG90aGVyIENQVXMgaW4gdGhlIGxvY2FsIG5vZGUKKwkgKiBiYWxhbmNlIHdp
dGhpbiB0aGUgcG9vbCwgc2luY2Ugd2UgbG9hZC1iYWxhbmNlIHRoZSBtb3N0IGxvYWRlZAorCSAq
IHBvb2wgd2l0aCB0aGUgY3VycmVudCBDUFUuIChpZS4gb3RoZXIgQ1BVcyBpbiB0aGUgbG9jYWwg
cG9vbAogCSAqIGFyZSBub3QgYmFsYW5jZWQuKQogCSAqLwogCWlmIChpZGxlKSB7Ci0jaWYgQ09O
RklHX05VTUEKLQkJaWYgKCEoaiAlIElETEVfTk9ERV9SRUJBTEFOQ0VfVElDSykpCi0JCQliYWxh
bmNlX25vZGUodGhpc19ycSwgaWRsZSwgdGhpc19jcHUpOworI2lmIENPTkZJR19TQ0hFRF9QT09M
UworCQlpZiAoIShqICUgSURMRV9QT09MX1JFQkFMQU5DRV9USUNLKSkKKwkJCWJhbGFuY2VfcG9v
bCh0aGlzX3JxLCBpZGxlLCB0aGlzX2NwdSk7CiAjZW5kaWYKIAkJaWYgKCEoaiAlIElETEVfUkVC
QUxBTkNFX1RJQ0spKSB7CiAJCQlzcGluX2xvY2soJnRoaXNfcnEtPmxvY2spOwotCQkJbG9hZF9i
YWxhbmNlKHRoaXNfcnEsIDAsIF9fY3B1X3RvX25vZGVfbWFzayh0aGlzX2NwdSkpOworCQkJbG9h
ZF9iYWxhbmNlKHRoaXNfcnEsIDAsIGNwdV90b19wb29sX21hc2sodGhpc19jcHUpKTsKIAkJCXNw
aW5fdW5sb2NrKCZ0aGlzX3JxLT5sb2NrKTsKIAkJfQogCQlyZXR1cm47CiAJfQotI2lmIENPTkZJ
R19OVU1BCi0JaWYgKCEoaiAlIEJVU1lfTk9ERV9SRUJBTEFOQ0VfVElDSykpCi0JCWJhbGFuY2Vf
bm9kZSh0aGlzX3JxLCBpZGxlLCB0aGlzX2NwdSk7CisjaWYgQ09ORklHX1NDSEVEX1BPT0xTCisJ
aWYgKCEoaiAlIEJVU1lfUE9PTF9SRUJBTEFOQ0VfVElDSykpCisJCWJhbGFuY2VfcG9vbCh0aGlz
X3JxLCBpZGxlLCB0aGlzX2NwdSk7CiAjZW5kaWYKIAlpZiAoIShqICUgQlVTWV9SRUJBTEFOQ0Vf
VElDSykpIHsKIAkJc3Bpbl9sb2NrKCZ0aGlzX3JxLT5sb2NrKTsKLQkJbG9hZF9iYWxhbmNlKHRo
aXNfcnEsIGlkbGUsIF9fY3B1X3RvX25vZGVfbWFzayh0aGlzX2NwdSkpOworCQlsb2FkX2JhbGFu
Y2UodGhpc19ycSwgaWRsZSwgY3B1X3RvX3Bvb2xfbWFzayh0aGlzX2NwdSkpOwogCQlzcGluX3Vu
bG9jaygmdGhpc19ycS0+bG9jayk7CiAJfQogfQpAQCAtMTIwOCw3ICsxMjA3LDcgQEAgbmVlZF9y
ZXNjaGVkOgogcGlja19uZXh0X3Rhc2s6CiAJaWYgKHVubGlrZWx5KCFycS0+bnJfcnVubmluZykp
IHsKICNpZiBDT05GSUdfU01QCi0JCWxvYWRfYmFsYW5jZShycSwgMSwgX19jcHVfdG9fbm9kZV9t
YXNrKHNtcF9wcm9jZXNzb3JfaWQoKSkpOworCQlsb2FkX2JhbGFuY2UocnEsIDEsIGNwdV90b19w
b29sX21hc2soc21wX3Byb2Nlc3Nvcl9pZCgpKSk7CiAJCWlmIChycS0+bnJfcnVubmluZykKIAkJ
CWdvdG8gcGlja19uZXh0X3Rhc2s7CiAjZW5kaWYK

--==========1397890887==========--

