Return-Path: <linux-kernel-owner+willy=40w.ods.org-S933029AbWKLR24@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S933029AbWKLR24 (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 12 Nov 2006 12:28:56 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S933028AbWKLR24
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 12 Nov 2006 12:28:56 -0500
Received: from bay0-omc3-s36.bay0.hotmail.com ([65.54.246.236]:44303 "EHLO
	bay0-omc3-s36.bay0.hotmail.com") by vger.kernel.org with ESMTP
	id S933029AbWKLR2y (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sun, 12 Nov 2006 12:28:54 -0500
Message-ID: <BAY20-F235674D034A2BD770165C1D8F50@phx.gbl>
X-Originating-IP: [80.178.43.168]
X-Originating-Email: [yan_952@hotmail.com]
From: "Burman Yan" <yan_952@hotmail.com>
To: trivial@kernel.org
Cc: linux-kernel@vger.kernel.org
Subject: [PATH] Replace kmalloc+memset with kzalloc 7/17
Date: Sun, 12 Nov 2006 19:28:53 +0200
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="----=_NextPart_000_1564_717c_5ee4"
X-OriginalArrivalTime: 12 Nov 2006 17:28:54.0380 (UTC) FILETIME=[06D8CAC0:01C70680]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------=_NextPart_000_1564_717c_5ee4
Content-Type: text/plain; format=flowed

Part 7 of the kmalloc+memset to kzalloc patch

I'll post the rest tomorrow.

Yan Burman

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/

------=_NextPart_000_1564_717c_5ee4
Content-Type: application/octet-stream; name="kzalloc_fs.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="kzalloc_fs.patch"

UmVwbGFjZSBrbWFsbG9jK21lbXNldCB3aXRoIGt6YWxsb2MgClBhdGNoIDcv
MTcKClNpZ25lZC1vZmYtYnk6IFlhbiBCdXJtYW4gPHlhbl85NTJAaG90bWFp
bC5jb20+CgpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9h
ZmZzL2JpdG1hcC5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9hZmZz
L2JpdG1hcC5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMvYWZmcy9i
aXRtYXAuYwkyMDA2LTExLTA5IDEyOjE2OjIwLjAwMDAwMDAwMCArMDIwMAor
KysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL2FmZnMvYml0bWFwLmMJ
MjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTI4OSwx
MiArMjg5LDExIEBAIGludCBhZmZzX2luaXRfYml0bWFwKHN0cnVjdCBzdXBl
cl9ibG9jayAKIAlzYmktPnNfYm1hcF9jb3VudCA9IChzYmktPnNfcGFydGl0
aW9uX3NpemUgLSBzYmktPnNfcmVzZXJ2ZWQgKwogCQkJCSBzYmktPnNfYm1h
cF9iaXRzIC0gMSkgLyBzYmktPnNfYm1hcF9iaXRzOwogCXNpemUgPSBzYmkt
PnNfYm1hcF9jb3VudCAqIHNpemVvZigqYm0pOwotCWJtID0gc2JpLT5zX2Jp
dG1hcCA9IGttYWxsb2Moc2l6ZSwgR0ZQX0tFUk5FTCk7CisJYm0gPSBzYmkt
PnNfYml0bWFwID0ga3phbGxvYyhzaXplLCBHRlBfS0VSTkVMKTsKIAlpZiAo
IXNiaS0+c19iaXRtYXApIHsKIAkJcHJpbnRrKEtFUk5fRVJSICJBRkZTOiBC
aXRtYXAgYWxsb2NhdGlvbiBmYWlsZWRcbiIpOwogCQlyZXR1cm4gLUVOT01F
TTsKIAl9Ci0JbWVtc2V0KHNiaS0+c19iaXRtYXAsIDAsIHNpemUpOwogCiAJ
Ym1hcF9ibGsgPSAoX19iZTMyICopc2JpLT5zX3Jvb3RfYmgtPmJfZGF0YTsK
IAlibGsgPSBzYi0+c19ibG9ja3NpemUgLyA0IC0gNDk7CmRpZmYgLXJ1YnAg
bGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL2Fmcy9zZXJ2ZXIuYyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZnMvYWZzL3NlcnZlci5jCi0tLSBsaW51eC0y
LjYuMTktcmM1X29yaWcvZnMvYWZzL3NlcnZlci5jCTIwMDYtMTEtMDkgMTI6
MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6
YWxsb2MvZnMvYWZzL3NlcnZlci5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAw
MDAwMDAwICswMjAwCkBAIC01NSwxMyArNTUsMTIgQEAgaW50IGFmc19zZXJ2
ZXJfbG9va3VwKHN0cnVjdCBhZnNfY2VsbCAqYwogCV9lbnRlcigiJXAsJTA4
eCwiLCBjZWxsLCBudG9obChhZGRyLT5zX2FkZHIpKTsKIAogCS8qIGFsbG9j
YXRlIGFuZCBpbml0aWFsaXNlIGEgc2VydmVyIHJlY29yZCAqLwotCXNlcnZl
ciA9IGttYWxsb2Moc2l6ZW9mKHN0cnVjdCBhZnNfc2VydmVyKSwgR0ZQX0tF
Uk5FTCk7CisJc2VydmVyID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFmc19z
ZXJ2ZXIpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXNlcnZlcikgewogCQlfbGVh
dmUoIiA9IC1FTk9NRU0iKTsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCi0J
bWVtc2V0KHNlcnZlciwgMCwgc2l6ZW9mKHN0cnVjdCBhZnNfc2VydmVyKSk7
CiAJYXRvbWljX3NldCgmc2VydmVyLT51c2FnZSwgMSk7CiAKIAlJTklUX0xJ
U1RfSEVBRCgmc2VydmVyLT5saW5rKTsKZGlmZiAtcnVicCBsaW51eC0yLjYu
MTktcmM1X29yaWcvZnMvYWZzL3N1cGVyLmMgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2ZzL2Fmcy9zdXBlci5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29y
aWcvZnMvYWZzL3N1cGVyLmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAw
MDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9hZnMv
c3VwZXIuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApA
QCAtMjQyLDE0ICsyNDIsMTIgQEAgc3RhdGljIGludCBhZnNfZmlsbF9zdXBl
cihzdHJ1Y3Qgc3VwZXJfYgogCWtlbnRlcigiIik7CiAKIAkvKiBhbGxvY2F0
ZSBhIHN1cGVyYmxvY2sgaW5mbyByZWNvcmQgKi8KLQlhcyA9IGttYWxsb2Mo
c2l6ZW9mKHN0cnVjdCBhZnNfc3VwZXJfaW5mbyksIEdGUF9LRVJORUwpOwor
CWFzID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFmc19zdXBlcl9pbmZvKSwg
R0ZQX0tFUk5FTCk7CiAJaWYgKCFhcykgewogCQlfbGVhdmUoIiA9IC1FTk9N
RU0iKTsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCi0JbWVtc2V0KGFzLCAw
LCBzaXplb2Yoc3RydWN0IGFmc19zdXBlcl9pbmZvKSk7Ci0KIAlhZnNfZ2V0
X3ZvbHVtZShwYXJhbXMtPnZvbHVtZSk7CiAJYXMtPnZvbHVtZSA9IHBhcmFt
cy0+dm9sdW1lOwogCmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmln
L2ZzL2F1dG9mczQvaW5vZGUuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2Mv
ZnMvYXV0b2ZzNC9pbm9kZS5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcv
ZnMvYXV0b2ZzNC9pbm9kZS5jCTIwMDYtMTEtMDkgMTI6MTY6MjAuMDAwMDAw
MDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvYXV0
b2ZzNC9pbm9kZS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICsw
MjAwCkBAIC0zMDAsMTMgKzMwMCwxMSBAQCBpbnQgYXV0b2ZzNF9maWxsX3N1
cGVyKHN0cnVjdCBzdXBlcl9ibG9jCiAJc3RydWN0IGF1dG9mc19zYl9pbmZv
ICpzYmk7CiAJc3RydWN0IGF1dG9mc19pbmZvICppbm87CiAKLQlzYmkgPSAo
c3RydWN0IGF1dG9mc19zYl9pbmZvICopIGttYWxsb2Moc2l6ZW9mKCpzYmkp
LCBHRlBfS0VSTkVMKTsKKwlzYmkgPSAoc3RydWN0IGF1dG9mc19zYl9pbmZv
ICopIGt6YWxsb2Moc2l6ZW9mKCpzYmkpLCBHRlBfS0VSTkVMKTsKIAlpZiAo
ICFzYmkgKQogCQlnb3RvIGZhaWxfdW5sb2NrOwogCURQUklOVEsoInN0YXJ0
aW5nIHVwLCBzYmkgPSAlcCIsc2JpKTsKIAotCW1lbXNldChzYmksIDAsIHNp
emVvZigqc2JpKSk7Ci0KIAlzLT5zX2ZzX2luZm8gPSBzYmk7CiAJc2JpLT5t
YWdpYyA9IEFVVE9GU19TQklfTUFHSUM7CiAJc2JpLT5waXBlZmQgPSAtMTsK
ZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMvYmluZm10X2Vs
Zl9mZHBpYy5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9iaW5mbXRf
ZWxmX2ZkcGljLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9iaW5m
bXRfZWxmX2ZkcGljLmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAwMDAg
KzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9iaW5mbXRf
ZWxmX2ZkcGljLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAy
MDAKQEAgLTcwOSwxMiArNzA5LDExIEBAIHN0YXRpYyBpbnQgZWxmX2ZkcGlj
X21hcF9maWxlKHN0cnVjdCBlbGYKIAkJcmV0dXJuIC1FTElCQkFEOwogCiAJ
c2l6ZSA9IHNpemVvZigqbG9hZG1hcCkgKyBubG9hZHMgKiBzaXplb2YoKnNl
Zyk7Ci0JbG9hZG1hcCA9IGttYWxsb2Moc2l6ZSwgR0ZQX0tFUk5FTCk7CisJ
bG9hZG1hcCA9IGt6YWxsb2Moc2l6ZSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFs
b2FkbWFwKQogCQlyZXR1cm4gLUVOT01FTTsKIAogCXBhcmFtcy0+bG9hZG1h
cCA9IGxvYWRtYXA7Ci0JbWVtc2V0KGxvYWRtYXAsIDAsIHNpemUpOwogCiAJ
bG9hZG1hcC0+dmVyc2lvbiA9IEVMRjMyX0ZEUElDX0xPQURNQVBfVkVSU0lP
TjsKIAlsb2FkbWFwLT5uc2VncyA9IG5sb2FkczsKZGlmZiAtcnVicCBsaW51
eC0yLjYuMTktcmM1X29yaWcvZnMvY2lmcy9jb25uZWN0LmMgbGludXgtMi42
LjE5LXJjNV9remFsbG9jL2ZzL2NpZnMvY29ubmVjdC5jCi0tLSBsaW51eC0y
LjYuMTktcmM1X29yaWcvZnMvY2lmcy9jb25uZWN0LmMJMjAwNi0xMS0wOSAx
MjoxNjoyMC4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVf
a3phbGxvYy9mcy9jaWZzL2Nvbm5lY3QuYwkyMDA2LTExLTExIDIyOjQ0OjE4
LjAwMDAwMDAwMCArMDIwMApAQCAtMTc1NSw3ICsxNzU1LDcgQEAgY2lmc19t
b3VudChzdHJ1Y3Qgc3VwZXJfYmxvY2sgKnNiLCBzdHJ1YwogCQkJcmV0dXJu
IHJjOwogCQl9CiAKLQkJc3J2VGNwID0ga21hbGxvYyhzaXplb2YgKHN0cnVj
dCBUQ1BfU2VydmVyX0luZm8pLCBHRlBfS0VSTkVMKTsKKwkJc3J2VGNwID0g
a3phbGxvYyhzaXplb2YgKHN0cnVjdCBUQ1BfU2VydmVyX0luZm8pLCBHRlBf
S0VSTkVMKTsKIAkJaWYgKHNydlRjcCA9PSBOVUxMKSB7CiAJCQlyYyA9IC1F
Tk9NRU07CiAJCQlzb2NrX3JlbGVhc2UoY3NvY2tldCk7CkBAIC0xNzY1LDcg
KzE3NjUsNiBAQCBjaWZzX21vdW50KHN0cnVjdCBzdXBlcl9ibG9jayAqc2Is
IHN0cnVjCiAJCQlGcmVlWGlkKHhpZCk7CiAJCQlyZXR1cm4gcmM7CiAJCX0g
ZWxzZSB7Ci0JCQltZW1zZXQoc3J2VGNwLCAwLCBzaXplb2YgKHN0cnVjdCBU
Q1BfU2VydmVyX0luZm8pKTsKIAkJCW1lbWNweSgmc3J2VGNwLT5hZGRyLnNv
Y2tBZGRyLCAmc2luX3NlcnZlciwgc2l6ZW9mIChzdHJ1Y3Qgc29ja2FkZHJf
aW4pKTsKIAkJCWF0b21pY19zZXQoJnNydlRjcC0+aW5GbGlnaHQsMCk7CiAJ
CQkvKiBCQiBBZGQgY29kZSBmb3IgaXB2NiBjYXNlIHRvbyAqLwpkaWZmIC1y
dWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9kbG0vbWVtb3J5LmMgbGlu
dXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL2RsbS9tZW1vcnkuYwotLS0gbGlu
dXgtMi42LjE5LXJjNV9vcmlnL2ZzL2RsbS9tZW1vcnkuYwkyMDA2LTExLTA5
IDEyOjE2OjIwLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2ZzL2RsbS9tZW1vcnkuYwkyMDA2LTExLTExIDIyOjQ0OjA0
LjAwMDAwMDAwMCArMDIwMApAQCAtMzcsMTIgKzM3LDcgQEAgdm9pZCBkbG1f
bWVtb3J5X2V4aXQodm9pZCkKIAogY2hhciAqYWxsb2NhdGVfbHZiKHN0cnVj
dCBkbG1fbHMgKmxzKQogewotCWNoYXIgKnA7Ci0KLQlwID0ga21hbGxvYyhs
cy0+bHNfbHZibGVuLCBHRlBfS0VSTkVMKTsKLQlpZiAocCkKLQkJbWVtc2V0
KHAsIDAsIGxzLT5sc19sdmJsZW4pOwotCXJldHVybiBwOworCXJldHVybiBr
emFsbG9jKGxzLT5sc19sdmJsZW4sIEdGUF9LRVJORUwpOwogfQogCiB2b2lk
IGZyZWVfbHZiKGNoYXIgKnApCkBAIC01NSwxNCArNTAsOSBAQCB2b2lkIGZy
ZWVfbHZiKGNoYXIgKnApCiAKIHN0cnVjdCBkbG1fcnNiICphbGxvY2F0ZV9y
c2Ioc3RydWN0IGRsbV9scyAqbHMsIGludCBuYW1lbGVuKQogewotCXN0cnVj
dCBkbG1fcnNiICpyOwotCiAJRExNX0FTU0VSVChuYW1lbGVuIDw9IERMTV9S
RVNOQU1FX01BWExFTiwpOwogCi0JciA9IGttYWxsb2Moc2l6ZW9mKCpyKSAr
IG5hbWVsZW4sIEdGUF9LRVJORUwpOwotCWlmIChyKQotCQltZW1zZXQociwg
MCwgc2l6ZW9mKCpyKSArIG5hbWVsZW4pOwotCXJldHVybiByOworCXJldHVy
biBremFsbG9jKHNpemVvZihzdHJ1Y3QgZGxtX3JzYikgKyBuYW1lbGVuLCBH
RlBfS0VSTkVMKTsKIH0KIAogdm9pZCBmcmVlX3JzYihzdHJ1Y3QgZGxtX3Jz
YiAqcikKQEAgLTk4LDE1ICs4OCwxMCBAQCB2b2lkIGZyZWVfbGtiKHN0cnVj
dCBkbG1fbGtiICpsa2IpCiAKIHN0cnVjdCBkbG1fZGlyZW50cnkgKmFsbG9j
YXRlX2RpcmVudHJ5KHN0cnVjdCBkbG1fbHMgKmxzLCBpbnQgbmFtZWxlbikK
IHsKLQlzdHJ1Y3QgZGxtX2RpcmVudHJ5ICpkZTsKLQogCURMTV9BU1NFUlQo
bmFtZWxlbiA8PSBETE1fUkVTTkFNRV9NQVhMRU4sCiAJCSAgIHByaW50aygi
bmFtZWxlbiA9ICVkXG4iLCBuYW1lbGVuKTspOwogCi0JZGUgPSBrbWFsbG9j
KHNpemVvZigqZGUpICsgbmFtZWxlbiwgR0ZQX0tFUk5FTCk7Ci0JaWYgKGRl
KQotCQltZW1zZXQoZGUsIDAsIHNpemVvZigqZGUpICsgbmFtZWxlbik7Ci0J
cmV0dXJuIGRlOworCXJldHVybiBremFsbG9jKHNpemVvZihzdHJ1Y3QgZGxt
X2RpcmVudHJ5KSArIG5hbWVsZW4sIEdGUF9LRVJORUwpOwogfQogCiB2b2lk
IGZyZWVfZGlyZW50cnkoc3RydWN0IGRsbV9kaXJlbnRyeSAqZGUpCmRpZmYg
LXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL2V4dDIvc3VwZXIuYyBs
aW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvZXh0Mi9zdXBlci5jCi0tLSBs
aW51eC0yLjYuMTktcmM1X29yaWcvZnMvZXh0Mi9zdXBlci5jCTIwMDYtMTEt
MDkgMTI6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTkt
cmM1X2t6YWxsb2MvZnMvZXh0Mi9zdXBlci5jCTIwMDYtMTEtMTEgMjI6NDQ6
MDQuMDAwMDAwMDAwICswMjAwCkBAIC04ODMsMTMgKzg4MywxMiBAQCBzdGF0
aWMgaW50IGV4dDJfZmlsbF9zdXBlcihzdHJ1Y3Qgc3VwZXJfCiAJCWdvdG8g
ZmFpbGVkX21vdW50OwogCX0KIAliZ2xfbG9ja19pbml0KCZzYmktPnNfYmxv
Y2tncm91cF9sb2NrKTsKLQlzYmktPnNfZGVidHMgPSBrbWFsbG9jKHNiaS0+
c19ncm91cHNfY291bnQgKiBzaXplb2YoKnNiaS0+c19kZWJ0cyksCisJc2Jp
LT5zX2RlYnRzID0ga3phbGxvYyhzYmktPnNfZ3JvdXBzX2NvdW50ICogc2l6
ZW9mKCpzYmktPnNfZGVidHMpLAogCQkJICAgICAgIEdGUF9LRVJORUwpOwog
CWlmICghc2JpLT5zX2RlYnRzKSB7CiAJCXByaW50ayAoIkVYVDItZnM6IG5v
dCBlbm91Z2ggbWVtb3J5XG4iKTsKIAkJZ290byBmYWlsZWRfbW91bnRfZ3Jv
dXBfZGVzYzsKIAl9Ci0JbWVtc2V0KHNiaS0+c19kZWJ0cywgMCwgc2JpLT5z
X2dyb3Vwc19jb3VudCAqIHNpemVvZigqc2JpLT5zX2RlYnRzKSk7CiAJZm9y
IChpID0gMDsgaSA8IGRiX2NvdW50OyBpKyspIHsKIAkJYmxvY2sgPSBkZXNj
cmlwdG9yX2xvYyhzYiwgbG9naWNfc2JfYmxvY2ssIGkpOwogCQlzYmktPnNf
Z3JvdXBfZGVzY1tpXSA9IHNiX2JyZWFkKHNiLCBibG9jayk7CmRpZmYgLXJ1
YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL2V4dDMveGF0dHIuYyBsaW51
eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvZXh0My94YXR0ci5jCi0tLSBsaW51
eC0yLjYuMTktcmM1X29yaWcvZnMvZXh0My94YXR0ci5jCTIwMDYtMTEtMDkg
MTI6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1
X2t6YWxsb2MvZnMvZXh0My94YXR0ci5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQu
MDAwMDAwMDAwICswMjAwCkBAIC03MzMsMTIgKzczMywxMSBAQCBleHQzX3hh
dHRyX2Jsb2NrX3NldChoYW5kbGVfdCAqaGFuZGxlLCBzCiAJCX0KIAl9IGVs
c2UgewogCQkvKiBBbGxvY2F0ZSBhIGJ1ZmZlciB3aGVyZSB3ZSBjb25zdHJ1
Y3QgdGhlIG5ldyBibG9jay4gKi8KLQkJcy0+YmFzZSA9IGttYWxsb2Moc2It
PnNfYmxvY2tzaXplLCBHRlBfS0VSTkVMKTsKKwkJcy0+YmFzZSA9IGt6YWxs
b2Moc2ItPnNfYmxvY2tzaXplLCBHRlBfS0VSTkVMKTsKIAkJLyogYXNzZXJ0
KGhlYWRlciA9PSBzLT5iYXNlKSAqLwogCQllcnJvciA9IC1FTk9NRU07CiAJ
CWlmIChzLT5iYXNlID09IE5VTEwpCiAJCQlnb3RvIGNsZWFudXA7Ci0JCW1l
bXNldChzLT5iYXNlLCAwLCBzYi0+c19ibG9ja3NpemUpOwogCQloZWFkZXIo
cy0+YmFzZSktPmhfbWFnaWMgPSBjcHVfdG9fbGUzMihFWFQzX1hBVFRSX01B
R0lDKTsKIAkJaGVhZGVyKHMtPmJhc2UpLT5oX2Jsb2NrcyA9IGNwdV90b19s
ZTMyKDEpOwogCQloZWFkZXIocy0+YmFzZSktPmhfcmVmY291bnQgPSBjcHVf
dG9fbGUzMigxKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcv
ZnMvZXh0NC9leHRlbnRzLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Zz
L2V4dDQvZXh0ZW50cy5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMv
ZXh0NC9leHRlbnRzLmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAwMDAg
KzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9leHQ0L2V4
dGVudHMuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApA
QCAtNjQxLDEwICs2NDEsOSBAQCBzdGF0aWMgaW50IGV4dDRfZXh0X3NwbGl0
KGhhbmRsZV90ICpoYW5kCiAJICogV2UgbmVlZCB0aGlzIHRvIGhhbmRsZSBl
cnJvcnMgYW5kIGZyZWUgYmxvY2tzCiAJICogdXBvbiB0aGVtLgogCSAqLwot
CWFibG9ja3MgPSBrbWFsbG9jKHNpemVvZihleHQ0X2ZzYmxrX3QpICogZGVw
dGgsIEdGUF9OT0ZTKTsKKwlhYmxvY2tzID0ga3phbGxvYyhzaXplb2YoZXh0
NF9mc2Jsa190KSAqIGRlcHRoLCBHRlBfTk9GUyk7CiAJaWYgKCFhYmxvY2tz
KQogCQlyZXR1cm4gLUVOT01FTTsKLQltZW1zZXQoYWJsb2NrcywgMCwgc2l6
ZW9mKGV4dDRfZnNibGtfdCkgKiBkZXB0aCk7CiAKIAkvKiBhbGxvY2F0ZSBh
bGwgbmVlZGVkIGJsb2NrcyAqLwogCWV4dF9kZWJ1ZygiYWxsb2NhdGUgJWQg
YmxvY2tzIGZvciBpbmRleGVzL2xlYWZcbiIsIGRlcHRoIC0gYXQpOwpAQCAt
MTc1NiwxMiArMTc1NSwxMSBAQCBpbnQgZXh0NF9leHRfcmVtb3ZlX3NwYWNl
KHN0cnVjdCBpbm9kZSAqCiAJICogV2Ugc3RhcnQgc2Nhbm5pbmcgZnJvbSBy
aWdodCBzaWRlLCBmcmVlaW5nIGFsbCB0aGUgYmxvY2tzCiAJICogYWZ0ZXIg
aV9zaXplIGFuZCB3YWxraW5nIGludG8gdGhlIHRyZWUgZGVwdGgtd2lzZS4K
IAkgKi8KLQlwYXRoID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IGV4dDRfZXh0
X3BhdGgpICogKGRlcHRoICsgMSksIEdGUF9LRVJORUwpOworCXBhdGggPSBr
emFsbG9jKHNpemVvZihzdHJ1Y3QgZXh0NF9leHRfcGF0aCkgKiAoZGVwdGgg
KyAxKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKHBhdGggPT0gTlVMTCkgewogCQll
eHQ0X2pvdXJuYWxfc3RvcChoYW5kbGUpOwogCQlyZXR1cm4gLUVOT01FTTsK
IAl9Ci0JbWVtc2V0KHBhdGgsIDAsIHNpemVvZihzdHJ1Y3QgZXh0NF9leHRf
cGF0aCkgKiAoZGVwdGggKyAxKSk7CiAJcGF0aFswXS5wX2hkciA9IGV4dF9p
bm9kZV9oZHIoaW5vZGUpOwogCWlmIChleHQ0X2V4dF9jaGVja19oZWFkZXIo
X19GVU5DVElPTl9fLCBpbm9kZSwgcGF0aFswXS5wX2hkcikpIHsKIAkJZXJy
ID0gLUVJTzsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMv
ZXh0NC94YXR0ci5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9leHQ0
L3hhdHRyLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9leHQ0L3hh
dHRyLmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAwMDAgKzAyMDAKKysr
IGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9leHQ0L3hhdHRyLmMJMjAw
Ni0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTczMywxMiAr
NzMzLDExIEBAIGV4dDRfeGF0dHJfYmxvY2tfc2V0KGhhbmRsZV90ICpoYW5k
bGUsIHMKIAkJfQogCX0gZWxzZSB7CiAJCS8qIEFsbG9jYXRlIGEgYnVmZmVy
IHdoZXJlIHdlIGNvbnN0cnVjdCB0aGUgbmV3IGJsb2NrLiAqLwotCQlzLT5i
YXNlID0ga21hbGxvYyhzYi0+c19ibG9ja3NpemUsIEdGUF9LRVJORUwpOwor
CQlzLT5iYXNlID0ga3phbGxvYyhzYi0+c19ibG9ja3NpemUsIEdGUF9LRVJO
RUwpOwogCQkvKiBhc3NlcnQoaGVhZGVyID09IHMtPmJhc2UpICovCiAJCWVy
cm9yID0gLUVOT01FTTsKIAkJaWYgKHMtPmJhc2UgPT0gTlVMTCkKIAkJCWdv
dG8gY2xlYW51cDsKLQkJbWVtc2V0KHMtPmJhc2UsIDAsIHNiLT5zX2Jsb2Nr
c2l6ZSk7CiAJCWhlYWRlcihzLT5iYXNlKS0+aF9tYWdpYyA9IGNwdV90b19s
ZTMyKEVYVDRfWEFUVFJfTUFHSUMpOwogCQloZWFkZXIocy0+YmFzZSktPmhf
YmxvY2tzID0gY3B1X3RvX2xlMzIoMSk7CiAJCWhlYWRlcihzLT5iYXNlKS0+
aF9yZWZjb3VudCA9IGNwdV90b19sZTMyKDEpOwpkaWZmIC1ydWJwIGxpbnV4
LTIuNi4xOS1yYzVfb3JpZy9mcy9qZmZzL2ludHJlcC5jIGxpbnV4LTIuNi4x
OS1yYzVfa3phbGxvYy9mcy9qZmZzL2ludHJlcC5jCi0tLSBsaW51eC0yLjYu
MTktcmM1X29yaWcvZnMvamZmcy9pbnRyZXAuYwkyMDA2LTExLTA5IDEyOjE2
OjIwLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFs
bG9jL2ZzL2pmZnMvaW50cmVwLmMJMjAwNi0xMS0xMSAyMjo0NDoxOC4wMDAw
MDAwMDAgKzAyMDAKQEAgLTU5MSw3ICs1OTEsNyBAQCBqZmZzX2FkZF92aXJ0
dWFsX3Jvb3Qoc3RydWN0IGpmZnNfY29udHJvCiAJRDIocHJpbnRrKCJqZmZz
X2FkZF92aXJ0dWFsX3Jvb3QoKTogIgogCQkgICJDcmVhdGluZyBhIHZpcnR1
YWwgcm9vdCBkaXJlY3RvcnkuXG4iKSk7CiAKLQlpZiAoIShyb290ID0ga21h
bGxvYyhzaXplb2Yoc3RydWN0IGpmZnNfZmlsZSksIEdGUF9LRVJORUwpKSkg
eworCWlmICghKHJvb3QgPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgamZmc19m
aWxlKSwgR0ZQX0tFUk5FTCkpKSB7CiAJCXJldHVybiAtRU5PTUVNOwogCX0K
IAlub19qZmZzX2ZpbGUrKzsKQEAgLTYwMyw3ICs2MDMsNiBAQCBqZmZzX2Fk
ZF92aXJ0dWFsX3Jvb3Qoc3RydWN0IGpmZnNfY29udHJvCiAJREpNKG5vX2pm
ZnNfbm9kZSsrKTsKIAltZW1zZXQobm9kZSwgMCwgc2l6ZW9mKHN0cnVjdCBq
ZmZzX25vZGUpKTsKIAlub2RlLT5pbm8gPSBKRkZTX01JTl9JTk87Ci0JbWVt
c2V0KHJvb3QsIDAsIHNpemVvZihzdHJ1Y3QgamZmc19maWxlKSk7CiAJcm9v
dC0+aW5vID0gSkZGU19NSU5fSU5POwogCXJvb3QtPm1vZGUgPSBTX0lGRElS
IHwgU19JUldYVSB8IFNfSVJHUlAKIAkJICAgICB8IFNfSVhHUlAgfCBTX0lS
T1RIIHwgU19JWE9USDsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29y
aWcvZnMvamZmczIvZnMuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMv
amZmczIvZnMuYwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL2pmZnMy
L2ZzLmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAwMDAgKzAyMDAKKysr
IGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9qZmZzMi9mcy5jCTIwMDYt
MTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC01MDIsMTIgKzUw
MiwxMSBAQCBpbnQgamZmczJfZG9fZmlsbF9zdXBlcihzdHJ1Y3Qgc3VwZXJf
YmxvCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWMtPmlub2NhY2hl
X2xpc3QgPSBrbWFsbG9jKElOT0NBQ0hFX0hBU0hTSVpFICogc2l6ZW9mKHN0
cnVjdCBqZmZzMl9pbm9kZV9jYWNoZSAqKSwgR0ZQX0tFUk5FTCk7CisJYy0+
aW5vY2FjaGVfbGlzdCA9IGt6YWxsb2MoSU5PQ0FDSEVfSEFTSFNJWkUgKiBz
aXplb2Yoc3RydWN0IGpmZnMyX2lub2RlX2NhY2hlICopLCBHRlBfS0VSTkVM
KTsKIAlpZiAoIWMtPmlub2NhY2hlX2xpc3QpIHsKIAkJcmV0ID0gLUVOT01F
TTsKIAkJZ290byBvdXRfd2J1ZjsKIAl9Ci0JbWVtc2V0KGMtPmlub2NhY2hl
X2xpc3QsIDAsIElOT0NBQ0hFX0hBU0hTSVpFICogc2l6ZW9mKHN0cnVjdCBq
ZmZzMl9pbm9kZV9jYWNoZSAqKSk7CiAKIAlqZmZzMl9pbml0X3hhdHRyX3N1
YnN5c3RlbShjKTsKIApkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3Jp
Zy9mcy9qZmZzMi9yZWFkaW5vZGUuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxs
b2MvZnMvamZmczIvcmVhZGlub2RlLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9mcy9qZmZzMi9yZWFkaW5vZGUuYwkyMDA2LTExLTA5IDEyOjE2OjIw
LjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9j
L2ZzL2pmZnMyL3JlYWRpbm9kZS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAw
MDAwMDAwICswMjAwCkBAIC05NDQsMTMgKzk0NCwxMiBAQCBpbnQgamZmczJf
ZG9fcmVhZF9pbm9kZShzdHJ1Y3QgamZmczJfc2JfCiBpbnQgamZmczJfZG9f
Y3JjY2hlY2tfaW5vZGUoc3RydWN0IGpmZnMyX3NiX2luZm8gKmMsIHN0cnVj
dCBqZmZzMl9pbm9kZV9jYWNoZSAqaWMpCiB7CiAJc3RydWN0IGpmZnMyX3Jh
d19pbm9kZSBuOwotCXN0cnVjdCBqZmZzMl9pbm9kZV9pbmZvICpmID0ga21h
bGxvYyhzaXplb2YoKmYpLCBHRlBfS0VSTkVMKTsKKwlzdHJ1Y3QgamZmczJf
aW5vZGVfaW5mbyAqZiA9IGt6YWxsb2Moc2l6ZW9mKCpmKSwgR0ZQX0tFUk5F
TCk7CiAJaW50IHJldDsKIAogCWlmICghZikKIAkJcmV0dXJuIC1FTk9NRU07
CiAKLQltZW1zZXQoZiwgMCwgc2l6ZW9mKCpmKSk7CiAJaW5pdF9NVVRFWF9M
T0NLRUQoJmYtPnNlbSk7CiAJZi0+aW5vY2FjaGUgPSBpYzsKIApkaWZmIC1y
dWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9qZmZzMi9zY2FuLmMgbGlu
dXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL2pmZnMyL3NjYW4uYwotLS0gbGlu
dXgtMi42LjE5LXJjNV9vcmlnL2ZzL2pmZnMyL3NjYW4uYwkyMDA2LTExLTA5
IDEyOjE2OjIwLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2ZzL2pmZnMyL3NjYW4uYwkyMDA2LTExLTExIDIyOjQ0OjA0
LjAwMDAwMDAwMCArMDIwMApAQCAtMTI4LDEyICsxMjgsMTEgQEAgaW50IGpm
ZnMyX3NjYW5fbWVkaXVtKHN0cnVjdCBqZmZzMl9zYl9pbgogCX0KIAogCWlm
IChqZmZzMl9zdW1fYWN0aXZlKCkpIHsKLQkJcyA9IGttYWxsb2Moc2l6ZW9m
KHN0cnVjdCBqZmZzMl9zdW1tYXJ5KSwgR0ZQX0tFUk5FTCk7CisJCXMgPSBr
emFsbG9jKHNpemVvZihzdHJ1Y3QgamZmczJfc3VtbWFyeSksIEdGUF9LRVJO
RUwpOwogCQlpZiAoIXMpIHsKIAkJCUpGRlMyX1dBUk5JTkcoIkNhbid0IGFs
bG9jYXRlIG1lbW9yeSBmb3Igc3VtbWFyeVxuIik7CiAJCQlyZXR1cm4gLUVO
T01FTTsKIAkJfQotCQltZW1zZXQocywgMCwgc2l6ZW9mKHN0cnVjdCBqZmZz
Ml9zdW1tYXJ5KSk7CiAJfQogCiAJZm9yIChpPTA7IGk8Yy0+bnJfYmxvY2tz
OyBpKyspIHsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMv
amZmczIvc3VtbWFyeS5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9q
ZmZzMi9zdW1tYXJ5LmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9q
ZmZzMi9zdW1tYXJ5LmMJMjAwNi0xMS0wOSAxMjoxNjoyMC4wMDAwMDAwMDAg
KzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9mcy9qZmZzMi9z
dW1tYXJ5LmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAK
QEAgLTI2LDE1ICsyNiwxMyBAQAogCiBpbnQgamZmczJfc3VtX2luaXQoc3Ry
dWN0IGpmZnMyX3NiX2luZm8gKmMpCiB7Ci0JYy0+c3VtbWFyeSA9IGttYWxs
b2Moc2l6ZW9mKHN0cnVjdCBqZmZzMl9zdW1tYXJ5KSwgR0ZQX0tFUk5FTCk7
CisJYy0+c3VtbWFyeSA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBqZmZzMl9z
dW1tYXJ5KSwgR0ZQX0tFUk5FTCk7CiAKIAlpZiAoIWMtPnN1bW1hcnkpIHsK
IAkJSkZGUzJfV0FSTklORygiQ2FuJ3QgYWxsb2NhdGUgbWVtb3J5IGZvciBz
dW1tYXJ5IGluZm9ybWF0aW9uIVxuIik7CiAJCXJldHVybiAtRU5PTUVNOwog
CX0KIAotCW1lbXNldChjLT5zdW1tYXJ5LCAwLCBzaXplb2Yoc3RydWN0IGpm
ZnMyX3N1bW1hcnkpKTsKLQogCWMtPnN1bW1hcnktPnN1bV9idWYgPSB2bWFs
bG9jKGMtPnNlY3Rvcl9zaXplKTsKIAogCWlmICghYy0+c3VtbWFyeS0+c3Vt
X2J1ZikgewpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9u
ZnNkL25mc2NhY2hlLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL25m
c2QvbmZzY2FjaGUuYwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL25m
c2QvbmZzY2FjaGUuYwkyMDA2LTExLTA5IDEyOjE2OjIwLjAwMDAwMDAwMCAr
MDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL25mc2QvbmZz
Y2FjaGUuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApA
QCAtNjYsMTQgKzY2LDEzIEBAIG5mc2RfY2FjaGVfaW5pdCh2b2lkKQogCQlw
cmludGsgKEtFUk5fRVJSICJuZnNkOiBjYW5ub3QgYWxsb2NhdGUgYWxsICVk
IGNhY2hlIGVudHJpZXMsIG9ubHkgZ290ICVkXG4iLAogCQkJQ0FDSEVTSVpF
LCBDQUNIRVNJWkUtaSk7CiAKLQloYXNoX2xpc3QgPSBrbWFsbG9jIChIQVNI
U0laRSAqIHNpemVvZihzdHJ1Y3QgaGxpc3RfaGVhZCksIEdGUF9LRVJORUwp
OworCWhhc2hfbGlzdCA9IGt6YWxsb2MgKEhBU0hTSVpFICogc2l6ZW9mKHN0
cnVjdCBobGlzdF9oZWFkKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFoYXNoX2xp
c3QpIHsKIAkJbmZzZF9jYWNoZV9zaHV0ZG93bigpOwogCQlwcmludGsgKEtF
Uk5fRVJSICJuZnNkOiBjYW5ub3QgYWxsb2NhdGUgJVpkIGJ5dGVzIGZvciBo
YXNoIGxpc3RcbiIsCiAJCQlIQVNIU0laRSAqIHNpemVvZihzdHJ1Y3QgaGxp
c3RfaGVhZCkpOwogCQlyZXR1cm47CiAJfQotCW1lbXNldChoYXNoX2xpc3Qs
IDAsIEhBU0hTSVpFICogc2l6ZW9mKHN0cnVjdCBobGlzdF9oZWFkKSk7CiAK
IAljYWNoZV9kaXNhYmxlZCA9IDA7CiB9CmRpZmYgLXJ1YnAgbGludXgtMi42
LjE5LXJjNV9vcmlnL2ZzL25mc2QvdmZzLmMgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2ZzL25mc2QvdmZzLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3Jp
Zy9mcy9uZnNkL3Zmcy5jCTIwMDYtMTEtMDkgMTI6MTY6MjAuMDAwMDAwMDAw
ICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvbmZzZC92
ZnMuYwkyMDA2LTExLTExIDIyOjQ0OjE4LjAwMDAwMDAwMCArMDIwMApAQCAt
MTg4Myw3ICsxODgzLDcgQEAgbmZzZF9yYWNhY2hlX2luaXQoaW50IGNhY2hl
X3NpemUpCiAJCXJldHVybiAwOwogCWlmIChjYWNoZV9zaXplIDwgMipSQVBB
Uk1fSEFTSF9TSVpFKQogCQljYWNoZV9zaXplID0gMipSQVBBUk1fSEFTSF9T
SVpFOwotCXJhcGFybWwgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgcmFwYXJt
cykgKiBjYWNoZV9zaXplLCBHRlBfS0VSTkVMKTsKKwlyYXBhcm1sID0ga3ph
bGxvYyhzaXplb2Yoc3RydWN0IHJhcGFybXMpICogY2FjaGVfc2l6ZSwgR0ZQ
X0tFUk5FTCk7CiAKIAlpZiAocmFwYXJtbCAhPSBOVUxMKSB7CiAJCWRwcmlu
dGsoIm5mc2Q6IGFsbG9jYXRpbmcgJWQgcmVhZGFoZWFkIGJ1ZmZlcnMuXG4i
LApAQCAtMTg5Myw3ICsxODkzLDYgQEAgbmZzZF9yYWNhY2hlX2luaXQoaW50
IGNhY2hlX3NpemUpCiAJCQlzcGluX2xvY2tfaW5pdCgmcmFwYXJtX2hhc2hb
aV0ucGJfbG9jayk7CiAJCX0KIAkJbnBlcmJ1Y2tldCA9IGNhY2hlX3NpemUg
Pj4gUkFQQVJNX0hBU0hfQklUUzsKLQkJbWVtc2V0KHJhcGFybWwsIDAsIHNp
emVvZihzdHJ1Y3QgcmFwYXJtcykgKiBjYWNoZV9zaXplKTsKIAkJZm9yIChp
ID0gMDsgaSA8IGNhY2hlX3NpemUgLSAxOyBpKyspIHsKIAkJCWlmIChpICUg
bnBlcmJ1Y2tldCA9PSAwKQogCQkJCXJhcGFybV9oYXNoW2orK10ucGJfaGVh
ZCA9IHJhcGFybWwgKyBpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9mcy9wYXJ0aXRpb25zL2NoZWNrLmMgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2ZzL3BhcnRpdGlvbnMvY2hlY2suYwotLS0gbGludXgtMi42LjE5
LXJjNV9vcmlnL2ZzL3BhcnRpdGlvbnMvY2hlY2suYwkyMDA2LTExLTA5IDEy
OjE2OjIwLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9r
emFsbG9jL2ZzL3BhcnRpdGlvbnMvY2hlY2suYwkyMDA2LTExLTExIDIyOjQ0
OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMzMxLDExICszMzEsMTAgQEAgdm9p
ZCBhZGRfcGFydGl0aW9uKHN0cnVjdCBnZW5kaXNrICpkaXNrLAogewogCXN0
cnVjdCBoZF9zdHJ1Y3QgKnA7CiAKLQlwID0ga21hbGxvYyhzaXplb2YoKnAp
LCBHRlBfS0VSTkVMKTsKKwlwID0ga3phbGxvYyhzaXplb2YoKnApLCBHRlBf
S0VSTkVMKTsKIAlpZiAoIXApCiAJCXJldHVybjsKIAkKLQltZW1zZXQocCwg
MCwgc2l6ZW9mKCpwKSk7CiAJcC0+c3RhcnRfc2VjdCA9IHN0YXJ0OwogCXAt
Pm5yX3NlY3RzID0gbGVuOwogCXAtPnBhcnRubyA9IHBhcnQ7CmRpZmYgLXJ1
YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL3Byb2Mvdm1jb3JlLmMgbGlu
dXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL3Byb2Mvdm1jb3JlLmMKLS0tIGxp
bnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9wcm9jL3ZtY29yZS5jCTIwMDYtMTEt
MDkgMTI6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTkt
cmM1X2t6YWxsb2MvZnMvcHJvYy92bWNvcmUuYwkyMDA2LTExLTExIDIyOjQ0
OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTc4LDEyICsxNzgsNyBAQCBjb25z
dCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHByb2Nfdm1jb3JlCiAKIHN0YXRp
YyBzdHJ1Y3Qgdm1jb3JlKiBfX2luaXQgZ2V0X25ld19lbGVtZW50KHZvaWQp
CiB7Ci0Jc3RydWN0IHZtY29yZSAqcDsKLQotCXAgPSBrbWFsbG9jKHNpemVv
ZigqcCksIEdGUF9LRVJORUwpOwotCWlmIChwKQotCQltZW1zZXQocCwgMCwg
c2l6ZW9mKCpwKSk7Ci0JcmV0dXJuIHA7CisJcmV0dXJuIGt6YWxsb2Moc2l6
ZW9mKCpwKSwgR0ZQX0tFUk5FTCk7CiB9CiAKIHN0YXRpYyB1NjQgX19pbml0
IGdldF92bWNvcmVfc2l6ZV9lbGY2NChjaGFyICplbGZwdHIpCmRpZmYgLXJ1
YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL3JlaXNlcmZzL2ZpbGUuYyBs
aW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvcmVpc2VyZnMvZmlsZS5jCi0t
LSBsaW51eC0yLjYuMTktcmM1X29yaWcvZnMvcmVpc2VyZnMvZmlsZS5jCTIw
MDYtMTEtMDkgMTI6MTY6MjAuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZnMvcmVpc2VyZnMvZmlsZS5jCTIwMDYtMTEt
MTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC0zMTYsMTIgKzMxNiwx
MSBAQCBzdGF0aWMgaW50IHJlaXNlcmZzX2FsbG9jYXRlX2Jsb2Nrc19mb3Jf
CiAJCQkvKiBhcmVhIGZpbGxlZCB3aXRoIHplcm9lcywgdG8gc3VwcGx5IGFz
IGxpc3Qgb2YgemVybyBibG9ja251bWJlcnMKIAkJCSAgIFdlIGFsbG9jYXRl
IGl0IG91dHNpZGUgb2YgbG9vcCBqdXN0IGluIGNhc2UgbG9vcCB3b3VsZCBz
cGluIGZvcgogCQkJICAgc2V2ZXJhbCBpdGVyYXRpb25zLiAqLwotCQkJY2hh
ciAqemVyb3MgPSBrbWFsbG9jKHRvX3Bhc3RlICogVU5GTV9QX1NJWkUsIEdG
UF9BVE9NSUMpOwkvLyBXZSBjYW5ub3QgaW5zZXJ0IG1vcmUgdGhhbiBNQVhf
SVRFTV9MRU4gYnl0ZXMgYW55d2F5LgorCQkJY2hhciAqemVyb3MgPSBremFs
bG9jKHRvX3Bhc3RlICogVU5GTV9QX1NJWkUsIEdGUF9BVE9NSUMpOwkvLyBX
ZSBjYW5ub3QgaW5zZXJ0IG1vcmUgdGhhbiBNQVhfSVRFTV9MRU4gYnl0ZXMg
YW55d2F5LgogCQkJaWYgKCF6ZXJvcykgewogCQkJCXJlcyA9IC1FTk9NRU07
CiAJCQkJZ290byBlcnJvcl9leGl0X2ZyZWVfYmxvY2tzOwogCQkJfQotCQkJ
bWVtc2V0KHplcm9zLCAwLCB0b19wYXN0ZSAqIFVORk1fUF9TSVpFKTsKIAkJ
CWRvIHsKIAkJCQl0b19wYXN0ZSA9CiAJCQkJICAgIG1pbl90KF9fdTY0LCBo
b2xlX3NpemUsCmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2Zz
L3JlaXNlcmZzL2lub2RlLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2Zz
L3JlaXNlcmZzL2lub2RlLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9m
cy9yZWlzZXJmcy9pbm9kZS5jCTIwMDYtMTEtMDkgMTI6MTY6MjAuMDAwMDAw
MDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvcmVp
c2VyZnMvaW5vZGUuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCAr
MDIwMApAQCAtOTI4LDE1ICs5MjgsMTIgQEAgaW50IHJlaXNlcmZzX2dldF9i
bG9jayhzdHJ1Y3QgaW5vZGUgKmlubwogCQkJaWYgKGJsb2Nrc19uZWVkZWQg
PT0gMSkgewogCQkJCXVuID0gJnVuZl9zaW5nbGU7CiAJCQl9IGVsc2Ugewot
CQkJCXVuID0ga21hbGxvYyhtaW4oYmxvY2tzX25lZWRlZCwgbWF4X3RvX2lu
c2VydCkgKiBVTkZNX1BfU0laRSwgR0ZQX0FUT01JQyk7CS8vIFdlIG5lZWQg
dG8gYXZvaWQgc2NoZWR1bGluZy4KKwkJCQl1biA9IGt6YWxsb2MobWluKGJs
b2Nrc19uZWVkZWQsIG1heF90b19pbnNlcnQpICogVU5GTV9QX1NJWkUsIEdG
UF9BVE9NSUMpOwkvLyBXZSBuZWVkIHRvIGF2b2lkIHNjaGVkdWxpbmcuCiAJ
CQkJaWYgKCF1bikgewogCQkJCQl1biA9ICZ1bmZfc2luZ2xlOwogCQkJCQli
bG9ja3NfbmVlZGVkID0gMTsKIAkJCQkJbWF4X3RvX2luc2VydCA9IDA7Ci0J
CQkJfSBlbHNlCi0JCQkJCW1lbXNldCh1biwgMCwKLQkJCQkJICAgICAgIFVO
Rk1fUF9TSVpFICogbWluKGJsb2Nrc19uZWVkZWQsCi0JCQkJCQkJCSBtYXhf
dG9faW5zZXJ0KSk7CisJCQkJfQogCQkJfQogCQkJaWYgKGJsb2Nrc19uZWVk
ZWQgPD0gbWF4X3RvX2luc2VydCkgewogCQkJCS8qIHdlIGFyZSBnb2luZyB0
byBhZGQgdGFyZ2V0IGJsb2NrIHRvIHRoZSBmaWxlLiBVc2UgYWxsb2NhdGVk
CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2ZzL3JlaXNlcmZz
L3N1cGVyLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2ZzL3JlaXNlcmZz
L3N1cGVyLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9mcy9yZWlzZXJm
cy9zdXBlci5jCTIwMDYtMTEtMDkgMTI6MTY6MjAuMDAwMDAwMDAwICswMjAw
CisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZnMvcmVpc2VyZnMvc3Vw
ZXIuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAt
MTU0OSwxMyArMTU0OSwxMiBAQCBzdGF0aWMgaW50IHJlaXNlcmZzX2ZpbGxf
c3VwZXIoc3RydWN0IHN1CiAJc3RydWN0IHJlaXNlcmZzX3NiX2luZm8gKnNi
aTsKIAlpbnQgZXJydmFsID0gLUVJTlZBTDsKIAotCXNiaSA9IGttYWxsb2Mo
c2l6ZW9mKHN0cnVjdCByZWlzZXJmc19zYl9pbmZvKSwgR0ZQX0tFUk5FTCk7
CisJc2JpID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHJlaXNlcmZzX3NiX2lu
Zm8pLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXNiaSkgewogCQllcnJ2YWwgPSAt
RU5PTUVNOwogCQlnb3RvIGVycm9yOwogCX0KIAlzLT5zX2ZzX2luZm8gPSBz
Ymk7Ci0JbWVtc2V0KHNiaSwgMCwgc2l6ZW9mKHN0cnVjdCByZWlzZXJmc19z
Yl9pbmZvKSk7CiAJLyogU2V0IGRlZmF1bHQgdmFsdWVzIGZvciBvcHRpb25z
OiBub24tYWdncmVzc2l2ZSB0YWlscywgUk8gb24gZXJyb3JzICovCiAJUkVJ
U0VSRlNfU0IocyktPnNfbW91bnRfb3B0IHw9ICgxIDw8IFJFSVNFUkZTX1NN
QUxMVEFJTCk7CiAJUkVJU0VSRlNfU0IocyktPnNfbW91bnRfb3B0IHw9ICgx
IDw8IFJFSVNFUkZTX0VSUk9SX1JPKTsK


------=_NextPart_000_1564_717c_5ee4--
