Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261466AbVE3PWV@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261466AbVE3PWV (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 30 May 2005 11:22:21 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261495AbVE3PWU
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 30 May 2005 11:22:20 -0400
Received: from mx2.suse.de ([195.135.220.15]:17637 "EHLO mx2.suse.de")
	by vger.kernel.org with ESMTP id S261466AbVE3PVr (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 30 May 2005 11:21:47 -0400
Date: Mon, 30 May 2005 17:21:42 +0200
Message-ID: <s5hzmucviwp.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "J.A. Magallon" <jamagallon@able.es>
Cc: linux-kernel@vger.kernel.org
Subject: Re: 2.6.12-rc3-mm3: ALSA broken ?
In-Reply-To: <1117463446l.7266l.0l@werewolf.able.es>
References: <20050504221057.1e02a402.akpm@osdl.org>
	<1115510869l.7472l.0l@werewolf.able.es>
	<1115594680l.7540l.0l@werewolf.able.es>
	<s5hd5rx2656.wl@alsa2.suse.de>
	<1115936836l.8448l.1l@werewolf.able.es>
	<s5hvf5nsb2r.wl@alsa2.suse.de>
	<1116331359l.7364l.0l@werewolf.able.es>
	<s5hll6eoxhf.wl@alsa2.suse.de>
	<1116369585l.8840l.0l@werewolf.able.es>
	<s5hoeb8sleq.wl@alsa2.suse.de>
	<1117151518l.7637l.0l@werewolf.able.es>
	<s5his15xaz2.wl@alsa2.suse.de>
	<1117228680l.24619l.0l@werewolf.able.es>
	<s5h3bs4x2bk.wl@alsa2.suse.de>
	<1117463446l.7266l.0l@werewolf.able.es>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 30 May 2005 14:30:46 +0000,
J.A. Magallon wrote:
> 
> The correct question is: how do I generate a patch against a given kernel,
> from the alsa-driver-x.y.z.tar.gz I can download from alsa.org ?
> I thought it was enough to diff -ruN the alsa-kernel dir (minus the Documentation
> folder) vs the /usr/src/linux-xxxxx/sound folder.
> 
> I have seen that there are some scripts in the tarball that install the new
> drivers on a given kernel tree via symlinks, but I would like to get just
> a patch. I think I will have to diff selected directories, or create
> an exclude list... Are there files that are just copied from mainline and do
> not change in ALSA tree, or anything can change under alsa-kernel ?

Basically diff should work for some of subdirectories in alsa-kernel.
Although we've tried to sync the files in sound/ directory with
mainline, better not to diff them.

As an example, I've checked the kernel sync between ALSA and mainline
trees with the script.  Note that sound_core.c etc in sound/ are not
checked.  ~/alsa-kernel-excludes contains the files to ignore like .*,
*.o, CVS, etc.

> Now that I think of it, if you work against Linus tree,
> would it be more correct to diff against 2.6.12-rc5, and then try to apply
> to -rc5-mm1 ? 

Yes.  The alsa-kernel tree is for Linus tree, in principle.

> Whe you do a release, which is your reference, latest stable (2.6.11),
> latest rc or latest git ? 

The released alsa-drivers are for the latest Linus tree.
The patches to stable tree are taken occasionally, so they are not
collected...

> About git, I don't really like the idea of storing a full kernel tree just
> to do 'git update' or the like, and use the 'sound' part.

I understand it - Although git works great, I won't use it with the
analog modem connection at home :)


Takashi


#!/bin/sh
#
# diff-alsa-26 [-R] linux-kernel alsa-kernel
#

reverse=
if [ "$1" = "-R" ]; then
  reverse=1
  shift
fi
if [ -z "$1" -o -z "$2" ]; then
    echo "usage: diff-alsa-26 linux-kernel alsa-kernel"
    exit 1
fi

LINUX=$1
ALSA=$2

diffopts=--exclude-from=$HOME/alsa-kernel-excludes

if [ -n "$reverse" ]; then
  for i in arm core drivers i2c isa parisc pci pcmcia ppc sparc synth usb; do
      diff -rupN $diffopts $ALSA/$i $LINUX/sound/$i | grep -v '^[A-Z]' | sed -es@$ALSA/@linux/sound/@g
  done
  diff -ruN $diffopts $ALSA/include $LINUX/include/sound | grep -v '^[A-Z]' | sed -es@$ALSA/include/@linux/include/sound/@g
  diff -ruN $diffopts $ALSA/Documentation $LINUX/Documentation/sound/alsa | grep -v '^[A-Z]' | sed -es@$ALSA/Documentation/@linux/Documentation/sound/alsa/@g
else
  for i in arm core drivers i2c isa parisc pci pcmcia ppc sparc synth usb; do
      diff -rupN $diffopts $LINUX/sound/$i $ALSA/$i | grep -v '^[A-Z]' | sed -es@$ALSA/@linux/sound/@g
  done
  diff -ruN $diffopts $LINUX/include/sound $ALSA/include | grep -v '^[A-Z]' | sed -es@$ALSA/include/@linux/include/sound/@g
  diff -ruN $diffopts $LINUX/Documentation/sound/alsa $ALSA/Documentation | grep -v '^[A-Z]' | sed -es@$ALSA/Documentation/@linux/Documentation/sound/alsa/@g
fi

exit 0

