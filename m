Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262222AbUKKMDa@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262222AbUKKMDa (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 11 Nov 2004 07:03:30 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262224AbUKKMDa
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 11 Nov 2004 07:03:30 -0500
Received: from mx1.redhat.com ([66.187.233.31]:47492 "EHLO mx1.redhat.com")
	by vger.kernel.org with ESMTP id S262222AbUKKMD2 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Thu, 11 Nov 2004 07:03:28 -0500
From: David Howells <dhowells@redhat.com>
In-Reply-To: <20041111034353.00d35589.akpm@osdl.org> 
References: <20041111034353.00d35589.akpm@osdl.org>  <20041110182659.3f8138d6.akpm@osdl.org> <20041109140122.GA5388@infradead.org> <20041109125539.GA4867@infradead.org> <200411081432.iA8EWfmh023432@warthog.cambridge.redhat.com> <15068.1100008386@redhat.com> <4530.1100093877@redhat.com> <20041110110145.3751ae17.akpm@osdl.org> <1100135833.4631.10.camel@localhost.localdomain> <24698.1100172576@redhat.com> 
To: Andrew Morton <akpm@osdl.org>
Cc: dwmw2@infradead.org, hch@infradead.org, torvalds@osdl.org,
       davidm@snapgear.com, linux-kernel@vger.kernel.org,
       uclinux-dev@uclinux.org, kamezawa.hiroyu@jp.fujitsu.com
Subject: Re: [PATCH] VM routine fixes 
User-Agent: EMH/1.14.1 SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 Emacs/21.3 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Date: Thu, 11 Nov 2004 12:03:04 +0000
Message-ID: <25483.1100174584@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


> > No, it isn't. munmap() is prohibited from releasing anything other than a
> > complete mmap() on uClinux.
> 
> hrm.  I'd have thought that such a restriction would be unnecessary if we
> get the page refcounting done right.  With, say, compound pages!

I don't think you want to go there. Don't forget in a lot of cases you're
dealing with shared objects, and so you can't just go punching holes in the
middle thereof.

> Compound pages are just a way of handling refcounting of a higher-order
> page.  Nothing to do with TLBs at all.

In that case, I'll look at making compound pages mandatory if you wish. I'd
rather avoid doing so because they incur additional overheads, and it'll be on
MMU and !MMU both, but it does make multi-order page handling appear more
robust.

David
