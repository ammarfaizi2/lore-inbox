Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S272994AbTG3PhR (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 30 Jul 2003 11:37:17 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S272988AbTG3PhQ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 30 Jul 2003 11:37:16 -0400
Received: from ns.suse.de ([213.95.15.193]:60174 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S273447AbTG3PeS (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 30 Jul 2003 11:34:18 -0400
Date: Wed, 30 Jul 2003 17:34:16 +0200
Message-ID: <s5h3cgorptz.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Christopher Swingley <cswingle@iarc.uaf.edu>
Cc: linux-kernel@vger.kernel.org
Subject: Re: apm suspend breaks ALSA
In-Reply-To: <20030730151219.GD6639@iarc.uaf.edu>
References: <20030730151219.GD6639@iarc.uaf.edu>
User-Agent: Wanderlust/2.6.1 (Upside Down) SEMI/1.14.4 (Hosorogi)
 FLIM/1.14.4 (=?ISO-8859-4?Q?Kashiharajing=FE-mae?=) APEL/10.2 MULE
 XEmacs/21.4 (patch 12) (Portable Code) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.4 - "Hosorogi")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 30 Jul 2003 07:12:19 -0800,
Christopher Swingley wrote:
> 
> Greetings,
> 
> I have a laptop with the es1978 ALSA sound driver built into the kernel.  
> When I go through a suspend / resume cycle using apm, the sound system 
> does not recover and loud static comes from the speakers instead of 
> music / voice / etc.  On boot, ALSA works just fine.
> 
> One solution appears to be building ALSA as modules and unloading / 
> reloading them, after a suspend / resume cycle.  With 2.4.xx and the OSS 
> drivers built in, this wasn't an issue.
> 
> Now that I've got them built as modules and have a 'sound' script in 
> /etc/apm/events.d/ that does the loading and unloading I'm happy, but I 
> figured I'd report the issue anyway.

as default, the power-management of es1968 is enabled only on a
certain board, namely,
	ESS1978 _and_ (vendor == 0x1028 || vendor == 0x1179)

first, please check whether your pci id matches with it.

the behavior can be changed by a module option, use_pm, but it's
missing in the kernel boot parameter (i'll fix this later).
in that case, modify use_pm[] default value from 2 to 1, to force to
use power-management.


Takashi
