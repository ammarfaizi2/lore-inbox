Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261331AbVAaTaT@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261331AbVAaTaT (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 31 Jan 2005 14:30:19 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261327AbVAaT2b
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 31 Jan 2005 14:28:31 -0500
Received: from fmr19.intel.com ([134.134.136.18]:59798 "EHLO
	orsfmr004.jf.intel.com") by vger.kernel.org with ESMTP
	id S261328AbVAaT10 convert rfc822-to-8bit (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 31 Jan 2005 14:27:26 -0500
X-MimeOLE: Produced By Microsoft Exchange V6.5.7226.0
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7BIT
Subject: RE: 2.4.29, e100 and a WOL packet causes keventd going mad
Date: Mon, 31 Jan 2005 11:26:43 -0800
Message-ID: <C925F8B43D79CC49ACD0601FB68FF50C0301425C@orsmsx408>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: 2.4.29, e100 and a WOL packet causes keventd going mad
Thread-Index: AcUHUZ4QG04FGrWzQG+uFsJ5rBpdewAcwpHA
From: "Brandeburg, Jesse" <jesse.brandeburg@intel.com>
To: <sfeldma@pobox.com>, <ncunningham@linuxmail.org>
Cc: =?iso-8859-1?Q?David_H=E4rdeman?= <david@2gen.com>,
       "Michael Gernoth" <simigern@stud.uni-erlangen.de>,
       "Linux Kernel Mailing List" <linux-kernel@vger.kernel.org>,
       <netdev@oss.sgi.com>
X-OriginalArrivalTime: 31 Jan 2005 19:26:44.0983 (UTC) FILETIME=[CCBFB070:01C507CA]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

>+static void e100_shutdown(struct device *dev)
>+{
>+	struct pci_dev *pdev = container_of(dev, struct pci_dev, dev);
>+	struct net_device *netdev = pci_get_drvdata(pdev);
>+	struct nic *nic = netdev_priv(netdev);
>+
>+	pci_enable_wake(pdev, PCI_D0, nic->flags & (wol_magic |
>e100_asf(nic)));
>+}
>+

Separately, does anyone think that the OS should be handling the PME event on the bus (as it comes from the PIC as an interrupt, and can be masked at the PIC) with a default handler?  The machines having the problem seem to be killed by an interrupt storm generated by the PME interrupt, just a guess.

Jesse
