Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261306AbUJYVri@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261306AbUJYVri (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 25 Oct 2004 17:47:38 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261264AbUJYVoi
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 25 Oct 2004 17:44:38 -0400
Received: from sd291.sivit.org ([194.146.225.122]:53698 "EHLO sd291.sivit.org")
	by vger.kernel.org with ESMTP id S261847AbUJYPTJ (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 25 Oct 2004 11:19:09 -0400
Date: Mon, 25 Oct 2004 17:20:24 +0200
From: Stelian Pop <stelian@popies.net>
To: Vojtech Pavlik <vojtech@suse.cz>
Cc: Dmitry Torokhov <dtor_core@ameritech.net>, linux-kernel@vger.kernel.org
Subject: Re: [PATCH 0/5] Sonypi driver model & PM changes
Message-ID: <20041025152023.GE3161@crusoe.alcove-fr>
Reply-To: Stelian Pop <stelian@popies.net>
Mail-Followup-To: Stelian Pop <stelian@popies.net>,
	Vojtech Pavlik <vojtech@suse.cz>,
	Dmitry Torokhov <dtor_core@ameritech.net>,
	linux-kernel@vger.kernel.org
References: <200410210154.58301.dtor_core@ameritech.net> <20041025125629.GF6027@crusoe.alcove-fr> <20041025135036.GA3161@crusoe.alcove-fr> <20041025135742.GA1733@ucw.cz> <20041025144549.GD3161@crusoe.alcove-fr> <20041025151120.GA1802@ucw.cz>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20041025151120.GA1802@ucw.cz>
User-Agent: Mutt/1.4.1i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, Oct 25, 2004 at 05:11:22PM +0200, Vojtech Pavlik wrote:

> > > I believe that although this way may be easier, it leads to madness.
> > 
> > It is also impossible for me to go this way because there is no way
> > to put 20+ events between 226 and 240...
> 
> You could fix X to use either medium raw mode on the console or the
> event protocol. Medium raw has a limit of 2^14 and event protocol is
> limited by 2^16.

Well, letting X get the events directly on /dev/input/event* is clearly
the way to go, for a long term solution.

However, I would like a short term solution, available now, so users
of sonypi could just migrate towards the new way without having to
compile their own version of the X server...

> > That's what I thought too. However, it seems to work only when the
> > keysym associated with the modifier is a well known key (Control_L,
> > Control_R, Alt_L etc).
> > 
> > If I do (214 is the keycode generated by my Fn key):
> > 	keycode 214 = Control_L
> > 	clear mod3
> > 	add mod3 = Control_L
> > then Fn + F1 will generate Mod3 + F1 (but Control_L will not work as 
> > a Control modifier anymore).
> > 
> > But if I do:
> > 	keycode 214 = function
> > 	clear mod3
> > 	add mod3 = function
> > then (at least) WindowMaker does not see the modifier anymore (only
> > a 'function' single key press is received).
> 
> Does the same happen in 'xev'?

xev doesn't say anything about modifiers. It shows the modifier being
pressed, the other key pressed, then released, then the modifier being
released too.

The trace shows the same kind of events in a working Control case or
in a not working 'function' case:

KeyPress event, serial 24, synthetic NO, window 0x2a00001,
    root 0x40, subw 0x2a00002, time 6566259, (37,47), root:(542,70),
    state 0x0, keycode 214 (keysym 0x8f6, function), same_screen YES,
    XLookupString gives 0 bytes: 
    XmbLookupString gives 0 bytes: 
    XFilterEvent returns: False

KeyPress event, serial 24, synthetic NO, window 0x2a00001,
    root 0x40, subw 0x2a00002, time 6566259, (37,47), root:(542,70),
    state 0x20, keycode 67 (keysym 0xffbe, F1), same_screen YES,
    XLookupString gives 0 bytes: 
    XmbLookupString gives 0 bytes: 
    XFilterEvent returns: False

KeyRelease event, serial 24, synthetic NO, window 0x2a00001,
    root 0x40, subw 0x2a00002, time 6566259, (37,47), root:(542,70),
    state 0x20, keycode 67 (keysym 0xffbe, F1), same_screen YES,
    XLookupString gives 0 bytes: 

KeyRelease event, serial 24, synthetic NO, window 0x2a00001,
    root 0x40, subw 0x2a00002, time 6566259, (37,47), root:(542,70),
    state 0x20, keycode 214 (keysym 0x8f6, function), same_screen YES,
    XLookupString gives 0 bytes: 

Stelian.
-- 
Stelian Pop <stelian@popies.net>    
