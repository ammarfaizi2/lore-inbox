Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1030211AbWJCPZv@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1030211AbWJCPZv (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 3 Oct 2006 11:25:51 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1030215AbWJCPZv
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 3 Oct 2006 11:25:51 -0400
Received: from mout0.freenet.de ([194.97.50.131]:29333 "EHLO mout0.freenet.de")
	by vger.kernel.org with ESMTP id S1030211AbWJCPZT (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 3 Oct 2006 11:25:19 -0400
Date: Tue, 03 Oct 2006 17:26:19 +0200
To: "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
Subject: [PATCH 7/11] 2.6.18-mm3 pktcdvd: make procfs interface optional
Reply-To: balagi@justmail.de
From: "Thomas Maier" <balagi@justmail.de>
Cc: "petero2@telia.com" <petero2@telia.com>, "akpm@osdl.org" <akpm@osdl.org>
Content-Type: multipart/mixed; boundary=----------CTSVsVO6lokKwSsaBa0pv2
MIME-Version: 1.0
Message-ID: <op.tguqh5r2iudtyh@master>
User-Agent: Opera Mail/9.00 (Win32)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------------CTSVsVO6lokKwSsaBa0pv2
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit

Hello,

this patch makes the procfs interface optional and groups
the procfs functions together.
New kernel config parameter: CDROM_PKTCDVD_PROCINTF

http://people.freenet.de/BalaGi/download/pktcdvd-7-procfs-optional_2.6.18.patch

Signed-off-by: Thomas Maier<balagi@justmail.de>

-Thomas Maier
------------CTSVsVO6lokKwSsaBa0pv2
Content-Disposition: attachment; filename=pktcdvd-7-procfs-optional_2.6.18.patch
Content-Type: application/octet-stream; name=pktcdvd-7-procfs-optional_2.6.18.patch
Content-Transfer-Encoding: Base64

ZGlmZiAtdXJwTiA2LXN5c2ZzL2RyaXZlcnMvYmxvY2svS2NvbmZpZyA3LXByb2Nm
cy1vcHRpb25hbC9kcml2ZXJzL2Jsb2NrL0tjb25maWcKLS0tIDYtc3lzZnMvZHJp
dmVycy9ibG9jay9LY29uZmlnCTIwMDYtMTAtMDMgMTE6NDk6MTcuMDAwMDAwMDAw
ICswMjAwCisrKyA3LXByb2Nmcy1vcHRpb25hbC9kcml2ZXJzL2Jsb2NrL0tjb25m
aWcJMjAwNi0xMC0wMyAxMzoyMDowMi4wMDAwMDAwMDAgKzAyMDAKQEAgLTQyOCwx
NyArNDI4LDIyIEBAIGNvbmZpZyBDRFJPTV9QS1RDRFZECiAJdHJpc3RhdGUgIlBh
Y2tldCB3cml0aW5nIG9uIENEL0RWRCBtZWRpYSIKIAlkZXBlbmRzIG9uICFVTUwK
IAloZWxwCi0JICBJZiB5b3UgaGF2ZSBhIENEUk9NIGRyaXZlIHRoYXQgc3VwcG9y
dHMgcGFja2V0IHdyaXRpbmcsIHNheSBZIHRvCi0JICBpbmNsdWRlIHByZWxpbWlu
YXJ5IHN1cHBvcnQuIEl0IHNob3VsZCB3b3JrIHdpdGggYW55IE1NQy9NdCBGdWpp
Ci0JICBjb21wbGlhbnQgQVRBUEkgb3IgU0NTSSBkcml2ZSwgd2hpY2ggaXMganVz
dCBhYm91dCBhbnkgbmV3ZXIgQ0QKLQkgIHdyaXRlci4KKwkgIElmIHlvdSBoYXZl
IGEgQ0RST00vRFZEIGRyaXZlIHRoYXQgc3VwcG9ydHMgcGFja2V0IHdyaXRpbmcs
IHNheQorCSAgWSB0byBpbmNsdWRlIHByZWxpbWluYXJ5IHN1cHBvcnQuIEl0IHNo
b3VsZCB3b3JrIHdpdGggYW55CisJICBNTUMvTXQgRnVqaSBjb21wbGlhbnQgQVRB
UEkgb3IgU0NTSSBkcml2ZSwgd2hpY2ggaXMganVzdCBhYm91dAorCSAgYW55IG5l
d2VyIERWRC9DRCB3cml0ZXIuCiAKLQkgIEN1cnJlbnRseSBvbmx5IHdyaXRpbmcg
dG8gQ0QtUlcsIERWRC1SVyBhbmQgRFZEK1JXIGRpc2NzIGlzIHBvc3NpYmxlLgor
CSAgQ3VycmVudGx5IG9ubHkgd3JpdGluZyB0byBDRC1SVywgRFZELVJXLCBEVkQr
UlcgYW5kIERWRFJBTSBkaXNjcworCSAgaXMgcG9zc2libGUuCiAJICBEVkQtUlcg
ZGlza3MgbXVzdCBiZSBpbiByZXN0cmljdGVkIG92ZXJ3cml0ZSBtb2RlLgogCiAJ
ICBUbyBjb21waWxlIHRoaXMgZHJpdmVyIGFzIGEgbW9kdWxlLCBjaG9vc2UgTSBo
ZXJlOiB0aGUKIAkgIG1vZHVsZSB3aWxsIGJlIGNhbGxlZCBwa3RjZHZkLgogCisJ
ICBGb3IgZnVydGhlciBpbmZvcm1hdGlvbiBzZWUgdGhlIGZpbGUKKworCSAgICBE
b2N1bWVudGF0aW9uL2Nkcm9tL3BhY2tldC13cml0aW5nLnR4dAorCSAgCiBjb25m
aWcgQ0RST01fUEtUQ0RWRF9CVUZGRVJTCiAJaW50ICJGcmVlIGJ1ZmZlcnMgZm9y
IGRhdGEgZ2F0aGVyaW5nIgogCWRlcGVuZHMgb24gQ0RST01fUEtUQ0RWRApAQCAt
NDU4LDYgKzQ2MywyMSBAQCBjb25maWcgQ0RST01fUEtUQ0RWRF9XQ0FDSEUKIAkg
IHRoaXMgb3B0aW9uIGlzIGRhbmdlcm91cyB1bmxlc3MgdGhlIENELVJXIG1lZGlh
IGlzIGtub3duIGdvb2QsIGFzIHdlCiAJICBkb24ndCBkbyBkZWZlcnJlZCB3cml0
ZSBlcnJvciBoYW5kbGluZyB5ZXQuCiAKK2NvbmZpZyBDRFJPTV9QS1RDRFZEX1BS
T0NJTlRGCisJYm9vbCAiRW5hYmxlIHByb2NmcyBpbnRlcmZhY2UiCisJZGVwZW5k
cyBvbiBDRFJPTV9QS1RDRFZECisJZGVmYXVsdCB5CisJaGVscAorCSAgRW5hYmxl
IHRoZSBwcm9jIGZpbGVzeXN0ZW0gaW50ZXJmYWNlIGZvciBwa3RjZHZkLgorCSAg
VGhlIGZpbGVzIGNhbiBiZSBmb3VuZCBhczoKKwkgIAorCSAgL3Byb2MvZHJpdmVy
L3BrdGNkdmQvcGt0Y2R2ZDxpZHg+CisJICAKKwkgIEFsc28gYSBtaXNjIGRldmlj
ZSBpcyBhZGRlZCB3aXRoIGEgZHluYW1pYyBtaW5vciBkZXZpY2UgaWQuCisJICBT
ZWUgdGhlIGVudHJ5IGluICAvcHJvYy9taXNjICBmb3IgdGhlIG1pbm9yIG51bWJl
ci4KKwkgIFRoZSBtaXNjIHBrdGNkdmQgZHJpdmVyIHN1cHBvcnRzIGlvY3RsIGNh
bGxzLCBuZWVkZWQKKwkgIGJ5IHRoZSBwa3RzZXR1cCB0b29sIGZvdW5kIGluIHVk
ZnRvb2xzIHBhY2thZ2UuCisKIHNvdXJjZSAiZHJpdmVycy9zMzkwL2Jsb2NrL0tj
b25maWciCiAKIGNvbmZpZyBBVEFfT1ZFUl9FVEgKZGlmZiAtdXJwTiA2LXN5c2Zz
L2RyaXZlcnMvYmxvY2svcGt0Y2R2ZC5jIDctcHJvY2ZzLW9wdGlvbmFsL2RyaXZl
cnMvYmxvY2svcGt0Y2R2ZC5jCi0tLSA2LXN5c2ZzL2RyaXZlcnMvYmxvY2svcGt0
Y2R2ZC5jCTIwMDYtMTAtMDMgMTM6NTQ6MTkuMDAwMDAwMDAwICswMjAwCisrKyA3
LXByb2Nmcy1vcHRpb25hbC9kcml2ZXJzL2Jsb2NrL3BrdGNkdmQuYwkyMDA2LTEw
LTAzIDEzOjU0OjMxLjAwMDAwMDAwMCArMDIwMApAQCAtNTIsOSArNTIsNyBAQAog
I2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CiAjaW5jbHVkZSA8bGludXgvc3Bpbmxv
Y2suaD4KICNpbmNsdWRlIDxsaW51eC9maWxlLmg+Ci0jaW5jbHVkZSA8bGludXgv
cHJvY19mcy5oPgogI2luY2x1ZGUgPGxpbnV4L3NlcV9maWxlLmg+Ci0jaW5jbHVk
ZSA8bGludXgvbWlzY2RldmljZS5oPgogI2luY2x1ZGUgPGxpbnV4L3N1c3BlbmQu
aD4KICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogI2luY2x1ZGUgPHNjc2kvc2Nz
aV9jbW5kLmg+CkBAIC02Myw2ICs2MSwxMSBAQAogI2luY2x1ZGUgPGxpbnV4L2Rl
YnVnZnMuaD4KICNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KIAorI2lmIFBLVF9V
U0VfUFJPQ0ZTCisjaW5jbHVkZSA8bGludXgvcHJvY19mcy5oPgorI2luY2x1ZGUg
PGxpbnV4L21pc2NkZXZpY2UuaD4KKyNlbmRpZgorCiAjaW5jbHVkZSA8YXNtL3Vh
Y2Nlc3MuaD4KIAogI2RlZmluZSBEUklWRVJfTkFNRQkicGt0Y2R2ZCIKQEAgLTg0
LDcgKzg3LDYgQEAKICNkZWZpbmUgWk9ORShzZWN0b3IsIHBkKSAoKChzZWN0b3Ip
ICsgKHBkKS0+b2Zmc2V0KSAmIH4oKHBkKS0+c2V0dGluZ3Muc2l6ZSAtIDEpKQog
CiBzdGF0aWMgc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwa3RfZGV2c1tNQVhfV1JJ
VEVSU107Ci1zdGF0aWMgc3RydWN0IHByb2NfZGlyX2VudHJ5ICpwa3RfcHJvYzsK
IHN0YXRpYyBpbnQgcGt0ZGV2X21ham9yID0gMDsgLyogZGVmYXVsdDogZHluYW1p
YyBtYWpvciBudW1iZXIgKi8KIHN0YXRpYyBzdHJ1Y3QgbXV0ZXggY3RsX211dGV4
OwkvKiBTZXJpYWxpemUgb3Blbi9jbG9zZS9zZXR1cC90ZWFyZG93biAqLwogc3Rh
dGljIG1lbXBvb2xfdCAqcHNkX3Bvb2w7CkBAIC01NDcsNiArNTQ5LDEwOCBAQCBz
dGF0aWMgdm9pZCBwa3RfZGVidWdmc19jbGVhbnVwKHZvaWQpCiAJcGt0X2RlYnVn
ZnNfcm9vdCA9IE5VTEw7CiB9CiAKKy8qKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICoKKyAqIChvbGQpIHBy
b2NmcyBpbnRlcmZhY2UKKyAqCisgKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKyNpZiBQS1RfVVNFX1BST0NG
Uworc3RhdGljIHN0cnVjdCBwcm9jX2Rpcl9lbnRyeSAqcGt0X3Byb2M7CisKKy8q
IGZpbGUgb3BlcmF0aW9ucyBmb3IgL3Byb2MvZHJpdmVyL3BrdGNkdmQvLi4gZmls
ZXMgKi8KKworc3RhdGljIGludCBwa3Rfc2VxX3Nob3coc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpwKQoreworCXN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQgPSBt
LT5wcml2YXRlOworCWNoYXIgYnVmWzEwMjRdOworCQorCXBrdF9wcmludF9pbmZv
KHBkLCBidWYsIHNpemVvZihidWYpKTsKKwlzZXFfcHJpbnRmKG0sICIlcyIsIGJ1
Zik7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcGt0X3NlcV9vcGVuKHN0
cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQoreworCXJldHVy
biBzaW5nbGVfb3BlbihmaWxlLCBwa3Rfc2VxX3Nob3csIFBERShpbm9kZSktPmRh
dGEpOworfQorCitzdGF0aWMgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBwa3RfcHJv
Y19mb3BzID0geworCS5vcGVuCT0gcGt0X3NlcV9vcGVuLAorCS5yZWFkCT0gc2Vx
X3JlYWQsCisJLmxsc2Vlawk9IHNlcV9sc2VlaywKKwkucmVsZWFzZSA9IHNpbmds
ZV9yZWxlYXNlCit9OworCitzdGF0aWMgdm9pZCBwa3RfZ2V0X3N0YXR1cyhzdHJ1
Y3QgcGt0X2N0cmxfY29tbWFuZCAqY3RybF9jbWQpCit7CisJc3RydWN0IHBrdGNk
dmRfZGV2aWNlICpwZDsKKwkKKwltdXRleF9sb2NrX25lc3RlZCgmY3RsX211dGV4
LCBTSU5HTEVfREVQVEhfTkVTVElORyk7CisJCisJcGQgPSBwa3RfZmluZF9kZXZf
ZnJvbV9taW5vcihjdHJsX2NtZC0+ZGV2X2luZGV4KTsKKwlpZiAocGQpIHsKKwkJ
Y3RybF9jbWQtPmRldiA9IG5ld19lbmNvZGVfZGV2KHBkLT5iZGV2LT5iZF9kZXYp
OworCQljdHJsX2NtZC0+cGt0X2RldiA9IG5ld19lbmNvZGVfZGV2KHBkLT5wa3Rf
ZGV2KTsKKwl9IGVsc2UgeworCQljdHJsX2NtZC0+ZGV2ID0gMDsKKwkJY3RybF9j
bWQtPnBrdF9kZXYgPSAwOworCX0KKwljdHJsX2NtZC0+bnVtX2RldmljZXMgPSBN
QVhfV1JJVEVSUzsKKwkKKwltdXRleF91bmxvY2soJmN0bF9tdXRleCk7Cit9CisK
K3N0YXRpYyBpbnQgcGt0X2N0bF9pb2N0bChzdHJ1Y3QgaW5vZGUgKmlub2RlLCBz
dHJ1Y3QgZmlsZSAqZmlsZSwKKwkJCXVuc2lnbmVkIGludCBjbWQsIHVuc2lnbmVk
IGxvbmcgYXJnKQoreworCXZvaWQgX191c2VyICphcmdwID0gKHZvaWQgX191c2Vy
ICopYXJnOworCXN0cnVjdCBwa3RfY3RybF9jb21tYW5kIGN0cmxfY21kOworCWlu
dCByZXQgPSAwOworCWRldl90IHBrdF9kZXYgPSAwOworCisJaWYgKGNtZCAhPSBQ
QUNLRVRfQ1RSTF9DTUQpCisJCXJldHVybiAtRU5PVFRZOworCisJaWYgKGNvcHlf
ZnJvbV91c2VyKCZjdHJsX2NtZCwgYXJncCwgc2l6ZW9mKHN0cnVjdCBwa3RfY3Ry
bF9jb21tYW5kKSkpCisJCXJldHVybiAtRUZBVUxUOworCisJc3dpdGNoIChjdHJs
X2NtZC5jb21tYW5kKSB7CisJY2FzZSBQS1RfQ1RSTF9DTURfU0VUVVA6CisJCWlm
ICghY2FwYWJsZShDQVBfU1lTX0FETUlOKSkKKwkJCXJldHVybiAtRVBFUk07CisJ
CXJldCA9IHBrdF9zZXR1cF9kZXYobmV3X2RlY29kZV9kZXYoY3RybF9jbWQuZGV2
KSwgJnBrdF9kZXYpOworCQljdHJsX2NtZC5wa3RfZGV2ID0gbmV3X2VuY29kZV9k
ZXYocGt0X2Rldik7CisJCWJyZWFrOworCWNhc2UgUEtUX0NUUkxfQ01EX1RFQVJE
T1dOOgorCQlpZiAoIWNhcGFibGUoQ0FQX1NZU19BRE1JTikpCisJCQlyZXR1cm4g
LUVQRVJNOworCQlyZXQgPSBwa3RfcmVtb3ZlX2RldihuZXdfZGVjb2RlX2Rldihj
dHJsX2NtZC5wa3RfZGV2KSk7CisJCWJyZWFrOworCWNhc2UgUEtUX0NUUkxfQ01E
X1NUQVRVUzoKKwkJcGt0X2dldF9zdGF0dXMoJmN0cmxfY21kKTsKKwkJYnJlYWs7
CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FTk9UVFk7CisJfQorCisJaWYgKGNvcHlf
dG9fdXNlcihhcmdwLCAmY3RybF9jbWQsIHNpemVvZihzdHJ1Y3QgcGt0X2N0cmxf
Y29tbWFuZCkpKQorCQlyZXR1cm4gLUVGQVVMVDsKKwlyZXR1cm4gcmV0OworfQor
CisKK3N0YXRpYyBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHBrdF9jdGxfZm9wcyA9
IHsKKwkuaW9jdGwJID0gcGt0X2N0bF9pb2N0bCwKKwkub3duZXIJID0gVEhJU19N
T0RVTEUsCit9OworCitzdGF0aWMgc3RydWN0IG1pc2NkZXZpY2UgcGt0X21pc2Mg
PSB7CisJLm1pbm9yIAkJPSBNSVNDX0RZTkFNSUNfTUlOT1IsCisJLm5hbWUgIAkJ
PSBEUklWRVJfTkFNRSwKKwkuZm9wcyAgCQk9ICZwa3RfY3RsX2ZvcHMKK307CisK
KyNlbmRpZiAvKiBQS1RfVVNFX1BST0NGUyAqLwogCiAvKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KiovCiAKQEAgLTI2ODIsMzQgKzI3ODYsMTEgQEAgc3RhdGljIHZvaWQgcGt0X2lu
aXRfcXVldWUoc3RydWN0IHBrdGNkdgogCXEtPnF1ZXVlZGF0YSA9IHBkOwogfQog
Ci1zdGF0aWMgaW50IHBrdF9zZXFfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKnApCi17Ci0Jc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCA9IG0tPnByaXZh
dGU7Ci0JY2hhciBidWZbMTAyNF07Ci0JCi0JcGt0X3ByaW50X2luZm8ocGQsIGJ1
Ziwgc2l6ZW9mKGJ1ZikpOwotCXNlcV9wcmludGYobSwgIiVzIiwgYnVmKTsKLQly
ZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBwa3Rfc2VxX29wZW4oc3RydWN0IGlu
b2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCi17Ci0JcmV0dXJuIHNpbmds
ZV9vcGVuKGZpbGUsIHBrdF9zZXFfc2hvdywgUERFKGlub2RlKS0+ZGF0YSk7Ci19
Ci0KLXN0YXRpYyBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHBrdF9wcm9jX2ZvcHMg
PSB7Ci0JLm9wZW4JPSBwa3Rfc2VxX29wZW4sCi0JLnJlYWQJPSBzZXFfcmVhZCwK
LQkubGxzZWVrCT0gc2VxX2xzZWVrLAotCS5yZWxlYXNlID0gc2luZ2xlX3JlbGVh
c2UKLX07Ci0KIHN0YXRpYyBpbnQgcGt0X25ld19kZXYoc3RydWN0IHBrdGNkdmRf
ZGV2aWNlICpwZCwgZGV2X3QgZGV2KQogewogCWludCBpOwogCWludCByZXQgPSAw
OwogCWNoYXIgYltCREVWTkFNRV9TSVpFXTsKLQlzdHJ1Y3QgcHJvY19kaXJfZW50
cnkgKnByb2M7CiAJc3RydWN0IGJsb2NrX2RldmljZSAqYmRldjsKIAogCWlmIChw
ZC0+cGt0X2RldiA9PSBkZXYpIHsKQEAgLTI3NTMsMTEgKzI4MzQsMTYgQEAgc3Rh
dGljIGludCBwa3RfbmV3X2RldihzdHJ1Y3QgcGt0Y2R2ZF9kZQogCQlnb3RvIG91
dF9tZW07CiAJfQogCi0JcHJvYyA9IGNyZWF0ZV9wcm9jX2VudHJ5KHBkLT5uYW1l
LCAwLCBwa3RfcHJvYyk7Ci0JaWYgKHByb2MpIHsKLQkJcHJvYy0+ZGF0YSA9IHBk
OwotCQlwcm9jLT5wcm9jX2ZvcHMgPSAmcGt0X3Byb2NfZm9wczsKKyNpZiBQS1Rf
VVNFX1BST0NGUworCXsKKwkJc3RydWN0IHByb2NfZGlyX2VudHJ5ICpwcm9jID0g
Y3JlYXRlX3Byb2NfZW50cnkocGQtPm5hbWUsCisJCQkJCQkJCTAsIHBrdF9wcm9j
KTsKKwkJaWYgKHByb2MpIHsKKwkJCXByb2MtPmRhdGEgPSBwZDsKKwkJCXByb2Mt
PnByb2NfZm9wcyA9ICZwa3RfcHJvY19mb3BzOworCQl9CiAJfQorI2VuZGlmCiAJ
RFBSSU5USyhEUklWRVJfTkFNRSI6IHdyaXRlciAlcyBtYXBwZWQgdG8gJXNcbiIs
IHBkLT5uYW1lLCBiZGV2bmFtZShiZGV2LCBiKSk7CiAJcmV0dXJuIDA7CiAKQEAg
LTI5NDYsNyArMzAzMiw5IEBAIHN0YXRpYyBpbnQgcGt0X3JlbW92ZV9kZXYoZGV2
X3QgcGt0X2RldikKIAogCWJsa2Rldl9wdXQocGQtPmJkZXYpOwogCisjaWYgUEtU
X1VTRV9QUk9DRlMKIAlyZW1vdmVfcHJvY19lbnRyeShwZC0+bmFtZSwgcGt0X3By
b2MpOworI2VuZGlmCiAJRFBSSU5USyhEUklWRVJfTkFNRSI6IHdyaXRlciAlcyB1
bm1hcHBlZFxuIiwgcGQtPm5hbWUpOwogCiAJZGVsX2dlbmRpc2socGQtPmRpc2sp
OwpAQCAtMjk2NCw3MyArMzA1Miw2IEBAIG91dDoKIAlyZXR1cm4gcmV0OwogfQog
Ci1zdGF0aWMgdm9pZCBwa3RfZ2V0X3N0YXR1cyhzdHJ1Y3QgcGt0X2N0cmxfY29t
bWFuZCAqY3RybF9jbWQpCi17Ci0Jc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZDsK
LQkKLQltdXRleF9sb2NrX25lc3RlZCgmY3RsX211dGV4LCBTSU5HTEVfREVQVEhf
TkVTVElORyk7Ci0JCi0JcGQgPSBwa3RfZmluZF9kZXZfZnJvbV9taW5vcihjdHJs
X2NtZC0+ZGV2X2luZGV4KTsKLQlpZiAocGQpIHsKLQkJY3RybF9jbWQtPmRldiA9
IG5ld19lbmNvZGVfZGV2KHBkLT5iZGV2LT5iZF9kZXYpOwotCQljdHJsX2NtZC0+
cGt0X2RldiA9IG5ld19lbmNvZGVfZGV2KHBkLT5wa3RfZGV2KTsKLQl9IGVsc2Ug
ewotCQljdHJsX2NtZC0+ZGV2ID0gMDsKLQkJY3RybF9jbWQtPnBrdF9kZXYgPSAw
OwotCX0KLQljdHJsX2NtZC0+bnVtX2RldmljZXMgPSBNQVhfV1JJVEVSUzsKLQkK
LQltdXRleF91bmxvY2soJmN0bF9tdXRleCk7Ci19Ci0KLXN0YXRpYyBpbnQgcGt0
X2N0bF9pb2N0bChzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmls
ZSwgdW5zaWduZWQgaW50IGNtZCwgdW5zaWduZWQgbG9uZyBhcmcpCi17Ci0Jdm9p
ZCBfX3VzZXIgKmFyZ3AgPSAodm9pZCBfX3VzZXIgKilhcmc7Ci0Jc3RydWN0IHBr
dF9jdHJsX2NvbW1hbmQgY3RybF9jbWQ7Ci0JaW50IHJldCA9IDA7Ci0JZGV2X3Qg
cGt0X2RldiA9IDA7Ci0KLQlpZiAoY21kICE9IFBBQ0tFVF9DVFJMX0NNRCkKLQkJ
cmV0dXJuIC1FTk9UVFk7Ci0KLQlpZiAoY29weV9mcm9tX3VzZXIoJmN0cmxfY21k
LCBhcmdwLCBzaXplb2Yoc3RydWN0IHBrdF9jdHJsX2NvbW1hbmQpKSkKLQkJcmV0
dXJuIC1FRkFVTFQ7Ci0KLQlzd2l0Y2ggKGN0cmxfY21kLmNvbW1hbmQpIHsKLQlj
YXNlIFBLVF9DVFJMX0NNRF9TRVRVUDoKLQkJaWYgKCFjYXBhYmxlKENBUF9TWVNf
QURNSU4pKQotCQkJcmV0dXJuIC1FUEVSTTsKLQkJcmV0ID0gcGt0X3NldHVwX2Rl
dihuZXdfZGVjb2RlX2RldihjdHJsX2NtZC5kZXYpLCAmcGt0X2Rldik7Ci0JCWN0
cmxfY21kLnBrdF9kZXYgPSBuZXdfZW5jb2RlX2Rldihwa3RfZGV2KTsKLQkJYnJl
YWs7Ci0JY2FzZSBQS1RfQ1RSTF9DTURfVEVBUkRPV046Ci0JCWlmICghY2FwYWJs
ZShDQVBfU1lTX0FETUlOKSkKLQkJCXJldHVybiAtRVBFUk07Ci0JCXJldCA9IHBr
dF9yZW1vdmVfZGV2KG5ld19kZWNvZGVfZGV2KGN0cmxfY21kLnBrdF9kZXYpKTsK
LQkJYnJlYWs7Ci0JY2FzZSBQS1RfQ1RSTF9DTURfU1RBVFVTOgotCQlwa3RfZ2V0
X3N0YXR1cygmY3RybF9jbWQpOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1
cm4gLUVOT1RUWTsKLQl9Ci0KLQlpZiAoY29weV90b191c2VyKGFyZ3AsICZjdHJs
X2NtZCwgc2l6ZW9mKHN0cnVjdCBwa3RfY3RybF9jb21tYW5kKSkpCi0JCXJldHVy
biAtRUZBVUxUOwotCXJldHVybiByZXQ7Ci19Ci0KLQotc3RhdGljIHN0cnVjdCBm
aWxlX29wZXJhdGlvbnMgcGt0X2N0bF9mb3BzID0gewotCS5pb2N0bAkgPSBwa3Rf
Y3RsX2lvY3RsLAotCS5vd25lcgkgPSBUSElTX01PRFVMRSwKLX07Ci0KLXN0YXRp
YyBzdHJ1Y3QgbWlzY2RldmljZSBwa3RfbWlzYyA9IHsKLQkubWlub3IgCQk9IE1J
U0NfRFlOQU1JQ19NSU5PUiwKLQkubmFtZSAgCQk9IERSSVZFUl9OQU1FLAotCS5m
b3BzICAJCT0gJnBrdF9jdGxfZm9wcwotfTsKIAogc3RhdGljIGludCBfX2luaXQg
cGt0X2luaXQodm9pZCkKIHsKQEAgLTMwNTcsMTkgKzMwNzgsMjEgQEAgc3RhdGlj
IGludCBfX2luaXQgcGt0X2luaXQodm9pZCkKIAogCXBrdF9kZWJ1Z2ZzX2luaXQo
KTsKIAorI2lmIFBLVF9VU0VfUFJPQ0ZTCiAJcmV0ID0gbWlzY19yZWdpc3Rlcigm
cGt0X21pc2MpOwogCWlmIChyZXQpIHsKIAkJcHJpbnRrKERSSVZFUl9OQU1FIjog
VW5hYmxlIHRvIHJlZ2lzdGVyIG1pc2MgZGV2aWNlXG4iKTsKIAkJZ290byBvdXRf
bWlzYzsKIAl9Ci0KIAlwa3RfcHJvYyA9IHByb2NfbWtkaXIoRFJJVkVSX05BTUUs
IHByb2Nfcm9vdF9kcml2ZXIpOwotCisjZW5kaWYKIAlyZXR1cm4gMDsKIAorI2lm
IFBLVF9VU0VfUFJPQ0ZTCiBvdXRfbWlzYzoKIAlwa3RfZGVidWdmc19jbGVhbnVw
KCk7CiAJcGt0X3N5c2ZzX2NsZWFudXAoKTsKKyNlbmRpZgogb3V0OgogCXVucmVn
aXN0ZXJfYmxrZGV2KHBrdGRldl9tYWpvciwgRFJJVkVSX05BTUUpOwogb3V0MjoK
QEAgLTMwNzksOSArMzEwMiwxMCBAQCBvdXQyOgogCiBzdGF0aWMgdm9pZCBfX2V4
aXQgcGt0X2V4aXQodm9pZCkKIHsKKyNpZiBQS1RfVVNFX1BST0NGUwogCXJlbW92
ZV9wcm9jX2VudHJ5KERSSVZFUl9OQU1FLCBwcm9jX3Jvb3RfZHJpdmVyKTsKIAlt
aXNjX2RlcmVnaXN0ZXIoJnBrdF9taXNjKTsKLQkKKyNlbmRpZgogCXBrdF9kZWJ1
Z2ZzX2NsZWFudXAoKTsKIAlwa3Rfc3lzZnNfY2xlYW51cCgpOwogCQpkaWZmIC11
cnBOIDYtc3lzZnMvaW5jbHVkZS9saW51eC9wa3RjZHZkLmggNy1wcm9jZnMtb3B0
aW9uYWwvaW5jbHVkZS9saW51eC9wa3RjZHZkLmgKLS0tIDYtc3lzZnMvaW5jbHVk
ZS9saW51eC9wa3RjZHZkLmgJMjAwNi0xMC0wMyAxMjo1NDo0MS4wMDAwMDAwMDAg
KzAyMDAKKysrIDctcHJvY2ZzLW9wdGlvbmFsL2luY2x1ZGUvbGludXgvcGt0Y2R2
ZC5oCTIwMDYtMTAtMDMgMTM6MDk6MTguMDAwMDAwMDAwICswMjAwCkBAIC0xMDgs
MTIgKzEwOCwyMSBAQCBzdHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCB7CiAjZGVmaW5l
IFBBQ0tFVF9DVFJMX0NNRAkJX0lPV1IoUEFDS0VUX0lPQ1RMX01BR0lDLCAxLCBz
dHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCkKIAogI2lmZGVmIF9fS0VSTkVMX18KKyNp
bmNsdWRlIDxsaW51eC9jb25maWcuaD4KICNpbmNsdWRlIDxsaW51eC9ibGtkZXYu
aD4KICNpbmNsdWRlIDxsaW51eC9jb21wbGV0aW9uLmg+CiAjaW5jbHVkZSA8bGlu
dXgvY2Ryb20uaD4KICNpbmNsdWRlIDxsaW51eC9rb2JqZWN0Lmg+CiAjaW5jbHVk
ZSA8bGludXgvc3lzZnMuaD4KIAorLyogdXNlIChvbGQpIHByb2NmcyBpbnRlcmZh
Y2U/ICovCisjaWZkZWYgQ09ORklHX0NEUk9NX1BLVENEVkRfUFJPQ0lOVEYKKyNk
ZWZpbmUgUEtUX1VTRV9QUk9DRlMgIDEKKyNlbHNlCisjZGVmaW5lIFBLVF9VU0Vf
UFJPQ0ZTICAwCisjZW5kaWYKKworCiBzdHJ1Y3QgcGFja2V0X3NldHRpbmdzCiB7
CiAJX191MzIJCQlzaXplOwkJLyogcGFja2V0IHNpemUgaW4gKDUxMiBieXRlKSBz
ZWN0b3JzICovCg==

------------CTSVsVO6lokKwSsaBa0pv2--

