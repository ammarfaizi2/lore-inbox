Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S270349AbRH1H1C>; Tue, 28 Aug 2001 03:27:02 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S270333AbRH1H0y>; Tue, 28 Aug 2001 03:26:54 -0400
Received: from as2-4-3.an.g.bonet.se ([194.236.34.191]:19450 "EHLO
	cosmo.zigo.dhs.org") by vger.kernel.org with ESMTP
	id <S270349AbRH1H0n>; Tue, 28 Aug 2001 03:26:43 -0400
Date: Tue, 28 Aug 2001 09:26:41 +0200 (CEST)
From: Dennis Bjorklund <db@zigo.dhs.org>
To: David Schmitt <david@heureka.co.at>
cc: <linux-kernel@vger.kernel.org>
Subject: Re: ISSUE: DFE530-TX REV-A3-1 times out on transmit
In-Reply-To: <20010827102740.A9557@www.heureka.co.at>
Message-ID: <Pine.LNX.4.33.0108280921160.12686-200000@cosmo.zigo.dhs.org>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-1463811328-996702575-998983601=:12686"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1463811328-996702575-998983601=:12686
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 27 Aug 2001, David Schmitt wrote:

> As mentioned above, it seems like the 2.2.19 version does the Right
> Thing (but doesn't recover autmatically).

I backported the recover stuff from 2.4.x to 2.2.20-pre9 and it works nice
for me. I've been running it for a couple of weeks without problem and
where it before locked up it now resets (clear improvement for me).

I sent it to Alan in hope that it could make it to 2.2.20 but I got no
reply. I don't know if I should continue send it to him or what.

-- 
/Dennis

---1463811328-996702575-998983601=:12686
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; name="linux_pre9_2.2.20_via_rhine.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.33.0108280926410.12686@cosmo.zigo.dhs.org>
Content-Description: 
Content-Disposition: attachment; filename="linux_pre9_2.2.20_via_rhine.patch"

LS0tIGxpbnV4L2RyaXZlcnMvbmV0L3ZpYS1yaGluZS5jCVNhdCBBdWcgMTgg
MTQ6MTA6MDcgMjAwMQ0KKysrIGxpbnV4LTIuMi4xOS9kcml2ZXJzL25ldC92
aWEtcmhpbmUuYwlTYXQgQXVnIDE4IDE0OjIzOjM4IDIwMDENCkBAIC0yNSwx
MSArMjUsMTUgQEANCiANCiAJTEsxLjAuMDoNCiAJLSBVcmJhbiBXaWRtYXJr
OiBtZXJnZXMgZnJvbSBCZWNrZXJzIDEuMDhiIHZlcnNpb24gYW5kIDIuNC4w
IChWVDYxMDIpDQorDQorCUxLMS4wLjENCisJLSBEZW5uaXMgQmr2cmtsdW5k
OiBiYWNrcG9ydCB0eF90aW1lb3V0IGZyb20gMi40LnggdG8gcmVzZXQgb24g
dGltZW91dA0KKyAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2Yg
c3RvcCB3b3JraW5nLi4uDQogKi8NCiANCiAvKiBUaGVzZSBpZGVudGlmeSB0
aGUgZHJpdmVyIGJhc2UgdmVyc2lvbiBhbmQgbWF5IG5vdCBiZSByZW1vdmVk
LiAqLw0KIHN0YXRpYyBjb25zdCBjaGFyIHZlcnNpb24xW10gPQ0KLSJ2aWEt
cmhpbmUuYzp2MS4wOGItTEsxLjAuMCAxMi8xNC8yMDAwICBXcml0dGVuIGJ5
IERvbmFsZCBCZWNrZXJcbiI7DQorInZpYS1yaGluZS5jOnYxLjA4Yi1MSzEu
MC4xIDEyLzE0LzIwMDAgIFdyaXR0ZW4gYnkgRG9uYWxkIEJlY2tlclxuIjsN
CiBzdGF0aWMgY29uc3QgY2hhciB2ZXJzaW9uMltdID0NCiAiICBodHRwOi8v
d3d3LnNjeWxkLmNvbS9uZXR3b3JrL3ZpYS1yaGluZS5odG1sXG4iOw0KIA0K
QEAgLTk1LDkgKzk5LDExIEBADQogI2luY2x1ZGUgPGxpbnV4L2V0aGVyZGV2
aWNlLmg+DQogI2luY2x1ZGUgPGxpbnV4L3NrYnVmZi5oPg0KICNpbmNsdWRl
IDxsaW51eC9pbml0Lmg+DQorI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+DQog
I2luY2x1ZGUgPGFzbS9wcm9jZXNzb3IuaD4JCS8qIFByb2Nlc3NvciB0eXBl
IGZvciBjYWNoZSBhbGlnbm1lbnQuICovDQogI2luY2x1ZGUgPGFzbS9iaXRv
cHMuaD4NCiAjaW5jbHVkZSA8YXNtL2lvLmg+DQorI2luY2x1ZGUgPGFzbS9p
cnEuaD4NCiANCiAvKiBDb25kZW5zZWQgYnVzK2VuZGlhbiBwb3J0YWJpbGl0
eSBvcGVyYXRpb25zLiAqLw0KICNkZWZpbmUgdmlydF90b19sZTMyZGVzYyhh
ZGRyKSBjcHVfdG9fbGUzMih2aXJ0X3RvX2J1cyhhZGRyKSkNCkBAIC0yNTYs
NiArMjYyLDEzIEBADQogCQkJCQkJCQkgc3RydWN0IGRldmljZSAqZGV2LCBs
b25nIGlvYWRkciwgaW50IGlycSwNCiAJCQkJCQkJCSBpbnQgY2hwX2lkeCwg
aW50IGZuZF9jbnQpOw0KIA0KK2VudW0gdmlhX3JoaW5lX2NoaXBzIHsNCisJ
VlQ4NkMxMDBBID0gMCwNCisJVlQ2MTAyLA0KKwlWVDMwNDMsDQorfTsNCisN
CisvKiBkaXJlY3RseSBpbmRleGVkIGJ5IGVudW0gdmlhX3JoaW5lX2NoaXBz
LCBhYm92ZSAqLw0KIHN0YXRpYyBzdHJ1Y3QgcGNpX2lkX2luZm8gcGNpX3Ri
bFtdIF9faW5pdGRhdGEgPSB7DQogCXsgIlZJQSBWVDg2QzEwMEEgUmhpbmUt
SUkiLCAweDExMDYsIDB4NjEwMCwgMHhmZmZmLA0KIAkgIFJISU5FX0lPVFlQ
RSwgMTI4LCB2aWFfcHJvYmUxfSwNCkBAIC0zNzksNyArMzkyLDYgQEANCiBz
dGF0aWMgdm9pZCBjaGVja19kdXBsZXgoc3RydWN0IGRldmljZSAqZGV2KTsN
CiBzdGF0aWMgdm9pZCBuZXRkZXZfdGltZXIodW5zaWduZWQgbG9uZyBkYXRh
KTsNCiBzdGF0aWMgdm9pZCB0eF90aW1lb3V0KHN0cnVjdCBkZXZpY2UgKmRl
dik7DQotc3RhdGljIHZvaWQgaW5pdF9yaW5nKHN0cnVjdCBkZXZpY2UgKmRl
dik7DQogc3RhdGljIGludCAgc3RhcnRfdHgoc3RydWN0IHNrX2J1ZmYgKnNr
Yiwgc3RydWN0IGRldmljZSAqZGV2KTsNCiBzdGF0aWMgdm9pZCBpbnRyX2hh
bmRsZXIoaW50IGlycSwgdm9pZCAqZGV2X2luc3RhbmNlLCBzdHJ1Y3QgcHRf
cmVncyAqcmVncyk7DQogc3RhdGljIGludCAgbmV0ZGV2X3J4KHN0cnVjdCBk
ZXZpY2UgKmRldik7DQpAQCAtMzk1LDYgKzQwNywzMSBAQA0KIC8qIEEgbGlz
dCBvZiBvdXIgaW5zdGFsbGVkIGRldmljZXMsIGZvciByZW1vdmluZyB0aGUg
ZHJpdmVyIG1vZHVsZS4gKi8NCiBzdGF0aWMgc3RydWN0IGRldmljZSAqcm9v
dF9uZXRfZGV2ID0gTlVMTDsNCiANCitzdGF0aWMgdm9pZCB3YWl0X2Zvcl9y
ZXNldChzdHJ1Y3QgZGV2aWNlICpkZXYsIGNoYXIgKm5hbWUpDQorew0KKwlz
dHJ1Y3QgbmV0ZGV2X3ByaXZhdGUgKm5wID0gZGV2LT5wcml2Ow0KKwlsb25n
IGlvYWRkciA9IGRldi0+YmFzZV9hZGRyOw0KKwlpbnQgY2hpcF9pZCA9IG5w
LT5jaGlwX2lkOw0KKwlpbnQgaTsNCisNCisJLyogMzA0MyBtYXkgbmVlZCBs
b25nIGRlbGF5IGFmdGVyIHJlc2V0IChkbGluaykgKi8NCisJaWYgKGNoaXBf
aWQgPT0gVlQzMDQzIHx8IGNoaXBfaWQgPT0gVlQ4NkMxMDBBKQ0KKwkJdWRl
bGF5KDEwMCk7DQorDQorCWkgPSAwOw0KKwlkbyB7DQorCQl1ZGVsYXkoNSk7
DQorCQlpKys7DQorCQlpZihpID4gMjAwMCkgew0KKwkJCXByaW50ayhLRVJO
X0VSUiAiJXM6IHJlc2V0IGRpZCBub3QgY29tcGxldGUgaW4gMTAgbXMuXG4i
LCBuYW1lKTsNCisJCQlicmVhazsNCisJCX0NCisJfSB3aGlsZShyZWFkdyhp
b2FkZHIgKyBDaGlwQ21kKSAmIENtZFJlc2V0KTsNCisJaWYgKGRlYnVnID4g
MSkNCisJCXByaW50ayhLRVJOX0lORk8gIiVzOiByZXNldCBmaW5pc2hlZCBh
ZnRlciAlZCBtaWNyb3NlY29uZHMuXG4iLA0KKwkJCSAgIG5hbWUsIDUqaSk7
DQorfQ0KKw0KIC8qIElkZWFsbHkgd2Ugd291bGQgZGV0ZWN0IGFsbCBuZXR3
b3JrIGNhcmRzIGluIHNsb3Qgb3JkZXIuICBUaGF0IHdvdWxkDQogICAgYmUg
YmVzdCBkb25lIGEgY2VudHJhbCBQQ0kgcHJvYmUgZGlzcGF0Y2gsIHdoaWNo
IHdvdWxkbid0IHdvcmsNCiAgICB3ZWxsIHdoZW4gZHluYW1pY2FsbHkgYWRk
aW5nIGRyaXZlcnMuICBTbyBpbnN0ZWFkIHdlIGRldGVjdCBqdXN0IHRoZQ0K
QEAgLTU5NCw2ICs2MzEsMTQxIEBADQogCXJldHVybiBkZXY7DQogfQ0KIA0K
K3N0YXRpYyB2b2lkIGFsbG9jX3JidWZzKHN0cnVjdCBkZXZpY2UgKmRldikN
Cit7DQorCXN0cnVjdCBuZXRkZXZfcHJpdmF0ZSAqbnAgPSAoc3RydWN0IG5l
dGRldl9wcml2YXRlICopZGV2LT5wcml2Ow0KKwlpbnQgaTsNCisNCisJbnAt
PmN1cl9yeCA9IDA7DQorCW5wLT5kaXJ0eV9yeCA9IDA7DQorDQorCW5wLT5y
eF9idWZfc3ogPSAoZGV2LT5tdHUgPD0gMTUwMCA/IFBLVF9CVUZfU1ogOiBk
ZXYtPm10dSArIDMyKTsNCisJbnAtPnJ4X2hlYWRfZGVzYyA9ICZucC0+cnhf
cmluZ1swXTsNCisNCisJZm9yIChpID0gMDsgaSA8IFJYX1JJTkdfU0laRTsg
aSsrKSB7DQorCQlucC0+cnhfcmluZ1tpXS5yeF9zdGF0dXMgPSAwOw0KKwkJ
bnAtPnJ4X3JpbmdbaV0uZGVzY19sZW5ndGggPSBjcHVfdG9fbGUzMihucC0+
cnhfYnVmX3N6KTsNCisJCW5wLT5yeF9yaW5nW2ldLm5leHRfZGVzYyA9IHZp
cnRfdG9fbGUzMmRlc2MoJm5wLT5yeF9yaW5nW2krMV0pOw0KKwkJbnAtPnJ4
X3NrYnVmZltpXSA9IDA7DQorCX0NCisJLyogTWFyayB0aGUgbGFzdCBlbnRy
eSBhcyB3cmFwcGluZyB0aGUgcmluZy4gKi8NCisJbnAtPnJ4X3JpbmdbaS0x
XS5uZXh0X2Rlc2MgPSB2aXJ0X3RvX2xlMzJkZXNjKCZucC0+cnhfcmluZ1sw
XSk7DQorDQorCS8qIEZpbGwgaW4gdGhlIFJ4IGJ1ZmZlcnMuICBIYW5kbGUg
YWxsb2NhdGlvbiBmYWlsdXJlIGdyYWNlZnVsbHkuICovDQorCWZvciAoaSA9
IDA7IGkgPCBSWF9SSU5HX1NJWkU7IGkrKykgew0KKwkJc3RydWN0IHNrX2J1
ZmYgKnNrYiA9IGRldl9hbGxvY19za2IobnAtPnJ4X2J1Zl9zeik7DQorCQlu
cC0+cnhfc2tidWZmW2ldID0gc2tiOw0KKwkJaWYgKHNrYiA9PSBOVUxMKQ0K
KwkJCWJyZWFrOw0KKwkJc2tiLT5kZXYgPSBkZXY7CQkJLyogTWFyayBhcyBi
ZWluZyB1c2VkIGJ5IHRoaXMgZGV2aWNlLiAqLw0KKwkJbnAtPnJ4X3Jpbmdb
aV0uYWRkciA9IHZpcnRfdG9fbGUzMmRlc2Moc2tiLT50YWlsKTsNCisJCW5w
LT5yeF9yaW5nW2ldLnJ4X3N0YXR1cyA9IGNwdV90b19sZTMyKERlc2NPd24p
Ow0KKwl9DQorCW5wLT5kaXJ0eV9yeCA9ICh1bnNpZ25lZCBpbnQpKGkgLSBS
WF9SSU5HX1NJWkUpOw0KK30NCisNCitzdGF0aWMgdm9pZCBmcmVlX3JidWZz
KHN0cnVjdCBkZXZpY2UqIGRldikNCit7DQorCXN0cnVjdCBuZXRkZXZfcHJp
dmF0ZSAqbnAgPSAoc3RydWN0IG5ldGRldl9wcml2YXRlICopZGV2LT5wcml2
Ow0KKwlpbnQgaTsNCisNCisJLyogRnJlZSBhbGwgdGhlIHNrYnVmZnMgaW4g
dGhlIFJ4IHF1ZXVlLiAqLw0KKwlmb3IgKGkgPSAwOyBpIDwgUlhfUklOR19T
SVpFOyBpKyspIHsNCisJCW5wLT5yeF9yaW5nW2ldLnJ4X3N0YXR1cyA9IDA7
DQorCQlucC0+cnhfcmluZ1tpXS5hZGRyID0gMHhCQURGMDBEMDsgLyogQW4g
aW52YWxpZCBhZGRyZXNzLiAqLw0KKwkJaWYgKG5wLT5yeF9za2J1ZmZbaV0p
IHsNCisjaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgMHgyMDEwMA0KKwkJCW5w
LT5yeF9za2J1ZmZbaV0tPmZyZWUgPSAxOw0KKyNlbmRpZg0KKwkJCWRldl9r
ZnJlZV9za2IobnAtPnJ4X3NrYnVmZltpXSk7DQorCQl9DQorCQlucC0+cnhf
c2tidWZmW2ldID0gMDsNCisJfQ0KK30NCisNCitzdGF0aWMgdm9pZCBhbGxv
Y190YnVmcyhzdHJ1Y3QgZGV2aWNlKiBkZXYpDQorew0KKwlzdHJ1Y3QgbmV0
ZGV2X3ByaXZhdGUgKm5wID0gKHN0cnVjdCBuZXRkZXZfcHJpdmF0ZSAqKWRl
di0+cHJpdjsNCisJaW50IGk7DQorDQorCW5wLT50eF9mdWxsID0gMDsNCisJ
bnAtPmN1cl90eCA9IDA7DQorCW5wLT5kaXJ0eV90eCA9IDA7DQorDQorCWZv
ciAoaSA9IDA7IGkgPCBUWF9SSU5HX1NJWkU7IGkrKykgew0KKwkJbnAtPnR4
X3NrYnVmZltpXSA9IDA7DQorCQlucC0+dHhfcmluZ1tpXS50eF9zdGF0dXMg
PSAwOw0KKwkJbnAtPnR4X3JpbmdbaV0uZGVzY19sZW5ndGggPSBjcHVfdG9f
bGUzMigweDAwZTA4MDAwKTsNCisJCW5wLT50eF9yaW5nW2ldLm5leHRfZGVz
YyA9IHZpcnRfdG9fbGUzMmRlc2MoJm5wLT50eF9yaW5nW2krMV0pOw0KKwkJ
bnAtPnR4X2J1ZltpXSA9IGttYWxsb2MoUEtUX0JVRl9TWiwgR0ZQX0tFUk5F
TCk7DQorCX0NCisJbnAtPnR4X3JpbmdbaS0xXS5uZXh0X2Rlc2MgPSB2aXJ0
X3RvX2xlMzJkZXNjKCZucC0+dHhfcmluZ1swXSk7DQorfQ0KKw0KK3N0YXRp
YyB2b2lkIGZyZWVfdGJ1ZnMoc3RydWN0IGRldmljZSAqZGV2KQ0KK3sNCisJ
c3RydWN0IG5ldGRldl9wcml2YXRlICpucCA9IChzdHJ1Y3QgbmV0ZGV2X3By
aXZhdGUgKilkZXYtPnByaXY7DQorCWludCBpOw0KKw0KKwlmb3IgKGkgPSAw
OyBpIDwgVFhfUklOR19TSVpFOyBpKyspIHsNCisJCWlmIChucC0+dHhfc2ti
dWZmW2ldKQ0KKwkJCWRldl9rZnJlZV9za2IobnAtPnR4X3NrYnVmZltpXSk7
DQorCQlucC0+dHhfc2tidWZmW2ldID0gMDsNCisJCWlmIChucC0+dHhfYnVm
W2ldKSB7DQorCQkJa2ZyZWUobnAtPnR4X2J1ZltpXSk7DQorCQkJbnAtPnR4
X2J1ZltpXSA9IDA7DQorCQl9DQorCX0NCit9DQorDQorc3RhdGljIHZvaWQg
aW5pdF9yZWdpc3RlcnMoc3RydWN0IGRldmljZSAqZGV2KQ0KK3sNCisJc3Ry
dWN0IG5ldGRldl9wcml2YXRlICpucCA9IChzdHJ1Y3QgbmV0ZGV2X3ByaXZh
dGUgKilkZXYtPnByaXY7DQorCWxvbmcgaW9hZGRyID0gZGV2LT5iYXNlX2Fk
ZHI7DQorCWludCBpOw0KKw0KKwlmb3IgKGkgPSAwOyBpIDwgNjsgaSsrKQ0K
KwkJd3JpdGViKGRldi0+ZGV2X2FkZHJbaV0sIGlvYWRkciArIFN0YXRpb25B
ZGRyICsgaSk7DQorDQorCS8qIEluaXRpYWxpemUgb3RoZXIgcmVnaXN0ZXJz
LiAqLw0KKwl3cml0ZXcoMHgwMDA2LCBpb2FkZHIgKyBQQ0lCdXNDb25maWcp
OwkvKiBUdW5lIGNvbmZpZ3VyYXRpb24/Pz8gKi8NCisJLyogQ29uZmlndXJl
IHRoZSBGSUZPIHRocmVzaG9sZHMuICovDQorCXdyaXRlYigweDIwLCBpb2Fk
ZHIgKyBUeENvbmZpZyk7CS8qIEluaXRpYWwgdGhyZXNob2xkIDMyIGJ5dGVz
ICovDQorCW5wLT50eF90aHJlc2ggPSAweDIwOw0KKwlucC0+cnhfdGhyZXNo
ID0gMHg2MDsJCQkJLyogV3JpdHRlbiBpbiBzZXRfcnhfbW9kZSgpLiAqLw0K
Kw0KKwlpZiAoZGV2LT5pZl9wb3J0ID09IDApDQorCQlkZXYtPmlmX3BvcnQg
PSBucC0+ZGVmYXVsdF9wb3J0Ow0KKw0KKwlkZXYtPnRidXN5ID0gMDsNCisJ
ZGV2LT5pbnRlcnJ1cHQgPSAwOw0KKw0KKwl3cml0ZWwodmlydF90b19idXMo
bnAtPnJ4X3JpbmcpLCBpb2FkZHIgKyBSeFJpbmdQdHIpOw0KKwl3cml0ZWwo
dmlydF90b19idXMobnAtPnR4X3JpbmcpLCBpb2FkZHIgKyBUeFJpbmdQdHIp
Ow0KKw0KKwlzZXRfcnhfbW9kZShkZXYpOw0KKw0KKwlkZXYtPnN0YXJ0ID0g
MTsNCisNCisJLyogRW5hYmxlIGludGVycnVwdHMgYnkgc2V0dGluZyB0aGUg
aW50ZXJydXB0IG1hc2suICovDQorCXdyaXRldyhJbnRyUnhEb25lIHwgSW50
clJ4RXJyIHwgSW50clJ4RW1wdHl8IEludHJSeE92ZXJmbG93fCBJbnRyUnhE
cm9wcGVkfA0KKwkJICAgSW50clR4RG9uZSB8IEludHJUeEFib3J0IHwgSW50
clR4VW5kZXJydW4gfA0KKwkJICAgSW50clBDSUVyciB8IEludHJTdGF0c01h
eCB8IEludHJMaW5rQ2hhbmdlIHwgSW50ck1JSUNoYW5nZSwNCisJCSAgIGlv
YWRkciArIEludHJFbmFibGUpOw0KKw0KKwlucC0+Y2hpcF9jbWQgPSBDbWRT
dGFydHxDbWRUeE9ufENtZFJ4T258Q21kTm9UeFBvbGw7DQorCWlmIChucC0+
ZHVwbGV4X2xvY2spDQorCQlucC0+Y2hpcF9jbWQgfD0gQ21kRkR1cGxleDsN
CisJd3JpdGV3KG5wLT5jaGlwX2NtZCwgaW9hZGRyICsgQ2hpcENtZCk7DQor
DQorCWNoZWNrX2R1cGxleChkZXYpOw0KKwkvKiBUaGUgTEVEIG91dHB1dHMg
b2YgdmFyaW91cyBNSUkgeGN2cnMgc2hvdWxkIGJlIGNvbmZpZ3VyZWQuICAq
Lw0KKwkvKiBGb3IgTlMgb3IgTWlzb24gcGh5cywgdHVybiBvbiBiaXQgMSBp
biByZWdpc3RlciAweDE3ICovDQorCS8qIEZvciBFU0kgcGh5cywgdHVybiBv
biBiaXQgNyBpbiByZWdpc3RlciAweDE3LiAqLw0KKwltZGlvX3dyaXRlKGRl
diwgbnAtPnBoeXNbMF0sIDB4MTcsIG1kaW9fcmVhZChkZXYsIG5wLT5waHlz
WzBdLCAweDE3KSB8DQorCQkJICAgKG5wLT5kcnZfZmxhZ3MgJiBIYXNFU0lQ
aHkpID8gMHgwMDgwIDogMHgwMDAxKTsNCit9DQorDQogDA0KIC8qIFJlYWQg
YW5kIHdyaXRlIG92ZXIgdGhlIE1JSSBNYW5hZ2VtZW50IERhdGEgSS9PIChN
RElPKSBpbnRlcmZhY2UuICovDQogDQpAQCAtNjUwLDcgKzgyMiw2IEBADQog
ew0KIAlzdHJ1Y3QgbmV0ZGV2X3ByaXZhdGUgKm5wID0gKHN0cnVjdCBuZXRk
ZXZfcHJpdmF0ZSAqKWRldi0+cHJpdjsNCiAJbG9uZyBpb2FkZHIgPSBkZXYt
PmJhc2VfYWRkcjsNCi0JaW50IGk7DQogDQogCS8qIFJlc2V0IHRoZSBjaGlw
LiAqLw0KIAl3cml0ZXcoQ21kUmVzZXQsIGlvYWRkciArIENoaXBDbWQpOw0K
QEAgLTY2Niw0OCArODM3LDEwIEBADQogCQlwcmludGsoS0VSTl9ERUJVRyAi
JXM6IG5ldGRldl9vcGVuKCkgaXJxICVkLlxuIiwNCiAJCQkgICBkZXYtPm5h
bWUsIGRldi0+aXJxKTsNCiANCi0JaW5pdF9yaW5nKGRldik7DQotDQotCXdy
aXRlbCh2aXJ0X3RvX2J1cyhucC0+cnhfcmluZyksIGlvYWRkciArIFJ4Umlu
Z1B0cik7DQotCXdyaXRlbCh2aXJ0X3RvX2J1cyhucC0+dHhfcmluZyksIGlv
YWRkciArIFR4UmluZ1B0cik7DQotDQotCWZvciAoaSA9IDA7IGkgPCA2OyBp
KyspDQotCQl3cml0ZWIoZGV2LT5kZXZfYWRkcltpXSwgaW9hZGRyICsgU3Rh
dGlvbkFkZHIgKyBpKTsNCi0NCi0JLyogSW5pdGlhbGl6ZSBvdGhlciByZWdp
c3RlcnMuICovDQotCXdyaXRldygweDAwMDYsIGlvYWRkciArIFBDSUJ1c0Nv
bmZpZyk7CS8qIFR1bmUgY29uZmlndXJhdGlvbj8/PyAqLw0KLQkvKiBDb25m
aWd1cmUgdGhlIEZJRk8gdGhyZXNob2xkcy4gKi8NCi0Jd3JpdGViKDB4MjAs
IGlvYWRkciArIFR4Q29uZmlnKTsJLyogSW5pdGlhbCB0aHJlc2hvbGQgMzIg
Ynl0ZXMgKi8NCi0JbnAtPnR4X3RocmVzaCA9IDB4MjA7DQotCW5wLT5yeF90
aHJlc2ggPSAweDYwOwkJCQkvKiBXcml0dGVuIGluIHNldF9yeF9tb2RlKCku
ICovDQotDQotCWlmIChkZXYtPmlmX3BvcnQgPT0gMCkNCi0JCWRldi0+aWZf
cG9ydCA9IG5wLT5kZWZhdWx0X3BvcnQ7DQotDQotCWRldi0+dGJ1c3kgPSAw
Ow0KLQlkZXYtPmludGVycnVwdCA9IDA7DQotDQotCXNldF9yeF9tb2RlKGRl
dik7DQotDQotCWRldi0+c3RhcnQgPSAxOw0KKwlhbGxvY19yYnVmcyhkZXYp
Ow0KKwlhbGxvY190YnVmcyhkZXYpOw0KIA0KLQkvKiBFbmFibGUgaW50ZXJy
dXB0cyBieSBzZXR0aW5nIHRoZSBpbnRlcnJ1cHQgbWFzay4gKi8NCi0Jd3Jp
dGV3KEludHJSeERvbmUgfCBJbnRyUnhFcnIgfCBJbnRyUnhFbXB0eXwgSW50
clJ4T3ZlcmZsb3d8IEludHJSeERyb3BwZWR8DQotCQkgICBJbnRyVHhEb25l
IHwgSW50clR4QWJvcnQgfCBJbnRyVHhVbmRlcnJ1biB8DQotCQkgICBJbnRy
UENJRXJyIHwgSW50clN0YXRzTWF4IHwgSW50ckxpbmtDaGFuZ2UgfCBJbnRy
TUlJQ2hhbmdlLA0KLQkJICAgaW9hZGRyICsgSW50ckVuYWJsZSk7DQotDQot
CW5wLT5jaGlwX2NtZCA9IENtZFN0YXJ0fENtZFR4T258Q21kUnhPbnxDbWRO
b1R4UG9sbDsNCi0JaWYgKG5wLT5kdXBsZXhfbG9jaykNCi0JCW5wLT5jaGlw
X2NtZCB8PSBDbWRGRHVwbGV4Ow0KLQl3cml0ZXcobnAtPmNoaXBfY21kLCBp
b2FkZHIgKyBDaGlwQ21kKTsNCi0NCi0JY2hlY2tfZHVwbGV4KGRldik7DQot
CS8qIFRoZSBMRUQgb3V0cHV0cyBvZiB2YXJpb3VzIE1JSSB4Y3ZycyBzaG91
bGQgYmUgY29uZmlndXJlZC4gICovDQotCS8qIEZvciBOUyBvciBNaXNvbiBw
aHlzLCB0dXJuIG9uIGJpdCAxIGluIHJlZ2lzdGVyIDB4MTcgKi8NCi0JLyog
Rm9yIEVTSSBwaHlzLCB0dXJuIG9uIGJpdCA3IGluIHJlZ2lzdGVyIDB4MTcu
ICovDQotCW1kaW9fd3JpdGUoZGV2LCBucC0+cGh5c1swXSwgMHgxNywgbWRp
b19yZWFkKGRldiwgbnAtPnBoeXNbMF0sIDB4MTcpIHwNCi0JCQkgICAobnAt
PmRydl9mbGFncyAmIEhhc0VTSVBoeSkgPyAweDAwODAgOiAweDAwMDEpOw0K
Kwlpbml0X3JlZ2lzdGVycyhkZXYpOw0KIA0KIAlpZiAoZGVidWcgPiAyKQ0K
IAkJcHJpbnRrKEtFUk5fREVCVUcgIiVzOiBEb25lIG5ldGRldl9vcGVuKCks
IHN0YXR1cyAlNC40eCAiDQpAQCAtNzc1LDYgKzkwOCw3IEBADQogc3RhdGlj
IHZvaWQgdHhfdGltZW91dChzdHJ1Y3QgZGV2aWNlICpkZXYpDQogew0KIAlz
dHJ1Y3QgbmV0ZGV2X3ByaXZhdGUgKm5wID0gKHN0cnVjdCBuZXRkZXZfcHJp
dmF0ZSAqKWRldi0+cHJpdjsNCisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBw
Y2lfZmluZF9zbG90KG5wLT5wY2lfYnVzLCBucC0+cGNpX2RldmZuKTsNCiAJ
bG9uZyBpb2FkZHIgPSBkZXYtPmJhc2VfYWRkcjsNCiANCiAJcHJpbnRrKEtF
Uk5fV0FSTklORyAiJXM6IFRyYW5zbWl0IHRpbWVkIG91dCwgc3RhdHVzICU0
LjR4LCBQSFkgc3RhdHVzICINCkBAIC03ODIsNjAgKzkxNiwzMiBAQA0KIAkJ
ICAgZGV2LT5uYW1lLCByZWFkdyhpb2FkZHIgKyBJbnRyU3RhdHVzKSwNCiAJ
CSAgIG1kaW9fcmVhZChkZXYsIG5wLT5waHlzWzBdLCAxKSk7DQogDQotCS8q
IFBlcmhhcHMgd2Ugc2hvdWxkIHJlaW5pdGlhbGl6ZSB0aGUgaGFyZHdhcmUg
aGVyZS4gKi8NCiAJZGV2LT5pZl9wb3J0ID0gMDsNCi0JLyogU3RvcCBhbmQg
cmVzdGFydCB0aGUgY2hpcCdzIFR4IHByb2Nlc3NlcyAuICovDQogDQotCS8q
IFRyaWdnZXIgYW4gaW1tZWRpYXRlIHRyYW5zbWl0IGRlbWFuZC4gKi8NCi0N
Ci0JZGV2LT50cmFuc19zdGFydCA9IGppZmZpZXM7DQotCW5wLT5zdGF0cy50
eF9lcnJvcnMrKzsNCi0JcmV0dXJuOw0KLX0NCisJLyogcHJvdGVjdCBhZ2Fp
bnN0IGNvbmN1cnJlbnQgcnggaW50ZXJydXB0cyAqLw0KKwlkaXNhYmxlX2ly
cShwZGV2LT5pcnEpOw0KIA0KKwkvKiBSZXNldCB0aGUgY2hpcC4gKi8NCisJ
d3JpdGV3KENtZFJlc2V0LCBpb2FkZHIgKyBDaGlwQ21kKTsNCiANCi0vKiBJ
bml0aWFsaXplIHRoZSBSeCBhbmQgVHggcmluZ3MsIGFsb25nIHdpdGggdmFy
aW91cyAnZGV2JyBiaXRzLiAqLw0KLXN0YXRpYyB2b2lkIGluaXRfcmluZyhz
dHJ1Y3QgZGV2aWNlICpkZXYpDQotew0KLQlzdHJ1Y3QgbmV0ZGV2X3ByaXZh
dGUgKm5wID0gKHN0cnVjdCBuZXRkZXZfcHJpdmF0ZSAqKWRldi0+cHJpdjsN
Ci0JaW50IGk7DQotDQotCW5wLT50eF9mdWxsID0gMDsNCi0JbnAtPmN1cl9y
eCA9IG5wLT5jdXJfdHggPSAwOw0KLQlucC0+ZGlydHlfcnggPSBucC0+ZGly
dHlfdHggPSAwOw0KKwkvKiBjbGVhciBhbGwgZGVzY3JpcHRvcnMgKi8NCisJ
ZnJlZV90YnVmcyhkZXYpOw0KKwlmcmVlX3JidWZzKGRldik7DQorCWFsbG9j
X3RidWZzKGRldik7DQorCWFsbG9jX3JidWZzKGRldik7DQorDQorCS8qIFJl
aW5pdGlhbGl6ZSB0aGUgaGFyZHdhcmUuICovDQorCXdhaXRfZm9yX3Jlc2V0
KGRldiwgZGV2LT5uYW1lKTsNCisJaW5pdF9yZWdpc3RlcnMoZGV2KTsNCiAN
Ci0JbnAtPnJ4X2J1Zl9zeiA9IChkZXYtPm10dSA8PSAxNTAwID8gUEtUX0JV
Rl9TWiA6IGRldi0+bXR1ICsgMzIpOw0KLQlucC0+cnhfaGVhZF9kZXNjID0g
Jm5wLT5yeF9yaW5nWzBdOw0KKwllbmFibGVfaXJxKHBkZXYtPmlycSk7DQog
DQotCWZvciAoaSA9IDA7IGkgPCBSWF9SSU5HX1NJWkU7IGkrKykgew0KLQkJ
bnAtPnJ4X3JpbmdbaV0ucnhfc3RhdHVzID0gMDsNCi0JCW5wLT5yeF9yaW5n
W2ldLmRlc2NfbGVuZ3RoID0gY3B1X3RvX2xlMzIobnAtPnJ4X2J1Zl9zeik7
DQotCQlucC0+cnhfcmluZ1tpXS5uZXh0X2Rlc2MgPSB2aXJ0X3RvX2xlMzJk
ZXNjKCZucC0+cnhfcmluZ1tpKzFdKTsNCi0JCW5wLT5yeF9za2J1ZmZbaV0g
PSAwOw0KLQl9DQotCS8qIE1hcmsgdGhlIGxhc3QgZW50cnkgYXMgd3JhcHBp
bmcgdGhlIHJpbmcuICovDQotCW5wLT5yeF9yaW5nW2ktMV0ubmV4dF9kZXNj
ID0gdmlydF90b19sZTMyZGVzYygmbnAtPnJ4X3JpbmdbMF0pOw0KKwlkZXYt
PnRyYW5zX3N0YXJ0ID0gamlmZmllczsNCisJbnAtPnN0YXRzLnR4X2Vycm9y
cysrOw0KIA0KLQkvKiBGaWxsIGluIHRoZSBSeCBidWZmZXJzLiAgSGFuZGxl
IGFsbG9jYXRpb24gZmFpbHVyZSBncmFjZWZ1bGx5LiAqLw0KLQlmb3IgKGkg
PSAwOyBpIDwgUlhfUklOR19TSVpFOyBpKyspIHsNCi0JCXN0cnVjdCBza19i
dWZmICpza2IgPSBkZXZfYWxsb2Nfc2tiKG5wLT5yeF9idWZfc3opOw0KLQkJ
bnAtPnJ4X3NrYnVmZltpXSA9IHNrYjsNCi0JCWlmIChza2IgPT0gTlVMTCkN
Ci0JCQlicmVhazsNCi0JCXNrYi0+ZGV2ID0gZGV2OwkJCS8qIE1hcmsgYXMg
YmVpbmcgdXNlZCBieSB0aGlzIGRldmljZS4gKi8NCi0JCW5wLT5yeF9yaW5n
W2ldLmFkZHIgPSB2aXJ0X3RvX2xlMzJkZXNjKHNrYi0+dGFpbCk7DQotCQlu
cC0+cnhfcmluZ1tpXS5yeF9zdGF0dXMgPSBjcHVfdG9fbGUzMihEZXNjT3du
KTsNCi0JfQ0KLQlucC0+ZGlydHlfcnggPSAodW5zaWduZWQgaW50KShpIC0g
UlhfUklOR19TSVpFKTsNCi0NCi0JZm9yIChpID0gMDsgaSA8IFRYX1JJTkdf
U0laRTsgaSsrKSB7DQotCQlucC0+dHhfc2tidWZmW2ldID0gMDsNCi0JCW5w
LT50eF9yaW5nW2ldLnR4X3N0YXR1cyA9IDA7DQotCQlucC0+dHhfcmluZ1tp
XS5kZXNjX2xlbmd0aCA9IGNwdV90b19sZTMyKDB4MDBlMDgwMDApOw0KLQkJ
bnAtPnR4X3JpbmdbaV0ubmV4dF9kZXNjID0gdmlydF90b19sZTMyZGVzYygm
bnAtPnR4X3JpbmdbaSsxXSk7DQotCQlucC0+dHhfYnVmW2ldID0ga21hbGxv
YyhQS1RfQlVGX1NaLCBHRlBfS0VSTkVMKTsNCi0JfQ0KLQlucC0+dHhfcmlu
Z1tpLTFdLm5leHRfZGVzYyA9IHZpcnRfdG9fbGUzMmRlc2MoJm5wLT50eF9y
aW5nWzBdKTsNCisJLyogd2FrZSBxdWV1ZSAqLw0KKwljbGVhcl9iaXQoMCwg
KHZvaWQqKSZkZXYtPnRidXN5KTsNCisJbWFya19iaChORVRfQkgpOw0KIA0K
IAlyZXR1cm47DQogfQ0KQEAgLTEyMzMsNyArMTMzOSw2IEBADQogew0KIAls
b25nIGlvYWRkciA9IGRldi0+YmFzZV9hZGRyOw0KIAlzdHJ1Y3QgbmV0ZGV2
X3ByaXZhdGUgKm5wID0gKHN0cnVjdCBuZXRkZXZfcHJpdmF0ZSAqKWRldi0+
cHJpdjsNCi0JaW50IGk7DQogDQogCWRldi0+c3RhcnQgPSAwOw0KIAlkZXYt
PnRidXN5ID0gMTsNCkBAIC0xMjU1LDI3ICsxMzYwLDggQEANCiANCiAJZnJl
ZV9pcnEoZGV2LT5pcnEsIGRldik7DQogDQotCS8qIEZyZWUgYWxsIHRoZSBz
a2J1ZmZzIGluIHRoZSBSeCBxdWV1ZS4gKi8NCi0JZm9yIChpID0gMDsgaSA8
IFJYX1JJTkdfU0laRTsgaSsrKSB7DQotCQlucC0+cnhfcmluZ1tpXS5yeF9z
dGF0dXMgPSAwOw0KLQkJbnAtPnJ4X3JpbmdbaV0uYWRkciA9IDB4QkFERjAw
RDA7IC8qIEFuIGludmFsaWQgYWRkcmVzcy4gKi8NCi0JCWlmIChucC0+cnhf
c2tidWZmW2ldKSB7DQotI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IDB4MjAx
MDANCi0JCQlucC0+cnhfc2tidWZmW2ldLT5mcmVlID0gMTsNCi0jZW5kaWYN
Ci0JCQlkZXZfa2ZyZWVfc2tiKG5wLT5yeF9za2J1ZmZbaV0pOw0KLQkJfQ0K
LQkJbnAtPnJ4X3NrYnVmZltpXSA9IDA7DQotCX0NCi0JZm9yIChpID0gMDsg
aSA8IFRYX1JJTkdfU0laRTsgaSsrKSB7DQotCQlpZiAobnAtPnR4X3NrYnVm
ZltpXSkNCi0JCQlkZXZfa2ZyZWVfc2tiKG5wLT50eF9za2J1ZmZbaV0pOw0K
LQkJbnAtPnR4X3NrYnVmZltpXSA9IDA7DQotCQlpZiAobnAtPnR4X2J1Zltp
XSkgew0KLQkJCWtmcmVlKG5wLT50eF9idWZbaV0pOw0KLQkJCW5wLT50eF9i
dWZbaV0gPSAwOw0KLQkJfQ0KLQl9DQorCWZyZWVfcmJ1ZnMoZGV2KTsNCisJ
ZnJlZV90YnVmcyhkZXYpOw0KIA0KIAlNT0RfREVDX1VTRV9DT1VOVDsNCiAN
Cg==
---1463811328-996702575-998983601=:12686--
