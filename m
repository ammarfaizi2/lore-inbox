Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266858AbUAXCgZ (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 23 Jan 2004 21:36:25 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266851AbUAXCd2
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 23 Jan 2004 21:33:28 -0500
Received: from [62.38.242.193] ([62.38.242.193]:25472 "EHLO pfn1.pefnos")
	by vger.kernel.org with ESMTP id S264329AbUAXC3s (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 23 Jan 2004 21:29:48 -0500
From: "P. Christeas" <p_christ@hol.gr>
To: Vojtech Pavlik <vojtech@suse.cz>
Subject: Solved: atkbd w 2.6.2rc1 : HowTo for extra (inet) keys ?
Date: Sat, 24 Jan 2004 04:28:30 +0200
User-Agent: KMail/1.6
References: <200401232204.27819.p_christ@hol.gr> <20040123210953.GA12647@ucw.cz>
In-Reply-To: <20040123210953.GA12647@ucw.cz>
Cc: lkml <linux-kernel@vger.kernel.org>, omnibook@zurich.csail.mit.edu
MIME-Version: 1.0
Content-Disposition: inline
Content-Type: text/plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
Message-Id: <200401240428.30493.p_christ@hol.gr>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

After spending my evening on it :-(  I managed to find the correct keys for 
the Omnibook XE3: 
(I could only reverse-engineer the previous hack I 've had for it)
Download and hack the 'console-tools' package (from sourceforge, project 
"lct") so that 'setkeycodes' does accept keycodes >127.

Vojtech, is 512 the upper bound for <keycode> at setkeycodes?

Using 2.6.2-rc1, issue:
setkeycodes e071 236
setkeycodes e072 237
setkeycodes e073 238
setkeycodes e074 239

 so that the upper (near the screen) row of "internet" buttons is assigned to 
the keys X expect to receive.
e071 etc. can be found using 'showkey -s'
I still don't get where 236 came from (so that I could help other kbds, as 
well).


> On Fri, Jan 23, 2004 at 10:04:27PM +0200, P. Christeas wrote:
> > Hello again.
> > I just reverted my atkbd.c code to your version (Linus's tree) and
> > unfortunately have 4 keys 'missing' from my HP Omnibook XE3GC extra
> > "internet keys".
> > Question 1: Can I fix the table from userland, using some utility? That
> > is, can I upload an updated table into the kernel, so that I don't have
> > to reboot?
>
> 'setkeycodes' can do that.
>
> > Q 2: Do you have any HowTo/QA for that?
>
> Not yet, but I'll have to write one.
>
> > Q 3: Will that work under X? (which AFAIK reads the 'raw' codes)
>
> X needs to be set up as well. In 2.6, X doesn't get real raw codes but
> instead simulated raw codes generated by the kernel.
>
> > Q 4: It has been rather difficult for me to compute the scancodes needed
> > for the table. Could you put the "formula" onto the HowTo?
> >
> > FYI, the codes are:
> > "www": Unknown key pressed (translated set 2, code 0xf3 on
> > isa0060/serio0). "Mail":  Unknown key pressed (translated set 2, code
> > 0xf4 on isa0060/serio0). "Launch": Unknown key pressed (translated set 2,
> > code 0xf2 on isa0060/serio0). "Help":  Unknown key pressed (translated
> > set 2, code 0xf1 on isa0060/serio0).
>
> The formula for setkeycodes is:
>
> if (code > 0x100)
> 	you're out of luck, setkeycodes doesn't handle this yet;
> else if (code > 0x80)
> 	result = code - 0x80 + 0xe000;
> else
> 	result = code;
>
> And then you use 'setkeycodes result keycode',
>
> where keycode you find in include/linux/input.h.
