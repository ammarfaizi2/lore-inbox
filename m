Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S130387AbQLIK2I>; Sat, 9 Dec 2000 05:28:08 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S130508AbQLIK16>; Sat, 9 Dec 2000 05:27:58 -0500
Received: from adsl-63-195-162-81.dsl.snfc21.pacbell.net ([63.195.162.81]:53509
	"EHLO master.linux-ide.org") by vger.kernel.org with ESMTP
	id <S130387AbQLIK1r>; Sat, 9 Dec 2000 05:27:47 -0500
Date: Sat, 9 Dec 2000 01:57:13 -0800 (PST)
From: Andre Hedrick <andre@linux-ide.org>
To: Gerard Sharp <gsharp@ihug.co.nz>
cc: linux-kernel@vger.kernel.org
Subject: Re: HPT366 + SMP = slight corruption in 2.3.99 - 2.4.0-11
In-Reply-To: <3A31FEC9.B824E695@ihug.co.nz>
Message-ID: <Pine.LNX.4.10.10012090156060.5191-200000@master.linux-ide.org>
MIME-Version: 1.0
Content-Type: multipart/mixed; BOUNDARY="-1019260510-1900307650-976355833=:5191"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---1019260510-1900307650-976355833=:5191
Content-Type: text/plain; charset=us-ascii


This has the missing ide-pci code from 2.2.
It stablized my BP6 on the HPT core.

Cheers,

Andre Hedrick
CTO Timpanogas Research Group
EVP Linux Development, TRG
Linux ATA Development

---1019260510-1900307650-976355833=:5191
Content-Type: text/plain; charset=us-ascii; name="ide.2.4.0-t12-7.1207.patch.1"
Content-Transfer-Encoding: base64
Content-ID: <Pine.LNX.4.10.10012090157130.5191@master.linux-ide.org>
Content-Description: 
Content-Disposition: attachment; filename="ide.2.4.0-t12-7.1207.patch.1"

ZGlmZiAtdXJOIGxpbnV4LTIuNC4wLXQxMi03LXByaXN0aW5lL2RyaXZlcnMv
aWRlL2NzNTUzMC5jIGxpbnV4LTIuNC4wLXQxMi03L2RyaXZlcnMvaWRlL2Nz
NTUzMC5jDQotLS0gbGludXgtMi40LjAtdDEyLTctcHJpc3RpbmUvZHJpdmVy
cy9pZGUvY3M1NTMwLmMJVHVlIEp1biAyMCAwNzo1MjozNiAyMDAwDQorKysg
bGludXgtMi40LjAtdDEyLTcvZHJpdmVycy9pZGUvY3M1NTMwLmMJRnJpIERl
YyAgOCAwMDoxNDo1NSAyMDAwDQpAQCAtMjU3LDYgKzI1NywxNCBAQA0KIAl1
bnNpZ25lZCBzaG9ydCBwY2ljbWQgPSAwOw0KIAl1bnNpZ25lZCBsb25nIGZs
YWdzOw0KIA0KKyNpZiBkZWZpbmVkKERJU1BMQVlfQ1M1NTMwX1RJTUlOR1Mp
ICYmIGRlZmluZWQoQ09ORklHX1BST0NfRlMpDQorCWlmICghY3M1NTMwX3By
b2MpIHsNCisJCWNzNTUzMF9wcm9jID0gMTsNCisJCWJtaWRlX2RldiA9IGRl
djsNCisJCWNzNTUzMF9kaXNwbGF5X2luZm8gPSAmY3M1NTMwX2dldF9pbmZv
Ow0KKwl9DQorI2VuZGlmIC8qIERJU1BMQVlfQ1M1NTMwX1RJTUlOR1MgJiYg
Q09ORklHX1BST0NfRlMgKi8NCisNCiAJcGNpX2Zvcl9lYWNoX2RldiAoZGV2
KSB7DQogCQlpZiAoZGV2LT52ZW5kb3IgPT0gUENJX1ZFTkRPUl9JRF9DWVJJ
WCkgew0KIAkJCXN3aXRjaCAoZGV2LT5kZXZpY2UpIHsNCkBAIC0zMjYsMTQg
KzMzNCw2IEBADQogCXBjaV93cml0ZV9jb25maWdfYnl0ZShtYXN0ZXJfMCwg
MHg0MywgMHhjMSk7DQogDQogCXJlc3RvcmVfZmxhZ3MoZmxhZ3MpOw0KLQ0K
LSNpZiBkZWZpbmVkKERJU1BMQVlfQ1M1NTMwX1RJTUlOR1MpICYmIGRlZmlu
ZWQoQ09ORklHX1BST0NfRlMpDQotCWlmICghY3M1NTMwX3Byb2MpIHsNCi0J
CWNzNTUzMF9wcm9jID0gMTsNCi0JCWJtaWRlX2RldiA9IGRldjsNCi0JCWNz
NTUzMF9kaXNwbGF5X2luZm8gPSAmY3M1NTMwX2dldF9pbmZvOw0KLQl9DQot
I2VuZGlmIC8qIERJU1BMQVlfQ1M1NTMwX1RJTUlOR1MgJiYgQ09ORklHX1BS
T0NfRlMgKi8NCiANCiAJcmV0dXJuIDA7DQogfQ0KZGlmZiAtdXJOIGxpbnV4
LTIuNC4wLXQxMi03LXByaXN0aW5lL2RyaXZlcnMvaWRlL2hwdDM2Ni5jIGxp
bnV4LTIuNC4wLXQxMi03L2RyaXZlcnMvaWRlL2hwdDM2Ni5jDQotLS0gbGlu
dXgtMi40LjAtdDEyLTctcHJpc3RpbmUvZHJpdmVycy9pZGUvaHB0MzY2LmMJ
VHVlIE5vdiAgNyAxMTowMjoyNCAyMDAwDQorKysgbGludXgtMi40LjAtdDEy
LTcvZHJpdmVycy9pZGUvaHB0MzY2LmMJRnJpIERlYyAgOCAwMDoxNDo1NSAy
MDAwDQpAQCAtMzQ2LDYgKzM0Niw5IEBADQogDQogc3RhdGljIGludCBocHQz
eHhfdHVuZV9jaGlwc2V0IChpZGVfZHJpdmVfdCAqZHJpdmUsIGJ5dGUgc3Bl
ZWQpDQogew0KKwlpZiAoKGRyaXZlLT5tZWRpYSAhPSBpZGVfZGlzaykgJiYg
KHNwZWVkIDwgWEZFUl9TV19ETUFfMCkpDQorCQlyZXR1cm4gLTE7DQorDQog
CWlmICghZHJpdmUtPmluaXRfc3BlZWQpDQogCQlkcml2ZS0+aW5pdF9zcGVl
ZCA9IHNwZWVkOw0KIA0KQEAgLTQyOCw2ICs0MzEsOSBAQA0KIAlieXRlIHVs
dHJhNjYJCT0gZWlnaHR5X25pbnR5X3RocmVlKGRyaXZlKTsNCiAJaW50ICBy
dmFsOw0KIA0KKwlpZiAoKGRyaXZlLT5tZWRpYSAhPSBpZGVfZGlzaykgJiYg
KHNwZWVkIDwgWEZFUl9TV19ETUFfMCkpDQorCQlyZXR1cm4gKChpbnQpIGlk
ZV9kbWFfb2ZmX3F1aWV0bHkpOw0KKw0KIAlpZiAoKGlkLT5kbWFfdWx0cmEg
JiAweDAwMjApICYmDQogCSAgICAoIWNoZWNrX2luX2RyaXZlX2xpc3RzKGRy
aXZlLCBiYWRfYXRhMTAwXzUpKSAmJg0KIAkgICAgKEhQVDM3MF9BTExPV19B
VEExMDBfNSkgJiYNCkBAIC02MTcsOCArNjIzLDE0IEBADQogCQlwY2lfd3Jp
dGVfY29uZmlnX2J5dGUoZGV2LCBQQ0lfUk9NX0FERFJFU1MsIGRldi0+cmVz
b3VyY2VbUENJX1JPTV9SRVNPVVJDRV0uc3RhcnQgfCBQQ0lfUk9NX0FERFJF
U1NfRU5BQkxFKTsNCiANCiAJcGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBQ
Q0lfQ0FDSEVfTElORV9TSVpFLCAmdGVzdCk7DQorDQorI2lmIDANCiAJaWYg
KHRlc3QgIT0gMHgwOCkNCiAJCXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYs
IFBDSV9DQUNIRV9MSU5FX1NJWkUsIDB4MDgpOw0KKyNlbHNlDQorCWlmICh0
ZXN0ICE9IChMMV9DQUNIRV9CWVRFUyAvIDQpKQ0KKwkJcGNpX3dyaXRlX2Nv
bmZpZ19ieXRlKGRldiwgUENJX0NBQ0hFX0xJTkVfU0laRSwgKEwxX0NBQ0hF
X0JZVEVTIC8gNCkpOw0KKyNlbmRpZg0KIA0KIAlwY2lfcmVhZF9jb25maWdf
Ynl0ZShkZXYsIFBDSV9MQVRFTkNZX1RJTUVSLCAmdGVzdCk7DQogCWlmICh0
ZXN0ICE9IDB4NzgpDQpkaWZmIC11ck4gbGludXgtMi40LjAtdDEyLTctcHJp
c3RpbmUvZHJpdmVycy9pZGUvaWRlLWRtYS5jIGxpbnV4LTIuNC4wLXQxMi03
L2RyaXZlcnMvaWRlL2lkZS1kbWEuYw0KLS0tIGxpbnV4LTIuNC4wLXQxMi03
LXByaXN0aW5lL2RyaXZlcnMvaWRlL2lkZS1kbWEuYwlUaHUgSnVsIDI3IDE2
OjQwOjU3IDIwMDANCisrKyBsaW51eC0yLjQuMC10MTItNy9kcml2ZXJzL2lk
ZS9pZGUtZG1hLmMJRnJpIERlYyAgOCAwMDo1MDowNCAyMDAwDQpAQCAtOTAs
NiArOTAsOCBAQA0KICNpbmNsdWRlIDxhc20vaW8uaD4NCiAjaW5jbHVkZSA8
YXNtL2lycS5oPg0KIA0KKyN1bmRlZiBDT05GSUdfQkxLX0RFVl9JREVETUFf
VElNRU9VVA0KKw0KIGV4dGVybiBjaGFyICppZGVfZG1hZnVuY192ZXJib3Nl
KGlkZV9kbWFfYWN0aW9uX3QgZG1hZnVuYyk7DQogDQogI2lmZGVmIENPTkZJ
R19JREVETUFfTkVXX0RSSVZFX0xJU1RJTkdTDQpAQCAtNTE1LDkgKzUxNywx
NyBAQA0KIAkJCXJldHVybiBjaGVja19kcml2ZV9saXN0cyhkcml2ZSwgKGZ1
bmMgPT0gaWRlX2RtYV9nb29kX2RyaXZlKSk7DQogCQljYXNlIGlkZV9kbWFf
dmVyYm9zZToNCiAJCQlyZXR1cm4gcmVwb3J0X2RyaXZlX2RtYWluZyhkcml2
ZSk7DQorCQljYXNlIGlkZV9kbWFfdGltZW91dDoNCisjaWZkZWYgQ09ORklH
X0JMS19ERVZfSURFRE1BX1RJTUVPVVQNCisJCQkvKg0KKwkJCSAqIEhhdmUg
dG8gaXNzdWUgYW4gYWJvcnQgYW5kIHJlcXVldWUgdGhlIHJlcXVlc3QNCisJ
CQkgKiBETUEgZW5naW5lIGdvdCB0dXJuZWQgb2ZmIGJ5IGEgZ29vZnkgQVNJ
QywgYW5kDQorCQkJICogd2UgaGF2ZSB0byBjbGVhbiB1cCB0aGUgbWVzcywg
YW5kIGhlcmUgaXMgYXMgZ29vZA0KKwkJCSAqIGFzIGFueS4gIERvIGl0IGds
b2JhbGx5IGZvciBhbGwgY2hpcHNldHMuDQorCQkJICovDQorI2VuZGlmIC8q
IENPTkZJR19CTEtfREVWX0lERURNQV9USU1FT1VUICovDQogCQljYXNlIGlk
ZV9kbWFfcmV0dW5lOg0KIAkJY2FzZSBpZGVfZG1hX2xvc3RpcnE6DQotCQlj
YXNlIGlkZV9kbWFfdGltZW91dDoNCiAJCQlwcmludGsoImlkZV9kbWFwcm9j
OiBjaGlwc2V0IHN1cHBvcnRlZCAlcyBmdW5jIG9ubHk6ICVkXG4iLCBpZGVf
ZG1hZnVuY192ZXJib3NlKGZ1bmMpLCAgZnVuYyk7DQogCQkJcmV0dXJuIDE7
DQogCQlkZWZhdWx0Og0KZGlmZiAtdXJOIGxpbnV4LTIuNC4wLXQxMi03LXBy
aXN0aW5lL2RyaXZlcnMvaWRlL2lkZS1wY2kuYyBsaW51eC0yLjQuMC10MTIt
Ny9kcml2ZXJzL2lkZS9pZGUtcGNpLmMNCi0tLSBsaW51eC0yLjQuMC10MTIt
Ny1wcmlzdGluZS9kcml2ZXJzL2lkZS9pZGUtcGNpLmMJVHVlIE5vdiAgNyAx
MTowMjoyNCAyMDAwDQorKysgbGludXgtMi40LjAtdDEyLTcvZHJpdmVycy9p
ZGUvaWRlLXBjaS5jCUZyaSBEZWMgIDggMDA6MTQ6NTUgMjAwMA0KQEAgLTc1
Myw2ICs3NTMsMTIgQEANCiAJCQlpZiAoaHB0MzYzX3NoYXJlZF9waW4gJiYg
aHB0MzYzX3NoYXJlZF9pcnEpIHsNCiAJCQkJZC0+Ym9vdGFibGUgPSBPTl9C
T0FSRDsNCiAJCQkJcHJpbnRrKCIlczogb25ib2FyZCB2ZXJzaW9uIG9mIGNo
aXBzZXQsIHBpbjE9JWQgcGluMj0lZFxuIiwgZC0+bmFtZSwgcGluMSwgcGlu
Mik7DQorI2lmIDENCisJCQkJLyogSSBmb3Jnb3Qgd2h5IEkgZGlkIHRoaXMg
b25jZSwgYnV0IGl0IGZpeGVkIHNvbWV0aGluZy4gKi8NCisJCQkJcGNpX3dy
aXRlX2NvbmZpZ19ieXRlKGRldjIsIFBDSV9JTlRFUlJVUFRfUElOLCBkZXYt
PmlycSk7DQorCQkJCXByaW50aygiUENJOiAlczogRml4aW5nIGludGVycnVw
dCAlZCBwaW4gJWQgdG8gWkVSTyBcbiIsIGQtPm5hbWUsIGRldjItPmlycSwg
cGluMik7DQorCQkJCXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYyLCBQQ0lf
SU5URVJSVVBUX0xJTkUsIDApOw0KKyNlbmRpZg0KIAkJCX0NCiAJCQlicmVh
azsNCiAJCX0NCmRpZmYgLXVyTiBsaW51eC0yLjQuMC10MTItNy1wcmlzdGlu
ZS9kcml2ZXJzL2lkZS9vc2I0LmMgbGludXgtMi40LjAtdDEyLTcvZHJpdmVy
cy9pZGUvb3NiNC5jDQotLS0gbGludXgtMi40LjAtdDEyLTctcHJpc3RpbmUv
ZHJpdmVycy9pZGUvb3NiNC5jCVRodSBPY3QgMjYgMTQ6MTE6MzkgMjAwMA0K
KysrIGxpbnV4LTIuNC4wLXQxMi03L2RyaXZlcnMvaWRlL29zYjQuYwlGcmkg
RGVjICA4IDAwOjE0OjU2IDIwMDANCkBAIC02MCwxNCArNjAsMTMgQEANCiAj
aW5jbHVkZSA8bGludXgvc3RhdC5oPg0KICNpbmNsdWRlIDxsaW51eC9wcm9j
X2ZzLmg+DQogDQotc3RhdGljIGJ5dGUgb3NiNF9yZXZpc2lvbiA9IDA7DQog
c3RhdGljIHN0cnVjdCBwY2lfZGV2ICpibWlkZV9kZXY7DQogDQotc3RhdGlj
IGludCBvc2I0X2dldF9pbmZvKGNoYXIgKiwgY2hhciAqKiwgb2ZmX3QsIGlu
dCwgaW50KTsNCi1leHRlcm4gaW50ICgqb3NiNF9kaXNwbGF5X2luZm8pKGNo
YXIgKiwgY2hhciAqKiwgb2ZmX3QsIGludCwgaW50KTsgLyogaWRlLXByb2Mu
YyAqLw0KK3N0YXRpYyBpbnQgb3NiNF9nZXRfaW5mbyhjaGFyICosIGNoYXIg
KiosIG9mZl90LCBpbnQpOw0KK2V4dGVybiBpbnQgKCpvc2I0X2Rpc3BsYXlf
aW5mbykoY2hhciAqLCBjaGFyICoqLCBvZmZfdCwgaW50KTsgLyogaWRlLXBy
b2MuYyAqLw0KIGV4dGVybiBjaGFyICppZGVfbWVkaWFfdmVyYm9zZShpZGVf
ZHJpdmVfdCAqKTsNCiANCi1zdGF0aWMgaW50IG9zYjRfZ2V0X2luZm8gKGNo
YXIgKmJ1ZmZlciwgY2hhciAqKmFkZHIsIG9mZl90IG9mZnNldCwgaW50IGNv
dW50LCBpbnQgZHVtbXkpDQorc3RhdGljIGludCBvc2I0X2dldF9pbmZvIChj
aGFyICpidWZmZXIsIGNoYXIgKiphZGRyLCBvZmZfdCBvZmZzZXQsIGludCBj
b3VudCkNCiB7DQogCWNoYXIgKnAgPSBidWZmZXI7DQogCXUzMiBiaWJtYSA9
IHBjaV9yZXNvdXJjZV9zdGFydChibWlkZV9kZXYsIDQpOw0KQEAgLTExMywx
MTYgKzExMiwyMDIgQEANCiB9DQogI2VuZGlmICAvKiBkZWZpbmVkKERJU1BM
QVlfT1NCNF9USU1JTkdTKSAmJiBkZWZpbmVkKENPTkZJR19QUk9DX0ZTKSAq
Lw0KIA0KK3N0YXRpYyBieXRlIG9zYjRfcmV2aXNpb24gPSAwOw0KKw0KIGJ5
dGUgb3NiNF9wcm9jID0gMDsNCiANCiBleHRlcm4gY2hhciAqaWRlX3hmZXJf
dmVyYm9zZSAoYnl0ZSB4ZmVyX3JhdGUpOw0KIA0KLXN0YXRpYyB2b2lkIG9z
YjRfdHVuZV9kcml2ZSAoaWRlX2RyaXZlX3QgKmRyaXZlLCBieXRlIHBpbykN
Ci17DQotICAgICAgICAvKiBjb21tYW5kL3JlY292ZXIgd2lkdGhzICovDQot
CWJ5dGUgdGltaW5nc1tdCT0geyAweDVkLCAweDQ3LCAweDM0LCAweDIyLCAw
eDIwIH07DQotCWludCBwb3J0CQk9IEhXSUYoZHJpdmUpLT5pbmRleCA/IDB4
NDIgOiAweDQwOw0KLQ0KLQlwaW8gPSBpZGVfZ2V0X2Jlc3RfcGlvX21vZGUo
ZHJpdmUsIHBpbywgNCwgTlVMTCk7DQotCWlmICgmSFdJRihkcml2ZSktPmRy
aXZlc1swXSA9PSBkcml2ZSkgIC8qIG1hc3RlciBkcml2ZSAqLw0KLQkJcG9y
dCsrOw0KLQlwY2lfd3JpdGVfY29uZmlnX2J5dGUoSFdJRihkcml2ZSktPnBj
aV9kZXYsIHBvcnQsIHRpbWluZ3NbcGlvXSk7DQotfQ0KK3N0YXRpYyBzdHJ1
Y3QgcGNpX2RldiAqaXNhX2RldjsNCiANCi0jaWYgZGVmaW5lZChDT05GSUdf
QkxLX0RFVl9JREVETUEpICYmIGRlZmluZWQoQ09ORklHX0JMS19ERVZfT1NC
NCkNCiBzdGF0aWMgaW50IG9zYjRfdHVuZV9jaGlwc2V0IChpZGVfZHJpdmVf
dCAqZHJpdmUsIGJ5dGUgc3BlZWQpDQogew0KKwlieXRlIHVkbWFfbW9kZXNb
XQk9IHsgMHgwMCwgMHgwMSwgMHgwMiB9Ow0KKwlieXRlIGRtYV9tb2Rlc1td
CT0geyAweDc3LCAweDIxLCAweDIwIH07DQorCWJ5dGUgcGlvX21vZGVzW10J
PSB7IDB4NWQsIDB4NDcsIDB4MzQsIDB4MjIsIDB4MjAgfTsNCisNCiAJaWRl
X2h3aWZfdCAqaHdpZgk9IEhXSUYoZHJpdmUpOw0KIAlzdHJ1Y3QgcGNpX2Rl
diAqZGV2CT0gaHdpZi0+cGNpX2RldjsNCi0JYnl0ZSBpc19zbGF2ZSAgICAg
ICAgICAgPSAoJkhXSUYoZHJpdmUpLT5kcml2ZXNbMV0gPT0gZHJpdmUpID8g
MSA6IDA7DQotCWJ5dGUgYml0OCwgZW5hYmxlOw0KLQlpbnQgZXJyOw0KLQkN
Ci0JLyogY2xlYXIgdWRtYSByZWdpc3RlciBpZiB3ZSBkb24ndCB3YW50IHVk
bWEgKi8NCi0JaWYgKHNwZWVkIDwgWEZFUl9VRE1BXzApIHsNCi0JCWVuYWJs
ZSA9IDB4MSA8PCAoaXNfc2xhdmUgKyAoaHdpZi0+Y2hhbm5lbCA/IDIgOiAw
KSk7DQotCQlwY2lfcmVhZF9jb25maWdfYnl0ZShkZXYsIDB4NTQsICZiaXQ4
KTsNCi0JCXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYsIDB4NTQsIGJpdDgg
JiB+ZW5hYmxlKTsNCi0JfQ0KLQ0KKwlieXRlIHVuaXQJCT0gKGRyaXZlLT5z
ZWxlY3QuYi51bml0ICYgMHgwMSk7DQogI2lmZGVmIENPTkZJR19CTEtfREVW
X0lERURNQQ0KLQlpZiAoc3BlZWQgPj0gWEZFUl9NV19ETUFfMCkgew0KLQkJ
Ynl0ZSBjaGFubmVsID0gaHdpZi0+Y2hhbm5lbCA/IDB4NDYgOiAweDQ0Ow0K
LQkJaWYgKCFpc19zbGF2ZSkNCi0JCQljaGFubmVsKys7DQorCXVuc2lnbmVk
IGxvbmcgZG1hX2Jhc2UJPSBod2lmLT5kbWFfYmFzZTsNCisjZW5kaWYgLyog
Q09ORklHX0JMS19ERVZfSURFRE1BICovDQorCWludCBlcnI7DQogDQotCQlz
d2l0Y2ggKHNwZWVkKSB7DQotCQljYXNlIFhGRVJfTVdfRE1BXzA6DQotCQkJ
Yml0OCA9IDB4Nzc7DQotCQkJYnJlYWs7DQotCQljYXNlIFhGRVJfTVdfRE1B
XzE6DQotCQkJYml0OCA9IDB4MjE7DQotCQkJYnJlYWs7DQotCQljYXNlIFhG
RVJfTVdfRE1BXzI6DQorCWJ5dGUgZHJpdmVfcGNpCQk9IDB4MDA7DQorCWJ5
dGUgZHJpdmVfcGNpMgkJPSAweDAwOw0KKwlieXRlIGRyaXZlX3BjaTMJCT0g
aHdpZi0+Y2hhbm5lbCA/IDB4NTcgOiAweDU2Ow0KKw0KKwlieXRlIHVsdHJh
X2VuYWJsZQk9IDB4MDA7DQorCWJ5dGUgdWx0cmFfdGltaW5nCT0gMHgwMDsN
CisJYnl0ZSBkbWFfdGltaW5nCQk9IDB4MDA7DQorCWJ5dGUgcGlvX3RpbWlu
ZwkJPSAweDAwOw0KKw0KKwlieXRlIHBpbwk9IGlkZV9nZXRfYmVzdF9waW9f
bW9kZShkcml2ZSwgMjU1LCA1LCBOVUxMKTsNCisNCisgICAgICAgIHN3aXRj
aCAoZHJpdmUtPmRuKSB7DQorCQljYXNlIDA6IGRyaXZlX3BjaSA9IDB4NDE7
IGRyaXZlX3BjaTIgPSAweDQ1OyBicmVhazsNCisJCWNhc2UgMTogZHJpdmVf
cGNpID0gMHg0MDsgZHJpdmVfcGNpMiA9IDB4NDQ7IGJyZWFrOw0KKwkJY2Fz
ZSAyOiBkcml2ZV9wY2kgPSAweDQzOyBkcml2ZV9wY2kyID0gMHg0NzsgYnJl
YWs7DQorCQljYXNlIDM6IGRyaXZlX3BjaSA9IDB4NDI7IGRyaXZlX3BjaTIg
PSAweDQ2OyBicmVhazsNCiAJCWRlZmF1bHQ6DQotCQkJYml0OCA9IDB4MjA7
DQotCQkJYnJlYWs7DQotCQl9DQotCQlwY2lfd3JpdGVfY29uZmlnX2J5dGUo
ZGV2LCBjaGFubmVsLCBiaXQ4KTsNCisJCQlyZXR1cm4gLTE7DQogCX0NCiAN
Ci0JaWYgKHNwZWVkID49IFhGRVJfVURNQV8wKSB7DQotCQlieXRlIGNoYW5u
ZWwgPSBod2lmLT5jaGFubmVsID8gMHg1NyA6IDB4NTY7DQotCQlpbnQgc2xh
dmUgPSBpc19zbGF2ZSA/IDQgOiAwOw0KKwlwY2lfcmVhZF9jb25maWdfYnl0
ZShkZXYsIGRyaXZlX3BjaSwgJnBpb190aW1pbmcpOw0KKwlwY2lfcmVhZF9j
b25maWdfYnl0ZShkZXYsIGRyaXZlX3BjaTIsICZkbWFfdGltaW5nKTsNCisJ
cGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBkcml2ZV9wY2kzLCAmdWx0cmFf
dGltaW5nKTsNCisJcGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCAweDU0LCAm
dWx0cmFfZW5hYmxlKTsNCisNCisjaWZkZWYgREVCVUcNCisJcHJpbnRrKCIl
czogVURNQSAweCUwMnggRE1BUElPIDB4JTAyeCBQSU8gMHglMDJ4ICIsDQor
CQlkcml2ZS0+bmFtZSwgdWx0cmFfdGltaW5nLCBkbWFfdGltaW5nLCBwaW9f
dGltaW5nKTsNCisjZW5kaWYNCiANCi0JCXBjaV9yZWFkX2NvbmZpZ19ieXRl
KGRldiwgY2hhbm5lbCwgJmJpdDgpOw0KLQkJYml0OCAmPSB+KDB4ZiA8PCBz
bGF2ZSk7DQotCQlzd2l0Y2ggKHNwZWVkKSB7DQotCQljYXNlIFhGRVJfVURN
QV8wOg0KKwlwaW9fdGltaW5nCSY9IH4weEZGOw0KKwlkbWFfdGltaW5nCSY9
IH4weEZGOw0KKwl1bHRyYV90aW1pbmcJJj0gfigweDBGIDw8ICg0KnVuaXQp
KTsNCisJdWx0cmFfZW5hYmxlCSY9IH4oMHgwMSA8PCBkcml2ZS0+ZG4pOw0K
Kw0KKwlzd2l0Y2goc3BlZWQpIHsNCisJCWNhc2UgWEZFUl9QSU9fNDoNCisJ
CWNhc2UgWEZFUl9QSU9fMzoNCisJCWNhc2UgWEZFUl9QSU9fMjoNCisJCWNh
c2UgWEZFUl9QSU9fMToNCisJCWNhc2UgWEZFUl9QSU9fMDoNCisJCQlwaW9f
dGltaW5nIHw9IHBpb19tb2Rlc1tzcGVlZCAtIFhGRVJfUElPXzBdOw0KIAkJ
CWJyZWFrOw0KLQkJY2FzZSBYRkVSX1VETUFfMToNCi0JCQliaXQ4IHw9IDB4
MSA8PCBzbGF2ZTsNCisjaWZkZWYgQ09ORklHX0JMS19ERVZfSURFRE1BDQor
CQljYXNlIFhGRVJfTVdfRE1BXzI6DQorCQljYXNlIFhGRVJfTVdfRE1BXzE6
DQorCQljYXNlIFhGRVJfTVdfRE1BXzA6DQorCQkJcGlvX3RpbWluZyB8PSBw
aW9fbW9kZXNbcGlvXTsNCisJCQlkbWFfdGltaW5nIHw9IGRtYV9tb2Rlc1tz
cGVlZCAtIFhGRVJfTVdfRE1BXzBdOw0KIAkJCWJyZWFrOw0KKw0KKy8vCQlj
YXNlIFhGRVJfVURNQV81Og0KKy8vCQljYXNlIFhGRVJfVURNQV80Og0KKy8v
CQljYXNlIFhGRVJfVURNQV8zOg0KIAkJY2FzZSBYRkVSX1VETUFfMjoNCisJ
CWNhc2UgWEZFUl9VRE1BXzE6DQorCQljYXNlIFhGRVJfVURNQV8wOg0KKwkJ
CXBpb190aW1pbmcgfD0gcGlvX21vZGVzW3Bpb107DQorCQkJZG1hX3RpbWlu
ZyB8PSBkbWFfbW9kZXNbMl07DQorCQkJdWx0cmFfdGltaW5nIHw9ICgodWRt
YV9tb2Rlc1tzcGVlZCAtIFhGRVJfVURNQV8wXSkgPDwgKDQqdW5pdCkpOw0K
KwkJCXVsdHJhX2VuYWJsZSB8PSAoMHgwMSA8PCBkcml2ZS0+ZG4pOw0KKyNl
bmRpZg0KIAkJZGVmYXVsdDoNCi0JCQliaXQ4IHw9IDB4MiA8PCBzbGF2ZTsN
CiAJCQlicmVhazsNCi0JCX0NCi0JCXBjaV93cml0ZV9jb25maWdfYnl0ZShk
ZXYsIGNoYW5uZWwsIGJpdDgpOw0KLQ0KLQkJZW5hYmxlID0gMHgxIDw8IChp
c19zbGF2ZSArIChod2lmLT5jaGFubmVsID8gMiA6IDApKTsNCi0JCXBjaV9y
ZWFkX2NvbmZpZ19ieXRlKGRldiwgMHg1NCwgJmJpdDgpOw0KLQkJcGNpX3dy
aXRlX2NvbmZpZ19ieXRlKGRldiwgMHg1NCwgYml0OCB8IGVuYWJsZSk7DQog
CX0NCisNCisjaWZkZWYgREVCVUcNCisJcHJpbnRrKCIlczogVURNQSAweCUw
MnggRE1BUElPIDB4JTAyeCBQSU8gMHglMDJ4ICIsDQorCQlkcml2ZS0+bmFt
ZSwgdWx0cmFfdGltaW5nLCBkbWFfdGltaW5nLCBwaW9fdGltaW5nKTsNCiAj
ZW5kaWYNCiANCiAjaWYgT1NCNF9ERUJVR19EUklWRV9JTkZPDQogCXByaW50
aygiJXM6ICVzIGRyaXZlJWRcbiIsIGRyaXZlLT5uYW1lLCBpZGVfeGZlcl92
ZXJib3NlKHNwZWVkKSwgZHJpdmUtPmRuKTsNCiAjZW5kaWYgLyogT1NCNF9E
RUJVR19EUklWRV9JTkZPICovDQorDQogCWlmICghZHJpdmUtPmluaXRfc3Bl
ZWQpDQogCQlkcml2ZS0+aW5pdF9zcGVlZCA9IHNwZWVkOw0KKw0KKwlwY2lf
d3JpdGVfY29uZmlnX2J5dGUoZGV2LCBkcml2ZV9wY2ksIHBpb190aW1pbmcp
Ow0KKyNpZmRlZiBDT05GSUdfQkxLX0RFVl9JREVETUENCisJcGNpX3dyaXRl
X2NvbmZpZ19ieXRlKGRldiwgZHJpdmVfcGNpMiwgZG1hX3RpbWluZyk7DQor
CXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYsIGRyaXZlX3BjaTMsIHVsdHJh
X3RpbWluZyk7DQorCXBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYsIDB4NTQs
IHVsdHJhX2VuYWJsZSk7DQorCQ0KKwlpZiAoc3BlZWQgPiBYRkVSX1BJT180
KSB7DQorCQlvdXRiKGluYihkbWFfYmFzZSsyKXwoMTw8KDUrdW5pdCkpLCBk
bWFfYmFzZSsyKTsNCisJfSBlbHNlIHsNCisJCW91dGIoaW5iKGRtYV9iYXNl
KzIpICYgfigxPDwoNSt1bml0KSksIGRtYV9iYXNlKzIpOw0KKwl9DQorI2Vu
ZGlmIC8qIENPTkZJR19CTEtfREVWX0lERURNQSAqLw0KKw0KIAllcnIgPSBp
ZGVfY29uZmlnX2RyaXZlX3NwZWVkKGRyaXZlLCBzcGVlZCk7DQogCWRyaXZl
LT5jdXJyZW50X3NwZWVkID0gc3BlZWQ7DQogCXJldHVybiBlcnI7DQogfQ0K
IA0KLXN0YXRpYyBpbnQgb3NiNF9jb25maWdfZHJpdmVfZm9yX2RtYSAoaWRl
X2RyaXZlX3QgKmRyaXZlKQ0KK3N0YXRpYyB2b2lkIGNvbmZpZ19jaGlwc2V0
X2Zvcl9waW8gKGlkZV9kcml2ZV90ICpkcml2ZSkNCit7DQorCXVuc2lnbmVk
IHNob3J0IGVpZGVfcGlvX3RpbWluZ1s2XSA9IHs5NjAsIDQ4MCwgMjQwLCAx
ODAsIDEyMCwgOTB9Ow0KKwl1bnNpZ25lZCBzaG9ydCB4ZmVyX3BpbyA9IGRy
aXZlLT5pZC0+ZWlkZV9waW9fbW9kZXM7DQorCWJ5dGUJCQl0aW1pbmcsIHNw
ZWVkLCBwaW87DQorDQorCXBpbyA9IGlkZV9nZXRfYmVzdF9waW9fbW9kZShk
cml2ZSwgMjU1LCA1LCBOVUxMKTsNCisNCisJaWYgKHhmZXJfcGlvPiA0KQ0K
KwkJeGZlcl9waW8gPSAwOw0KKw0KKwlpZiAoZHJpdmUtPmlkLT5laWRlX3Bp
b19pb3JkeSA+IDApIHsNCisJCWZvciAoeGZlcl9waW8gPSA1Ow0KKwkJCXhm
ZXJfcGlvPjAgJiYNCisJCQlkcml2ZS0+aWQtPmVpZGVfcGlvX2lvcmR5PmVp
ZGVfcGlvX3RpbWluZ1t4ZmVyX3Bpb107DQorCQkJeGZlcl9waW8tLSk7DQor
CX0gZWxzZSB7DQorCQl4ZmVyX3BpbyA9IChkcml2ZS0+aWQtPmVpZGVfcGlv
X21vZGVzICYgNCkgPyAweDA1IDoNCisJCQkgICAoZHJpdmUtPmlkLT5laWRl
X3Bpb19tb2RlcyAmIDIpID8gMHgwNCA6DQorCQkJICAgKGRyaXZlLT5pZC0+
ZWlkZV9waW9fbW9kZXMgJiAxKSA/IDB4MDMgOg0KKwkJCSAgIChkcml2ZS0+
aWQtPnRQSU8gJiAyKSA/IDB4MDIgOg0KKwkJCSAgIChkcml2ZS0+aWQtPnRQ
SU8gJiAxKSA/IDB4MDEgOiB4ZmVyX3BpbzsNCisJfQ0KKw0KKwl0aW1pbmcg
PSAoeGZlcl9waW8gPj0gcGlvKSA/IHhmZXJfcGlvIDogcGlvOw0KKw0KKwlz
d2l0Y2godGltaW5nKSB7DQorCQljYXNlIDQ6IHNwZWVkID0gWEZFUl9QSU9f
NDticmVhazsNCisJCWNhc2UgMzogc3BlZWQgPSBYRkVSX1BJT18zO2JyZWFr
Ow0KKwkJY2FzZSAyOiBzcGVlZCA9IFhGRVJfUElPXzI7YnJlYWs7DQorCQlj
YXNlIDE6IHNwZWVkID0gWEZFUl9QSU9fMTticmVhazsNCisJCWRlZmF1bHQ6
DQorCQkJc3BlZWQgPSAoIWRyaXZlLT5pZC0+dFBJTykgPyBYRkVSX1BJT18w
IDogWEZFUl9QSU9fU0xPVzsNCisJCQlicmVhazsNCisJfQ0KKwkodm9pZCkg
b3NiNF90dW5lX2NoaXBzZXQoZHJpdmUsIHNwZWVkKTsNCisJZHJpdmUtPmN1
cnJlbnRfc3BlZWQgPSBzcGVlZDsNCit9DQorDQorc3RhdGljIHZvaWQgb3Ni
NF90dW5lX2RyaXZlIChpZGVfZHJpdmVfdCAqZHJpdmUsIGJ5dGUgcGlvKQ0K
K3sNCisJYnl0ZSBzcGVlZDsNCisJc3dpdGNoKHBpbykgew0KKwkJY2FzZSA0
OgkJc3BlZWQgPSBYRkVSX1BJT180O2JyZWFrOw0KKwkJY2FzZSAzOgkJc3Bl
ZWQgPSBYRkVSX1BJT18zO2JyZWFrOw0KKwkJY2FzZSAyOgkJc3BlZWQgPSBY
RkVSX1BJT18yO2JyZWFrOw0KKwkJY2FzZSAxOgkJc3BlZWQgPSBYRkVSX1BJ
T18xO2JyZWFrOw0KKwkJZGVmYXVsdDoJc3BlZWQgPSBYRkVSX1BJT18wO2Jy
ZWFrOw0KKwl9DQorCSh2b2lkKSBvc2I0X3R1bmVfY2hpcHNldChkcml2ZSwg
c3BlZWQpOw0KK30NCisNCisjaWZkZWYgQ09ORklHX0JMS19ERVZfSURFRE1B
DQorc3RhdGljIGludCBjb25maWdfY2hpcHNldF9mb3JfZG1hIChpZGVfZHJp
dmVfdCAqZHJpdmUpDQogew0KIAlzdHJ1Y3QgaGRfZHJpdmVpZCAqaWQJPSBk
cml2ZS0+aWQ7DQogCWJ5dGUJCQlzcGVlZDsNCiANCisjaWYgMA0KIAlieXRl
IHVkbWFfNjYJCT0gZWlnaHR5X25pbnR5X3RocmVlKGRyaXZlKTsNCiAJLyog
bmVlZCBzcGVjcyB0byBmaWd1cmUgb3V0IGlmIG9zYjQgaXMgY2FwYWJsZSBv
ZiBhdGEvNjYvMTAwICovDQogCWludCB1bHRyYTEwMAkJPSAwOw0KIAlpbnQg
dWx0cmE2NgkJPSAwOw0KLQlpbnQgdWx0cmEJCT0gMTsNCiANCiAJaWYgKChp
ZC0+ZG1hX3VsdHJhICYgMHgwMDIwKSAmJiAodWRtYV82NikgJiYgKHVsdHJh
MTAwKSkgew0KIAkJc3BlZWQgPSBYRkVSX1VETUFfNTsNCi0JfSBlbHNlIGlm
ICgoaWQtPmRtYV91bHRyYSAmIDB4MDAxMCkgJiYgKHVsdHJhKSkgew0KKwl9
IGVsc2UgaWYgKGlkLT5kbWFfdWx0cmEgJiAweDAwMTApIHsNCiAJCXNwZWVk
ID0gKCh1ZG1hXzY2KSAmJiAodWx0cmE2NikpID8gWEZFUl9VRE1BXzQgOiBY
RkVSX1VETUFfMjsNCi0JfSBlbHNlIGlmICgoaWQtPmRtYV91bHRyYSAmIDB4
MDAwOCkgJiYgKHVsdHJhKSkgew0KKwl9IGVsc2UgaWYgKGlkLT5kbWFfdWx0
cmEgJiAweDAwMDgpIHsNCiAJCXNwZWVkID0gKCh1ZG1hXzY2KSAmJiAodWx0
cmE2NikpID8gWEZFUl9VRE1BXzMgOiBYRkVSX1VETUFfMTsNCi0JfSBlbHNl
IGlmICgoaWQtPmRtYV91bHRyYSAmIDB4MDAwNCkgJiYgKHVsdHJhKSkgew0K
Kwl9IGVsc2UgaWYgKGlkLT5kbWFfdWx0cmEgJiAweDAwMDQpIHsNCisjZWxz
ZQ0KKwlpZiAoaWQtPmRtYV91bHRyYSAmIDB4MDAwNCkgew0KKyNlbmRpZg0K
IAkJc3BlZWQgPSBYRkVSX1VETUFfMjsNCi0JfSBlbHNlIGlmICgoaWQtPmRt
YV91bHRyYSAmIDB4MDAwMikgJiYgKHVsdHJhKSkgew0KKwl9IGVsc2UgaWYg
KGlkLT5kbWFfdWx0cmEgJiAweDAwMDIpIHsNCiAJCXNwZWVkID0gWEZFUl9V
RE1BXzE7DQotCX0gZWxzZSBpZiAoKGlkLT5kbWFfdWx0cmEgJiAweDAwMDEp
ICYmICh1bHRyYSkpIHsNCisJfSBlbHNlIGlmIChpZC0+ZG1hX3VsdHJhICYg
MHgwMDAxKSB7DQogCQlzcGVlZCA9IFhGRVJfVURNQV8wOw0KIAl9IGVsc2Ug
aWYgKGlkLT5kbWFfbXdvcmQgJiAweDAwMDQpIHsNCiAJCXNwZWVkID0gWEZF
Ul9NV19ETUFfMjsNCkBAIC0yNDMsNDUgKzMyOCw4NyBAQA0KIAkJCQkJCSAg
ICAgaWRlX2RtYV9vZmZfcXVpZXRseSk7DQogfQ0KIA0KK3N0YXRpYyBpbnQg
Y29uZmlnX2RyaXZlX3hmZXJfcmF0ZSAoaWRlX2RyaXZlX3QgKmRyaXZlKQ0K
K3sNCisJc3RydWN0IGhkX2RyaXZlaWQgKmlkID0gZHJpdmUtPmlkOw0KKwlp
ZGVfZG1hX2FjdGlvbl90IGRtYV9mdW5jID0gaWRlX2RtYV9vbjsNCisNCisJ
aWYgKGlkICYmIChpZC0+Y2FwYWJpbGl0eSAmIDEpICYmIEhXSUYoZHJpdmUp
LT5hdXRvZG1hKSB7DQorCQkvKiBDb25zdWx0IHRoZSBsaXN0IG9mIGtub3du
ICJiYWQiIGRyaXZlcyAqLw0KKwkJaWYgKGlkZV9kbWFwcm9jKGlkZV9kbWFf
YmFkX2RyaXZlLCBkcml2ZSkpIHsNCisJCQlkbWFfZnVuYyA9IGlkZV9kbWFf
b2ZmOw0KKwkJCWdvdG8gZmFzdF9hdGFfcGlvOw0KKwkJfQ0KKwkJZG1hX2Z1
bmMgPSBpZGVfZG1hX29mZl9xdWlldGx5Ow0KKwkJaWYgKGlkLT5maWVsZF92
YWxpZCAmIDQpIHsNCisJCQlpZiAoaWQtPmRtYV91bHRyYSAmIDB4MDAyRikg
ew0KKwkJCQkvKiBGb3JjZSBpZiBDYXBhYmxlIFVsdHJhRE1BICovDQorCQkJ
CWRtYV9mdW5jID0gY29uZmlnX2NoaXBzZXRfZm9yX2RtYShkcml2ZSk7DQor
CQkJCWlmICgoaWQtPmZpZWxkX3ZhbGlkICYgMikgJiYNCisJCQkJICAgIChk
bWFfZnVuYyAhPSBpZGVfZG1hX29uKSkNCisJCQkJCWdvdG8gdHJ5X2RtYV9t
b2RlczsNCisJCQl9DQorCQl9IGVsc2UgaWYgKGlkLT5maWVsZF92YWxpZCAm
IDIpIHsNCit0cnlfZG1hX21vZGVzOg0KKwkJCWlmICgoaWQtPmRtYV9td29y
ZCAmIDB4MDAwNykgfHwNCisJCQkgICAgKGlkLT5kbWFfMXdvcmQgJiAweDAw
NykpIHsNCisJCQkJLyogRm9yY2UgaWYgQ2FwYWJsZSByZWd1bGFyIERNQSBt
b2RlcyAqLw0KKwkJCQlkbWFfZnVuYyA9IGNvbmZpZ19jaGlwc2V0X2Zvcl9k
bWEoZHJpdmUpOw0KKwkJCQlpZiAoZG1hX2Z1bmMgIT0gaWRlX2RtYV9vbikN
CisJCQkJCWdvdG8gbm9fZG1hX3NldDsNCisJCQl9DQorCQl9IGVsc2UgaWYg
KGlkZV9kbWFwcm9jKGlkZV9kbWFfZ29vZF9kcml2ZSwgZHJpdmUpKSB7DQor
CQkJaWYgKGlkLT5laWRlX2RtYV90aW1lID4gMTUwKSB7DQorCQkJCWdvdG8g
bm9fZG1hX3NldDsNCisJCQl9DQorCQkJLyogQ29uc3VsdCB0aGUgbGlzdCBv
ZiBrbm93biAiZ29vZCIgZHJpdmVzICovDQorCQkJZG1hX2Z1bmMgPSBjb25m
aWdfY2hpcHNldF9mb3JfZG1hKGRyaXZlKTsNCisJCQlpZiAoZG1hX2Z1bmMg
IT0gaWRlX2RtYV9vbikNCisJCQkJZ290byBub19kbWFfc2V0Ow0KKwkJfSBl
bHNlIHsNCisJCQlnb3RvIGZhc3RfYXRhX3BpbzsNCisJCX0NCisJfSBlbHNl
IGlmICgoaWQtPmNhcGFiaWxpdHkgJiA4KSB8fCAoaWQtPmZpZWxkX3ZhbGlk
ICYgMikpIHsNCitmYXN0X2F0YV9waW86DQorCQlkbWFfZnVuYyA9IGlkZV9k
bWFfb2ZmX3F1aWV0bHk7DQorbm9fZG1hX3NldDoNCisJCWNvbmZpZ19jaGlw
c2V0X2Zvcl9waW8oZHJpdmUpOw0KKwl9DQorCXJldHVybiBIV0lGKGRyaXZl
KS0+ZG1hcHJvYyhkbWFfZnVuYywgZHJpdmUpOw0KK30NCisNCiBzdGF0aWMg
aW50IG9zYjRfZG1hcHJvYyhpZGVfZG1hX2FjdGlvbl90IGZ1bmMsIGlkZV9k
cml2ZV90ICpkcml2ZSkNCiB7DQogCXN3aXRjaCAoZnVuYykgew0KIAkJY2Fz
ZSBpZGVfZG1hX2NoZWNrOg0KLQkJCSByZXR1cm4gaWRlX2RtYXByb2MoKGlk
ZV9kbWFfYWN0aW9uX3QpIG9zYjRfY29uZmlnX2RyaXZlX2Zvcl9kbWEoZHJp
dmUpLCBkcml2ZSk7DQorCQkJcmV0dXJuIGNvbmZpZ19kcml2ZV94ZmVyX3Jh
dGUoZHJpdmUpOw0KIAkJZGVmYXVsdCA6DQogCQkJYnJlYWs7DQogCX0NCiAJ
LyogT3RoZXIgY2FzZXMgYXJlIGRvbmUgYnkgZ2VuZXJpYyBJREUtRE1BIGNv
ZGUuICovDQogCXJldHVybiBpZGVfZG1hcHJvYyhmdW5jLCBkcml2ZSk7DQog
fQ0KLSNlbmRpZiAvKiBkZWZpbmVkKENPTkZJR19CTEtfREVWX0lERURNQSkg
JiYgKENPTkZJR19CTEtfREVWX09TQjQpICovDQorI2VuZGlmIC8qIENPTkZJ
R19CTEtfREVWX0lERURNQSAqLw0KIA0KIHVuc2lnbmVkIGludCBfX2luaXQg
cGNpX2luaXRfb3NiNCAoc3RydWN0IHBjaV9kZXYgKmRldiwgY29uc3QgY2hh
ciAqbmFtZSkNCiB7DQotCXUxNiB3b3JkOw0KLQlieXRlIGJpdDg7DQorCXVu
c2lnbmVkIGludCByZWc2NDsNCiANCiAJcGNpX3JlYWRfY29uZmlnX2J5dGUo
ZGV2LCBQQ0lfUkVWSVNJT05fSUQsICZvc2I0X3JldmlzaW9uKTsNCiANCi0J
Lyogc2V0dXAgY29tbWFuZCByZWdpc3Rlci4ganVzdCBtYWtlIHN1cmUgdGhh
dCBidXMgbWFzdGVyIGFuZA0KLQkgKiBpL28gcG9ydHMgYXJlIG9uLiAqLw0K
LQlwY2lfcmVhZF9jb25maWdfd29yZChkZXYsIFBDSV9DT01NQU5ELCAmd29y
ZCk7DQotCWlmICgod29yZCAmIChQQ0lfQ09NTUFORF9NQVNURVIgfCBQQ0lf
Q09NTUFORF9JTykpICE9DQotCSAgICAgKFBDSV9DT01NQU5EX01BU1RFUiB8
IFBDSV9DT01NQU5EX0lPKSkNCi0JCXBjaV93cml0ZV9jb25maWdfd29yZChk
ZXYsIFBDSV9DT01NQU5ELCB3b3JkIHwNCi0JCQkJICAgICAgUENJX0NPTU1B
TkRfTUFTVEVSIHwgUENJX0NPTU1BTkRfSU8pOw0KLQkNCi0JLyogbWFrZSBz
dXJlIHRoYXQgd2UncmUgaW4gcGNpIG5hdGl2ZSBtb2RlIGZvciBib3RoIHRo
ZSBwcmltYXJ5DQotCSAqIGFuZCBzZWNvbmRhcnkgY2hhbm5lbC4gKi8NCi0J
cGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBQQ0lfQ0xBU1NfUFJPRywgJmJp
dDgpOw0KLQlpZiAoKGJpdDggJiAweDUpICE9IDB4NSkNCi0JCXBjaV93cml0
ZV9jb25maWdfYnl0ZShkZXYsIFBDSV9DTEFTU19QUk9HLCBiaXQ4IHwgMHg1
KTsNCi0NCi0JLyogc2V0dXAgdXAgb3VyIGxhdGVuY3kuIHRoZSBkZWZhdWx0
IGlzIDI1NSB3aGljaCBpcyBhIGJpdCBsYXJnZS4NCi0JICogc2V0IGl0IHRv
IDY0IGluc3RlYWQuICovDQotCXBjaV9yZWFkX2NvbmZpZ19ieXRlKGRldiwg
UENJX0xBVEVOQ1lfVElNRVIsICZiaXQ4KTsNCi0JaWYgKGJpdDggIT0gMHg0
MCkNCi0JICAgIHBjaV93cml0ZV9jb25maWdfYnl0ZShkZXYsIFBDSV9MQVRF
TkNZX1RJTUVSLCAweDQwKTsNCisJaXNhX2RldiA9IHBjaV9maW5kX2Rldmlj
ZShQQ0lfVkVORE9SX0lEX1NFUlZFUldPUktTLCBQQ0lfREVWSUNFX0lEX1NF
UlZFUldPUktTX09TQjQsIE5VTEwpOw0KKw0KKwlwY2lfcmVhZF9jb25maWdf
ZHdvcmQoaXNhX2RldiwgMHg2NCwgJnJlZzY0KTsNCisjaWZkZWYgREVCVUcN
CisJcHJpbnRrKCIlczogcmVnNjQgPT0gMHglMDh4XG4iLCBuYW1lLCByZWc2
NCk7DQorI2VuZGlmDQorCXJlZzY0ICY9IH4weDAwMDBBMDAwOw0KKyNpZmRl
ZiBDT05GSUdfU01QDQorCXJlZzY0IHw9IDB4MDAwMDgwMDA7DQorI2VuZGlm
DQorCXBjaV93cml0ZV9jb25maWdfZHdvcmQoaXNhX2RldiwgMHg2NCwgcmVn
NjQpOw0KKw0KKwlwY2lfd3JpdGVfY29uZmlnX2J5dGUoZGV2LCBQQ0lfTEFU
RU5DWV9USU1FUiwgMHg0MCk7DQogDQogI2lmIGRlZmluZWQoRElTUExBWV9P
U0I0X1RJTUlOR1MpICYmIGRlZmluZWQoQ09ORklHX1BST0NfRlMpDQogCWlm
ICghb3NiNF9wcm9jKSB7DQpAQCAtMzA0LDE5ICs0MzEsMjIgQEANCiAJCWh3
aWYtPmlycSA9IGh3aWYtPmNoYW5uZWwgPyAxNSA6IDE0Ow0KIA0KIAlod2lm
LT50dW5lcHJvYyA9ICZvc2I0X3R1bmVfZHJpdmU7DQotCWh3aWYtPmRyaXZl
c1swXS5hdXRvdHVuZSA9IDE7DQotCWh3aWYtPmRyaXZlc1sxXS5hdXRvdHVu
ZSA9IDE7DQotDQotCWlmICghaHdpZi0+ZG1hX2Jhc2UpDQotCQlyZXR1cm47
DQorCWh3aWYtPnNwZWVkcHJvYyA9ICZvc2I0X3R1bmVfY2hpcHNldDsNCiAN
CiAjaWZuZGVmIENPTkZJR19CTEtfREVWX0lERURNQQ0KKwlod2lmLT5kcml2
ZXNbMF0uYXV0b3R1bmUgPSAxOw0KKwlod2lmLT5kcml2ZXNbMV0uYXV0b3R1
bmUgPSAxOw0KIAlod2lmLT5hdXRvZG1hID0gMDsNCisJcmV0dXJuOw0KICNl
bHNlIC8qIENPTkZJR19CTEtfREVWX0lERURNQSAqLw0KLSNpZmRlZiBDT05G
SUdfQkxLX0RFVl9PU0I0DQotCWh3aWYtPmF1dG9kbWEgPSAxOw0KLQlod2lm
LT5kbWFwcm9jID0gJm9zYjRfZG1hcHJvYzsNCi0JaHdpZi0+c3BlZWRwcm9j
ID0gJm9zYjRfdHVuZV9jaGlwc2V0Ow0KLSNlbmRpZiAvKiBDT05GSUdfQkxL
X0RFVl9PU0I0ICovDQorDQorCWlmIChod2lmLT5kbWFfYmFzZSkgew0KKwkJ
aHdpZi0+YXV0b2RtYSA9IDE7DQorCQlod2lmLT5kbWFwcm9jID0gJm9zYjRf
ZG1hcHJvYzsNCisJfSBlbHNlIHsNCisJCWh3aWYtPmF1dG9kbWEgPSAwOw0K
KwkJaHdpZi0+ZHJpdmVzWzBdLmF1dG90dW5lID0gMTsNCisJCWh3aWYtPmRy
aXZlc1sxXS5hdXRvdHVuZSA9IDE7DQorCX0NCiAjZW5kaWYgLyogIUNPTkZJ
R19CTEtfREVWX0lERURNQSAqLw0KIH0NCmRpZmYgLXVyTiBsaW51eC0yLjQu
MC10MTItNy1wcmlzdGluZS9kcml2ZXJzL2lkZS9waWl4LmMgbGludXgtMi40
LjAtdDEyLTcvZHJpdmVycy9pZGUvcGlpeC5jDQotLS0gbGludXgtMi40LjAt
dDEyLTctcHJpc3RpbmUvZHJpdmVycy9pZGUvcGlpeC5jCUZyaSBKdWwgIDcg
MTU6NTU6MjQgMjAwMA0KKysrIGxpbnV4LTIuNC4wLXQxMi03L2RyaXZlcnMv
aWRlL3BpaXguYwlGcmkgRGVjICA4IDAwOjE0OjU2IDIwMDANCkBAIC0zOTks
MTEgKzM5OSw2NSBAQA0KIAkJCQkJCSAgICAgaWRlX2RtYV9vZmZfcXVpZXRs
eSk7DQogfQ0KIA0KK3N0YXRpYyB2b2lkIGNvbmZpZ19jaGlwc2V0X2Zvcl9w
aW8gKGlkZV9kcml2ZV90ICpkcml2ZSkNCit7DQorCXBpaXhfdHVuZV9kcml2
ZShkcml2ZSwgaWRlX2dldF9iZXN0X3Bpb19tb2RlKGRyaXZlLCAyNTUsIDUs
IE5VTEwpKTsNCit9DQorDQorc3RhdGljIGludCBjb25maWdfZHJpdmVfeGZl
cl9yYXRlIChpZGVfZHJpdmVfdCAqZHJpdmUpDQorew0KKwlzdHJ1Y3QgaGRf
ZHJpdmVpZCAqaWQgPSBkcml2ZS0+aWQ7DQorCWlkZV9kbWFfYWN0aW9uX3Qg
ZG1hX2Z1bmMgPSBpZGVfZG1hX29uOw0KKw0KKwlpZiAoaWQgJiYgKGlkLT5j
YXBhYmlsaXR5ICYgMSkgJiYgSFdJRihkcml2ZSktPmF1dG9kbWEpIHsNCisJ
CS8qIENvbnN1bHQgdGhlIGxpc3Qgb2Yga25vd24gImJhZCIgZHJpdmVzICov
DQorCQlpZiAoaWRlX2RtYXByb2MoaWRlX2RtYV9iYWRfZHJpdmUsIGRyaXZl
KSkgew0KKwkJCWRtYV9mdW5jID0gaWRlX2RtYV9vZmY7DQorCQkJZ290byBm
YXN0X2F0YV9waW87DQorCQl9DQorCQlkbWFfZnVuYyA9IGlkZV9kbWFfb2Zm
X3F1aWV0bHk7DQorCQlpZiAoaWQtPmZpZWxkX3ZhbGlkICYgNCkgew0KKwkJ
CWlmIChpZC0+ZG1hX3VsdHJhICYgMHgwMDJGKSB7DQorCQkJCS8qIEZvcmNl
IGlmIENhcGFibGUgVWx0cmFETUEgKi8NCisJCQkJZG1hX2Z1bmMgPSBwaWl4
X2NvbmZpZ19kcml2ZV9mb3JfZG1hKGRyaXZlKTsNCisJCQkJaWYgKChpZC0+
ZmllbGRfdmFsaWQgJiAyKSAmJg0KKwkJCQkgICAgKGRtYV9mdW5jICE9IGlk
ZV9kbWFfb24pKQ0KKwkJCQkJZ290byB0cnlfZG1hX21vZGVzOw0KKwkJCX0N
CisJCX0gZWxzZSBpZiAoaWQtPmZpZWxkX3ZhbGlkICYgMikgew0KK3RyeV9k
bWFfbW9kZXM6DQorCQkJaWYgKChpZC0+ZG1hX213b3JkICYgMHgwMDA3KSB8
fA0KKwkJCSAgICAoaWQtPmRtYV8xd29yZCAmIDB4MDA3KSkgew0KKwkJCQkv
KiBGb3JjZSBpZiBDYXBhYmxlIHJlZ3VsYXIgRE1BIG1vZGVzICovDQorCQkJ
CWRtYV9mdW5jID0gcGlpeF9jb25maWdfZHJpdmVfZm9yX2RtYShkcml2ZSk7
DQorCQkJCWlmIChkbWFfZnVuYyAhPSBpZGVfZG1hX29uKQ0KKwkJCQkJZ290
byBub19kbWFfc2V0Ow0KKwkJCX0NCisJCX0gZWxzZSBpZiAoaWRlX2RtYXBy
b2MoaWRlX2RtYV9nb29kX2RyaXZlLCBkcml2ZSkpIHsNCisJCQlpZiAoaWQt
PmVpZGVfZG1hX3RpbWUgPiAxNTApIHsNCisJCQkJZ290byBub19kbWFfc2V0
Ow0KKwkJCX0NCisJCQkvKiBDb25zdWx0IHRoZSBsaXN0IG9mIGtub3duICJn
b29kIiBkcml2ZXMgKi8NCisJCQlkbWFfZnVuYyA9IHBpaXhfY29uZmlnX2Ry
aXZlX2Zvcl9kbWEoZHJpdmUpOw0KKwkJCWlmIChkbWFfZnVuYyAhPSBpZGVf
ZG1hX29uKQ0KKwkJCQlnb3RvIG5vX2RtYV9zZXQ7DQorCQl9IGVsc2Ugew0K
KwkJCWdvdG8gZmFzdF9hdGFfcGlvOw0KKwkJfQ0KKwl9IGVsc2UgaWYgKChp
ZC0+Y2FwYWJpbGl0eSAmIDgpIHx8IChpZC0+ZmllbGRfdmFsaWQgJiAyKSkg
ew0KK2Zhc3RfYXRhX3BpbzoNCisJCWRtYV9mdW5jID0gaWRlX2RtYV9vZmZf
cXVpZXRseTsNCitub19kbWFfc2V0Og0KKwkJY29uZmlnX2NoaXBzZXRfZm9y
X3Bpbyhkcml2ZSk7DQorCX0NCisJcmV0dXJuIEhXSUYoZHJpdmUpLT5kbWFw
cm9jKGRtYV9mdW5jLCBkcml2ZSk7DQorfQ0KKw0KIHN0YXRpYyBpbnQgcGlp
eF9kbWFwcm9jKGlkZV9kbWFfYWN0aW9uX3QgZnVuYywgaWRlX2RyaXZlX3Qg
KmRyaXZlKQ0KIHsNCiAJc3dpdGNoIChmdW5jKSB7DQogCQljYXNlIGlkZV9k
bWFfY2hlY2s6DQotCQkJIHJldHVybiBpZGVfZG1hcHJvYygoaWRlX2RtYV9h
Y3Rpb25fdCkgcGlpeF9jb25maWdfZHJpdmVfZm9yX2RtYShkcml2ZSksIGRy
aXZlKTsNCisJCQlyZXR1cm4gY29uZmlnX2RyaXZlX3hmZXJfcmF0ZShkcml2
ZSk7DQogCQlkZWZhdWx0IDoNCiAJCQlicmVhazsNCiAJfQ0K
---1019260510-1900307650-976355833=:5191--
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at http://www.tux.org/lkml/
