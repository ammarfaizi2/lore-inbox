Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S132414AbRDJQ14>; Tue, 10 Apr 2001 12:27:56 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S132416AbRDJQ1r>; Tue, 10 Apr 2001 12:27:47 -0400
Received: from mgw-x1.nokia.com ([131.228.20.21]:4057 "EHLO mgw-x1.nokia.com")
	by vger.kernel.org with ESMTP id <S132414AbRDJQ1i>;
	Tue, 10 Apr 2001 12:27:38 -0400
Message-ID: <2D6CADE9B0C6D411A27500508BB3CBD063CF0D@eseis15nok>
From: Imran.Patel@nokia.com
To: ak@suse.de, Imran.Patel@nokia.com
Cc: netfilter-devel@us5.samba.org, netdev@oss.sgi.com,
        linux-kernel@vger.kernel.org
Subject: RE: skb allocation problems
Date: Tue, 10 Apr 2001 19:27:29 +0300
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2652.78)
Content-Type: text/plain;
	charset="iso-8859-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

> On Mon, Apr 09, 2001 at 07:03:46PM +0300, Imran.Patel@nokia.com wrote:
> > I have written a test module which closely mirrors what my 
> code tries to
> > do(attached below). This is what i get:
> > 
> > PRE_R: old skb:c371ee40  new skb:c371ee30 
> 
> I guess oldskb->len is <=0xc, and the slab allocator packs 
> them near together
> in the same zone.

nope. i have checked it, the length of the older skb is perfectly ok.....and
i even found that this weird behaviour happens only when the old skb buffer
length is between 80 and 224 bytes. 

and apart from this problem, i even found out that when i send a packet >=
186 bytes the kernel allocates a lot of memory in the skb...the output from
a simple test module is below:

PRE_R: skb: c7aa0da0 skblen: 185 headroom: 32 tailroom: 7    total_len: 224
PRE_R: skb: c7a43020 skblen: 186 headroom: 32 tailroom: 1334 total_len: 1552

This was generated by sending ipv4 ping packets of different sizes...I
tested it using 2.4.1 and 2.4.3 on two machines (both dual stack).
What the hell's going on :( ???

imran

