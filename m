Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S263506AbTKQNeQ (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 17 Nov 2003 08:34:16 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S263513AbTKQNeQ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 17 Nov 2003 08:34:16 -0500
Received: from ns.suse.de ([195.135.220.2]:62377 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S263506AbTKQNeJ (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 17 Nov 2003 08:34:09 -0500
Date: Mon, 17 Nov 2003 14:34:08 +0100
Message-ID: <s5hptfrjezz.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: arvidjaar@mail.ru
Cc: linux-kernel@vger.kernel.org, rusty@rustcorp.com.au
Subject: Re: modules.pnpmap output support
In-Reply-To: <E1ALidB-000MWd-00.arvidjaar-mail-ru@f17.mail.ru>
References: <E1ALidB-000MWd-00.arvidjaar-mail-ru@f17.mail.ru>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 17 Nov 2003 15:37:25 +0300,
Andrey Borzenkov wrote:
> 
> 
> >> > The attached patch makes depmod to output modules.pnpmap file
> >> > generated from the pnp device table.
> >> > 
> 
> thank you. I was about to do it for hotplug.
> 
> >> > The output format is not compatible with the old modules.isapnpmap.
> >> > The new format shows the pnp id string (e.g. CTL0301) while the old
> >> > format uses the hex numbers.  I don't think it's worthy to keep the
> >> > compatibility for this (since the new one is more intuitive), but it'd
> >> > be easy to follow the old style.
> >> 
> 
> can you get full ID out of sysfs?

yes.

>  This is required for
> coldplugging to work (I think mainly of loading drivers
> for on-board legacy devices detected by PNP BIOS like floppy,
> parport, serial).
> 
> Oh, BTW, it reminds me - file2alias prints hex in upper
> case while both sysfs and hotplug present them in lower case
> (for sure for USB and PCI, and for PNP entries detected by 
> PNP BIOS). Should not we unify representation?

hmm, file2alias uses lower letters as the identifier (seprator?), so i
think simply using lower hex letter will be confusing.  wouldn't it be
better to have an  explicit delimter character like ':' (or '/' or
whatever) ?

> >> That seems strange.  If you don't worry about backwards compatibility,
> >> then the new scripts/file2alias.c approach is better, 
> 
> welcome to the family :)
 
yeah brother :)

> > which generates
> >> aliases for each module (depmod then collects these into
> >> /lib/modules/`uname -r`/modules.alias for speed).
> >> 
> >> The tables generated by depmod are purely for backwards compatibility,
> >> although it does look like they will be required throughout 2.6 at
> >> this stage.
> >> 
> >> Does that clarify?
> >
> >ah, ok, that makes sense.
> >
> > but still, file2alias (as of test9) doesn't output the entries for pnp
> > devices...
> 
> Sure it does not, noone did it as yet. If you do it please let me
> know, specifically about format for aliases.

at first i'll try to add the support of old isapnp format for
compatibility, so that old programs can work as they are.

the file2alias format of (isa) pnp devices will need variable number
of items, since a driver may require multiple ids.
for example, snd-cs4236 driver supports the cards with three ids like
	CSCe825:CSC0100:CSC0110
and four ids like
	CSCd937:CSC0000:CSC0010:CSC0003
in each case, a matching card must include all ids listed there.

well, i'm not sure which identifier (separator) letter in which style
should be used.  something like
	pnp:idXXXxxxxd0XXXxxxxd1XXXXxxxx
??  separators including a number might be a bad idea, though...


Takashi
