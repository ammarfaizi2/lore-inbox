Return-Path: <linux-kernel-owner+willy=40w.ods.org-S270011AbUJHPFW@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S270011AbUJHPFW (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 8 Oct 2004 11:05:22 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S270013AbUJHPFV
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 8 Oct 2004 11:05:21 -0400
Received: from caramon.arm.linux.org.uk ([212.18.232.186]:12812 "EHLO
	caramon.arm.linux.org.uk") by vger.kernel.org with ESMTP
	id S270011AbUJHPFC (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Fri, 8 Oct 2004 11:05:02 -0400
Date: Fri, 8 Oct 2004 16:04:56 +0100
From: Russell King <rmk+lkml@arm.linux.org.uk>
To: Linux Kernel List <linux-kernel@vger.kernel.org>,
       Rusty Russell <rusty@rustcorp.com.au>,
       Catalin Marinas <Catalin.Marinas@arm.com>,
       Richard Earnshaw <Richard.Earnshaw@arm.com>,
       Sam Ravnborg <sam@ravnborg.org>
Subject: Re: [RFC] ARM binutils feature churn causing kernel problems
Message-ID: <20041008160456.H17999@flint.arm.linux.org.uk>
Mail-Followup-To: Linux Kernel List <linux-kernel@vger.kernel.org>,
	Rusty Russell <rusty@rustcorp.com.au>,
	Catalin Marinas <Catalin.Marinas@arm.com>,
	Richard Earnshaw <Richard.Earnshaw@arm.com>,
	Sam Ravnborg <sam@ravnborg.org>
References: <20040927210305.A26680@flint.arm.linux.org.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5.1i
In-Reply-To: <20040927210305.A26680@flint.arm.linux.org.uk>; from rmk+lkml@arm.linux.org.uk on Mon, Sep 27, 2004 at 09:03:05PM +0100
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, Sep 27, 2004 at 09:03:05PM +0100, Russell King wrote:
> The ARM binutils seems to be in a problematical state at the moment.
> It has recently had a "bug" fixed where ARM specific "mapping symbols"
> were not generated in ELF objects.  These "mapping symbols" have names
> such as "$a" and "$d".

Ok, another tool which is affected by this is procps:

$ ps alx
Warning: /boot/System.map-2.6.9-rc3 not parseable as a System.map
Warning: /boot/System.map not parseable as a System.map
Warning: /usr/src/linux/System.map has an incorrect kernel version.
F   UID   PID  PPID PRI  NI   VSZ  RSS WCHAN  STAT TTY        TIME COMMAND
4     0     1     0  16   0  1244  508 do_sel S    ?          0:01 init [3]
...
$ grep -v '\$[adt]' /boot/System.map-2.6.9-rc3 > System.map-2.6.9-rc3
$ PS_SYSTEM_MAP=System.map-2.6.9-rc3 ps alx
F   UID   PID  PPID PRI  NI   VSZ  RSS WCHAN  STAT TTY        TIME COMMAND
4     0     1     0  16   0  1244  508 do_sel S    ?          0:01 init [3]
...

The System.map file is generated by ($1 = vmlinux $2 = System.map):

$NM -n $1 | grep -v '\( [aUw] \)\|\(__crc_\)' > $2

Can we change this to:

$NM -n $1 | grep -v '\( [aUw] \)\|\(__crc_\)\|\( \$[adt]\)' > $2

?

-- 
Russell King
 Linux kernel    2.6 ARM Linux   - http://www.arm.linux.org.uk/
 maintainer of:  2.6 PCMCIA      - http://pcmcia.arm.linux.org.uk/
                 2.6 Serial core
