Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S266078AbSLCFrY>; Tue, 3 Dec 2002 00:47:24 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S266091AbSLCFrY>; Tue, 3 Dec 2002 00:47:24 -0500
Received: from ylug.mozilla.gr.jp ([203.141.142.92]:11790 "HELO
	maison.kyo-ko.org") by vger.kernel.org with SMTP id <S266078AbSLCFrX>;
	Tue, 3 Dec 2002 00:47:23 -0500
X-Mailer: cmail 2.61.1+20011011 on GNU Emacs 20.7.2 / Mule 4.1
 =?ISO-2022-JP?B?KBskQjAqGyhCKQ==?=
From: Hiroshi Miura <miura@da-cha.org>
To: Alan Cox <alan@redhat.com>, sfr@canb.auug.org.au,
       linux-kernel@vger.kernel.org
Cc: Pavel Machek <pavel@ucw.cz>, Hiroshi Miura <miura@da-cha.org>
Subject: [PATCH] 2.5.50 apm.c better printk messages about workaround.
X-Face: "7/]{D;9O-#dR'kB\tvpz_:#o|*UdC.KK/_"IN*i5VTU&EBhS6w68xQDPh]i4N%1byZ~v~X
 k$vdp(%V@gY!_|7x7Ht)^ih5\%\l'hcl$`sqp;%`boxPHDJB<~Sr8(e:zPKmeZ)ZPml[0v\|[V00Jm
 G,%5V5X9Mw7j}(8+!o>&&wmQ]Xh=j
User-Agent: SEMI/1.14.4 (=?ISO-2022-JP?B?GyRCOllPJExaGyhC?=) FLIM/1.14.4
 (=?ISO-2022-JP?B?GyRCM2A4Nj9ANVxBMBsoQg==?=) APEL/10.4 Emacs/20.7
 (i386-debian-linux-gnu) MULE/4.1 (=?ISO-2022-JP?B?GyRCMCobKEI=?=)
MIME-Version: 1.0 (generated by SEMI 1.14.4 - =?ISO-2022-JP?B?IhskQjpZGyhC?=
 =?ISO-2022-JP?B?GyRCTyRMWhsoQiI=?=)
Content-Type: text/plain; charset=US-ASCII
Message-Id: <20021203052819.2988A1178EB@triton2>
Date: Tue,  3 Dec 2002 14:28:19 +0900 (JST)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hello,

I post patch about work around for a broken bios.
Pavel comments and i think it is reasonable and better.

this patch fix printk message in 2.5.50.

--- linux-2.5.50/arch/i386/kernel/apm.c	2002-12-03 07:59:30.000000000 +0900
+++ linux-2.5.50-geode/arch/i386/kernel/apm.c	2002-12-03 14:04:11.000000000 +0900
@@ -2054,12 +2054,14 @@
 			_set_limit((char *)&cpu_gdt_table[i][APM_DS >> 3],
 				(apm_info.bios.dseg_len - 1) & 0xffff);
 		      /* workaround for broken BIOSes */
-	                if (apm_info.bios.cseg_len <= apm_info.bios.offset)
+	                if (apm_info.bios.cseg_len <= apm_info.bios.offset) {
         	                _set_limit((char *)&cpu_gdt_table[i][APM_CS >> 3], 64 * 1024 -1);
-                       if (apm_info.bios.dseg_len <= 0x40) { /* 0x40 * 4kB == 64kB */
+				printk(KERN_WARNING "apm: broken bios -- code segment too short, assuming 64k");
+			}
+                        if (apm_info.bios.dseg_len <= 0x40) { /* 0x40 * 4kB == 64kB */
                         	/* for the BIOS that assumes granularity = 1 */
                         	cpu_gdt_table[i][APM_DS >> 3].b |= 0x800000;
-                        	printk(KERN_NOTICE "apm: we set the granularity of dseg.\n");
+                        	printk(KERN_WARNING "apm: broken bios -- assuming granularity 1 on dseg");
         	        }
 		}
 #endif


-- 
Hiroshi Miura  --- http://www.da-cha.org/ 
NTTDATA Corp. Marketing & Business Strategy Planning Dept. --- miurahr@nttdata.co.jp 
Key fingerprint = 9117 9407 5684 FBF1 4063  15B4 401D D077 04AB 8617
-- My hacking life is happy as the day is long

