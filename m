Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S276336AbRI1WBM>; Fri, 28 Sep 2001 18:01:12 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S276337AbRI1WBH>; Fri, 28 Sep 2001 18:01:07 -0400
Received: from earth.ayrnetworks.com ([64.166.72.139]:37645 "EHLO
	earth.ayrnetworks.com") by vger.kernel.org with ESMTP
	id <S276335AbRI1V7g>; Fri, 28 Sep 2001 17:59:36 -0400
Date: Fri, 28 Sep 2001 14:58:13 -0700 (PDT)
From: Brad <prettygood@cs.stanford.edu>
X-X-Sender: <bradb@earth.ayrnetworks.com>
Reply-To: <prettygood@cs.stanford.edu>
To: <linux-kernel@vger.kernel.org>
Subject: [PATCH] Big-endian reading/writing cramfs (vs 2.4.10)
Message-ID: <Pine.LNX.4.33.0109281440380.9055-200000@earth.ayrnetworks.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="17438721-1929461958-1001714293=:9055"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--17438721-1929461958-1001714293=:9055
Content-Type: TEXT/PLAIN; charset=US-ASCII

A few people have expressed interest in this, and I needed it as
well.  Currently, cramfs images aren't shareable between different endian
architectures.  The documentation states the meta-data should always be
stored little endian, as the cost of swabbing would be low, but the code
doesn't do it.  We needed shareable images, so I modified inode.c,
cramfs_fs.h, and mkcramfs.h to enable a big-endian machine to swab meta
data when writing (mkcramfs.c) and reading (inode.c).  This is done with
#defined macros (the 26 bit/6 bit bitfield is kind of ugly to translate),
so the code doesn't change for little-endian machines, only big-endian.
I tested reading le on be, reading a be-written le image on le, etc...

This is a patch against 2.4.10.

-Brad Bozarth




--17438721-1929461958-1001714293=:9055
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="unifiedcram.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.33.0109281458130.9055@earth.ayrnetworks.com>
Content-Description: 
Content-Disposition: attachment; filename="unifiedcram.diff"

LS0tIDIuNC4xMC9pbmNsdWRlL2xpbnV4L2NyYW1mc19mcy5oCVRodSBKdWwg
MTkgMTY6MTQ6NTMgMjAwMQ0KKysrIGN1cnJlbnQvaW5jbHVkZS9saW51eC9j
cmFtZnNfZnMuaAlUaHUgU2VwIDI3IDE3OjM2OjU3IDIwMDENCkBAIC05LDcg
KzksMTIgQEANCiANCiAjZW5kaWYNCiANCisjaWYgKGRlZmluZWQoQllURV9P
UkRFUikgJiYgQllURV9PUkRFUiA9PSBCSUdfRU5ESUFOKSB8fCBkZWZpbmVk
KF9fTUlQU0VCX18pDQorI2RlZmluZSBDUkFNRlNfTUFHSUMJCTB4NDUzZGNk
MjgJLyogZW5kaWFuIHJldmVyc2VkIG1hZ2ljICovDQorI2Vsc2UNCiAjZGVm
aW5lIENSQU1GU19NQUdJQwkJMHgyOGNkM2Q0NQkvKiBzb21lIHJhbmRvbSBu
dW1iZXIgKi8NCisjZW5kaWYNCisNCiAjZGVmaW5lIENSQU1GU19TSUdOQVRV
UkUJIkNvbXByZXNzZWQgUk9NRlMiDQogDQogLyoNCkBAIC04MCw2ICs4NSw0
MCBAQA0KICAqIGNoYW5nZWQgdG8gdGVzdCBzdXBlci5mdXR1cmUgaW5zdGVh
ZC4NCiAgKi8NCiAjZGVmaW5lIENSQU1GU19TVVBQT1JURURfRkxBR1MgKDB4
N2ZmKQ0KKw0KKy8qIA0KKyAqIFNpbmNlIGNyYW1mcyAoYWNjb3JkaW5nIHRv
IGRvY3MpIHNob3VsZCBhbHdheXMgYmUgc3RvcmVkIGxpdHRsZSBlbmRpYW4s
IA0KKyAqIHByb3ZpZGUgbWFjcm9zIHRvIHN3YWIgdGhlIGJpdGZpZWxkcyAo
bWtjcmFtZnMgdXNlcyB0aGlzIGZpbGUgdG9vKS4gDQorICovDQorI2lmIChk
ZWZpbmVkKEJZVEVfT1JERVIpICYmIEJZVEVfT1JERVIgPT0gQklHX0VORElB
TikgfHwgZGVmaW5lZChfX01JUFNFQl9fKQ0KKw0KKyNkZWZpbmUgQ1JBTV9T
V0FCXzE2KHgpCSggKCAoMHgwMDAwRkYwMCAmICh4KSkgPj4gOCAgICkgfCBc
DQorCQkJICAoICgweDAwMDAwMEZGICYgKHgpKSA8PCA4ICkgKQ0KKyNkZWZp
bmUgQ1JBTV9TV0FCXzI0KHgpCSggKCAoMHgwMEZGMDAwMCAmICh4KSkgPj4g
MTYgKSB8IFwNCisJCQkgICggKDB4MDAwMEZGMDAgJiAoeCkpICAgICAgICkg
fCBcDQorCQkJICAoICgweDAwMDAwMEZGICYgKHgpKSA8PCAxNiApICkNCisj
ZGVmaW5lIENSQU1fU1dBQl8zMih4KQkoICggKDB4RkYwMDAwMDAgJiAoeCkp
ID4+IDI0ICkgfCBcDQorCQkJICAoICgweDAwRkYwMDAwICYgKHgpKSA+PiA4
ICApIHwgXA0KKwkJCSAgKCAoMHgwMDAwRkYwMCAmICh4KSkgPDwgOCAgKSB8
IFwNCisJCQkgICggKDB4MDAwMDAwRkYgJiAoeCkpIDw8IDI0ICkgKQ0KKyNk
ZWZpbmUgR0VUX0NSQU1fTkFNRUxFTih4KSAoKCh1OCopKHgpKVs4XSAmIDYz
KQ0KKyNkZWZpbmUgR0VUX0NSQU1fT0ZGU0VUKHgpICAoKENSQU1fU1dBQl8y
NCgoKHUzMiopKHgpKVsyXSAmIDB4MDBGRkZGRkYpPDwyKSB8IFwNCisJCQkg
ICAgICAgICAgICAgICAgICgoKCh1MzIqKSh4KSlbMl0gJiAweEMwMDAwMDAw
KT4+MzApICkNCisjZGVmaW5lIFNFVF9DUkFNX09GRlNFVCh4LHkpICAgKCAo
KHUzMiopKHgpKVsyXSA9ICgoKHkpJjMpPDwzMCkgfCBcDQorCQkJCSBDUkFN
X1NXQUJfMjQoICggKCh5KSAmIDB4MDNGRkZGRkYpID4+IDIpICkgfCBcDQor
CQkJCSAoKCh1MzIpKCgodTgqKSh4KSlbOF0gJiAweDNGKSkgPDwgMjQpICkN
CisjZGVmaW5lIFNFVF9DUkFNX05BTUVMRU4oeCx5KQkoICgodTgqKSh4KSlb
OF0gPSAoICgoMHgzRiAmICh5KSkpIHwgXA0KKwkJCQkJCSAgICAoMHhDMCAm
ICgodTgqKSh4KSlbOF0pICkgKQ0KKw0KKyNlbHNlDQorI2RlZmluZSBDUkFN
X1NXQUJfMTYoeCkJCSh4KQ0KKyNkZWZpbmUgQ1JBTV9TV0FCXzI0KHgpCQko
eCkNCisjZGVmaW5lIENSQU1fU1dBQl8zMih4KQkJKHgpDQorI2RlZmluZSBH
RVRfQ1JBTV9OQU1FTEVOKHgpCSgoeCktPm5hbWVsZW4pDQorI2RlZmluZSBH
RVRfQ1JBTV9PRkZTRVQoeCkJKCh4KS0+b2Zmc2V0KQ0KKyNkZWZpbmUgU0VU
X0xFX09GRlNFVCh4LHkpCSgoeCktPm9mZnNldCA9IHkpDQorI2RlZmluZSBT
RVRfTEVfTkFNRUxFTih4LHkpCSgoeCktPm5hbWVsZW4gPSB5KQ0KKyNlbmRp
Zg0KIA0KIC8qIFVuY29tcHJlc3Npb24gaW50ZXJmYWNlcyB0byB0aGUgdW5k
ZXJseWluZyB6bGliICovDQogaW50IGNyYW1mc191bmNvbXByZXNzX2Jsb2Nr
KHZvaWQgKmRzdCwgaW50IGRzdGxlbiwgdm9pZCAqc3JjLCBpbnQgc3JjbGVu
KTsNCi0tLSAyLjQuMTAvZnMvY3JhbWZzL2lub2RlLmMJTW9uIEF1ZyAyNyAw
Nzo1Mzo0OSAyMDAxDQorKysgY3VycmVudC9mcy9jcmFtZnMvaW5vZGUuYwlG
cmkgU2VwIDI4IDE0OjAxOjUzIDIwMDENCkBAIC0zNSw3ICszNSw3IEBADQog
DQogLyogVGhlc2UgdHdvIG1hY3JvcyBtYXkgY2hhbmdlIGluIGZ1dHVyZSwg
dG8gcHJvdmlkZSBiZXR0ZXIgc3RfaW5vDQogICAgc2VtYW50aWNzLiAqLw0K
LSNkZWZpbmUgQ1JBTUlOTyh4KQkoKHgpLT5vZmZzZXQ/KHgpLT5vZmZzZXQ8
PDI6MSkNCisjZGVmaW5lIENSQU1JTk8oeCkJKEdFVF9DUkFNX09GRlNFVCh4
KSA/IEdFVF9DUkFNX09GRlNFVCh4KTw8MiA6IDEpDQogI2RlZmluZSBPRkZT
RVQoeCkJKCh4KS0+aV9pbm8pDQogDQogc3RhdGljIHN0cnVjdCBpbm9kZSAq
Z2V0X2NyYW1mc19pbm9kZShzdHJ1Y3Qgc3VwZXJfYmxvY2sgKnNiLCBzdHJ1
Y3QgY3JhbWZzX2lub2RlICogY3JhbWZzX2lub2RlKQ0KQEAgLTQzLDkgKzQz
LDkgQEANCiAJc3RydWN0IGlub2RlICogaW5vZGUgPSBuZXdfaW5vZGUoc2Ip
Ow0KIA0KIAlpZiAoaW5vZGUpIHsNCi0JCWlub2RlLT5pX21vZGUgPSBjcmFt
ZnNfaW5vZGUtPm1vZGU7DQotCQlpbm9kZS0+aV91aWQgPSBjcmFtZnNfaW5v
ZGUtPnVpZDsNCi0JCWlub2RlLT5pX3NpemUgPSBjcmFtZnNfaW5vZGUtPnNp
emU7DQorCQlpbm9kZS0+aV9tb2RlID0gQ1JBTV9TV0FCXzE2KGNyYW1mc19p
bm9kZS0+bW9kZSk7DQorCQlpbm9kZS0+aV91aWQgPSBDUkFNX1NXQUJfMTYo
Y3JhbWZzX2lub2RlLT51aWQpOw0KKwkJaW5vZGUtPmlfc2l6ZSA9IENSQU1f
U1dBQl8yNChjcmFtZnNfaW5vZGUtPnNpemUpOw0KIAkJaW5vZGUtPmlfYmxv
Y2tzID0gKGNyYW1mc19pbm9kZS0+c2l6ZSAtIDEpIC8gNTEyICsgMTsNCiAJ
CWlub2RlLT5pX2Jsa3NpemUgPSBQQUdFX0NBQ0hFX1NJWkU7DQogCQlpbm9k
ZS0+aV9naWQgPSBjcmFtZnNfaW5vZGUtPmdpZDsNCkBAIC02Niw3ICs2Niw4
IEBADQogCQkJaW5vZGUtPmlfZGF0YS5hX29wcyA9ICZjcmFtZnNfYW9wczsN
CiAJCX0gZWxzZSB7DQogCQkJaW5vZGUtPmlfc2l6ZSA9IDA7DQotCQkJaW5p
dF9zcGVjaWFsX2lub2RlKGlub2RlLCBpbm9kZS0+aV9tb2RlLCBjcmFtZnNf
aW5vZGUtPnNpemUpOw0KKwkJCWluaXRfc3BlY2lhbF9pbm9kZShpbm9kZSwg
aW5vZGUtPmlfbW9kZSwgDQorCQkJCQkgICBDUkFNX1NXQUJfMjQoY3JhbWZz
X2lub2RlLT5zaXplKSk7DQogCQl9DQogCX0NCiAJcmV0dXJuIGlub2RlOw0K
QEAgLTIxOSwxMSArMjIwLDExIEBADQogCX0NCiANCiAJLyogQ2hlY2sgdGhh
dCB0aGUgcm9vdCBpbm9kZSBpcyBpbiBhIHNhbmUgc3RhdGUgKi8NCi0JaWYg
KCFTX0lTRElSKHN1cGVyLnJvb3QubW9kZSkpIHsNCisJaWYgKCFTX0lTRElS
KENSQU1fU1dBQl8xNihzdXBlci5yb290Lm1vZGUpKSkgew0KIAkJcHJpbnRr
KEtFUk5fRVJSICJjcmFtZnM6IHJvb3QgaXMgbm90IGEgZGlyZWN0b3J5XG4i
KTsNCiAJCWdvdG8gb3V0Ow0KIAl9DQotCXJvb3Rfb2Zmc2V0ID0gc3VwZXIu
cm9vdC5vZmZzZXQgPDwgMjsNCisJcm9vdF9vZmZzZXQgPSBHRVRfQ1JBTV9P
RkZTRVQoJihzdXBlci5yb290KSkgPDwgMjsNCiAJaWYgKHN1cGVyLmZsYWdz
ICYgQ1JBTUZTX0ZMQUdfRlNJRF9WRVJTSU9OXzIpIHsNCiAJCXNiLT5DUkFN
RlNfU0JfU0laRT1zdXBlci5zaXplOw0KIAkJc2ItPkNSQU1GU19TQl9CTE9D
S1M9c3VwZXIuZnNpZC5ibG9ja3M7DQpAQCAtMjk5LDcgKzMwMCw3IEBADQog
CQkgKiBhbmQgdGhlIG5hbWUgcGFkZGVkIG91dCB0byA0LWJ5dGUgYm91bmRh
cmllcw0KIAkJICogd2l0aCB6ZXJvZXMuDQogCQkgKi8NCi0JCW5hbWVsZW4g
PSBkZS0+bmFtZWxlbiA8PCAyOw0KKwkJbmFtZWxlbiA9IEdFVF9DUkFNX05B
TUVMRU4oZGUpIDw8IDI7DQogCQluZXh0b2Zmc2V0ID0gb2Zmc2V0ICsgc2l6
ZW9mKCpkZSkgKyBuYW1lbGVuOw0KIAkJZm9yICg7Oykgew0KIAkJCWlmICgh
bmFtZWxlbikNCkBAIC0zMDgsNyArMzA5LDggQEANCiAJCQkJYnJlYWs7DQog
CQkJbmFtZWxlbi0tOw0KIAkJfQ0KLQkJZXJyb3IgPSBmaWxsZGlyKGRpcmVu
dCwgbmFtZSwgbmFtZWxlbiwgb2Zmc2V0LCBDUkFNSU5PKGRlKSwgZGUtPm1v
ZGUgPj4gMTIpOw0KKwkJZXJyb3IgPSBmaWxsZGlyKGRpcmVudCwgbmFtZSwg
bmFtZWxlbiwgb2Zmc2V0LCBDUkFNSU5PKGRlKSwgDQorCQkJCUNSQU1fU1dB
Ql8xNihkZS0+bW9kZSkgPj4gMTIpOw0KIAkJaWYgKGVycm9yKQ0KIAkJCWJy
ZWFrOw0KIA0KQEAgLTMzOSw3ICszNDEsNyBAQA0KIAkJaWYgKHNvcnRlZCAm
JiAoZGVudHJ5LT5kX25hbWUubmFtZVswXSA8IG5hbWVbMF0pKQ0KIAkJCWJy
ZWFrOw0KIA0KLQkJbmFtZWxlbiA9IGRlLT5uYW1lbGVuIDw8IDI7DQorCQlu
YW1lbGVuID0gR0VUX0NSQU1fTkFNRUxFTihkZSkgPDwgMjsNCiAJCW9mZnNl
dCArPSBzaXplb2YoKmRlKSArIG5hbWVsZW47DQogDQogCQkvKiBRdWljayBj
aGVjayB0aGF0IHRoZSBuYW1lIGlzIHJvdWdobHkgdGhlIHJpZ2h0IGxlbmd0
aCAqLw0KQEAgLTM4NSw5ICszODcsMTAgQEANCiANCiAJCXN0YXJ0X29mZnNl
dCA9IE9GRlNFVChpbm9kZSkgKyBtYXhibG9jayo0Ow0KIAkJaWYgKHBhZ2Ut
PmluZGV4KQ0KLQkJCXN0YXJ0X29mZnNldCA9ICoodTMyICopIGNyYW1mc19y
ZWFkKHNiLCBibGtwdHJfb2Zmc2V0LTQsIDQpOw0KLQkJY29tcHJfbGVuID0g
KCoodTMyICopIGNyYW1mc19yZWFkKHNiLCBibGtwdHJfb2Zmc2V0LCA0KQ0K
LQkJCSAgICAgLSBzdGFydF9vZmZzZXQpOw0KKwkJCXN0YXJ0X29mZnNldCA9
IENSQU1fU1dBQl8zMigqKHUzMiAqKSANCisJCQkJICAgICAgICBjcmFtZnNf
cmVhZChzYiwgYmxrcHRyX29mZnNldCAtIDQsIDQpKTsNCisJCWNvbXByX2xl
biA9IENSQU1fU1dBQl8zMigqKHUzMiAqKQ0KKwkJCSAgICAgY3JhbWZzX3Jl
YWQoc2IsIGJsa3B0cl9vZmZzZXQsIDQpKSAtIHN0YXJ0X29mZnNldDsNCiAJ
CXBnZGF0YSA9IGttYXAocGFnZSk7DQogCQlpZiAoY29tcHJfbGVuID09IDAp
DQogCQkJOyAvKiBob2xlICovDQotLS0gMi40LjEwL3NjcmlwdHMvY3JhbWZz
L21rY3JhbWZzLmMJVGh1IEp1bCAxOSAxNjoxNDo1MyAyMDAxDQorKysgY3Vy
cmVudC9zY3JpcHRzL2NyYW1mcy9ta2NyYW1mcy5jCUZyaSBTZXAgMjggMTQ6
MTU6MzcgMjAwMQ0KQEAgLTMxNywxOSArMzE3LDIwIEBADQogCQlvZmZzZXQg
Kz0gb3B0X3BhZDsNCiAJfQ0KIA0KLQlzdXBlci0+bWFnaWMgPSBDUkFNRlNf
TUFHSUM7DQotCXN1cGVyLT5mbGFncyA9IENSQU1GU19GTEFHX0ZTSURfVkVS
U0lPTl8yIHwgQ1JBTUZTX0ZMQUdfU09SVEVEX0RJUlM7DQorCXN1cGVyLT5t
YWdpYyA9IENSQU1GU19NQUdJQzsgLyogI2RlZmluZWQgY29ycmVjdGx5IG9u
IGJvdGggZW5kaWFucyAqLw0KKwlzdXBlci0+ZmxhZ3MgPSBDUkFNX1NXQUJf
MzIoQ1JBTUZTX0ZMQUdfRlNJRF9WRVJTSU9OXzIgfCANCisJCQkJICAgIENS
QU1GU19GTEFHX1NPUlRFRF9ESVJTKTsNCiAJaWYgKG9wdF9ob2xlcykNCi0J
CXN1cGVyLT5mbGFncyB8PSBDUkFNRlNfRkxBR19IT0xFUzsNCisJCXN1cGVy
LT5mbGFncyB8PSBDUkFNX1NXQUJfMzIoQ1JBTUZTX0ZMQUdfSE9MRVMpOw0K
IAlpZiAoaW1hZ2VfbGVuZ3RoID4gMCkNCi0JCXN1cGVyLT5mbGFncyB8PSBD
UkFNRlNfRkxBR19TSElGVEVEX1JPT1RfT0ZGU0VUOw0KLQlzdXBlci0+c2l6
ZSA9IHNpemU7DQorCQlzdXBlci0+ZmxhZ3MgfD0gQ1JBTV9TV0FCXzMyKENS
QU1GU19GTEFHX1NISUZURURfUk9PVF9PRkZTRVQpOw0KKwlzdXBlci0+c2l6
ZSA9IENSQU1fU1dBQl8yNChzaXplKTsNCiAJbWVtY3B5KHN1cGVyLT5zaWdu
YXR1cmUsIENSQU1GU19TSUdOQVRVUkUsIHNpemVvZihzdXBlci0+c2lnbmF0
dXJlKSk7DQogDQotCXN1cGVyLT5mc2lkLmNyYyA9IGNyYzMyKDBMLCBaX05V
TEwsIDApOw0KLQlzdXBlci0+ZnNpZC5lZGl0aW9uID0gb3B0X2VkaXRpb247
DQotCXN1cGVyLT5mc2lkLmJsb2NrcyA9IHRvdGFsX2Jsb2NrczsNCi0Jc3Vw
ZXItPmZzaWQuZmlsZXMgPSB0b3RhbF9ub2RlczsNCisJc3VwZXItPmZzaWQu
Y3JjID0gQ1JBTV9TV0FCXzMyKGNyYzMyKDBMLCBaX05VTEwsIDApKTsNCisJ
c3VwZXItPmZzaWQuZWRpdGlvbiA9IENSQU1fU1dBQl8zMihvcHRfZWRpdGlv
bik7DQorCXN1cGVyLT5mc2lkLmJsb2NrcyA9IENSQU1fU1dBQl8zMih0b3Rh
bF9ibG9ja3MpOw0KKwlzdXBlci0+ZnNpZC5maWxlcyA9IENSQU1fU1dBQl8z
Mih0b3RhbF9ub2Rlcyk7DQogDQogCW1lbXNldChzdXBlci0+bmFtZSwgMHgw
MCwgc2l6ZW9mKHN1cGVyLT5uYW1lKSk7DQogCWlmIChvcHRfbmFtZSkNCkBA
IC0zMzcsMTEgKzMzOCwxMSBAQA0KIAllbHNlDQogCQlzdHJuY3B5KHN1cGVy
LT5uYW1lLCAiQ29tcHJlc3NlZCIsIHNpemVvZihzdXBlci0+bmFtZSkpOw0K
IA0KLQlzdXBlci0+cm9vdC5tb2RlID0gcm9vdC0+bW9kZTsNCi0Jc3VwZXIt
PnJvb3QudWlkID0gcm9vdC0+dWlkOw0KKwlzdXBlci0+cm9vdC5tb2RlID0g
Q1JBTV9TV0FCXzE2KHJvb3QtPm1vZGUpOw0KKwlzdXBlci0+cm9vdC51aWQg
PSBDUkFNX1NXQUJfMTYocm9vdC0+dWlkKTsNCiAJc3VwZXItPnJvb3QuZ2lk
ID0gcm9vdC0+Z2lkOw0KLQlzdXBlci0+cm9vdC5zaXplID0gcm9vdC0+c2l6
ZTsNCi0Jc3VwZXItPnJvb3Qub2Zmc2V0ID0gb2Zmc2V0ID4+IDI7DQorCXN1
cGVyLT5yb290LnNpemUgPSBDUkFNX1NXQUJfMjQocm9vdC0+c2l6ZSk7DQor
CVNFVF9DUkFNX09GRlNFVCgmKHN1cGVyLT5yb290KSwgb2Zmc2V0ID4+IDIp
Ow0KIA0KIAlyZXR1cm4gb2Zmc2V0Ow0KIH0NCkBAIC0zNTYsNyArMzU3LDcg
QEANCiAJCWZwcmludGYoc3RkZXJyLCAiZmlsZXN5c3RlbSB0b28gYmlnLiAg
RXhpdGluZy5cbiIpOw0KIAkJZXhpdCg4KTsNCiAJfQ0KLQlpbm9kZS0+b2Zm
c2V0ID0gKG9mZnNldCA+PiAyKTsNCisJU0VUX0NSQU1fT0ZGU0VUKGlub2Rl
LCBvZmZzZXQgPj4gMik7DQogfQ0KIA0KIA0KQEAgLTM3OSwxMCArMzgwLDEw
IEBADQogDQogCQkJZW50cnktPmRpcl9vZmZzZXQgPSBvZmZzZXQ7DQogDQot
CQkJaW5vZGUtPm1vZGUgPSBlbnRyeS0+bW9kZTsNCi0JCQlpbm9kZS0+dWlk
ID0gZW50cnktPnVpZDsNCisJCQlpbm9kZS0+bW9kZSA9IENSQU1fU1dBQl8x
NihlbnRyeS0+bW9kZSk7DQorCQkJaW5vZGUtPnVpZCA9IENSQU1fU1dBQl8x
NihlbnRyeS0+dWlkKTsNCiAJCQlpbm9kZS0+Z2lkID0gZW50cnktPmdpZDsN
Ci0JCQlpbm9kZS0+c2l6ZSA9IGVudHJ5LT5zaXplOw0KKwkJCWlub2RlLT5z
aXplID0gQ1JBTV9TV0FCXzI0KGVudHJ5LT5zaXplKTsNCiAJCQlpbm9kZS0+
b2Zmc2V0ID0gMDsNCiAJCQkvKiBOb24tZW1wdHkgZGlyZWN0b3JpZXMsIHJl
Z2ZpbGVzIGFuZCBzeW1saW5rcyB3aWxsDQogCQkJICAgd3JpdGUgb3ZlciBp
bm9kZS0+b2Zmc2V0IGxhdGVyLiAqLw0KQEAgLTM5NSw3ICszOTYsNyBAQA0K
IAkJCQkqKGJhc2UgKyBvZmZzZXQgKyBsZW4pID0gJ1wwJzsNCiAJCQkJbGVu
Kys7DQogCQkJfQ0KLQkJCWlub2RlLT5uYW1lbGVuID0gbGVuID4+IDI7DQor
CQkJU0VUX0NSQU1fTkFNRUxFTihpbm9kZSwgbGVuID4+IDIpOw0KIAkJCW9m
ZnNldCArPSBsZW47DQogDQogCQkJLyogVE9ETzogdGhpcyBtYXkgZ2V0IGl0
IHdyb25nIGZvciBjaGFycyA+PSAweDgwLg0KQEAgLTUwMyw3ICs1MDQsNyBA
QA0KIAkJCWV4aXQoOCk7DQogCQl9DQogDQotCQkqKHUzMiAqKSAoYmFzZSAr
IG9mZnNldCkgPSBjdXJyOw0KKwkJKih1MzIgKikgKGJhc2UgKyBvZmZzZXQp
ID0gQ1JBTV9TV0FCXzMyKGN1cnIpOw0KIAkJb2Zmc2V0ICs9IDQ7DQogCX0g
d2hpbGUgKHNpemUpOw0KIA0K
--17438721-1929461958-1001714293=:9055--
