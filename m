Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261472AbUEFL7D@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261472AbUEFL7D (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 6 May 2004 07:59:03 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261418AbUEFL7D
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 6 May 2004 07:59:03 -0400
Received: from mx1.redhat.com ([66.187.233.31]:53706 "EHLO mx1.redhat.com")
	by vger.kernel.org with ESMTP id S262026AbUEFL7A (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Thu, 6 May 2004 07:59:00 -0400
From: David Howells <dhowells@redhat.com>
To: torvalds@osdl.org, akpm@osdl.org
Cc: linux-kernel@vger.kernel.org
Subject: [PATCH] get rid of "+m" constraint in i386 rwsems
User-Agent: EMH/1.14.1 SEMI/1.14.4 (Hosorogi) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 Emacs/21.3 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.4 - "Hosorogi")
Content-Type: text/plain; charset=US-ASCII
Date: Thu, 06 May 2004 12:58:53 +0100
Message-ID: <4955.1083844733@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


Hi Linus, Andrew,

Here's a patch to remove the usage of a "+m" constraint in the i386 optimised
rwsem implementation.

David


--- ./include/asm-i386/rwsem.h.orig     2004-05-06 12:54:38.000000000 +0100
+++ ./include/asm-i386/rwsem.h  2004-05-06 12:55:09.000000000 +0100
@@ -134,8 +134,8 @@ LOCK_PREFIX "  cmpxchgl  %2,%0\n\t"
                "  jnz       1b\n\t"
                "2:\n\t"
                "# ending __down_read_trylock\n\t"
-               : "+m"(sem->count), "=&a"(result), "=&r"(tmp)
-               : "i"(RWSEM_ACTIVE_READ_BIAS)
+               : "=m"(sem->count), "=&a"(result), "=&r"(tmp)
+               : "i"(RWSEM_ACTIVE_READ_BIAS), "m"(sem->count)
                : "memory", "cc");
        return result>=0 ? 1 : 0;
 }
