Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1751903AbWFLMOQ@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751903AbWFLMOQ (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 12 Jun 2006 08:14:16 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751905AbWFLMOQ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 12 Jun 2006 08:14:16 -0400
Received: from cantor2.suse.de ([195.135.220.15]:35734 "EHLO mx2.suse.de")
	by vger.kernel.org with ESMTP id S1751903AbWFLMOQ (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 12 Jun 2006 08:14:16 -0400
To: Ingo Molnar <mingo@elte.hu>
Cc: Michal Piotrowski <michal.k.k.piotrowski@gmail.com>,
       Andrew Morton <akpm@osdl.org>, linux-kernel@vger.kernel.org
Subject: Re: 2.6.16-rc6-mm2
References: <20060609214024.2f7dd72c.akpm@osdl.org>
	<6bffcb0e0606100323p122e9b23g37350fa9692337ae@mail.gmail.com>
	<20060610092412.66dd109f.akpm@osdl.org>
	<Pine.LNX.4.64.0606100939480.6651@schroedinger.engr.sgi.com>
	<Pine.LNX.4.64.0606100951340.7174@schroedinger.engr.sgi.com>
	<20060610100318.8900f849.akpm@osdl.org>
	<Pine.LNX.4.64.0606101102380.7421@schroedinger.engr.sgi.com>
	<6bffcb0e0606101114u37c8b642u5c9cc8dd566cba7c@mail.gmail.com>
	<Pine.LNX.4.64.0606101118410.7535@schroedinger.engr.sgi.com>
	<20060612110537.GA11358@elte.hu> <20060612114857.GA14616@elte.hu>
From: Andi Kleen <ak@suse.de>
Date: 12 Jun 2006 14:14:09 +0200
In-Reply-To: <20060612114857.GA14616@elte.hu>
Message-ID: <p73irn6sh9q.fsf@verdi.suse.de>
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.3
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Ingo Molnar <mingo@elte.hu> writes:

> * Ingo Molnar <mingo@elte.hu> wrote:
> 
> > 
> > * Christoph Lameter <clameter@sgi.com> wrote:
> > 
> > > Sorry that patch was still against mm1. Here is a fixed up version 
> > > that applies cleanly against mm2:
> > 
> > i have applied both patches you sent in this thread but it still 
> > triggers tons of messages:
> 
> > trying to fix it i realized that i'd have to touch tons of 
> > architectures, which all duplicate this piece of code:
> 
> below is an updated patch that includes fixups for i386 - but the real 
> fix should be to properly reduce the per-arch local.h footprint to the 
> bare minimum possible, and to do this fix on the asm-generic headers.

I think an even better approach would be to use local_save_flags() / 
local_restore_flags () and then use a normal increment and get
rid of smp_processor_id completely.

I've never seen any evidence that the complex and bloated code generated by 
this is any better that just enabling/disabling interrupts. 

In the x86 world P4 has costly cli/sti, but I wouldn't expect
that problem to be very widespread.

-Andi
