Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932191AbVIHHj2@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932191AbVIHHj2 (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 8 Sep 2005 03:39:28 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751331AbVIHHj2
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 8 Sep 2005 03:39:28 -0400
Received: from shop.atmark-techno.com ([210.191.215.173]:38605 "EHLO
	mail2.atmark-techno.com") by vger.kernel.org with ESMTP
	id S1751330AbVIHHj1 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 8 Sep 2005 03:39:27 -0400
Date: Thu, 08 Sep 2005 16:39:23 +0900
Message-ID: <87y868dn4k.wl@mail2.atmark-techno.com>
From: Yasushi SHOJI <yashi@atmark-techno.com>
To: Greg Ungerer <gerg@snapgear.com>
Cc: Christoph Hellwig <hch@infradead.org>, linux-kernel@vger.kernel.org,
       Janos Farkas <jf-ml-k1-1087813225@lk8rp.mail.xeon.eu.org>
Subject: Re: [PATCH] add romfs_get_size()
In-Reply-To: <431FE33E.1000607@snapgear.com>
References: <87k6htt0tg.wl@mail2.atmark-techno.com>
	<20050907142604.GA5822@infradead.org>
	<87irxdt0dz.wl@mail2.atmark-techno.com>
	<20050907150439.GA6646@infradead.org>
	<87fysguc1d.wl@mail2.atmark-techno.com>
	<431FE33E.1000607@snapgear.com>
User-Agent: Wanderlust/2.14.0
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Greg,

At Thu, 08 Sep 2005 17:07:42 +1000,
Greg Ungerer wrote:
> 
> Yasushi SHOJI wrote:
> > At Wed, 7 Sep 2005 16:04:39 +0100,
> > Christoph Hellwig wrote:
> > 
> >>On Wed, Sep 07, 2005 at 11:31:36PM +0900, Yasushi SHOJI wrote:
> >>
> >>>>On Wed, Sep 07, 2005 at 11:22:19PM +0900, Yasushi SHOJI wrote:
> >>>>
> >>>>>Many embedded linux products have been using romfs and it's still
> >>>>>growing.  most, if not all, of them implement thier own way to check
> >>>>>its romfs size.
> >>>>>
> >>>>>this patch provides this commonly used function.
> >>>>
> >>>>Used where.  Please come back as soon as you have a caller in-tree
> >>>>which makes sense..
> >>>
> >>>i don't know this one make sense but the biggest user is uclinux mtd
> >>>map. in uclinux_mtd_init():
> >>
> >>I don't quite see the corelation.  Anyway, please submit a patch series
> >>that converts whatever wrong variant to the new one, describing each
> >>patch in detail, and adding proper ROMFS depencies to the places using
> >>it.
> > 
> > 
> > I don't have most of platform to test. sure it's easy to just convert
> > them using romfs_get_size() but I don't wanna submit any patch that I
> > can't test.
> > 
> > So, if the patch is not that bad, it'd be much easier to just tell all
> > platform maintainer that the infra. is in place and they can start
> > converting their code to use new function.
> > 
> > Anyway I just converted uclinux.c to use romfs_get_size(). Greg, would
> > you kindly comment on the attached patch?
> 
> I don't see any problem with it.

great.

> The uclinux.c code as it stands is probably a little sloppy.
> It doesn't do any checks for a valid ROMfs first - it should at
> least check the magic number.

Yeah that's right. At least with romfs_get_size(), we can check the
return val to see it ok or not. it might be better if we have

    mapp->size = PAGE_ALIGN(romfs_get_size((struct romfs_super_block *)&_ebss));
    if (mapp->size != -1)

kind of code. what we can do once we detected mismatched magic number
is deferment story, though. ;)

regards,
--
         yashi
