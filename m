Return-Path: <linux-kernel-owner+w=401wt.eu-S965081AbXADWtF@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S965081AbXADWtF (ORCPT <rfc822;w@1wt.eu>);
	Thu, 4 Jan 2007 17:49:05 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1030181AbXADWtF
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 4 Jan 2007 17:49:05 -0500
Received: from smtp.osdl.org ([65.172.181.24]:33081 "EHLO smtp.osdl.org"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S965088AbXADWtD (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 4 Jan 2007 17:49:03 -0500
Date: Thu, 4 Jan 2007 14:48:25 -0800
From: Andrew Morton <akpm@osdl.org>
To: Stelian Pop <stelian@popies.net>
Cc: Linux Kernel Mailing List <linux-kernel@vger.kernel.org>,
       Linus Torvalds <torvalds@osdl.org>, mchehab@infradead.org,
       v4l-dvb-maintainer@linuxtv.org
Subject: Re: [PATCH] Fix __ucmpdi2 in v4l2_norm_to_name()
Message-Id: <20070104144825.68fec948.akpm@osdl.org>
In-Reply-To: <1167909014.20853.8.camel@localhost.localdomain>
References: <1167909014.20853.8.camel@localhost.localdomain>
X-Mailer: Sylpheed version 2.2.7 (GTK+ 2.8.6; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, 04 Jan 2007 12:10:14 +0100
Stelian Pop <stelian@popies.net> wrote:

> Hi,
> 
> This patch replaces a switch statement using 64 bit values with the
> if/else equivalent in order to prevent a call __ucmpdi2 generated by
> some versions of gcc (verified with gcc-4.1.2 20060928):
> 
> 	drivers/built-in.o: In function `v4l2_norm_to_name':
> 	(.text+0x71100): undefined reference to `__ucmpdi2'
> 
> Signed-off-by: Stelian Pop <stelian@popies.net>
> 
> ---
> 
>  drivers/media/video/v4l2-common.c |  126 ++++++++++++++++++-------------------
>  1 files changed, 62 insertions(+), 64 deletions(-)
> 
> diff --git a/drivers/media/video/v4l2-common.c b/drivers/media/video/v4l2-common.c
> index 752c82c..0c3c2f6 100644
> --- a/drivers/media/video/v4l2-common.c
> +++ b/drivers/media/video/v4l2-common.c
> @@ -91,70 +91,68 @@ char *v4l2_norm_to_name(v4l2_std_id id)
>  {
>  	char *name;
>  
> -	switch (id) {

It'd be simpler to just do

	switch ((unsigned int)id) {

here (with a suitable comment).

The largest value we use here is 0x02000000.  Perhaps v4l2_std_id shouldn't
be 64-bit?

