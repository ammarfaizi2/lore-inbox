Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932196AbWJASyB@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932196AbWJASyB (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 1 Oct 2006 14:54:01 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932198AbWJASyA
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 1 Oct 2006 14:54:00 -0400
Received: from mout1.freenet.de ([194.97.50.132]:33670 "EHLO mout1.freenet.de")
	by vger.kernel.org with ESMTP id S932196AbWJASx7 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 1 Oct 2006 14:53:59 -0400
Date: Sun, 01 Oct 2006 20:54:41 +0200
To: "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
Subject: [PATCH 3/4] 2.6.18-mm2 pktcdvd: restructure code
Reply-To: balagi@justmail.de
From: "Thomas Maier" <balagi@justmail.de>
Cc: "petero2@telia.com" <petero2@telia.com>, akpm@osdl.org
Content-Type: multipart/mixed; boundary=----------Y2hhvRwqcIOZiECmWFyQeq
MIME-Version: 1.0
Message-ID: <op.tgratfqriudtyh@master>
User-Agent: Opera Mail/9.00 (Win32)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------------Y2hhvRwqcIOZiECmWFyQeq
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit

Hi,

this patch 3/4 for pktcdvd against Linux 2.6.18 (stable)
or 2.6.18-mm2 restructures the code for better readability
and prepares it for the sysfs interface code following in patch 4/4.

You must first apply patch 1/4 and 2/4 !

Sorry, my mail client damages the patch, so please use the (text) attachment
or get the patch from
http://people.freenet.de/BalaGi/download/3-restruct-pktcdvd-patch-2.6.18

The merged patch (parts 1 to 4) is available at:
http://people.freenet.de/BalaGi/download/pktcdvd-patch-2.6.18

Signed-off-by: Thomas Maier<balagi@justmail.de>
------------Y2hhvRwqcIOZiECmWFyQeq
Content-Disposition: attachment; filename=3-restruct-pktcdvd-patch-2.6.18
Content-Type: application/octet-stream; name=3-restruct-pktcdvd-patch-2.6.18
Content-Transfer-Encoding: Base64

ZGlmZiAtdXJwTiBwMi1wcm9jZnMvZHJpdmVycy9ibG9jay9wa3RjZHZkLmMgcDMt
cmVzdHJ1Y3QvZHJpdmVycy9ibG9jay9wa3RjZHZkLmMKLS0tIHAyLXByb2Nmcy9k
cml2ZXJzL2Jsb2NrL3BrdGNkdmQuYwkyMDA2LTEwLTAxIDE4OjExOjM1LjAwMDAw
MDAwMCArMDIwMAorKysgcDMtcmVzdHJ1Y3QvZHJpdmVycy9ibG9jay9wa3RjZHZk
LmMJMjAwNi0xMC0wMSAxOToxODowNS4wMDAwMDAwMDAgKzAyMDAKQEAgLTg0LDE1
ICs4NCwyNDkgQEAKIAogI2RlZmluZSBaT05FKHNlY3RvciwgcGQpICgoKHNlY3Rv
cikgKyAocGQpLT5vZmZzZXQpICYgfigocGQpLT5zZXR0aW5ncy5zaXplIC0gMSkp
CiAKKy8qIG1vZHVsZSBwYXJhbWV0ZXJzICovCitzdGF0aWMgaW50IHBrdGRldl9t
YWpvciA9IDA7IC8qIGRlZmF1bHQ6IGR5bmFtaWMgbWFqb3IgbnVtYmVyICovCisK
Kwogc3RhdGljIHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGt0X2RldnNbTUFYX1dS
SVRFUlNdOwotI2lmIFBLVF9VU0VfUFJPQ0ZTCi1zdGF0aWMgc3RydWN0IHByb2Nf
ZGlyX2VudHJ5ICpwa3RfcHJvYzsKLSNlbmRpZgotc3RhdGljIGludCBwa3RfbWFq
b3I7CiBzdGF0aWMgc3RydWN0IG11dGV4IGN0bF9tdXRleDsJLyogU2VyaWFsaXpl
IG9wZW4vY2xvc2Uvc2V0dXAvdGVhcmRvd24gKi8KIHN0YXRpYyBtZW1wb29sX3Qg
KnBzZF9wb29sOwogCiAKKy8qIGZvcndhcmQgZGVjbGFyYXRpb24gKi8KK3N0YXRp
YyBpbnQgcGt0X3NldHVwX2RldihkZXZfdCBkZXYsIGRldl90KiBwa3RfZGV2KTsK
K3N0YXRpYyBpbnQgcGt0X3JlbW92ZV9kZXYoZGV2X3QgcGt0X2Rldik7CisKKwor
LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCisgKiB1dGlscworICoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCisKK3N0YXRpYyBzdHJ1Y3Qg
cGt0Y2R2ZF9kZXZpY2UgKnBrdF9maW5kX2Rldl9mcm9tX21pbm9yKGludCBkZXZf
bWlub3IpCit7CisJaWYgKGRldl9taW5vciA+PSBNQVhfV1JJVEVSUykKKwkJcmV0
dXJuIE5VTEw7CisJcmV0dXJuIHBrdF9kZXZzW2Rldl9taW5vcl07Cit9CisKK3N0
YXRpYyBzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBrdF9maW5kX2RldihkZXZfdCBk
ZXZpZCwgaW50KiBwaWR4KQoreworCWludCBpZHg7CisJZm9yIChpZHggPSAwOyBp
ZHggPCBNQVhfV1JJVEVSUzsgaWR4KyspIHsKKwkJc3RydWN0IHBrdGNkdmRfZGV2
aWNlICpwZCA9IHBrdF9kZXZzW2lkeF07CisJCWlmIChwZCAmJiAocGQtPnBrdF9k
ZXYgPT0gZGV2aWQpKSB7CisJCQlpZiAocGlkeCkKKwkJCQkqcGlkeCA9IGlkeDsK
KwkJCXJldHVybiBwZDsKKwkJfQorCX0KKwlpZiAocGlkeCkKKwkJKnBpZHggPSAw
OworCXJldHVybiBOVUxMOworfQorCitzdGF0aWMgc3RydWN0IHBrdGNkdmRfZGV2
aWNlICpwa3RfZmluZF9kZXZfYmRldihkZXZfdCBiZGV2aWQsIGludCogcGlkeCkK
K3sKKwlpbnQgaWR4OworCWZvciAoaWR4ID0gMDsgaWR4IDwgTUFYX1dSSVRFUlM7
IGlkeCsrKSB7CisJCXN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQgPSBwa3RfZGV2
c1tpZHhdOworCQlpZiAocGQgJiYgcGQtPmJkZXYgJiYgKHBkLT5iZGV2LT5iZF9k
ZXYgPT0gYmRldmlkKSkgeworCQkJaWYgKHBpZHgpCisJCQkJKnBpZHggPSBpZHg7
CisJCQlyZXR1cm4gcGQ7CisJCX0KKwl9CisJaWYgKHBpZHgpCisJCSpwaWR4ID0g
MDsKKwlyZXR1cm4gTlVMTDsKK30KKworc3RhdGljIHZvaWQgcGt0X2NvdW50X3N0
YXRlcyhzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkLCBpbnQgKnN0YXRlcykKK3sK
KwlzdHJ1Y3QgcGFja2V0X2RhdGEgKnBrdDsKKwlpbnQgaTsKKworCWZvciAoaSA9
IDA7IGkgPCBQQUNLRVRfTlVNX1NUQVRFUzsgaSsrKQorCQlzdGF0ZXNbaV0gPSAw
OworCisJc3Bpbl9sb2NrKCZwZC0+Y2Rydy5hY3RpdmVfbGlzdF9sb2NrKTsKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5KHBrdCwgJnBkLT5jZHJ3LnBrdF9hY3RpdmVfbGlz
dCwgbGlzdCkgeworCQlzdGF0ZXNbcGt0LT5zdGF0ZV0rKzsKKwl9CisJc3Bpbl91
bmxvY2soJnBkLT5jZHJ3LmFjdGl2ZV9saXN0X2xvY2spOworfQorCitzdGF0aWMg
aW50IHBrdF9wcmludF9pbmZvKHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQsIGNo
YXIgKmJ1ZiwgaW50IGJsZW4pCit7CisJY2hhciAqbXNnOworCWNoYXIgYmRldl9i
dWZbQkRFVk5BTUVfU0laRV07CisJaW50IHN0YXRlc1tQQUNLRVRfTlVNX1NUQVRF
U107CisJaW50IG4gPSAwOworCisjZGVmaW5lIFBSSU5UCW4gKz0gc2NucHJpbnRm
CisjZGVmaW5lIEJDCWJ1ZituLCBibGVuLW4KKwlQUklOVChCQywgIldyaXRlciAl
cyBtYXBwZWQgdG8gJXM6XG4iLCBwZC0+bmFtZSwKKwkJICAgCQliZGV2bmFtZShw
ZC0+YmRldiwgYmRldl9idWYpKTsKKworCVBSSU5UKEJDLCAiXG5TZXR0aW5nczpc
biIpOworCVBSSU5UKEJDLCAiXHRwYWNrZXQgc2l6ZTpcdFx0JWRrQlxuIiwgcGQt
PnNldHRpbmdzLnNpemUgLyAyKTsKKworCWlmIChwZC0+c2V0dGluZ3Mud3JpdGVf
dHlwZSA9PSAwKQorCQltc2cgPSAiUGFja2V0IjsKKwllbHNlCisJCW1zZyA9ICJV
bmtub3duIjsKKwlQUklOVChCQywgIlx0d3JpdGUgdHlwZTpcdFx0JXNcbiIsIG1z
Zyk7CisKKwlQUklOVChCQywgIlx0cGFja2V0IHR5cGU6XHRcdCVzXG4iLCBwZC0+
c2V0dGluZ3MuZnAgPyAiRml4ZWQiIDogIlZhcmlhYmxlIik7CisJUFJJTlQoQkMs
ICJcdGxpbmsgbG9zczpcdFx0JWRcbiIsIHBkLT5zZXR0aW5ncy5saW5rX2xvc3Mp
OworCisJUFJJTlQoQkMsICJcdHRyYWNrIG1vZGU6XHRcdCVkXG4iLCBwZC0+c2V0
dGluZ3MudHJhY2tfbW9kZSk7CisKKwlpZiAocGQtPnNldHRpbmdzLmJsb2NrX21v
ZGUgPT0gUEFDS0VUX0JMT0NLX01PREUxKQorCQltc2cgPSAiTW9kZSAxIjsKKwll
bHNlIGlmIChwZC0+c2V0dGluZ3MuYmxvY2tfbW9kZSA9PSBQQUNLRVRfQkxPQ0tf
TU9ERTIpCisJCW1zZyA9ICJNb2RlIDIiOworCWVsc2UKKwkJbXNnID0gIlVua25v
d24iOworCVBSSU5UKEJDLCAiXHRibG9jayBtb2RlOlx0XHQlc1xuIiwgbXNnKTsK
KworCVBSSU5UKEJDLCAiXG5TdGF0aXN0aWNzOlxuIik7CisJUFJJTlQoQkMsICJc
dHBhY2tldHMgc3RhcnRlZDpcdCVsdVxuIiwgcGQtPnN0YXRzLnBrdF9zdGFydGVk
KTsKKwlQUklOVChCQywgIlx0cGFja2V0cyBlbmRlZDpcdFx0JWx1XG4iLCBwZC0+
c3RhdHMucGt0X2VuZGVkKTsKKwlQUklOVChCQywgIlx0d3JpdHRlbjpcdFx0JWx1
a0JcbiIsIHBkLT5zdGF0cy5zZWNzX3cgPj4gMSk7CisJUFJJTlQoQkMsICJcdHJl
YWQgZ2F0aGVyOlx0XHQlbHVrQlxuIiwgcGQtPnN0YXRzLnNlY3NfcmcgPj4gMSk7
CisJUFJJTlQoQkMsICJcdHJlYWQ6XHRcdFx0JWx1a0JcbiIsIHBkLT5zdGF0cy5z
ZWNzX3IgPj4gMSk7CisKKwlQUklOVChCQywgIlxuTWlzYzpcbiIpOworCVBSSU5U
KEJDLCAiXHRyZWZlcmVuY2UgY291bnQ6XHQlZFxuIiwgcGQtPnJlZmNudCk7CisJ
UFJJTlQoQkMsICJcdGZsYWdzOlx0XHRcdDB4JWx4XG4iLCBwZC0+ZmxhZ3MpOwor
CVBSSU5UKEJDLCAiXHRyZWFkIHNwZWVkOlx0XHQldWtCL3NcbiIsIHBkLT5yZWFk
X3NwZWVkKTsKKwlQUklOVChCQywgIlx0d3JpdGUgc3BlZWQ6XHRcdCV1a0Ivc1xu
IiwgcGQtPndyaXRlX3NwZWVkKTsKKwlQUklOVChCQywgIlx0c3RhcnQgb2Zmc2V0
Olx0XHQlbHVcbiIsIHBkLT5vZmZzZXQpOworCVBSSU5UKEJDLCAiXHRtb2RlIHBh
Z2Ugb2Zmc2V0Olx0JXVcbiIsIHBkLT5tb2RlX29mZnNldCk7CisKKwlQUklOVChC
QywgIlxuUXVldWUgc3RhdGU6XG4iKTsKKwlQUklOVChCQywgIlx0YmlvcyBxdWV1
ZWQ6XHRcdCVkXG4iLCBwZC0+YmlvX3F1ZXVlX3NpemUpOworCVBSSU5UKEJDLCAi
XHRiaW9zIHBlbmRpbmc6XHRcdCVkXG4iLCBhdG9taWNfcmVhZCgmcGQtPmNkcncu
cGVuZGluZ19iaW9zKSk7CisJUFJJTlQoQkMsICJcdGN1cnJlbnQgc2VjdG9yOlx0
XHQweCVsbHhcbiIsCisJCQkJCSh1bnNpZ25lZCBsb25nIGxvbmcpcGQtPmN1cnJl
bnRfc2VjdG9yKTsKKworCXBrdF9jb3VudF9zdGF0ZXMocGQsIHN0YXRlcyk7CisJ
UFJJTlQoQkMsICJcdHN0YXRlOlx0XHRcdGk6JWQgb3c6JWQgcnc6JWQgd3c6JWQg
cmVjOiVkIGZpbjolZFxuIiwKKwkgICAgICBzdGF0ZXNbMF0sIHN0YXRlc1sxXSwg
c3RhdGVzWzJdLCBzdGF0ZXNbM10sIHN0YXRlc1s0XSwgc3RhdGVzWzVdKTsKKyN1
bmRlZiBQUklOVAorI3VuZGVmIEJDCisJYnVmW2JsZW4tMV0gPSAwOworCXJldHVy
biBuOworfQorCisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioKKyAqCisgKiAob2xkKSBwcm9jZnMgaW50ZXJm
YWNlCisgKgorICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKiovCisjaWYgUEtUX1VTRV9QUk9DRlMKK3N0YXRpYyBz
dHJ1Y3QgcHJvY19kaXJfZW50cnkgKnBrdF9wcm9jOworCisvKiBmaWxlIG9wZXJh
dGlvbnMgZm9yIC9wcm9jL2RyaXZlci9wa3RjZHZkLy4uIGZpbGVzICovCisKK3N0
YXRpYyBpbnQgcGt0X3NlcV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
cCkKK3sKKwlzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkID0gbS0+cHJpdmF0ZTsK
KwljaGFyIGJ1ZlsxMDI0XTsKKwkKKwlwa3RfcHJpbnRfaW5mbyhwZCwgYnVmLCBz
aXplb2YoYnVmKSk7CisJc2VxX3ByaW50ZihtLCAiJXMiLCBidWYpOworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IHBrdF9zZXFfb3BlbihzdHJ1Y3QgaW5vZGUg
Kmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlyZXR1cm4gc2luZ2xlX29w
ZW4oZmlsZSwgcGt0X3NlcV9zaG93LCBQREUoaW5vZGUpLT5kYXRhKTsKK30KKwor
c3RhdGljIHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgcGt0X3Byb2NfZm9wcyA9IHsK
Kwkub3Blbgk9IHBrdF9zZXFfb3BlbiwKKwkucmVhZAk9IHNlcV9yZWFkLAorCS5s
bHNlZWsJPSBzZXFfbHNlZWssCisJLnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZQor
fTsKKworc3RhdGljIHZvaWQgcGt0X2dldF9zdGF0dXMoc3RydWN0IHBrdF9jdHJs
X2NvbW1hbmQgKmN0cmxfY21kKQoreworCXN0cnVjdCBwa3RjZHZkX2RldmljZSAq
cGQ7CisJCisJbXV0ZXhfbG9ja19uZXN0ZWQoJmN0bF9tdXRleCwgU0lOR0xFX0RF
UFRIX05FU1RJTkcpOworCQorCXBkID0gcGt0X2ZpbmRfZGV2X2Zyb21fbWlub3Io
Y3RybF9jbWQtPmRldl9pbmRleCk7CisJaWYgKHBkKSB7CisJCWN0cmxfY21kLT5k
ZXYgPSBuZXdfZW5jb2RlX2RldihwZC0+YmRldi0+YmRfZGV2KTsKKwkJY3RybF9j
bWQtPnBrdF9kZXYgPSBuZXdfZW5jb2RlX2RldihwZC0+cGt0X2Rldik7CisJfSBl
bHNlIHsKKwkJY3RybF9jbWQtPmRldiA9IDA7CisJCWN0cmxfY21kLT5wa3RfZGV2
ID0gMDsKKwl9CisJY3RybF9jbWQtPm51bV9kZXZpY2VzID0gTUFYX1dSSVRFUlM7
CisJCisJbXV0ZXhfdW5sb2NrKCZjdGxfbXV0ZXgpOworfQorCitzdGF0aWMgaW50
IHBrdF9jdGxfaW9jdGwoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUg
KmZpbGUsCisJCQl1bnNpZ25lZCBpbnQgY21kLCB1bnNpZ25lZCBsb25nIGFyZykK
K3sKKwl2b2lkIF9fdXNlciAqYXJncCA9ICh2b2lkIF9fdXNlciAqKWFyZzsKKwlz
dHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCBjdHJsX2NtZDsKKwlpbnQgcmV0ID0gMDsK
KwlkZXZfdCBwa3RfZGV2ID0gMDsKKworCWlmIChjbWQgIT0gUEFDS0VUX0NUUkxf
Q01EKQorCQlyZXR1cm4gLUVOT1RUWTsKKworCWlmIChjb3B5X2Zyb21fdXNlcigm
Y3RybF9jbWQsIGFyZ3AsIHNpemVvZihzdHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCkp
KQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXN3aXRjaCAoY3RybF9jbWQuY29tbWFu
ZCkgeworCWNhc2UgUEtUX0NUUkxfQ01EX1NFVFVQOgorCQlpZiAoIWNhcGFibGUo
Q0FQX1NZU19BRE1JTikpCisJCQlyZXR1cm4gLUVQRVJNOworCQlyZXQgPSBwa3Rf
c2V0dXBfZGV2KG5ld19kZWNvZGVfZGV2KGN0cmxfY21kLmRldiksICZwa3RfZGV2
KTsKKwkJY3RybF9jbWQucGt0X2RldiA9IG5ld19lbmNvZGVfZGV2KHBrdF9kZXYp
OworCQlicmVhazsKKwljYXNlIFBLVF9DVFJMX0NNRF9URUFSRE9XTjoKKwkJaWYg
KCFjYXBhYmxlKENBUF9TWVNfQURNSU4pKQorCQkJcmV0dXJuIC1FUEVSTTsKKwkJ
cmV0ID0gcGt0X3JlbW92ZV9kZXYobmV3X2RlY29kZV9kZXYoY3RybF9jbWQucGt0
X2RldikpOworCQlicmVhazsKKwljYXNlIFBLVF9DVFJMX0NNRF9TVEFUVVM6CisJ
CXBrdF9nZXRfc3RhdHVzKCZjdHJsX2NtZCk7CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCXJldHVybiAtRU5PVFRZOworCX0KKworCWlmIChjb3B5X3RvX3VzZXIoYXJn
cCwgJmN0cmxfY21kLCBzaXplb2Yoc3RydWN0IHBrdF9jdHJsX2NvbW1hbmQpKSkK
KwkJcmV0dXJuIC1FRkFVTFQ7CisJcmV0dXJuIHJldDsKK30KKworCitzdGF0aWMg
c3RydWN0IGZpbGVfb3BlcmF0aW9ucyBwa3RfY3RsX2ZvcHMgPSB7CisJLmlvY3Rs
CSA9IHBrdF9jdGxfaW9jdGwsCisJLm93bmVyCSA9IFRISVNfTU9EVUxFLAorfTsK
Kworc3RhdGljIHN0cnVjdCBtaXNjZGV2aWNlIHBrdF9taXNjID0geworCS5taW5v
ciAJCT0gTUlTQ19EWU5BTUlDX01JTk9SLAorCS5uYW1lICAJCT0gRFJJVkVSX05B
TUUsCisJLmZvcHMgIAkJPSAmcGt0X2N0bF9mb3BzCit9OworCisjZW5kaWYgLyog
UEtUX1VTRV9QUk9DRlMgKi8KKworCisvKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKworCiBz
dGF0aWMgdm9pZCBwa3RfYmlvX2ZpbmlzaGVkKHN0cnVjdCBwa3RjZHZkX2Rldmlj
ZSAqcGQpCiB7CiAJQlVHX09OKGF0b21pY19yZWFkKCZwZC0+Y2Rydy5wZW5kaW5n
X2Jpb3MpIDw9IDApOwpAQCAtMTE3MywyMSArMTQwNyw2IEBAIHN0YXRpYyB2b2lk
IHBrdF9oYW5kbGVfcGFja2V0cyhzdHJ1Y3QgcGsKIAlzcGluX3VubG9jaygmcGQt
PmNkcncuYWN0aXZlX2xpc3RfbG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIHBrdF9j
b3VudF9zdGF0ZXMoc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCwgaW50ICpzdGF0
ZXMpCi17Ci0Jc3RydWN0IHBhY2tldF9kYXRhICpwa3Q7Ci0JaW50IGk7Ci0KLQlm
b3IgKGkgPSAwOyBpIDwgUEFDS0VUX05VTV9TVEFURVM7IGkrKykKLQkJc3RhdGVz
W2ldID0gMDsKLQotCXNwaW5fbG9jaygmcGQtPmNkcncuYWN0aXZlX2xpc3RfbG9j
ayk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeShwa3QsICZwZC0+Y2Rydy5wa3RfYWN0
aXZlX2xpc3QsIGxpc3QpIHsKLQkJc3RhdGVzW3BrdC0+c3RhdGVdKys7Ci0JfQot
CXNwaW5fdW5sb2NrKCZwZC0+Y2Rydy5hY3RpdmVfbGlzdF9sb2NrKTsKLX0KLQog
LyoKICAqIGtjZHJ3ZCBpcyB3b2tlbiB1cCB3aGVuIHdyaXRlcyBoYXZlIGJlZW4g
cXVldWVkIGZvciBvbmUgb2Ygb3VyCiAgKiByZWdpc3RlcmVkIGRldmljZXMKQEAg
LTE5MTUsNTkgKzIxMzQsMjI1IEBAIHN0YXRpYyBpbnQgcGt0X29wZW5fd3JpdGUo
c3RydWN0IHBrdGNkdmQKIAlyZXR1cm4gMDsKIH0KIAotLyoKLSAqIGNhbGxlZCBh
dCBvcGVuIHRpbWUuCi0gKi8KLXN0YXRpYyBpbnQgcGt0X29wZW5fZGV2KHN0cnVj
dCBwa3RjZHZkX2RldmljZSAqcGQsIGludCB3cml0ZSkKKworc3RhdGljIGludCBw
a3RfZW5kX2lvX3JlYWRfY2xvbmVkKHN0cnVjdCBiaW8gKmJpbywgdW5zaWduZWQg
aW50IGJ5dGVzX2RvbmUsIGludCBlcnIpCiB7Ci0JaW50IHJldDsKLQlsb25nIGxi
YTsKLQlyZXF1ZXN0X3F1ZXVlX3QgKnE7CisJc3RydWN0IHBhY2tldF9zdGFja2Vk
X2RhdGEgKnBzZCA9IGJpby0+YmlfcHJpdmF0ZTsKKwlzdHJ1Y3QgcGt0Y2R2ZF9k
ZXZpY2UgKnBkID0gcHNkLT5wZDsKIAotCS8qCi0JICogV2UgbmVlZCB0byByZS1v
cGVuIHRoZSBjZHJvbSBkZXZpY2Ugd2l0aG91dCBPX05PTkJMT0NLIHRvIGJlIGFi
bGUKLQkgKiB0byByZWFkL3dyaXRlIGZyb20vdG8gaXQuIEl0IGlzIGFscmVhZHkg
b3BlbmVkIGluIE9fTk9OQkxPQ0sgbW9kZQotCSAqIHNvIGJkZ2V0KCkgY2FuJ3Qg
ZmFpbC4KLQkgKi8KLQliZGdldChwZC0+YmRldi0+YmRfZGV2KTsKLQlpZiAoKHJl
dCA9IGJsa2Rldl9nZXQocGQtPmJkZXYsIEZNT0RFX1JFQUQsIE9fUkRPTkxZKSkp
Ci0JCWdvdG8gb3V0OworCWlmIChiaW8tPmJpX3NpemUpCisJCXJldHVybiAxOwog
Ci0JaWYgKChyZXQgPSBiZF9jbGFpbShwZC0+YmRldiwgcGQpKSkKLQkJZ290byBv
dXRfcHV0ZGV2OworCWJpb19wdXQoYmlvKTsKKwliaW9fZW5kaW8ocHNkLT5iaW8s
IHBzZC0+YmlvLT5iaV9zaXplLCBlcnIpOworCW1lbXBvb2xfZnJlZShwc2QsIHBz
ZF9wb29sKTsKKwlwa3RfYmlvX2ZpbmlzaGVkKHBkKTsKKwlyZXR1cm4gMDsKK30K
IAotCWlmICgocmV0ID0gcGt0X2dldF9sYXN0X3dyaXR0ZW4ocGQsICZsYmEpKSkg
ewotCQlwcmludGsoRFJJVkVSX05BTUUiOiBwa3RfZ2V0X2xhc3Rfd3JpdHRlbiBm
YWlsZWRcbiIpOwotCQlnb3RvIG91dF91bmNsYWltOworc3RhdGljIGludCBwa3Rf
bWFrZV9yZXF1ZXN0KHJlcXVlc3RfcXVldWVfdCAqcSwgc3RydWN0IGJpbyAqYmlv
KQoreworCXN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQ7CisJY2hhciBiW0JERVZO
QU1FX1NJWkVdOworCXNlY3Rvcl90IHpvbmU7CisJc3RydWN0IHBhY2tldF9kYXRh
ICpwa3Q7CisJaW50IHdhc19lbXB0eSwgYmxvY2tlZF9iaW87CisJc3RydWN0IHBr
dF9yYl9ub2RlICpub2RlOworCisJcGQgPSBxLT5xdWV1ZWRhdGE7CisJaWYgKCFw
ZCkgeworCQlwcmludGsoRFJJVkVSX05BTUUiOiAlcyBpbmNvcnJlY3QgcmVxdWVz
dCBxdWV1ZVxuIiwgYmRldm5hbWUoYmlvLT5iaV9iZGV2LCBiKSk7CisJCWdvdG8g
ZW5kX2lvOwogCX0KIAotCXNldF9jYXBhY2l0eShwZC0+ZGlzaywgbGJhIDw8IDIp
OwotCXNldF9jYXBhY2l0eShwZC0+YmRldi0+YmRfZGlzaywgbGJhIDw8IDIpOwot
CWJkX3NldF9zaXplKHBkLT5iZGV2LCAobG9mZl90KWxiYSA8PCAxMSk7CisJLyoK
KwkgKiBDbG9uZSBSRUFEIGJpb3Mgc28gd2UgY2FuIGhhdmUgb3VyIG93biBiaV9l
bmRfaW8gY2FsbGJhY2suCisJICovCisJaWYgKGJpb19kYXRhX2RpcihiaW8pID09
IFJFQUQpIHsKKwkJc3RydWN0IGJpbyAqY2xvbmVkX2JpbyA9IGJpb19jbG9uZShi
aW8sIEdGUF9OT0lPKTsKKwkJc3RydWN0IHBhY2tldF9zdGFja2VkX2RhdGEgKnBz
ZCA9IG1lbXBvb2xfYWxsb2MocHNkX3Bvb2wsIEdGUF9OT0lPKTsKIAotCXEgPSBi
ZGV2X2dldF9xdWV1ZShwZC0+YmRldik7Ci0JaWYgKHdyaXRlKSB7Ci0JCWlmICgo
cmV0ID0gcGt0X29wZW5fd3JpdGUocGQpKSkKLQkJCWdvdG8gb3V0X3VuY2xhaW07
Ci0JCS8qCi0JCSAqIFNvbWUgQ0RSVyBkcml2ZXMgY2FuIG5vdCBoYW5kbGUgd3Jp
dGVzIGxhcmdlciB0aGFuIG9uZSBwYWNrZXQsCi0JCSAqIGV2ZW4gaWYgdGhlIHNp
emUgaXMgYSBtdWx0aXBsZSBvZiB0aGUgcGFja2V0IHNpemUuCi0JCSAqLwotCQlz
cGluX2xvY2tfaXJxKHEtPnF1ZXVlX2xvY2spOwotCQlibGtfcXVldWVfbWF4X3Nl
Y3RvcnMocSwgcGQtPnNldHRpbmdzLnNpemUpOwotCQlzcGluX3VubG9ja19pcnEo
cS0+cXVldWVfbG9jayk7Ci0JCXNldF9iaXQoUEFDS0VUX1dSSVRBQkxFLCAmcGQt
PmZsYWdzKTsKLQl9IGVsc2UgewotCQlwa3Rfc2V0X3NwZWVkKHBkLCBNQVhfU1BF
RUQsIE1BWF9TUEVFRCk7Ci0JCWNsZWFyX2JpdChQQUNLRVRfV1JJVEFCTEUsICZw
ZC0+ZmxhZ3MpOworCQlwc2QtPnBkID0gcGQ7CisJCXBzZC0+YmlvID0gYmlvOwor
CQljbG9uZWRfYmlvLT5iaV9iZGV2ID0gcGQtPmJkZXY7CisJCWNsb25lZF9iaW8t
PmJpX3ByaXZhdGUgPSBwc2Q7CisJCWNsb25lZF9iaW8tPmJpX2VuZF9pbyA9IHBr
dF9lbmRfaW9fcmVhZF9jbG9uZWQ7CisJCXBkLT5zdGF0cy5zZWNzX3IgKz0gYmlv
LT5iaV9zaXplID4+IDk7CisJCXBrdF9xdWV1ZV9iaW8ocGQsIGNsb25lZF9iaW8p
OworCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAoKHJldCA9IHBrdF9zZXRfc2VnbWVu
dF9tZXJnaW5nKHBkLCBxKSkpCi0JCWdvdG8gb3V0X3VuY2xhaW07Ci0KLQlpZiAo
d3JpdGUpIHsKLQkJaWYgKCFwa3RfZ3Jvd19wa3RsaXN0KHBkLCBDT05GSUdfQ0RS
T01fUEtUQ0RWRF9CVUZGRVJTKSkgewotCQkJcHJpbnRrKERSSVZFUl9OQU1FIjog
bm90IGVub3VnaCBtZW1vcnkgZm9yIGJ1ZmZlcnNcbiIpOworCWlmICghdGVzdF9i
aXQoUEFDS0VUX1dSSVRBQkxFLCAmcGQtPmZsYWdzKSkgeworCQlwcmludGsoRFJJ
VkVSX05BTUUiOiBXUklURSBmb3Igcm8gZGV2aWNlICVzICglbGx1KVxuIiwKKwkJ
CXBkLT5uYW1lLCAodW5zaWduZWQgbG9uZyBsb25nKWJpby0+Ymlfc2VjdG9yKTsK
KwkJZ290byBlbmRfaW87CisJfQorCisJaWYgKCFiaW8tPmJpX3NpemUgfHwgKGJp
by0+Ymlfc2l6ZSAlIENEX0ZSQU1FU0laRSkpIHsKKwkJcHJpbnRrKERSSVZFUl9O
QU1FIjogd3JvbmcgYmlvIHNpemVcbiIpOworCQlnb3RvIGVuZF9pbzsKKwl9CisK
KwlibGtfcXVldWVfYm91bmNlKHEsICZiaW8pOworCisJem9uZSA9IFpPTkUoYmlv
LT5iaV9zZWN0b3IsIHBkKTsKKwlWUFJJTlRLKCJwa3RfbWFrZV9yZXF1ZXN0OiBz
dGFydCA9ICU2bGx4IHN0b3AgPSAlNmxseFxuIiwKKwkJKHVuc2lnbmVkIGxvbmcg
bG9uZyliaW8tPmJpX3NlY3RvciwKKwkJKHVuc2lnbmVkIGxvbmcgbG9uZykoYmlv
LT5iaV9zZWN0b3IgKyBiaW9fc2VjdG9ycyhiaW8pKSk7CisKKwkvKiBDaGVjayBp
ZiB3ZSBoYXZlIHRvIHNwbGl0IHRoZSBiaW8gKi8KKwl7CisJCXN0cnVjdCBiaW9f
cGFpciAqYnA7CisJCXNlY3Rvcl90IGxhc3Rfem9uZTsKKwkJaW50IGZpcnN0X3Nl
Y3RvcnM7CisKKwkJbGFzdF96b25lID0gWk9ORShiaW8tPmJpX3NlY3RvciArIGJp
b19zZWN0b3JzKGJpbykgLSAxLCBwZCk7CisJCWlmIChsYXN0X3pvbmUgIT0gem9u
ZSkgeworCQkJQlVHX09OKGxhc3Rfem9uZSAhPSB6b25lICsgcGQtPnNldHRpbmdz
LnNpemUpOworCQkJZmlyc3Rfc2VjdG9ycyA9IGxhc3Rfem9uZSAtIGJpby0+Ymlf
c2VjdG9yOworCQkJYnAgPSBiaW9fc3BsaXQoYmlvLCBiaW9fc3BsaXRfcG9vbCwg
Zmlyc3Rfc2VjdG9ycyk7CisJCQlCVUdfT04oIWJwKTsKKwkJCXBrdF9tYWtlX3Jl
cXVlc3QocSwgJmJwLT5iaW8xKTsKKwkJCXBrdF9tYWtlX3JlcXVlc3QocSwgJmJw
LT5iaW8yKTsKKwkJCWJpb19wYWlyX3JlbGVhc2UoYnApOworCQkJcmV0dXJuIDA7
CisJCX0KKwl9CisKKwkvKgorCSAqIElmIHdlIGZpbmQgYSBtYXRjaGluZyBwYWNr
ZXQgaW4gc3RhdGUgV0FJVElORyBvciBSRUFEX1dBSVQsIHdlIGNhbgorCSAqIGp1
c3QgYXBwZW5kIHRoaXMgYmlvIHRvIHRoYXQgcGFja2V0LgorCSAqLworCXNwaW5f
bG9jaygmcGQtPmNkcncuYWN0aXZlX2xpc3RfbG9jayk7CisJYmxvY2tlZF9iaW8g
PSAwOworCWxpc3RfZm9yX2VhY2hfZW50cnkocGt0LCAmcGQtPmNkcncucGt0X2Fj
dGl2ZV9saXN0LCBsaXN0KSB7CisJCWlmIChwa3QtPnNlY3RvciA9PSB6b25lKSB7
CisJCQlzcGluX2xvY2soJnBrdC0+bG9jayk7CisJCQlpZiAoKHBrdC0+c3RhdGUg
PT0gUEFDS0VUX1dBSVRJTkdfU1RBVEUpIHx8CisJCQkgICAgKHBrdC0+c3RhdGUg
PT0gUEFDS0VUX1JFQURfV0FJVF9TVEFURSkpIHsKKwkJCQlwa3RfYWRkX2xpc3Rf
bGFzdChiaW8sICZwa3QtPm9yaWdfYmlvcywKKwkJCQkJCSAgJnBrdC0+b3JpZ19i
aW9zX3RhaWwpOworCQkJCXBrdC0+d3JpdGVfc2l6ZSArPSBiaW8tPmJpX3NpemUg
LyBDRF9GUkFNRVNJWkU7CisJCQkJaWYgKChwa3QtPndyaXRlX3NpemUgPj0gcGt0
LT5mcmFtZXMpICYmCisJCQkJICAgIChwa3QtPnN0YXRlID09IFBBQ0tFVF9XQUlU
SU5HX1NUQVRFKSkgeworCQkJCQlhdG9taWNfaW5jKCZwa3QtPnJ1bl9zbSk7CisJ
CQkJCXdha2VfdXAoJnBkLT53cXVldWUpOworCQkJCX0KKwkJCQlzcGluX3VubG9j
aygmcGt0LT5sb2NrKTsKKwkJCQlzcGluX3VubG9jaygmcGQtPmNkcncuYWN0aXZl
X2xpc3RfbG9jayk7CisJCQkJcmV0dXJuIDA7CisJCQl9IGVsc2UgeworCQkJCWJs
b2NrZWRfYmlvID0gMTsKKwkJCX0KKwkJCXNwaW5fdW5sb2NrKCZwa3QtPmxvY2sp
OworCQl9CisJfQorCXNwaW5fdW5sb2NrKCZwZC0+Y2Rydy5hY3RpdmVfbGlzdF9s
b2NrKTsKKworCS8qCisJICogTm8gbWF0Y2hpbmcgcGFja2V0IGZvdW5kLiBTdG9y
ZSB0aGUgYmlvIGluIHRoZSB3b3JrIHF1ZXVlLgorCSAqLworCW5vZGUgPSBtZW1w
b29sX2FsbG9jKHBkLT5yYl9wb29sLCBHRlBfTk9JTyk7CisJbm9kZS0+YmlvID0g
YmlvOworCXNwaW5fbG9jaygmcGQtPmxvY2spOworCUJVR19PTihwZC0+YmlvX3F1
ZXVlX3NpemUgPCAwKTsKKwl3YXNfZW1wdHkgPSAocGQtPmJpb19xdWV1ZV9zaXpl
ID09IDApOworCXBrdF9yYnRyZWVfaW5zZXJ0KHBkLCBub2RlKTsKKwlzcGluX3Vu
bG9jaygmcGQtPmxvY2spOworCisJLyoKKwkgKiBXYWtlIHVwIHRoZSB3b3JrZXIg
dGhyZWFkLgorCSAqLworCWF0b21pY19zZXQoJnBkLT5zY2FuX3F1ZXVlLCAxKTsK
KwlpZiAod2FzX2VtcHR5KSB7CisJCS8qIFRoaXMgd2FrZV91cCBpcyByZXF1aXJl
ZCBmb3IgY29ycmVjdCBvcGVyYXRpb24gKi8KKwkJd2FrZV91cCgmcGQtPndxdWV1
ZSk7CisJfSBlbHNlIGlmICghbGlzdF9lbXB0eSgmcGQtPmNkcncucGt0X2ZyZWVf
bGlzdCkgJiYgIWJsb2NrZWRfYmlvKSB7CisJCS8qCisJCSAqIFRoaXMgd2FrZSB1
cCBpcyBub3QgcmVxdWlyZWQgZm9yIGNvcnJlY3Qgb3BlcmF0aW9uLAorCQkgKiBi
dXQgaW1wcm92ZXMgcGVyZm9ybWFuY2UgaW4gc29tZSBjYXNlcy4KKwkJICovCisJ
CXdha2VfdXAoJnBkLT53cXVldWUpOworCX0KKwlyZXR1cm4gMDsKK2VuZF9pbzoK
KwliaW9faW9fZXJyb3IoYmlvLCBiaW8tPmJpX3NpemUpOworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHBrdF9tZXJnZV9idmVjKHJlcXVlc3RfcXVldWVfdCAq
cSwgc3RydWN0IGJpbyAqYmlvLCBzdHJ1Y3QgYmlvX3ZlYyAqYnZlYykKK3sKKwlz
dHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkID0gcS0+cXVldWVkYXRhOworCXNlY3Rv
cl90IHpvbmUgPSBaT05FKGJpby0+Ymlfc2VjdG9yLCBwZCk7CisJaW50IHVzZWQg
PSAoKGJpby0+Ymlfc2VjdG9yIC0gem9uZSkgPDwgOSkgKyBiaW8tPmJpX3NpemU7
CisJaW50IHJlbWFpbmluZyA9IChwZC0+c2V0dGluZ3Muc2l6ZSA8PCA5KSAtIHVz
ZWQ7CisJaW50IHJlbWFpbmluZzI7CisKKwkvKgorCSAqIEEgYmlvIDw9IFBBR0Vf
U0laRSBtdXN0IGJlIGFsbG93ZWQuIElmIGl0IGNyb3NzZXMgYSBwYWNrZXQKKwkg
KiBib3VuZGFyeSwgcGt0X21ha2VfcmVxdWVzdCgpIHdpbGwgc3BsaXQgdGhlIGJp
by4KKwkgKi8KKwlyZW1haW5pbmcyID0gUEFHRV9TSVpFIC0gYmlvLT5iaV9zaXpl
OworCXJlbWFpbmluZyA9IG1heChyZW1haW5pbmcsIHJlbWFpbmluZzIpOworCisJ
QlVHX09OKHJlbWFpbmluZyA8IDApOworCXJldHVybiByZW1haW5pbmc7Cit9CisK
KworLyoKKyAqIGNhbGxlZCBhdCBvcGVuIHRpbWUuCisgKi8KK3N0YXRpYyBpbnQg
cGt0X29wZW5fZGV2KHN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQsIGludCB3cml0
ZSkKK3sKKwlpbnQgcmV0OworCWxvbmcgbGJhOworCXJlcXVlc3RfcXVldWVfdCAq
cTsKKworCS8qCisJICogV2UgbmVlZCB0byByZS1vcGVuIHRoZSBjZHJvbSBkZXZp
Y2Ugd2l0aG91dCBPX05PTkJMT0NLIHRvIGJlIGFibGUKKwkgKiB0byByZWFkL3dy
aXRlIGZyb20vdG8gaXQuIEl0IGlzIGFscmVhZHkgb3BlbmVkIGluIE9fTk9OQkxP
Q0sgbW9kZQorCSAqIHNvIGJkZ2V0KCkgY2FuJ3QgZmFpbC4KKwkgKi8KKwliZGdl
dChwZC0+YmRldi0+YmRfZGV2KTsKKwlpZiAoKHJldCA9IGJsa2Rldl9nZXQocGQt
PmJkZXYsIEZNT0RFX1JFQUQsIE9fUkRPTkxZKSkpCisJCWdvdG8gb3V0OworCisJ
aWYgKChyZXQgPSBiZF9jbGFpbShwZC0+YmRldiwgcGQpKSkKKwkJZ290byBvdXRf
cHV0ZGV2OworCisJaWYgKChyZXQgPSBwa3RfZ2V0X2xhc3Rfd3JpdHRlbihwZCwg
JmxiYSkpKSB7CisJCXByaW50ayhEUklWRVJfTkFNRSI6IHBrdF9nZXRfbGFzdF93
cml0dGVuIGZhaWxlZFxuIik7CisJCWdvdG8gb3V0X3VuY2xhaW07CisJfQorCisJ
c2V0X2NhcGFjaXR5KHBkLT5kaXNrLCBsYmEgPDwgMik7CisJc2V0X2NhcGFjaXR5
KHBkLT5iZGV2LT5iZF9kaXNrLCBsYmEgPDwgMik7CisJYmRfc2V0X3NpemUocGQt
PmJkZXYsIChsb2ZmX3QpbGJhIDw8IDExKTsKKworCXEgPSBiZGV2X2dldF9xdWV1
ZShwZC0+YmRldik7CisJaWYgKHdyaXRlKSB7CisJCWlmICgocmV0ID0gcGt0X29w
ZW5fd3JpdGUocGQpKSkKKwkJCWdvdG8gb3V0X3VuY2xhaW07CisJCS8qCisJCSAq
IFNvbWUgQ0RSVyBkcml2ZXMgY2FuIG5vdCBoYW5kbGUgd3JpdGVzIGxhcmdlciB0
aGFuIG9uZSBwYWNrZXQsCisJCSAqIGV2ZW4gaWYgdGhlIHNpemUgaXMgYSBtdWx0
aXBsZSBvZiB0aGUgcGFja2V0IHNpemUuCisJCSAqLworCQlzcGluX2xvY2tfaXJx
KHEtPnF1ZXVlX2xvY2spOworCQlibGtfcXVldWVfbWF4X3NlY3RvcnMocSwgcGQt
PnNldHRpbmdzLnNpemUpOworCQlzcGluX3VubG9ja19pcnEocS0+cXVldWVfbG9j
ayk7CisJCXNldF9iaXQoUEFDS0VUX1dSSVRBQkxFLCAmcGQtPmZsYWdzKTsKKwl9
IGVsc2UgeworCQlwa3Rfc2V0X3NwZWVkKHBkLCBNQVhfU1BFRUQsIE1BWF9TUEVF
RCk7CisJCWNsZWFyX2JpdChQQUNLRVRfV1JJVEFCTEUsICZwZC0+ZmxhZ3MpOwor
CX0KKworCWlmICgocmV0ID0gcGt0X3NldF9zZWdtZW50X21lcmdpbmcocGQsIHEp
KSkKKwkJZ290byBvdXRfdW5jbGFpbTsKKworCWlmICh3cml0ZSkgeworCQlpZiAo
IXBrdF9ncm93X3BrdGxpc3QocGQsIENPTkZJR19DRFJPTV9QS1RDRFZEX0JVRkZF
UlMpKSB7CisJCQlwcmludGsoRFJJVkVSX05BTUUiOiBub3QgZW5vdWdoIG1lbW9y
eSBmb3IgYnVmZmVyc1xuIik7CiAJCQlyZXQgPSAtRU5PTUVNOwogCQkJZ290byBv
dXRfdW5jbGFpbTsKIAkJfQpAQCAtMjAwMiwxMiArMjM4NywxMiBAQCBzdGF0aWMg
dm9pZCBwa3RfcmVsZWFzZV9kZXYoc3RydWN0IHBrdGNkCiAJcGt0X3Nocmlua19w
a3RsaXN0KHBkKTsKIH0KIAotc3RhdGljIHN0cnVjdCBwa3RjZHZkX2RldmljZSAq
cGt0X2ZpbmRfZGV2X2Zyb21fbWlub3IoaW50IGRldl9taW5vcikKLXsKLQlpZiAo
ZGV2X21pbm9yID49IE1BWF9XUklURVJTKQotCQlyZXR1cm4gTlVMTDsKLQlyZXR1
cm4gcGt0X2RldnNbZGV2X21pbm9yXTsKLX0KKworLyoqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KgorICoKKyAqIHBrdGNkdmQgYmxvY2sgZGV2aWNlIG9wZXJhdGlvbnMKKyAqCisg
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKiovCiAKIHN0YXRpYyBpbnQgcGt0X29wZW4oc3RydWN0
IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCiB7CkBAIC0yMDY5LDE3
MyArMjQ1NCw3NCBAQCBzdGF0aWMgaW50IHBrdF9jbG9zZShzdHJ1Y3QgaW5vZGUg
Kmlub2RlCiAJcmV0dXJuIHJldDsKIH0KIAotCi1zdGF0aWMgaW50IHBrdF9lbmRf
aW9fcmVhZF9jbG9uZWQoc3RydWN0IGJpbyAqYmlvLCB1bnNpZ25lZCBpbnQgYnl0
ZXNfZG9uZSwgaW50IGVycikKLXsKLQlzdHJ1Y3QgcGFja2V0X3N0YWNrZWRfZGF0
YSAqcHNkID0gYmlvLT5iaV9wcml2YXRlOwotCXN0cnVjdCBwa3RjZHZkX2Rldmlj
ZSAqcGQgPSBwc2QtPnBkOwotCi0JaWYgKGJpby0+Ymlfc2l6ZSkKLQkJcmV0dXJu
IDE7Ci0KLQliaW9fcHV0KGJpbyk7Ci0JYmlvX2VuZGlvKHBzZC0+YmlvLCBwc2Qt
PmJpby0+Ymlfc2l6ZSwgZXJyKTsKLQltZW1wb29sX2ZyZWUocHNkLCBwc2RfcG9v
bCk7Ci0JcGt0X2Jpb19maW5pc2hlZChwZCk7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyBpbnQgcGt0X21ha2VfcmVxdWVzdChyZXF1ZXN0X3F1ZXVlX3QgKnEsIHN0
cnVjdCBiaW8gKmJpbykKK3N0YXRpYyBpbnQgcGt0X2lvY3RsKHN0cnVjdCBpbm9k
ZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlLCB1bnNpZ25lZCBpbnQgY21kLAor
CQkJdW5zaWduZWQgbG9uZyBhcmcpCiB7Ci0Jc3RydWN0IHBrdGNkdmRfZGV2aWNl
ICpwZDsKLQljaGFyIGJbQkRFVk5BTUVfU0laRV07Ci0Jc2VjdG9yX3Qgem9uZTsK
LQlzdHJ1Y3QgcGFja2V0X2RhdGEgKnBrdDsKLQlpbnQgd2FzX2VtcHR5LCBibG9j
a2VkX2JpbzsKLQlzdHJ1Y3QgcGt0X3JiX25vZGUgKm5vZGU7Ci0KLQlwZCA9IHEt
PnF1ZXVlZGF0YTsKLQlpZiAoIXBkKSB7Ci0JCXByaW50ayhEUklWRVJfTkFNRSI6
ICVzIGluY29ycmVjdCByZXF1ZXN0IHF1ZXVlXG4iLCBiZGV2bmFtZShiaW8tPmJp
X2JkZXYsIGIpKTsKLQkJZ290byBlbmRfaW87Ci0JfQotCi0JLyoKLQkgKiBDbG9u
ZSBSRUFEIGJpb3Mgc28gd2UgY2FuIGhhdmUgb3VyIG93biBiaV9lbmRfaW8gY2Fs
bGJhY2suCi0JICovCi0JaWYgKGJpb19kYXRhX2RpcihiaW8pID09IFJFQUQpIHsK
LQkJc3RydWN0IGJpbyAqY2xvbmVkX2JpbyA9IGJpb19jbG9uZShiaW8sIEdGUF9O
T0lPKTsKLQkJc3RydWN0IHBhY2tldF9zdGFja2VkX2RhdGEgKnBzZCA9IG1lbXBv
b2xfYWxsb2MocHNkX3Bvb2wsIEdGUF9OT0lPKTsKLQotCQlwc2QtPnBkID0gcGQ7
Ci0JCXBzZC0+YmlvID0gYmlvOwotCQljbG9uZWRfYmlvLT5iaV9iZGV2ID0gcGQt
PmJkZXY7Ci0JCWNsb25lZF9iaW8tPmJpX3ByaXZhdGUgPSBwc2Q7Ci0JCWNsb25l
ZF9iaW8tPmJpX2VuZF9pbyA9IHBrdF9lbmRfaW9fcmVhZF9jbG9uZWQ7Ci0JCXBk
LT5zdGF0cy5zZWNzX3IgKz0gYmlvLT5iaV9zaXplID4+IDk7Ci0JCXBrdF9xdWV1
ZV9iaW8ocGQsIGNsb25lZF9iaW8pOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQlpZiAo
IXRlc3RfYml0KFBBQ0tFVF9XUklUQUJMRSwgJnBkLT5mbGFncykpIHsKLQkJcHJp
bnRrKERSSVZFUl9OQU1FIjogV1JJVEUgZm9yIHJvIGRldmljZSAlcyAoJWxsdSlc
biIsCi0JCQlwZC0+bmFtZSwgKHVuc2lnbmVkIGxvbmcgbG9uZyliaW8tPmJpX3Nl
Y3Rvcik7Ci0JCWdvdG8gZW5kX2lvOwotCX0KLQotCWlmICghYmlvLT5iaV9zaXpl
IHx8IChiaW8tPmJpX3NpemUgJSBDRF9GUkFNRVNJWkUpKSB7Ci0JCXByaW50ayhE
UklWRVJfTkFNRSI6IHdyb25nIGJpbyBzaXplXG4iKTsKLQkJZ290byBlbmRfaW87
Ci0JfQotCi0JYmxrX3F1ZXVlX2JvdW5jZShxLCAmYmlvKTsKLQotCXpvbmUgPSBa
T05FKGJpby0+Ymlfc2VjdG9yLCBwZCk7Ci0JVlBSSU5USygicGt0X21ha2VfcmVx
dWVzdDogc3RhcnQgPSAlNmxseCBzdG9wID0gJTZsbHhcbiIsCi0JCSh1bnNpZ25l
ZCBsb25nIGxvbmcpYmlvLT5iaV9zZWN0b3IsCi0JCSh1bnNpZ25lZCBsb25nIGxv
bmcpKGJpby0+Ymlfc2VjdG9yICsgYmlvX3NlY3RvcnMoYmlvKSkpOwotCi0JLyog
Q2hlY2sgaWYgd2UgaGF2ZSB0byBzcGxpdCB0aGUgYmlvICovCi0JewotCQlzdHJ1
Y3QgYmlvX3BhaXIgKmJwOwotCQlzZWN0b3JfdCBsYXN0X3pvbmU7Ci0JCWludCBm
aXJzdF9zZWN0b3JzOwotCi0JCWxhc3Rfem9uZSA9IFpPTkUoYmlvLT5iaV9zZWN0
b3IgKyBiaW9fc2VjdG9ycyhiaW8pIC0gMSwgcGQpOwotCQlpZiAobGFzdF96b25l
ICE9IHpvbmUpIHsKLQkJCUJVR19PTihsYXN0X3pvbmUgIT0gem9uZSArIHBkLT5z
ZXR0aW5ncy5zaXplKTsKLQkJCWZpcnN0X3NlY3RvcnMgPSBsYXN0X3pvbmUgLSBi
aW8tPmJpX3NlY3RvcjsKLQkJCWJwID0gYmlvX3NwbGl0KGJpbywgYmlvX3NwbGl0
X3Bvb2wsIGZpcnN0X3NlY3RvcnMpOwotCQkJQlVHX09OKCFicCk7Ci0JCQlwa3Rf
bWFrZV9yZXF1ZXN0KHEsICZicC0+YmlvMSk7Ci0JCQlwa3RfbWFrZV9yZXF1ZXN0
KHEsICZicC0+YmlvMik7Ci0JCQliaW9fcGFpcl9yZWxlYXNlKGJwKTsKLQkJCXJl
dHVybiAwOwotCQl9Ci0JfQotCi0JLyoKLQkgKiBJZiB3ZSBmaW5kIGEgbWF0Y2hp
bmcgcGFja2V0IGluIHN0YXRlIFdBSVRJTkcgb3IgUkVBRF9XQUlULCB3ZSBjYW4K
LQkgKiBqdXN0IGFwcGVuZCB0aGlzIGJpbyB0byB0aGF0IHBhY2tldC4KLQkgKi8K
LQlzcGluX2xvY2soJnBkLT5jZHJ3LmFjdGl2ZV9saXN0X2xvY2spOwotCWJsb2Nr
ZWRfYmlvID0gMDsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBrdCwgJnBkLT5jZHJ3
LnBrdF9hY3RpdmVfbGlzdCwgbGlzdCkgewotCQlpZiAocGt0LT5zZWN0b3IgPT0g
em9uZSkgewotCQkJc3Bpbl9sb2NrKCZwa3QtPmxvY2spOwotCQkJaWYgKChwa3Qt
PnN0YXRlID09IFBBQ0tFVF9XQUlUSU5HX1NUQVRFKSB8fAotCQkJICAgIChwa3Qt
PnN0YXRlID09IFBBQ0tFVF9SRUFEX1dBSVRfU1RBVEUpKSB7Ci0JCQkJcGt0X2Fk
ZF9saXN0X2xhc3QoYmlvLCAmcGt0LT5vcmlnX2Jpb3MsCi0JCQkJCQkgICZwa3Qt
Pm9yaWdfYmlvc190YWlsKTsKLQkJCQlwa3QtPndyaXRlX3NpemUgKz0gYmlvLT5i
aV9zaXplIC8gQ0RfRlJBTUVTSVpFOwotCQkJCWlmICgocGt0LT53cml0ZV9zaXpl
ID49IHBrdC0+ZnJhbWVzKSAmJgotCQkJCSAgICAocGt0LT5zdGF0ZSA9PSBQQUNL
RVRfV0FJVElOR19TVEFURSkpIHsKLQkJCQkJYXRvbWljX2luYygmcGt0LT5ydW5f
c20pOwotCQkJCQl3YWtlX3VwKCZwZC0+d3F1ZXVlKTsKLQkJCQl9Ci0JCQkJc3Bp
bl91bmxvY2soJnBrdC0+bG9jayk7Ci0JCQkJc3Bpbl91bmxvY2soJnBkLT5jZHJ3
LmFjdGl2ZV9saXN0X2xvY2spOwotCQkJCXJldHVybiAwOwotCQkJfSBlbHNlIHsK
LQkJCQlibG9ja2VkX2JpbyA9IDE7Ci0JCQl9Ci0JCQlzcGluX3VubG9jaygmcGt0
LT5sb2NrKTsKLQkJfQotCX0KLQlzcGluX3VubG9jaygmcGQtPmNkcncuYWN0aXZl
X2xpc3RfbG9jayk7CisJc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCA9IGlub2Rl
LT5pX2JkZXYtPmJkX2Rpc2stPnByaXZhdGVfZGF0YTsKIAotCS8qCi0JICogTm8g
bWF0Y2hpbmcgcGFja2V0IGZvdW5kLiBTdG9yZSB0aGUgYmlvIGluIHRoZSB3b3Jr
IHF1ZXVlLgotCSAqLwotCW5vZGUgPSBtZW1wb29sX2FsbG9jKHBkLT5yYl9wb29s
LCBHRlBfTk9JTyk7Ci0Jbm9kZS0+YmlvID0gYmlvOwotCXNwaW5fbG9jaygmcGQt
PmxvY2spOwotCUJVR19PTihwZC0+YmlvX3F1ZXVlX3NpemUgPCAwKTsKLQl3YXNf
ZW1wdHkgPSAocGQtPmJpb19xdWV1ZV9zaXplID09IDApOwotCXBrdF9yYnRyZWVf
aW5zZXJ0KHBkLCBub2RlKTsKLQlzcGluX3VubG9jaygmcGQtPmxvY2spOworCVZQ
UklOVEsoInBrdF9pb2N0bDogY21kICV4LCBkZXYgJWQ6JWRcbiIsIGNtZCwgaW1h
am9yKGlub2RlKSwgaW1pbm9yKGlub2RlKSk7CiAKKwlzd2l0Y2ggKGNtZCkgewog
CS8qCi0JICogV2FrZSB1cCB0aGUgd29ya2VyIHRocmVhZC4KKwkgKiBmb3J3YXJk
IHNlbGVjdGVkIENEUk9NIGlvY3RscyB0byBDRC1ST00sIGZvciBVREYKIAkgKi8K
LQlhdG9taWNfc2V0KCZwZC0+c2Nhbl9xdWV1ZSwgMSk7Ci0JaWYgKHdhc19lbXB0
eSkgewotCQkvKiBUaGlzIHdha2VfdXAgaXMgcmVxdWlyZWQgZm9yIGNvcnJlY3Qg
b3BlcmF0aW9uICovCi0JCXdha2VfdXAoJnBkLT53cXVldWUpOwotCX0gZWxzZSBp
ZiAoIWxpc3RfZW1wdHkoJnBkLT5jZHJ3LnBrdF9mcmVlX2xpc3QpICYmICFibG9j
a2VkX2JpbykgeworCWNhc2UgQ0RST01NVUxUSVNFU1NJT046CisJY2FzZSBDRFJP
TVJFQURUT0NFTlRSWToKKwljYXNlIENEUk9NX0xBU1RfV1JJVFRFTjoKKwljYXNl
IENEUk9NX1NFTkRfUEFDS0VUOgorCWNhc2UgU0NTSV9JT0NUTF9TRU5EX0NPTU1B
TkQ6CisJCXJldHVybiBibGtkZXZfaW9jdGwocGQtPmJkZXYtPmJkX2lub2RlLCBm
aWxlLCBjbWQsIGFyZyk7CisKKwljYXNlIENEUk9NRUpFQ1Q6CiAJCS8qCi0JCSAq
IFRoaXMgd2FrZSB1cCBpcyBub3QgcmVxdWlyZWQgZm9yIGNvcnJlY3Qgb3BlcmF0
aW9uLAotCQkgKiBidXQgaW1wcm92ZXMgcGVyZm9ybWFuY2UgaW4gc29tZSBjYXNl
cy4KKwkJICogVGhlIGRvb3IgZ2V0cyBsb2NrZWQgd2hlbiB0aGUgZGV2aWNlIGlz
IG9wZW5lZCwgc28gd2UKKwkJICogaGF2ZSB0byB1bmxvY2sgaXQgb3IgZWxzZSB0
aGUgZWplY3QgY29tbWFuZCBmYWlscy4KIAkJICovCi0JCXdha2VfdXAoJnBkLT53
cXVldWUpOworCQlpZiAocGQtPnJlZmNudCA9PSAxKQorCQkJcGt0X2xvY2tfZG9v
cihwZCwgMCk7CisJCXJldHVybiBibGtkZXZfaW9jdGwocGQtPmJkZXYtPmJkX2lu
b2RlLCBmaWxlLCBjbWQsIGFyZyk7CisKKwlkZWZhdWx0OgorCQlWUFJJTlRLKERS
SVZFUl9OQU1FIjogVW5rbm93biBpb2N0bCBmb3IgJXMgKCV4KVxuIiwgcGQtPm5h
bWUsIGNtZCk7CisJCXJldHVybiAtRU5PVFRZOwogCX0KLQlyZXR1cm4gMDsKLWVu
ZF9pbzoKLQliaW9faW9fZXJyb3IoYmlvLCBiaW8tPmJpX3NpemUpOworCiAJcmV0
dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgcGt0X21lZGlhX2NoYW5nZWQoc3RydWN0
IGdlbmRpc2sgKmRpc2spCit7CisJc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCA9
IGRpc2stPnByaXZhdGVfZGF0YTsKKwlzdHJ1Y3QgZ2VuZGlzayAqYXR0YWNoZWRf
ZGlzazsKIAorCWlmICghcGQpCisJCXJldHVybiAwOworCWlmICghcGQtPmJkZXYp
CisJCXJldHVybiAwOworCWF0dGFjaGVkX2Rpc2sgPSBwZC0+YmRldi0+YmRfZGlz
azsKKwlpZiAoIWF0dGFjaGVkX2Rpc2spCisJCXJldHVybiAwOworCXJldHVybiBh
dHRhY2hlZF9kaXNrLT5mb3BzLT5tZWRpYV9jaGFuZ2VkKGF0dGFjaGVkX2Rpc2sp
OworfQogCi1zdGF0aWMgaW50IHBrdF9tZXJnZV9idmVjKHJlcXVlc3RfcXVldWVf
dCAqcSwgc3RydWN0IGJpbyAqYmlvLCBzdHJ1Y3QgYmlvX3ZlYyAqYnZlYykKLXsK
LQlzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkID0gcS0+cXVldWVkYXRhOwotCXNl
Y3Rvcl90IHpvbmUgPSBaT05FKGJpby0+Ymlfc2VjdG9yLCBwZCk7Ci0JaW50IHVz
ZWQgPSAoKGJpby0+Ymlfc2VjdG9yIC0gem9uZSkgPDwgOSkgKyBiaW8tPmJpX3Np
emU7Ci0JaW50IHJlbWFpbmluZyA9IChwZC0+c2V0dGluZ3Muc2l6ZSA8PCA5KSAt
IHVzZWQ7Ci0JaW50IHJlbWFpbmluZzI7CitzdGF0aWMgc3RydWN0IGJsb2NrX2Rl
dmljZV9vcGVyYXRpb25zIHBrdGNkdmRfb3BzID0geworCS5vd25lciA9CQlUSElT
X01PRFVMRSwKKwkub3BlbiA9CQkJcGt0X29wZW4sCisJLnJlbGVhc2UgPQkJcGt0
X2Nsb3NlLAorCS5pb2N0bCA9CQlwa3RfaW9jdGwsCisJLm1lZGlhX2NoYW5nZWQg
PQlwa3RfbWVkaWFfY2hhbmdlZCwKK307CiAKLQkvKgotCSAqIEEgYmlvIDw9IFBB
R0VfU0laRSBtdXN0IGJlIGFsbG93ZWQuIElmIGl0IGNyb3NzZXMgYSBwYWNrZXQK
LQkgKiBib3VuZGFyeSwgcGt0X21ha2VfcmVxdWVzdCgpIHdpbGwgc3BsaXQgdGhl
IGJpby4KLQkgKi8KLQlyZW1haW5pbmcyID0gUEFHRV9TSVpFIC0gYmlvLT5iaV9z
aXplOwotCXJlbWFpbmluZyA9IG1heChyZW1haW5pbmcsIHJlbWFpbmluZzIpOwog
Ci0JQlVHX09OKHJlbWFpbmluZyA8IDApOwotCXJldHVybiByZW1haW5pbmc7Ci19
CisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioKKyAqCisgKiBwYWNrZXQgZGV2aWNl
IHNldHVwIGFuZCByZW1vdmFsCisgKgorICoqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiov
CiAKKy8qCisgKiBoZWxwZXIgZm9yIHBrdF9uZXdfZGV2KCkKKyAqLwogc3RhdGlj
IHZvaWQgcGt0X2luaXRfcXVldWUoc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCkK
IHsKIAlyZXF1ZXN0X3F1ZXVlX3QgKnEgPSBwZC0+ZGlzay0+cXVldWU7CkBAIC0y
MjQ2LDgwICsyNTMyLDkgQEAgc3RhdGljIHZvaWQgcGt0X2luaXRfcXVldWUoc3Ry
dWN0IHBrdGNkdgogCWJsa19xdWV1ZV9tZXJnZV9idmVjKHEsIHBrdF9tZXJnZV9i
dmVjKTsKIAlxLT5xdWV1ZWRhdGEgPSBwZDsKIH0KLQotI2lmIFBLVF9VU0VfUFJP
Q0ZTCi1zdGF0aWMgaW50IHBrdF9zZXFfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKnApCi17Ci0Jc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCA9IG0tPnBy
aXZhdGU7Ci0JY2hhciAqbXNnOwotCWNoYXIgYmRldl9idWZbQkRFVk5BTUVfU0la
RV07Ci0JaW50IHN0YXRlc1tQQUNLRVRfTlVNX1NUQVRFU107Ci0KLQlzZXFfcHJp
bnRmKG0sICJXcml0ZXIgJXMgbWFwcGVkIHRvICVzOlxuIiwgcGQtPm5hbWUsCi0J
CSAgIGJkZXZuYW1lKHBkLT5iZGV2LCBiZGV2X2J1ZikpOwotCi0Jc2VxX3ByaW50
ZihtLCAiXG5TZXR0aW5nczpcbiIpOwotCXNlcV9wcmludGYobSwgIlx0cGFja2V0
IHNpemU6XHRcdCVka0JcbiIsIHBkLT5zZXR0aW5ncy5zaXplIC8gMik7Ci0KLQlp
ZiAocGQtPnNldHRpbmdzLndyaXRlX3R5cGUgPT0gMCkKLQkJbXNnID0gIlBhY2tl
dCI7Ci0JZWxzZQotCQltc2cgPSAiVW5rbm93biI7Ci0Jc2VxX3ByaW50ZihtLCAi
XHR3cml0ZSB0eXBlOlx0XHQlc1xuIiwgbXNnKTsKLQotCXNlcV9wcmludGYobSwg
Ilx0cGFja2V0IHR5cGU6XHRcdCVzXG4iLCBwZC0+c2V0dGluZ3MuZnAgPyAiRml4
ZWQiIDogIlZhcmlhYmxlIik7Ci0Jc2VxX3ByaW50ZihtLCAiXHRsaW5rIGxvc3M6
XHRcdCVkXG4iLCBwZC0+c2V0dGluZ3MubGlua19sb3NzKTsKLQotCXNlcV9wcmlu
dGYobSwgIlx0dHJhY2sgbW9kZTpcdFx0JWRcbiIsIHBkLT5zZXR0aW5ncy50cmFj
a19tb2RlKTsKLQotCWlmIChwZC0+c2V0dGluZ3MuYmxvY2tfbW9kZSA9PSBQQUNL
RVRfQkxPQ0tfTU9ERTEpCi0JCW1zZyA9ICJNb2RlIDEiOwotCWVsc2UgaWYgKHBk
LT5zZXR0aW5ncy5ibG9ja19tb2RlID09IFBBQ0tFVF9CTE9DS19NT0RFMikKLQkJ
bXNnID0gIk1vZGUgMiI7Ci0JZWxzZQotCQltc2cgPSAiVW5rbm93biI7Ci0Jc2Vx
X3ByaW50ZihtLCAiXHRibG9jayBtb2RlOlx0XHQlc1xuIiwgbXNnKTsKLQotCXNl
cV9wcmludGYobSwgIlxuU3RhdGlzdGljczpcbiIpOwotCXNlcV9wcmludGYobSwg
Ilx0cGFja2V0cyBzdGFydGVkOlx0JWx1XG4iLCBwZC0+c3RhdHMucGt0X3N0YXJ0
ZWQpOwotCXNlcV9wcmludGYobSwgIlx0cGFja2V0cyBlbmRlZDpcdFx0JWx1XG4i
LCBwZC0+c3RhdHMucGt0X2VuZGVkKTsKLQlzZXFfcHJpbnRmKG0sICJcdHdyaXR0
ZW46XHRcdCVsdWtCXG4iLCBwZC0+c3RhdHMuc2Vjc193ID4+IDEpOwotCXNlcV9w
cmludGYobSwgIlx0cmVhZCBnYXRoZXI6XHRcdCVsdWtCXG4iLCBwZC0+c3RhdHMu
c2Vjc19yZyA+PiAxKTsKLQlzZXFfcHJpbnRmKG0sICJcdHJlYWQ6XHRcdFx0JWx1
a0JcbiIsIHBkLT5zdGF0cy5zZWNzX3IgPj4gMSk7Ci0KLQlzZXFfcHJpbnRmKG0s
ICJcbk1pc2M6XG4iKTsKLQlzZXFfcHJpbnRmKG0sICJcdHJlZmVyZW5jZSBjb3Vu
dDpcdCVkXG4iLCBwZC0+cmVmY250KTsKLQlzZXFfcHJpbnRmKG0sICJcdGZsYWdz
Olx0XHRcdDB4JWx4XG4iLCBwZC0+ZmxhZ3MpOwotCXNlcV9wcmludGYobSwgIlx0
cmVhZCBzcGVlZDpcdFx0JXVrQi9zXG4iLCBwZC0+cmVhZF9zcGVlZCk7Ci0Jc2Vx
X3ByaW50ZihtLCAiXHR3cml0ZSBzcGVlZDpcdFx0JXVrQi9zXG4iLCBwZC0+d3Jp
dGVfc3BlZWQpOwotCXNlcV9wcmludGYobSwgIlx0c3RhcnQgb2Zmc2V0Olx0XHQl
bHVcbiIsIHBkLT5vZmZzZXQpOwotCXNlcV9wcmludGYobSwgIlx0bW9kZSBwYWdl
IG9mZnNldDpcdCV1XG4iLCBwZC0+bW9kZV9vZmZzZXQpOwotCi0Jc2VxX3ByaW50
ZihtLCAiXG5RdWV1ZSBzdGF0ZTpcbiIpOwotCXNlcV9wcmludGYobSwgIlx0Ymlv
cyBxdWV1ZWQ6XHRcdCVkXG4iLCBwZC0+YmlvX3F1ZXVlX3NpemUpOwotCXNlcV9w
cmludGYobSwgIlx0YmlvcyBwZW5kaW5nOlx0XHQlZFxuIiwgYXRvbWljX3JlYWQo
JnBkLT5jZHJ3LnBlbmRpbmdfYmlvcykpOwotCXNlcV9wcmludGYobSwgIlx0Y3Vy
cmVudCBzZWN0b3I6XHRcdDB4JWxseFxuIiwgKHVuc2lnbmVkIGxvbmcgbG9uZylw
ZC0+Y3VycmVudF9zZWN0b3IpOwotCi0JcGt0X2NvdW50X3N0YXRlcyhwZCwgc3Rh
dGVzKTsKLQlzZXFfcHJpbnRmKG0sICJcdHN0YXRlOlx0XHRcdGk6JWQgb3c6JWQg
cnc6JWQgd3c6JWQgcmVjOiVkIGZpbjolZFxuIiwKLQkJICAgc3RhdGVzWzBdLCBz
dGF0ZXNbMV0sIHN0YXRlc1syXSwgc3RhdGVzWzNdLCBzdGF0ZXNbNF0sIHN0YXRl
c1s1XSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBwa3Rfc2VxX29w
ZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCi17Ci0J
cmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIHBrdF9zZXFfc2hvdywgUERFKGlub2Rl
KS0+ZGF0YSk7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHBr
dF9wcm9jX2ZvcHMgPSB7Ci0JLm9wZW4JPSBwa3Rfc2VxX29wZW4sCi0JLnJlYWQJ
PSBzZXFfcmVhZCwKLQkubGxzZWVrCT0gc2VxX2xzZWVrLAotCS5yZWxlYXNlID0g
c2luZ2xlX3JlbGVhc2UKLX07Ci0jZW5kaWYgLyogUEtUX1VTRV9QUk9DRlMgKi8K
LQorLyoKKyAqIGhlbHBlciBmb3IgcGt0X3NldHVwX2RldigpCisgKi8KIHN0YXRp
YyBpbnQgcGt0X25ld19kZXYoc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCwgZGV2
X3QgZGV2KQogewogCWludCBpOwpAQCAtMjM4OCw5NiArMjYwMywzNiBAQCBvdXRf
bWVtOgogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQgcGt0X2lvY3RsKHN0
cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlLCB1bnNpZ25lZCBp
bnQgY21kLCB1bnNpZ25lZCBsb25nIGFyZykKLXsKLQlzdHJ1Y3QgcGt0Y2R2ZF9k
ZXZpY2UgKnBkID0gaW5vZGUtPmlfYmRldi0+YmRfZGlzay0+cHJpdmF0ZV9kYXRh
OwotCi0JVlBSSU5USygicGt0X2lvY3RsOiBjbWQgJXgsIGRldiAlZDolZFxuIiwg
Y21kLCBpbWFqb3IoaW5vZGUpLCBpbWlub3IoaW5vZGUpKTsKLQotCXN3aXRjaCAo
Y21kKSB7Ci0JLyoKLQkgKiBmb3J3YXJkIHNlbGVjdGVkIENEUk9NIGlvY3RscyB0
byBDRC1ST00sIGZvciBVREYKLQkgKi8KLQljYXNlIENEUk9NTVVMVElTRVNTSU9O
OgotCWNhc2UgQ0RST01SRUFEVE9DRU5UUlk6Ci0JY2FzZSBDRFJPTV9MQVNUX1dS
SVRURU46Ci0JY2FzZSBDRFJPTV9TRU5EX1BBQ0tFVDoKLQljYXNlIFNDU0lfSU9D
VExfU0VORF9DT01NQU5EOgotCQlyZXR1cm4gYmxrZGV2X2lvY3RsKHBkLT5iZGV2
LT5iZF9pbm9kZSwgZmlsZSwgY21kLCBhcmcpOwotCi0JY2FzZSBDRFJPTUVKRUNU
OgotCQkvKgotCQkgKiBUaGUgZG9vciBnZXRzIGxvY2tlZCB3aGVuIHRoZSBkZXZp
Y2UgaXMgb3BlbmVkLCBzbyB3ZQotCQkgKiBoYXZlIHRvIHVubG9jayBpdCBvciBl
bHNlIHRoZSBlamVjdCBjb21tYW5kIGZhaWxzLgotCQkgKi8KLQkJaWYgKHBkLT5y
ZWZjbnQgPT0gMSkKLQkJCXBrdF9sb2NrX2Rvb3IocGQsIDApOwotCQlyZXR1cm4g
YmxrZGV2X2lvY3RsKHBkLT5iZGV2LT5iZF9pbm9kZSwgZmlsZSwgY21kLCBhcmcp
OwotCi0JZGVmYXVsdDoKLQkJVlBSSU5USyhEUklWRVJfTkFNRSI6IFVua25vd24g
aW9jdGwgZm9yICVzICgleClcbiIsIHBkLT5uYW1lLCBjbWQpOwotCQlyZXR1cm4g
LUVOT1RUWTsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBwa3Rf
bWVkaWFfY2hhbmdlZChzdHJ1Y3QgZ2VuZGlzayAqZGlzaykKLXsKLQlzdHJ1Y3Qg
cGt0Y2R2ZF9kZXZpY2UgKnBkID0gZGlzay0+cHJpdmF0ZV9kYXRhOwotCXN0cnVj
dCBnZW5kaXNrICphdHRhY2hlZF9kaXNrOwotCi0JaWYgKCFwZCkKLQkJcmV0dXJu
IDA7Ci0JaWYgKCFwZC0+YmRldikKLQkJcmV0dXJuIDA7Ci0JYXR0YWNoZWRfZGlz
ayA9IHBkLT5iZGV2LT5iZF9kaXNrOwotCWlmICghYXR0YWNoZWRfZGlzaykKLQkJ
cmV0dXJuIDA7Ci0JcmV0dXJuIGF0dGFjaGVkX2Rpc2stPmZvcHMtPm1lZGlhX2No
YW5nZWQoYXR0YWNoZWRfZGlzayk7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgYmxvY2tf
ZGV2aWNlX29wZXJhdGlvbnMgcGt0Y2R2ZF9vcHMgPSB7Ci0JLm93bmVyID0JCVRI
SVNfTU9EVUxFLAotCS5vcGVuID0JCQlwa3Rfb3BlbiwKLQkucmVsZWFzZSA9CQlw
a3RfY2xvc2UsCi0JLmlvY3RsID0JCXBrdF9pb2N0bCwKLQkubWVkaWFfY2hhbmdl
ZCA9CXBrdF9tZWRpYV9jaGFuZ2VkLAotfTsKLQogLyoKICAqIFNldCB1cCBtYXBw
aW5nIGZyb20gcGt0Y2R2ZCBkZXZpY2UgdG8gQ0QtUk9NIGRldmljZS4KICAqLwot
c3RhdGljIGludCBwa3Rfc2V0dXBfZGV2KHN0cnVjdCBwa3RfY3RybF9jb21tYW5k
ICpjdHJsX2NtZCkKK3N0YXRpYyBpbnQgcGt0X3NldHVwX2RldihkZXZfdCBkZXYs
IGRldl90KiBwa3RfZGV2KQogewogCWludCBpZHg7CiAJaW50IHJldCA9IC1FTk9N
RU07CiAJc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZDsKIAlzdHJ1Y3QgZ2VuZGlz
ayAqZGlzazsKLQlkZXZfdCBkZXYgPSBuZXdfZGVjb2RlX2RldihjdHJsX2NtZC0+
ZGV2KTsKKwkKKwltdXRleF9sb2NrX25lc3RlZCgmY3RsX211dGV4LCBTSU5HTEVf
REVQVEhfTkVTVElORyk7CiAKIAlmb3IgKGlkeCA9IDA7IGlkeCA8IE1BWF9XUklU
RVJTOyBpZHgrKykKIAkJaWYgKCFwa3RfZGV2c1tpZHhdKQogCQkJYnJlYWs7CiAJ
aWYgKGlkeCA9PSBNQVhfV1JJVEVSUykgewogCQlwcmludGsoRFJJVkVSX05BTUUi
OiBtYXggJWQgd3JpdGVycyBzdXBwb3J0ZWRcbiIsIE1BWF9XUklURVJTKTsKLQkJ
cmV0dXJuIC1FQlVTWTsKKwkJcmV0ID0gLUVCVVNZOworCQlnb3RvIG91dF9tdXRl
eDsKIAl9CiAKIAlwZCA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBwa3RjZHZkX2Rl
dmljZSksIEdGUF9LRVJORUwpOwogCWlmICghcGQpCi0JCXJldHVybiByZXQ7Ci0K
KwkJZ290byBvdXRfbXV0ZXg7CisJCiAJcGQtPnJiX3Bvb2wgPSBtZW1wb29sX2Ny
ZWF0ZV9rbWFsbG9jX3Bvb2woUEtUX1JCX1BPT0xfU0laRSwKIAkJCQkJCSAgc2l6
ZW9mKHN0cnVjdCBwa3RfcmJfbm9kZSkpOwogCWlmICghcGQtPnJiX3Bvb2wpCiAJ
CWdvdG8gb3V0X21lbTsKLQotCWRpc2sgPSBhbGxvY19kaXNrKDEpOwotCWlmICgh
ZGlzaykKLQkJZ290byBvdXRfbWVtOwotCXBkLT5kaXNrID0gZGlzazsKLQorCQog
CUlOSVRfTElTVF9IRUFEKCZwZC0+Y2Rydy5wa3RfZnJlZV9saXN0KTsKIAlJTklU
X0xJU1RfSEVBRCgmcGQtPmNkcncucGt0X2FjdGl2ZV9saXN0KTsKIAlzcGluX2xv
Y2tfaW5pdCgmcGQtPmNkcncuYWN0aXZlX2xpc3RfbG9jayk7CkBAIC0yNDg4LDEx
ICsyNjQzLDE1IEBAIHN0YXRpYyBpbnQgcGt0X3NldHVwX2RldihzdHJ1Y3QgcGt0
X2N0cmwKIAlpbml0X3dhaXRxdWV1ZV9oZWFkKCZwZC0+d3F1ZXVlKTsKIAlwZC0+
YmlvX3F1ZXVlID0gUkJfUk9PVDsKIAotCWRpc2stPm1ham9yID0gcGt0X21ham9y
OworCWRpc2sgPSBhbGxvY19kaXNrKDEpOworCWlmICghZGlzaykKKwkJZ290byBv
dXRfbWVtOworCXBkLT5kaXNrID0gZGlzazsKKwlkaXNrLT5tYWpvciA9IHBrdGRl
dl9tYWpvcjsKIAlkaXNrLT5maXJzdF9taW5vciA9IGlkeDsKIAlkaXNrLT5mb3Bz
ID0gJnBrdGNkdmRfb3BzOwogCWRpc2stPmZsYWdzID0gR0VOSERfRkxfUkVNT1ZB
QkxFOwotCXNwcmludGYoZGlzay0+ZGlza19uYW1lLCBEUklWRVJfTkFNRSIlZCIs
IGlkeCk7CisJc3RyY3B5KGRpc2stPmRpc2tfbmFtZSwgcGQtPm5hbWUpOwogCWRp
c2stPnByaXZhdGVfZGF0YSA9IHBkOwogCWRpc2stPnF1ZXVlID0gYmxrX2FsbG9j
X3F1ZXVlKEdGUF9LRVJORUwpOwogCWlmICghZGlzay0+cXVldWUpCkBAIC0yNTA0
LDggKzI2NjMsMTIgQEAgc3RhdGljIGludCBwa3Rfc2V0dXBfZGV2KHN0cnVjdCBw
a3RfY3RybAogCQlnb3RvIG91dF9uZXdfZGV2OwogCiAJYWRkX2Rpc2soZGlzayk7
CisJCiAJcGt0X2RldnNbaWR4XSA9IHBkOwotCWN0cmxfY21kLT5wa3RfZGV2ID0g
bmV3X2VuY29kZV9kZXYocGQtPnBrdF9kZXYpOworCWlmIChwa3RfZGV2KQorCQkq
cGt0X2RldiA9IHBkLT5wa3RfZGV2OworCisJbXV0ZXhfdW5sb2NrKCZjdGxfbXV0
ZXgpOwogCXJldHVybiAwOwogCiBvdXRfbmV3X2RldjoKQEAgLTI1MTYsMzQgKzI2
NzksNDMgQEAgb3V0X21lbToKIAlpZiAocGQtPnJiX3Bvb2wpCiAJCW1lbXBvb2xf
ZGVzdHJveShwZC0+cmJfcG9vbCk7CiAJa2ZyZWUocGQpOworb3V0X211dGV4OgkK
KwltdXRleF91bmxvY2soJmN0bF9tdXRleCk7CisJcHJpbnRrKERSSVZFUl9OQU1F
Ijogc2V0dXAgb2YgcGt0Y2R2ZCBkZXZpY2UgZmFpbGVkXG4iKTsKIAlyZXR1cm4g
cmV0OwogfQogCiAvKgogICogVGVhciBkb3duIG1hcHBpbmcgZnJvbSBwa3RjZHZk
IGRldmljZSB0byBDRC1ST00gZGV2aWNlLgogICovCi1zdGF0aWMgaW50IHBrdF9y
ZW1vdmVfZGV2KHN0cnVjdCBwa3RfY3RybF9jb21tYW5kICpjdHJsX2NtZCkKK3N0
YXRpYyBpbnQgcGt0X3JlbW92ZV9kZXYoZGV2X3QgcGt0X2RldikKIHsKIAlzdHJ1
Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkOwogCWludCBpZHg7Ci0JZGV2X3QgcGt0X2Rl
diA9IG5ld19kZWNvZGVfZGV2KGN0cmxfY21kLT5wa3RfZGV2KTsKKwlpbnQgcmV0
ID0gMDsKKwkKKwltdXRleF9sb2NrX25lc3RlZCgmY3RsX211dGV4LCBTSU5HTEVf
REVQVEhfTkVTVElORyk7CiAKLQlmb3IgKGlkeCA9IDA7IGlkeCA8IE1BWF9XUklU
RVJTOyBpZHgrKykgewotCQlwZCA9IHBrdF9kZXZzW2lkeF07Ci0JCWlmIChwZCAm
JiAocGQtPnBrdF9kZXYgPT0gcGt0X2RldikpCi0JCQlicmVhazsKLQl9Ci0JaWYg
KGlkeCA9PSBNQVhfV1JJVEVSUykgewotCQlEUFJJTlRLKERSSVZFUl9OQU1FIjog
ZGV2IG5vdCBzZXR1cFxuIik7Ci0JCXJldHVybiAtRU5YSU87CisJcGQgPSBwa3Rf
ZmluZF9kZXYocGt0X2RldiwgJmlkeCk7CisJaWYgKCFwZCkgeworCQkvKiBtYXli
ZSBwa3RfZGV2IGlzIHRoZSBtYXBwZWQgYmxvY2sgZGV2aWNlIGlkICovCisJCXBk
ID0gcGt0X2ZpbmRfZGV2X2JkZXYocGt0X2RldiwgJmlkeCk7CisJCWlmICghcGQp
IHsKKwkJCURQUklOVEsoRFJJVkVSX05BTUUiOiBkZXYgbm90IHNldHVwXG4iKTsK
KwkJCXJldCA9IC1FTlhJTzsKKwkJCWdvdG8gb3V0OworCQl9CiAJfQogCi0JaWYg
KHBkLT5yZWZjbnQgPiAwKQotCQlyZXR1cm4gLUVCVVNZOwotCisJaWYgKHBkLT5y
ZWZjbnQgPiAwKSB7CisJCXJldCA9IC1FQlVTWTsKKwkJZ290byBvdXQ7CisJfQog
CWlmICghSVNfRVJSKHBkLT5jZHJ3LnRocmVhZCkpCiAJCWt0aHJlYWRfc3RvcChw
ZC0+Y2Rydy50aHJlYWQpOwotCisJCisJcGt0X2RldnNbaWR4XSA9IE5VTEw7CisJ
CiAJYmxrZGV2X3B1dChwZC0+YmRldik7CiAKICNpZiBQS1RfVVNFX1BST0NGUwpA
QCAtMjU1NSw4MiArMjcyNywyMiBAQCBzdGF0aWMgaW50IHBrdF9yZW1vdmVfZGV2
KHN0cnVjdCBwa3RfY3RyCiAJYmxrX2NsZWFudXBfcXVldWUocGQtPmRpc2stPnF1
ZXVlKTsKIAlwdXRfZGlzayhwZC0+ZGlzayk7CiAKLQlwa3RfZGV2c1tpZHhdID0g
TlVMTDsKIAltZW1wb29sX2Rlc3Ryb3kocGQtPnJiX3Bvb2wpOwogCWtmcmVlKHBk
KTsKIAogCS8qIFRoaXMgaXMgc2FmZTogb3BlbigpIGlzIHN0aWxsIGhvbGRpbmcg
YSByZWZlcmVuY2UuICovCiAJbW9kdWxlX3B1dChUSElTX01PRFVMRSk7Ci0JcmV0
dXJuIDA7Ci19Ci0KLSNpZiBQS1RfVVNFX1BST0NGUwotc3RhdGljIHZvaWQgcGt0
X2dldF9zdGF0dXMoc3RydWN0IHBrdF9jdHJsX2NvbW1hbmQgKmN0cmxfY21kKQot
ewotCXN0cnVjdCBwa3RjZHZkX2RldmljZSAqcGQgPSBwa3RfZmluZF9kZXZfZnJv
bV9taW5vcihjdHJsX2NtZC0+ZGV2X2luZGV4KTsKLQlpZiAocGQpIHsKLQkJY3Ry
bF9jbWQtPmRldiA9IG5ld19lbmNvZGVfZGV2KHBkLT5iZGV2LT5iZF9kZXYpOwot
CQljdHJsX2NtZC0+cGt0X2RldiA9IG5ld19lbmNvZGVfZGV2KHBkLT5wa3RfZGV2
KTsKLQl9IGVsc2UgewotCQljdHJsX2NtZC0+ZGV2ID0gMDsKLQkJY3RybF9jbWQt
PnBrdF9kZXYgPSAwOwotCX0KLQljdHJsX2NtZC0+bnVtX2RldmljZXMgPSBNQVhf
V1JJVEVSUzsKLX0KLQotc3RhdGljIGludCBwa3RfY3RsX2lvY3RsKHN0cnVjdCBp
bm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlLCB1bnNpZ25lZCBpbnQgY21k
LCB1bnNpZ25lZCBsb25nIGFyZykKLXsKLQl2b2lkIF9fdXNlciAqYXJncCA9ICh2
b2lkIF9fdXNlciAqKWFyZzsKLQlzdHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCBjdHJs
X2NtZDsKLQlpbnQgcmV0ID0gMDsKLQotCWlmIChjbWQgIT0gUEFDS0VUX0NUUkxf
Q01EKQotCQlyZXR1cm4gLUVOT1RUWTsKLQotCWlmIChjb3B5X2Zyb21fdXNlcigm
Y3RybF9jbWQsIGFyZ3AsIHNpemVvZihzdHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCkp
KQotCQlyZXR1cm4gLUVGQVVMVDsKLQotCXN3aXRjaCAoY3RybF9jbWQuY29tbWFu
ZCkgewotCWNhc2UgUEtUX0NUUkxfQ01EX1NFVFVQOgotCQlpZiAoIWNhcGFibGUo
Q0FQX1NZU19BRE1JTikpCi0JCQlyZXR1cm4gLUVQRVJNOwotCQltdXRleF9sb2Nr
X25lc3RlZCgmY3RsX211dGV4LCBTSU5HTEVfREVQVEhfTkVTVElORyk7Ci0JCXJl
dCA9IHBrdF9zZXR1cF9kZXYoJmN0cmxfY21kKTsKLQkJbXV0ZXhfdW5sb2NrKCZj
dGxfbXV0ZXgpOwotCQlicmVhazsKLQljYXNlIFBLVF9DVFJMX0NNRF9URUFSRE9X
TjoKLQkJaWYgKCFjYXBhYmxlKENBUF9TWVNfQURNSU4pKQotCQkJcmV0dXJuIC1F
UEVSTTsKLQkJbXV0ZXhfbG9ja19uZXN0ZWQoJmN0bF9tdXRleCwgU0lOR0xFX0RF
UFRIX05FU1RJTkcpOwotCQlyZXQgPSBwa3RfcmVtb3ZlX2RldigmY3RybF9jbWQp
OwotCQltdXRleF91bmxvY2soJmN0bF9tdXRleCk7Ci0JCWJyZWFrOwotCWNhc2Ug
UEtUX0NUUkxfQ01EX1NUQVRVUzoKLQkJbXV0ZXhfbG9ja19uZXN0ZWQoJmN0bF9t
dXRleCwgU0lOR0xFX0RFUFRIX05FU1RJTkcpOwotCQlwa3RfZ2V0X3N0YXR1cygm
Y3RybF9jbWQpOwotCQltdXRleF91bmxvY2soJmN0bF9tdXRleCk7Ci0JCWJyZWFr
OwotCWRlZmF1bHQ6Ci0JCXJldHVybiAtRU5PVFRZOwotCX0KLQotCWlmIChjb3B5
X3RvX3VzZXIoYXJncCwgJmN0cmxfY21kLCBzaXplb2Yoc3RydWN0IHBrdF9jdHJs
X2NvbW1hbmQpKSkKLQkJcmV0dXJuIC1FRkFVTFQ7CisJCitvdXQ6CisJbXV0ZXhf
dW5sb2NrKCZjdGxfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKLQotc3RhdGlj
IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgcGt0X2N0bF9mb3BzID0gewotCS5pb2N0
bAkgPSBwa3RfY3RsX2lvY3RsLAotCS5vd25lcgkgPSBUSElTX01PRFVMRSwKLX07
Ci0KLXN0YXRpYyBzdHJ1Y3QgbWlzY2RldmljZSBwa3RfbWlzYyA9IHsKLQkubWlu
b3IgCQk9IE1JU0NfRFlOQU1JQ19NSU5PUiwKLQkubmFtZSAgCQk9IERSSVZFUl9O
QU1FLAotCS5mb3BzICAJCT0gJnBrdF9jdGxfZm9wcwotfTsKLSNlbmRpZiAvKiBQ
S1RfVVNFX1BST0NGUyAqLworLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqCisgKgorICogbW9kdWxlIGluaXQg
YW5kIGV4aXQKKyAqCisgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKi8KIAogc3RhdGljIGludCBfX2luaXQgcGt0
X2luaXQodm9pZCkKIHsKQEAgLTI2NDMsMTMgKzI3NTUsMTMgQEAgc3RhdGljIGlu
dCBfX2luaXQgcGt0X2luaXQodm9pZCkKIAlpZiAoIXBzZF9wb29sKQogCQlyZXR1
cm4gLUVOT01FTTsKIAotCXJldCA9IHJlZ2lzdGVyX2Jsa2Rldihwa3RfbWFqb3Is
IERSSVZFUl9OQU1FKTsKKwlyZXQgPSByZWdpc3Rlcl9ibGtkZXYocGt0ZGV2X21h
am9yLCBEUklWRVJfTkFNRSk7CiAJaWYgKHJldCA8IDApIHsKIAkJcHJpbnRrKERS
SVZFUl9OQU1FIjogVW5hYmxlIHRvIHJlZ2lzdGVyIGJsb2NrIGRldmljZVxuIik7
CiAJCWdvdG8gb3V0MjsKIAl9Ci0JaWYgKCFwa3RfbWFqb3IpCi0JCXBrdF9tYWpv
ciA9IHJldDsKKwlpZiAoIXBrdGRldl9tYWpvcikKKwkJcGt0ZGV2X21ham9yID0g
cmV0OwogCiAjaWYgUEtUX1VTRV9QUk9DRlMKIAlyZXQgPSBtaXNjX3JlZ2lzdGVy
KCZwa3RfbWlzYyk7CkBAIC0yNjYzLDcgKzI3NzUsNyBAQCBzdGF0aWMgaW50IF9f
aW5pdCBwa3RfaW5pdCh2b2lkKQogCXJldHVybiAwOwogCiBvdXQ6Ci0JdW5yZWdp
c3Rlcl9ibGtkZXYocGt0X21ham9yLCBEUklWRVJfTkFNRSk7CisJdW5yZWdpc3Rl
cl9ibGtkZXYocGt0ZGV2X21ham9yLCBEUklWRVJfTkFNRSk7CiBvdXQyOgogCW1l
bXBvb2xfZGVzdHJveShwc2RfcG9vbCk7CiAJcmV0dXJuIHJldDsKQEAgLTI2NzUs
NyArMjc4Nyw3IEBAIHN0YXRpYyB2b2lkIF9fZXhpdCBwa3RfZXhpdCh2b2lkKQog
CXJlbW92ZV9wcm9jX2VudHJ5KERSSVZFUl9OQU1FLCBwcm9jX3Jvb3RfZHJpdmVy
KTsKIAltaXNjX2RlcmVnaXN0ZXIoJnBrdF9taXNjKTsKICNlbmRpZgotCXVucmVn
aXN0ZXJfYmxrZGV2KHBrdF9tYWpvciwgRFJJVkVSX05BTUUpOworCXVucmVnaXN0
ZXJfYmxrZGV2KHBrdGRldl9tYWpvciwgRFJJVkVSX05BTUUpOwogCW1lbXBvb2xf
ZGVzdHJveShwc2RfcG9vbCk7CiB9CiAKQEAgLTI2ODYsMyArMjc5OCw1IEBAIE1P
RFVMRV9MSUNFTlNFKCJHUEwiKTsKIAogbW9kdWxlX2luaXQocGt0X2luaXQpOwog
bW9kdWxlX2V4aXQocGt0X2V4aXQpOworCittb2R1bGVfcGFyYW0ocGt0ZGV2X21h
am9yLCBpbnQsIDApOwpkaWZmIC11cnBOIHAyLXByb2Nmcy9pbmNsdWRlL2xpbnV4
L3BrdGNkdmQuaCBwMy1yZXN0cnVjdC9pbmNsdWRlL2xpbnV4L3BrdGNkdmQuaAot
LS0gcDItcHJvY2ZzL2luY2x1ZGUvbGludXgvcGt0Y2R2ZC5oCTIwMDYtMTAtMDEg
MTc6Mzg6MjIuMDAwMDAwMDAwICswMjAwCisrKyBwMy1yZXN0cnVjdC9pbmNsdWRl
L2xpbnV4L3BrdGNkdmQuaAkyMDA2LTEwLTAxIDE3OjQ1OjUyLjAwMDAwMDAwMCAr
MDIwMApAQCAtMTQsNiArMTQsMzYgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3R5cGVz
Lmg+CiAKKyNkZWZpbmUgUEtUX0NUUkxfQ01EX1NFVFVQCTAKKyNkZWZpbmUgUEtU
X0NUUkxfQ01EX1RFQVJET1dOCTEKKyNkZWZpbmUgUEtUX0NUUkxfQ01EX1NUQVRV
UwkyCisKK3N0cnVjdCBwa3RfY3RybF9jb21tYW5kIHsKKwlfX3UzMiBjb21tYW5k
OwkJCQkvKiBpbjogU2V0dXAsIHRlYXJkb3duLCBzdGF0dXMgKi8KKwlfX3UzMiBk
ZXZfaW5kZXg7CQkJLyogaW4vb3V0OiBEZXZpY2UgaW5kZXggKi8KKwlfX3UzMiBk
ZXY7CQkJCS8qIGluL291dDogRGV2aWNlIG5yIGZvciBjZHJ3IGRldmljZSAqLwor
CV9fdTMyIHBrdF9kZXY7CQkJCS8qIGluL291dDogRGV2aWNlIG5yIGZvciBwYWNr
ZXQgZGV2aWNlICovCisJX191MzIgbnVtX2RldmljZXM7CQkJLyogb3V0OiBMYXJn
ZXN0IGRldmljZSBpbmRleCArIDEgKi8KKwlfX3UzMiBwYWRkaW5nOwkJCQkvKiBO
b3QgdXNlZCAqLworfTsKKworLyoKKyAqIHBhY2tldCBpb2N0bHMKKyAqLworI2Rl
ZmluZSBQQUNLRVRfSU9DVExfTUFHSUMJKCdYJykKKyNkZWZpbmUgUEFDS0VUX0NU
UkxfQ01ECQlfSU9XUihQQUNLRVRfSU9DVExfTUFHSUMsIDEsIHN0cnVjdCBwa3Rf
Y3RybF9jb21tYW5kKQorCisKKworLyoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioK
KyAqIGRlZmluZXMgYW5kIHN0cnVjdHMgdXNlZCBpbiB0aGUga2VybmVsIG9ubHkK
KyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqLworI2lmZGVmIF9fS0VSTkVMX18K
KyNpbmNsdWRlIDxsaW51eC9ibGtkZXYuaD4KKyNpbmNsdWRlIDxsaW51eC9jb21w
bGV0aW9uLmg+CisjaW5jbHVkZSA8bGludXgvY2Ryb20uaD4KKworCiAvKgogICog
MSBmb3Igbm9ybWFsIGRlYnVnIG1lc3NhZ2VzLCAyIGlzIHZlcnkgdmVyYm9zZS4g
MCB0byB0dXJuIGl0IG9mZi4KICAqLwpAQCAtMzksOSArNjksMTMgQEAKICNkZWZp
bmUgVVNFX1dDQUNISU5HCQkwCiAjZW5kaWYKIAotLyoKLSAqIE5vIHVzZXItc2Vy
dmljYWJsZSBwYXJ0cyBiZXlvbmQgdGhpcyBwb2ludCAtPgotICovCisvKiB1c2Ug
KG9sZCkgcHJvY2ZzIGludGVyZmFjZT8gKi8KKyNpZmRlZiBDT05GSUdfQ0RST01f
UEtUQ0RWRF9QUk9DSU5URgorI2RlZmluZSBQS1RfVVNFX1BST0NGUyAgMQorI2Vs
c2UKKyNkZWZpbmUgUEtUX1VTRV9QUk9DRlMgIDAKKyNlbmRpZgorCiAKIC8qCiAg
KiBkZXZpY2UgdHlwZXMKQEAgLTg4LDM3ICsxMjIsNiBAQAogCiAjdW5kZWYgUEFD
S0VUX1VTRV9MUwogCi0jZGVmaW5lIFBLVF9DVFJMX0NNRF9TRVRVUAkwCi0jZGVm
aW5lIFBLVF9DVFJMX0NNRF9URUFSRE9XTgkxCi0jZGVmaW5lIFBLVF9DVFJMX0NN
RF9TVEFUVVMJMgotCi1zdHJ1Y3QgcGt0X2N0cmxfY29tbWFuZCB7Ci0JX191MzIg
Y29tbWFuZDsJCQkJLyogaW46IFNldHVwLCB0ZWFyZG93biwgc3RhdHVzICovCi0J
X191MzIgZGV2X2luZGV4OwkJCS8qIGluL291dDogRGV2aWNlIGluZGV4ICovCi0J
X191MzIgZGV2OwkJCQkvKiBpbi9vdXQ6IERldmljZSBuciBmb3IgY2RydyBkZXZp
Y2UgKi8KLQlfX3UzMiBwa3RfZGV2OwkJCQkvKiBpbi9vdXQ6IERldmljZSBuciBm
b3IgcGFja2V0IGRldmljZSAqLwotCV9fdTMyIG51bV9kZXZpY2VzOwkJCS8qIG91
dDogTGFyZ2VzdCBkZXZpY2UgaW5kZXggKyAxICovCi0JX191MzIgcGFkZGluZzsJ
CQkJLyogTm90IHVzZWQgKi8KLX07Ci0KLS8qCi0gKiBwYWNrZXQgaW9jdGxzCi0g
Ki8KLSNkZWZpbmUgUEFDS0VUX0lPQ1RMX01BR0lDCSgnWCcpCi0jZGVmaW5lIFBB
Q0tFVF9DVFJMX0NNRAkJX0lPV1IoUEFDS0VUX0lPQ1RMX01BR0lDLCAxLCBzdHJ1
Y3QgcGt0X2N0cmxfY29tbWFuZCkKLQotI2lmZGVmIF9fS0VSTkVMX18KLSNpbmNs
dWRlIDxsaW51eC9ibGtkZXYuaD4KLSNpbmNsdWRlIDxsaW51eC9jb21wbGV0aW9u
Lmg+Ci0jaW5jbHVkZSA8bGludXgvY2Ryb20uaD4KLQotLyogdXNlIChvbGQpIHBy
b2NmcyBpbnRlcmZhY2U/ICovCi0jaWZkZWYgQ09ORklHX0NEUk9NX1BLVENEVkRf
UFJPQ0lOVEYKLSNkZWZpbmUgUEtUX1VTRV9QUk9DRlMgIDEKLSNlbHNlCi0jZGVm
aW5lIFBLVF9VU0VfUFJPQ0ZTICAwCi0jZW5kaWYKLQogc3RydWN0IHBhY2tldF9z
ZXR0aW5ncwogewogCV9fdTMyCQkJc2l6ZTsJCS8qIHBhY2tldCBzaXplIGluICg1
MTIgYnl0ZSkgc2VjdG9ycyAqLwo=

------------Y2hhvRwqcIOZiECmWFyQeq--

