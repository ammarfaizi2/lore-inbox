Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1422702AbWJRRNA@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1422702AbWJRRNA (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 18 Oct 2006 13:13:00 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1422672AbWJRRNA
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 18 Oct 2006 13:13:00 -0400
Received: from ns2.suse.de ([195.135.220.15]:47311 "EHLO mx2.suse.de")
	by vger.kernel.org with ESMTP id S1422702AbWJRRM6 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 18 Oct 2006 13:12:58 -0400
Date: Wed, 18 Oct 2006 19:12:50 +0200
Message-ID: <s5h64eh5yzx.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Stephen Hemminger <shemminger@osdl.org>
Cc: Prakash Punnoor <prakash@punnoor.de>, Adrian Bunk <bunk@stusta.de>,
       alsa-devel@alsa-project.org, linux-kernel@vger.kernel.org,
       mingo@redhat.com, hnguyen@de.ibm.com, perex@suse.cz
Subject: Re: [Alsa-devel] [RFC: 2.6.19 patch] snd-hda-intel: default MSI to off
In-Reply-To: <20061018100219.5cd08ffd@freekitty>
References: <200610050938.10997.prakash@punnoor.de>
	<5aa69f860610051030l7323ec2el545873570052f077@mail.gmail.com>
	<200610052309.01155.prakash@punnoor.de>
	<20061017211301.GE3502@stusta.de>
	<20061017144053.29b6b29c@freekitty>
	<s5hmz7tapl5.wl%tiwai@suse.de>
	<20061018100219.5cd08ffd@freekitty>
User-Agent: Wanderlust/2.12.0 (Your Wildest Dreams) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.7 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 MULE XEmacs/21.5 (beta25)
 (eggplant) (+CVS-20060326) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 18 Oct 2006 10:02:19 -0700,
Stephen Hemminger wrote:
> 
> On Wed, 18 Oct 2006 12:24:54 +0200
> Takashi Iwai <tiwai@suse.de> wrote:
> 
> > At Tue, 17 Oct 2006 14:40:53 -0700,
> > Stephen Hemminger wrote:
> > > 
> > > On Tue, 17 Oct 2006 23:13:01 +0200
> > > Adrian Bunk <bunk@stusta.de> wrote:
> > > 
> > > > On Thu, Oct 05, 2006 at 11:08:57PM +0200, Prakash Punnoor wrote:
> > > > > Am Donnerstag 05 Oktober 2006 19:30 schrieb Fatih A????c??:
> > > > > > 2006/10/5, Prakash Punnoor <prakash@punnoor.de>:
> > > > > > > Hi,
> > > > > > >
> > > > > > > subjects say it all. Without irqpoll my nic doesn't work anymore. I added
> > > > > > > Ingo
> > > > > > > to cc, as my IRQs look different, so it may be a prob of APIC routing or
> > > > > > > the
> > > > > > > like.
> > > > > 
> > > > > > > Can you try booting with pci=nomsi ? I have a similar problem with my
> > > > > 
> > > > > I used snd-hda-intel.disable_msi=1 and this actually helped! Now the nforce 
> > > > > nic works w/o problems. So it was the audio driver causing havoc on the nic. 
> > > > >...
> > > > 
> > > > Unless someone finds and fixes what causes such problems, I'd therefore 
> > > > suggest the patch below to let MSI support to be turned off by default.
> > > > 
> > > > cu
> > > > Adrian
> > > > 
> > > 
> > > It shouldn't be that hard to write a small bit of code to force an interrupt
> > > and catch it, that's what other drivers do to workaround the BIOS braindamage
> > > that seems to be rampant (until M$ Vista comes out and supports MSI).
> > 
> > OK, what about a patch like below?
> > 
> > It's against the latest ALSA tree, so please pull alsa.git from
> > 	git://kernel.org/pub/scm/linux/kernel/git/perex/alsa.git
> > before applying it (this tree includes only patches to be pushed to
> > 2.6.19).
> > 
> > 
> > Takashi
> > 
> 
> Don't you need to check return value from pci_enable_msi()?

Yes, it would be better to check the value and reset chip->msi if
not successful.  But it's not a fatal error, so the current code
should work.


Takashi
