Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262499AbUKLKwl@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262499AbUKLKwl (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 12 Nov 2004 05:52:41 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262500AbUKLKvr
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 12 Nov 2004 05:51:47 -0500
Received: from mx1.redhat.com ([66.187.233.31]:38846 "EHLO mx1.redhat.com")
	by vger.kernel.org with ESMTP id S262499AbUKLKvT (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 12 Nov 2004 05:51:19 -0500
From: David Howells <dhowells@redhat.com>
In-Reply-To: <20041111144153.588094d2.akpm@osdl.org> 
References: <20041111144153.588094d2.akpm@osdl.org>  <20041111012333.1b529478.akpm@osdl.org> <20041111030837.12a2090b.akpm@osdl.org> <111920000.1100210158@flay> 
To: Andrew Morton <akpm@osdl.org>
Cc: "Martin J. Bligh" <mbligh@aracnet.com>, linux-kernel@vger.kernel.org
Subject: [PATCH] Fix SHMEM options
User-Agent: EMH/1.14.1 SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 Emacs/21.3 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Date: Fri, 12 Nov 2004 10:50:58 +0000
Message-ID: <20652.1100256658@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


> This change permits CONFIG_SHMEM=n on !CONFIG_MMU, even if !EMBEDDED.  Or
> something.  I'm not really sure what it's trying to do, nor am I clear on
> what semantics we wanted to have for CONFIG_SHMEM on CONFIG_MMU machines.
> 
> I think the semantics we want are: you always get shmem, unless you
> selected EMBEDDED.  So perhaps we want:

It boils down to:

 (1) You can't use full shmem if !MMU. You have to use tinyshmem instead.

 (2) On an embedded system, you might want to drop shmem because you don't
     have much flash in which to store your kernel.

This seems to have the desired effect:

	config SHMEM
		bool "Use full shmem filesystem" if EMBEDDED
		depends on MMU
		default y if MMU

David

---

The attached patch fixes the semantics of the SHMEM kernel configuration
option. Manual selectability is not contingent on EMBEDDED being configured,
and the option as a whole is only available if MMU is configured.

Signed-Off-By: David Howells <dhowells@redhat.com>
---
diff -uNrp /warthog/kernels/linux-2.6.10-rc1-mm5/init/Kconfig linux-2.6.10-rc1-mm5-frv/init/Kconfig
--- /warthog/kernels/linux-2.6.10-rc1-mm5/init/Kconfig	2004-11-11 11:48:41.000000000 +0000
+++ linux-2.6.10-rc1-mm5-frv/init/Kconfig	2004-11-12 10:40:28.583887179 +0000
@@ -327,8 +327,8 @@ config CC_OPTIMIZE_FOR_SIZE
 	  If unsure, say N.
 
 config SHMEM
-	bool "Use full shmem filesystem"
-	default y if EMBEDDED
+	bool "Use full shmem filesystem" if EMBEDDED
+	default y if MMU
 	depends on MMU
 	help
 	  The shmem is an internal filesystem used to manage shared memory.
