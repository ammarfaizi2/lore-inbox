Return-Path: <linux-kernel-owner+willy=40w.ods.org-S264647AbUFGN7g@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264647AbUFGN7g (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 7 Jun 2004 09:59:36 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264646AbUFGN7g
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 7 Jun 2004 09:59:36 -0400
Received: from cantor.suse.de ([195.135.220.2]:46296 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S264647AbUFGN7X (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 7 Jun 2004 09:59:23 -0400
Date: Mon, 07 Jun 2004 15:57:51 +0200
Message-ID: <s5h7juj4gio.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Jeff Garzik <jgarzik@pobox.com>
Cc: linux-kernel@vger.kernel.org, viro@parcelfarce.linux.theplanet.co.uk,
       perex@suse.cz, torvalds@osdl.org
Subject: Re: [RFC] ASLA design, depth of code review and lack thereof
In-Reply-To: <40C471FC.3000802@pobox.com>
References: <20040604230819.GR12308@parcelfarce.linux.theplanet.co.uk>
	<40C107D2.9030301@pobox.com>
	<s5hekor4i2c.wl@alsa2.suse.de>
	<40C471FC.3000802@pobox.com>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 07 Jun 2004 09:47:40 -0400,
Jeff Garzik wrote:
> 
> Takashi Iwai wrote:
> > At Fri, 04 Jun 2004 19:37:54 -0400,
> > Jeff Garzik wrote:
> > 
> >>
> >>While we're bitching about ALSA, can we please kill the 
> >>subsystem-specific malloc and "magic cast" wrappers?
> >>This debug machinery is better done elsewhere...
> > 
> > 
> > Of course we can remove kmalloc/vmalloc wrappers for cast checking
> > once when the kernel core provides a similar debugging mechanism.
> > Do you know any alternative?
> 
> 
> CONFIG_DEBUG_SLAB and CONFIG_DEBUG_PAGEALLOC.  Other stuff should go 
> into ALSA developer trees or use of a debugger, not be in mainline 
> kernel code.

They're nice but they don't provide "cast checking", no?
The main purpose of the magic_* stuffs in ALSA is to check the cast of
the void pointer back to the original data type, which the compiler
can't check.

Maybe we can implement only this "magic" check separetly and get rid
of allocation checks, but I'm not sure whether it's worthy to do
that.


Takashi
