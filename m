Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264509AbTKNFbY (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 14 Nov 2003 00:31:24 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264510AbTKNFbY
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 14 Nov 2003 00:31:24 -0500
Received: from fmr06.intel.com ([134.134.136.7]:22675 "EHLO
	caduceus.jf.intel.com") by vger.kernel.org with ESMTP
	id S264509AbTKNFbI convert rfc822-to-8bit (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 14 Nov 2003 00:31:08 -0500
content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 8BIT
X-MimeOLE: Produced By Microsoft Exchange V6.0.6487.1
Subject: RE: invalid SMP mptable on Toshiba Satellite 2430-301
Date: Thu, 13 Nov 2003 21:31:04 -0800
Message-ID: <7F740D512C7C1046AB53446D3720017361873B@scsmsx402.sc.intel.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: invalid SMP mptable on Toshiba Satellite 2430-301
Thread-Index: AcOqFxulbqA9O/H3T4mBD0zBrSKWZgAWIWXg
From: "Nakajima, Jun" <jun.nakajima@intel.com>
To: "Jochen Voss" <voss@seehuhn.de>, "Linus Torvalds" <torvalds@osdl.org>
Cc: <linux-kernel@vger.kernel.org>
X-OriginalArrivalTime: 14 Nov 2003 05:31:04.0853 (UTC) FILETIME=[7F7E0450:01C3AA70]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

What's happening is that the kernel did not found interesting things in
ACPI (no local APIC and no I/O APIC), and decided to fall back to MPS.
Then MPS detection code was not robust, calling panic(). So we should
fix the MPS code that calls panic().

We can stop the fallback to MPS if ACPI is detected right, but probably
we should keep the priority at this point, assuming MPS is still more
correct; this is a bug with MPS parsing. 

	Jun

> -----Original Message-----
> From: linux-kernel-owner@vger.kernel.org [mailto:linux-kernel-
> owner@vger.kernel.org] On Behalf Of Jochen Voss
> Sent: Thursday, November 13, 2003 10:45 AM
> To: Linus Torvalds
> Cc: linux-kernel@vger.kernel.org
> Subject: Re: invalid SMP mptable on Toshiba Satellite 2430-301
> 
> Hello,
> 
> On Thu, Nov 13, 2003 at 10:13:08AM -0800, Linus Torvalds wrote:
> > Hmm.. Do you have ACPI enabled? We really shouldn't need the MP
table if
> > the information is elsewhere, but the mptable assumptions might be a
bit
> > entrenched.
> 
> With SMP and ACPI enabled I get the following kernel
> boot messages
> 
>     Intel MultiProcessor Specification v1.4
> 	Virtual Wire compatibility mode.
>     SMP mptable: bad signature [0x0]!
>     BIOS bug, MP table errors detected!...
>     ... disabling SMP support. (tell your hw vendor)
> 
> The last message is generated by the following code
> in arch/i386/kernel/mpparse.c:
> 
>     if (!smp_read_mpc((void *)mpf->mpf_physptr)) {
>         smp_found_config = 0;
>         printk(KERN_ERR "BIOS bug, MP table errors detected!...\n");
>         printk(KERN_ERR "... disabling SMP support. (tell your hw
> vendor)\n");
>         return;
>     }
> 
> I don't know what effects are caused by the 'smp_found_config = 0',
> but later-on the following messages appear:
> 
>     No local APIC present or hardware disabled
>     ...
>     CPU:     After generic identify, caps: bfebf9ff 00000000 00000000
> 00000000
>     CPU:     After vendor identify, caps: bfebf9ff 00000000 00000000
> 00000000
>     CPU: Trace cache: 12K uops, L1 D cache: 8K
>     CPU: L2 cache: 512K
>     CPU: Hyper-Threading is disabled
>     CPU:     After all inits, caps: bfebf9ff 00000000 00000000
00000080
>     ...
>     SMP motherboard not detected.
>     Local APIC not detected. Using dummy APIC emulation.
>     Starting migration thread for cpu 0
>     CPUS done 4
> 
> I hope this helps,
> Jochen
> --
> http://seehuhn.de/
