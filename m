Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261895AbUKPX1D@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261895AbUKPX1D (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 16 Nov 2004 18:27:03 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261892AbUKPXZy
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 16 Nov 2004 18:25:54 -0500
Received: from zeus.kernel.org ([204.152.189.113]:19361 "EHLO zeus.kernel.org")
	by vger.kernel.org with ESMTP id S261886AbUKPXJE (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 16 Nov 2004 18:09:04 -0500
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
        s=beta; d=gmail.com;
        h=received:message-id:date:from:reply-to:to:subject:cc:in-reply-to:mime-version:content-type:references;
        b=eEffqsx6bOU8OL35uInMWXPDdrWJNGXa24DUxuOWyPsUlj4fig4LGsaBsEkVgE+8Yq+ANdp/mH0yxT6uia+GSjOCpek4pV4f9RCoB0+fojwS7TtW91X8OrlM2D845b5SXhOF5w/6SVx98MXee0vgN96zXovkMJHYi250KdgGGnk=
Message-ID: <d120d50004111612437ebe76d9@mail.gmail.com>
Date: Tue, 16 Nov 2004 15:43:21 -0500
From: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Reply-To: dtor_core@ameritech.net
To: Greg KH <greg@kroah.com>
Subject: Re: [RFC] [PATCH] driver core: allow userspace to unbind drivers from devices.
Cc: linux-kernel@vger.kernel.org, Tejun Heo <tj@home-tj.org>,
       Patrick Mochel <mochel@digitalimplant.org>,
       Adam Belay <ambx1@neo.rr.com>
In-Reply-To: <20041116055440.GH29328@kroah.com>
Mime-Version: 1.0
Content-Type: multipart/mixed; 
	boundary="----=_Part_151_25104904.1100637801412"
References: <20041109223729.GB7416@kroah.com>
	 <d120d5000411091536115ac91b@mail.gmail.com>
	 <20041110003323.GA8672@kroah.com>
	 <200411092249.44561.dtor_core@ameritech.net>
	 <20041116055440.GH29328@kroah.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------=_Part_151_25104904.1100637801412
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

On Mon, 15 Nov 2004 21:54:40 -0800, Greg KH <greg@kroah.com> wrote:
> On Tue, Nov 09, 2004 at 10:49:43PM -0500, Dmitry Torokhov wrote:
> > In the meantime, can I please have bind_mode patch applied? I believe
> > it is useful regardless of which bind/unbind solution will be adopted
> > and having them will allow me clean up serio bus implementaion quite a
> > bit.
> >
> > Pretty please...
> 
> Care to resend it?  I can't find it in my archives.
> 

Here it is, against 2.6.10-rc2. Apologies for sending it as an attachment
but this interface will not let me put it inline without mangling.

-- 
Dmitry

------=_Part_151_25104904.1100637801412
Content-Type: application/octet-stream; name="bind_mode-attr.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="bind_mode-attr.patch"

PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQoKQ2hhbmdlU2V0QDEuMTk2MywgMjAwNC0xMS0xNiAwMjowNzoxNS0wNTowMCwg
ZHRvcl9jb3JlQGFtZXJpdGVjaC5uZXQKICBEcml2ZXIgY29yZTogYWRkICJiaW5kX21vZGUiIGRl
ZmF1bHQgZGV2aWNlIGFuZCBkcml2ZXIgYXR0cmlidXRlLgogICAgICAgICAgICAgICBDYWxscyB0
byBkZXZpY2VfYXR0YWNoKCkgYW5kIGRyaXZlcl9hdHRhY2goKSB3aWxsIG5vdAogICAgICAgICAg
ICAgICBiaW5kIGRldmljZSBhbmQgZHJpdmVyIGlmIGVpdGhlciBvbmUgb2YgdGhlbSBpcyBpbgog
ICAgICAgICAgICAgICAibWFudWFsIiBiaW5kIG1vZGUuIE1hbnVhbCBiaW5kaW5nIGlzIGV4cGVj
dGVkIHRvIGJlCiAgICAgICAgICAgICAgIGhhbmRsZWQgYnkgYnVzJ3MgZHJ2Y3RsKCkKICAKICAg
ICAgICAgICBlY2hvIC1uICJtYW51YWwiID4gL3N1cy9idXMvc2VyaW8vZGV2aWNlcy9zZXJpbzIv
YmluZF9tb2RlCiAgICAgICAgICAgZWNobyAtbiAiYXV0byIgPiAvc3lzL2J1cy9zZXJpby9kcml2
ZXJzL3NlcmlvX3Jhdy9iaW5kX21vZGUKICAKICBTaWduZWQtb2ZmLWJ5OiBEbWl0cnkgVG9yb2to
b3YgPGR0b3JAbWFpbC5ydT4KCgogZHJpdmVycy9iYXNlL2J1cy5jICAgICAgICAgICAgICB8ICAg
MjAgKysrKysrKy0tLS0KIGRyaXZlcnMvYmFzZS9pbnRlcmZhY2UuYyAgICAgICAgfCAgIDcwICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0KIGRyaXZlcnMvaW5wdXQvc2Vy
aW8vc2VyaW8uYyAgICAgfCAgIDU4ICsrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9pbnB1dC9zZXJpby9zZXJpb19yYXcuYyB8ICAgIDQgKy0KIGluY2x1ZGUvbGludXgv
ZGV2aWNlLmggICAgICAgICAgfCAgICA1ICsrCiBpbmNsdWRlL2xpbnV4L3NlcmlvLmggICAgICAg
ICAgIHwgICAgNCAtLQogNiBmaWxlcyBjaGFuZ2VkLCA4OSBpbnNlcnRpb25zKCspLCA3MiBkZWxl
dGlvbnMoLSkKCgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09CgoKZGlmZiAtdXJOIGEvZHJpdmVycy9iYXNlL2J1cy5jIGIv
ZHJpdmVycy9iYXNlL2J1cy5jCi0tLSBhL2RyaXZlcnMvYmFzZS9idXMuYwkyMDA0LTExLTE2IDAy
OjIwOjUzIC0wNTAwCisrKyBiL2RyaXZlcnMvYmFzZS9idXMuYwkyMDA0LTExLTE2IDAyOjIwOjUz
IC0wNTAwCkBAIC02OCw5ICs2OCwxMiBAQAogCXVwKCZkcnYtPnVubG9hZF9zZW0pOwogfQogCitl
eHRlcm4gc3RydWN0IGF0dHJpYnV0ZSAqIGRydl9kZWZhdWx0X2F0dHJzW107CisKIHN0YXRpYyBz
dHJ1Y3Qga29ial90eXBlIGt0eXBlX2RyaXZlciA9IHsKIAkuc3lzZnNfb3BzCT0gJmRyaXZlcl9z
eXNmc19vcHMsCiAJLnJlbGVhc2UJPSBkcml2ZXJfcmVsZWFzZSwKKwkuZGVmYXVsdF9hdHRycwk9
IGRydl9kZWZhdWx0X2F0dHJzLAogfTsKIAogCkBAIC0zMTksOSArMzIyLDEyIEBACiAJCXJldHVy
biAxOwogCX0KIAotCWlmIChidXMtPm1hdGNoKSB7Ci0JCWxpc3RfZm9yX2VhY2goZW50cnksICZi
dXMtPmRyaXZlcnMubGlzdCkgewotCQkJc3RydWN0IGRldmljZV9kcml2ZXIgKiBkcnYgPSB0b19k
cnYoZW50cnkpOworCWlmIChkZXYtPm1hbnVhbF9iaW5kIHx8ICFidXMtPm1hdGNoKQorCQlyZXR1
cm4gMDsKKworCWxpc3RfZm9yX2VhY2goZW50cnksICZidXMtPmRyaXZlcnMubGlzdCkgeworCQlz
dHJ1Y3QgZGV2aWNlX2RyaXZlciAqIGRydiA9IHRvX2RydihlbnRyeSk7CisJCWlmICghZHJ2LT5t
YW51YWxfYmluZCkgewogCQkJZXJyb3IgPSBkcml2ZXJfcHJvYmVfZGV2aWNlKGRydiwgZGV2KTsK
IAkJCWlmICghZXJyb3IpCiAJCQkJLyogc3VjY2VzcywgZHJpdmVyIG1hdGNoZWQgKi8KQEAgLTMy
OSw4ICszMzUsOCBAQAogCQkJaWYgKGVycm9yICE9IC1FTk9ERVYpCiAJCQkJLyogZHJpdmVyIG1h
dGNoZWQgYnV0IHRoZSBwcm9iZSBmYWlsZWQgKi8KIAkJCQlwcmludGsoS0VSTl9XQVJOSU5HCi0J
CQkJICAgICIlczogcHJvYmUgb2YgJXMgZmFpbGVkIHdpdGggZXJyb3IgJWRcbiIsCi0JCQkJICAg
IGRydi0+bmFtZSwgZGV2LT5idXNfaWQsIGVycm9yKTsKKwkJCQkJIiVzOiBwcm9iZSBvZiAlcyBm
YWlsZWQgd2l0aCBlcnJvciAlZFxuIiwKKwkJCQkJZHJ2LT5uYW1lLCBkZXYtPmJ1c19pZCwgZXJy
b3IpOwogCQl9CiAJfQogCkBAIC0zNTYsMTIgKzM2MiwxMiBAQAogCXN0cnVjdCBsaXN0X2hlYWQg
KiBlbnRyeTsKIAlpbnQgZXJyb3I7CiAKLQlpZiAoIWJ1cy0+bWF0Y2gpCisJaWYgKGRydi0+bWFu
dWFsX2JpbmQgfHwgIWJ1cy0+bWF0Y2gpCiAJCXJldHVybjsKIAogCWxpc3RfZm9yX2VhY2goZW50
cnksICZidXMtPmRldmljZXMubGlzdCkgewogCQlzdHJ1Y3QgZGV2aWNlICogZGV2ID0gY29udGFp
bmVyX29mKGVudHJ5LCBzdHJ1Y3QgZGV2aWNlLCBidXNfbGlzdCk7Ci0JCWlmICghZGV2LT5kcml2
ZXIpIHsKKwkJaWYgKCFkZXYtPmRyaXZlciAmJiAhZGV2LT5tYW51YWxfYmluZCkgewogCQkJZXJy
b3IgPSBkcml2ZXJfcHJvYmVfZGV2aWNlKGRydiwgZGV2KTsKIAkJCWlmIChlcnJvciAmJiAoZXJy
b3IgIT0gLUVOT0RFVikpCiAJCQkJLyogZHJpdmVyIG1hdGNoZWQgYnV0IHRoZSBwcm9iZSBmYWls
ZWQgKi8KZGlmZiAtdXJOIGEvZHJpdmVycy9iYXNlL2ludGVyZmFjZS5jIGIvZHJpdmVycy9iYXNl
L2ludGVyZmFjZS5jCi0tLSBhL2RyaXZlcnMvYmFzZS9pbnRlcmZhY2UuYwkyMDA0LTExLTE2IDAy
OjIwOjUzIC0wNTAwCisrKyBiL2RyaXZlcnMvYmFzZS9pbnRlcmZhY2UuYwkyMDA0LTExLTE2IDAy
OjIwOjUzIC0wNTAwCkBAIC0xLDYgKzEsNiBAQAogLyoKICAqIGRyaXZlcnMvYmFzZS9pbnRlcmZh
Y2UuYyAtIGNvbW1vbiBkcml2ZXJmcyBpbnRlcmZhY2UgdGhhdCdzIGV4cG9ydGVkIHRvCi0gKiAJ
dGhlIHdvcmxkIGZvciBhbGwgZGV2aWNlcy4KKyAqIAl0aGUgd29ybGQgZm9yIGFsbCBkZXZpY2Vz
IGFuZCBkcml2ZXJzLgogICoKICAqIENvcHlyaWdodCAoYykgMjAwMi0zIFBhdHJpY2sgTW9jaGVs
CiAgKiBDb3B5cmlnaHQgKGMpIDIwMDItMyBPcGVuIFNvdXJjZSBEZXZlbG9wbWVudCBMYWJzCkBA
IC0xNCw2ICsxNCw0MCBAQAogI2luY2x1ZGUgPGxpbnV4L3N0YXQuaD4KICNpbmNsdWRlIDxsaW51
eC9zdHJpbmcuaD4KIAorCitzdGF0aWMgaW50IHBhcnNlX2JpbmRfbW9kZShjb25zdCBjaGFyICog
YnVmLCBzaXplX3QgY291bnQsIHVuc2lnbmVkIGludCAqIG1hbnVhbF9iaW5kKQoreworCWludCBy
ZXR2YWwgPSBjb3VudDsKKworCWlmICghc3RybmNtcChidWYsICJtYW51YWwiLCBjb3VudCkpIHsK
KwkJKm1hbnVhbF9iaW5kID0gMTsKKwl9IGVsc2UgaWYgKCFzdHJuY21wKGJ1ZiwgImF1dG8iLCBj
b3VudCkpIHsKKwkJKm1hbnVhbF9iaW5kID0gMDsKKwl9IGVsc2UgeworCQlyZXR2YWwgPSAtRUlO
VkFMOworCX0KKwlyZXR1cm4gcmV0dmFsOworfQorCisvKioKKyAqCWJpbmRfbW9kZSAtIGNvbnRy
b2xzIHRoZSBiaW5kaW5nIG1vZGUgZm9yIHRoZSBkZXZpY2UuCisgKgorICoJV2hlbiBzZXQgdG8g
ImF1dG8iIGRyaXZlciBjb3JlIHdpbGwgdHJ5IHRvIGF1dG9tYXRpY2FsbHkgYmluZCB0aGUKKyAq
CWRldmljZSBvbmNlIGFwcHJvcHJpYXRlIGRyaXZlciBiZWNvbWVzIGF2YWlsYWJsZS4gV2hlbiBi
aW5kIG1vZGUKKyAqCWlzICJtYW51YWwiIHVzZXIgaW50ZXJ2ZW50aW9uIGlzIHJlcXVpcmVkLgor
ICovCisKK3N0YXRpYyBzc2l6ZV90IGRldl9iaW5kX21vZGVfc2hvdyhzdHJ1Y3QgZGV2aWNlICog
ZGV2LCBjaGFyICogYnVmKQoreworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBkZXYtPm1h
bnVhbF9iaW5kID8gIm1hbnVhbCIgOiAiYXV0byIpOworfQorCitzdGF0aWMgc3NpemVfdCBkZXZf
YmluZF9tb2RlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKiBkZXYsIGNvbnN0IGNoYXIgKiBidWYsIHNp
emVfdCBjb3VudCkKK3sKKwlyZXR1cm4gcGFyc2VfYmluZF9tb2RlKGJ1ZiwgY291bnQsICZkZXYt
Pm1hbnVhbF9iaW5kKTsKK30KKworCiAvKioKICAqCWRldGFjaF9zdGF0ZSAtIGNvbnRyb2wgdGhl
IGRlZmF1bHQgcG93ZXIgc3RhdGUgZm9yIHRoZSBkZXZpY2UuCiAgKgpAQCAtMjcsMTIgKzYxLDEy
IEBACiAgKglkcml2ZXIncyBzdXNwZW5kIG1ldGhvZC4KICAqLwogCi1zdGF0aWMgc3NpemVfdCBk
ZXRhY2hfc2hvdyhzdHJ1Y3QgZGV2aWNlICogZGV2LCBjaGFyICogYnVmKQorc3RhdGljIHNzaXpl
X3QgZGV2X2RldGFjaF9zaG93KHN0cnVjdCBkZXZpY2UgKiBkZXYsIGNoYXIgKiBidWYpCiB7CiAJ
cmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsIGRldi0+ZGV0YWNoX3N0YXRlKTsKIH0KIAotc3Rh
dGljIHNzaXplX3QgZGV0YWNoX3N0b3JlKHN0cnVjdCBkZXZpY2UgKiBkZXYsIGNvbnN0IGNoYXIg
KiBidWYsIHNpemVfdCBuKQorc3RhdGljIHNzaXplX3QgZGV2X2RldGFjaF9zdG9yZShzdHJ1Y3Qg
ZGV2aWNlICogZGV2LCBjb25zdCBjaGFyICogYnVmLCBzaXplX3QgbikKIHsKIAl1MzIgc3RhdGU7
CiAJc3RhdGUgPSBzaW1wbGVfc3RydG91bChidWYsIE5VTEwsIDEwKTsKQEAgLTQyLDEwICs3Niwz
NiBAQAogCXJldHVybiBuOwogfQogCi1zdGF0aWMgREVWSUNFX0FUVFIoZGV0YWNoX3N0YXRlLCAw
NjQ0LCBkZXRhY2hfc2hvdywgZGV0YWNoX3N0b3JlKTsKLQorc3RhdGljIERFVklDRV9BVFRSKGJp
bmRfbW9kZSwgMDY0NCwgZGV2X2JpbmRfbW9kZV9zaG93LCBkZXZfYmluZF9tb2RlX3N0b3JlKTsK
K3N0YXRpYyBERVZJQ0VfQVRUUihkZXRhY2hfc3RhdGUsIDA2NDQsIGRldl9kZXRhY2hfc2hvdywg
ZGV2X2RldGFjaF9zdG9yZSk7CiAKIHN0cnVjdCBhdHRyaWJ1dGUgKiBkZXZfZGVmYXVsdF9hdHRy
c1tdID0geworCSZkZXZfYXR0cl9iaW5kX21vZGUuYXR0ciwKIAkmZGV2X2F0dHJfZGV0YWNoX3N0
YXRlLmF0dHIsCiAJTlVMTCwKIH07CisKKy8qKgorICoJYmluZF9tb2RlIC0gY29udHJvbHMgdGhl
IGJpbmRpbmcgbW9kZSBmb3IgdGhlIGRyaXZlci4KKyAqCisgKglXaGVuIHNldCB0byAiYXV0byIg
ZHJpdmVyIGNvcmUgd2lsbCB0cnkgdG8gYXV0b21hdGljYWxseSBiaW5kIHRoZQorICoJZHJpdmVy
IG9uY2UgYXBwcm9wcmlhdGUgZGV2aWNlIGJlY29tZXMgYXZhaWxhYmxlLiBXaGVuIGJpbmQgbW9k
ZQorICoJaXMgIm1hbnVhbCIgdXNlciBpbnRlcnZlbnRpb24gaXMgcmVxdWlyZWQuCisgKi8KKwor
c3RhdGljIHNzaXplX3QgZHJ2X2JpbmRfbW9kZV9zaG93KHN0cnVjdCBkZXZpY2VfZHJpdmVyICog
ZHJ2LCBjaGFyICogYnVmKQoreworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBkcnYtPm1h
bnVhbF9iaW5kID8gIm1hbnVhbCIgOiAiYXV0byIpOworfQorCitzdGF0aWMgc3NpemVfdCBkcnZf
YmluZF9tb2RlX3N0b3JlKHN0cnVjdCBkZXZpY2VfZHJpdmVyICogZHJ2LCBjb25zdCBjaGFyICog
YnVmLCBzaXplX3QgY291bnQpCit7CisJcmV0dXJuIHBhcnNlX2JpbmRfbW9kZShidWYsIGNvdW50
LCAmZHJ2LT5tYW51YWxfYmluZCk7Cit9CisKK3N0YXRpYyBEUklWRVJfQVRUUihiaW5kX21vZGUs
IDA2NDQsIGRydl9iaW5kX21vZGVfc2hvdywgZHJ2X2JpbmRfbW9kZV9zdG9yZSk7CisKK3N0cnVj
dCBhdHRyaWJ1dGUgKiBkcnZfZGVmYXVsdF9hdHRyc1tdID0geworCSZkcml2ZXJfYXR0cl9iaW5k
X21vZGUuYXR0ciwKKwlOVUxMLAorfTsKZGlmZiAtdXJOIGEvZHJpdmVycy9pbnB1dC9zZXJpby9z
ZXJpby5jIGIvZHJpdmVycy9pbnB1dC9zZXJpby9zZXJpby5jCi0tLSBhL2RyaXZlcnMvaW5wdXQv
c2VyaW8vc2VyaW8uYwkyMDA0LTExLTE2IDAyOjIwOjUzIC0wNTAwCisrKyBiL2RyaXZlcnMvaW5w
dXQvc2VyaW8vc2VyaW8uYwkyMDA0LTExLTE2IDAyOjIwOjUzIC0wNTAwCkBAIC05Miw3ICs5Miw3
IEBACiAJc3RydWN0IHNlcmlvX2RyaXZlciAqZHJ2OwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShk
cnYsICZzZXJpb19kcml2ZXJfbGlzdCwgbm9kZSkKLQkJaWYgKCFkcnYtPm1hbnVhbF9iaW5kKQor
CQlpZiAoIWRydi0+ZHJpdmVyLm1hbnVhbF9iaW5kKQogCQkJaWYgKHNlcmlvX2JpbmRfZHJpdmVy
KHNlcmlvLCBkcnYpKQogCQkJCWJyZWFrOwogfQpAQCAtMjc3LDMzICsyNzcsOSBAQAogCXJldHVy
biByZXR2YWw7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHNlcmlvX3Nob3dfYmluZF9tb2RlKHN0cnVj
dCBkZXZpY2UgKmRldiwgY2hhciAqYnVmKQotewotCXN0cnVjdCBzZXJpbyAqc2VyaW8gPSB0b19z
ZXJpb19wb3J0KGRldik7Ci0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIHNlcmlvLT5tYW51
YWxfYmluZCA/ICJtYW51YWwiIDogImF1dG8iKTsKLX0KLQotc3RhdGljIHNzaXplX3Qgc2VyaW9f
c2V0X2JpbmRfbW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90
IGNvdW50KQotewotCXN0cnVjdCBzZXJpbyAqc2VyaW8gPSB0b19zZXJpb19wb3J0KGRldik7Ci0J
aW50IHJldHZhbDsKLQotCXJldHZhbCA9IGNvdW50OwotCWlmICghc3RybmNtcChidWYsICJtYW51
YWwiLCBjb3VudCkpIHsKLQkJc2VyaW8tPm1hbnVhbF9iaW5kID0gMTsKLQl9IGVsc2UgaWYgKCFz
dHJuY21wKGJ1ZiwgImF1dG8iLCBjb3VudCkpIHsKLQkJc2VyaW8tPm1hbnVhbF9iaW5kID0gMDsK
LQl9IGVsc2UgewotCQlyZXR2YWwgPSAtRUlOVkFMOwotCX0KLQotCXJldHVybiByZXR2YWw7Ci19
Ci0KIHN0YXRpYyBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSBzZXJpb19kZXZpY2VfYXR0cnNbXSA9
IHsKIAlfX0FUVFIoZGVzY3JpcHRpb24sIFNfSVJVR08sIHNlcmlvX3Nob3dfZGVzY3JpcHRpb24s
IE5VTEwpLAogCV9fQVRUUihkcnZjdGwsIFNfSVdVU1IsIE5VTEwsIHNlcmlvX3JlYmluZF9kcml2
ZXIpLAotCV9fQVRUUihiaW5kX21vZGUsIFNfSVdVU1IgfCBTX0lSVUdPLCBzZXJpb19zaG93X2Jp
bmRfbW9kZSwgc2VyaW9fc2V0X2JpbmRfbW9kZSksCiAJX19BVFRSX05VTEwKIH07CiAKQEAgLTM3
MSw3ICszNDcsNyBAQAogCiAJaWYgKGRydikKIAkJc2VyaW9fYmluZF9kcml2ZXIoc2VyaW8sIGRy
dik7Ci0JZWxzZSBpZiAoIXNlcmlvLT5tYW51YWxfYmluZCkKKwllbHNlIGlmICghc2VyaW8tPmRl
di5tYW51YWxfYmluZCkKIAkJc2VyaW9fZmluZF9kcml2ZXIoc2VyaW8pOwogCiAJLyogT2ssIG5v
dyBiaW5kIGNoaWxkcmVuLCBpZiBhbnkgKi8KQEAgLTM4Myw3ICszNTksNyBAQAogCiAJCXNlcmlv
X2NyZWF0ZV9wb3J0KHNlcmlvKTsKIAotCQlpZiAoIXNlcmlvLT5tYW51YWxfYmluZCkgeworCQlp
ZiAoIXNlcmlvLT5kZXYubWFudWFsX2JpbmQpIHsKIAkJCS8qCiAJCQkgKiBXaXRoIGNoaWxkcmVu
IHdlIGp1c3QgX3ByZWZlcl8gcGFzc2VkIGluIGRyaXZlciwKIAkJCSAqIGJ1dCB3ZSB3aWxsIHRy
eSBvdGhlciBvcHRpb25zIGluIGNhc2UgcHJlZmVycmVkCkBAIC01MDUsMzQgKzQ4MSw4IEBACiAJ
cmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGRyaXZlci0+ZGVzY3JpcHRpb24gPyBkcml2ZXIt
PmRlc2NyaXB0aW9uIDogIihub25lKSIpOwogfQogCi1zdGF0aWMgc3NpemVfdCBzZXJpb19kcml2
ZXJfc2hvd19iaW5kX21vZGUoc3RydWN0IGRldmljZV9kcml2ZXIgKmRydiwgY2hhciAqYnVmKQot
ewotCXN0cnVjdCBzZXJpb19kcml2ZXIgKnNlcmlvX2RydiA9IHRvX3NlcmlvX2RyaXZlcihkcnYp
OwotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBzZXJpb19kcnYtPm1hbnVhbF9iaW5kID8g
Im1hbnVhbCIgOiAiYXV0byIpOwotfQotCi1zdGF0aWMgc3NpemVfdCBzZXJpb19kcml2ZXJfc2V0
X2JpbmRfbW9kZShzdHJ1Y3QgZGV2aWNlX2RyaXZlciAqZHJ2LCBjb25zdCBjaGFyICpidWYsIHNp
emVfdCBjb3VudCkKLXsKLQlzdHJ1Y3Qgc2VyaW9fZHJpdmVyICpzZXJpb19kcnYgPSB0b19zZXJp
b19kcml2ZXIoZHJ2KTsKLQlpbnQgcmV0dmFsOwotCi0JcmV0dmFsID0gY291bnQ7Ci0JaWYgKCFz
dHJuY21wKGJ1ZiwgIm1hbnVhbCIsIGNvdW50KSkgewotCQlzZXJpb19kcnYtPm1hbnVhbF9iaW5k
ID0gMTsKLQl9IGVsc2UgaWYgKCFzdHJuY21wKGJ1ZiwgImF1dG8iLCBjb3VudCkpIHsKLQkJc2Vy
aW9fZHJ2LT5tYW51YWxfYmluZCA9IDA7Ci0JfSBlbHNlIHsKLQkJcmV0dmFsID0gLUVJTlZBTDsK
LQl9Ci0KLQlyZXR1cm4gcmV0dmFsOwotfQotCi0KIHN0YXRpYyBzdHJ1Y3QgZHJpdmVyX2F0dHJp
YnV0ZSBzZXJpb19kcml2ZXJfYXR0cnNbXSA9IHsKIAlfX0FUVFIoZGVzY3JpcHRpb24sIFNfSVJV
R08sIHNlcmlvX2RyaXZlcl9zaG93X2Rlc2NyaXB0aW9uLCBOVUxMKSwKLQlfX0FUVFIoYmluZF9t
b2RlLCBTX0lXVVNSIHwgU19JUlVHTywKLQkJc2VyaW9fZHJpdmVyX3Nob3dfYmluZF9tb2RlLCBz
ZXJpb19kcml2ZXJfc2V0X2JpbmRfbW9kZSksCiAJX19BVFRSX05VTEwKIH07CiAKQEAgLTU0Nyw3
ICs0OTcsNyBAQAogCWRydi0+ZHJpdmVyLmJ1cyA9ICZzZXJpb19idXM7CiAJZHJpdmVyX3JlZ2lz
dGVyKCZkcnYtPmRyaXZlcik7CiAKLQlpZiAoZHJ2LT5tYW51YWxfYmluZCkKKwlpZiAoZHJ2LT5k
cml2ZXIubWFudWFsX2JpbmQpCiAJCWdvdG8gb3V0OwogCiBzdGFydF9vdmVyOgpkaWZmIC11ck4g
YS9kcml2ZXJzL2lucHV0L3NlcmlvL3NlcmlvX3Jhdy5jIGIvZHJpdmVycy9pbnB1dC9zZXJpby9z
ZXJpb19yYXcuYwotLS0gYS9kcml2ZXJzL2lucHV0L3NlcmlvL3NlcmlvX3Jhdy5jCTIwMDQtMTEt
MTYgMDI6MjA6NTMgLTA1MDAKKysrIGIvZHJpdmVycy9pbnB1dC9zZXJpby9zZXJpb19yYXcuYwky
MDA0LTExLTE2IDAyOjIwOjUzIC0wNTAwCkBAIC0zNjUsMTQgKzM2NSwxNCBAQAogCiBzdGF0aWMg
c3RydWN0IHNlcmlvX2RyaXZlciBzZXJpb19yYXdfZHJ2ID0gewogCS5kcml2ZXIJCT0gewotCQku
bmFtZQk9ICJzZXJpb19yYXciLAorCQkubmFtZQkJPSAic2VyaW9fcmF3IiwKKwkJLm1hbnVhbF9i
aW5kCT0gMSwKIAl9LAogCS5kZXNjcmlwdGlvbgk9IERSSVZFUl9ERVNDLAogCS5pbnRlcnJ1cHQJ
PSBzZXJpb19yYXdfaW50ZXJydXB0LAogCS5jb25uZWN0CT0gc2VyaW9fcmF3X2Nvbm5lY3QsCiAJ
LnJlY29ubmVjdAk9IHNlcmlvX3Jhd19yZWNvbm5lY3QsCiAJLmRpc2Nvbm5lY3QJPSBzZXJpb19y
YXdfZGlzY29ubmVjdCwKLQkubWFudWFsX2JpbmQJPSAxLAogfTsKIAogaW50IF9faW5pdCBzZXJp
b19yYXdfaW5pdCh2b2lkKQpkaWZmIC11ck4gYS9pbmNsdWRlL2xpbnV4L2RldmljZS5oIGIvaW5j
bHVkZS9saW51eC9kZXZpY2UuaAotLS0gYS9pbmNsdWRlL2xpbnV4L2RldmljZS5oCTIwMDQtMTEt
MTYgMDI6MjA6NTMgLTA1MDAKKysrIGIvaW5jbHVkZS9saW51eC9kZXZpY2UuaAkyMDA0LTExLTE2
IDAyOjIwOjUzIC0wNTAwCkBAIC0xMDIsNiArMTAyLDggQEAKIAljaGFyCQkJKiBuYW1lOwogCXN0
cnVjdCBidXNfdHlwZQkJKiBidXM7CiAKKwl1bnNpZ25lZCBpbnQJCW1hbnVhbF9iaW5kOworCiAJ
c3RydWN0IHNlbWFwaG9yZQl1bmxvYWRfc2VtOwogCXN0cnVjdCBrb2JqZWN0CQlrb2JqOwogCXN0
cnVjdCBsaXN0X2hlYWQJZGV2aWNlczsKQEAgLTI2NCw2ICsyNjYsOSBAQAogCXN0cnVjdCBidXNf
dHlwZQkqIGJ1czsJCS8qIHR5cGUgb2YgYnVzIGRldmljZSBpcyBvbiAqLwogCXN0cnVjdCBkZXZp
Y2VfZHJpdmVyICpkcml2ZXI7CS8qIHdoaWNoIGRyaXZlciBoYXMgYWxsb2NhdGVkIHRoaXMKIAkJ
CQkJICAgZGV2aWNlICovCisJdW5zaWduZWQgaW50IG1hbnVhbF9iaW5kOwkvKiBpbmRpY2F0ZXMg
d2hldGhlciB0aGUgY29yZSB3aWxsCisJCQkJCSAgIHRyeSB0byBmaW5kIGEgZHJpdmVyIGZvciB0
aGUKKwkJCQkJICAgZGV2aWNlIGF1dG9tYXRpY2FsbHkgKi8KIAl2b2lkCQkqZHJpdmVyX2RhdGE7
CS8qIGRhdGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyICovCiAJdm9pZAkJKnBsYXRmb3JtX2RhdGE7
CS8qIFBsYXRmb3JtIHNwZWNpZmljIGRhdGEgKGUuZy4gQUNQSSwKIAkJCQkJICAgQklPUyBkYXRh
IHJlbGV2YW50IHRvIGRldmljZSkgKi8KZGlmZiAtdXJOIGEvaW5jbHVkZS9saW51eC9zZXJpby5o
IGIvaW5jbHVkZS9saW51eC9zZXJpby5oCi0tLSBhL2luY2x1ZGUvbGludXgvc2VyaW8uaAkyMDA0
LTExLTE2IDAyOjIwOjUzIC0wNTAwCisrKyBiL2luY2x1ZGUvbGludXgvc2VyaW8uaAkyMDA0LTEx
LTE2IDAyOjIwOjUzIC0wNTAwCkBAIC0yNyw4ICsyNyw2IEBACiAJY2hhciBuYW1lWzMyXTsKIAlj
aGFyIHBoeXNbMzJdOwogCi0JdW5zaWduZWQgaW50IG1hbnVhbF9iaW5kOwotCiAJdW5zaWduZWQg
c2hvcnQgaWRidXM7CiAJdW5zaWduZWQgc2hvcnQgaWR2ZW5kb3I7CiAJdW5zaWduZWQgc2hvcnQg
aWRwcm9kdWN0OwpAQCAtNTcsOCArNTUsNiBAQAogCXZvaWQgKnByaXZhdGU7CiAJY2hhciAqZGVz
Y3JpcHRpb247CiAKLQl1bnNpZ25lZCBpbnQgbWFudWFsX2JpbmQ7Ci0KIAl2b2lkICgqd3JpdGVf
d2FrZXVwKShzdHJ1Y3Qgc2VyaW8gKik7CiAJaXJxcmV0dXJuX3QgKCppbnRlcnJ1cHQpKHN0cnVj
dCBzZXJpbyAqLCB1bnNpZ25lZCBjaGFyLAogCQkJdW5zaWduZWQgaW50LCBzdHJ1Y3QgcHRfcmVn
cyAqKTsK
------=_Part_151_25104904.1100637801412--
