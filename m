Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261797AbULBWtD@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261797AbULBWtD (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 2 Dec 2004 17:49:03 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261799AbULBWtD
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 2 Dec 2004 17:49:03 -0500
Received: from hell.sks3.muni.cz ([147.251.210.30]:6586 "EHLO
	hell.sks3.muni.cz") by vger.kernel.org with ESMTP id S261797AbULBWsz
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 2 Dec 2004 17:48:55 -0500
Date: Thu, 2 Dec 2004 23:48:35 +0100
From: Lukas Hejtmanek <xhejtman@mail.muni.cz>
To: Stefan Schmidt <zaphodb@zaphods.net>
Cc: Andrew Morton <akpm@osdl.org>, marcelo.tosatti@cyclades.com,
       piggin@cyberone.com.au, linux-kernel@vger.kernel.org
Subject: Re: Kernel 2.6.9 Multiple Page Allocation Failures
Message-ID: <20041202224835.GA15185@mail.muni.cz>
References: <4194A7F9.5080503@cyberone.com.au> <20041113144743.GL20754@zaphods.net> <20041116093311.GD11482@logos.cnet> <20041116170527.GA3525@mail.muni.cz> <20041121014350.GJ4999@zaphods.net> <20041121024226.GK4999@zaphods.net> <20041202195422.GA20771@mail.muni.cz> <20041202122546.59ff814f.akpm@osdl.org> <20041202210348.GD20771@mail.muni.cz> <20041202223146.GA31508@zaphods.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-2
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20041202223146.GA31508@zaphods.net>
X-echelon: NSA, CIA, CI5, MI5, FBI, KGB, BIS, Plutonium, Bin Laden, bomb
User-Agent: Mutt/1.5.6+20040907i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, Dec 02, 2004 at 11:31:46PM +0100, Stefan Schmidt wrote:
> I had no luck with/without TSO either but on tg3.
> I disabled the on-disk-caching component of the application and it now runs
> without page allocation errors. Currently it is running smoothly at ~500mbit/s
> and ~80kpps in each direction at ~44k interrupts/s, so the problematic
> combination seems to be many open files, high i/o transaction rate or
> troughput and heavy networking load. (tso currently on)
> Caching on ext2-fs in general seemed to generate less page allocation errors
> than on xfs and none of the traces i looked over so far showed involvement
> of the filesystem i.e. were all triggered by alloc_skb.

I found that just high network i/o (generated by iperf at 900Mbps) is ok.
Problematic seems to be file uploading. I'm using IBP servers that listen
through many threads and stores blocks (5MB each) on local disk. After whole
memory (1GB) is used as cache then the first allocation failure occurs.

-- 
Luká¹ Hejtmánek
