Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932317AbVJJBHY@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932317AbVJJBHY (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 9 Oct 2005 21:07:24 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932320AbVJJBHY
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 9 Oct 2005 21:07:24 -0400
Received: from 68.105.138.210.bn.2iij.net ([210.138.105.68]:29713 "HELO
	viper2.netfort.gr.jp") by vger.kernel.org with SMTP id S932317AbVJJBHX
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sun, 9 Oct 2005 21:07:23 -0400
Date: Mon, 10 Oct 2005 10:07:35 +0900
Message-ID: <87y852rxgo.dancerj%dancer@netfort.gr.jp>
From: Junichi Uekawa <dancer@netfort.gr.jp>
To: Scott James Remnant <scott@netsplit.com>
Cc: Junichi Uekawa <dancer@netfort.gr.jp>, 322309@bugs.debian.org,
       322309-submitter@bugs.debian.org, 329468@bugs.debian.org,
       329468-submitter@bugs.debian.org, debian-devel@bugs.debian.org,
       linux-kernel@vger.kernel.org, 332903-submitter@bugs.debian.org
Subject: Re: Bug#322309: Debian woody dpkg no longer works with recent	linux kernel.
In-Reply-To: <1128897196.19000.3.camel@localhost.localdomain>
References: <87zmpi3ell.dancerj%dancer@netfort.gr.jp>
	<1128897196.19000.3.camel@localhost.localdomain>
User-Agent: Wanderlust/2.14.0 (Africa) SEMI/1.14.6 (Maruoka) FLIM/1.14.7
 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 Emacs/21.4 (x86_64-pc-linux-gnu)
 MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: multipart/signed;
 boundary="pgp-sign-Multipart_Mon_Oct_10_10:07:32_2005-1"; micalg=pgp-sha1;
 protocol="application/pgp-signature"
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--pgp-sign-Multipart_Mon_Oct_10_10:07:32_2005-1
Content-Type: text/plain; charset=US-ASCII

Hi,

> > dpkg in Debian woody (3.0) is broken by recent linux kernels;
> > due to the following command changing behavior (mmap of 
> > zero-byte length):
> > 
> >   addr=mmap(NULL, 0, PROT_READ, MAP_SHARED, fd, 0);
> > 
> > These bugs are caused by mmap changing behavior; 
> > it used to return NULL when given a length of 0.
> > However, it now returns -1, and gives back an errno=EINVAL.
> > 
> Indeed.  This was the sole change in the 1.13.8 release.

Thanks, I didn't notice it was since 2.6.12. woody dpkg
was long broken. I've only seen more recent reports about this.

To fix this problem, will require update to 
dpkg in woody; which might not be feasible.
We could drop support of woody chroots in etch.
It might be possible to add a workaround hack 
in [c]debootstrap to trap mmap; or fill 
status/available files before invoking dpkg.


I'm not quite sure why sarge manages to bootstrap despite 
having a dpkg version (1.10.28) that shouldn't work.


regards,
	junichi

--pgp-sign-Multipart_Mon_Oct_10_10:07:32_2005-1
Content-Type: application/pgp-signature
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.2 (GNU/Linux)

iD8DBQBDSb7W2Dd9TugeVcERAuIXAJ9roNeNhNYKTuLpeTW/ZUzABzjnJQCeKqMI
TlR2dke/QSr7EayJ6mNsYqM=
=tMa5
-----END PGP SIGNATURE-----

--pgp-sign-Multipart_Mon_Oct_10_10:07:32_2005-1--
