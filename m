Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S315785AbSFYTSe>; Tue, 25 Jun 2002 15:18:34 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S315870AbSFYTR3>; Tue, 25 Jun 2002 15:17:29 -0400
Received: from mion.elka.pw.edu.pl ([194.29.160.35]:651 "EHLO
	mion.elka.pw.edu.pl") by vger.kernel.org with ESMTP
	id <S315856AbSFYTQk>; Tue, 25 Jun 2002 15:16:40 -0400
Date: Tue, 25 Jun 2002 21:16:19 +0200 (MET DST)
From: Bartlomiej Zolnierkiewicz <B.Zolnierkiewicz@elka.pw.edu.pl>
To: Martin Dalecki <dalecki@evision-ventures.com>
cc: Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: [PATCH] 2.5.24: generic ATA PCI auto-dma tuning (4/5)
Message-ID: <Pine.SOL.4.30.0206252115390.27820-200000@mion.elka.pw.edu.pl>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-1903590565-1025032579=:27820"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---559023410-1903590565-1025032579=:27820
Content-Type: TEXT/PLAIN; charset=US-ASCII


	- in ata-timing.h rework XFER_* defines

	- convert alim15x3.c and hpt366.c to new scheme

	- small fix for hpt34x.c

--
Bartlomiej Zolnierkiewicz

---559023410-1903590565-1025032579=:27820
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="ata-hosts-10.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.SOL.4.30.0206252116190.27820@mion.elka.pw.edu.pl>
Content-Description: 
Content-Disposition: attachment; filename="ata-hosts-10.diff"

ZGlmZiAtdXIgbGludXgtYXRhLWhvc3RzLTkvZHJpdmVycy9pZGUvYWxpbTE1
eDMuYyBsaW51eC9kcml2ZXJzL2lkZS9hbGltMTV4My5jDQotLS0gbGludXgt
YXRhLWhvc3RzLTkvZHJpdmVycy9pZGUvYWxpbTE1eDMuYwlNb24gSnVuIDI0
IDIyOjQwOjQwIDIwMDINCisrKyBsaW51eC9kcml2ZXJzL2lkZS9hbGltMTV4
My5jCU1vbiBKdW4gMjQgMjI6NDM6MjAgMjAwMg0KQEAgLTk5LDI0ICs5OSw2
IEBADQogCV9fcmVzdG9yZV9mbGFncyhmbGFncyk7DQogfQ0KIA0KLS8qIEZJ
WE1FOiB1bmZvbGQgIC0tYmt6ICovDQotc3RhdGljIGJ5dGUgYWxpMTV4M19j
YW5fdWx0cmEoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlKQ0KLXsNCi0JaWYg
KG01MjI5X3JldmlzaW9uIDw9IDB4MjApIHsNCi0JCXJldHVybiAwOw0KLQl9
IGVsc2UgaWYgKChtNTIyOV9yZXZpc2lvbiA8IDB4QzIpICYmDQotI2lmbmRl
ZiBDT05GSUdfV0RDX0FMSTE1WDMNCi0JCSgoY2hpcF9pc18xNTQzY19lICYm
IHN0cnN0cihkcml2ZS0+aWQtPm1vZGVsLCAiV0RDICIpKSB8fA0KLQkJIChk
cml2ZS0+dHlwZSAhPSBBVEFfRElTSykpKSB7DQotI2Vsc2UNCi0JCShkcml2
ZS0+dHlwZSAhPSBBVEFfRElTSykpIHsNCi0jZW5kaWYNCi0JCXJldHVybiAw
Ow0KLQl9IGVsc2Ugew0KLQkJcmV0dXJuIDE7DQotCX0NCi19DQotDQogc3Rh
dGljIGludCBhbGkxNXgzX3R1bmVfY2hpcHNldChzdHJ1Y3QgYXRhX2Rldmlj
ZSAqZHJpdmUsIGJ5dGUgc3BlZWQpDQogew0KIAlzdHJ1Y3QgcGNpX2RldiAq
ZGV2ID0gZHJpdmUtPmNoYW5uZWwtPnBjaV9kZXY7DQpAQCAtMTU4LDg1ICsx
NDAsMTQgQEANCiB9DQogDQogI2lmZGVmIENPTkZJR19CTEtfREVWX0lERURN
QQ0KLXN0YXRpYyBpbnQgY29uZmlnX2NoaXBzZXRfZm9yX2RtYShzdHJ1Y3Qg
YXRhX2RldmljZSAqZHJpdmUsIHU4IHVkbWEpDQotew0KLQlpbnQgbWFwID0g
ZHJpdmUtPmNoYW5uZWwtPm1vZGVzX21hcDsNCi0JdTggbW9kZTsNCi0NCi0J
aWYgKCFlaWdodHlfbmludHlfdGhyZWUoZHJpdmUpKQ0KLQkJbWFwICY9IH5Y
RkVSX1VETUFfODBXOw0KLQ0KLQlpZiAoIXVkbWEpDQotCQltYXAgJj0gflhG
RVJfVURNQV9BTEw7DQotDQotCW1vZGUgPSBhdGFfdGltaW5nX21vZGUoZHJp
dmUsIG1hcCk7DQotDQotCWlmIChtb2RlIDwgWEZFUl9TV19ETUFfMCkNCi0J
CXJldHVybiAwOw0KLQ0KLQlyZXR1cm4gIWFsaTE1eDNfdHVuZV9jaGlwc2V0
KGRyaXZlLCBtb2RlKTsNCi19DQotDQogc3RhdGljIGludCBhbGkxNXgzX3Vk
bWFfc2V0dXAoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlLCBpbnQgbWFwKQ0K
IHsNCi0Jc3RydWN0IGhkX2RyaXZlaWQgKmlkID0gZHJpdmUtPmlkOw0KLQlz
dHJ1Y3QgYXRhX2NoYW5uZWwgKmh3aWYgPSBkcml2ZS0+Y2hhbm5lbDsNCi0J
aW50IG9uID0gMTsNCi0JaW50IHZlcmJvc2UgPSAxOw0KLQlieXRlIGNhbl91
bHRyYV9kbWEgPSBhbGkxNXgzX2Nhbl91bHRyYShkcml2ZSk7DQotDQotCWlm
ICgobTUyMjlfcmV2aXNpb248PTB4MjApICYmIChkcml2ZS0+dHlwZSAhPSBB
VEFfRElTSykpIHsNCi0JCXVkbWFfZW5hYmxlKGRyaXZlLCAwLCAwKTsNCi0J
CXJldHVybiAwOw0KLQl9DQotDQotCWlmICgoaWQgIT0gTlVMTCkgJiYgKChp
ZC0+Y2FwYWJpbGl0eSAmIDEpICE9IDApICYmIGh3aWYtPmF1dG9kbWEpIHsN
Ci0JCS8qIENvbnN1bHQgdGhlIGxpc3Qgb2Yga25vd24gImJhZCIgZHJpdmVz
ICovDQotCQlpZiAodWRtYV9ibGFja19saXN0KGRyaXZlKSkgew0KLQkJCW9u
ID0gMDsNCi0JCQlnb3RvIGZhc3RfYXRhX3BpbzsNCi0JCX0NCi0JCW9uID0g
MDsNCi0JCXZlcmJvc2UgPSAwOw0KLQkJaWYgKChpZC0+ZmllbGRfdmFsaWQg
JiA0KSAmJiAobTUyMjlfcmV2aXNpb24gPj0gMHhDMikpIHsNCi0JCQlpZiAo
aWQtPmRtYV91bHRyYSAmIDB4MDAzRikgew0KLQkJCQkvKiBGb3JjZSBpZiBD
YXBhYmxlIFVsdHJhRE1BICovDQotCQkJCW9uID0gY29uZmlnX2NoaXBzZXRf
Zm9yX2RtYShkcml2ZSwgY2FuX3VsdHJhX2RtYSk7DQotCQkJCWlmICgoaWQt
PmZpZWxkX3ZhbGlkICYgMikgJiYNCi0JCQkJICAgICghb24pKQ0KLQkJCQkJ
Z290byB0cnlfZG1hX21vZGVzOw0KLQkJCX0NCi0JCX0gZWxzZSBpZiAoaWQt
PmZpZWxkX3ZhbGlkICYgMikgew0KLXRyeV9kbWFfbW9kZXM6DQotCQkJaWYg
KChpZC0+ZG1hX213b3JkICYgMHgwMDA3KSB8fA0KLQkJCSAgICAoaWQtPmRt
YV8xd29yZCAmIDB4MDAwNykpIHsNCi0JCQkJLyogRm9yY2UgaWYgQ2FwYWJs
ZSByZWd1bGFyIERNQSBtb2RlcyAqLw0KLQkJCQlvbiA9IGNvbmZpZ19jaGlw
c2V0X2Zvcl9kbWEoZHJpdmUsIGNhbl91bHRyYV9kbWEpOw0KLQkJCQlpZiAo
IW9uKQ0KLQkJCQkJZ290byBub19kbWFfc2V0Ow0KLQkJCX0NCi0JCX0gZWxz
ZSBpZiAodWRtYV93aGl0ZV9saXN0KGRyaXZlKSkgew0KLQkJCWlmIChpZC0+
ZWlkZV9kbWFfdGltZSA+IDE1MCkgew0KLQkJCQlnb3RvIG5vX2RtYV9zZXQ7
DQotCQkJfQ0KLQkJCS8qIENvbnN1bHQgdGhlIGxpc3Qgb2Yga25vd24gImdv
b2QiIGRyaXZlcyAqLw0KLQkJCW9uID0gY29uZmlnX2NoaXBzZXRfZm9yX2Rt
YShkcml2ZSwgY2FuX3VsdHJhX2RtYSk7DQotCQkJaWYgKCFvbikNCi0JCQkJ
Z290byBub19kbWFfc2V0Ow0KLQkJfSBlbHNlIHsNCi0JCQlnb3RvIGZhc3Rf
YXRhX3BpbzsNCi0JCX0NCi0JfSBlbHNlIGlmICgoaWQtPmNhcGFiaWxpdHkg
JiA4KSB8fCAoaWQtPmZpZWxkX3ZhbGlkICYgMikpIHsNCi1mYXN0X2F0YV9w
aW86DQotCQlvbiA9IDA7DQotCQl2ZXJib3NlID0gMDsNCi1ub19kbWFfc2V0
Og0KLQkJYWxpMTV4M190dW5lX2RyaXZlKGRyaXZlLCAyNTUpOw0KLQl9DQot
DQotCXVkbWFfZW5hYmxlKGRyaXZlLCBvbiwgdmVyYm9zZSk7DQotDQotCXJl
dHVybiAwOw0KKyNpZm5kZWYgQ09ORklHX1dEQ19BTEkxNVgzDQorCWlmICgo
bTUyMjlfcmV2aXNpb24gPCAweEMyKSAmJiBjaGlwX2lzXzE1NDNjX2UgJiYN
CisJICAgIHN0cnN0cihkcml2ZS0+aWQtPm1vZGVsLCAiV0RDICIpKQ0KKwkJ
bWFwICY9IH5YRkVSX1VETUFfQUxMOw0KKyNlbmRpZg0KKwlyZXR1cm4gdWRt
YV9nZW5lcmljX3NldHVwKGRyaXZlLCBtYXApOw0KIH0NCiANCiBzdGF0aWMg
aW50IGFsaTE1eDNfdWRtYV9pbml0KHN0cnVjdCBhdGFfZGV2aWNlICpkcml2
ZSwgc3RydWN0IHJlcXVlc3QgKnJxKQ0KQEAgLTI1MSw3ICsxNjIsNyBAQA0K
IHsNCiAJaW50IG1hcCA9IFhGRVJfRVBJTyB8IFhGRVJfU1dETUEgfCBYRkVS
X01XRE1BOw0KIA0KLQlpZiAoIWFsaTE1eDNfY2FuX3VsdHJhKGNoLT5kcml2
ZSkpDQorCWlmIChtNTIyOV9yZXZpc2lvbiA8PSAweDIwKQ0KIAkJcmV0dXJu
IG1hcDsNCiANCiAJbWFwIHw9IFhGRVJfVURNQTsNCkBAIC00MzksOCArMzUw
LDEwIEBADQogCQkgKiBNMTU0M0Mgb3IgbmV3ZXIgZm9yIERNQWluZw0KIAkJ
ICovDQogCQlod2lmLT5tb2Rlc19tYXAgPSBhbGkxNXgzX21vZGVzX21hcCho
d2lmKTsNCi0JCWh3aWYtPnVkbWFfaW5pdCA9IGFsaTE1eDNfdWRtYV9pbml0
Ow0KKwkJaWYgKG01MjI5X3JldmlzaW9uIDwgMHhDMikNCisJCQlod2lmLT5u
b19hdGFwaV9hdXRvZG1hID0gMTsNCiAJCWh3aWYtPnVkbWFfc2V0dXAgPSBh
bGkxNXgzX3VkbWFfc2V0dXA7DQorCQlod2lmLT51ZG1hX2luaXQgPSBhbGkx
NXgzX3VkbWFfaW5pdDsNCiAJCWh3aWYtPmF1dG9kbWEgPSAxOw0KIAl9DQog
DQpkaWZmIC11ciBsaW51eC1hdGEtaG9zdHMtOS9kcml2ZXJzL2lkZS9hdGEt
dGltaW5nLmMgbGludXgvZHJpdmVycy9pZGUvYXRhLXRpbWluZy5jDQotLS0g
bGludXgtYXRhLWhvc3RzLTkvZHJpdmVycy9pZGUvYXRhLXRpbWluZy5jCU1v
biBKdW4gMjQgMjI6MTU6MDUgMjAwMg0KKysrIGxpbnV4L2RyaXZlcnMvaWRl
L2F0YS10aW1pbmcuYwlNb24gSnVuIDI0IDIyOjQzOjIwIDIwMDINCkBAIC04
Niw5ICs4NiwxMSBAQA0KIAkJaWYgKChtYXAgJiBYRkVSX1VETUFfMTAwKSA9
PSBYRkVSX1VETUFfMTAwKQ0KIAkJCWlmICgoYmVzdCA9IChpZC0+ZG1hX3Vs
dHJhICYgMHgwMDIwKSA/IFhGRVJfVURNQV81IDogMCkpIHJldHVybiBiZXN0
Ow0KIA0KLQkJaWYgKChtYXAgJiBYRkVSX1VETUFfNjYpID09IFhGRVJfVURN
QV82NikNCi0JCQlpZiAoKGJlc3QgPSAoaWQtPmRtYV91bHRyYSAmIDB4MDAx
MCkgPyBYRkVSX1VETUFfNCA6DQotCQkJCSAgICAoaWQtPmRtYV91bHRyYSAm
IDB4MDAwOCkgPyBYRkVSX1VETUFfMyA6IDApKSByZXR1cm4gYmVzdDsNCisJ
CWlmICgobWFwICYgWEZFUl9VRE1BXzY2XzQpID09IFhGRVJfVURNQV82Nl80
KQ0KKwkJCWlmICgoYmVzdCA9IChpZC0+ZG1hX3VsdHJhICYgMHgwMDEwKSA/
IFhGRVJfVURNQV80IDogMCkpIHJldHVybiBiZXN0Ow0KKw0KKwkJaWYgKCht
YXAgJiBYRkVSX1VETUFfNjZfMykgPT0gWEZFUl9VRE1BXzY2XzMpDQorCQkJ
aWYgKChiZXN0ID0gKGlkLT5kbWFfdWx0cmEgJiAweDAwMDgpID8gWEZFUl9V
RE1BXzMgOiAwKSkgcmV0dXJuIGJlc3Q7DQogDQogICAgICAgICAgICAgICAg
IGlmICgoYmVzdCA9IChpZC0+ZG1hX3VsdHJhICYgMHgwMDA0KSA/IFhGRVJf
VURNQV8yIDoNCiAJCQkgICAgKGlkLT5kbWFfdWx0cmEgJiAweDAwMDIpID8g
WEZFUl9VRE1BXzEgOg0KZGlmZiAtdXIgbGludXgtYXRhLWhvc3RzLTkvZHJp
dmVycy9pZGUvYXRhLXRpbWluZy5oIGxpbnV4L2RyaXZlcnMvaWRlL2F0YS10
aW1pbmcuaA0KLS0tIGxpbnV4LWF0YS1ob3N0cy05L2RyaXZlcnMvaWRlL2F0
YS10aW1pbmcuaAlNb24gSnVuIDI0IDIyOjI0OjMwIDIwMDINCisrKyBsaW51
eC9kcml2ZXJzL2lkZS9hdGEtdGltaW5nLmgJTW9uIEp1biAyNCAyMjo0Mzoy
MCAyMDAyDQpAQCAtNTksMTggKzU5LDIyIEBADQogI2RlZmluZSBFTk9VR0go
dix1bml0KQkoKCh2KS0xKS8odW5pdCkrMSkNCiAjZGVmaW5lIEVaKHYsdW5p
dCkJKCh2KT9FTk9VR0godix1bml0KTowKQ0KIA0KLSNkZWZpbmUgWEZFUl9N
T0RFCTB4ZjANCi0jZGVmaW5lIFhGRVJfVURNQV8xMzMJMHg0OA0KLSNkZWZp
bmUgWEZFUl9VRE1BXzEwMAkweDQ0DQotI2RlZmluZSBYRkVSX1VETUFfNjYJ
MHg0Mg0KLSNkZWZpbmUgWEZFUl9VRE1BCTB4NDANCi0jZGVmaW5lIFhGRVJf
TVdETUEJMHgyMA0KLSNkZWZpbmUgWEZFUl9TV0RNQQkweDEwDQotI2RlZmlu
ZSBYRkVSX0VQSU8JMHgwMQ0KLSNkZWZpbmUgWEZFUl9QSU8JMHgwMA0KKy8q
IHNlZSBocHQzNjYuYyBmb3IgZGV0YWlscyAqLw0KKyNkZWZpbmUgWEZFUl9V
RE1BXzY2XzMJMHgxMDANCisjZGVmaW5lIFhGRVJfVURNQV82Nl80CTB4MjAw
DQogDQotI2RlZmluZSBYRkVSX1VETUFfQUxMCTB4NGUNCi0jZGVmaW5lIFhG
RVJfVURNQV84MFcJMHgwZQ0KKyNkZWZpbmUgWEZFUl9NT0RFCTB4ZmYwDQor
I2RlZmluZSBYRkVSX1VETUFfMTMzCTB4ODAwDQorI2RlZmluZSBYRkVSX1VE
TUFfMTAwCTB4NDAwDQorI2RlZmluZSBYRkVSX1VETUFfNjYJMHgzMDANCisj
ZGVmaW5lIFhGRVJfVURNQQkweDA0MA0KKyNkZWZpbmUgWEZFUl9NV0RNQQkw
eDAyMA0KKyNkZWZpbmUgWEZFUl9TV0RNQQkweDAxMA0KKyNkZWZpbmUgWEZF
Ul9FUElPCTB4MDAxDQorI2RlZmluZSBYRkVSX1BJTwkweDAwMA0KKw0KKyNk
ZWZpbmUgWEZFUl9VRE1BX0FMTAkweGY0MA0KKyNkZWZpbmUgWEZFUl9VRE1B
XzgwVwkweGYwMA0KIA0KIC8qIEV4dGVybmFsIGludGVyZmFjZSB0byBob3N0
IGNoaXBzIGNoYW5uZWwgdGltaW5nIHNldHVwLg0KICAqDQpkaWZmIC11ciBs
aW51eC1hdGEtaG9zdHMtOS9kcml2ZXJzL2lkZS9ocHQzNHguYyBsaW51eC9k
cml2ZXJzL2lkZS9ocHQzNHguYw0KLS0tIGxpbnV4LWF0YS1ob3N0cy05L2Ry
aXZlcnMvaWRlL2hwdDM0eC5jCU1vbiBKdW4gMjQgMjI6NDA6NDAgMjAwMg0K
KysrIGxpbnV4L2RyaXZlcnMvaWRlL2hwdDM0eC5jCU1vbiBKdW4gMjQgMjI6
NDM6MjAgMjAwMg0KQEAgLTc1LDEwICs3NSwxMCBAQA0KIHN0YXRpYyBpbnQg
aHB0MzR4X3VkbWFfc2V0dXAoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlLCBp
bnQgbWFwKQ0KIHsNCiAjaWZkZWYgQ09ORklHX0hQVDM0WF9BVVRPRE1BDQot
CXVkbWFfZ2VuZXJpY19zZXR1cChkcml2ZSwgbWFwKTsNCi0jZW5kaWYNCi0N
CisJcmV0dXJuIHVkbWFfZ2VuZXJpY19zZXR1cChkcml2ZSwgbWFwKTsNCisj
ZWxzZQ0KIAlyZXR1cm4gMDsNCisjZW5kaWYNCiB9DQogDQogc3RhdGljIGlu
dCBocHQzNHhfdWRtYV9zdG9wKHN0cnVjdCBhdGFfZGV2aWNlICpkcml2ZSkN
CmRpZmYgLXVyIGxpbnV4LWF0YS1ob3N0cy05L2RyaXZlcnMvaWRlL2hwdDM2
Ni5jIGxpbnV4L2RyaXZlcnMvaWRlL2hwdDM2Ni5jDQotLS0gbGludXgtYXRh
LWhvc3RzLTkvZHJpdmVycy9pZGUvaHB0MzY2LmMJTW9uIEp1biAyNCAyMjo0
MDo0MCAyMDAyDQorKysgbGludXgvZHJpdmVycy9pZGUvaHB0MzY2LmMJTW9u
IEp1biAyNCAyMjo0MzoyMCAyMDAyDQpAQCAtNjQ4LDY1ICs2NDgsNDIgQEAN
CiAJcmV0dXJuIGlkZV9jb25maWdfZHJpdmVfc3BlZWQoZHJpdmUsIHNwZWVk
KTsNCiB9DQogDQorLyogRklYTUU6IHBpbyA9PSAyNTUgLT4gYXRhX2Jlc3Rf
cGlvX21vZGUoZHJpdmUpICAtLWJreiAqLw0KIHN0YXRpYyB2b2lkIGhwdDN4
eF90dW5lX2RyaXZlKHN0cnVjdCBhdGFfZGV2aWNlICpkcml2ZSwgdTggcGlv
KQ0KIHsNCiAJKHZvaWQpIGhwdDN4eF90dW5lX2NoaXBzZXQoZHJpdmUsIFhG
RVJfUElPXzAgKyBtaW5fdCh1OCwgcGlvLCA0KSk7DQogfQ0KIA0KICNpZmRl
ZiBDT05GSUdfQkxLX0RFVl9JREVETUENCi1zdGF0aWMgaW50IGNvbmZpZ19j
aGlwc2V0X2Zvcl9kbWEoc3RydWN0IGF0YV9kZXZpY2UgKmRyaXZlKQ0KK3N0
YXRpYyBpbnQgaHB0M3h4X3VkbWFfc2V0dXAoc3RydWN0IGF0YV9kZXZpY2Ug
KmRyaXZlLCBpbnQgbWFwKQ0KIHsNCi0JaW50IG1hcDsNCiAJdTMyIHJldjsN
Ci0JdTggbW9kZTsNCiANCiAJaWYgKGRyaXZlLT50eXBlICE9IEFUQV9ESVNL
KQ0KIAkJcmV0dXJuIDA7DQogDQogCXJldiA9IGhwdF9yZXZpc2lvbihkcml2
ZS0+Y2hhbm5lbC0+cGNpX2Rldik7DQogDQotCW1hcCA9IGRyaXZlLT5jaGFu
bmVsLT5tb2Rlc19tYXA7DQorCS8qIEZJWE1FOiBiYWRsaXN0cyBuZWVkIGZ1
dGhlciBpbnZlc3RpZ2F0aW9uICAtLWJreiAqLw0KIA0KLQlpZiAoIWVpZ2h0
eV9uaW50eV90aHJlZShkcml2ZSkpDQotCQltYXAgJj0gflhGRVJfVURNQV84
MFc7DQorCS8qIGJhZF9hdGExMDBfNSBpcyBmb3IgSFBUMzcwLzM3MEEsDQor
CSAgIGJhZF9hdGE2Nl80LCBiYWRfYXRhNjZfMyBhbmQgYmFkX2F0YTMzIGFy
ZSBmb3IgSFBUMzY2LzM2OCAqLw0KIA0KLQltb2RlID0gYXRhX3RpbWluZ19t
b2RlKGRyaXZlLCBtYXApOw0KKwlpZiAocmV2IDwgNSAmJiBjaGVja19pbl9k
cml2ZV9saXN0cyhkcml2ZSwgYmFkX2F0YTEwMF81KSkNCisJCW1hcCAmPSB+
WEZFUl9VRE1BXzEwMDsNCiANCi0JLyogRklYTUU6IGJhZGxpc3RzIG5lZWQg
ZnV0aGVyIGludmVzdGlnYXRpb24gLS1ia3oNCi0JCSAgYmFkX2F0YTEwMF81
IGlzIGZvciBIUFQzNzAvMzcwQSwNCi0JCSAgYmFkX2F0YTY2XzQsIGJhZF9h
dGE2Nl8zIGFuZCBiYWRfYXRhMzMgYXJlIGZvciBIUFQzNjYvMzY4DQotCSAq
Lw0KLQlpZiAobW9kZSA9PSBYRkVSX1VETUFfNSAmJiByZXYgPCA1KSB7DQot
CQlpZiAoY2hlY2tfaW5fZHJpdmVfbGlzdHMoZHJpdmUsIGJhZF9hdGExMDBf
NSkpIHsNCi0JCQkvKiBGSVhNRTogbWFrZSBYRkVSX1VETUFfNjYvMTAwLzEz
Mw0KLQkJCQkgIGluZGVwZW5kZW50IG9mIFhGRVJfVURNQSAtLWJreiAqLw0K
LQkJCW1hcCAmPSB+WEZFUl9VRE1BXzEwMDsNCi0JCQltYXAgfD0gWEZFUl9V
RE1BOw0KLQkJCW1vZGUgPSBhdGFfdGltaW5nX21vZGUoZHJpdmUsIG1hcCk7
DQotCQl9DQotCX0NCi0JaWYgKG1vZGUgPT0gWEZFUl9VRE1BXzQgJiYgcmV2
IDwgMykgew0KLQkJaWYgKGNoZWNrX2luX2RyaXZlX2xpc3RzKGRyaXZlLCBi
YWRfYXRhNjZfNCkpIHsNCi0JCQlpZiAoZHJpdmUtPmlkLT5kbWFfdWx0cmEg
JiAweDAwMDgpIHsNCi0JCQkJbW9kZSA9IFhGRVJfVURNQV8zOw0KLQkJCX0g
ZWxzZSB7DQotCQkJCW1hcCAmPSB+WEZFUl9VRE1BXzY2Ow0KLQkJCQltYXAg
fD0gWEZFUl9VRE1BOw0KLQkJCQltb2RlID0gYXRhX3RpbWluZ19tb2RlKGRy
aXZlLCBtYXApOw0KLQkJCX0NCi0JCX0NCi0JfQ0KLQlpZiAobW9kZSA9PSBY
RkVSX1VETUFfMyAmJiByZXYgPCAzKSB7DQotCQlpZiAoY2hlY2tfaW5fZHJp
dmVfbGlzdHMoZHJpdmUsIGJhZF9hdGE2Nl8zKSkgew0KLQkJCW1hcCAmPSB+
WEZFUl9VRE1BXzY2Ow0KLQkJCW1hcCB8PSBYRkVSX1VETUE7DQotCQkJbW9k
ZSA9IGF0YV90aW1pbmdfbW9kZShkcml2ZSwgbWFwKTsNCi0JCX0NCisJaWYg
KHJldiA8IDMpIHsNCisJCWlmIChjaGVja19pbl9kcml2ZV9saXN0cyhkcml2
ZSwgYmFkX2F0YTY2XzQpKQ0KKwkJCW1hcCAmPSB+WEZFUl9VRE1BXzY2XzQ7
DQorDQorCQlpZiAoY2hlY2tfaW5fZHJpdmVfbGlzdHMoZHJpdmUsIGJhZF9h
dGE2Nl8zKSkNCisJCQltYXAgJj0gflhGRVJfVURNQV82Nl8zOw0KKw0KKwkJ
aWYgKGNoZWNrX2luX2RyaXZlX2xpc3RzKGRyaXZlLCBiYWRfYXRhMzMpKQ0K
KwkJCW1hcCAmPSB+WEZFUl9VRE1BX0FMTDsNCiAJfQ0KLQlpZiAoY2hlY2tf
aW5fZHJpdmVfbGlzdHMoZHJpdmUsIGJhZF9hdGEzMykgJiYgcmV2IDwgMykN
Ci0JCW1vZGUgPSBhdGFfdGltaW5nX21vZGUoZHJpdmUsIFhGRVJfTVdETUEp
Ow0KIA0KLQlyZXR1cm4gIWhwdDN4eF90dW5lX2NoaXBzZXQoZHJpdmUsIG1v
ZGUpOw0KKwlyZXR1cm4gdWRtYV9nZW5lcmljX3NldHVwKGRyaXZlLCBtYXAp
Ow0KIH0NCiANCiBzdGF0aWMgaW50IGhwdDN4eF9xdWlya3Byb2Moc3RydWN0
IGF0YV9kZXZpY2UgKmRyaXZlKQ0KQEAgLTc0Myw1OSArNzIwLDYgQEANCiAJ
fQ0KIH0NCiANCi1zdGF0aWMgaW50IGhwdDN4eF91ZG1hX3NldHVwKHN0cnVj
dCBhdGFfZGV2aWNlICpkcml2ZSwgaW50IG1hcCkNCi17DQotCXN0cnVjdCBo
ZF9kcml2ZWlkICppZCA9IGRyaXZlLT5pZDsNCi0JaW50IG9uID0gMTsNCi0J
aW50IHZlcmJvc2UgPSAxOw0KLQ0KLQlpZiAoaWQgJiYgKGlkLT5jYXBhYmls
aXR5ICYgMSkgJiYgZHJpdmUtPmNoYW5uZWwtPmF1dG9kbWEpIHsNCi0JCS8q
IENvbnN1bHQgdGhlIGxpc3Qgb2Yga25vd24gImJhZCIgZHJpdmVzICovDQot
CQlpZiAodWRtYV9ibGFja19saXN0KGRyaXZlKSkgew0KLQkJCW9uID0gMDsN
Ci0JCQlnb3RvIGZhc3RfYXRhX3BpbzsNCi0JCX0NCi0JCW9uID0gMDsNCi0J
CXZlcmJvc2UgPSAwOw0KLQkJaWYgKGlkLT5maWVsZF92YWxpZCAmIDQpIHsN
Ci0JCQlpZiAoaWQtPmRtYV91bHRyYSAmIDB4MDA3Rikgew0KLQkJCQkvKiBG
b3JjZSBpZiBDYXBhYmxlIFVsdHJhRE1BICovDQotCQkJCW9uID0gY29uZmln
X2NoaXBzZXRfZm9yX2RtYShkcml2ZSk7DQotCQkJCWlmICgoaWQtPmZpZWxk
X3ZhbGlkICYgMikgJiYNCi0JCQkJICAgICghb24pKQ0KLQkJCQkJZ290byB0
cnlfZG1hX21vZGVzOw0KLQkJCX0NCi0JCX0gZWxzZSBpZiAoaWQtPmZpZWxk
X3ZhbGlkICYgMikgew0KLXRyeV9kbWFfbW9kZXM6DQotCQkJaWYgKGlkLT5k
bWFfbXdvcmQgJiAweDAwMDcpIHsNCi0JCQkJLyogRm9yY2UgaWYgQ2FwYWJs
ZSByZWd1bGFyIERNQSBtb2RlcyAqLw0KLQkJCQlvbiA9IGNvbmZpZ19jaGlw
c2V0X2Zvcl9kbWEoZHJpdmUpOw0KLQkJCQlpZiAoIW9uKQ0KLQkJCQkJZ290
byBub19kbWFfc2V0Ow0KLQkJCX0NCi0JCX0gZWxzZSBpZiAodWRtYV93aGl0
ZV9saXN0KGRyaXZlKSkgew0KLQkJCWlmIChpZC0+ZWlkZV9kbWFfdGltZSA+
IDE1MCkgew0KLQkJCQlnb3RvIG5vX2RtYV9zZXQ7DQotCQkJfQ0KLQkJCS8q
IENvbnN1bHQgdGhlIGxpc3Qgb2Yga25vd24gImdvb2QiIGRyaXZlcyAqLw0K
LQkJCW9uID0gY29uZmlnX2NoaXBzZXRfZm9yX2RtYShkcml2ZSk7DQotCQkJ
aWYgKCFvbikNCi0JCQkJZ290byBub19kbWFfc2V0Ow0KLQkJfSBlbHNlIHsN
Ci0JCQlnb3RvIGZhc3RfYXRhX3BpbzsNCi0JCX0NCi0JfSBlbHNlIGlmICgo
aWQtPmNhcGFiaWxpdHkgJiA4KSB8fCAoaWQtPmZpZWxkX3ZhbGlkICYgMikp
IHsNCi1mYXN0X2F0YV9waW86DQotCQlvbiA9IDA7DQotCQl2ZXJib3NlID0g
MDsNCi1ub19kbWFfc2V0Og0KLQkJaHB0M3h4X3R1bmVfY2hpcHNldChkcml2
ZSwgYXRhX2Jlc3RfcGlvX21vZGUoZHJpdmUpKTsNCi0JfQ0KLQl1ZG1hX2Vu
YWJsZShkcml2ZSwgb24sIHZlcmJvc2UpOw0KLQ0KLQlyZXR1cm4gMDsNCi19
DQotDQogc3RhdGljIHZvaWQgaHB0MzY2X3VkbWFfaXJxX2xvc3Qoc3RydWN0
IGF0YV9kZXZpY2UgKmRyaXZlKQ0KIHsNCiAJc3RydWN0IHBjaV9kZXYgKmRl
diA9IGRyaXZlLT5jaGFubmVsLT5wY2lfZGV2Ow0K
---559023410-1903590565-1025032579=:27820--
