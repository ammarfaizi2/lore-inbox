Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S267199AbTBDKJf>; Tue, 4 Feb 2003 05:09:35 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S267203AbTBDKJf>; Tue, 4 Feb 2003 05:09:35 -0500
Received: from gate.perex.cz ([194.212.165.105]:19717 "EHLO gate.perex.cz")
	by vger.kernel.org with ESMTP id <S267199AbTBDKJe>;
	Tue, 4 Feb 2003 05:09:34 -0500
Date: Tue, 4 Feb 2003 11:18:36 +0100 (CET)
From: Jaroslav Kysela <perex@perex.cz>
X-X-Sender: perex@pnote.perex-int.cz
To: Russell King <rmk@arm.linux.org.uk>
Cc: Adam Belay <ambx1@neo.rr.com>,
       "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
       "greg@kroah.com" <greg@kroah.com>, Alan Cox <alan@lxorguk.ukuu.org.uk>
Subject: Re: PnP model
In-Reply-To: <20030204094634.A11346@flint.arm.linux.org.uk>
Message-ID: <Pine.LNX.4.44.0302041117500.1278-100000@pnote.perex-int.cz>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Tue, 4 Feb 2003, Russell King wrote:

> On Mon, Feb 03, 2003 at 08:43:25PM +0000, Adam Belay wrote:
> > In many cases, Auto configuration can be better then manual configuration.
> > 1.) The auto configuration engine in my patch is able to resolve almost any
> > resource conflict and provides the greatest chance for all devices to have
> > resources allocated.
> 
> There is a nice problem with ISA PNP serial ports generated by this
> type of thing in 2.5.59.
> 
> On boot, we probe for the usual serial ports, and discover two at
> 0x3f8 and 0x2f8, and we request these resources.  Please note that
> one port could be in use as a serial console from earlier in the
> bootup.
> 
> Then, we move on to the PNP probes.  The PNP layer gives us two
> serial ports, and we initialise them.  The PNP layer notices that
> the resources for 0x3f8 and 0x2f8, and re-assigns the ports to
> 0x3e8 and 0x2e8.  The serial layer finds two extra ports at
> 0x3e8 and 0x2e8.
> 
> However, the ports at 0x3f8 and 0x2f8 are now gone, along with the
> serial console, and the boot messages claim that we have four serial
> ports at ttyS0, ttyS1, ttyS2, and ttyS3, when the machine in fact
> only has two serial ports.  The serial layer likewise believes we
> have four serial ports.
> 
> I look forward to your thoughts on getting around this problem.

I think that legacy devices must be probed after PnP ones, otherwise 
you'll get these duplications.

						Jaroslav

-----
Jaroslav Kysela <perex@suse.cz>
Linux Kernel Sound Maintainer
ALSA Project, SuSE Labs

