Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S314078AbSG2JKk>; Mon, 29 Jul 2002 05:10:40 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S314080AbSG2JKk>; Mon, 29 Jul 2002 05:10:40 -0400
Received: from dell-paw-3.cambridge.redhat.com ([195.224.55.237]:20728 "EHLO
	executor.cambridge.redhat.com") by vger.kernel.org with ESMTP
	id <S314078AbSG2JKk>; Mon, 29 Jul 2002 05:10:40 -0400
To: David Howells <dhowells@redhat.com>
Cc: Roman Zippel <zippel@linux-m68k.org>,
       Christoph Hellwig <hch@infradead.org>,
       "Adam J. Richter" <adam@yggdrasil.com>, linux-kernel@vger.kernel.org
Subject: Re: Patch: linux-2.5.29 __downgrade_write() for CONFIG_RWSEM_GENERIC_SPINLOCK 
In-Reply-To: Message from David Howells <dhowells@redhat.com> 
   of "Mon, 29 Jul 2002 09:31:55 BST." <20869.1027931515@warthog.cambridge.redhat.com> 
User-Agent: EMH/1.14.1 SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.2
 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Date: Mon, 29 Jul 2002 10:13:55 +0100
Message-ID: <28550.1027934035@warthog.cambridge.redhat.com>
From: David Howells <dhowells@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


> Roman Zippel <zippel@linux-m68k.org> wrote:
> > Did you look at the code? gcc should be able to optimize that itself.
> 
> Maybe... gcc should also optimise my version to the same extent, I think
> (the result of one of the additional tests is known at compile time, and the
> other one is the same as the next test down). What I'm unsure about is how
> gcc will handle the variable being stored in memory not marked volatile and
> then retrieved again; whether it'll actually issue a read, or just assume
> it's got it cached.

It doesn't appear to make any difference which way it is done. The i386 code
from both looks the same.

David
