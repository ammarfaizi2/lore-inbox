Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264289AbTLBDBQ (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 1 Dec 2003 22:01:16 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264290AbTLBDBQ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 1 Dec 2003 22:01:16 -0500
Received: from sv1.valinux.co.jp ([210.128.90.2]:49092 "EHLO sv1.valinux.co.jp")
	by vger.kernel.org with ESMTP id S264289AbTLBDBL (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 1 Dec 2003 22:01:11 -0500
Date: Tue, 02 Dec 2003 12:01:09 +0900
From: IWAMOTO Toshihiro <iwamoto@valinux.co.jp>
To: <linux-kernel@vger.kernel.org>
Cc: "Luck, Tony" <tony.luck@intel.com>, "Pavel Machek" <pavel@suse.cz>
Subject: Re: memory hotremove prototype, take 3
In-Reply-To: <B8E391BBE9FE384DAA4C5C003888BE6F4FAED7@scsmsx401.sc.intel.com>
References: <B8E391BBE9FE384DAA4C5C003888BE6F4FAED7@scsmsx401.sc.intel.com>
User-Agent: Wanderlust/2.8.1 (Something) SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.2
 (i386-debian-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Message-Id: <20031202030109.3A01B7007A@sv1.valinux.co.jp>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 1 Dec 2003 12:12:09 -0800,
Luck, Tony <tony.luck@intel.com> wrote:
> 
> Pavel Machek wrote:

> > During hotunplug, you copy pages to new locaion. Would it simplify
> > code if you forced them to be swapped out, instead? [Yep, it would be
> > slower...]
> 
> There are some pages that will have to be copied (e.g. pages that
> the user "mlock()d" should still be locked in their new location,
> same for hugetlbfs pages).

Using kswapd is easy, but doesn't always work well.  The patch
contains the code to ignore page accessed bits when kswapd is run on
disabled zones, but that's not enough for swapping out frequently used
pages.
In my patch, page copying, or "remapping", solves this problem by
blocking accesses to the page under operation.

--
IWAMOTO Toshihiro

