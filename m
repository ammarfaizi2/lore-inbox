Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S293451AbSCARkv>; Fri, 1 Mar 2002 12:40:51 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S293439AbSCARkl>; Fri, 1 Mar 2002 12:40:41 -0500
Received: from dell-paw-3.cambridge.redhat.com ([195.224.55.237]:49405 "HELO
	executor.cambridge.redhat.com") by vger.kernel.org with SMTP
	id <S293451AbSCARk2>; Fri, 1 Mar 2002 12:40:28 -0500
To: Linus Torvalds <torvalds@transmeta.com>
Cc: David Woodhouse <dwmw2@infradead.org>, davem@redhat.com,
        linux-kernel@vger.kernel.org
Subject: Re: recalc_sigpending() / recalc_sigpending_tsk() ? 
In-Reply-To: Message from Linus Torvalds <torvalds@transmeta.com> 
   of "Fri, 01 Mar 2002 08:49:07 PST." <Pine.LNX.4.33.0203010838360.3798-100000@home.transmeta.com> 
User-Agent: EMH/1.14.1 SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.1
 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Date: Fri, 01 Mar 2002 17:40:26 +0000
Message-ID: <23167.1015004426@warthog.cambridge.redhat.com>
From: David Howells <dhowells@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


> So I would suggest solving this problem by just adding something like
> 
> 	/* Block all signals except for mask */
> 	void sigallow(unsigned long mask)
> 	{
> 		spin_lock_irq(&current->sigmask_lock);
> 		siginitsetinv(current->blocked, mask);
> 		recalc_sigpending();
> 		spin_unlock_irq(&current->sigmask_lock);
> 	}
> 
> and be done with it. That seems to be what most of the non-signal.c users
> actually _want_.

Maybe you should return the old mask too?

David
