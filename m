Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261317AbUDSQUA (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 19 Apr 2004 12:20:00 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261321AbUDSQUA
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 19 Apr 2004 12:20:00 -0400
Received: from dh132.citi.umich.edu ([141.211.133.132]:31618 "EHLO
	lade.trondhjem.org") by vger.kernel.org with ESMTP id S261317AbUDSQTs
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 19 Apr 2004 12:19:48 -0400
Subject: Re: NFS and kernel 2.6.x
From: Trond Myklebust <trond.myklebust@fys.uio.no>
To: Jamie Lokier <jamie@shareable.org>
Cc: linux-kernel@vger.kernel.org
In-Reply-To: <1082389088.2559.34.camel@lade.trondhjem.org>
References: <1082079061.7141.85.camel@lade.trondhjem.org>
	 <20040415185355.1674115b.akpm@osdl.org>
	 <20040416090331.GC22226@mail.shareable.org>
	 <1082130906.2581.10.camel@lade.trondhjem.org>
	 <20040416184821.GA25402@mail.shareable.org>
	 <1082142401.2581.131.camel@lade.trondhjem.org>
	 <20040416193914.GA25792@mail.shareable.org>
	 <1082241169.3930.14.camel@lade.trondhjem.org>
	 <20040418032638.GA1786@mail.shareable.org>
	 <1082271815.3619.104.camel@lade.trondhjem.org>
	 <20040418232230.GA11064@mail.shareable.org>
	 <1082389088.2559.34.camel@lade.trondhjem.org>
Content-Type: multipart/mixed; boundary="=-bRQUvCjeQ3IzU/AHB0D1"
Message-Id: <1082391587.2559.50.camel@lade.trondhjem.org>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.6 
Date: Mon, 19 Apr 2004 12:19:48 -0400
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


--=-bRQUvCjeQ3IzU/AHB0D1
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Mon, 2004-04-19 at 11:38, Trond Myklebust wrote:
> On Sun, 2004-04-18 at 19:22, Jamie Lokier wrote:

> > You don't respond to the other question: the doubling stopping at
> > 3.2s.  Is it intended?  It goes againt a basic principle of congestion
> > control.
> 
> I can put it back in.

Here's a patch that continues doubling.

Cheers,
  Trond

--=-bRQUvCjeQ3IzU/AHB0D1
Content-Description: 
Content-Disposition: inline; filename=linux-2.6.6-01-soft.dif
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset=iso-8859-1

IGluY2x1ZGUvbGludXgvc3VucnBjL3hwcnQuaCAgICB8ICAgMTAgKystLS0NCiBuZXQvc3VucnBj
L2F1dGhfZ3NzL2F1dGhfZ3NzLmMgfCAgICAyIC0NCiBuZXQvc3VucnBjL2NsbnQuYyAgICAgICAg
ICAgICAgfCAgICA0IC0tDQogbmV0L3N1bnJwYy90aW1lci5jICAgICAgICAgICAgIHwgICAgMSAN
CiBuZXQvc3VucnBjL3hwcnQuYyAgICAgICAgICAgICAgfCAgIDgxICsrKysrKysrKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0tLS0tDQogNSBmaWxlcyBjaGFuZ2VkLCA1NyBpbnNlcnRpb25z
KCspLCA0MSBkZWxldGlvbnMoLSkNCg0KZGlmZiAtdSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxlIC0t
c2hvdy1jLWZ1bmN0aW9uIGxpbnV4LTIuNi42LXJjMS9pbmNsdWRlL2xpbnV4L3N1bnJwYy94cHJ0
LmggbGludXgtMi42LjYtMDEtc29mdC9pbmNsdWRlL2xpbnV4L3N1bnJwYy94cHJ0LmgNCi0tLSBs
aW51eC0yLjYuNi1yYzEvaW5jbHVkZS9saW51eC9zdW5ycGMveHBydC5oCTIwMDQtMDQtMTcgMjM6
MDE6MDkuMDAwMDAwMDAwIC0wNDAwDQorKysgbGludXgtMi42LjYtMDEtc29mdC9pbmNsdWRlL2xp
bnV4L3N1bnJwYy94cHJ0LmgJMjAwNC0wNC0xOSAxMTo1NzozMi4wMDAwMDAwMDAgLTA0MDANCkBA
IC02OSw4ICs2OSw3IEBAIGV4dGVybiB1bnNpZ25lZCBpbnQgeHBydF90Y3Bfc2xvdF90YWJsZV8N
CiAgKiBUaGlzIGRlc2NyaWJlcyBhIHRpbWVvdXQgc3RyYXRlZ3kNCiAgKi8NCiBzdHJ1Y3QgcnBj
X3RpbWVvdXQgew0KLQl1bnNpZ25lZCBsb25nCQl0b19jdXJyZW50LAkJLyogY3VycmVudCB0aW1l
b3V0ICovDQotCQkJCXRvX2luaXR2YWwsCQkvKiBpbml0aWFsIHRpbWVvdXQgKi8NCisJdW5zaWdu
ZWQgbG9uZwkJdG9faW5pdHZhbCwJCS8qIGluaXRpYWwgdGltZW91dCAqLw0KIAkJCQl0b19tYXh2
YWwsCQkvKiBtYXggdGltZW91dCAqLw0KIAkJCQl0b19pbmNyZW1lbnQ7CQkvKiBpZiAhZXhwb25l
bnRpYWwgKi8NCiAJdW5zaWduZWQgaW50CQl0b19yZXRyaWVzOwkJLyogbWF4ICMgb2YgcmV0cmll
cyAqLw0KQEAgLTg1LDcgKzg0LDYgQEAgc3RydWN0IHJwY19ycXN0IHsNCiAJICogVGhpcyBpcyB0
aGUgdXNlci12aXNpYmxlIHBhcnQNCiAJICovDQogCXN0cnVjdCBycGNfeHBydCAqCXJxX3hwcnQ7
CQkvKiBSUEMgY2xpZW50ICovDQotCXN0cnVjdCBycGNfdGltZW91dAlycV90aW1lb3V0OwkJLyog
dGltZW91dCBwYXJtcyAqLw0KIAlzdHJ1Y3QgeGRyX2J1ZgkJcnFfc25kX2J1ZjsJCS8qIHNlbmQg
YnVmZmVyICovDQogCXN0cnVjdCB4ZHJfYnVmCQlycV9yY3ZfYnVmOwkJLyogcmVjdiBidWZmZXIg
Ki8NCiANCkBAIC0xMDMsNiArMTAxLDkgQEAgc3RydWN0IHJwY19ycXN0IHsNCiAJc3RydWN0IHhk
cl9idWYJCXJxX3ByaXZhdGVfYnVmOwkJLyogVGhlIHJlY2VpdmUgYnVmZmVyDQogCQkJCQkJCSAq
IHVzZWQgaW4gdGhlIHNvZnRpcnEuDQogCQkJCQkJCSAqLw0KKwl1bnNpZ25lZCBsb25nCQlycV9t
YWpvcnRpbWVvOwkvKiBtYWpvciB0aW1lb3V0IGFsYXJtICovDQorCXVuc2lnbmVkIGxvbmcJCXJx
X3RpbWVvdXQ7CS8qIEN1cnJlbnQgdGltZW91dCB2YWx1ZSAqLw0KKwl1bnNpZ25lZCBpbnQJCXJx
X3JldHJpZXM7CS8qICMgb2YgcmV0cmllcyAqLw0KIAkvKg0KIAkgKiBGb3IgYXV0aGVudGljYXRp
b24gKGUuZy4gYXV0aF9kZXMpDQogCSAqLw0KQEAgLTExNSw3ICsxMTYsNiBAQCBzdHJ1Y3QgcnBj
X3Jxc3Qgew0KIAl1MzIJCQlycV9ieXRlc19zZW50OwkvKiBCeXRlcyB3ZSBoYXZlIHNlbnQgKi8N
CiANCiAJdW5zaWduZWQgbG9uZwkJcnFfeHRpbWU7CS8qIHdoZW4gdHJhbnNtaXR0ZWQgKi8NCi0J
aW50CQkJcnFfbnRpbWVvOw0KIAlpbnQJCQlycV9udHJhbnM7DQogfTsNCiAjZGVmaW5lIHJxX3N2
ZWMJCQlycV9zbmRfYnVmLmhlYWQNCkBAIC0yMTAsNyArMjEwLDcgQEAgdm9pZAkJCXhwcnRfcmVz
ZXJ2ZShzdHJ1Y3QgcnBjX3Rhc2sgKik7DQogaW50CQkJeHBydF9wcmVwYXJlX3RyYW5zbWl0KHN0
cnVjdCBycGNfdGFzayAqKTsNCiB2b2lkCQkJeHBydF90cmFuc21pdChzdHJ1Y3QgcnBjX3Rhc2sg
Kik7DQogdm9pZAkJCXhwcnRfcmVjZWl2ZShzdHJ1Y3QgcnBjX3Rhc2sgKik7DQotaW50CQkJeHBy
dF9hZGp1c3RfdGltZW91dChzdHJ1Y3QgcnBjX3RpbWVvdXQgKik7DQoraW50CQkJeHBydF9hZGp1
c3RfdGltZW91dChzdHJ1Y3QgcnBjX3Jxc3QgKnJlcSk7DQogdm9pZAkJCXhwcnRfcmVsZWFzZShz
dHJ1Y3QgcnBjX3Rhc2sgKik7DQogdm9pZAkJCXhwcnRfY29ubmVjdChzdHJ1Y3QgcnBjX3Rhc2sg
Kik7DQogaW50CQkJeHBydF9jbGVhcl9iYWNrbG9nKHN0cnVjdCBycGNfeHBydCAqKTsNCmRpZmYg
LXUgLS1yZWN1cnNpdmUgLS1uZXctZmlsZSAtLXNob3ctYy1mdW5jdGlvbiBsaW51eC0yLjYuNi1y
YzEvbmV0L3N1bnJwYy9hdXRoX2dzcy9hdXRoX2dzcy5jIGxpbnV4LTIuNi42LTAxLXNvZnQvbmV0
L3N1bnJwYy9hdXRoX2dzcy9hdXRoX2dzcy5jDQotLS0gbGludXgtMi42LjYtcmMxL25ldC9zdW5y
cGMvYXV0aF9nc3MvYXV0aF9nc3MuYwkyMDA0LTA0LTE3IDIzOjAwOjU3LjAwMDAwMDAwMCAtMDQw
MA0KKysrIGxpbnV4LTIuNi42LTAxLXNvZnQvbmV0L3N1bnJwYy9hdXRoX2dzcy9hdXRoX2dzcy5j
CTIwMDQtMDQtMTkgMTE6NTc6MzIuMDAwMDAwMDAwIC0wNDAwDQpAQCAtNzM2LDEwICs3MzYsOCBA
QCBzdGF0aWMgaW50DQogZ3NzX3JlZnJlc2goc3RydWN0IHJwY190YXNrICp0YXNrKQ0KIHsNCiAJ
c3RydWN0IHJwY19jbG50ICpjbG50ID0gdGFzay0+dGtfY2xpZW50Ow0KLQlzdHJ1Y3QgcnBjX3hw
cnQgKnhwcnQgPSB0YXNrLT50a194cHJ0Ow0KIAlzdHJ1Y3QgcnBjX2NyZWQgKmNyZWQgPSB0YXNr
LT50a19tc2cucnBjX2NyZWQ7DQogDQotCXRhc2stPnRrX3RpbWVvdXQgPSB4cHJ0LT50aW1lb3V0
LnRvX2N1cnJlbnQ7DQogCWlmICghZ3NzX2NyZWRfaXNfdXB0b2RhdGVfY3R4KGNyZWQpKQ0KIAkJ
cmV0dXJuIGdzc191cGNhbGwoY2xudCwgdGFzaywgY3JlZCk7DQogCXJldHVybiAwOw0KZGlmZiAt
dSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxlIC0tc2hvdy1jLWZ1bmN0aW9uIGxpbnV4LTIuNi42LXJj
MS9uZXQvc3VucnBjL2NsbnQuYyBsaW51eC0yLjYuNi0wMS1zb2Z0L25ldC9zdW5ycGMvY2xudC5j
DQotLS0gbGludXgtMi42LjYtcmMxL25ldC9zdW5ycGMvY2xudC5jCTIwMDQtMDQtMTcgMjM6MDA6
NDcuMDAwMDAwMDAwIC0wNDAwDQorKysgbGludXgtMi42LjYtMDEtc29mdC9uZXQvc3VucnBjL2Ns
bnQuYwkyMDA0LTA0LTE5IDExOjU3OjMyLjAwMDAwMDAwMCAtMDQwMA0KQEAgLTc4OCwxMyArNzg4
LDExIEBAIHN0YXRpYyB2b2lkDQogY2FsbF90aW1lb3V0KHN0cnVjdCBycGNfdGFzayAqdGFzaykN
CiB7DQogCXN0cnVjdCBycGNfY2xudAkqY2xudCA9IHRhc2stPnRrX2NsaWVudDsNCi0Jc3RydWN0
IHJwY190aW1lb3V0ICp0byA9ICZ0YXNrLT50a19ycXN0cC0+cnFfdGltZW91dDsNCiANCi0JaWYg
KHhwcnRfYWRqdXN0X3RpbWVvdXQodG8pKSB7DQorCWlmICh4cHJ0X2FkanVzdF90aW1lb3V0KHRh
c2stPnRrX3Jxc3RwKSA9PSAwKSB7DQogCQlkcHJpbnRrKCJSUEM6ICU0ZCBjYWxsX3RpbWVvdXQg
KG1pbm9yKVxuIiwgdGFzay0+dGtfcGlkKTsNCiAJCWdvdG8gcmV0cnk7DQogCX0NCi0JdG8tPnRv
X3JldHJpZXMgPSBjbG50LT5jbF90aW1lb3V0LnRvX3JldHJpZXM7DQogDQogCWRwcmludGsoIlJQ
QzogJTRkIGNhbGxfdGltZW91dCAobWFqb3IpXG4iLCB0YXNrLT50a19waWQpOw0KIAlpZiAoUlBD
X0lTX1NPRlQodGFzaykpIHsNCmRpZmYgLXUgLS1yZWN1cnNpdmUgLS1uZXctZmlsZSAtLXNob3ct
Yy1mdW5jdGlvbiBsaW51eC0yLjYuNi1yYzEvbmV0L3N1bnJwYy90aW1lci5jIGxpbnV4LTIuNi42
LTAxLXNvZnQvbmV0L3N1bnJwYy90aW1lci5jDQotLS0gbGludXgtMi42LjYtcmMxL25ldC9zdW5y
cGMvdGltZXIuYwkyMDA0LTA0LTE3IDIzOjAxOjIwLjAwMDAwMDAwMCAtMDQwMA0KKysrIGxpbnV4
LTIuNi42LTAxLXNvZnQvbmV0L3N1bnJwYy90aW1lci5jCTIwMDQtMDQtMTkgMTE6NTc6MzIuMDAw
MDAwMDAwIC0wNDAwDQpAQCAtMzksNiArMzksNyBAQCBycGNfaW5pdF9ydHQoc3RydWN0IHJwY19y
dHQgKnJ0LCB1bnNpZ25lDQogCWZvciAoaSA9IDA7IGkgPCA1OyBpKyspIHsNCiAJCXJ0LT5zcnR0
W2ldID0gaW5pdDsNCiAJCXJ0LT5zZHJ0dFtpXSA9IFJQQ19SVE9fSU5JVDsNCisJCXJ0LT5udGlt
ZW91dHNbaV0gPSAwOw0KIAl9DQogfQ0KIA0KZGlmZiAtdSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxl
IC0tc2hvdy1jLWZ1bmN0aW9uIGxpbnV4LTIuNi42LXJjMS9uZXQvc3VucnBjL3hwcnQuYyBsaW51
eC0yLjYuNi0wMS1zb2Z0L25ldC9zdW5ycGMveHBydC5jDQotLS0gbGludXgtMi42LjYtcmMxL25l
dC9zdW5ycGMveHBydC5jCTIwMDQtMDQtMTcgMjM6MDE6MDcuMDAwMDAwMDAwIC0wNDAwDQorKysg
bGludXgtMi42LjYtMDEtc29mdC9uZXQvc3VucnBjL3hwcnQuYwkyMDA0LTA0LTE5IDExOjU4OjAz
LjAwMDAwMDAwMCAtMDQwMA0KQEAgLTM1MiwzNSArMzUyLDU3IEBAIHhwcnRfYWRqdXN0X2N3bmQo
c3RydWN0IHJwY194cHJ0ICp4cHJ0LCANCiB9DQogDQogLyoNCisgKiBSZXNldCB0aGUgbWFqb3Ig
dGltZW91dCB2YWx1ZQ0KKyAqLw0KK3N0YXRpYyB2b2lkIHhwcnRfcmVzZXRfbWFqb3J0aW1lbyhz
dHJ1Y3QgcnBjX3Jxc3QgKnJlcSkNCit7DQorCXN0cnVjdCBycGNfdGltZW91dCAqdG8gPSAmcmVx
LT5ycV94cHJ0LT50aW1lb3V0Ow0KKw0KKwlyZXEtPnJxX21ham9ydGltZW8gPSByZXEtPnJxX3Rp
bWVvdXQ7DQorCWlmICh0by0+dG9fZXhwb25lbnRpYWwpDQorCQlyZXEtPnJxX21ham9ydGltZW8g
PDw9IHRvLT50b19yZXRyaWVzOw0KKwllbHNlDQorCQlyZXEtPnJxX21ham9ydGltZW8gKz0gdG8t
PnRvX2luY3JlbWVudCAqIHRvLT50b19yZXRyaWVzOw0KKwlpZiAocmVxLT5ycV9tYWpvcnRpbWVv
ID4gdG8tPnRvX21heHZhbCB8fCByZXEtPnJxX21ham9ydGltZW8gPT0gMCkNCisJCXJlcS0+cnFf
bWFqb3J0aW1lbyA9IHRvLT50b19tYXh2YWw7DQorCXJlcS0+cnFfbWFqb3J0aW1lbyArPSBqaWZm
aWVzOw0KK30NCisNCisvKg0KICAqIEFkanVzdCB0aW1lb3V0IHZhbHVlcyBldGMgZm9yIG5leHQg
cmV0cmFuc21pdA0KICAqLw0KLWludA0KLXhwcnRfYWRqdXN0X3RpbWVvdXQoc3RydWN0IHJwY190
aW1lb3V0ICp0bykNCitpbnQgeHBydF9hZGp1c3RfdGltZW91dChzdHJ1Y3QgcnBjX3Jxc3QgKnJl
cSkNCiB7DQotCWlmICh0by0+dG9fcmV0cmllcyA+IDApIHsNCisJc3RydWN0IHJwY194cHJ0ICp4
cHJ0ID0gcmVxLT5ycV94cHJ0Ow0KKwlzdHJ1Y3QgcnBjX3RpbWVvdXQgKnRvID0gJnhwcnQtPnRp
bWVvdXQ7DQorCWludCBzdGF0dXMgPSAwOw0KKw0KKwlpZiAodGltZV9iZWZvcmUoamlmZmllcywg
cmVxLT5ycV9tYWpvcnRpbWVvKSkgew0KIAkJaWYgKHRvLT50b19leHBvbmVudGlhbCkNCi0JCQl0
by0+dG9fY3VycmVudCA8PD0gMTsNCisJCQlyZXEtPnJxX3RpbWVvdXQgPDw9IDE7DQogCQllbHNl
DQotCQkJdG8tPnRvX2N1cnJlbnQgKz0gdG8tPnRvX2luY3JlbWVudDsNCi0JCWlmICh0by0+dG9f
bWF4dmFsICYmIHRvLT50b19jdXJyZW50ID49IHRvLT50b19tYXh2YWwpDQotCQkJdG8tPnRvX2N1
cnJlbnQgPSB0by0+dG9fbWF4dmFsOw0KKwkJCXJlcS0+cnFfdGltZW91dCArPSB0by0+dG9faW5j
cmVtZW50Ow0KKwkJaWYgKHRvLT50b19tYXh2YWwgJiYgcmVxLT5ycV90aW1lb3V0ID49IHRvLT50
b19tYXh2YWwpDQorCQkJcmVxLT5ycV90aW1lb3V0ID0gdG8tPnRvX21heHZhbDsNCisJCXJlcS0+
cnFfcmV0cmllcysrOw0KKwkJcHByaW50aygiUlBDOiAlbHUgcmV0cmFuc1xuIiwgamlmZmllcyk7
DQogCX0gZWxzZSB7DQotCQlpZiAodG8tPnRvX2V4cG9uZW50aWFsKQ0KLQkJCXRvLT50b19pbml0
dmFsIDw8PSAxOw0KLQkJZWxzZQ0KLQkJCXRvLT50b19pbml0dmFsICs9IHRvLT50b19pbmNyZW1l
bnQ7DQotCQlpZiAodG8tPnRvX21heHZhbCAmJiB0by0+dG9faW5pdHZhbCA+PSB0by0+dG9fbWF4
dmFsKQ0KLQkJCXRvLT50b19pbml0dmFsID0gdG8tPnRvX21heHZhbDsNCi0JCXRvLT50b19jdXJy
ZW50ID0gdG8tPnRvX2luaXR2YWw7DQorCQlyZXEtPnJxX3RpbWVvdXQgPSB0by0+dG9faW5pdHZh
bDsNCisJCXJlcS0+cnFfcmV0cmllcyA9IDA7DQorCQl4cHJ0X3Jlc2V0X21ham9ydGltZW8ocmVx
KTsNCisJCS8qIFJlc2V0IHRoZSBSVFQgY291bnRlcnMgPT0gInNsb3cgc3RhcnQiICovDQorCQlz
cGluX2xvY2tfYmgoJnhwcnQtPnNvY2tfbG9jayk7DQorCQlycGNfaW5pdF9ydHQocmVxLT5ycV90
YXNrLT50a19jbGllbnQtPmNsX3J0dCwgdG8tPnRvX2luaXR2YWwpOw0KKwkJc3Bpbl91bmxvY2tf
YmgoJnhwcnQtPnNvY2tfbG9jayk7DQorCQlwcHJpbnRrKCJSUEM6ICVsdSB0aW1lb3V0XG4iLCBq
aWZmaWVzKTsNCisJCXN0YXR1cyA9IC1FVElNRURPVVQ7DQogCX0NCiANCi0JaWYgKCF0by0+dG9f
Y3VycmVudCkgew0KLQkJcHJpbnRrKEtFUk5fV0FSTklORyAieHBydF9hZGp1c3RfdGltZW91dDog
dG9fY3VycmVudCA9IDAhXG4iKTsNCi0JCXRvLT50b19jdXJyZW50ID0gNSAqIEhaOw0KLQl9DQot
CXBwcmludGsoIlJQQzogJWx1ICVzXG4iLCBqaWZmaWVzLA0KLQkJCXRvLT50b19yZXRyaWVzPyAi
cmV0cmFucyIgOiAidGltZW91dCIpOw0KLQlyZXR1cm4gdG8tPnRvX3JldHJpZXMtLSA+IDA7DQor
CWlmIChyZXEtPnJxX3RpbWVvdXQgPT0gMCkgew0KKwkJcHJpbnRrKEtFUk5fV0FSTklORyAieHBy
dF9hZGp1c3RfdGltZW91dDogcnFfdGltZW91dCA9IDAhXG4iKTsNCisJCXJlcS0+cnFfdGltZW91
dCA9IDUgKiBIWjsNCisJfQ0KKwlyZXR1cm4gc3RhdHVzOw0KIH0NCiANCiAvKg0KQEAgLTExNjYs
NiArMTE4OCw3IEBAIHhwcnRfdHJhbnNtaXQoc3RydWN0IHJwY190YXNrICp0YXNrKQ0KIAkJCS8q
IEFkZCByZXF1ZXN0IHRvIHRoZSByZWNlaXZlIGxpc3QgKi8NCiAJCQlsaXN0X2FkZF90YWlsKCZy
ZXEtPnJxX2xpc3QsICZ4cHJ0LT5yZWN2KTsNCiAJCQlzcGluX3VubG9ja19iaCgmeHBydC0+c29j
a19sb2NrKTsNCisJCQl4cHJ0X3Jlc2V0X21ham9ydGltZW8ocmVxKTsNCiAJCX0NCiAJfSBlbHNl
IGlmICghcmVxLT5ycV9ieXRlc19zZW50KQ0KIAkJcmV0dXJuOw0KQEAgLTEyMjEsNyArMTI0NCw3
IEBAIHhwcnRfdHJhbnNtaXQoc3RydWN0IHJwY190YXNrICp0YXNrKQ0KIAkJCWlmICgheHBydF9j
b25uZWN0ZWQoeHBydCkpDQogCQkJCXRhc2stPnRrX3N0YXR1cyA9IC1FTk9UQ09OTjsNCiAJCQll
bHNlIGlmICh0ZXN0X2JpdChTT0NLX05PU1BBQ0UsICZ4cHJ0LT5zb2NrLT5mbGFncykpIHsNCi0J
CQkJdGFzay0+dGtfdGltZW91dCA9IHJlcS0+cnFfdGltZW91dC50b19jdXJyZW50Ow0KKwkJCQl0
YXNrLT50a190aW1lb3V0ID0gcmVxLT5ycV90aW1lb3V0Ow0KIAkJCQlycGNfc2xlZXBfb24oJnhw
cnQtPnBlbmRpbmcsIHRhc2ssIE5VTEwsIE5VTEwpOw0KIAkJCX0NCiAJCQlzcGluX3VubG9ja19i
aCgmeHBydC0+c29ja19sb2NrKTsNCkBAIC0xMjQ4LDEzICsxMjcxLDExIEBAIHhwcnRfdHJhbnNt
aXQoc3RydWN0IHJwY190YXNrICp0YXNrKQ0KIAlpZiAoIXhwcnQtPm5vY29uZykgew0KIAkJaW50
IHRpbWVyID0gdGFzay0+dGtfbXNnLnJwY19wcm9jLT5wX3RpbWVyOw0KIAkJdGFzay0+dGtfdGlt
ZW91dCA9IHJwY19jYWxjX3J0byhjbG50LT5jbF9ydHQsIHRpbWVyKTsNCi0JCXRhc2stPnRrX3Rp
bWVvdXQgPDw9IHJwY19udGltZW8oY2xudC0+Y2xfcnR0LCB0aW1lcik7DQotCQl0YXNrLT50a190
aW1lb3V0IDw8PSBjbG50LT5jbF90aW1lb3V0LnRvX3JldHJpZXMNCi0JCQktIHJlcS0+cnFfdGlt
ZW91dC50b19yZXRyaWVzOw0KLQkJaWYgKHRhc2stPnRrX3RpbWVvdXQgPiByZXEtPnJxX3RpbWVv
dXQudG9fbWF4dmFsKQ0KLQkJCXRhc2stPnRrX3RpbWVvdXQgPSByZXEtPnJxX3RpbWVvdXQudG9f
bWF4dmFsOw0KKwkJdGFzay0+dGtfdGltZW91dCA8PD0gcnBjX250aW1lbyhjbG50LT5jbF9ydHQs
IHRpbWVyKSArIHJlcS0+cnFfcmV0cmllczsNCisJCWlmICh0YXNrLT50a190aW1lb3V0ID4geHBy
dC0+dGltZW91dC50b19tYXh2YWwgfHwgdGFzay0+dGtfdGltZW91dCA9PSAwKQ0KKwkJCXRhc2st
PnRrX3RpbWVvdXQgPSB4cHJ0LT50aW1lb3V0LnRvX21heHZhbDsNCiAJfSBlbHNlDQotCQl0YXNr
LT50a190aW1lb3V0ID0gcmVxLT5ycV90aW1lb3V0LnRvX2N1cnJlbnQ7DQorCQl0YXNrLT50a190
aW1lb3V0ID0gcmVxLT5ycV90aW1lb3V0Ow0KIAkvKiBEb24ndCByYWNlIHdpdGggZGlzY29ubmVj
dCAqLw0KIAlpZiAoIXhwcnRfY29ubmVjdGVkKHhwcnQpKQ0KIAkJdGFzay0+dGtfc3RhdHVzID0g
LUVOT1RDT05OOw0KQEAgLTEzMjQsNyArMTM0NSw3IEBAIHhwcnRfcmVxdWVzdF9pbml0KHN0cnVj
dCBycGNfdGFzayAqdGFzaywNCiB7DQogCXN0cnVjdCBycGNfcnFzdAkqcmVxID0gdGFzay0+dGtf
cnFzdHA7DQogDQotCXJlcS0+cnFfdGltZW91dCA9IHhwcnQtPnRpbWVvdXQ7DQorCXJlcS0+cnFf
dGltZW91dCA9IHhwcnQtPnRpbWVvdXQudG9faW5pdHZhbDsNCiAJcmVxLT5ycV90YXNrCT0gdGFz
azsNCiAJcmVxLT5ycV94cHJ0ICAgID0geHBydDsNCiAJcmVxLT5ycV94aWQgICAgID0geHBydF9h
bGxvY194aWQoeHBydCk7DQpAQCAtMTM4MSw3ICsxNDAyLDYgQEAgeHBydF9kZWZhdWx0X3RpbWVv
dXQoc3RydWN0IHJwY190aW1lb3V0IA0KIHZvaWQNCiB4cHJ0X3NldF90aW1lb3V0KHN0cnVjdCBy
cGNfdGltZW91dCAqdG8sIHVuc2lnbmVkIGludCByZXRyLCB1bnNpZ25lZCBsb25nIGluY3IpDQog
ew0KLQl0by0+dG9fY3VycmVudCAgID0gDQogCXRvLT50b19pbml0dmFsICAgPSANCiAJdG8tPnRv
X2luY3JlbWVudCA9IGluY3I7DQogCXRvLT50b19tYXh2YWwgICAgPSBpbmNyICogcmV0cjsNCkBA
IC0xNDQ2LDcgKzE0NjYsNiBAQCB4cHJ0X3NldHVwKGludCBwcm90bywgc3RydWN0IHNvY2thZGRy
X2luDQogCS8qIFNldCB0aW1lb3V0IHBhcmFtZXRlcnMgKi8NCiAJaWYgKHRvKSB7DQogCQl4cHJ0
LT50aW1lb3V0ID0gKnRvOw0KLQkJeHBydC0+dGltZW91dC50b19jdXJyZW50ID0gdG8tPnRvX2lu
aXR2YWw7DQogCX0gZWxzZQ0KIAkJeHBydF9kZWZhdWx0X3RpbWVvdXQoJnhwcnQtPnRpbWVvdXQs
IHhwcnQtPnByb3QpOw0KIA0K

--=-bRQUvCjeQ3IzU/AHB0D1--
