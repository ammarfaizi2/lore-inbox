Return-Path: <linux-kernel-owner+willy=40w.ods.org-S268075AbUHQCKK@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S268075AbUHQCKK (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 16 Aug 2004 22:10:10 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S268076AbUHQCKK
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 16 Aug 2004 22:10:10 -0400
Received: from scl-ims.phoenix.com ([216.148.212.222]:51582 "EHLO
	scl-ims.phoenix.com") by vger.kernel.org with ESMTP id S268075AbUHQCJs
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 16 Aug 2004 22:09:48 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.0.6249.0
content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C483FF.488DA7DE"
Subject: Re: [PATCH][linux-usb-devel] Early USB handoff
Date: Mon, 16 Aug 2004 19:09:53 -0700
Message-ID: <5F106036E3D97448B673ED7AA8B2B6B3015B698A@scl-exch2k.phoenix.com>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: [PATCH][linux-usb-devel] Early USB handoff
Thread-Index: AcSD45qvsy4q0jKYRY+/USDem6Z9FwAFzqcw
From: "Aleksey Gorelov" <Aleksey_Gorelov@Phoenix.com>
To: "Pete Zaitcev" <zaitcev@redhat.com>
Cc: <linux-kernel@vger.kernel.org>, <linux-usb-devel@lists.sourceforge.net>,
       <alan@lxorguk.ukuu.org.uk>
X-OriginalArrivalTime: 17 Aug 2004 02:09:48.0135 (UTC) FILETIME=[45A1D770:01C483FF]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------_=_NextPart_001_01C483FF.488DA7DE
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

>>   Here is slightly improved early USB legacy handoff patch for 2.4.27
>
>The usual caveat is how we all wait for this to go into 2.6.

Attached is a patch for 2.6.8.1

>>   Handoff is under no-usb-legacy option.
>> +int disable_legacy_usb __initdata =3D 0;
>
>I think it's an unfortunate naming. When I was reading the patch, I got
>the meaning exactly backwards. I think that we should not be afraid
>of using something like "do handoff" or "do NOT do a handoff" in the
>documentation and flag names, for extra clarity.

Agree. Naming is a 'legacy' thing itself :) I changed flag name=20
to "usb-handoff" and "no-usb-handoff". Modified patch for 2.4.27=20
is attached as well.

Aleks.


------_=_NextPart_001_01C483FF.488DA7DE
Content-Type: text/plain;
	name="usb_patch_2_6.txt"
Content-Transfer-Encoding: base64
Content-Description: usb_patch_2_6.txt
Content-Disposition: attachment;
	filename="usb_patch_2_6.txt"

ZGlmZiAtcnVOIGxpbnV4LTIuNi44LjEvRG9jdW1lbnRhdGlvbi9rZXJuZWwtcGFyYW1ldGVycy50
eHQgbGludXgtMi42LjguMS1maXgvRG9jdW1lbnRhdGlvbi9rZXJuZWwtcGFyYW1ldGVycy50eHQK
LS0tIGxpbnV4LTIuNi44LjEvRG9jdW1lbnRhdGlvbi9rZXJuZWwtcGFyYW1ldGVycy50eHQJMjAw
NC0wOC0xNCAwMzo1NjoyNC4wMDAwMDAwMDAgLTA3MDAKKysrIGxpbnV4LTIuNi44LjEtZml4L0Rv
Y3VtZW50YXRpb24va2VybmVsLXBhcmFtZXRlcnMudHh0CTIwMDQtMDgtMTYgMTg6MTU6NDguMDAw
MDAwMDAwIC0wNzAwCkBAIC03NTcsNiArNzU3LDggQEAKIAogCW5vdXNiCQlbVVNCXSBEaXNhYmxl
IHRoZSBVU0Igc3Vic3lzdGVtCiAKKwluby11c2ItaGFuZG9mZglEaXNhYmxlIGVhcmx5IFVTQiBC
SU9TIC0+IE9TIGhhbmRvZmYKKwogCW5vd2IJCVtBUk1dCiAgCiAJb3BsMz0JCVtIVyxPU1NdCkBA
IC0xMjQwLDYgKzEyNDIsOCBAQAogCiAJdWFydDY4NTA9CVtIVyxPU1NdCiAJCQlGb3JtYXQ6IDxp
bz4sPGlycT4KKworCXVzYi1oYW5kb2ZmCUVuYWJsZSBlYXJseSBVU0IgQklPUyAtPiBPUyBoYW5k
b2ZmCiAgCiAJdmlkZW89CQlbRkJdIEZyYW1lIGJ1ZmZlciBjb25maWd1cmF0aW9uCiAJCQlTZWUg
RG9jdW1lbnRhdGlvbi9mYi9tb2RlZGIudHh0LgpkaWZmIC1ydU4gbGludXgtMi42LjguMS9kcml2
ZXJzL3BjaS9xdWlya3MuYyBsaW51eC0yLjYuOC4xLWZpeC9kcml2ZXJzL3BjaS9xdWlya3MuYwot
LS0gbGludXgtMi42LjguMS9kcml2ZXJzL3BjaS9xdWlya3MuYwkyMDA0LTA4LTE0IDAzOjU0OjQ3
LjAwMDAwMDAwMCAtMDcwMAorKysgbGludXgtMi42LjguMS1maXgvZHJpdmVycy9wY2kvcXVpcmtz
LmMJMjAwNC0wOC0xNiAxODoyOToyNy4wMDAwMDAwMDAgLTA3MDAKQEAgLTkwNyw2ICs5MDcsMjI4
IEBACiAJcGNpZWhwX21zaV9xdWlyayA9IDE7CiB9CiAKKworI2RlZmluZSBVSENJX1VTQkxFR1NV
UAkJMHhjMAkJLyogbGVnYWN5IHN1cHBvcnQgKi8KKyNkZWZpbmUgVUhDSV9VU0JDTUQJCTAJCS8q
IGNvbW1hbmQgcmVnaXN0ZXIgKi8KKyNkZWZpbmUgVUhDSV9VU0JTVFMJCTIJCS8qIHN0YXR1cyBy
ZWdpc3RlciAqLworI2RlZmluZSBVSENJX1VTQklOVFIJCTQJCS8qIGludGVycnVwdCByZWdpc3Rl
ciAqLworI2RlZmluZSBVSENJX1VTQkxFR1NVUF9ERUZBVUxUCTB4MjAwMAkJLyogb25seSBQSVJR
IGVuYWJsZSBzZXQgKi8KKyNkZWZpbmUgVUhDSV9VU0JDTURfUlVOCQkoMSA8PCAwKQkvKiBSVU4v
U1RPUCBiaXQgKi8KKyNkZWZpbmUgVUhDSV9VU0JDTURfR1JFU0VUCSgxIDw8IDIpCS8qIEdsb2Jh
bCByZXNldCAqLworI2RlZmluZSBVSENJX1VTQkNNRF9DT05GSUdVUkUgICAoMSA8PCA2KQkvKiBj
b25maWcgc2VtYXBob3JlICovCisjZGVmaW5lIFVIQ0lfVVNCU1RTX0hBTFRFRAkoMSA8PCA1KQkv
KiBIQ0hhbHRlZCBiaXQgKi8KKworI2RlZmluZSBPSENJX0NPTlRST0wJCTB4MDQKKyNkZWZpbmUg
T0hDSV9DTURTVEFUVVMJCTB4MDgKKyNkZWZpbmUgT0hDSV9JTlRSU1RBVFVTCQkweDBjCisjZGVm
aW5lIE9IQ0lfSU5UUkVOQUJMRQkJMHgxMAorI2RlZmluZSBPSENJX0lOVFJESVNBQkxFCTB4MTQK
KyNkZWZpbmUgT0hDSV9PQ1IJCSgxIDw8IDMpCS8qIG93bmVyc2hpcCBjaGFuZ2UgcmVxdWVzdCAq
LworI2RlZmluZSBPSENJX0NUUkxfSVIJCSgxIDw8IDgpCS8qIGludGVycnVwdCByb3V0aW5nICov
CisjZGVmaW5lIE9IQ0lfSU5UUl9PQwkJKDEgPDwgMzApCS8qIG93bmVyc2hpcCBjaGFuZ2UgKi8K
KworI2RlZmluZSBFSENJX0hDQ19QQVJBTVMJCTB4MDgJCS8qIGV4dGVuZGVkIGNhcGFiaWxpdGll
cyAqLworI2RlZmluZSBFSENJX1VTQkNNRAkJMAkJLyogY29tbWFuZCByZWdpc3RlciAqLworI2Rl
ZmluZSBFSENJX1VTQkNNRF9SVU4JCSgxIDw8IDApCS8qIFJVTi9TVE9QIGJpdCAqLworI2RlZmlu
ZSBFSENJX1VTQlNUUwkJNAkJLyogc3RhdHVzIHJlZ2lzdGVyICovCisjZGVmaW5lIEVIQ0lfVVNC
U1RTX0hBTFRFRAkoMSA8PCAxMikJLyogSENIYWx0ZWQgYml0ICovCisjZGVmaW5lIEVIQ0lfVVNC
SU5UUgkJOAkJLyogaW50ZXJydXB0IHJlZ2lzdGVyICovCisjZGVmaW5lIEVIQ0lfVVNCTEVHU1VQ
CQkwCQkvKiBsZWdhY3kgc3VwcG9ydCByZWdpc3RlciAqLworI2RlZmluZSBFSENJX1VTQkxFR1NV
UF9CSU9TCSgxIDw8IDE2KQkvKiBCSU9TIHNlbWFwaG9yZSAqLworI2RlZmluZSBFSENJX1VTQkxF
R1NVUF9PUwkoMSA8PCAyNCkgICAgICAgLyogT1Mgc2VtYXBob3JlICovCisjZGVmaW5lIEVIQ0lf
VVNCTEVHQ1RMU1RTCTQJCS8qIGxlZ2FjeSBzdXBwb3J0IGNvbnRyb2wvc3RhdHVzICovCisjZGVm
aW5lIEVIQ0lfVVNCTEVHQ1RMU1RTX1NPT0UJKDEgPDwgMTMpCS8qIFNNSSBvbiBvd25lcnNoaXAg
Y2hhbmdlICovCisKK2ludCB1c2JfZWFybHlfaGFuZG9mZiBfX2luaXRkYXRhID0gMDsKK3N0YXRp
YyBpbnQgX19pbml0IHVzYl9oYW5kb2ZmX2Vhcmx5KGNoYXIgKnN0cikKK3sKKwl1c2JfZWFybHlf
aGFuZG9mZiA9IDE7CisJcmV0dXJuIDA7Cit9CitzdGF0aWMgaW50IF9faW5pdCB1c2Jfbm9faGFu
ZG9mZihjaGFyICpzdHIpCit7CisJdXNiX2Vhcmx5X2hhbmRvZmYgPSAwOworCXJldHVybiAwOwor
fQorX19zZXR1cCgidXNiLWhhbmRvZmYiLCB1c2JfaGFuZG9mZl9lYXJseSk7CitfX3NldHVwKCJu
by11c2ItaGFuZG9mZiIsIHVzYl9ub19oYW5kb2ZmKTsKKworc3RhdGljIHZvaWQgX19pbml0IHF1
aXJrX3VzYl9kaXNhYmxlX2VoY2koc3RydWN0IHBjaV9kZXYgKnBkZXYpCit7CisJaW50IHdhaXRf
dGltZSwgZGVsdGE7CisJY2hhciAqYmFzZSwgKm9wX3JlZ19iYXNlOworCXUzMiBoY2NfcGFyYW1z
LCB2YWwsIHRlbXA7CisJdTggY2FwX2xlbmd0aDsKKworCWJhc2UgPSBpb3JlbWFwX25vY2FjaGUo
cGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYsIDApLAorCQkJICAgICAgIHBjaV9yZXNvdXJjZV9sZW4o
cGRldiwgMCkpOworCWlmIChiYXNlID09IE5VTEwpIHJldHVybjsKKworCWNhcF9sZW5ndGggPSBy
ZWFkYiggYmFzZSk7CisJb3BfcmVnX2Jhc2UgPSBiYXNlICsgY2FwX2xlbmd0aDsKKwloY2NfcGFy
YW1zID0gcmVhZGwoIGJhc2UgKyBFSENJX0hDQ19QQVJBTVMpOworCWhjY19wYXJhbXMgPSAoaGNj
X3BhcmFtcyA+PiA4KSAmIDB4ZmY7CisJaWYgKCBoY2NfcGFyYW1zICkgeworCQlwY2lfcmVhZF9j
b25maWdfZHdvcmQoIHBkZXYsIAorCQkJCSAgICAgICBoY2NfcGFyYW1zICsgRUhDSV9VU0JMRUdT
VVAsCisJCQkJICAgICAgICZ2YWwpOworCQlpZiAoICgodmFsICYgMHhmZikgPT0gMSkgJiYgKHZh
bCAmIEVIQ0lfVVNCTEVHU1VQX0JJT1MpICkgeworCQkJLyoqCisJCQkgKiBPaywgQklPUyBpcyBp
biBzbW0gbW9kZSwgdHJ5IHRvIGhhbmQgb2ZmLi4uCisJCQkgKi8KKwkJCXBjaV9yZWFkX2NvbmZp
Z19kd29yZCggcGRldiwKKwkJCQkJICAgICAgIGhjY19wYXJhbXMgKyBFSENJX1VTQkxFR0NUTFNU
UywKKwkJCQkJICAgICAgICZ0ZW1wKTsKKwkJCXBjaV93cml0ZV9jb25maWdfZHdvcmQoIHBkZXYs
CisJCQkJCQloY2NfcGFyYW1zICsgRUhDSV9VU0JMRUdDVExTVFMsCisJCQkJCQl0ZW1wIHwgRUhD
SV9VU0JMRUdDVExTVFNfU09PRSk7CisJCQl2YWwgfD0gRUhDSV9VU0JMRUdTVVBfT1M7CisJCQlw
Y2lfd3JpdGVfY29uZmlnX2R3b3JkKCBwZGV2LCAKKwkJCQkJCWhjY19wYXJhbXMgKyBFSENJX1VT
QkxFR1NVUCwgCisJCQkJCQl2YWwpOworCisJCQl3YWl0X3RpbWUgPSA1MDA7CisJCQlkbyB7CisJ
CQkJc2V0X2N1cnJlbnRfc3RhdGUoVEFTS19VTklOVEVSUlVQVElCTEUpOworCQkJCXNjaGVkdWxl
X3RpbWVvdXQoIChIWioxMCs5OTkpLzEwMDApOworCQkJCXdhaXRfdGltZSAtPSAxMDsKKwkJCQlw
Y2lfcmVhZF9jb25maWdfZHdvcmQoIHBkZXYsCisJCQkJCQkgICAgICAgaGNjX3BhcmFtcyArIEVI
Q0lfVVNCTEVHU1VQLAorCQkJCQkJICAgICAgICZ2YWwpOworCQkJfSB3aGlsZSAoIHdhaXRfdGlt
ZSAmJiAodmFsICYgRUhDSV9VU0JMRUdTVVBfQklPUykgKTsKKwkJCWlmICggIXdhaXRfdGltZSAp
IHsKKwkJCQkvKioKKwkJCQkgKiB3ZWxsLCBwb3NzaWJseSBidWdneSBCSU9TLi4uCisJCQkJICov
CisJCQkJcHJpbnRrKCBLRVJOX1dBUk5JTkcgIkVIQ0kgZWFybHkgQklPUyBoYW5kb2ZmIGZhaWxl
ZCAoQklPUyBidWcgPylcbiIpOworCQkJCXBjaV93cml0ZV9jb25maWdfZHdvcmQoIHBkZXYsCisJ
CQkJCQkJaGNjX3BhcmFtcyArIEVIQ0lfVVNCTEVHU1VQLAorCQkJCQkJCUVIQ0lfVVNCTEVHU1VQ
X09TKTsKKwkJCQlwY2lfd3JpdGVfY29uZmlnX2R3b3JkKCBwZGV2LAorCQkJCQkJCWhjY19wYXJh
bXMgKyBFSENJX1VTQkxFR0NUTFNUUywKKwkJCQkJCQkwKTsKKwkJCX0KKwkJfQorCX0KKworCS8q
KgorCSAqIGhhbHQgRUhDSSAmIGRpc2FibGUgaXRzIGludGVycnVwdHMgaW4gYW55IGNhc2UKKwkg
Ki8KKwl2YWwgPSByZWFkbCggb3BfcmVnX2Jhc2UgKyBFSENJX1VTQlNUUyk7CisJaWYgKCAodmFs
ICYgRUhDSV9VU0JTVFNfSEFMVEVEKSA9PSAwICkgeworCQl2YWwgPSByZWFkbCggb3BfcmVnX2Jh
c2UgKyBFSENJX1VTQkNNRCk7CisJCXZhbCAmPSB+RUhDSV9VU0JDTURfUlVOOworCQl3cml0ZWwo
IHZhbCwgb3BfcmVnX2Jhc2UgKyBFSENJX1VTQkNNRCk7CisKKwkJd2FpdF90aW1lID0gMjAwMDsK
KwkJZGVsdGEgPSAxMDA7CisJCWRvIHsKKwkJCXdyaXRlbCggMHgzZiwgb3BfcmVnX2Jhc2UgKyBF
SENJX1VTQlNUUyk7CisJCQl1ZGVsYXkoIGRlbHRhKTsKKwkJCXdhaXRfdGltZSAtPSBkZWx0YTsK
KwkJCXZhbCA9IHJlYWRsKCBvcF9yZWdfYmFzZSArIEVIQ0lfVVNCU1RTKTsKKwkJCWlmICggKHZh
bCA9PSB+KHUzMikwKSB8fCAKKwkJCSAgICAgKHZhbCAmIEVIQ0lfVVNCU1RTX0hBTFRFRCkpIHsK
KwkJCQlicmVhazsKKwkJCX0KKwkJfSB3aGlsZSAoIHdhaXRfdGltZSA+IDApOworCX0KKwl3cml0
ZWwoIDAsIG9wX3JlZ19iYXNlICsgRUhDSV9VU0JJTlRSKTsKKwl3cml0ZWwoIDB4M2YsIG9wX3Jl
Z19iYXNlICsgRUhDSV9VU0JTVFMpOworCisJaW91bm1hcChiYXNlKTsKKworCXJldHVybjsKK30K
Kworc3RhdGljIHZvaWQgX19pbml0IHF1aXJrX3VzYl9lYXJseV9oYW5kb2ZmKHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KQoreworCWludCB3YWl0X3RpbWUsIGRlbHRhOworCisJaWYgKCF1c2JfZWFybHlf
aGFuZG9mZikKKwkJcmV0dXJuOworCisJaWYgKHBkZXYtPmNsYXNzID09ICgoUENJX0NMQVNTX1NF
UklBTF9VU0IgPDwgOCkgfCAweDAwKSkgeyAvKiBVSENJICovCisJCWludCBpOworCQl1bnNpZ25l
ZCBsb25nIGJhc2UgPSAwOworCQl1MTYgdmFsLCBzdHM7CisKKwkJZm9yIChpID0gMDsgaSA8IFBD
SV9ST01fUkVTT1VSQ0U7IGkrKykKKwkJCWlmICgocGNpX3Jlc291cmNlX2ZsYWdzKHBkZXYsIGkp
ICYgSU9SRVNPVVJDRV9JTykpIHsKKwkJCQliYXNlID0gcGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYs
IGkpOworCQkJCWJyZWFrOworCQkJfQorCisJCWlmICghYmFzZSkKKwkJCXJldHVybjsKKworCQkv
KgorCQkgKiBzdG9wIGNvbnRyb2xsZXIKKwkJICovCisJCXN0cyA9IGludyhiYXNlICsgVUhDSV9V
U0JTVFMpOworCQl2YWwgPSBpbncoYmFzZSArIFVIQ0lfVVNCQ01EKTsKKwkJdmFsICY9IH4odTE2
KShVSENJX1VTQkNNRF9SVU4gfCBVSENJX1VTQkNNRF9DT05GSUdVUkUpOworCQlvdXR3KHZhbCwg
YmFzZSArIFVIQ0lfVVNCQ01EKTsKKworCQkvKgorCQkgKiB3YWl0IHdoaWxlIGl0IHN0b3BzIGlm
IGl0IHdhcyBydW5uaW5nCisJCSAqLworCQlpZiAoIChzdHMgJiBVSENJX1VTQlNUU19IQUxURUQp
ID09IDAgKQorCQl7CisJCQl3YWl0X3RpbWUgPSAxMDAwOworCQkJZGVsdGEgPSAxMDA7CisKKwkJ
CWRvIHsKKwkJCQlvdXR3KDB4MWYsIGJhc2UgKyBVSENJX1VTQlNUUyk7CisJCQkJdWRlbGF5KCBk
ZWx0YSk7CisJCQkJd2FpdF90aW1lIC09IGRlbHRhOworCQkJCXZhbCA9IGludyhiYXNlICsgVUhD
SV9VU0JTVFMpOworCQkJCWlmICh2YWwgJiBVSENJX1VTQlNUU19IQUxURUQpCisJCQkJCWJyZWFr
OworCQkJfSB3aGlsZSAoIHdhaXRfdGltZSA+IDAgKTsKKwkJfQorCisJCS8qCisJCSAqIGRpc2Fi
bGUgaW50ZXJydXB0cyAmIGxlZ2FjeSBzdXBwb3J0CisJCSAqLworCQlvdXR3KDAsIGJhc2UgKyBV
SENJX1VTQklOVFIpOworCQlvdXR3KDB4MWYsIGJhc2UgKyBVSENJX1VTQlNUUyk7CisJCXBjaV9y
ZWFkX2NvbmZpZ193b3JkKHBkZXYsIFVIQ0lfVVNCTEVHU1VQLCAmdmFsKTsKKwkJaWYgKCB2YWwg
JiAweGJmICkgCisJCQlwY2lfd3JpdGVfY29uZmlnX3dvcmQocGRldiwgVUhDSV9VU0JMRUdTVVAs
IAorCQkJCQkgICAgICBVSENJX1VTQkxFR1NVUF9ERUZBVUxUKTsKKwkJCisJfSBlbHNlIGlmIChw
ZGV2LT5jbGFzcyA9PSAoKFBDSV9DTEFTU19TRVJJQUxfVVNCIDw8IDgpIHwgMHgxMCkpIHsgLyog
T0hDSSAqLworCQljaGFyICpiYXNlID0gaW9yZW1hcF9ub2NhY2hlKHBjaV9yZXNvdXJjZV9zdGFy
dChwZGV2LCAwKSwKKwkJCQkJICAgICBwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDApKTsKKwkJaWYg
KGJhc2UgPT0gTlVMTCkgcmV0dXJuOworCisJCWlmIChyZWFkbChiYXNlICsgT0hDSV9DT05UUk9M
KSAmIE9IQ0lfQ1RSTF9JUikgeworCQkJd2FpdF90aW1lID0gNTAwOyAvKiAwLjUgc2Vjb25kcyAq
LworCQkJd3JpdGVsKE9IQ0lfSU5UUl9PQywgYmFzZSArIE9IQ0lfSU5UUkVOQUJMRSk7CisJCQl3
cml0ZWwoT0hDSV9PQ1IsIGJhc2UgKyBPSENJX0NNRFNUQVRVUyk7CisJCQl3aGlsZSAoICh3YWl0
X3RpbWUgPiAwKSAmJiAKKwkJCQlyZWFkbChiYXNlICsgT0hDSV9DT05UUk9MKSAmIE9IQ0lfQ1RS
TF9JUikgeworCQkJCXdhaXRfdGltZSAtPSAxMDsKKwkJCQlzZXRfY3VycmVudF9zdGF0ZShUQVNL
X1VOSU5URVJSVVBUSUJMRSk7CisJCQkJc2NoZWR1bGVfdGltZW91dCggKEhaKjEwICsgOTk5KSAv
IDEwMDApOworCQkJfQorCQl9CisKKwkJLyoKKwkJICogZGlzYWJsZSBpbnRlcnJ1cHRzCisJCSAq
LworCQl3cml0ZWwofih1MzIpMCwgYmFzZSArIE9IQ0lfSU5UUkRJU0FCTEUpOworCQl3cml0ZWwo
fih1MzIpMCwgYmFzZSArIE9IQ0lfSU5UUlNUQVRVUyk7CisKKwkJaW91bm1hcChiYXNlKTsKKwl9
IGVsc2UgaWYgKHBkZXYtPmNsYXNzID09ICgoUENJX0NMQVNTX1NFUklBTF9VU0IgPDwgOCkgfCAw
eDIwKSkgeyAvKiBFSENJICovCisJCXF1aXJrX3VzYl9kaXNhYmxlX2VoY2koIHBkZXYpOworCX0K
KworCXJldHVybjsKK30KKwogLyoKICAqICBUaGUgbWFpbiB0YWJsZSBvZiBxdWlya3MuCiAgKgpA
QCAtMTAzOSw2ICsxMjYxLDcgQEAKICNlbmRpZiAvKiBDT05GSUdfU0NTSV9TQVRBICovCiAKIAl7
IFBDSV9GSVhVUF9GSU5BTCwgICAgICBQQ0lfVkVORE9SX0lEX0lOVEVMLCAgICBQQ0lfREVWSUNF
X0lEX0lOVEVMX1NNQ0gsCXF1aXJrX3BjaWVocF9tc2kgfSwKKwl7IFBDSV9GSVhVUF9GSU5BTCwJ
UENJX0FOWV9JRCwJCVBDSV9BTllfSUQsCQlxdWlya191c2JfZWFybHlfaGFuZG9mZiB9LAogCiAJ
eyAwIH0KIH07CmRpZmYgLXJ1TiBsaW51eC0yLjYuOC4xL2luY2x1ZGUvYXNtLWkzODYvbWFjaC1z
dW1taXQvbWFjaF9tcHBhcnNlLmggbGludXgtMi42LjguMS1maXgvaW5jbHVkZS9hc20taTM4Ni9t
YWNoLXN1bW1pdC9tYWNoX21wcGFyc2UuaAotLS0gbGludXgtMi42LjguMS9pbmNsdWRlL2FzbS1p
Mzg2L21hY2gtc3VtbWl0L21hY2hfbXBwYXJzZS5oCTIwMDQtMDgtMTQgMDM6NTU6MjAuMDAwMDAw
MDAwIC0wNzAwCisrKyBsaW51eC0yLjYuOC4xLWZpeC9pbmNsdWRlL2FzbS1pMzg2L21hY2gtc3Vt
bWl0L21hY2hfbXBwYXJzZS5oCTIwMDQtMDgtMTYgMTg6MTk6MDguMDAwMDAwMDAwIC0wNzAwCkBA
IC0yMiw2ICsyMiw3IEBACiB7CiB9CiAKK2V4dGVybiBpbnQgdXNiX2Vhcmx5X2hhbmRvZmY7CiBz
dGF0aWMgaW5saW5lIGludCBtcHNfb2VtX2NoZWNrKHN0cnVjdCBtcF9jb25maWdfdGFibGUgKm1w
YywgY2hhciAqb2VtLCAKIAkJY2hhciAqcHJvZHVjdGlkKQogewpAQCAtMzEsNiArMzIsNyBAQAog
CQkJIHx8ICFzdHJuY21wKHByb2R1Y3RpZCwgIlJVVEhMRVNTIFNNUCIsIDEyKSkpewogCQl1c2Vf
Y3ljbG9uZSA9IDE7IC8qZW5hYmxlIGN5Y2xvbmUtdGltZXIqLwogCQlzZXR1cF9zdW1taXQoKTsK
KwkJdXNiX2Vhcmx5X2hhbmRvZmYgPSAxOwogCQlyZXR1cm4gMTsKIAl9CiAJcmV0dXJuIDA7CkBA
IC00NCw2ICs0Niw3IEBACiAJICAgICB8fCAhc3RybmNtcChvZW1fdGFibGVfaWQsICJFWEEiLCAz
KSkpewogCQl1c2VfY3ljbG9uZSA9IDE7IC8qZW5hYmxlIGN5Y2xvbmUtdGltZXIqLwogCQlzZXR1
cF9zdW1taXQoKTsKKwkJdXNiX2Vhcmx5X2hhbmRvZmYgPSAxOwogCQlyZXR1cm4gMTsKIAl9CiAJ
cmV0dXJuIDA7Cg==

------_=_NextPart_001_01C483FF.488DA7DE
Content-Type: text/plain;
	name="usb_patch_2_4.txt"
Content-Transfer-Encoding: base64
Content-Description: usb_patch_2_4.txt
Content-Disposition: attachment;
	filename="usb_patch_2_4.txt"

ZGlmZiAtcnVOIGxpbnV4LTIuNC4yNy9Eb2N1bWVudGF0aW9uL2tlcm5lbC1wYXJhbWV0ZXJzLnR4
dCBsaW51eC0yLjQuMjctZml4L0RvY3VtZW50YXRpb24va2VybmVsLXBhcmFtZXRlcnMudHh0Ci0t
LSBsaW51eC0yLjQuMjcvRG9jdW1lbnRhdGlvbi9rZXJuZWwtcGFyYW1ldGVycy50eHQJMjAwNC0w
OC0wNyAxNjoyNjowNC4wMDAwMDAwMDAgLTA3MDAKKysrIGxpbnV4LTIuNC4yNy1maXgvRG9jdW1l
bnRhdGlvbi9rZXJuZWwtcGFyYW1ldGVycy50eHQJMjAwNC0wOC0xNiAxODo1Mjo1Mi4wMDAwMDAw
MDAgLTA3MDAKQEAgLTQ0MSw2ICs0NDEsOCBAQAogCiAJbm90c2MgICAgICAgICAgIFtCVUdTPUlB
LTMyXSBEaXNhYmxlIFRpbWUgU3RhbXAgQ291bnRlcgogCisJbm8tdXNiLWhhbmRvZmYJW0hXXSBE
aXNhYmxlIGVhcmx5IFVTQiBCSU9TIC0+IE9TIGhhbmRvZmYKKwogCW5vd2IJCVtBUk1dCiAgCiAJ
b3BsMz0JCVtIVyxTT1VORF0KQEAgLTYzNSw3ICs2MzcsOSBAQAogCXVhcnQ2ODUwPQlbSFcsU09V
TkRdCiAgCiAJdXNiZml4CQlbQlVHUz1JQS02NF0gCi0gCisKKwl1c2ItaGFuZG9mZglbSFddIEVu
YWJsZSBlYXJseSBVU0IgQklPUyAtPiBPUyBoYW5kb2ZmCisKIAl2aWRlbz0JCVtGQl0gZnJhbWUg
YnVmZmVyIGNvbmZpZ3VyYXRpb24uCiAKIAl2Z2E9CQlbQk9PVF0gb24gaXgzODYsIHNlbGVjdCBh
IHBhcnRpY3VsYXIgdmlkZW8gbW9kZQpkaWZmIC1ydU4gbGludXgtMi40LjI3L2RyaXZlcnMvcGNp
L3F1aXJrcy5jIGxpbnV4LTIuNC4yNy1maXgvZHJpdmVycy9wY2kvcXVpcmtzLmMKLS0tIGxpbnV4
LTIuNC4yNy9kcml2ZXJzL3BjaS9xdWlya3MuYwkyMDA0LTA4LTA3IDE2OjI2OjA1LjAwMDAwMDAw
MCAtMDcwMAorKysgbGludXgtMi40LjI3LWZpeC9kcml2ZXJzL3BjaS9xdWlya3MuYwkyMDA0LTA4
LTE2IDE4OjU1OjUzLjAwMDAwMDAwMCAtMDcwMApAQCAtNzI2LDYgKzcyNiwyMjggQEAKIAlwY2ll
aHBfbXNpX3F1aXJrID0gMTsKIH0KIAorCisjZGVmaW5lIFVIQ0lfVVNCTEVHU1VQCQkweGMwCQkv
KiBsZWdhY3kgc3VwcG9ydCAqLworI2RlZmluZSBVSENJX1VTQkNNRAkJMAkJLyogY29tbWFuZCBy
ZWdpc3RlciAqLworI2RlZmluZSBVSENJX1VTQlNUUwkJMgkJLyogc3RhdHVzIHJlZ2lzdGVyICov
CisjZGVmaW5lIFVIQ0lfVVNCSU5UUgkJNAkJLyogaW50ZXJydXB0IHJlZ2lzdGVyICovCisjZGVm
aW5lIFVIQ0lfVVNCTEVHU1VQX0RFRkFVTFQJMHgyMDAwCQkvKiBvbmx5IFBJUlEgZW5hYmxlIHNl
dCAqLworI2RlZmluZSBVSENJX1VTQkNNRF9SVU4JCSgxIDw8IDApCS8qIFJVTi9TVE9QIGJpdCAq
LworI2RlZmluZSBVSENJX1VTQkNNRF9HUkVTRVQJKDEgPDwgMikJLyogR2xvYmFsIHJlc2V0ICov
CisjZGVmaW5lIFVIQ0lfVVNCQ01EX0NPTkZJR1VSRSAgICgxIDw8IDYpCS8qIGNvbmZpZyBzZW1h
cGhvcmUgKi8KKyNkZWZpbmUgVUhDSV9VU0JTVFNfSEFMVEVECSgxIDw8IDUpCS8qIEhDSGFsdGVk
IGJpdCAqLworCisjZGVmaW5lIE9IQ0lfQ09OVFJPTAkJMHgwNAorI2RlZmluZSBPSENJX0NNRFNU
QVRVUwkJMHgwOAorI2RlZmluZSBPSENJX0lOVFJTVEFUVVMJCTB4MGMKKyNkZWZpbmUgT0hDSV9J
TlRSRU5BQkxFCQkweDEwCisjZGVmaW5lIE9IQ0lfSU5UUkRJU0FCTEUJMHgxNAorI2RlZmluZSBP
SENJX09DUgkJKDEgPDwgMykJLyogb3duZXJzaGlwIGNoYW5nZSByZXF1ZXN0ICovCisjZGVmaW5l
IE9IQ0lfQ1RSTF9JUgkJKDEgPDwgOCkJLyogaW50ZXJydXB0IHJvdXRpbmcgKi8KKyNkZWZpbmUg
T0hDSV9JTlRSX09DCQkoMSA8PCAzMCkJLyogb3duZXJzaGlwIGNoYW5nZSAqLworCisjZGVmaW5l
IEVIQ0lfSENDX1BBUkFNUwkJMHgwOAkJLyogZXh0ZW5kZWQgY2FwYWJpbGl0aWVzICovCisjZGVm
aW5lIEVIQ0lfVVNCQ01ECQkwCQkvKiBjb21tYW5kIHJlZ2lzdGVyICovCisjZGVmaW5lIEVIQ0lf
VVNCQ01EX1JVTgkJKDEgPDwgMCkJLyogUlVOL1NUT1AgYml0ICovCisjZGVmaW5lIEVIQ0lfVVNC
U1RTCQk0CQkvKiBzdGF0dXMgcmVnaXN0ZXIgKi8KKyNkZWZpbmUgRUhDSV9VU0JTVFNfSEFMVEVE
CSgxIDw8IDEyKQkvKiBIQ0hhbHRlZCBiaXQgKi8KKyNkZWZpbmUgRUhDSV9VU0JJTlRSCQk4CQkv
KiBpbnRlcnJ1cHQgcmVnaXN0ZXIgKi8KKyNkZWZpbmUgRUhDSV9VU0JMRUdTVVAJCTAJCS8qIGxl
Z2FjeSBzdXBwb3J0IHJlZ2lzdGVyICovCisjZGVmaW5lIEVIQ0lfVVNCTEVHU1VQX0JJT1MJKDEg
PDwgMTYpCS8qIEJJT1Mgc2VtYXBob3JlICovCisjZGVmaW5lIEVIQ0lfVVNCTEVHU1VQX09TCSgx
IDw8IDI0KSAgICAgICAvKiBPUyBzZW1hcGhvcmUgKi8KKyNkZWZpbmUgRUhDSV9VU0JMRUdDVExT
VFMJNAkJLyogbGVnYWN5IHN1cHBvcnQgY29udHJvbC9zdGF0dXMgKi8KKyNkZWZpbmUgRUhDSV9V
U0JMRUdDVExTVFNfU09PRQkoMSA8PCAxMykJLyogU01JIG9uIG93bmVyc2hpcCBjaGFuZ2UgKi8K
KworaW50IHVzYl9lYXJseV9oYW5kb2ZmIF9faW5pdGRhdGEgPSAwOworc3RhdGljIGludCBfX2lu
aXQgdXNiX2hhbmRvZmZfZWFybHkoY2hhciAqc3RyKQoreworCXVzYl9lYXJseV9oYW5kb2ZmID0g
MTsKKwlyZXR1cm4gMDsKK30KK3N0YXRpYyBpbnQgX19pbml0IHVzYl9ub19oYW5kb2ZmKGNoYXIg
KnN0cikKK3sKKwl1c2JfZWFybHlfaGFuZG9mZiA9IDA7CisJcmV0dXJuIDA7Cit9CitfX3NldHVw
KCJ1c2ItaGFuZG9mZiIsIHVzYl9oYW5kb2ZmX2Vhcmx5KTsKK19fc2V0dXAoIm5vLXVzYi1oYW5k
b2ZmIiwgdXNiX25vX2hhbmRvZmYpOworCitzdGF0aWMgdm9pZCBfX2luaXQgcXVpcmtfdXNiX2Rp
c2FibGVfZWhjaShzdHJ1Y3QgcGNpX2RldiAqcGRldikKK3sKKwlpbnQgd2FpdF90aW1lLCBkZWx0
YTsKKwljaGFyICpiYXNlLCAqb3BfcmVnX2Jhc2U7CisJdTMyIGhjY19wYXJhbXMsIHZhbCwgdGVt
cDsKKwl1OCBjYXBfbGVuZ3RoOworCisJYmFzZSA9IGlvcmVtYXBfbm9jYWNoZShwY2lfcmVzb3Vy
Y2Vfc3RhcnQocGRldiwgMCksCisJCQkgICAgICAgcGNpX3Jlc291cmNlX2xlbihwZGV2LCAwKSk7
CisJaWYgKGJhc2UgPT0gTlVMTCkgcmV0dXJuOworCisJY2FwX2xlbmd0aCA9IHJlYWRiKCBiYXNl
KTsKKwlvcF9yZWdfYmFzZSA9IGJhc2UgKyBjYXBfbGVuZ3RoOworCWhjY19wYXJhbXMgPSByZWFk
bCggYmFzZSArIEVIQ0lfSENDX1BBUkFNUyk7CisJaGNjX3BhcmFtcyA9IChoY2NfcGFyYW1zID4+
IDgpICYgMHhmZjsKKwlpZiAoIGhjY19wYXJhbXMgKSB7CisJCXBjaV9yZWFkX2NvbmZpZ19kd29y
ZCggcGRldiwgCisJCQkJICAgICAgIGhjY19wYXJhbXMgKyBFSENJX1VTQkxFR1NVUCwKKwkJCQkg
ICAgICAgJnZhbCk7CisJCWlmICggKCh2YWwgJiAweGZmKSA9PSAxKSAmJiAodmFsICYgRUhDSV9V
U0JMRUdTVVBfQklPUykgKSB7CisJCQkvKioKKwkJCSAqIE9rLCBCSU9TIGlzIGluIHNtbSBtb2Rl
LCB0cnkgdG8gaGFuZCBvZmYuLi4KKwkJCSAqLworCQkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKCBw
ZGV2LAorCQkJCQkgICAgICAgaGNjX3BhcmFtcyArIEVIQ0lfVVNCTEVHQ1RMU1RTLAorCQkJCQkg
ICAgICAgJnRlbXApOworCQkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZCggcGRldiwKKwkJCQkJCWhj
Y19wYXJhbXMgKyBFSENJX1VTQkxFR0NUTFNUUywKKwkJCQkJCXRlbXAgfCBFSENJX1VTQkxFR0NU
TFNUU19TT09FKTsKKwkJCXZhbCB8PSBFSENJX1VTQkxFR1NVUF9PUzsKKwkJCXBjaV93cml0ZV9j
b25maWdfZHdvcmQoIHBkZXYsIAorCQkJCQkJaGNjX3BhcmFtcyArIEVIQ0lfVVNCTEVHU1VQLCAK
KwkJCQkJCXZhbCk7CisKKwkJCXdhaXRfdGltZSA9IDUwMDsKKwkJCWRvIHsKKwkJCQlzZXRfY3Vy
cmVudF9zdGF0ZShUQVNLX1VOSU5URVJSVVBUSUJMRSk7CisJCQkJc2NoZWR1bGVfdGltZW91dCgg
KEhaKjEwKzk5OSkvMTAwMCk7CisJCQkJd2FpdF90aW1lIC09IDEwOworCQkJCXBjaV9yZWFkX2Nv
bmZpZ19kd29yZCggcGRldiwKKwkJCQkJCSAgICAgICBoY2NfcGFyYW1zICsgRUhDSV9VU0JMRUdT
VVAsCisJCQkJCQkgICAgICAgJnZhbCk7CisJCQl9IHdoaWxlICggd2FpdF90aW1lICYmICh2YWwg
JiBFSENJX1VTQkxFR1NVUF9CSU9TKSApOworCQkJaWYgKCAhd2FpdF90aW1lICkgeworCQkJCS8q
KgorCQkJCSAqIHdlbGwsIHBvc3NpYmx5IGJ1Z2d5IEJJT1MuLi4KKwkJCQkgKi8KKwkJCQlwcmlu
dGsoIEtFUk5fV0FSTklORyAiRUhDSSBlYXJseSBCSU9TIGhhbmRvZmYgZmFpbGVkIChCSU9TIGJ1
ZyA/KVxuIik7CisJCQkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZCggcGRldiwKKwkJCQkJCQloY2Nf
cGFyYW1zICsgRUhDSV9VU0JMRUdTVVAsCisJCQkJCQkJRUhDSV9VU0JMRUdTVVBfT1MpOworCQkJ
CXBjaV93cml0ZV9jb25maWdfZHdvcmQoIHBkZXYsCisJCQkJCQkJaGNjX3BhcmFtcyArIEVIQ0lf
VVNCTEVHQ1RMU1RTLAorCQkJCQkJCTApOworCQkJfQorCQl9CisJfQorCisJLyoqCisJICogaGFs
dCBFSENJICYgZGlzYWJsZSBpdHMgaW50ZXJydXB0cyBpbiBhbnkgY2FzZQorCSAqLworCXZhbCA9
IHJlYWRsKCBvcF9yZWdfYmFzZSArIEVIQ0lfVVNCU1RTKTsKKwlpZiAoICh2YWwgJiBFSENJX1VT
QlNUU19IQUxURUQpID09IDAgKSB7CisJCXZhbCA9IHJlYWRsKCBvcF9yZWdfYmFzZSArIEVIQ0lf
VVNCQ01EKTsKKwkJdmFsICY9IH5FSENJX1VTQkNNRF9SVU47CisJCXdyaXRlbCggdmFsLCBvcF9y
ZWdfYmFzZSArIEVIQ0lfVVNCQ01EKTsKKworCQl3YWl0X3RpbWUgPSAyMDAwOworCQlkZWx0YSA9
IDEwMDsKKwkJZG8geworCQkJd3JpdGVsKCAweDNmLCBvcF9yZWdfYmFzZSArIEVIQ0lfVVNCU1RT
KTsKKwkJCXVkZWxheSggZGVsdGEpOworCQkJd2FpdF90aW1lIC09IGRlbHRhOworCQkJdmFsID0g
cmVhZGwoIG9wX3JlZ19iYXNlICsgRUhDSV9VU0JTVFMpOworCQkJaWYgKCAodmFsID09IH4odTMy
KTApIHx8IAorCQkJICAgICAodmFsICYgRUhDSV9VU0JTVFNfSEFMVEVEKSkgeworCQkJCWJyZWFr
OworCQkJfQorCQl9IHdoaWxlICggd2FpdF90aW1lID4gMCk7CisJfQorCXdyaXRlbCggMCwgb3Bf
cmVnX2Jhc2UgKyBFSENJX1VTQklOVFIpOworCXdyaXRlbCggMHgzZiwgb3BfcmVnX2Jhc2UgKyBF
SENJX1VTQlNUUyk7CisKKwlpb3VubWFwKGJhc2UpOworCisJcmV0dXJuOworfQorCitzdGF0aWMg
dm9pZCBfX2luaXQgcXVpcmtfdXNiX2Vhcmx5X2hhbmRvZmYoc3RydWN0IHBjaV9kZXYgKnBkZXYp
Cit7CisJaW50IHdhaXRfdGltZSwgZGVsdGE7CisKKwlpZiAoIXVzYl9lYXJseV9oYW5kb2ZmKQor
CQlyZXR1cm47CisKKwlpZiAocGRldi0+Y2xhc3MgPT0gKChQQ0lfQ0xBU1NfU0VSSUFMX1VTQiA8
PCA4KSB8IDB4MDApKSB7IC8qIFVIQ0kgKi8KKwkJaW50IGk7CisJCXVuc2lnbmVkIGxvbmcgYmFz
ZSA9IDA7CisJCXUxNiB2YWwsIHN0czsKKworCQlmb3IgKGkgPSAwOyBpIDwgUENJX1JPTV9SRVNP
VVJDRTsgaSsrKQorCQkJaWYgKChwY2lfcmVzb3VyY2VfZmxhZ3MocGRldiwgaSkgJiBJT1JFU09V
UkNFX0lPKSkgeworCQkJCWJhc2UgPSBwY2lfcmVzb3VyY2Vfc3RhcnQocGRldiwgaSk7CisJCQkJ
YnJlYWs7CisJCQl9CisKKwkJaWYgKCFiYXNlKQorCQkJcmV0dXJuOworCisJCS8qCisJCSAqIHN0
b3AgY29udHJvbGxlcgorCQkgKi8KKwkJc3RzID0gaW53KGJhc2UgKyBVSENJX1VTQlNUUyk7CisJ
CXZhbCA9IGludyhiYXNlICsgVUhDSV9VU0JDTUQpOworCQl2YWwgJj0gfih1MTYpKFVIQ0lfVVNC
Q01EX1JVTiB8IFVIQ0lfVVNCQ01EX0NPTkZJR1VSRSk7CisJCW91dHcodmFsLCBiYXNlICsgVUhD
SV9VU0JDTUQpOworCisJCS8qCisJCSAqIHdhaXQgd2hpbGUgaXQgc3RvcHMgaWYgaXQgd2FzIHJ1
bm5pbmcKKwkJICovCisJCWlmICggKHN0cyAmIFVIQ0lfVVNCU1RTX0hBTFRFRCkgPT0gMCApCisJ
CXsKKwkJCXdhaXRfdGltZSA9IDEwMDA7CisJCQlkZWx0YSA9IDEwMDsKKworCQkJZG8geworCQkJ
CW91dHcoMHgxZiwgYmFzZSArIFVIQ0lfVVNCU1RTKTsKKwkJCQl1ZGVsYXkoIGRlbHRhKTsKKwkJ
CQl3YWl0X3RpbWUgLT0gZGVsdGE7CisJCQkJdmFsID0gaW53KGJhc2UgKyBVSENJX1VTQlNUUyk7
CisJCQkJaWYgKHZhbCAmIFVIQ0lfVVNCU1RTX0hBTFRFRCkKKwkJCQkJYnJlYWs7CisJCQl9IHdo
aWxlICggd2FpdF90aW1lID4gMCApOworCQl9CisKKwkJLyoKKwkJICogZGlzYWJsZSBpbnRlcnJ1
cHRzICYgbGVnYWN5IHN1cHBvcnQKKwkJICovCisJCW91dHcoMCwgYmFzZSArIFVIQ0lfVVNCSU5U
Uik7CisJCW91dHcoMHgxZiwgYmFzZSArIFVIQ0lfVVNCU1RTKTsKKwkJcGNpX3JlYWRfY29uZmln
X3dvcmQocGRldiwgVUhDSV9VU0JMRUdTVVAsICZ2YWwpOworCQlpZiAoIHZhbCAmIDB4YmYgKSAK
KwkJCXBjaV93cml0ZV9jb25maWdfd29yZChwZGV2LCBVSENJX1VTQkxFR1NVUCwgCisJCQkJCSAg
ICAgIFVIQ0lfVVNCTEVHU1VQX0RFRkFVTFQpOworCisJfSBlbHNlIGlmIChwZGV2LT5jbGFzcyA9
PSAoKFBDSV9DTEFTU19TRVJJQUxfVVNCIDw8IDgpIHwgMHgxMCkpIHsgLyogT0hDSSAqLworCQlj
aGFyICpiYXNlID0gaW9yZW1hcF9ub2NhY2hlKHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAwKSwK
KwkJCQkJICAgICBwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDApKTsKKwkJaWYgKGJhc2UgPT0gTlVM
TCkgcmV0dXJuOworCisJCWlmIChyZWFkbChiYXNlICsgT0hDSV9DT05UUk9MKSAmIE9IQ0lfQ1RS
TF9JUikgeworCQkJd2FpdF90aW1lID0gNTAwOyAvKiAwLjUgc2Vjb25kcyAqLworCQkJd3JpdGVs
KE9IQ0lfSU5UUl9PQywgYmFzZSArIE9IQ0lfSU5UUkVOQUJMRSk7CisJCQl3cml0ZWwoT0hDSV9P
Q1IsIGJhc2UgKyBPSENJX0NNRFNUQVRVUyk7CisJCQl3aGlsZSAoICh3YWl0X3RpbWUgPiAwKSAm
JiAKKwkJCQlyZWFkbChiYXNlICsgT0hDSV9DT05UUk9MKSAmIE9IQ0lfQ1RSTF9JUikgeworCQkJ
CXdhaXRfdGltZSAtPSAxMDsKKwkJCQlzZXRfY3VycmVudF9zdGF0ZShUQVNLX1VOSU5URVJSVVBU
SUJMRSk7CisJCQkJc2NoZWR1bGVfdGltZW91dCggKEhaKjEwICsgOTk5KSAvIDEwMDApOworCQkJ
fQorCQl9CisKKwkJLyoKKwkJICogZGlzYWJsZSBpbnRlcnJ1cHRzCisJCSAqLworCQl3cml0ZWwo
fih1MzIpMCwgYmFzZSArIE9IQ0lfSU5UUkRJU0FCTEUpOworCQl3cml0ZWwofih1MzIpMCwgYmFz
ZSArIE9IQ0lfSU5UUlNUQVRVUyk7CisKKwkJaW91bm1hcChiYXNlKTsKKwl9IGVsc2UgaWYgKHBk
ZXYtPmNsYXNzID09ICgoUENJX0NMQVNTX1NFUklBTF9VU0IgPDwgOCkgfCAweDIwKSkgeyAvKiBF
SENJICovCisJCXF1aXJrX3VzYl9kaXNhYmxlX2VoY2koIHBkZXYpOworCX0KKworCXJldHVybjsK
K30KKwogLyoKICAqICBUaGUgbWFpbiB0YWJsZSBvZiBxdWlya3MuCiAgKi8KQEAgLTgxNiw2ICsx
MDM4LDcgQEAKIAl7IFBDSV9GSVhVUF9IRUFERVIsCVBDSV9WRU5ET1JfSURfSU5URUwsCVBDSV9E
RVZJQ0VfSURfSU5URUxfODI4MDFCQV8wLAlhc3VzX2hpZGVzX3NtYnVzX2xwYyB9LAogCiAJeyBQ
Q0lfRklYVVBfRklOQUwsCVBDSV9WRU5ET1JfSURfSU5URUwsCVBDSV9ERVZJQ0VfSURfSU5URUxf
U01DSCwgIHF1aXJrX3BjaWVocF9tc2kgfSwKKwl7IFBDSV9GSVhVUF9GSU5BTCwJUENJX0FOWV9J
RCwJCVBDSV9BTllfSUQsCQlxdWlya191c2JfZWFybHlfaGFuZG9mZiB9LAogCQogCXsgMCB9CiB9
OwpkaWZmIC1ydU4gbGludXgtMi40LjI3L2luY2x1ZGUvYXNtLWkzODYvc21wYm9vdC5oIGxpbnV4
LTIuNC4yNy1maXgvaW5jbHVkZS9hc20taTM4Ni9zbXBib290LmgKLS0tIGxpbnV4LTIuNC4yNy9p
bmNsdWRlL2FzbS1pMzg2L3NtcGJvb3QuaAkyMDA0LTA4LTA3IDE2OjI2OjA2LjAwMDAwMDAwMCAt
MDcwMAorKysgbGludXgtMi40LjI3LWZpeC9pbmNsdWRlL2FzbS1pMzg2L3NtcGJvb3QuaAkyMDA0
LTA4LTE2IDE4OjU0OjEzLjAwMDAwMDAwMCAtMDcwMApAQCAtMTUsNiArMTUsNyBAQAogZXh0ZXJu
IHVuc2lnbmVkIGNoYXIgaW50X2RlbGl2ZXJ5X21vZGU7CiBleHRlcm4gdW5zaWduZWQgaW50IGlu
dF9kZXN0X2FkZHJfbW9kZTsKIGV4dGVybiBpbnQgY3ljbG9uZV9zZXR1cChjaGFyKik7CitleHRl
cm4gaW50IHVzYl9lYXJseV9oYW5kb2ZmOwogCiBzdGF0aWMgaW5saW5lIHZvaWQgZGV0ZWN0X2Ns
dXN0ZXJlZF9hcGljKGNoYXIqIG9lbSwgY2hhciogcHJvZCkKIHsKQEAgLTI5LDYgKzMwLDcgQEAK
IAkJZXNyX2Rpc2FibGUgPSAxOwogCQkvKlN0YXJ0IGN5Y2xvbmUgY2xvY2sqLwogCQljeWNsb25l
X3NldHVwKDApOworCQl1c2JfZWFybHlfaGFuZG9mZiA9IDE7CiAJLyogY2hlY2sgZm9yIEFDUEkg
dGFibGVzICovCiAJfSBlbHNlIGlmICghc3RybmNtcChvZW0sICJJQk0iLCAzKSAmJgogCSAgICAo
IXN0cm5jbXAocHJvZCwgIlNFUlZJR0lMIiwgOCkgfHwKQEAgLTQxLDYgKzQzLDcgQEAKIAkJZXNy
X2Rpc2FibGUgPSAxOwogCQkvKlN0YXJ0IGN5Y2xvbmUgY2xvY2sqLwogCQljeWNsb25lX3NldHVw
KDApOworCQl1c2JfZWFybHlfaGFuZG9mZiA9IDE7CiAJfSBlbHNlIGlmICghc3RybmNtcChvZW0s
ICJJQk0gTlVNQSIsIDgpKXsKIAkJY2x1c3RlcmVkX2FwaWNfbW9kZSA9IENMVVNURVJFRF9BUElD
X05VTUFROwogCQlhcGljX2Jyb2FkY2FzdF9pZCA9IEFQSUNfQlJPQURDQVNUX0lEX0FQSUM7Cg==

------_=_NextPart_001_01C483FF.488DA7DE--
