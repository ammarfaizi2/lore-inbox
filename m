Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261864AbVAERNE@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261864AbVAERNE (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 5 Jan 2005 12:13:04 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261848AbVAERNE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 5 Jan 2005 12:13:04 -0500
Received: from cantor.suse.de ([195.135.220.2]:60352 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S261864AbVAERMt (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 5 Jan 2005 12:12:49 -0500
Date: Wed, 05 Jan 2005 17:49:17 +0100
Message-ID: <s5hhdlvyg6q.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Mark_H_Johnson@raytheon.com
Cc: Andrew Morton <akpm@osdl.org>, alsa-devel@alsa-project.org,
       Adrian Bunk <bunk@stusta.de>, lkml <linux-kernel@vger.kernel.org>,
       perex@suse.cz
Subject: Re: [Alsa-devel] Re: 2.6.10-mm1: ALSA ac97 compile error with CONFIG_PM=n
In-Reply-To: <OFB0B3CD59.F6AC2867-ON86256F80.004CECD3@raytheon.com>
References: <OFB0B3CD59.F6AC2867-ON86256F80.004CECD3@raytheon.com>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 5 Jan 2005 08:21:20 -0600,
Mark_H_Johnson@raytheon.com wrote:
> 
> > At Tue, 4 Jan 2005 13:25:40 -0600,
> > Mark_H_Johnson@raytheon.com wrote:
> > > [snip - how to get to the problem]
> > > At this point, I get the window asking if I heard the sound (I did
> not). If
> > > I repeat the test after waiting a short period, it eventually succeeds.
> >
> > The default blocking behavior of OSS devices was changed recently.
> > When the device is in use, open returns -EBUSY immediately in the
> > latest version while it was blocked until released in the former
> > version.
> I suppose there was a "good reason" for changing the user level
> interface in this way. Could you [or someone else] explain that and
> if you would consider changing it back (to stop breaking old applications)?

It was discussed on alsa-devel in November.  Unfortunately, I can't
find ML archive any longer...

The blocking behavior of OSS is a feature which is nowehre defined.
Some OSS drivers open in the blocking mode and some don't.
So, apps shouldn't depend on this feature.

We had implemented OSS emulation in the blocking manner since we
intepreted the POSIX definition in that way.  But Linus pointed out
that it's a misreading.

BTW, you can enable the blocking mode again via module/boot option.
See OSS-Emulation.txt.


> > > [2] When running latencytest (from
> > > http://www.gardena.net/benno/linux/audio/) the sound is not consistent
> > > (like it was on 2.4 with OSS) and occasionally I hear "rapid playback"
> > > where the repeating audio pattern is much faster than it should be.
> >
> > It's hard to tell.  The cause could be in the general interrupt
> > handling, the difference of HZ, the driver's interrupt setting, or
> > whatever.  This must depend on the hardware, anyway.
> Well, to a certain extent, I agree but let me repeat the symptoms
> I am seeing [repeated below]

Please provide the hardware details (I don't see your original post to
lkml).  Otherwise it'll be a vapor discusson...


Takashi
