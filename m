Return-Path: <linux-kernel-owner+willy=40w.ods.org-S266147AbUFYOwF@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266147AbUFYOwF (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 25 Jun 2004 10:52:05 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266747AbUFYOwE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 25 Jun 2004 10:52:04 -0400
Received: from mx1.redhat.com ([66.187.233.31]:55209 "EHLO mx1.redhat.com")
	by vger.kernel.org with ESMTP id S266147AbUFYOvk (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 25 Jun 2004 10:51:40 -0400
From: David Howells <dhowells@redhat.com>
To: David Howells <dhowells@redhat.com>
Cc: linuxppc64-dev@lists.linuxppc.org, linux-kernel@vger.kernel.org
Subject: [PATCH] Fix usage of cpumask_t on iSeries
User-Agent: EMH/1.14.1 SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 Emacs/21.3 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Date: Fri, 25 Jun 2004 15:51:37 +0100
Message-ID: <6965.1088175097@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


Hi,

This fixes a bit of iSeries code that hadn't been changed to reflect that
cpumask_t is now a struct and not an integer type.

David

--- linux-2.6.7/arch/ppc64/kernel/irq.c.orig	2004-06-25 09:32:14.000000000 -0400
+++ linux-2.6.7/arch/ppc64/kernel/irq.c	2004-06-25 09:33:33.000000000 -0400
@@ -807,11 +807,10 @@ static int prof_cpu_mask_write_proc (str
 	{
 		unsigned i;
 		for (i=0; i<NR_CPUS; ++i) {
-			if ( paca[i].prof_buffer && (new_value & 1) )
+			if ( paca[i].prof_buffer && cpu_isset(1, new_value) )
 				paca[i].prof_enabled = 1;
 			else
 				paca[i].prof_enabled = 0;
-			new_value >>= 1;
 		}
 	}
 #endif
