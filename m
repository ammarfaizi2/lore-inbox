Return-Path: <linux-kernel-owner+willy=40w.ods.org-S266861AbUFXSMU@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S266861AbUFXSMU (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 24 Jun 2004 14:12:20 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266856AbUFXSLm
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 24 Jun 2004 14:11:42 -0400
Received: from cfcafw.SGI.COM ([198.149.23.1]:52092 "EHLO
	omx1.americas.sgi.com") by vger.kernel.org with ESMTP
	id S266844AbUFXSJO (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 24 Jun 2004 14:09:14 -0400
Date: Thu, 24 Jun 2004 13:08:56 -0500
From: Erik Jacobson <erikj@subway.americas.sgi.com>
To: linux-kernel@vger.kernel.org
cc: jlan@engr.sgi.com, limin@engr.sgi.com, pwil3058@bigpond.net.au
Subject: [PATCH] Process Aggregates (PAGG) for 2.6.7
Message-ID: <Pine.SGI.4.53.0406241239400.340142@subway.americas.sgi.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-2136806248-1308750959-1088100536=:340142"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---2136806248-1308750959-1088100536=:340142
Content-Type: TEXT/PLAIN; charset=US-ASCII

Attached is a PAGG patch to kernel 2.6.7.

The maintainers of two patches that make use of PAGG will post their patches
in to this discussion thread shortly.

The biggest change in this patch from the last one I posted is that
Peter Williams supplied an implementation for the init function pointer
in the pagg hook.  We kicked this around a few times to flush out
locking issues.  Thanks to Robin Holt for helping me with that.

A bug was found by Dean Roe and fixed - we had to move our pagg_attach
call in fork.c.

There a couple other minor changes too.

Signed-off-by: Erik Jacobson <erikj@sgi.com>

--
Erik Jacobson - Linux System Software - Silicon Graphics - Eagan, Minnesota
---2136806248-1308750959-1088100536=:340142
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=pagg
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.SGI.4.53.0406241308560.340142@subway.americas.sgi.com>
Content-Description: 
Content-Disposition: attachment; filename=pagg

SW5kZXg6IGxpbnV4L0RvY3VtZW50YXRpb24vcGFnZy50eHQNCj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0NCi0tLSAvZGV2L251bGwNCisrKyBsaW51eC9Eb2N1
bWVudGF0aW9uL3BhZ2cudHh0DQpAQCAtMCwwICsxLDMyIEBADQorTGludXgg
UHJvY2VzcyBBZ2dyZWdhdGVzIChQQUdHKQ0KKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0NCisNCitUaGUgcHJvY2VzcyBhZ2dyZWdhdGVzIGlu
ZnJhc3RydWN0dXJlLCBvciBQQUdHLCBwcm92aWRlcyBhIGdlbmVyYWxpemVk
DQorbWVjaGFuaXNtIGZvciBwcm92aWRpbmcgYXJiaXRyYXJ5IHByb2Nlc3Mg
Z3JvdXBzIGluIExpbnV4LiAgUEFHRyBjb25zaXN0cw0KK29mIGEgc2VyaWVz
IG9mIGZ1bmN0aW9ucyBmb3IgcmVnaXN0ZXJpbmcgYW5kIHVucmVnaXN0ZXJp
bmcgc3VwcG9ydA0KK2ZvciBuZXcgdHlwZXMgb2YgcHJvY2VzcyBhZ2dyZWdh
dGlvbiBjb250YWluZXJzIHdpdGggdGhlIGtlcm5lbC4NCitUaGlzIGlzIHNp
bWlsYXIgdG8gdGhlIHN1cHBvcnQgY3VycmVudGx5IHByb3ZpZGVkIHdpdGhp
biBMaW51eCB0aGF0DQorYWxsb3dzIGZvciBkeW5hbWljIHN1cHBvcnQgb2Yg
ZmlsZXN5c3RlbXMsIGJsb2NrIGFuZCBjaGFyYWN0ZXIgZGV2aWNlcywNCitz
eW1ib2wgdGFibGVzLCBuZXR3b3JrIGRldmljZXMsIHNlcmlhbCBkZXZpY2Vz
LCBhbmQgZXhlY3V0aW9uIGRvbWFpbnMuDQorVGhpcyBpbXBsZW1lbnRhdGlv
biBvZiBQQUdHIHByb3ZpZGVzIGRldmVsb3BlcnMgdGhlIGJhc2ljIGhvb2tz
IG5lY2Vzc2FyeQ0KK3RvIGltcGxlbWVudCBrZXJuZWwgbW9kdWxlcyBmb3Ig
c3BlY2lmaWMgcHJvY2VzcyBjb250YWluZXJzLCBzdWNoIGFzDQordGhlIGpv
YiBjb250YWluZXIuDQorDQorVGhlIGRvX2ZvcmsgZnVuY3Rpb24gaW4gdGhl
IGtlcm5lbCB3YXMgYWx0ZXJlZCB0byBzdXBwb3J0IFBBR0cuICBJZiBhDQor
cHJvY2VzcyBpcyBhdHRhY2hlZCB0byBhbnkgUEFHRyBjb250YWluZXJzIGFu
ZCBzdWJzZXF1ZW50bHkgZm9ya3MgYQ0KK2NoaWxkIHByb2Nlc3MsIHRoZSBj
aGlsZCBwcm9jZXNzIHdpbGwgYWxzbyBiZSBhdHRhY2hlZCB0byB0aGUgc2Ft
ZSBQQUdHDQorY29udGFpbmVycy4gIFRoZSBQQUdHIGNvbnRhaW5lcnMgaW52
b2x2ZWQgZHVyaW5nIHRoZSBmb3JrIGFyZSBub3RpZmllZA0KK3RoYXQgYSBu
ZXcgcHJvY2VzcyBoYXMgYmVlbiBhdHRhY2hlZC4gIFRoZSBub3RpZmljYXRp
b24gaXMgYWNjb21wbGlzaGVkDQordmlhIGEgY2FsbGJhY2sgZnVuY3Rpb24g
cHJvdmlkZWQgYnkgdGhlIFBBR0cgbW9kdWxlLg0KKw0KK1RoZSBkb19leGl0
IGZ1bmN0aW9uIGluIHRoZSBrZXJuZWwgaGFzIGFsc28gYmVlbiBhbHRlcmVk
LiAgSWYgYSBwcm9jZXNzDQoraXMgYXR0YWNoZWQgdG8gYW55IFBBR0cgY29u
dGFpbmVycyBhbmQgdGhhdCBwcm9jZXNzIGlzIGV4aXRpbmcsIHRoZSBQQUdH
DQorY29udGFpbmVycyBhcmUgbm90aWZpZWQgdGhhdCBhIHByb2Nlc3MgaGFz
IGRldGFjaGVkIGZyb20gdGhlIGNvbnRhaW5lci4NCitUaGUgbm90aWZpY2F0
aW9uIGlzIGFjY29tcGxpc2hlZCB2aWEgYSBjYWxsYmFjayBmdW5jdGlvbiBw
cm92aWRlZCBieQ0KK3RoZSBQQUdHIG1vZHVsZS4NCisNCitUaGUgc3lzX2V4
ZWN2ZSBmdW5jdGlvbiBoYXMgYmVlbiBtb2RpZmllZCB0byBzdXBwb3J0IGFu
IG9wdGlvbmFsIGNhbGxvdXQNCit0aGF0IGNhbiBiZSBydW4gd2hlbiBhIHBy
b2Nlc3MgaW4gYSBwYWdnIGxpc3QgZG9lcyBhbiBleGVjLiAgSXQgY2FuIGJl
IA0KK3VzZWQsIGZvciBleGFtcGxlLCBieSBvdGhlciBrZXJuZWwgbW9kdWxl
cyB0aGF0IHdpc2ggdG8gZG8gYWR2YW5jZWQgQ1BVDQorcGxhY2VtZW50IG9u
IG11bHRpLXByb2Nlc3NvciBzeXN0ZW1zIChqdXN0IG9uZSBleGFtcGxlKS4N
CisNCkluZGV4OiBsaW51eC9mcy9leGVjLmMNCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0NCi0tLSBsaW51eC5vcmlnL2ZzL2V4ZWMuYw0KKysrIGxpbnV4L2Zz
L2V4ZWMuYw0KQEAgLTQ2LDcgKzQ2LDcgQEANCiAjaW5jbHVkZSA8bGludXgv
c2VjdXJpdHkuaD4NCiAjaW5jbHVkZSA8bGludXgvc3lzY2FsbHMuaD4NCiAj
aW5jbHVkZSA8bGludXgvcm1hcC5oPg0KLQ0KKyNpbmNsdWRlIDxsaW51eC9w
YWdnLmg+DQogI2luY2x1ZGUgPGFzbS91YWNjZXNzLmg+DQogI2luY2x1ZGUg
PGFzbS9wZ2FsbG9jLmg+DQogI2luY2x1ZGUgPGFzbS9tbXVfY29udGV4dC5o
Pg0KQEAgLTExMzMsNiArMTEzMyw3IEBADQogCXJldHZhbCA9IHNlYXJjaF9i
aW5hcnlfaGFuZGxlcigmYnBybSxyZWdzKTsNCiAJaWYgKHJldHZhbCA+PSAw
KSB7DQogCQlmcmVlX2FyZ19wYWdlcygmYnBybSk7DQorCQlwYWdnX2V4ZWMo
Y3VycmVudCk7DQogDQogCQkvKiBleGVjdmUgc3VjY2VzcyAqLw0KIAkJc2Vj
dXJpdHlfYnBybV9mcmVlKCZicHJtKTsNCkluZGV4OiBsaW51eC9pbmNsdWRl
L2xpbnV4L2luaXRfdGFzay5oDQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQot
LS0gbGludXgub3JpZy9pbmNsdWRlL2xpbnV4L2luaXRfdGFzay5oDQorKysg
bGludXgvaW5jbHVkZS9saW51eC9pbml0X3Rhc2suaA0KQEAgLTIsNiArMiw3
IEBADQogI2RlZmluZSBfTElOVVhfX0lOSVRfVEFTS19IDQogDQogI2luY2x1
ZGUgPGxpbnV4L2ZpbGUuaD4NCisjaW5jbHVkZSA8bGludXgvcGFnZy5oPg0K
IA0KICNkZWZpbmUgSU5JVF9GSUxFUyBcDQogeyAJCQkJCQkJXA0KQEAgLTEx
Miw2ICsxMTMsNyBAQA0KIAkucHJvY19sb2NrCT0gU1BJTl9MT0NLX1VOTE9D
S0VELAkJCQlcDQogCS5zd2l0Y2hfbG9jawk9IFNQSU5fTE9DS19VTkxPQ0tF
RCwJCQkJXA0KIAkuam91cm5hbF9pbmZvCT0gTlVMTCwJCQkJCQlcDQorCUlO
SVRfVEFTS19QQUdHKHRzaykJCQkJCQlcDQogfQ0KIA0KIA0KSW5kZXg6IGxp
bnV4L2luY2x1ZGUvbGludXgvcGFnZy5oDQo9PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09DQotLS0gL2Rldi9udWxsDQorKysgbGludXgvaW5jbHVkZS9saW51eC9w
YWdnLmgNCkBAIC0wLDAgKzEsMjAyIEBADQorLyogDQorICogUEFHRyAoUHJv
Y2VzcyBBZ2dyZWdhdGVzKSBpbnRlcmZhY2UNCisgKg0KKyAqIA0KKyAqIENv
cHlyaWdodCAoYykgMjAwMC0yMDAyLCAyMDA0IFNpbGljb24gR3JhcGhpY3Ms
IEluYy4gIEFsbCBSaWdodHMgUmVzZXJ2ZWQuDQorICoNCisgKiBUaGlzIHBy
b2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUg
aXQgYW5kL29yIG1vZGlmeQ0KKyAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0
aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5
DQorICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZl
cnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3INCisgKiAoYXQgeW91ciBvcHRp
b24pIGFueSBsYXRlciB2ZXJzaW9uLg0KKyAqDQorICogVGhpcyBwcm9ncmFt
IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1
c2VmdWwsDQorICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0
IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCisgKiBNRVJDSEFOVEFC
SUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBT
ZWUgdGhlDQorICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1v
cmUgZGV0YWlscy4NCisgKg0KKyAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZl
ZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQor
ICogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8g
dGhlIEZyZWUgU29mdHdhcmUNCisgKiBGb3VuZGF0aW9uLCBJbmMuLCA1OSBU
ZW1wbGUgUGxhY2UsIFN1aXRlIDMzMCwgQm9zdG9uLCBNQSAwMjExMS0xMzA3
IFVTQQ0KKyAqDQorICoNCisgKiBDb250YWN0IGluZm9ybWF0aW9uOiAgU2ls
aWNvbiBHcmFwaGljcywgSW5jLiwgMTUwMCBDcml0dGVuZGVuIExhbmUsDQor
ICogTW91bnRhaW4gVmlldywgQ0EgIDk0MDQzLCBvcjoNCisgKiANCisgKiBo
dHRwOi8vd3d3LnNnaS5jb20gDQorICogDQorICogRm9yIGZ1cnRoZXIgaW5m
b3JtYXRpb24gcmVnYXJkaW5nIHRoaXMgbm90aWNlLCBzZWU6IA0KKyAqIA0K
KyAqIGh0dHA6Ly9vc3Muc2dpLmNvbS9wcm9qZWN0cy9HZW5JbmZvL05vdGlj
ZUV4cGxhbg0KKyAqLw0KKw0KKy8qDQorICogRGF0YSBzdHJ1Y3R1cmUgZGVm
aW5pdGlvbnMgYW5kIGZ1bmN0aW9uIHByb3RvdHlwZXMgdXNlZCB0byBpbXBs
ZW1lbnQNCisgKiBwcm9jZXNzIGFnZ3JlZ2F0ZXMgKHBhZ2dzKS4NCisgKg0K
KyAqIFBhZ2dzIHByb3ZpZGVzIGEgZ2VuZXJhbGl6ZWQgd2F5IHRvIGltcGxl
bWVudCBwcm9jZXNzIGdyb3VwaW5ncyBvcg0KKyAqIGNvbnRhaW5lcnMuICBN
b2R1bGVzIHVzZSB0aGVzZSBmdW5jdGlvbnMgdG8gcmVnaXN0ZXIgd2l0aCB0
aGUga2VybmVsIGFzDQorICogcHJvdmlkZXJzIG9mIHByb2Nlc3MgYWdncmVn
YXRpb24gY29udGFpbmVycy4gVGhlIHBhZ2cgZGF0YSBzdHJ1Y3R1cmVzDQor
ICogZGVmaW5lIHRoZSBjYWxsYmFjayBmdW5jdGlvbnMgYW5kIGRhdGEgYWNj
ZXNzIHBvaW50ZXJzIGJhY2sgaW50byB0aGUNCisgKiBwYWdnIG1vZHVsZXMu
DQorICovDQorDQorI2lmbmRlZiBfTElOVVhfUEFHR19IDQorI2RlZmluZSBf
TElOVVhfUEFHR19IDQorDQorI2luY2x1ZGUgPGxpbnV4L3NjaGVkLmg+DQor
DQorI2lmZGVmIENPTkZJR19QQUdHDQorDQorI2RlZmluZSBQQUdHX05BTUVM
TgkzMgkJLyogTWF4IGNoYXJzIGluIFBBR0cgbW9kdWxlIG5hbWUgKi8NCisN
CisNCisvKioNCisgKiBJTklUX1BBR0dfTElTVCAtIHVzZWQgdG8gaW5pdGlh
bGl6ZSBhIHBhZ2dfbGlzdCBzdHJ1Y3R1cmUgYWZ0ZXIgZGVjbGFyYXRpb24g
DQorICogQF9sOiBUYXNrIHN0cnVjdCB0byBpbml0IHRoZSBwYWdnX2xpc3Qg
YW5kIHNlbWFwaG9yZSBpbg0KKyAqIA0KKyAqLw0KKyNkZWZpbmUgSU5JVF9Q
QUdHX0xJU1QoX2wpCQkJCQkJXA0KK2RvIHsJCQkJCQkJCQlcDQorCUlOSVRf
TElTVF9IRUFEKCYoX2wpLT5wYWdnX2xpc3QpOwkJCQkJXA0KKwlpbml0X3J3
c2VtKCYoX2wpLT5wYWdnX3NlbSk7CQkJCQkJXA0KK30gd2hpbGUoMCkNCisJ
DQorDQorLyoNCisgKiBVc2VkIGJ5IHRhc2tfc3RydWN0IHRvIG1hbmFnZSBs
aXN0IG9mIHBhZ2cgYXR0YWNobWVudHMgZm9yIHRoZSBwcm9jZXNzLiAgDQor
ICogRWFjaCBwYWdnIHByb3ZpZGVzIHRoZSBsaW5rIGJldHdlZW4gdGhlIHBy
b2Nlc3MgYW5kIHRoZSANCisgKiBjb3JyZWN0IHBhZ2cgY29udGFpbmVyLg0K
KyAqDQorICogU1RSVUNUIE1FTUJFUlM6DQorICogICAgIGhvb2s6CVJlZmVy
ZW5jZSB0byBwYWdnIG1vZHVsZSBzdHJ1Y3R1cmUuICBUaGF0IHN0cnVjdA0K
KyAqICAgICAJCWhvbGRzIHRoZSBuYW1lIGtleSBhbmQgZnVuY3Rpb24gcG9p
bnRlcnMuDQorICogICAgIGRhdGE6CU9wYXF1ZSBkYXRhIHBvaW50ZXIgLSBk
ZWZpbmVkIGJ5IHBhZ2cgbW9kdWxlcy4NCisgKiAgICAgZW50cnk6CUxpc3Qg
cG9pbnRlcnMNCisgKi8NCitzdHJ1Y3QgcGFnZyB7DQorICAgICAgIHN0cnVj
dCBwYWdnX2hvb2sJKmhvb2s7DQorICAgICAgIHZvaWQJCSpkYXRhOw0KKyAg
ICAgICBzdHJ1Y3QgbGlzdF9oZWFkCWVudHJ5Ow0KK307DQorDQorLyoNCisg
KiBVc2VkIGJ5IHBhZ2cgbW9kdWxlcyB0byBkZWZpbmUgdGhlIGNhbGxiYWNr
IGZ1bmN0aW9ucyBpbnRvIHRoZSANCisgKiBtb2R1bGUuDQorICoNCisgKiBT
VFJVQ1QgTUVNQkVSUzoNCisgKiAgICAgbmFtZTogICAgICAgICAgIFRoZSBu
YW1lIG9mIHRoZSBwYWdnIGNvbnRhaW5lciB0eXBlIHByb3ZpZGVkIGJ5DQor
ICogICAgICAgICAgICAgICAgICAgICB0aGUgbW9kdWxlLiBUaGlzIHdpbGwg
YmUgc2V0IGJ5IHRoZSBwYWdnIG1vZHVsZS4NCisgKiAgICAgYXR0YWNoOiAg
ICAgICAgIEZ1bmN0aW9uIHBvaW50ZXIgdG8gZnVuY3Rpb24gdXNlZCB3aGVu
IGF0dGFjaGluZw0KKyAqICAgICAgICAgICAgICAgICAgICAgYSBwcm9jZXNz
IHRvIHRoZSBwYWdnIGNvbnRhaW5lciByZWZlcmVuY2VkIGJ5IA0KKyAqICAg
ICAgICAgICAgICAgICAgICAgdGhpcyBzdHJ1Y3QuDQorICogICAgIGRldGFj
aDogICAgICAgICBGdW5jdGlvbiBwb2ludGVyIHRvIGZ1bmN0aW9uIHVzZWQg
d2hlbiBkZXRhY2hpbmcNCisgKiAgICAgICAgICAgICAgICAgICAgIGEgcHJv
Y2VzcyB0byB0aGUgcGFnZyBjb250YWluZXIgcmVmZXJlbmNlZCBieSANCisg
KiAgICAgICAgICAgICAgICAgICAgIHRoaXMgc3RydWN0Lg0KKyAqICAgICBp
bml0OiAgICAgICAgICAgRnVuY3Rpb24gcG9pbnRlciB0byBpbml0aWFsaXph
dGlvbiBmdW5jdGlvbi4gIFRoaXMNCisgKiAgICAgICAgICAgICAgICAgICAg
IGZ1bmN0aW9uIGlzIHVzZWQgd2hlbiB0aGUgbW9kdWxlIGlzIGxvYWRlZCB0
byBhdHRhY2gNCisgKiAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nIHBy
b2Nlc3NlcyB0byBhIGRlZmF1bHQgY29udGFpbmVyIGFzIGRlZmluZWQgYnkN
CisgKiAgICAgICAgICAgICAgICAgICAgIHRoZSBwYWdnIG1vZHVsZS4gVGhp
cyBpcyBvcHRpb25hbCBhbmQgbWF5IGJlIHNldCB0byANCisgKiAgICAgICAg
ICAgICAgICAgICAgIE5VTEwgaWYgaXQgaXMgbm90IG5lZWRlZCBieSB0aGUg
cGFnZyBtb2R1bGUuDQorICogICAgIGRhdGE6ICAgICAgICAgICBPcGFxdWUg
ZGF0YSBwb2ludGVyIC0gZGVmaW5lZCBieSBwYWdnIG1vZHVsZXMuDQorICog
ICAgIG1vZHVsZTogICAgICAgICBQb2ludGVyIHRvIGtlcm5lbCBtb2R1bGUg
c3RydWN0LiAgVXNlZCB0byBpbmNyZW1lbnQgJiANCisgKiAgICAgICAgICAg
ICAgICAgICAgIGRlY3JlbWVudCB0aGUgdXNlIGNvdW50IGZvciB0aGUgbW9k
dWxlLg0KKyAqICAgICBlbnRyeToJICAgICAgIExpc3QgcG9pbnRlcnMNCisg
KiAgICAgZXhlYzogICAgICAgICAgIEZ1bmN0aW9uIHBvaW50ZXIgdG8gZnVu
Y3Rpb24gdXNlZCB3aGVuIGEgcHJvY2Vzcw0KKyAqICAgICAgICAgICAgICAg
ICAgICAgaW4gdGhlIHBhZ2cgY29udGFpbmVyIGV4ZWMncyBhIG5ldyBwcm9j
ZXNzLiBUaGlzDQorICogICAgICAgICAgICAgICAgICAgICBpcyBvcHRpb25h
bCBhbmQgbWF5IGJlIHNldCB0byBOVUxMIGlmIGl0IGlzIG5vdCANCisgKiAg
ICAgICAgICAgICAgICAgICAgIG5lZWRlZCBieSB0aGUgcGFnZyBtb2R1bGUu
DQorICogICAgIHJlZmNudDogICAgICAgICBLZWVwIHRyYWNrIG9mIHVzZXIg
Y291bnQgb2YgdGhlIHBhZ2cgaG9vaw0KKyAqLw0KK3N0cnVjdCBwYWdnX2hv
b2sgew0KKyAgICAgICBzdHJ1Y3QgbW9kdWxlCSptb2R1bGU7DQorICAgICAg
IGNoYXIJCSpuYW1lOwkvKiBOYW1lIEtleSAtIHJlc3RyaWN0ZWQgdG8gMzIg
Y2hhcmFjdGVycyAqLw0KKyAgICAgICB2b2lkCQkqZGF0YTsJLyogT3BhcXVl
IG1vZHVsZSBzcGVjaWZpYyBkYXRhICovDQorICAgICAgIHN0cnVjdCBsaXN0
X2hlYWQJZW50cnk7CS8qIExpc3QgcG9pbnRlcnMgKi8NCisJCSBhdG9taWNf
dCByZWZjbnQ7IC8qIHVzYWdlIGNvdW50ZXIgKi8NCisgICAgICAgaW50CQko
KmluaXQpKHN0cnVjdCB0YXNrX3N0cnVjdCAqLCBzdHJ1Y3QgcGFnZyAqKTsN
CisgICAgICAgaW50CQkoKmF0dGFjaCkoc3RydWN0IHRhc2tfc3RydWN0ICos
IHN0cnVjdCBwYWdnICosIHZvaWQqKTsNCisgICAgICAgdm9pZAkJKCpkZXRh
Y2gpKHN0cnVjdCB0YXNrX3N0cnVjdCAqLCBzdHJ1Y3QgcGFnZyAqKTsNCisg
ICAgICAgdm9pZAkJKCpleGVjKShzdHJ1Y3QgdGFza19zdHJ1Y3QgKiwgc3Ry
dWN0IHBhZ2cgKik7DQorfTsNCisNCisNCisvKiBLZXJuZWwgc2VydmljZSBm
dW5jdGlvbnMgZm9yIHByb3ZpZGluZyBQQUdHIHN1cHBvcnQgKi8NCitleHRl
cm4gc3RydWN0IHBhZ2cgKnBhZ2dfZ2V0KHN0cnVjdCB0YXNrX3N0cnVjdCAq
dGFzaywgY2hhciAqa2V5KTsNCitleHRlcm4gc3RydWN0IHBhZ2cgKnBhZ2df
YWxsb2Moc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrLCANCisJCQkgICAgICAg
c3RydWN0IHBhZ2dfaG9vayAqcHQpOw0KK2V4dGVybiB2b2lkIHBhZ2dfZnJl
ZShzdHJ1Y3QgcGFnZyAqcGFnZyk7DQorZXh0ZXJuIGludCBwYWdnX2hvb2tf
cmVnaXN0ZXIoc3RydWN0IHBhZ2dfaG9vayAqcHRfbmV3KTsNCitleHRlcm4g
aW50IHBhZ2dfaG9va191bnJlZ2lzdGVyKHN0cnVjdCBwYWdnX2hvb2sgKnB0
X29sZCk7DQorZXh0ZXJuIHZvaWQgX19wYWdnX2F0dGFjaChzdHJ1Y3QgdGFz
a19zdHJ1Y3QgKnRvX3Rhc2ssIA0KKwkJCSBzdHJ1Y3QgdGFza19zdHJ1Y3Qg
KmZyb21fdGFzayk7DQorZXh0ZXJuIHZvaWQgX19wYWdnX2RldGFjaChzdHJ1
Y3QgdGFza19zdHJ1Y3QgKnRhc2spOw0KK2V4dGVybiBpbnQgX19wYWdnX2V4
ZWMoc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrKTsNCisNCisvKioNCisgKiBw
YWdnX2F0dGFjaCAtIGNoaWxkIGluaGVyaXRzIGF0dGFjaG1lbnQgdG8gcGFn
ZyBjb250YWluZXJzIG9mIGl0cyBwYXJlbnQNCisgKiBAY2hpbGQ6IGNoaWxk
IHRhc2sgLSB0byBpbmhlcml0DQorICogQHBhcmVudDogcGFyZW5ldCB0YXNr
IC0gY2hpbGQgaW5oZXJpdHMgcGFnZyBjb250YWluZXJzIGZyb20gdGhpcyBw
YXJlbnQNCisgKiANCisgKiBmdW5jdGlvbiB1c2VkIHdoZW4gYSBjaGlsZCBw
cm9jZXNzIG11c3QgaW5oZXJpdCBhdHRhY2htZW50IHRvIHBhZ2cNCisgKiBj
b250YWluZXJzIGZyb20gdGhlIHBhcmVudC4NCisgKg0KKyAqLw0KK3N0YXRp
YyBpbmxpbmUgdm9pZCBwYWdnX2F0dGFjaChzdHJ1Y3QgdGFza19zdHJ1Y3Qg
KmNoaWxkLCANCisJCQkgICAgICBzdHJ1Y3QgdGFza19zdHJ1Y3QgKnBhcmVu
dCkNCit7DQorCUlOSVRfUEFHR19MSVNUKGNoaWxkKTsNCisJaWYgKCFsaXN0
X2VtcHR5KCZwYXJlbnQtPnBhZ2dfbGlzdCkpDQorCQlfX3BhZ2dfYXR0YWNo
KGNoaWxkLCBwYXJlbnQpOw0KKwlyZXR1cm47DQorfQ0KKw0KKw0KKy8qKg0K
KyAqIHBhZ2dfZGV0YWNoIC0gRGV0YWNoIGEgcHJvY2VzcyBmcm9tIGEgcGFn
ZyBjb250YWluZXIgaXQgaXMgYSBtZW1iZXIgb2YNCisgKiBAdGFzazogVGhl
IHRhc2sgdGhlIHBhZ2cgd2lsbCBiZSBkZXRhY2hlZCBmcm9tDQorICoNCisg
Ki8NCitzdGF0aWMgaW5saW5lIHZvaWQgcGFnZ19kZXRhY2goc3RydWN0IHRh
c2tfc3RydWN0ICp0YXNrKQ0KK3sNCisJaWYgKCFsaXN0X2VtcHR5KCZ0YXNr
LT5wYWdnX2xpc3QpKQ0KKwkJX19wYWdnX2RldGFjaCh0YXNrKTsNCit9DQor
DQorLyoqDQorICogcGFnZ19leGVjIC0gVXNlZCB3aGVuIGEgcHJvY2VzcyBl
eGVjJ3MNCisgKiBAdGFzazogVGhlIHByb2Nlc3MgZG9pbmcgdGhlIGV4ZWMN
CisgKg0KKyAqLw0KK3N0YXRpYyBpbmxpbmUgdm9pZCBwYWdnX2V4ZWMoc3Ry
dWN0IHRhc2tfc3RydWN0ICp0YXNrKQ0KK3sNCisJaWYgKCFsaXN0X2VtcHR5
KCZ0YXNrLT5wYWdnX2xpc3QpKQ0KKwkJX19wYWdnX2V4ZWModGFzayk7DQor
fQ0KKw0KKy8qKiANCisgKiBJTklUX1RBU0tfUEFHRyAtIFVzZWQgaW4gSU5J
VF9UQVNLIHRvIHNldCB0aGUgaGVhZCBhbmQgc2VtIG9mIHBhZ2dfbGlzdA0K
KyAqIEB0c2s6IFRoZSB0YXNrIHdvcmsgd2l0aA0KKyAqDQorICogTWFyY28g
VXNlZCBpbiBJTklUX1RBU0sgdG8gc2V0IHRoZSBoZWFkIGFuZCBzZW0gb2Yg
cGFnZ19saXN0Lg0KKyAqIElmIENPTkZJR19QQUdHIGlzIG9mZiwgaXQgaXMg
ZGVmaW5lZCBhcyBhbiBlbXB0eSBtYWNybyBiZWxvdy4NCisgKg0KKyAqLw0K
KyNkZWZpbmUgSU5JVF9UQVNLX1BBR0codHNrKSBcDQorCS5wYWdnX2xpc3Qg
PSBMSVNUX0hFQURfSU5JVCh0c2sucGFnZ19saXN0KSwgICAgIFwNCisJLnBh
Z2dfc2VtICA9IF9fUldTRU1fSU5JVElBTElaRVIodHNrLnBhZ2dfc2VtKSAg
DQorDQorI2Vsc2UgIC8qIENPTkZJR19QQUdHICovDQorDQorLyogDQorICog
UmVwbGFjZW1lbnQgbWFjcm9zIHVzZWQgd2hlbiBQQUdHIChQcm9jZXNzIEFn
Z3JlZ2F0ZXMpIHN1cHBvcnQgaXMgbm90DQorICogY29tcGlsZWQgaW50byB0
aGUga2VybmVsLg0KKyAqLw0KKyNkZWZpbmUgSU5JVF9UQVNLX1BBR0codHNr
KQ0KKyNkZWZpbmUgSU5JVF9QQUdHX0xJU1QobCkgZG8geyB9IHdoaWxlKDAp
DQorI2RlZmluZSBwYWdnX2F0dGFjaChjdCwgcHQpICBkbyB7IH0gd2hpbGUo
MCkNCisjZGVmaW5lIHBhZ2dfZGV0YWNoKHQpICBkbyB7ICB9IHdoaWxlKDAp
ICAgICANCisjZGVmaW5lIHBhZ2dfZXhlYyh0KSAgZG8geyAgfSB3aGlsZSgw
KSAgICAgDQorDQorI2VuZGlmIC8qIENPTkZJR19QQUdHICovDQorDQorI2Vu
ZGlmIC8qIF9MSU5VWF9QQUdHX0ggKi8NCkluZGV4OiBsaW51eC9pbmNsdWRl
L2xpbnV4L3NjaGVkLmgNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBs
aW51eC5vcmlnL2luY2x1ZGUvbGludXgvc2NoZWQuaA0KKysrIGxpbnV4L2lu
Y2x1ZGUvbGludXgvc2NoZWQuaA0KQEAgLTUxMyw2ICs1MTMsMTMgQEANCiAg
IAlzdHJ1Y3QgbWVtcG9saWN5ICptZW1wb2xpY3k7DQogICAJc2hvcnQgaWxf
bmV4dDsJCS8qIGNvdWxkIGJlIHNoYXJlZCB3aXRoIHVzZWRfbWF0aCAqLw0K
ICNlbmRpZg0KKw0KKyNpZmRlZiBDT05GSUdfUEFHRw0KKy8qIExpc3Qgb2Yg
cGFnZyAocHJvY2VzcyBhZ2dyZWdhdGUpIGF0dGFjaG1lbnRzICovDQorCXN0
cnVjdCBsaXN0X2hlYWQgcGFnZ19saXN0Ow0KKwlzdHJ1Y3Qgcndfc2VtYXBo
b3JlIHBhZ2dfc2VtOw0KKyNlbmRpZg0KKw0KIH07DQogDQogc3RhdGljIGlu
bGluZSBwaWRfdCBwcm9jZXNzX2dyb3VwKHN0cnVjdCB0YXNrX3N0cnVjdCAq
dHNrKQ0KSW5kZXg6IGxpbnV4L2luaXQvS2NvbmZpZw0KPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KLS0tIGxpbnV4Lm9yaWcvaW5pdC9LY29uZmlnDQorKysg
bGludXgvaW5pdC9LY29uZmlnDQpAQCAtMTIxLDYgKzEyMSwxNCBAQA0KIAkg
IHVwIHRvIHRoZSB1c2VyIGxldmVsIHByb2dyYW0gdG8gZG8gdXNlZnVsIHRo
aW5ncyB3aXRoIHRoaXMNCiAJICBpbmZvcm1hdGlvbi4gIFRoaXMgaXMgZ2Vu
ZXJhbGx5IGEgZ29vZCBpZGVhLCBzbyBzYXkgWS4NCiANCitjb25maWcgUEFH
Rw0KKwlib29sICJTdXBwb3J0IGZvciBwcm9jZXNzIGFnZ3JlZ2F0ZXMgKFBB
R0dzKSINCisJaGVscA0KKyAgICAgU2F5IFkgaGVyZSBpZiB5b3Ugd2lsbCBi
ZSBsb2FkaW5nIG1vZHVsZXMgd2hpY2ggcHJvdmlkZSBzdXBwb3J0DQorICAg
ICBmb3IgcHJvY2VzcyBhZ2dyZWdhdGUgY29udGFpbmVycy4gIEV4YW1wbGVz
IG9mIHN1Y2ggbW9kdWxlcyBpbmNsdWRlIHRoZQ0KKyAgICAgTGludXggSm9i
cyBtb2R1bGUgYW5kIHRoZSBMaW51eCBBcnJheSBTZXNzaW9ucyBtb2R1bGUu
ICBJZiB5b3Ugd2lsbCBub3QgDQorICAgICBiZSB1c2luZyBzdWNoIG1vZHVs
ZXMsIHNheSBOLg0KKw0KIGNvbmZpZyBTWVNDVEwNCiAJYm9vbCAiU3lzY3Rs
IHN1cHBvcnQiDQogCS0tLWhlbHAtLS0NCkluZGV4OiBsaW51eC9rZXJuZWwv
TWFrZWZpbGUNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBsaW51eC5v
cmlnL2tlcm5lbC9NYWtlZmlsZQ0KKysrIGxpbnV4L2tlcm5lbC9NYWtlZmls
ZQ0KQEAgLTE4LDYgKzE4LDcgQEANCiBvYmotJChDT05GSUdfUE0pICs9IHBv
d2VyLw0KIG9iai0kKENPTkZJR19CU0RfUFJPQ0VTU19BQ0NUKSArPSBhY2N0
Lm8NCiBvYmotJChDT05GSUdfQ09NUEFUKSArPSBjb21wYXQubw0KK29iai0k
KENPTkZJR19QQUdHKSArPSBwYWdnLm8NCiBvYmotJChDT05GSUdfSUtDT05G
SUcpICs9IGNvbmZpZ3Mubw0KIG9iai0kKENPTkZJR19JS0NPTkZJR19QUk9D
KSArPSBjb25maWdzLm8NCiBvYmotJChDT05GSUdfU1RPUF9NQUNISU5FKSAr
PSBzdG9wX21hY2hpbmUubw0KSW5kZXg6IGxpbnV4L2tlcm5lbC9leGl0LmMN
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBsaW51eC5vcmlnL2tlcm5l
bC9leGl0LmMNCisrKyBsaW51eC9rZXJuZWwvZXhpdC5jDQpAQCAtMjMsNiAr
MjMsNyBAQA0KICNpbmNsdWRlIDxsaW51eC9tb3VudC5oPg0KICNpbmNsdWRl
IDxsaW51eC9wcm9jX2ZzLmg+DQogI2luY2x1ZGUgPGxpbnV4L21lbXBvbGlj
eS5oPg0KKyNpbmNsdWRlIDxsaW51eC9wYWdnLmg+DQogDQogI2luY2x1ZGUg
PGFzbS91YWNjZXNzLmg+DQogI2luY2x1ZGUgPGFzbS91bmlzdGQuaD4NCkBA
IC04MTIsNiArODEzLDkgQEANCiAJCW1vZHVsZV9wdXQodHNrLT5iaW5mbXQt
Pm1vZHVsZSk7DQogDQogCXRzay0+ZXhpdF9jb2RlID0gY29kZTsNCisNCisJ
cGFnZ19kZXRhY2godHNrKTsNCisNCiAJZXhpdF9ub3RpZnkodHNrKTsNCiAJ
c2NoZWR1bGUoKTsNCiAJQlVHKCk7DQpJbmRleDogbGludXgva2VybmVsL2Zv
cmsuYw0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIGxpbnV4Lm9yaWcv
a2VybmVsL2ZvcmsuYw0KKysrIGxpbnV4L2tlcm5lbC9mb3JrLmMNCkBAIC0z
Niw2ICszNiw3IEBADQogI2luY2x1ZGUgPGxpbnV4L21vdW50Lmg+DQogI2lu
Y2x1ZGUgPGxpbnV4L2F1ZGl0Lmg+DQogI2luY2x1ZGUgPGxpbnV4L3JtYXAu
aD4NCisjaW5jbHVkZSA8bGludXgvcGFnZy5oPg0KIA0KICNpbmNsdWRlIDxh
c20vcGd0YWJsZS5oPg0KICNpbmNsdWRlIDxhc20vcGdhbGxvYy5oPg0KQEAg
LTIzNiw2ICsyMzcsOSBAQA0KIA0KIAlpbml0X3Rhc2sucmxpbVtSTElNSVRf
TlBST0NdLnJsaW1fY3VyID0gbWF4X3RocmVhZHMvMjsNCiAJaW5pdF90YXNr
LnJsaW1bUkxJTUlUX05QUk9DXS5ybGltX21heCA9IG1heF90aHJlYWRzLzI7
DQorDQorCS8qIEluaXRpYWxpemUgdGhlIHBhZ2cgbGlzdCBpbiBwaWQgMCBi
ZWZvcmUgaXQgY2FuIGNsb25lIGl0c2VsZi4gKi8NCisJSU5JVF9QQUdHX0xJ
U1QoY3VycmVudCk7DQogfQ0KIA0KIHN0YXRpYyBzdHJ1Y3QgdGFza19zdHJ1
Y3QgKmR1cF90YXNrX3N0cnVjdChzdHJ1Y3QgdGFza19zdHJ1Y3QgKm9yaWcp
DQpAQCAtMTAyMyw2ICsxMDI3LDEyIEBADQogCXNjaGVkX2ZvcmsocCk7DQog
DQogCS8qDQorCSAqIGNhbGwgcGFnZyBtb2R1bGVzIHRvIHByb3Blcmx5IGF0
dGFjaCBuZXcgcHJvY2VzcyB0byB0aGUgc2FtZQ0KKwkgKiBwcm9jZXNzIGFn
Z3JlZ2F0ZSBjb250YWluZXJzIGFzIHRoZSBwYXJlbnQgcHJvY2Vzcy4NCisJ
ICovDQorCXBhZ2dfYXR0YWNoKHAsIGN1cnJlbnQpOw0KKw0KKwkvKg0KIAkg
KiBPaywgbWFrZSBpdCB2aXNpYmxlIHRvIHRoZSByZXN0IG9mIHRoZSBzeXN0
ZW0uDQogCSAqIFdlIGRvbnQgd2FrZSBpdCB1cCB5ZXQuDQogCSAqLw0KSW5k
ZXg6IGxpbnV4L2tlcm5lbC9wYWdnLmMNCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0NCi0tLSAvZGV2L251bGwNCisrKyBsaW51eC9rZXJuZWwvcGFnZy5jDQpA
QCAtMCwwICsxLDQ3NCBAQA0KKy8qIA0KKyAqIFBBR0cgKFByb2Nlc3MgQWdn
cmVnYXRlcykgaW50ZXJmYWNlDQorICoNCisgKiANCisgKiBDb3B5cmlnaHQg
KGMpIDIwMDAtMjAwNCBTaWxpY29uIEdyYXBoaWNzLCBJbmMuICBBbGwgUmln
aHRzIFJlc2VydmVkLg0KKyAqDQorICogVGhpcyBwcm9ncmFtIGlzIGZyZWUg
c29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2Rp
ZnkNCisgKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFs
IFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KKyAqIHRoZSBGcmVl
IFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhl
IExpY2Vuc2UsIG9yDQorICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIg
dmVyc2lvbi4NCisgKg0KKyAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRl
ZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KKyAqIGJ1
dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBs
aWVkIHdhcnJhbnR5IG9mDQorICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5F
U1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KKyAqIEdO
VSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQor
ICoNCisgKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRo
ZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KKyAqIGFsb25nIHdpdGgg
dGhpcyBwcm9ncmFtOyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3
YXJlDQorICogRm91bmRhdGlvbiwgSW5jLiwgNTkgVGVtcGxlIFBsYWNlLCBT
dWl0ZSAzMzAsIEJvc3RvbiwgTUEgMDIxMTEtMTMwNyBVU0ENCisgKg0KKyAq
IENvbnRhY3QgaW5mb3JtYXRpb246ICBTaWxpY29uIEdyYXBoaWNzLCBJbmMu
LCAxNTAwIENyaXR0ZW5kZW4gTGFuZSwNCisgKiBNb3VudGFpbiBWaWV3LCBD
QSAgOTQwNDMsIG9yOg0KKyAqIA0KKyAqIGh0dHA6Ly93d3cuc2dpLmNvbSAN
CisgKi8NCisNCisjaW5jbHVkZSA8bGludXgvY29uZmlnLmg+DQorI2luY2x1
ZGUgPGxpbnV4L3NsYWIuaD4NCisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4N
CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+DQorI2luY2x1ZGUgPGxpbnV4
L3BhZ2cuaD4NCisjaW5jbHVkZSA8YXNtL3NlbWFwaG9yZS5oPg0KKw0KKy8q
IGxpc3Qgb2YgcGFnZyBob29rIGVudHJpZXMgdGhhdCByZWZlcmVuY2UgdGhl
ICJtb2R1bGUiIGltcGxlbWVudGF0aW9ucyAqLw0KK3N0YXRpYyBMSVNUX0hF
QUQocGFnZ19ob29rX2xpc3QpOw0KK3N0YXRpYyBERUNMQVJFX1JXU0VNKHBh
Z2dfaG9va19saXN0X3NlbSk7DQorDQorDQorLyoqDQorICogcGFnZ19nZXQg
LSBnZXQgYSBwYWdnIGdpdmVuIGEgc2VhcmNoIGtleQ0KKyAqIEB0YXNrOiBX
ZSBleGFtaW5lIHRoZSBwYWdnX2xpc3QgZnJvbSB0aGUgZ2l2ZW4gdGFzaw0K
KyAqIEBrZXk6IEtleSBuYW1lIG9mIHBhZ2cgd2Ugd2lzaCB0byByZXRyaWV2
ZQ0KKyAqDQorICogR2l2ZW4gYSBwYWdnX2xpc3QgbGlzdCBzdHJ1Y3R1cmUs
IHRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4NCisgKiBhIHBvaW50ZXIgdG8g
dGhlIHBhZ2cgc3RydWN0IHRoYXQgbWF0Y2hlcyB0aGUgc2VhcmNoDQorICog
a2V5LiAgSWYgdGhlIGtleSBpcyBub3QgZm91bmQsIHRoZSBmdW5jdGlvbiB3
aWxsIHJldHVybiBOVUxMLg0KKyAqDQorICogVGhlIGNhbGxlciBzaG91bGQg
aG9sZCBhdCBsZWFzdCBhIHJlYWQgbG9jayBvbiB0aGUgcGFnZ19saXN0DQor
ICogZm9yIHRhc2sgdXNpbmcgZG93bl9yZWFkKCZ0YXNrLT5wYWdnX2xpc3Qu
c2VtKS4NCisgKg0KKyAqLw0KK3N0cnVjdCBwYWdnICoNCitwYWdnX2dldChz
dHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2ssIGNoYXIgKmtleSkNCit7DQorCXN0
cnVjdCBwYWdnICpwYWdnOw0KKw0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBh
Z2csICZ0YXNrLT5wYWdnX2xpc3QsIGVudHJ5KSB7DQorCQlpZiAoIXN0cmNt
cChwYWdnLT5ob29rLT5uYW1lLGtleSkpDQorCQkJcmV0dXJuIHBhZ2c7DQor
CX0NCisJcmV0dXJuIE5VTEw7DQorfQ0KKw0KKw0KKy8qKg0KKyAqIHBhZ2df
YWxsb2MgLSBJbnNlcnQgYSBuZXcgcGFnZyBpbiB0byB0aGUgcGFnZ19saXN0
IGZvciBhIHRhc2sNCisgKiBAdGFzazogVGFzayB3ZSB3YW50IHRvIGluc2Vy
dCB0aGUgcGFnZyBpbiB0bw0KKyAqIEBwYWdnX2hvb2s6IFBhZ2cgaG9vayB0
byBhc3NvY2lhdGUgd2l0aCB0aGUgbmV3IHBhZ2cNCisgKg0KKyAqIEdpdmVu
IGEgdGFzayBhbmQgYSBwYWdnIGhvb2ssIHRoaXMgZnVuY3Rpb24gd2lsbCBh
bGxvY2F0ZQ0KKyAqIGEgbmV3IHBhZ2cgc3RydWN0dXJlLCBpbml0aWFsaXpl
IHRoZSBzZXR0aW5ncywgYW5kIGluc2VydCB0aGUgcGFnZyBpbnRvDQorICog
dGhlIHBhZ2dfbGlzdCBmb3IgdGhlIHRhc2suDQorICoNCisgKiBUaGUgY2Fs
bGVyIGZvciB0aGlzIGZ1bmN0aW9uIHNob3VsZCBob2xkIGF0IGxlYXN0IGEg
cmVhZCBsb2NrIG9uIHRoZQ0KKyAqIHBhZ2dfaG9va19saXN0X3NlbSAtIG9y
IGVuc3VyZSB0aGF0IHRoZSBwYWdnIGhvb2sgZW50cnkgY2Fubm90IGJlIA0K
KyAqIHJlbW92ZWQuIElmIHRoaXMgZnVuY3Rpb24gd2FzIGNhbGxlZCBmcm9t
IHRoZSBwYWdnIG1vZHVsZSAodXN1YWxseSB0aGUNCisgKiBjYXNlKSwgdGhl
biB0aGUgY2FsbGVyIG5lZWQgbm90IGhvbGQgdGhpcyBsb2NrLiBUaGUgY2Fs
bGVyIHNob3VsZCBob2xkIA0KKyAqIGEgd3JpdGUgbG9jayBvbiBmb3IgdGhl
IHRhc2tzIHBhZ2dfc2VtLiAgVGhpcyBjYW4gYmUgbG9ja2VkIHVzaW5nIA0K
KyAqIGRvd25fd3JpdGUoJnRhc2stPnBhZ2dfc2VtKQ0KKyAqIA0KKyAqLw0K
K3N0cnVjdCBwYWdnICoNCitwYWdnX2FsbG9jKHN0cnVjdCB0YXNrX3N0cnVj
dCAqdGFzaywgc3RydWN0IHBhZ2dfaG9vayAqcGFnZ19ob29rKQ0KK3sNCisJ
c3RydWN0IHBhZ2cgKnBhZ2c7DQorDQorCXBhZ2cgPSBrbWFsbG9jKHNpemVv
ZihzdHJ1Y3QgcGFnZyksIEdGUF9LRVJORUwpOw0KKwlpZiAoIXBhZ2cpDQor
CQlyZXR1cm4gTlVMTDsNCisNCisJcGFnZy0+aG9vayA9IHBhZ2dfaG9vazsN
CisJcGFnZy0+ZGF0YSA9IE5VTEw7DQorCWF0b21pY19pbmMoJnBhZ2dfaG9v
ay0+cmVmY250KTsgIC8qIEluY3JlYXNlIGhvb2sncyByZWZlcmVuY2UgY291
bnQgKi8NCisJbGlzdF9hZGRfdGFpbCgmcGFnZy0+ZW50cnksICZ0YXNrLT5w
YWdnX2xpc3QpOw0KKwlyZXR1cm4gcGFnZzsNCit9DQorDQorDQorLyoqDQor
ICogcGFnZ19mcmVlIC0gRGVsZXRlIHBhZ2cgZnJvbSB0aGUgbGlzdCBhbmQg
ZnJlZSBpdHMgbWVtb3J5DQorICogQHBhZ2c6IFRoZSBwYWdnIHRvIGZyZWUN
CisgKg0KKyAqIFRoaXMgZnVuY3Rpb24gd2lsbCBlbnN1cmUgdGhlIHBhZ2cg
aXMgZGVsZXRlZCBmb3JtIA0KKyAqIHRoZSBsaXN0IG9mIHBhZ2cgZW50cmll
cyBmb3IgdGhlIHRhc2suIEZpbmFsbHksIHRoZSBtZW1vcnkgZm9yIHRoZSAN
CisgKiBwYWdnIGlzIGRpc2NhcmRlZC4NCisgKg0KKyAqIFRoZSBjYWxsZXIg
b2YgdGhpcyBmdW5jdGlvbiBzaG91bGQgaG9sZCBhIHdyaXRlIGxvY2sgb24g
dGhlIHBhZ2dfc2VtDQorICogZm9yIHRoZSB0YXNrLiBUaGlzIGNhbiBiZSBs
b2NrZWQgdXNpbmcgZG93bl93cml0ZSgmdGFzay0+cGFnZ19zZW0pLg0KKyAq
DQorICogUHJpb3IgdG8gY2FsbGluZyBwYWdnX2ZyZWUsIHRoZSBwYWdnIHNo
b3VsZCBoYXZlIGJlZW4gZGV0YWNoZWQgZnJvbSB0aGUNCisgKiBwYWdnIGNv
bnRhaW5lciByZXByZXNlbnRlZCBieSB0aGlzIHBhZ2cuICBUaGF0IGlzIHVz
dWFsbHkgZG9uZSB1c2luZw0KKyAqIHAtPmhvb2stPmRldGFjaCh0YXNrLCBw
YWdnKTsNCisgKiANCisgKi8NCit2b2lkDQorcGFnZ19mcmVlKHN0cnVjdCBw
YWdnICpwYWdnKSANCit7DQorCWF0b21pY19kZWMoJnBhZ2ctPmhvb2stPnJl
ZmNudCk7IC8qIGRlY3IgdGhlIHJlZmVyZW5jZSBjb3VudCBvbiB0aGUgaG9v
ayAqLw0KKwlsaXN0X2RlbCgmcGFnZy0+ZW50cnkpOw0KKwlrZnJlZShwYWdn
KTsNCit9DQorDQorDQorLyoqDQorICogZ2V0X3BhZ2dfaG9vayAtIEdldCB0
aGUgcGFnZyBob29rIG1hdGNoaW5nIHRoZSByZXF1ZXN0ZWQgbmFtZQ0KKyAq
IEBrZXk6IFRoZSBuYW1lIG9mIHRoZSBwYWdnIGhvb2sgdG8gZ2V0DQorICoN
CisgKiBHaXZlbiBhIHBhZ2cgaG9vayBuYW1lIGtleSwgdGhpcyBmdW5jdGlv
biB3aWxsIHJldHVybiBhIHBvaW50ZXINCisgKiB0byB0aGUgcGFnZ19ob29r
IHN0cnVjdCB0aGF0IG1hdGNoZXMgdGhlIG5hbWUuDQorICogDQorICogWW91
IHNob3VsZCBob2xkIGVpdGhlciB0aGUgd3JpdGUgb3IgcmVhZCBsb2NrIGZv
ciBwYWdnX2hvb2tfbGlzdF9zZW0NCisgKiBiZWZvcmUgdXNpbmcgdGhpcyBm
dW5jdGlvbi4gIFRoaXMgd2lsbCBlbnN1cmUgdGhhdCB0aGUgcGFnZ19ob29r
X2xpc3QNCisgKiBkb2VzIG5vdCBjaGFuZ2Ugd2hpbGUgaXRlcmF0aW5nIHRo
cm91Z2ggdGhlIGxpc3QgZW50cmllcy4NCisgKg0KKyAqLw0KK3N0YXRpYyBz
dHJ1Y3QgcGFnZ19ob29rICoNCitnZXRfcGFnZ19ob29rKGNoYXIgKmtleSkN
Cit7DQorCXN0cnVjdCBwYWdnX2hvb2sgKnBhZ2dfaG9vazsNCisNCisJbGlz
dF9mb3JfZWFjaF9lbnRyeShwYWdnX2hvb2ssICZwYWdnX2hvb2tfbGlzdCwg
ZW50cnkpIHsNCisJCWlmICghc3RyY21wKHBhZ2dfaG9vay0+bmFtZSwga2V5
KSkgew0KKwkJCXJldHVybiBwYWdnX2hvb2s7DQorCQl9DQorCX0NCisJcmV0
dXJuIE5VTEw7DQorfQ0KKw0KKy8qKg0KKyAqIHJlbW92ZV9jbGllbnRfcGFn
Z3NfZnJvbV9hbGxfdGFza3MgLSBSZW1vdmUgYWxsIHBhZ2dzIGFzc29jaWF0
ZWQgd2l0aCBob29rDQorICogQHBocDogUGFnZyBob29rIGFzc29jaWF0ZWQg
d2l0aCBwYWdncyB0byBwdXJnZQ0KKyAqIA0KKyAqIEdpdmVuIGEgcGFnZyBo
b29rLCB0aGlzIGZ1bmN0aW9uIHdpbGwgcmVtb3ZlIGFsbCBwYWdncyBhc3Nv
Y2lhdGVkIHdpdGggdGhhdCANCisgKiBwYWdnIGhvb2sgZnJvbSBhbGwgdGFz
a3MgY2FsbGluZyB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gb24gZWFjaCBwYWdn
Lg0KKyAqIA0KKyAqIElmIHRoZXJlIGlzIGEgZGV0YWNoIGZ1bmN0aW9uIGFz
c29jaWF0ZWQgd2l0aCB0aGUgcGFnZywgaXQgaXMgY2FsbGVkDQorICogYmVm
b3JlIHRoZSBwYWdnIGlzIGZyZWVkLg0KKyAqDQorICogVGhpcyBpcyBtZWFu
dCB0byBiZSB1c2VkIGJ5IHBhZ2dfaG9va19yZWdpc3RlciBhbmQgcGFnZ19o
b29rX3VucmVnaXN0ZXINCisgKg0KKyAqLw0KK3N0YXRpYyB2b2lkDQorcmVt
b3ZlX2NsaWVudF9wYWdnc19mcm9tX2FsbF90YXNrcyhzdHJ1Y3QgcGFnZ19o
b29rICpwaHApDQorew0KKwlpZiAocGhwID09IE5VTEwpDQorCQlyZXR1cm47
DQorDQorCS8qIEJlY2F1c2Ugb2YgaW50ZXJuYWwgcmFjZSBjb25kaXRpb25z
IHdlIGNhbid0IGdhdXJhbnRlZQ0KKwkgKiBnZXR0aW5nIGV2ZXJ5IHRhc2sg
aW4ganVzdCBvbmUgcGFzcyBzbyB3ZSBqdXN0IGtlZXAgZ29pbmcgDQorCSAq
IHVudGlsIHRoZXJlIGFyZSBubyB0YXNrcyB3aXRoIHBhZ2dzIGZyb20gdGhp
cyBob29rIGF0dGFjaGVkLg0KKwkgKiBUaGUgaW5lZmZpY2llbmN5IG9mIHRo
aXMgc2hvdWxkIGJlIHRlbXBlcmVkIGJ5IHRoZSBmYWN0IHRoYXQgdGhpcyAN
CisJICogaGFwcGVucyBhdCBtb3N0IG9uY2UgZm9yIGVhY2ggcmVnaXN0ZXJl
ZCBjbGllbnQuDQorCSAqDQorCSAqIEJlY2F1c2Ugd2UgaG9sZCB0aGUgdGFz
a2xpc3QgbG9jaywgd2UgY2FuJ3QgdXNlIGRvd25fd3JpdGUgb24gYSANCisJ
ICogc2VtYXBob3JlLiAgU28gd2UgdXNlIGRvd25fd3JpdGVfdHJ5bG9jayBh
bmQgZ28gYXJvdW5kIGFnYWluIGlmIA0KKwkgKiB3ZSBmYWlsIHRvIGdldCBh
IGxvY2suLi4NCisJICovDQorCXdoaWxlIChhdG9taWNfcmVhZCgmcGhwLT5y
ZWZjbnQpICE9IDApIHsNCisJCXN0cnVjdCB0YXNrX3N0cnVjdCAqcCA9IE5V
TEw7DQorDQorCQlyZWFkX2xvY2soJnRhc2tsaXN0X2xvY2spOw0KKwkJZm9y
X2VhY2hfcHJvY2VzcyhwKSB7DQorCQkJc3RydWN0IHBhZ2cgKnBhZ2dwOw0K
Kw0KKwkJCS8qIElmIHdlIGZhaWwgdG8gZ2V0IHRoZSBsb2NrLCB3ZSdsbCBq
dXN0IHRyeSBhZ2Fpbi4gIFdlIHJlbHkgb24NCisJCQkgKiB0aGUgcGFnZyBo
b29rIHJlZmVyZW5jZSBjb3VudCB0byBrbm93IHdoZW4gd2UncmUgZG9uZSAq
Lw0KKwkJCWlmIChkb3duX3dyaXRlX3RyeWxvY2soJnAtPnBhZ2dfc2VtKSkg
ew0KKwkJCQlwYWdncCA9IHBhZ2dfZ2V0KHAsIHBocC0+bmFtZSk7DQorCQkJ
CWlmIChwYWdncCAhPSBOVUxMKSB7DQorCQkJCQkodm9pZClwaHAtPmRldGFj
aChwLCBwYWdncCk7DQorCQkJCQlwYWdnX2ZyZWUocGFnZ3ApOw0KKwkJCQl9
DQorCQkJCXVwX3dyaXRlKCZwLT5wYWdnX3NlbSk7DQorCQkJfQ0KKwkJfQ0K
KwkJcmVhZF91bmxvY2soJnRhc2tsaXN0X2xvY2spOw0KKwl9DQorfQ0KKw0K
Ky8qKg0KKyAqIHBhZ2dfaG9va19yZWdpc3RlciAtIFJlZ2lzdGVyIGEgbmV3
IHBhZ2cgaG9vayBhbmQgZW50ZXIgaXQgdGhlIGxpc3QNCisgKiBAcGFnZ19o
b29rX25ldzogVGhlIG5ldyBwYWdnIGhvb2sgdG8gcmVnaXN0ZXINCisgKg0K
KyAqIFVzZWQgdG8gcmVnaXN0ZXIgYSBuZXcgcGFnZyBob29rIGFuZCBlbnRl
ciBpdCBpbnRvIHRoZSBwYWdnX2hvb2tfbGlzdC4NCisgKiBUaGUgc2Vydmlj
ZSBuYW1lIGZvciBhIHBhZ2cgaG9vayBpcyByZXN0cmljdGVkIHRvIDMyIGNo
YXJhY3RlcnMuDQorICoNCisgKiBJZiBhbiAiaW5pdCgpIiBmdW5jdGlvbiBp
cyBzdXBwbGllZCBpbiB0aGUgaG9vayBiZWluZyByZWdpc3RlcmVkIHRoZW4g
YQ0KKyAqIHBhZ2cgd2lsbCBiZSBhdHRhY2hlZCB0byBhbGwgZXhpc3Rpbmcg
dGFza3MgYW5kIHRoZSBzdXBwbGllZCAiaW5pdCgpIg0KKyAqIGZ1bmN0aW9u
IHdpbGwgYmUgYXBwbGllZCB0byBpdC4gIElmIGFueSBjYWxsIHRvIHRoZSBz
dXBwbGllZCAiaW5pdCgpIg0KKyAqIGZ1bmN0aW9uIHJldHVybnMgYSBub24g
emVybyByZXN1bHQgdGhlIHJlZ2lzdHJhdGlvbiB3aWxsIGJlIGFib3J0ZWQu
IEFzDQorICogcGFydCBvZiB0aGUgYWJvcnQgcHJvY2VzcywgYWxsIHBhZ2dz
IGJlbG9uZ2luZyB0byB0aGUgbmV3IGNsaWVudCB3aWxsIGJlDQorICogcmVt
b3ZlZCBmcm9tIGFsbCB0YXNrcyBhbmQgdGhlIHN1cHBsaWVkICJkZXRhY2go
KSIgZnVuY3Rpb24gd2lsbCBiZQ0KKyAqIGNhbGxlZCBvbiB0aGVtLiAgTm90
ZTogVGhlIGluaXQgZnVuY3Rpb24gbXVzdCBub3Qgc2xlZXAuDQorICoNCisg
KiBJZiBhIG1lbW9yeSBlcnJvciBpcyBlbmNvdW50ZXJlZCwgdGhlIHBhZ2cg
aG9vayBpcyB1bnJlZ2lzdGVyZWQgYW5kIGFueQ0KKyAqIHRhc2tzIHRoYXQg
aGF2ZSBiZWVuIGF0dGFjaGVkIHRvIHRoZSBpbml0aWFsIHBhZ2cgY29udGFp
bmVyIGFyZSBkZXRhY2hlZA0KKyAqIGZyb20gdGhhdCBjb250YWluZXIuDQor
ICoNCisgKi8NCitpbnQNCitwYWdnX2hvb2tfcmVnaXN0ZXIoc3RydWN0IHBh
Z2dfaG9vayAqcGFnZ19ob29rX25ldykNCit7DQorCXN0cnVjdCBwYWdnX2hv
b2sgKnBhZ2dfaG9vayA9IE5VTEw7DQorDQorCS8qIEFkZCBuZXcgcGFnZyBt
b2R1bGUgdG8gYWNjZXNzIGxpc3QgKi8NCisJaWYgKCFwYWdnX2hvb2tfbmV3
KQ0KKwkJcmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3IgKi8NCisJaWYgKCFs
aXN0X2VtcHR5KCZwYWdnX2hvb2tfbmV3LT5lbnRyeSkpDQorCQlyZXR1cm4g
LUVJTlZBTDsJCQkvKiBlcnJvciAqLw0KKwlpZiAocGFnZ19ob29rX25ldy0+
bmFtZSA9PSBOVUxMIHx8IHN0cmxlbihwYWdnX2hvb2tfbmV3LT5uYW1lKSA+
IFBBR0dfTkFNRUxOKQ0KKwkJcmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3Ig
Ki8NCisNCisJLyogVHJ5IHRvIGluc2VydCBuZXcgaG9vayBlbnRyeSBpbnRv
IHRoZSBwYWdnIGhvb2sgbGlzdCAqLw0KKwlkb3duX3dyaXRlKCZwYWdnX2hv
b2tfbGlzdF9zZW0pOw0KKw0KKwlwYWdnX2hvb2sgPSBnZXRfcGFnZ19ob29r
KHBhZ2dfaG9va19uZXctPm5hbWUpOw0KKw0KKwlpZiAocGFnZ19ob29rKSB7
DQorCQl1cF93cml0ZSgmcGFnZ19ob29rX2xpc3Rfc2VtKTsNCisJCXByaW50
ayhLRVJOX1dBUk5JTkcgIkF0dGVtcHQgdG8gcmVnaXN0ZXIgZHVwbGljYXRl
Ig0KKwkJCQkiIFBBR0cgc3VwcG9ydCAobmFtZT0lcylcbiIsIHBhZ2dfaG9v
a19uZXctPm5hbWUpOw0KKwkJcmV0dXJuIC1FQlVTWTsNCisJfQ0KKw0KKwkv
KiBPa2F5LCB3ZSBjYW4gaW5zZXJ0IGludG8gdGhlIHBhZ2cgaG9vayBsaXN0
ICovDQorCWxpc3RfYWRkX3RhaWwoJnBhZ2dfaG9va19uZXctPmVudHJ5LCAm
cGFnZ19ob29rX2xpc3QpOw0KKwkvKiBzZXQgdGhlIHJlZiBjb3VudCB0byB6
ZXJvICovDQorCWF0b21pY19zZXQoJnBhZ2dfaG9va19uZXctPnJlZmNudCwg
MCk7DQorDQorCS8qIE5vdyB3ZSBjYW4gY2FsbCB0aGUgaW5pdGlhbGl6ZXIg
ZnVuY3Rpb24gKGlmIHByZXNlbnQpIGZvciBlYWNoIHRhc2sgKi8NCisJaWYg
KHBhZ2dfaG9va19uZXctPmluaXQgIT0gTlVMTCkgew0KKwkJaW50IGluaXRf
cmVzdWx0ID0gMDsNCisJCWludCBkb25lID0gMDsNCisNCisJCS8qIEJlY2F1
c2Ugb2YgaW50ZXJuYWwgcmFjZSBjb25kaXRpb25zIHdlIGNhbid0IGdhdXJh
bnRlZQ0KKwkJICogZ2V0dGluZyBldmVyeSB0YXNrIGluIGp1c3Qgb25lIHBh
c3Mgc28gd2UganVzdCBrZWVwIGdvaW5nDQorCQkgKiB1bnRpbCB3ZSBkb24n
dCBmaW5kIGFueSB1bml0aWFsaXNlZCB0YXNrcy4gIFRoZSBpbmVmZmljaWVu
Y3kNCisJCSAqIG9mIHRoaXMgc2hvdWxkIGJlIHRlbXBlcmVkIGJ5IHRoZSBm
YWN0IHRoYXQgdGhpcyBoYXBwZW5zDQorCQkgKiBhdCBtb3N0IG9uY2UgZm9y
IGVhY2ggcmVnaXN0ZXJlZCBjbGllbnQuDQorCQkgKg0KKwkJICogVG8gYXZv
aWQgaGF2aW5nIHRvIGhhdmUgdGhlIHRhc2tsaXN0IGxvY2tlZCB3aGlsZSB0
cnlpbmcgdG8NCisJCSAqIGFjY2VzcyBzZW1hcGhvcmVzLCB3ZSB1c2Ugd3Jp
dGVfZG93bl90cnlsb2NrIGFuZCBpZiB3ZSBkb24ndA0KKwkJICogZ2V0IGEg
bG9jaywgd2UgbG9vcCBhcm91bmQgYWdhaW4uDQorCQkgKi8NCisJCXdoaWxl
ICghZG9uZSkgew0KKwkJCXN0cnVjdCB0YXNrX3N0cnVjdCAqcCA9IE5VTEw7
DQorDQorDQorCQkJZG9uZSA9IDE7IC8qIGZsYWcgdGhhdCB3ZSdyZSBkb25l
IHVubGVzcyB3ZSBjYW4ndCBnZXQgdGhlIGxvY2sgKi8NCisNCisJCQlyZWFk
X2xvY2soJnRhc2tsaXN0X2xvY2spOw0KKwkJCWZvcl9lYWNoX3Byb2Nlc3Mo
cCkgew0KKwkJCQlzdHJ1Y3QgcGFnZyAqcGFnZ3A7DQorDQorCQkJCS8qIFRy
eSB0aGUgbG9jayAqLw0KKwkJCQlpZiAoZG93bl93cml0ZV90cnlsb2NrKCZw
LT5wYWdnX3NlbSkpIHsNCisJCQkJCXBhZ2dwID0gcGFnZ19nZXQocCwgcGFn
Z19ob29rX25ldy0+bmFtZSk7DQorCQkJCQlpZiAocGFnZ3AgPT0gTlVMTCkg
ew0KKwkJCQkJCXBhZ2dwID0gcGFnZ19hbGxvYyhwLCBwYWdnX2hvb2tfbmV3
KTsNCisJCQkJCQlpZiAocGFnZ3AgIT0gTlVMTCkNCisJCQkJCQkJaW5pdF9y
ZXN1bHQgPSBwYWdnX2hvb2tfbmV3LT5pbml0KHAsIHBhZ2dwKTsNCisJCQkJ
CQllbHNlDQorCQkJCQkJCWluaXRfcmVzdWx0ID0gLUVOT01FTTsNCisJCQkJ
CQlpZiAoaW5pdF9yZXN1bHQgIT0gMCkgew0KKwkJCQkJCQkvKiBpbml0IGZh
aWxlZCBvciBvdXQgb2YgbWVtb3J5IC0gZ2FtZSBvdmVyICovDQorCQkJCQkJ
CWRvbmUgPSAxOw0KKwkJCQkJCQlicmVhazsNCisJCQkJCQl9DQorCQkJCQl9
DQorCQkJCQl1cF93cml0ZSgmcC0+cGFnZ19zZW0pOw0KKwkJCQl9IGVsc2Ug
eyAvKiBXZSBmYWlsZWQgdG8gZ2V0IHRoZSBsb2NrLCBrZWVwIHRyeWluZy4u
LiAqLw0KKwkJCQkJZG9uZSA9IDA7DQorCQkJCX0NCisJCQl9DQorCQkJcmVh
ZF91bmxvY2soJnRhc2tsaXN0X2xvY2spOw0KKwkJfQ0KKw0KKwkJLyoNCisJ
CSAqIGlmIGFueXRoaW5nIHdlbnQgd3JvbmcgZHVyaW5nIGluaXRpYWxpc2F0
aW9uIGFiYW5kb24gdGhlDQorCQkgKiByZWdpc3RyYXRpb24gcHJvY2Vzcw0K
KwkJICovDQorCQlpZiAoaW5pdF9yZXN1bHQgIT0gMCkgew0KKwkJCXJlbW92
ZV9jbGllbnRfcGFnZ3NfZnJvbV9hbGxfdGFza3MocGFnZ19ob29rX25ldyk7
DQorCQkJbGlzdF9kZWxfaW5pdCgmcGFnZ19ob29rX25ldy0+ZW50cnkpOw0K
KwkJCXVwX3dyaXRlKCZwYWdnX2hvb2tfbGlzdF9zZW0pOw0KKw0KKwkJCXBy
aW50ayhLRVJOX1dBUk5JTkcgIlJlZ2lzdGVyaW5nIFBBR0cgc3VwcG9ydCBm
b3IiDQorCQkJCSIgKG5hbWU9JXMpIGZhaWxlZC4gIGVycmNvZGU9JWRcbiIs
IHBhZ2dfaG9va19uZXctPm5hbWUsIGluaXRfcmVzdWx0KTsNCisNCisJCQly
ZXR1cm4gaW5pdF9yZXN1bHQ7DQorCQl9DQorCX0NCisNCisJdXBfd3JpdGUo
JnBhZ2dfaG9va19saXN0X3NlbSk7DQorDQorCXByaW50ayhLRVJOX0lORk8g
IlJlZ2lzdGVyaW5nIFBBR0cgc3VwcG9ydCBmb3IgKG5hbWU9JXMpXG4iLA0K
KwkJCXBhZ2dfaG9va19uZXctPm5hbWUpOw0KKw0KKwlyZXR1cm4gMDsJCQkJ
CS8qIHN1Y2Nlc3MgKi8NCisNCit9DQorDQorLyoqDQorICogcGFnZ19ob29r
X3VucmVnaXN0ZXIgLSBVbnJlZ2lzdGVyIHBhZ2cgaG9vayBhbmQgcmVtb3Zl
IGl0IGZyb20gdGhlIGxpc3QNCisgKiBAcGFnZ19ob29rX29sZDogVGhlIGhv
b2sgdG8gdW5yZWdpc3RlciBhbmQgcmVtb3ZlDQorICoNCisgKiBVc2VkIHRv
IHVucmVnaXN0ZXIgcGFnZyBob29rcyBhbmQgcmVtb3ZlIHRoZW0gZnJvbSB0
aGUgcGFnZ19ob29rX2xpc3QuDQorICogT25jZSB0aGUgcGFnZyBob29rIGVu
dHJ5IGluIHRoZSBwYWdnX2hvb2tfbGlzdCBpcyBmb3VuZCwgcGFnZ3MgYXNz
b2NpYXRlZA0KKyAqIHdpdGggdGhlIGhvb2sgKGlmIGFueSkgd2lsbCBoYXZl
IHRoZWlyIGRldGFjaCBmdW5jdGlvbiBjYWxsZWQgYW5kIHdpbGwNCisgKiBi
ZSBkZXRhY2hlZC4NCisgKiANCisgKi8NCitpbnQNCitwYWdnX2hvb2tfdW5y
ZWdpc3RlcihzdHJ1Y3QgcGFnZ19ob29rICpwYWdnX2hvb2tfb2xkKQ0KK3sN
CisJc3RydWN0IHBhZ2dfaG9vayAqcGFnZ19ob29rOw0KKw0KKwkvKiBDaGVj
ayB0aGUgdmFsaWRpdHkgb2YgdGhlIGFyZ3VtZW50cyAqLw0KKwlpZiAoIXBh
Z2dfaG9va19vbGQpDQorCQlyZXR1cm4gLUVJTlZBTDsJCQkvKiBlcnJvciAq
Lw0KKwlpZiAobGlzdF9lbXB0eSgmcGFnZ19ob29rX29sZC0+ZW50cnkpKQ0K
KwkJcmV0dXJuIC1FSU5WQUw7CQkJLyogZXJyb3IgKi8NCisJaWYgKHBhZ2df
aG9va19vbGQtPm5hbWUgPT0gTlVMTCkNCisJCXJldHVybiAtRUlOVkFMOwkJ
CS8qIGVycm9yICovDQorDQorCWRvd25fd3JpdGUoJnBhZ2dfaG9va19saXN0
X3NlbSk7DQorDQorCXBhZ2dfaG9vayA9IGdldF9wYWdnX2hvb2socGFnZ19o
b29rX29sZC0+bmFtZSk7DQorDQorCWlmIChwYWdnX2hvb2sgJiYgcGFnZ19o
b29rID09IHBhZ2dfaG9va19vbGQpIHsNCisJCXJlbW92ZV9jbGllbnRfcGFn
Z3NfZnJvbV9hbGxfdGFza3MocGFnZ19ob29rKTsNCisJCWxpc3RfZGVsX2lu
aXQoJnBhZ2dfaG9vay0+ZW50cnkpOw0KKwkJdXBfd3JpdGUoJnBhZ2dfaG9v
a19saXN0X3NlbSk7DQorDQorCQlwcmludGsoS0VSTl9JTkZPICJVbnJlZ2lz
dGVyaW5nIFBBR0cgc3VwcG9ydCBmb3IiDQorCQkJCSIgKG5hbWU9JXMpXG4i
LCBwYWdnX2hvb2tfb2xkLT5uYW1lKTsNCisNCisJCXJldHVybiAwOwkJCS8q
IHN1Y2Nlc3MgKi8NCisJfQ0KKw0KKwl1cF93cml0ZSgmcGFnZ19ob29rX2xp
c3Rfc2VtKTsNCisNCisJcHJpbnRrKEtFUk5fV0FSTklORyAiQXR0ZW1wdCB0
byB1bnJlZ2lzdGVyIFBBR0cgc3VwcG9ydCAobmFtZT0lcykiDQorCQkJIiBm
YWlsZWQgLSBub3QgZm91bmRcbiIsIHBhZ2dfaG9va19vbGQtPm5hbWUpOw0K
KwkNCisJcmV0dXJuIC1FSU5WQUw7CQkJCS8qIGVycm9yICovDQorfQ0KKw0K
Kw0KKy8qKg0KKyAqIF9fcGFnZ19hdHRhY2ggLSBBdHRhY2ggYSBuZXcgdGFz
ayB0byB0aGUgc2FtZSBjb250YWluZXJzIG9mIGl0cyBwYXJlbnQNCisgKiBA
dG9fdGFzazogVGhlIGNoaWxkIHRhc2sgdGhhdCB3aWxsIGluaGVyaXQgdGhl
IHBhcmVudCdzIGNvbnRhaW5lcnMNCisgKiBAZnJvbV90YXNrOiBUaGUgcGFy
ZW50IHRhc2sgDQorICoNCisgKiBVc2VkIHRvIGF0dGFjaCBhIG5ldyB0YXNr
IHRvIHRoZSBzYW1lIHBhZ2cgY29udGFpbmVycyB0byB3aGljaCBpdCdzIHBh
cmVudA0KKyAqIGlzIGF0dGFjaGVkLg0KKyAqDQorICogVGhlICJmcm9tIiBh
cmd1bWVudCBpcyB0aGUgcGFyZW50IHRhc2suICBUaGUgInRvIiBhcmd1bWVu
dCBpcyB0aGUgY2hpbGQNCisgKiB0YXNrLiANCisgKg0KKyAqLw0KK3ZvaWQg
DQorX19wYWdnX2F0dGFjaChzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRvX3Rhc2ss
IHN0cnVjdCB0YXNrX3N0cnVjdCAqZnJvbV90YXNrKQ0KK3sNCisJc3RydWN0
IHBhZ2cgKmZyb21fcGFnZzsNCisNCisJLyogbG9jayB0aGUgcGFyZW50cyBw
YWdnX2xpc3Qgd2UgYXJlIGNvcHlpbmcgZnJvbSAqLw0KKwlkb3duX3JlYWQo
JmZyb21fdGFzay0+cGFnZ19zZW0pOyAvKiByZWFkIGxvY2sgdGhlIHBhZ2cg
bGlzdCAqLw0KKw0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGZyb21fcGFnZywg
JmZyb21fdGFzay0+cGFnZ19saXN0LCBlbnRyeSkgew0KKwkJc3RydWN0IHBh
Z2cgKnRvX3BhZ2cgPSBOVUxMOw0KKw0KKwkJdG9fcGFnZyA9IHBhZ2dfYWxs
b2ModG9fdGFzaywgZnJvbV9wYWdnLT5ob29rKTsNCisJCWlmICghdG9fcGFn
Zykgew0KKwkJCWdvdG8gZXJyb3JfcmV0dXJuOw0KKwkJfQ0KKwkJaWYgKHRv
X3BhZ2ctPmhvb2stPmF0dGFjaCh0b190YXNrLCB0b19wYWdnLCBmcm9tX3Bh
Z2ctPmRhdGEpICE9IDAgKSANCisJCQlnb3RvIGVycm9yX3JldHVybjsNCisJ
fQ0KKw0KKwl1cF9yZWFkKCZmcm9tX3Rhc2stPnBhZ2dfc2VtKTsgLyogdW5s
b2NrIHRoZSBwYWdnIGxpc3QgKi8NCisNCisJcmV0dXJuOwkJCQkJLyogc3Vj
Y2VzcyAqLw0KKw0KKyAgZXJyb3JfcmV0dXJuOg0KKwkvKiANCisJICogQ2xl
YW4gdXAgYWxsIHRoZSBwYWdnIGF0dGFjaG1lbnRzIG1hZGUgb24gYmVoYWxm
IG9mIHRoZSBuZXcNCisJICogdGFzay4gIFNldCBuZXcgdGFzayBwYWdnIHB0
ciB0byBOVUxMIGZvciByZXR1cm4uDQorCSAqLw0KKwl1cF9yZWFkKCZmcm9t
X3Rhc2stPnBhZ2dfc2VtKTsgLyogdW5sb2NrIHRoZSBwYWdnIGxpc3QgKi8N
CisJX19wYWdnX2RldGFjaCh0b190YXNrKTsNCisJcmV0dXJuOwkJCQkvKiBm
YWlsdXJlICovDQorfQ0KKw0KKy8qKg0KKyAqIF9fcGFnZ19kZXRhY2ggLSBE
ZXRhY2ggYSB0YXNrIGZyb20gYWxsIHBhZ2cgY29udGFpbmVycyBpdCBpcyBh
dHRhY2hlZCB0bw0KKyAqIEB0YXNrOiBUYXNrIHRvIGRldGFjaCBmcm9tIHBh
Z2cgY29udGFpbmVycw0KKyAqDQorICogVXNlZCB0byBkZXRhY2ggYSB0YXNr
IGZyb20gYWxsIHBhZ2cgY29udGFpbmVycyB0byB3aGljaCBpdCBpcyBhdHRh
Y2hlZC4NCisgKiANCisgKi8NCit2b2lkIA0KK19fcGFnZ19kZXRhY2goc3Ry
dWN0IHRhc2tfc3RydWN0ICp0YXNrKQ0KK3sNCisJc3RydWN0IHBhZ2cgKnBh
Z2c7DQorCXN0cnVjdCBwYWdnICpwYWdndG1wOw0KKw0KKwkvKiBSZW1vdmUg
cmVmLiB0byBwYWdncyBmcm9tIHRhc2sgaW1tZWRpYXRlbHkgKi8NCisJZG93
bl93cml0ZSgmdGFzay0+cGFnZ19zZW0pOyAvKiB3cml0ZSBsb2NrIHBhZ2cg
bGlzdCAqLw0KKw0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocGFnZywg
cGFnZ3RtcCwgJnRhc2stPnBhZ2dfbGlzdCwgZW50cnkpIHsNCisJCXBhZ2ct
Pmhvb2stPmRldGFjaCh0YXNrLCBwYWdnKTsNCisJCXBhZ2dfZnJlZShwYWdn
KTsNCisJfQ0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
DQorCXVwX3dyaXRlKCZ0YXNrLT5wYWdnX3NlbSk7IC8qIHdyaXRlIHVubG9j
ayB0aGUgcGFnZyBsaXN0ICovDQorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICANCisJcmV0dXJuOyAgIC8qIDAgPSBzdWNjZXNzLCBlbHNl
IHJldHVybiBsYXN0IGNvZGUgZm9yIGZhaWx1cmUgKi8NCit9DQorDQorDQor
LyoqDQorICogX19wYWdnX2V4ZWMgLSBFeGVjdXRlIGNhbGxiYWNrIHdoZW4g
YSBwcm9jZXNzIGluIGEgY29udGFpbmVyIGV4ZWNzDQorICogQHRhc2s6IFdl
IGdvIHRocm91Z2ggdGhlIHBhZ2cgbGlzdCBpbiB0aGUgZ2l2ZW4gdGFzaw0K
KyAqDQorICogVXNlZCB0byB3aGVuIGEgcHJvY2VzcyB0aGF0IGlzIGluIGEg
cGFnZyBjb250YWluZXIgZG9lcyBhbiBleGVjLg0KKyAqDQorICogVGhlICJm
cm9tIiBhcmd1bWVudCBpcyB0aGUgdGFzay4gIFRoZSAibmFtZSIgYXJndW1l
bnQgaXMgdGhlIG5hbWUNCisgKiBvZiB0aGUgcHJvY2VzcyBiZWluZyBleGVj
J2VkLg0KKyAqDQorICovDQoraW50IA0KK19fcGFnZ19leGVjKHN0cnVjdCB0
YXNrX3N0cnVjdCAqdGFzaykgDQorew0KKwlzdHJ1Y3QgcGFnZwkqcGFnZzsN
CisNCisJLyogbG9jayB0aGUgcGFyZW50cyBwYWdnX2xpc3Qgd2UgYXJlIGNv
cHlpbmcgZnJvbSAqLw0KKwlkb3duX3JlYWQoJnRhc2stPnBhZ2dfc2VtKTsg
LyogbG9jayB0aGUgcGFnZyBsaXN0ICovDQorDQorCWxpc3RfZm9yX2VhY2hf
ZW50cnkocGFnZywgJnRhc2stPnBhZ2dfbGlzdCwgZW50cnkpIHsNCisJCWlm
IChwYWdnLT5ob29rLT5leGVjKSAvKiBjb25kaXRpb25hbCBiZWNhdXNlIGl0
J3Mgb3B0aW9uYWwgKi8NCisJCQlwYWdnLT5ob29rLT5leGVjKHRhc2ssIHBh
Z2cpOw0KKwl9DQorDQorCXVwX3JlYWQoJnRhc2stPnBhZ2dfc2VtKTsgLyog
dW5sb2NrIHRoZSBwYWdnIGxpc3QgKi8NCisJcmV0dXJuIDA7DQorfQ0KKw0K
Kw0KK0VYUE9SVF9TWU1CT0wocGFnZ19nZXQpOw0KK0VYUE9SVF9TWU1CT0wo
cGFnZ19hbGxvYyk7DQorRVhQT1JUX1NZTUJPTChwYWdnX2ZyZWUpOw0KK0VY
UE9SVF9TWU1CT0wocGFnZ19ob29rX3JlZ2lzdGVyKTsNCitFWFBPUlRfU1lN
Qk9MKHBhZ2dfaG9va191bnJlZ2lzdGVyKTsNCg==

---2136806248-1308750959-1088100536=:340142--
