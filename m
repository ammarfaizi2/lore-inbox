Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S265466AbUALPcD (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 12 Jan 2004 10:32:03 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S265539AbUALPcD
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 12 Jan 2004 10:32:03 -0500
Received: from ns.suse.de ([195.135.220.2]:43217 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S265466AbUALPb6 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 12 Jan 2004 10:31:58 -0500
Date: Mon, 12 Jan 2004 16:31:54 +0100
Message-ID: <s5hu131b2tx.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Rene Herman <rene.herman@keyaccess.nl>
Cc: Santiago Garcia Mantinan <manty@manty.net>, linux-kernel@vger.kernel.org,
       Adam Belay <ambx1@neo.rr.com>
Subject: Re: ALSA in 2.6 failing to find the OPL chip of the sb cards
In-Reply-To: <3FFFA8C3.6040609@keyaccess.nl>
References: <20040107212916.GA978@man.manty.net>
	<s5hy8sixsor.wl@alsa2.suse.de>
	<20040109171715.GA933@man.manty.net>
	<s5hn08xgh06.wl@alsa2.suse.de>
	<20040109201423.GA1677@man.manty.net>
	<3FFFA8C3.6040609@keyaccess.nl>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: multipart/mixed;
 boundary="Multipart_Mon_Jan_12_16:31:54_2004-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--Multipart_Mon_Jan_12_16:31:54_2004-1
Content-Type: text/plain; charset=US-ASCII

At Sat, 10 Jan 2004 08:24:51 +0100,
Rene Herman wrote:
> 
> That is, the driver doesn't complain anymore. Still didn't see the OPL 
> appear in /proc/ioports though (loading with fm_port=0x388 doesn't 
> change that). Haven't investigated further yet, will do.

it's a bug.  the attached patch should fix it.


--
Takashi Iwai <tiwai@suse.de>		ALSA Developer - www.alsa-project.org

--Multipart_Mon_Jan_12_16:31:54_2004-1
Content-Type: text/plain; charset=US-ASCII

--- linux/sound/isa/sb/sb16.c	30 Oct 2003 14:19:30 -0000	1.31
+++ linux/sound/isa/sb/sb16.c	12 Jan 2004 15:30:04 -0000
@@ -483,7 +483,7 @@
 	if (fm_port[dev] > 0 && fm_port[dev] != SNDRV_AUTO_PORT) {
 		if (snd_opl3_create(card, fm_port[dev], fm_port[dev] + 2,
 				    OPL3_HW_OPL3,
-				    fm_port[dev] == port[dev] || fm_port[dev] == 0x388,
+				    acard->fm_res != NULL,
 				    &opl3) < 0) {
 			snd_printk(KERN_ERR PFX "no OPL device at 0x%lx-0x%lx\n",
 				   fm_port[dev], fm_port[dev] + 2);


--Multipart_Mon_Jan_12_16:31:54_2004-1--
