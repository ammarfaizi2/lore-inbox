Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262210AbVC2MPl@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262210AbVC2MPl (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 29 Mar 2005 07:15:41 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262234AbVC2MPk
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 29 Mar 2005 07:15:40 -0500
Received: from ns2.suse.de ([195.135.220.15]:46827 "EHLO mx2.suse.de")
	by vger.kernel.org with ESMTP id S262210AbVC2MMT (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 29 Mar 2005 07:12:19 -0500
Date: Tue, 29 Mar 2005 14:12:10 +0200
Message-ID: <s5hy8c6irc5.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Cc: Lee Revell <rlrevell@joe-job.com>,
       Linux Kernel list <linux-kernel@vger.kernel.org>
Subject: Re: Mac mini sound woes
In-Reply-To: <1112094290.6577.19.camel@gaston>
References: <1111966920.5409.27.camel@gaston>
	<1112067369.19014.24.camel@mindpipe>
	<s5h8y46kbx7.wl@alsa2.suse.de>
	<1112094290.6577.19.camel@gaston>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Tue, 29 Mar 2005 21:04:50 +1000,
Benjamin Herrenschmidt wrote:
> 
> 
> > Yes.
> > 
> > > dmix has been around for a while but softvol plugin is very new, you
> > > will need ALSA CVS or the upcoming 1.0.9 release.
> > 
> > dmix currently doesn't work on PPC well but I'll fix it soon later.
> > If it's confirmed to work, we can set dmix/softvol plugins for default
> > of snd-powermac driver configuration.  Hopefully this will be finished
> > before 1.0.9 final.
> 
> Can the driver advertize in some way what it can do ? depending on the
> machine we are running on, it will or will not be able to do HW volume
> control... You probably don't want to use softvol in the former case...

Add the following to ~/.asoundrc (or /etc/asound.conf for systemwise)

	pcm.softvol {
		type softvol
		slave.pcm {
			type hw
			card 0
			device 0
		}
		control {
			name "PCM Playback Volume"
			card 0
		}
	}

Then you can use the PCM "softvol", e.g.

	% aplay -Dsoftvol foo.wav

This will create "PCM" volume control if it doesn't exist, and do
volume attenuation in software.  If the control already exists (in the
driver), the software volume is skipped automatically.
The newly created volume can be saved/restored via alsactl.

In addition, you can override the ALSA default PCM by defining
~/.asound like:

	pcm.!default "softvol"

> dmix by default would be nice though :)

Yeah, in future version, they will be set as default, i.e. without
extra definition of ~/.asoundrc.


Takashi
