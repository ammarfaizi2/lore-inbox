Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S280762AbRKTJ0p>; Tue, 20 Nov 2001 04:26:45 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S280932AbRKTJ0h>; Tue, 20 Nov 2001 04:26:37 -0500
Received: from noc1.BelWue.de ([129.143.2.1]:64464 "EHLO noc1.BelWue.DE")
	by vger.kernel.org with ESMTP id <S280762AbRKTJ0T>;
	Tue, 20 Nov 2001 04:26:19 -0500
From: Birger Lammering <b.lammering@science-computing.de>
Message-ID: <15354.8629.369917.59211@stderr.science-computing.de>
Date: Tue, 20 Nov 2001 10:26:13 +0100
To: trond.myklebust@fys.uio.no
CC: linux-kernel@vger.kernel.org, kuznet@ms2.inr.ac.ru
Subject: more tcpdumpinfo for nfs3 problem: aix-server --- linux 2.4.15pre5 client
In-Reply-To: <15353.19920.461805.879956@charged.uio.no>
In-Reply-To: <15352.56551.709659.146271@stderr.science-computing.de>
	<E165mPr-0006F5-00@the-village.bc.nu>
	<15353.13652.591045.916300@stderr.science-computing.de>
	<15353.19920.461805.879956@charged.uio.no>
X-Mailer: VM 6.89 under 21.1 (patch 14) "Cuyahoga Valley" XEmacs Lucid
Mime-Version: 1.0 (generated by tm-edit 1.7)
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Trond,

sorry to disappoint you: the patch didn't work for me :-(

I've commented out the two lines in net/sunrpc/xprt.c of 2.4.15pre5.
(Has there been a change in pre6 that might make a difference?)

The result (copying 500k twice from capc25 to caes04):

tcpdump on capc25 (Linux 2.4.15pre5 with sock_writeable patch)
09:59:08.243965 eth0 > capc25.muc.33882112 > caes04.muc.nfs: 40 null (DF)
09:59:08.244500 eth0 < caes04.muc.nfs > capc25.muc.33882112: reply ok 24 null
09:59:08.244533 eth0 > capc25.muc.1022 > caes04.muc.sunrpc: udp 84 (DF)
09:59:08.245271 eth0 < caes04.muc.sunrpc > capc25.muc.1022: udp 28
09:59:31.841577 eth0 > capc25.muc.798 > caes04.muc.nfs: P 1035886130:1035886266(136) ack 1814843210 win 7504 (DF)
09:59:31.843105 eth0 < caes04.muc.nfs > capc25.muc.798: P 1:245(244) ack 136 win 60032
09:59:31.843118 eth0 > capc25.muc.798 > caes04.muc.nfs: . 136:136(0) ack 245 win 8576 (DF)
09:59:31.843160 eth0 > capc25.muc.798 > caes04.muc.nfs: P 136:300(164) ack 245 win 8576 (DF)
09:59:31.850179 eth0 < caes04.muc.nfs > capc25.muc.798: P 245:393(148) ack 300 win 60032
09:59:31.850373 eth0 > capc25.muc.798 > caes04.muc.nfs: . 300:1760(1460) ack 393 win 8576 (DF)
09:59:31.850387 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1760:3220(1460) ack 393 win 8576 (DF)
09:59:31.864330 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 3220 win 57112
09:59:31.864360 eth0 > capc25.muc.798 > caes04.muc.nfs: . 3220:4680(1460) ack 393 win 8576 (DF)
09:59:31.864370 eth0 > capc25.muc.798 > caes04.muc.nfs: . 4680:6140(1460) ack 393 win 8576 (DF)
09:59:31.864379 eth0 > capc25.muc.798 > caes04.muc.nfs: . 6140:7600(1460) ack 393 win 8576 (DF)
09:59:32.064719 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 7600 win 52732
09:59:32.064732 eth0 > capc25.muc.798 > caes04.muc.nfs: . 7600:9060(1460) ack 393 win 8576 (DF)
09:59:32.064741 eth0 > capc25.muc.798 > caes04.muc.nfs: . 9060:10520(1460) ack 393 win 8576 (DF)
09:59:32.064750 eth0 > capc25.muc.798 > caes04.muc.nfs: . 10520:11980(1460) ack 393 win 8576 (DF)
09:59:32.064760 eth0 > capc25.muc.798 > caes04.muc.nfs: P 11980:13440(1460) ack 393 win 8576 (DF)
09:59:32.265178 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 13440 win 46892
09:59:32.265205 eth0 > capc25.muc.798 > caes04.muc.nfs: . 13440:14900(1460) ack 393 win 8576 (DF)
09:59:32.265215 eth0 > capc25.muc.798 > caes04.muc.nfs: P 14900:16360(1460) ack 393 win 8576 (DF)
09:59:32.265225 eth0 > capc25.muc.798 > caes04.muc.nfs: . 16360:17820(1460) ack 393 win 8576 (DF)
09:59:32.265234 eth0 > capc25.muc.798 > caes04.muc.nfs: . 17820:19280(1460) ack 393 win 8576 (DF)
09:59:32.265244 eth0 > capc25.muc.798 > caes04.muc.nfs: P 19280:20740(1460) ack 393 win 8576 (DF)
09:59:32.465675 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 20740 win 39592
09:59:32.465686 eth0 > capc25.muc.798 > caes04.muc.nfs: . 20740:22200(1460) ack 393 win 8576 (DF)
09:59:32.465693 eth0 > capc25.muc.798 > caes04.muc.nfs: . 22200:23660(1460) ack 393 win 8576 (DF)
09:59:32.465702 eth0 > capc25.muc.798 > caes04.muc.nfs: . 23660:25120(1460) ack 393 win 8576 (DF)
09:59:32.465710 eth0 > capc25.muc.798 > caes04.muc.nfs: P 25120:26580(1460) ack 393 win 8576 (DF)
09:59:32.465725 eth0 > capc25.muc.798 > caes04.muc.nfs: . 26580:28040(1460) ack 393 win 8576 (DF)
09:59:32.465736 eth0 > capc25.muc.798 > caes04.muc.nfs: . 28040:29500(1460) ack 393 win 8576 (DF)
09:59:32.667194 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 29500 win 30832
09:59:32.667209 eth0 > capc25.muc.798 > caes04.muc.nfs: . 29500:30960(1460) ack 393 win 8576 (DF)
09:59:32.667218 eth0 > capc25.muc.798 > caes04.muc.nfs: . 30960:32420(1460) ack 393 win 8576 (DF)
09:59:32.667227 eth0 > capc25.muc.798 > caes04.muc.nfs: . 32420:33880(1460) ack 393 win 8576 (DF)
09:59:32.667236 eth0 > capc25.muc.798 > caes04.muc.nfs: . 33880:35340(1460) ack 393 win 8576 (DF)
09:59:32.667248 eth0 > capc25.muc.798 > caes04.muc.nfs: . 35340:36800(1460) ack 393 win 8576 (DF)
09:59:32.667257 eth0 > capc25.muc.798 > caes04.muc.nfs: P 36800:38260(1460) ack 393 win 8576 (DF)
09:59:32.667277 eth0 > capc25.muc.798 > caes04.muc.nfs: . 38260:39720(1460) ack 393 win 8576 (DF)
09:59:32.668855 eth0 < caes04.muc.nfs > capc25.muc.798: . 393:393(0) ack 33880 win 59368
09:59:32.668864 eth0 > capc25.muc.798 > caes04.muc.nfs: . 39720:41180(1460) ack 393 win 8576 (DF)
09:59:32.668872 eth0 > capc25.muc.798 > caes04.muc.nfs: . 41180:42640(1460) ack 393 win 8576 (DF)
09:59:32.668880 eth0 > capc25.muc.798 > caes04.muc.nfs: . 42640:44100(1460) ack 393 win 8576 (DF)
09:59:32.668888 eth0 > capc25.muc.798 > caes04.muc.nfs: . 44100:45560(1460) ack 393 win 8576 (DF)
09:59:32.669337 eth0 < caes04.muc.nfs > capc25.muc.798: P 393:557(164) ack 36800 win 56448
09:59:32.669350 eth0 > capc25.muc.798 > caes04.muc.nfs: . 45560:47020(1460) ack 557 win 8576 (DF)
09:59:32.669357 eth0 > capc25.muc.798 > caes04.muc.nfs: . 47020:48480(1460) ack 557 win 8576 (DF)
09:59:32.669365 eth0 > capc25.muc.798 > caes04.muc.nfs: P 48480:49940(1460) ack 557 win 8576 (DF)
09:59:32.867633 eth0 < caes04.muc.nfs > capc25.muc.798: . 557:557(0) ack 49940 win 43308
09:59:32.867668 eth0 > capc25.muc.798 > caes04.muc.nfs: . 49940:51400(1460) ack 557 win 8576 (DF)
09:59:32.867678 eth0 > capc25.muc.798 > caes04.muc.nfs: . 51400:52860(1460) ack 557 win 8576 (DF)
09:59:32.867687 eth0 > capc25.muc.798 > caes04.muc.nfs: P 52860:54320(1460) ack 557 win 8576 (DF)
09:59:32.867696 eth0 > capc25.muc.798 > caes04.muc.nfs: . 54320:55780(1460) ack 557 win 8576 (DF)
09:59:32.867707 eth0 > capc25.muc.798 > caes04.muc.nfs: P 55780:57240(1460) ack 557 win 8576 (DF)
09:59:32.867733 eth0 > capc25.muc.798 > caes04.muc.nfs: . 57240:58700(1460) ack 557 win 8576 (DF)
09:59:32.867745 eth0 > capc25.muc.798 > caes04.muc.nfs: . 58700:60160(1460) ack 557 win 8576 (DF)
09:59:32.867758 eth0 > capc25.muc.798 > caes04.muc.nfs: . 60160:61620(1460) ack 557 win 8576 (DF)
09:59:32.867772 eth0 > capc25.muc.798 > caes04.muc.nfs: . 61620:63080(1460) ack 557 win 8576 (DF)
09:59:32.867781 eth0 > capc25.muc.798 > caes04.muc.nfs: . 63080:64540(1460) ack 557 win 8576 (DF)
.. and so on..
09:59:33.507567 eth0 < caes04.muc.nfs > capc25.muc.798: . 2525:2525(0) ack 462188 win 58968
09:59:33.507587 eth0 > capc25.muc.798 > caes04.muc.nfs: . 478248:479708(1460) ack 2525 win 8576 (DF)
09:59:33.507595 eth0 > capc25.muc.798 > caes04.muc.nfs: . 479708:481168(1460) ack 2525 win 8576 (DF)
09:59:33.507604 eth0 > capc25.muc.798 > caes04.muc.nfs: . 481168:482628(1460) ack 2525 win 8576 (DF)
09:59:33.507613 eth0 > capc25.muc.798 > caes04.muc.nfs: . 482628:484088(1460) ack 2525 win 8576 (DF)
09:59:33.507621 eth0 > capc25.muc.798 > caes04.muc.nfs: . 484088:485548(1460) ack 2525 win 8576 (DF)
09:59:33.507632 eth0 > capc25.muc.798 > caes04.muc.nfs: . 485548:487008(1460) ack 2525 win 8576 (DF)
09:59:33.507644 eth0 > capc25.muc.798 > caes04.muc.nfs: . 487008:488468(1460) ack 2525 win 8576 (DF)
09:59:33.507654 eth0 > capc25.muc.798 > caes04.muc.nfs: . 488468:489928(1460) ack 2525 win 8576 (DF)
09:59:33.507661 eth0 > capc25.muc.798 > caes04.muc.nfs: P 489928:491388(1460) ack 2525 win 8576 (DF)
09:59:33.507672 eth0 > capc25.muc.798 > caes04.muc.nfs: . 491388:492848(1460) ack 2525 win 8576 (DF)
09:59:33.507682 eth0 > capc25.muc.798 > caes04.muc.nfs: P 492848:494040(1192) ack 2525 win 8576 (DF)
09:59:33.507863 eth0 < caes04.muc.nfs > capc25.muc.798: P 2525:2689(164) ack 466568 win 54588
09:59:33.510198 eth0 < caes04.muc.nfs > capc25.muc.798: . 2689:2689(0) ack 494040 win 60032
09:59:33.510770 eth0 < caes04.muc.nfs > capc25.muc.798: P 2689:2853(164) ack 494040 win 60032
09:59:33.510827 eth0 > capc25.muc.798 > caes04.muc.nfs: . 494040:495500(1460) ack 2853 win 8576 (DF)
09:59:33.510838 eth0 > capc25.muc.798 > caes04.muc.nfs: . 495500:496960(1460) ack 2853 win 8576 (DF)
09:59:33.510850 eth0 > capc25.muc.798 > caes04.muc.nfs: . 496960:498420(1460) ack 2853 win 8576 (DF)
09:59:33.510860 eth0 > capc25.muc.798 > caes04.muc.nfs: . 498420:499880(1460) ack 2853 win 8576 (DF)
09:59:33.510875 eth0 > capc25.muc.798 > caes04.muc.nfs: . 499880:501340(1460) ack 2853 win 8576 (DF)
09:59:33.510886 eth0 > capc25.muc.798 > caes04.muc.nfs: . 501340:502800(1460) ack 2853 win 8576 (DF)
09:59:33.510895 eth0 > capc25.muc.798 > caes04.muc.nfs: . 502800:504260(1460) ack 2853 win 8576 (DF)
09:59:33.510905 eth0 > capc25.muc.798 > caes04.muc.nfs: . 504260:505720(1460) ack 2853 win 8576 (DF)
09:59:33.510916 eth0 > capc25.muc.798 > caes04.muc.nfs: . 505720:507180(1460) ack 2853 win 8576 (DF)
09:59:33.510925 eth0 > capc25.muc.798 > caes04.muc.nfs: . 507180:508640(1460) ack 2853 win 8576 (DF)
09:59:33.510935 eth0 > capc25.muc.798 > caes04.muc.nfs: . 508640:510100(1460) ack 2853 win 8576 (DF)
09:59:33.510946 eth0 > capc25.muc.798 > caes04.muc.nfs: . 510100:511560(1460) ack 2853 win 8576 (DF)
09:59:33.510955 eth0 > capc25.muc.798 > caes04.muc.nfs: . 511560:513020(1460) ack 2853 win 8576 (DF)
09:59:33.510965 eth0 > capc25.muc.798 > caes04.muc.nfs: . 513020:514480(1460) ack 2853 win 8576 (DF)
09:59:33.510977 eth0 > capc25.muc.798 > caes04.muc.nfs: P 514480:514668(188) ack 2853 win 8576 (DF)
09:59:33.513913 eth0 < caes04.muc.nfs > capc25.muc.798: . 2853:2853(0) ack 514668 win 60032
09:59:33.514296 eth0 < caes04.muc.nfs > capc25.muc.798: P 2853:3017(164) ack 514668 win 60032
09:59:33.514361 eth0 > capc25.muc.798 > caes04.muc.nfs: P 514668:514808(140) ack 3017 win 8576 (DF)
09:59:33.628254 eth0 < caes04.muc.nfs > capc25.muc.798: P 3017:3173(156) ack 514808 win 60032
09:59:33.665083 eth0 > capc25.muc.798 > caes04.muc.nfs: . 514808:514808(0) ack 3173 win 8576 (DF)
09:59:38.625495 eth0 > capc25.muc.839188480 > caes04.muc.nfs: 40 null (DF)
09:59:38.625997 eth0 < caes04.muc.nfs > capc25.muc.839188480: reply ok 24 null
09:59:49.583361 eth0 > capc25.muc.798 > caes04.muc.nfs: P 514808:514936(128) ack 3173 win 8576 (DF)
09:59:49.584108 eth0 < caes04.muc.nfs > capc25.muc.798: P 3173:3289(116) ack 514936 win 60032
09:59:49.584123 eth0 > capc25.muc.798 > caes04.muc.nfs: . 514936:514936(0) ack 3289 win 8576 (DF)
09:59:49.586188 eth0 > capc25.muc.798 > caes04.muc.nfs: P 514936:515072(136) ack 3289 win 8576 (DF)
09:59:49.586917 eth0 < caes04.muc.nfs > capc25.muc.798: P 3289:3533(244) ack 515072 win 60032
09:59:49.625793 eth0 > capc25.muc.798 > caes04.muc.nfs: . 515072:515072(0) ack 3533 win 8576 (DF)
09:59:52.567700 eth0 > capc25.muc.798 > caes04.muc.nfs: P 515072:515208(136) ack 3533 win 8576 (DF)
09:59:52.568477 eth0 < caes04.muc.nfs > capc25.muc.798: P 3533:3777(244) ack 515208 win 60032
09:59:52.568491 eth0 > capc25.muc.798 > caes04.muc.nfs: . 515208:515208(0) ack 3777 win 8576 (DF)
09:59:52.568530 eth0 > capc25.muc.798 > caes04.muc.nfs: P 515208:515372(164) ack 3777 win 8576 (DF)
09:59:52.584532 eth0 < caes04.muc.nfs > capc25.muc.798: P 3777:3925(148) ack 515372 win 60032
09:59:52.584767 eth0 > capc25.muc.798 > caes04.muc.nfs: . 515372:516832(1460) ack 3925 win 8576 (DF)
09:59:52.584781 eth0 > capc25.muc.798 > caes04.muc.nfs: . 516832:518292(1460) ack 3925 win 8576 (DF)
09:59:52.745784 eth0 < caes04.muc.nfs > capc25.muc.798: . 3925:3925(0) ack 518292 win 57112
09:59:52.745809 eth0 > capc25.muc.798 > caes04.muc.nfs: . 518292:519752(1460) ack 3925 win 8576 (DF)
09:59:52.745820 eth0 > capc25.muc.798 > caes04.muc.nfs: . 519752:521212(1460) ack 3925 win 8576 (DF)
09:59:52.745829 eth0 > capc25.muc.798 > caes04.muc.nfs: . 521212:522672(1460) ack 3925 win 8576 (DF)
09:59:52.946195 eth0 < caes04.muc.nfs > capc25.muc.798: . 3925:3925(0) ack 522672 win 52732
09:59:52.946209 eth0 > capc25.muc.798 > caes04.muc.nfs: . 522672:524132(1460) ack 3925 win 8576 (DF)
09:59:52.946219 eth0 > capc25.muc.798 > caes04.muc.nfs: . 524132:525592(1460) ack 3925 win 8576 (DF)
09:59:52.946228 eth0 > capc25.muc.798 > caes04.muc.nfs: . 525592:527052(1460) ack 3925 win 8576 (DF)
09:59:52.946237 eth0 > capc25.muc.798 > caes04.muc.nfs: . 527052:528512(1460) ack 3925 win 8576 (DF)
09:59:53.146698 eth0 < caes04.muc.nfs > capc25.muc.798: . 3925:3925(0) ack 528512 win 46892
09:59:53.146726 eth0 > capc25.muc.798 > caes04.muc.nfs: . 528512:529972(1460) ack 3925 win 8576 (DF)
09:59:53.146736 eth0 > capc25.muc.798 > caes04.muc.nfs: . 529972:531432(1460) ack 3925 win 8576 (DF)
09:59:53.146746 eth0 > capc25.muc.798 > caes04.muc.nfs: . 531432:532892(1460) ack 3925 win 8576 (DF)
09:59:53.146755 eth0 > capc25.muc.798 > caes04.muc.nfs: . 532892:534352(1460) ack 3925 win 8576 (DF)
09:59:53.146763 eth0 > capc25.muc.798 > caes04.muc.nfs: . 534352:535812(1460) ack 3925 win 8576 (DF)
09:59:53.346907 eth0 < caes04.muc.nfs > capc25.muc.798: . 3925:3925(0) ack 535812 win 39592
.. and so on...
09:59:54.380949 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1010312:1011772(1460) ack 5893 win 8576 (DF)
09:59:54.380956 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1011772:1013232(1460) ack 5893 win 8576 (DF)
09:59:54.380964 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1013232:1014692(1460) ack 5893 win 8576 (DF)
09:59:54.380971 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1014692:1016152(1460) ack 5893 win 8576 (DF)
09:59:54.380978 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1016152:1017612(1460) ack 5893 win 8576 (DF)
09:59:54.382590 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1017612:1019072(1460) ack 5893 win 8576 (DF)
09:59:54.382598 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1019072:1020532(1460) ack 5893 win 8576 (DF)
09:59:54.382603 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1020532:1021992(1460) ack 5893 win 8576 (DF)
09:59:54.382608 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1021992:1023452(1460) ack 5893 win 8576 (DF)
09:59:54.382617 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1023452:1024912(1460) ack 5893 win 8576 (DF)
09:59:54.382623 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1024912:1026372(1460) ack 5893 win 8576 (DF)
09:59:54.382627 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1026372:1027832(1460) ack 5893 win 8576 (DF)
09:59:54.384353 eth0 < caes04.muc.nfs > capc25.muc.798: . 5893:5893(0) ack 1010312 win 58832
09:59:54.384375 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1027832:1029292(1460) ack 5893 win 8576 (DF)
09:59:54.384383 eth0 > capc25.muc.798 > caes04.muc.nfs: P 1029292:1029740(448) ack 5893 win 8576 (DF)
09:59:54.385187 eth0 < caes04.muc.nfs > capc25.muc.798: P 5893:6057(164) ack 1014692 win 54452
09:59:54.385216 eth0 < caes04.muc.nfs > capc25.muc.798: P 6057:6221(164) ack 1017612 win 51532
09:59:54.385237 eth0 < caes04.muc.nfs > capc25.muc.798: P 6221:6385(164) ack 1021992 win 47152
09:59:54.385830 eth0 < caes04.muc.nfs > capc25.muc.798: . 6385:6385(0) ack 1029740 win 60032
09:59:54.386145 eth0 < caes04.muc.nfs > capc25.muc.798: P 6385:6549(164) ack 1029740 win 60032
09:59:54.386153 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1029740:1029740(0) ack 6549 win 8576 (DF)
09:59:58.976285 eth0 > capc25.muc.798 > caes04.muc.nfs: P 1029740:1029880(140) ack 6549 win 8576 (DF)
09:59:59.029839 eth0 < caes04.muc.nfs > capc25.muc.798: P 6549:6705(156) ack 1029880 win 60032
09:59:59.066239 eth0 > capc25.muc.798 > caes04.muc.nfs: . 1029880:1029880(0) ack 6705 win 8576 (DF)
10:00:08.566727 eth0 > capc25.muc.1644494848 > caes04.muc.nfs: 40 null (DF)
10:00:08.567211 eth0 < caes04.muc.nfs > capc25.muc.1644494848: reply ok 24 null
10:00:38.018114 eth0 > capc25.muc.2449801216 > caes04.muc.nfs: 40 null (DF)
10:00:38.018764 eth0 < caes04.muc.nfs > capc25.muc.2449801216: reply ok 24 null




tcpdump on caes04 (AIX)
09:59:31.845604763 capc25.muc.798 > caes04.muc.shilp: P 1035886130:1035886266(136) ack 1814843210 win 7504 (DF)
09:59:31.845756217 caes04.muc.shilp > capc25.muc.798: P 1:245(244) ack 136 win 60032
09:59:31.846304152 capc25.muc.798 > caes04.muc.shilp: . ack 245 win 8576 (DF)
09:59:31.846367867 capc25.muc.798 > caes04.muc.shilp: P 136:300(164) ack 245 win 8576 (DF)
09:59:31.852903330 caes04.muc.shilp > capc25.muc.798: P 245:393(148) ack 300 win 60032
09:59:31.854441517 capc25.muc.798 > caes04.muc.shilp: . 300:1760(1460) ack 393 win 8576 (DF)
09:59:31.854577748 capc25.muc.798 > caes04.muc.shilp: . 1035887890:1035889350(1460) ack 1814843602 win 8576 (DF)
09:59:31.867147719 caes04.muc.shilp > capc25.muc.798: . ack 1460 win 57112
09:59:31.868416956 capc25.muc.798 > caes04.muc.shilp: . 1460:2920(1460) ack 1 win 8576 (DF)
09:59:31.868541353 capc25.muc.798 > caes04.muc.shilp: . 2920:4380(1460) ack 1 win 8576 (DF)
09:59:31.868699607 capc25.muc.798 > caes04.muc.shilp: . 4380:5840(1460) ack 1 win 8576 (DF)
09:59:32.067542678 caes04.muc.shilp > capc25.muc.798: . ack 5840 win 52732
09:59:32.068873485 capc25.muc.798 > caes04.muc.shilp: . 5840:7300(1460) ack 1 win 8576 (DF)
09:59:32.068995737 capc25.muc.798 > caes04.muc.shilp: . 7300:8760(1460) ack 1 win 8576 (DF)
09:59:32.069121401 capc25.muc.798 > caes04.muc.shilp: . 8760:10220(1460) ack 1 win 8576 (DF)
09:59:32.069246176 capc25.muc.798 > caes04.muc.shilp: P 10220:11680(1460) ack 1 win 8576 (DF)
09:59:32.268000574 caes04.muc.shilp > capc25.muc.798: . ack 11680 win 46892
09:59:32.269330237 capc25.muc.798 > caes04.muc.shilp: . 11680:13140(1460) ack 1 win 8576 (DF)
09:59:32.269447200 capc25.muc.798 > caes04.muc.shilp: P 13140:14600(1460) ack 1 win 8576 (DF)
09:59:32.269575574 capc25.muc.798 > caes04.muc.shilp: . 14600:16060(1460) ack 1 win 8576 (DF)
09:59:32.269700305 capc25.muc.798 > caes04.muc.shilp: . 16060:17520(1460) ack 1 win 8576 (DF)
09:59:32.269824713 capc25.muc.798 > caes04.muc.shilp: P 17520:18980(1460) ack 1 win 8576 (DF)
09:59:32.468507295 caes04.muc.shilp > capc25.muc.798: . ack 18980 win 39592
09:59:32.469794655 capc25.muc.798 > caes04.muc.shilp: . 18980:20440(1460) ack 1 win 8576 (DF)
09:59:32.469949532 capc25.muc.798 > caes04.muc.shilp: . 20440:21900(1460) ack 1 win 8576 (DF)
09:59:32.470074273 capc25.muc.798 > caes04.muc.shilp: . 21900:23360(1460) ack 1 win 8576 (DF)
09:59:32.470197836 capc25.muc.798 > caes04.muc.shilp: P 23360:24820(1460) ack 1 win 8576 (DF)
09:59:32.470324178 capc25.muc.798 > caes04.muc.shilp: . 24820:26280(1460) ack 1 win 8576 (DF)
09:59:32.470450442 capc25.muc.798 > caes04.muc.shilp: . 26280:27740(1460) ack 1 win 8576 (DF)
09:59:32.669979456 caes04.muc.shilp > capc25.muc.798: . ack 27740 win 30832
09:59:32.671290251 capc25.muc.798 > caes04.muc.shilp: . 27740:29200(1460) ack 1 win 8576 (DF)
09:59:32.671411003 capc25.muc.798 > caes04.muc.shilp: . 29200:30660(1460) ack 1 win 8576 (DF)
09:59:32.671536311 capc25.muc.798 > caes04.muc.shilp: . 30660:32120(1460) ack 1 win 8576 (DF)
09:59:32.671604804 caes04.muc.shilp > capc25.muc.798: . ack 32120 win 59368
09:59:32.671661586 capc25.muc.798 > caes04.muc.shilp: . 32120:33580(1460) ack 1 win 8576 (DF)
09:59:32.671888756 capc25.muc.798 > caes04.muc.shilp: . 33580:35040(1460) ack 1 win 8576 (DF)
09:59:32.672038243 caes04.muc.shilp > capc25.muc.798: P 1:165(164) ack 35040 win 56448
09:59:32.672178508 capc25.muc.798 > caes04.muc.shilp: . 36500:37960(1460) ack 1 win 8576 (DF)
09:59:32.672918233 capc25.muc.798 > caes04.muc.shilp: . 37960:39420(1460) ack 1 win 8576 (DF)
.. and so on...
09:59:33.515030950 capc25.muc.798 > caes04.muc.shilp: . 493740:495200(1460) ack 2461 win 8576 (DF)
09:59:33.515177881 capc25.muc.798 > caes04.muc.shilp: . 495200:496660(1460) ack 2461 win 8576 (DF)
09:59:33.515304223 capc25.muc.798 > caes04.muc.shilp: . 496660:498120(1460) ack 2461 win 8576 (DF)
09:59:33.515429442 capc25.muc.798 > caes04.muc.shilp: . 498120:499580(1460) ack 2461 win 8576 (DF)
09:59:33.515561750 capc25.muc.798 > caes04.muc.shilp: . 499580:501040(1460) ack 2461 win 8576 (DF)
09:59:33.515695048 capc25.muc.798 > caes04.muc.shilp: . 501040:502500(1460) ack 2461 win 8576 (DF)
09:59:33.515817122 capc25.muc.798 > caes04.muc.shilp: . 502500:503960(1460) ack 2461 win 8576 (DF)
09:59:33.515942297 capc25.muc.798 > caes04.muc.shilp: . 503960:505420(1460) ack 2461 win 8576 (DF)
09:59:33.516066994 capc25.muc.798 > caes04.muc.shilp: . 505420:506880(1460) ack 2461 win 8576 (DF)
09:59:33.516190724 capc25.muc.798 > caes04.muc.shilp: . 506880:508340(1460) ack 2461 win 8576 (DF)
09:59:33.516316599 capc25.muc.798 > caes04.muc.shilp: . 508340:509800(1460) ack 2461 win 8576 (DF)
09:59:33.516443951 capc25.muc.798 > caes04.muc.shilp: . 509800:511260(1460) ack 2461 win 8576 (DF)
09:59:33.516575404 capc25.muc.798 > caes04.muc.shilp: . 511260:512720(1460) ack 2461 win 8576 (DF)
09:59:33.516586905 capc25.muc.798 > caes04.muc.shilp: P 512720:512908(188) ack 2461 win 8576 (DF)
09:59:33.516681467 caes04.muc.shilp > capc25.muc.798: . ack 512908 win 60032
09:59:33.516883991 caes04.muc.shilp > capc25.muc.798: P 2461:2625(164) ack 512908 win 60032
09:59:33.517569101 capc25.muc.798 > caes04.muc.shilp: P 512908:513048(140) ack 2625 win 8576 (DF)
09:59:33.630955691 caes04.muc.shilp > capc25.muc.798: P 2625:2781(156) ack 513048 win 60032
09:59:33.668220832 capc25.muc.798 > caes04.muc.shilp: . ack 2781 win 8576 (DF)
09:59:38.628694302 capc25.muc.32050000 > caes04.muc.nfs: 40 null (DF)
09:59:38.628778496 caes04.muc.nfs > capc25.muc.32050000: reply ok 24
09:59:49.586536582 capc25.muc.798 > caes04.muc.shilp: P 1036400938:1036401066(128) ack 1814846382 win 8576 (DF)
09:59:49.586776164 caes04.muc.shilp > capc25.muc.798: P 1:117(116) ack 128 win 60032
09:59:49.587157099 capc25.muc.798 > caes04.muc.shilp: . ack 117 win 8576 (DF)
09:59:49.589315282 capc25.muc.798 > caes04.muc.shilp: P 128:264(136) ack 117 win 8576 (DF)
09:59:49.589408743 caes04.muc.shilp > capc25.muc.798: P 117:361(244) ack 264 win 60032
09:59:49.629006777 capc25.muc.798 > caes04.muc.shilp: . ack 361 win 8576 (DF)
09:59:52.570844645 capc25.muc.798 > caes04.muc.shilp: P 264:400(136) ack 361 win 8576 (DF)
09:59:52.571043168 caes04.muc.shilp > capc25.muc.798: P 361:605(244) ack 400 win 60032
09:59:52.571576558 capc25.muc.798 > caes04.muc.shilp: . ack 605 win 8576 (DF)
09:59:52.571649841 capc25.muc.798 > caes04.muc.shilp: P 400:564(164) ack 605 win 8576 (DF)
09:59:52.587169789 caes04.muc.shilp > capc25.muc.798: P 605:753(148) ack 564 win 60032
09:59:52.588747424 capc25.muc.798 > caes04.muc.shilp: . 564:2024(1460) ack 753 win 8576 (DF)
09:59:52.588875654 capc25.muc.798 > caes04.muc.shilp: . 515072:516532(1460) ack 3533 win 8576 (DF)
09:59:52.748473502 caes04.muc.shilp > capc25.muc.798: . ack 516532 win 57112
09:59:52.749948552 capc25.muc.798 > caes04.muc.shilp: . 516532:517992(1460) ack 3533 win 8576 (DF)
09:59:52.750054981 capc25.muc.798 > caes04.muc.shilp: . 517992:519452(1460) ack 3533 win 8576 (DF)
09:59:52.750181422 capc25.muc.798 > caes04.muc.shilp: . 519452:520912(1460) ack 3533 win 8576 (DF)
09:59:52.948926208 caes04.muc.shilp > capc25.muc.798: . ack 520912 win 52732
09:59:52.950208057 capc25.muc.798 > caes04.muc.shilp: . 520912:522372(1460) ack 3533 win 8576 (DF)
09:59:52.950317664 capc25.muc.798 > caes04.muc.shilp: . 522372:523832(1460) ack 3533 win 8576 (DF)
09:59:52.950449373 capc25.muc.798 > caes04.muc.shilp: . 523832:525292(1460) ack 3533 win 8576 (DF)
09:59:52.950596493 capc25.muc.798 > caes04.muc.shilp: . 525292:526752(1460) ack 3533 win 8576 (DF)
09:59:53.149427407 caes04.muc.shilp > capc25.muc.798: . ack 526752 win 46892
09:59:53.150752059 capc25.muc.798 > caes04.muc.shilp: . 526752:528212(1460) ack 3533 win 8576 (DF)
09:59:53.150865744 capc25.muc.798 > caes04.muc.shilp: . 528212:529672(1460) ack 3533 win 8576 (DF)
09:59:53.150994330 capc25.muc.798 > caes04.muc.shilp: . 529672:531132(1460) ack 3533 win 8576 (DF)
09:59:53.151120238 capc25.muc.798 > caes04.muc.shilp: . 531132:532592(1460) ack 3533 win 8576 (DF)
09:59:53.151253113 capc25.muc.798 > caes04.muc.shilp: . 532592:534052(1460) ack 3533 win 8576 (DF)
09:59:53.349648355 caes04.muc.shilp > capc25.muc.798: . ack 534052 win 39592
09:59:53.350953271 capc25.muc.798 > caes04.muc.shilp: . 534052:535512(1460) ack 3533 win 8576 (DF)
.. and so on...
09:59:54.385746887 capc25.muc.798 > caes04.muc.shilp: . 999792:1001252(1460) ack 5501 win 8576 (DF)
09:59:54.385886062 capc25.muc.798 > caes04.muc.shilp: . 1001252:1002712(1460) ack 5501 win 8576 (DF)
09:59:54.386048695 capc25.muc.798 > caes04.muc.shilp: P 1002712:1004172(1460) ack 5501 win 8576 (DF)
09:59:54.386173981 capc25.muc.798 > caes04.muc.shilp: . 1004172:1005632(1460) ack 5501 win 8576 (DF)
09:59:54.386299911 capc25.muc.798 > caes04.muc.shilp: . 1005632:1007092(1460) ack 5501 win 8576 (DF)
09:59:54.386425664 capc25.muc.798 > caes04.muc.shilp: P 1007092:1008552(1460) ack 5501 win 8576 (DF)
09:59:54.386469944 caes04.muc.shilp > capc25.muc.798: . ack 1008552 win 58832
09:59:54.386555427 capc25.muc.798 > caes04.muc.shilp: . 1008552:1010012(1460) ack 5501 win 8576 (DF)
09:59:54.386684180 capc25.muc.798 > caes04.muc.shilp: . 1010012:1011472(1460) ack 5501 win 8576 (DF)
09:59:54.386918284 capc25.muc.798 > caes04.muc.shilp: . 1011472:1012932(1460) ack 5501 win 8576 (DF)
09:59:54.386971732 caes04.muc.shilp > capc25.muc.798: P 5501:5665(164) ack 1012932 win 54452
09:59:54.387297675 caes04.muc.shilp > capc25.muc.798: P 5665:5829(164) ack 1015852 win 51532
09:59:54.387677099 caes04.muc.shilp > capc25.muc.798: P 5829:5993(164) ack 1020232 win 47152
09:59:54.387728714 capc25.muc.798 > caes04.muc.shilp: . 1020232:1021692(1460) ack 5501 win 8576 (DF)
09:59:54.387853499 capc25.muc.798 > caes04.muc.shilp: . 1021692:1023152(1460) ack 5501 win 8576 (DF)
09:59:54.387999031 capc25.muc.798 > caes04.muc.shilp: . 1036911042:1036912502(1460) ack 1814849102 win 8576 (DF)
09:59:54.388126872 capc25.muc.798 > caes04.muc.shilp: . 1460:2920(1460) ack 1 win 8576 (DF)

and cp is running in the timeout again....

Cheers,
Birger


Trond Myklebust writes:
 > >>>>> " " == Birger Lammering <b.lammering@science-computing.de> writes:
 > 
 >      > 3133:3289(156) ack 514936 win 60032 16:27:26.282843 >
 >      > capc25.muc.799 > caes04.muc.nfs: . 514936:514936(0) ack 3289
 >      > win 8576 (DF)
 > 
 >      > from now on we get lot's of these:
 > 
 >      > 16:27:26.489024 > capc25.muc.576126976 > caes04.muc.nfs: 40
 >      > null (DF) 16:27:26.489647 < caes04.muc.nfs >
 >      > capc25.muc.576126976: reply ok 24 null
 > 
 >      > The cp command on the Linux nfs3-client side hangs and cannot
 >      > be killed. We get:
 > 
 >      > dmesg: nfs: server caes04 not responding, still trying
 > 
 >      > then after a while: dmesg: nfs: server caes04 OK
 > 
 >      > qx09820@capc25 /home/qx09820 > netstat | grep caes04 tcp 0 0
 >      > capc25.muc:798 caes04.muc:nfs ESTABLISHED
 > 
 > Ho hum... It looks to me as if the problem is that the Linux NFS
 > client is falling asleep before a write, and then not waking
 > up. That sort of points at the write_space() callback.
 > 
 > When the socket buffer is full, and we get an EAGAIN response to our
 > sendmsg() request, we normally put the request to sleep, block the
 > socket, and rely on write_space() to wake us up when there is enough
 > memory to proceed.
 > 
 > Assuming that this is the case, there are 2 possible causes:
 > 
 >    1) A bug in the IPV4 TCP layer in which we don't call write_space()
 >       despite having liberated enough memory to proceed.
 > 
 >    2) I've misunderstood the IPV4 tcp api, and so the check for
 >       sock_writeable() in net/sunrpc/xprt.c:tcp_write_space() is
 >       incorrect.
 > 
 > Alexey: Do you have any comments? Is it correct to check for
 > sock_writeable() on a TCP socket?
 > 
 > 
 > Birger: could you try the following patch, that simply removes the
 > check for sock_writeable()?
 > 
 > Cheers,
 >   Trond
 > 
 > --- linux-2.4.15-pre6/net/sunrpc/xprt.c.orig	Mon Oct  8 21:36:07 2001
 > +++ linux-2.4.15-pre6/net/sunrpc/xprt.c	Mon Nov 19 19:07:09 2001
 > @@ -1071,10 +1071,6 @@
 >  	if (xprt->shutdown)
 >  		return;
 >  
 > -	/* Wait until we have enough socket memory */
 > -	if (!sock_writeable(sk))
 > -		return;
 > -
 >  	if (!xprt_test_and_set_wspace(xprt)) {
 >  		spin_lock(&xprt->sock_lock);
 >  		if (xprt->snd_task && xprt->snd_task->tk_rpcwait == &xprt->sending)
 > 
