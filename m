Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1161480AbWATDZ0@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1161480AbWATDZ0 (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 19 Jan 2006 22:25:26 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1161478AbWATDZZ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 19 Jan 2006 22:25:25 -0500
Received: from fgwmail6.fujitsu.co.jp ([192.51.44.36]:10418 "EHLO
	fgwmail6.fujitsu.co.jp") by vger.kernel.org with ESMTP
	id S1161475AbWATDZY (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 19 Jan 2006 22:25:24 -0500
Date: Fri, 20 Jan 2006 12:24:56 +0900
Message-ID: <87r773a8dz.wl%muneda.takahiro@jp.fujitsu.com>
From: MUNEDA Takahiro <muneda.takahiro@jp.fujitsu.com>
To: Kristen Accardi <kristen.c.accardi@intel.com>
Cc: linux-kernel@vger.kernel.org, greg@kroah.com,
       pcihpd-discuss@lists.sourceforge.net, len.brown@intel.com,
       linux-acpi@vger.kernel.org, pavel@ucw.cz
Subject: Re: [Pcihpd-discuss] [patch 2/4] acpiphp: handle dock bridges
In-Reply-To: <1137545819.19858.47.camel@whizzy>
References: <20060116200218.275371000@whizzy>
	<1137545819.19858.47.camel@whizzy>
User-Agent: Wanderlust/2.14.1 (Bad Medicine-pre) SEMI/1.14.6 (Maruoka) LIMIT/1.14.9 (Domyoji) APEL/10.6 Emacs/22.0.50 (i686-pc-linux-gnu) MULE/5.0 (SAKAKI)
X-Weather: =?ISO-2022-JP?B?GyRCTEBGfCROQEUyLDgpJE9AYyQrMSskRyQ5GyhC?=
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Hi,

At Tue, 17 Jan 2006 16:56:59 -0800,
Kristen Accardi <kristen.c.accardi@intel.com> wrote:
> 
> @@ -681,6 +713,88 @@ static int acpiphp_configure_ioapics(acp
(snip)
> +static int acpiphp_bus_add(struct acpiphp_func *func)
> +{
> +	acpi_handle phandle;
> +	struct acpi_device *device, *pdevice;
> +	int ret_val;
> +
> +	acpi_get_parent(func->handle, &phandle);
> +	if (acpi_bus_get_device(phandle, &pdevice)) {
> +		dbg("no parent device, assuming NULL\n");
> +		pdevice = NULL;
> +	}
> +	ret_val = acpi_bus_add(&device, pdevice, func->handle,
> +			ACPI_BUS_TYPE_DEVICE);
> +	if (ret_val)
> +		dbg("cannot add bridge to acpi list\n");
> +
> +	/*
> +	 * try to start anyway.  We could have failed to add
> +	 * simply because this bus had previously been added
> +	 * on another dock.  Don't bother with the return value
> +	 * we just keep going.
> +	 */
> +	ret_val = acpi_bus_start(device);
> +
> +	return ret_val;
> +}
> +
> +
> +

When the device is docked, acpi_bus_add() is called to register
the device into acpi list. But if the device is undocked,
acpi_bus_trim() doesn't called.
Can you hot-add/remove the dock station repeatedly?

Thanks,
MUNE

-- 
MUNEDA Takahiro <muneda.takahiro@jp.fujitsu.com>
