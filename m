Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264339AbTLVGXZ (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 22 Dec 2003 01:23:25 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264343AbTLVGXH
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 22 Dec 2003 01:23:07 -0500
Received: from zero.voxel.net ([209.123.232.253]:705 "EHLO zero.voxel.net")
	by vger.kernel.org with ESMTP id S264339AbTLVGWi (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Mon, 22 Dec 2003 01:22:38 -0500
Subject: [PATCH 9/10] CardServices() removal from pcmcia net drivers
From: Andres Salomon <dilinger@voxel.net>
To: linux-kernel@vger.kernel.org
Cc: dahinds@users.sourceforge.net, akpm@osdl.org
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-cY3QITGn39CCToKbMwlN"
Message-Id: <1072073223.27831.44.camel@spiral.internal>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.5 
Date: Mon, 22 Dec 2003 01:20:33 -0500
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


--=-cY3QITGn39CCToKbMwlN
Content-Type: multipart/mixed; boundary="=-TrvjWT62KtUG8JSjeAnD"


--=-TrvjWT62KtUG8JSjeAnD
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Part 9 of 10.

--=-TrvjWT62KtUG8JSjeAnD
Content-Disposition: attachment; filename=009-cs_remove.patch
Content-Type: text/x-patch; name=009-cs_remove.patch; charset=us-ascii
Content-Transfer-Encoding: base64

UmV2aXNpb246IGxpbnV4LS1tYWlubGluZS0tMi42LS1wYXRjaC0yMg0KQXJjaGl2ZTogZGlsaW5n
ZXJAdm94ZWwubmV0LS0yMDAzLXNwaXJhbA0KQ3JlYXRvcjogQW5kcmVzIFNhbG9tb24gPGRpbGlu
Z2VyQHZveGVsLm5ldD4NCkRhdGU6IFN1biBEZWMgMjEgMjI6Mzk6MDAgRVNUIDIwMDMNClN0YW5k
YXJkLWRhdGU6IDIwMDMtMTItMjIgMDM6Mzk6MDAgR01UDQpNb2RpZmllZC1maWxlczogZHJpdmVy
cy9uZXQvcGNtY2lhL2ZtdmoxOHhfY3MuYw0KTmV3LXBhdGNoZXM6IGRpbGluZ2VyQHZveGVsLm5l
dC0tMjAwMy1zcGlyYWwvbGludXgtLW1haW5saW5lLS0yLjYtLXBhdGNoLTIyDQpTdW1tYXJ5OiBD
YXJkU2VydmljZXMoKSByZW1vdmFsLCBwdC4gOQ0KS2V5d29yZHM6IA0KDQpSZW1vdmUgY2FsbHMg
dG8gQ2FyZFNlcnZpY2VzKCksIHBhcnQgOTsgZm12ajE4eF9jcy5jLg0KDQoqIGFkZGVkIGZpbGVz
DQoNCiAgICB7YXJjaH0vbGludXgvbGludXgtLW1haW5saW5lL2xpbnV4LS1tYWlubGluZS0tMi42
L2RpbGluZ2VyQHZveGVsLm5ldC0tMjAwMy1zcGlyYWwvcGF0Y2gtbG9nL3BhdGNoLTIyDQoNCiog
bW9kaWZpZWQgZmlsZXMNCg0KLS0tIG9yaWcvZHJpdmVycy9uZXQvcGNtY2lhL2ZtdmoxOHhfY3Mu
Yw0KKysrIG1vZC9kcml2ZXJzL25ldC9wY21jaWEvZm12ajE4eF9jcy5jDQpAQCAtMzA3LDcgKzMw
Nyw3IEBADQogICAgIGNsaWVudF9yZWcuZXZlbnRfaGFuZGxlciA9ICZmbXZqMTh4X2V2ZW50Ow0K
ICAgICBjbGllbnRfcmVnLlZlcnNpb24gPSAweDAyMTA7DQogICAgIGNsaWVudF9yZWcuZXZlbnRf
Y2FsbGJhY2tfYXJncy5jbGllbnRfZGF0YSA9IGxpbms7DQotICAgIHJldCA9IENhcmRTZXJ2aWNl
cyhSZWdpc3RlckNsaWVudCwgJmxpbmstPmhhbmRsZSwgJmNsaWVudF9yZWcpOw0KKyAgICByZXQg
PSBwY21jaWFfcmVnaXN0ZXJfY2xpZW50KCZsaW5rLT5oYW5kbGUsICZjbGllbnRfcmVnKTsNCiAg
ICAgaWYgKHJldCAhPSAwKSB7DQogCWNzX2Vycm9yKGxpbmstPmhhbmRsZSwgUmVnaXN0ZXJDbGll
bnQsIHJldCk7DQogCWZtdmoxOHhfZGV0YWNoKGxpbmspOw0KQEAgLTM0MCw3ICszNDAsNyBAQA0K
IA0KICAgICAvKiBCcmVhayB0aGUgbGluayB3aXRoIENhcmQgU2VydmljZXMgKi8NCiAgICAgaWYg
KGxpbmstPmhhbmRsZSkNCi0JQ2FyZFNlcnZpY2VzKERlcmVnaXN0ZXJDbGllbnQsIGxpbmstPmhh
bmRsZSk7DQorCXBjbWNpYV9kZXJlZ2lzdGVyX2NsaWVudChsaW5rLT5oYW5kbGUpOw0KICAgICAN
CiAgICAgLyogVW5saW5rIGRldmljZSBzdHJ1Y3R1cmUsIGZyZWUgcGllY2VzICovDQogICAgICps
aW5rcCA9IGxpbmstPm5leHQ7DQpAQCAtMzU0LDggKzM1NCw4IEBADQogDQogLyo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PSovDQogDQotI2RlZmluZSBDU19DSEVDSyhmbiwgYXJncy4uLikgXA0KLXdoaWxlICgobGFzdF9y
ZXQ9Q2FyZFNlcnZpY2VzKGxhc3RfZm49KGZuKSwgYXJncykpIT0wKSBnb3RvIGNzX2ZhaWxlZA0K
KyNkZWZpbmUgQ1NfQ0hFQ0soZm4sIHJldCkgXA0KK2RvIHsgbGFzdF9mbiA9IChmbik7IGlmICgo
bGFzdF9yZXQgPSAocmV0KSkgIT0gMCkgZ290byBjc19mYWlsZWQ7IH0gd2hpbGUgKDApDQogDQog
c3RhdGljIGludCBtZmNfdHJ5X2lvX3BvcnQoZGV2X2xpbmtfdCAqbGluaykNCiB7DQpAQCAtMzY5
LDcgKzM2OSw3IEBADQogCSAgICBsaW5rLT5pby5OdW1Qb3J0czIgPSAwOw0KIAkgICAgcHJpbnRr
KEtFUk5fTk9USUNFICJmbXZqMTh4X2NzOiBvdXQgb2YgcmVzb3VyY2UgZm9yIHNlcmlhbFxuIik7
DQogCX0NCi0JcmV0ID0gQ2FyZFNlcnZpY2VzKFJlcXVlc3RJTywgbGluay0+aGFuZGxlLCAmbGlu
ay0+aW8pOw0KKwlyZXQgPSBwY21jaWFfcmVxdWVzdF9pbyhsaW5rLT5oYW5kbGUsICZsaW5rLT5p
byk7DQogCWlmIChyZXQgPT0gQ1NfU1VDQ0VTUykgcmV0dXJuIHJldDsNCiAgICAgfQ0KICAgICBy
ZXR1cm4gcmV0Ow0KQEAgLTM4NSw3ICszODUsNyBAQA0KICAgICAqLw0KICAgICBmb3IgKGlvYWRk
ciA9IDB4MzAwOyBpb2FkZHIgPCAweDNlMDsgaW9hZGRyICs9IDB4MjApIHsNCiAJbGluay0+aW8u
QmFzZVBvcnQxID0gaW9hZGRyOw0KLQlyZXQgPSBDYXJkU2VydmljZXMoUmVxdWVzdElPLCBsaW5r
LT5oYW5kbGUsICZsaW5rLT5pbyk7DQorCXJldCA9IHBjbWNpYV9yZXF1ZXN0X2lvKGxpbmstPmhh
bmRsZSwgJmxpbmstPmlvKTsNCiAJaWYgKHJldCA9PSBDU19TVUNDRVNTKSB7DQogCSAgICAvKiBj
YWxjdWxhdGUgQ29uZmlnSW5kZXggdmFsdWUgKi8NCiAJICAgIGxpbmstPmNvbmYuQ29uZmlnSW5k
ZXggPSANCkBAIC00MTcsMTIgKzQxNywxMiBAQA0KICAgICAgICByZWdpc3RlcnMuDQogICAgICov
DQogICAgIHR1cGxlLkRlc2lyZWRUdXBsZSA9IENJU1RQTF9DT05GSUc7DQotICAgIENTX0NIRUNL
KEdldEZpcnN0VHVwbGUsIGhhbmRsZSwgJnR1cGxlKTsNCisgICAgQ1NfQ0hFQ0soR2V0Rmlyc3RU
dXBsZSwgcGNtY2lhX2dldF9maXJzdF90dXBsZShoYW5kbGUsICZ0dXBsZSkpOw0KICAgICB0dXBs
ZS5UdXBsZURhdGEgPSAodV9jaGFyICopYnVmOw0KICAgICB0dXBsZS5UdXBsZURhdGFNYXggPSA2
NDsNCiAgICAgdHVwbGUuVHVwbGVPZmZzZXQgPSAwOw0KLSAgICBDU19DSEVDSyhHZXRUdXBsZURh
dGEsIGhhbmRsZSwgJnR1cGxlKTsNCi0gICAgQ1NfQ0hFQ0soUGFyc2VUdXBsZSwgaGFuZGxlLCAm
dHVwbGUsICZwYXJzZSk7DQorICAgIENTX0NIRUNLKEdldFR1cGxlRGF0YSwgcGNtY2lhX2dldF90
dXBsZV9kYXRhKGhhbmRsZSwgJnR1cGxlKSk7DQorICAgIENTX0NIRUNLKFBhcnNlVHVwbGUsIHBj
bWNpYV9wYXJzZV90dXBsZShoYW5kbGUsICZ0dXBsZSwgJnBhcnNlKSk7DQogICAgIA0KICAgICAv
KiBDb25maWd1cmUgY2FyZCAqLw0KICAgICBsaW5rLT5zdGF0ZSB8PSBERVZfQ09ORklHOw0KQEAg
LTQzMiwxNiArNDMyLDE2IEBADQogDQogICAgIHR1cGxlLkRlc2lyZWRUdXBsZSA9IENJU1RQTF9G
VU5DRTsNCiAgICAgdHVwbGUuVHVwbGVPZmZzZXQgPSAwOw0KLSAgICBpZiAoQ2FyZFNlcnZpY2Vz
KEdldEZpcnN0VHVwbGUsIGhhbmRsZSwgJnR1cGxlKSA9PSBDU19TVUNDRVNTKSB7DQorICAgIGlm
IChwY21jaWFfZ2V0X2ZpcnN0X3R1cGxlKGhhbmRsZSwgJnR1cGxlKSA9PSBDU19TVUNDRVNTKSB7
DQogCS8qIFllcywgSSBoYXZlIENJU1RQTF9GVU5DRS4gTGV0J3MgY2hlY2sgQ0lTVFBMX01BTkZJ
RCAqLw0KIAl0dXBsZS5EZXNpcmVkVHVwbGUgPSBDSVNUUExfQ0ZUQUJMRV9FTlRSWTsNCi0JQ1Nf
Q0hFQ0soR2V0Rmlyc3RUdXBsZSwgaGFuZGxlLCAmdHVwbGUpOw0KLQlDU19DSEVDSyhHZXRUdXBs
ZURhdGEsIGhhbmRsZSwgJnR1cGxlKTsNCi0JQ1NfQ0hFQ0soUGFyc2VUdXBsZSwgaGFuZGxlLCAm
dHVwbGUsICZwYXJzZSk7DQorCUNTX0NIRUNLKEdldEZpcnN0VHVwbGUsIHBjbWNpYV9nZXRfZmly
c3RfdHVwbGUoaGFuZGxlLCAmdHVwbGUpKTsNCisJQ1NfQ0hFQ0soR2V0VHVwbGVEYXRhLCBwY21j
aWFfZ2V0X3R1cGxlX2RhdGEoaGFuZGxlLCAmdHVwbGUpKTsNCisJQ1NfQ0hFQ0soUGFyc2VUdXBs
ZSwgcGNtY2lhX3BhcnNlX3R1cGxlKGhhbmRsZSwgJnR1cGxlLCAmcGFyc2UpKTsNCiAJbGluay0+
Y29uZi5Db25maWdJbmRleCA9IHBhcnNlLmNmdGFibGVfZW50cnkuaW5kZXg7DQogCXR1cGxlLkRl
c2lyZWRUdXBsZSA9IENJU1RQTF9NQU5GSUQ7DQotCWlmIChDYXJkU2VydmljZXMoR2V0Rmlyc3RU
dXBsZSwgaGFuZGxlLCAmdHVwbGUpID09IENTX1NVQ0NFU1MpDQotCSAgICBDU19DSEVDSyhHZXRU
dXBsZURhdGEsIGhhbmRsZSwgJnR1cGxlKTsNCisJaWYgKHBjbWNpYV9nZXRfZmlyc3RfdHVwbGUo
aGFuZGxlLCAmdHVwbGUpID09IENTX1NVQ0NFU1MpDQorCSAgICBDU19DSEVDSyhHZXRUdXBsZURh
dGEsIHBjbWNpYV9nZXRfdHVwbGVfZGF0YShoYW5kbGUsICZ0dXBsZSkpOw0KIAllbHNlDQogCSAg
ICBidWZbMF0gPSAweGZmZmY7DQogCXN3aXRjaCAobGUxNl90b19jcHUoYnVmWzBdKSkgew0KQEAg
LTQ0OSw3ICs0NDksNyBAQA0KIAkgICAgY2FyZHR5cGUgPSBUREs7DQogCSAgICBpZiAobGUxNl90
b19jcHUoYnVmWzFdKSA9PSBQUk9ESURfVERLX0NGMDEwKSB7DQogCQljc19zdGF0dXNfdCBzdGF0
dXM7DQotCQlDYXJkU2VydmljZXMoR2V0U3RhdHVzLCBoYW5kbGUsICZzdGF0dXMpOw0KKwkJcGNt
Y2lhX2dldF9zdGF0dXMoaGFuZGxlLCAmc3RhdHVzKTsNCiAJCWlmIChzdGF0dXMuQ2FyZFN0YXRl
ICYgQ1NfRVZFTlRfM1ZDQVJEKQ0KIAkJICAgIGxpbmstPmNvbmYuVmNjID0gMzM7IC8qIGluc2Vy
dGVkIGluIDMuM1Ygc2xvdCAqLw0KIAkgICAgfSBlbHNlIGlmIChsZTE2X3RvX2NwdShidWZbMV0p
ID09IFBST0RJRF9UREtfR04zNDEwKSB7DQpAQCAtNDc4LDggKzQ3OCw4IEBADQogICAgIH0gZWxz
ZSB7DQogCS8qIG9sZCB0eXBlIGNhcmQgKi8NCiAJdHVwbGUuRGVzaXJlZFR1cGxlID0gQ0lTVFBM
X01BTkZJRDsNCi0JaWYgKENhcmRTZXJ2aWNlcyhHZXRGaXJzdFR1cGxlLCBoYW5kbGUsICZ0dXBs
ZSkgPT0gQ1NfU1VDQ0VTUykNCi0JICAgIENTX0NIRUNLKEdldFR1cGxlRGF0YSwgaGFuZGxlLCAm
dHVwbGUpOw0KKwlpZiAocGNtY2lhX2dldF9maXJzdF90dXBsZShoYW5kbGUsICZ0dXBsZSkgPT0g
Q1NfU1VDQ0VTUykNCisJICAgIENTX0NIRUNLKEdldFR1cGxlRGF0YSwgcGNtY2lhX2dldF90dXBs
ZV9kYXRhKGhhbmRsZSwgJnR1cGxlKSk7DQogCWVsc2UNCiAJICAgIGJ1ZlswXSA9IDB4ZmZmZjsN
CiAJc3dpdGNoIChsZTE2X3RvX2NwdShidWZbMF0pKSB7DQpAQCAtNTEwLDEwICs1MTAsMTAgQEAN
CiAJcmV0ID0gdW5nZXJtYW5uX3RyeV9pb19wb3J0KGxpbmspOw0KIAlpZiAocmV0ICE9IENTX1NV
Q0NFU1MpIGdvdG8gY3NfZmFpbGVkOw0KICAgICB9IGVsc2UgeyANCi0JQ1NfQ0hFQ0soUmVxdWVz
dElPLCBsaW5rLT5oYW5kbGUsICZsaW5rLT5pbyk7DQorCUNTX0NIRUNLKFJlcXVlc3RJTywgcGNt
Y2lhX3JlcXVlc3RfaW8obGluay0+aGFuZGxlLCAmbGluay0+aW8pKTsNCiAgICAgfQ0KLSAgICBD
U19DSEVDSyhSZXF1ZXN0SVJRLCBsaW5rLT5oYW5kbGUsICZsaW5rLT5pcnEpOw0KLSAgICBDU19D
SEVDSyhSZXF1ZXN0Q29uZmlndXJhdGlvbiwgbGluay0+aGFuZGxlLCAmbGluay0+Y29uZik7DQor
ICAgIENTX0NIRUNLKFJlcXVlc3RJUlEsIHBjbWNpYV9yZXF1ZXN0X2lycShsaW5rLT5oYW5kbGUs
ICZsaW5rLT5pcnEpKTsNCisgICAgQ1NfQ0hFQ0soUmVxdWVzdENvbmZpZ3VyYXRpb24sIHBjbWNp
YV9yZXF1ZXN0X2NvbmZpZ3VyYXRpb24obGluay0+aGFuZGxlLCAmbGluay0+Y29uZikpOw0KICAg
ICBkZXYtPmlycSA9IGxpbmstPmlycS5Bc3NpZ25lZElSUTsNCiAgICAgZGV2LT5iYXNlX2FkZHIg
PSBsaW5rLT5pby5CYXNlUG9ydDE7DQogICAgIGlmIChyZWdpc3Rlcl9uZXRkZXYoZGV2KSAhPSAw
KSB7DQpAQCAtNTQ2LDE3ICs1NDYsMTcgQEANCiAgICAgY2FzZSBDT05URUM6DQogCXR1cGxlLkRl
c2lyZWRUdXBsZSA9IENJU1RQTF9GVU5DRTsNCiAJdHVwbGUuVHVwbGVPZmZzZXQgPSAwOw0KLQlD
U19DSEVDSyhHZXRGaXJzdFR1cGxlLCBoYW5kbGUsICZ0dXBsZSk7DQorCUNTX0NIRUNLKEdldEZp
cnN0VHVwbGUsIHBjbWNpYV9nZXRfZmlyc3RfdHVwbGUoaGFuZGxlLCAmdHVwbGUpKTsNCiAJdHVw
bGUuVHVwbGVPZmZzZXQgPSAwOw0KLQlDU19DSEVDSyhHZXRUdXBsZURhdGEsIGhhbmRsZSwgJnR1
cGxlKTsNCisJQ1NfQ0hFQ0soR2V0VHVwbGVEYXRhLCBwY21jaWFfZ2V0X3R1cGxlX2RhdGEoaGFu
ZGxlLCAmdHVwbGUpKTsNCiAJaWYgKGNhcmR0eXBlID09IE1CSDEwMzA0KSB7DQogCSAgICAvKiBN
QkgxMDMwNCdzIENJU19GVU5DRSBpcyBjb3JydXB0ZWQgKi8NCiAJICAgIG5vZGVfaWQgPSAmKHR1
cGxlLlR1cGxlRGF0YVs1XSk7DQogCSAgICBjYXJkX25hbWUgPSAiRk1WLUoxODIiOw0KIAl9IGVs
c2Ugew0KIAkgICAgd2hpbGUgKHR1cGxlLlR1cGxlRGF0YVswXSAhPSBDSVNUUExfRlVOQ0VfTEFO
X05PREVfSUQgKSB7DQotCQlDU19DSEVDSyhHZXROZXh0VHVwbGUsIGhhbmRsZSwgJnR1cGxlKSA7
DQotCQlDU19DSEVDSyhHZXRUdXBsZURhdGEsIGhhbmRsZSwgJnR1cGxlKSA7DQorCQlDU19DSEVD
SyhHZXROZXh0VHVwbGUsIHBjbWNpYV9nZXRfbmV4dF90dXBsZShoYW5kbGUsICZ0dXBsZSkpOw0K
KwkJQ1NfQ0hFQ0soR2V0VHVwbGVEYXRhLCBwY21jaWFfZ2V0X3R1cGxlX2RhdGEoaGFuZGxlLCAm
dHVwbGUpKTsNCiAJICAgIH0NCiAJICAgIG5vZGVfaWQgPSAmKHR1cGxlLlR1cGxlRGF0YVsyXSk7
DQogCSAgICBpZiggY2FyZHR5cGUgPT0gVERLICkgew0KQEAgLTYzMyw4ICs2MzMsNyBAQA0KICAg
ICByZXEuQXR0cmlidXRlcyA9IFdJTl9EQVRBX1dJRFRIXzh8V0lOX01FTU9SWV9UWVBFX0FNfFdJ
Tl9FTkFCTEU7DQogICAgIHJlcS5CYXNlID0gMDsgcmVxLlNpemUgPSAwOw0KICAgICByZXEuQWNj
ZXNzU3BlZWQgPSAwOw0KLSAgICBsaW5rLT53aW4gPSAod2luZG93X2hhbmRsZV90KWxpbmstPmhh
bmRsZTsNCi0gICAgaSA9IENhcmRTZXJ2aWNlcyhSZXF1ZXN0V2luZG93LCAmbGluay0+d2luLCAm
cmVxKTsNCisgICAgaSA9IHBjbWNpYV9yZXF1ZXN0X3dpbmRvdygmbGluay0+aGFuZGxlLCAmcmVx
LCAmbGluay0+d2luKTsNCiAgICAgaWYgKGkgIT0gQ1NfU1VDQ0VTUykgew0KIAljc19lcnJvcihs
aW5rLT5oYW5kbGUsIFJlcXVlc3RXaW5kb3csIGkpOw0KIAlyZXR1cm4gLTE7DQpAQCAtNjQzLDcg
KzY0Miw3IEBADQogICAgIGJhc2UgPSBpb3JlbWFwKHJlcS5CYXNlLCByZXEuU2l6ZSk7DQogICAg
IG1lbS5QYWdlID0gMDsNCiAgICAgbWVtLkNhcmRPZmZzZXQgPSAwOw0KLSAgICBDYXJkU2Vydmlj
ZXMoTWFwTWVtUGFnZSwgbGluay0+d2luLCAmbWVtKTsNCisgICAgcGNtY2lhX21hcF9tZW1fcGFn
ZShsaW5rLT53aW4sICZtZW0pOw0KIA0KICAgICAvKg0KICAgICAgKiAgTUJIMTAzMDQgQ0lTVFBM
X0ZVTkNFX0xBTl9OT0RFX0lEIGZvcm1hdA0KQEAgLTY2OCw3ICs2NjcsNyBAQA0KICAgICB9DQog
DQogICAgIGlvdW5tYXAoYmFzZSk7DQotICAgIGogPSBDYXJkU2VydmljZXMoUmVsZWFzZVdpbmRv
dywgbGluay0+d2luKTsNCisgICAgaiA9IHBjbWNpYV9yZWxlYXNlX3dpbmRvdyhsaW5rLT53aW4p
Ow0KICAgICBpZiAoaiAhPSBDU19TVUNDRVNTKQ0KIAljc19lcnJvcihsaW5rLT5oYW5kbGUsIFJl
bGVhc2VXaW5kb3csIGopOw0KICAgICByZXR1cm4gKGkgIT0gMHgyMDApID8gMCA6IC0xOw0KQEAg
LTY4OSw4ICs2ODgsNyBAQA0KICAgICByZXEuQXR0cmlidXRlcyA9IFdJTl9EQVRBX1dJRFRIXzh8
V0lOX01FTU9SWV9UWVBFX0FNfFdJTl9FTkFCTEU7DQogICAgIHJlcS5CYXNlID0gMDsgcmVxLlNp
emUgPSAwOw0KICAgICByZXEuQWNjZXNzU3BlZWQgPSAwOw0KLSAgICBsaW5rLT53aW4gPSAod2lu
ZG93X2hhbmRsZV90KWxpbmstPmhhbmRsZTsNCi0gICAgaSA9IENhcmRTZXJ2aWNlcyhSZXF1ZXN0
V2luZG93LCAmbGluay0+d2luLCAmcmVxKTsNCisgICAgaSA9IHBjbWNpYV9yZXF1ZXN0X3dpbmRv
dygmbGluay0+aGFuZGxlLCAmcmVxLCAmbGluay0+d2luKTsNCiAgICAgaWYgKGkgIT0gQ1NfU1VD
Q0VTUykgew0KIAljc19lcnJvcihsaW5rLT5oYW5kbGUsIFJlcXVlc3RXaW5kb3csIGkpOw0KIAly
ZXR1cm4gLTE7DQpAQCAtNjk5LDcgKzY5Nyw3IEBADQogICAgIGJhc2UgPSBpb3JlbWFwKHJlcS5C
YXNlLCByZXEuU2l6ZSk7DQogICAgIG1lbS5QYWdlID0gMDsNCiAgICAgbWVtLkNhcmRPZmZzZXQg
PSAwOw0KLSAgICBDYXJkU2VydmljZXMoTWFwTWVtUGFnZSwgbGluay0+d2luLCAmbWVtKTsNCisg
ICAgcGNtY2lhX21hcF9tZW1fcGFnZShsaW5rLT53aW4sICZtZW0pOw0KIA0KICAgICBpb2FkZHIg
PSBkZXYtPmJhc2VfYWRkcjsNCiAgICAgd3JpdGViKDB4NDcsIGJhc2UrMHg4MDApOwkvKiBDb25m
aWcgT3B0aW9uIFJlZ2lzdGVyIG9mIExBTiAqLw0KQEAgLTcxMiw3ICs3MTAsNyBAQA0KICAgICB3
cml0ZWIoMHg4LCBiYXNlKzB4ODIyKTsJLyogQ29uZmlnIGFuZCBTdGF0dXMgUmVnaXN0ZXIgKi8N
CiANCiAgICAgaW91bm1hcChiYXNlKTsNCi0gICAgaiA9IENhcmRTZXJ2aWNlcyhSZWxlYXNlV2lu
ZG93LCBsaW5rLT53aW4pOw0KKyAgICBqID0gcGNtY2lhX3JlbGVhc2Vfd2luZG93KGxpbmstPndp
bik7DQogICAgIGlmIChqICE9IENTX1NVQ0NFU1MpDQogCWNzX2Vycm9yKGxpbmstPmhhbmRsZSwg
UmVsZWFzZVdpbmRvdywgaik7DQogICAgIHJldHVybiAwOw0KQEAgLTczNywxMCArNzM1LDEwIEBA
DQogICAgIH0NCiANCiAgICAgLyogRG9uJ3QgYm90aGVyIGNoZWNraW5nIHRvIHNlZSBpZiB0aGVz
ZSBzdWNjZWVkIG9yIG5vdCAqLw0KLSAgICBDYXJkU2VydmljZXMoUmVsZWFzZVdpbmRvdywgbGlu
ay0+d2luKTsNCi0gICAgQ2FyZFNlcnZpY2VzKFJlbGVhc2VDb25maWd1cmF0aW9uLCBsaW5rLT5o
YW5kbGUpOw0KLSAgICBDYXJkU2VydmljZXMoUmVsZWFzZUlPLCBsaW5rLT5oYW5kbGUsICZsaW5r
LT5pbyk7DQotICAgIENhcmRTZXJ2aWNlcyhSZWxlYXNlSVJRLCBsaW5rLT5oYW5kbGUsICZsaW5r
LT5pcnEpOw0KKyAgICBwY21jaWFfcmVsZWFzZV93aW5kb3cobGluay0+d2luKTsNCisgICAgcGNt
Y2lhX3JlbGVhc2VfY29uZmlndXJhdGlvbihsaW5rLT5oYW5kbGUpOw0KKyAgICBwY21jaWFfcmVs
ZWFzZV9pbyhsaW5rLT5oYW5kbGUsICZsaW5rLT5pbyk7DQorICAgIHBjbWNpYV9yZWxlYXNlX2ly
cShsaW5rLT5oYW5kbGUsICZsaW5rLT5pcnEpOw0KICAgICANCiAgICAgbGluay0+c3RhdGUgJj0g
fkRFVl9DT05GSUc7DQogDQpAQCAtNzc3LDcgKzc3NSw3IEBADQogCWlmIChsaW5rLT5zdGF0ZSAm
IERFVl9DT05GSUcpIHsNCiAJICAgIGlmIChsaW5rLT5vcGVuKQ0KIAkJbmV0aWZfZGV2aWNlX2Rl
dGFjaChkZXYpOw0KLQkgICAgQ2FyZFNlcnZpY2VzKFJlbGVhc2VDb25maWd1cmF0aW9uLCBsaW5r
LT5oYW5kbGUpOw0KKwkgICAgcGNtY2lhX3JlbGVhc2VfY29uZmlndXJhdGlvbihsaW5rLT5oYW5k
bGUpOw0KIAl9DQogCWJyZWFrOw0KICAgICBjYXNlIENTX0VWRU5UX1BNX1JFU1VNRToNCkBAIC03
ODUsNyArNzgzLDcgQEANCiAJLyogRmFsbCB0aHJvdWdoLi4uICovDQogICAgIGNhc2UgQ1NfRVZF
TlRfQ0FSRF9SRVNFVDoNCiAJaWYgKGxpbmstPnN0YXRlICYgREVWX0NPTkZJRykgew0KLQkgICAg
Q2FyZFNlcnZpY2VzKFJlcXVlc3RDb25maWd1cmF0aW9uLCBsaW5rLT5oYW5kbGUsICZsaW5rLT5j
b25mKTsNCisJICAgIHBjbWNpYV9yZXF1ZXN0X2NvbmZpZ3VyYXRpb24obGluay0+aGFuZGxlLCAm
bGluay0+Y29uZik7DQogCSAgICBpZiAobGluay0+b3Blbikgew0KIAkJZmpuX3Jlc2V0KGRldik7
DQogCQluZXRpZl9kZXZpY2VfYXR0YWNoKGRldik7DQoNCg0KDQo=

--=-TrvjWT62KtUG8JSjeAnD--

--=-cY3QITGn39CCToKbMwlN
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.3 (GNU/Linux)

iD8DBQA/5ooH78o9R9NraMQRAlHZAJ47ny/cO7u6s2Hmpgbq3GZUSKm0kACaA/dR
vZByArmbqCMh9Wm67p5mSfo=
=nE8q
-----END PGP SIGNATURE-----

--=-cY3QITGn39CCToKbMwlN--

