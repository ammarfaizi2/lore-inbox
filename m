Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S285753AbRLTB2r>; Wed, 19 Dec 2001 20:28:47 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S285750AbRLTB22>; Wed, 19 Dec 2001 20:28:28 -0500
Received: from ikura.fe.dis.titech.ac.jp ([131.112.171.65]:6796 "HELO
	ikura.fe.dis.titech.ac.jp") by vger.kernel.org with SMTP
	id <S285747AbRLTB2M>; Wed, 19 Dec 2001 20:28:12 -0500
Date: Thu, 20 Dec 2001 10:28:08 +0900
Message-ID: <w53k7viy91z.wl@megaela.fe.dis.titech.ac.jp>
From: GOTO Masanori <gotom@debian.org>
To: jfl@jfworld.net
Cc: linux-kernel@vger.kernel.org, gotom@debian.org
Subject: Re: UDMA problem with Maxtor 7200rpm disk
In-Reply-To: In your message of "Wed, 19 Dec 2001 15:16:36 -0500"
	<20011219151636.50e930ac.jfl@jfworld.net>
In-Reply-To: <20011219151636.50e930ac.jfl@jfworld.net>
User-Agent: Wanderlust/2.2.15 (More Than Words) EMIKO/1.13.9 (Euglena tripteris) FLIM/1.13.2 (Kasanui) APEL/10.2 MULE XEmacs/21.1 (patch 10) (Capitol Reef) (i386-debian-linux)
MIME-Version: 1.0 (generated by EMIKO 1.13.9 - "Euglena tripteris")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 19 Dec 2001 15:16:36 -0500,
Jean-Francois Levesque <jfl@jfworld.net> wrote:
> I have a problem regarding my new Asus A7V266 board with VIA KT266 chipset.  Byron Stanoszek told me to ask my problem to this list so here it is :
> 
> My hard drive is a Maxtor 5T030H3 ATA DISK drive (30 gig).  The problem is that I'm not able to read more than 7 MB/sec :
> 
> [root@xyz jfl]# /sbin/hdparm -t /dev/hda
> 
> /dev/hda:
>  Timing buffered disk reads:  64 MB in  9.18 seconds =  6.97 MB/sec
> 
> 
> [root@xyz jfl]# /sbin/hdparm -d1 -X66 /dev/hda
> 
> /dev/hda:
>  setting using_dma to 1 (on)
>  setting xfermode to 66 (UltraDMA mode2)
>  using_dma    =  1 (on)
> [root@xyz jfl]# /sbin/hdparm -t /dev/hda
> 
> /dev/hda:
>  Timing buffered disk reads:  64 MB in  9.70 seconds =  6.60 MB/sec
> 
> [root@xyz jfl]# /sbin/hdparm /dev/hda
> 
> /dev/hda:
>  multcount    = 16 (on)
>  I/O support  =  1 (32-bit)
>  unmaskirq    =  1 (on)
>  using_dma    =  0 (off)
>  keepsettings =  0 (off)
>  nowerr       =  0 (off)
>  readonly     =  0 (off)
>  readahead    =  8 (on)
>  geometry     = 3736/255/63, sectors = 60030432, start = 0
> [root@xyz jfl]#
> 
> I also have some idebus errors.
> 
> The problem seems to be the DMA (ATA100 compatible board and disk).

BIOS parameter of your machine is set as "DISK auto detection" ?  If
you so, would you try to change your BIOS setting as "this disk have
ultra DMA mode 4 (or 5, if your disk is ATA100)" explicitly ?

These behavior is very similar to my enviroment.
I have Asus KT133A board, and I had this problem, but I changed BIOS
setting, all problems were gone and became happy.
If my suggestion is totally wrong, I apologize...
(However, if my suggestion is relevant, then what's the problem?
 IDE driver, or hardware problem?)

> PS: My disk also "freeze" my system for a few seconds (from 1/2 to maybe 3sec) while checking some data.

IMHO, the reason is that writing disk with PIO mode 4 (IIRC, 6.60MB/s
is corresponding with PIO mode 4) invites CPU occupation.
Andrew Morton also fixed 'low latency read problem', which is already
resolved the latest 2.4.17-rc2.

-- gotom
