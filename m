Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261216AbVC1HfU@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261216AbVC1HfU (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 28 Mar 2005 02:35:20 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261261AbVC1HfU
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 28 Mar 2005 02:35:20 -0500
Received: from mail2.asahi-net.or.jp ([202.224.39.198]:48446 "EHLO
	mail.asahi-net.or.jp") by vger.kernel.org with ESMTP
	id S261216AbVC1HfK (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 28 Mar 2005 02:35:10 -0500
Date: Mon, 28 Mar 2005 16:35:06 +0900
Message-ID: <m2mzsonryt.wl%ysato@users.sourceforge.jp>
From: Yoshinori Sato <ysato@users.sourceforge.jp>
To: Andrew Morton <akpm@osdl.org>
Cc: linux-kernel@vger.kernel.org
Subject: [PATCH] nommu.c build error fix
User-Agent: Wanderlust/2.11.30 (Wonderwall) SEMI/1.14.6 (Maruoka) LIMIT/1.14.9 (Domyoji) APEL/10.6 Emacs/21.4 (i386-pc-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

- Argument addition of security_file_mmap.
- Because in_gate_area_no_task undefined with CONFIG_KALLSYM=y, add it.

Signed-off-by: Yoshinori Sato <ysato@users.sourceforge.jp>

===== mm/nommu.c 1.32 vs edited =====
--- 1.32/mm/nommu.c	2005-03-10 00:12:40 +09:00
+++ edited/mm/nommu.c	2005-03-28 16:21:12 +09:00
@@ -396,6 +396,7 @@
 	unsigned int vm_flags;
 	void *result;
 	int ret, membacked;
+	unsigned long reqprot = prot;
 
 	/* do the simple checks first */
 	if (flags & MAP_FIXED || addr) {
@@ -506,7 +507,7 @@
 	}
 
 	/* allow the security API to have its say */
-	ret = security_file_mmap(file, prot, flags);
+	ret = security_file_mmap(file, reqprot, prot, flags);
 	if (ret)
 		return ret;
 
@@ -1061,3 +1062,7 @@
 	return -ENOMEM;
 }
 
+int in_gate_area_no_task(unsigned long addr)
+{
+	return 0;
+}

-- 
Yoshinori Sato
<ysato@users.sourceforge.jp>
