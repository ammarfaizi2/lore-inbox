Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S289466AbSBKNmy>; Mon, 11 Feb 2002 08:42:54 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S289372AbSBKNmo>; Mon, 11 Feb 2002 08:42:44 -0500
Received: from dell-paw-3.cambridge.redhat.com ([195.224.55.237]:33526 "HELO
	executor.cambridge.redhat.com") by vger.kernel.org with SMTP
	id <S289466AbSBKNmd>; Mon, 11 Feb 2002 08:42:33 -0500
To: torvalds@transmeta.com
Cc: linux-kernel@vger.kernel.org
Subject: [PATCH] 2.5.4 compile error fix
User-Agent: EMH/1.14.1 SEMI/1.14.3 (Ushinoya) FLIM/1.14.3
 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.1
 (i386-redhat-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
Date: Mon, 11 Feb 2002 13:42:31 +0000
Message-ID: <12039.1013434951@warthog.cambridge.redhat.com>
From: David Howells <dhowells@redhat.com>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


Hi Linus,

This patch fixes <asm-i386/processor.h> trying to access task_struct (which
can't have been defined at that point).

David

diff -uNr linux-2.5.4/include/asm-i386/processor.h linux-orn-254/include/asm-i386/processor.h
--- linux-2.5.4/include/asm-i386/processor.h	Mon Feb 11 09:41:35 2002
+++ linux-orn-254/include/asm-i386/processor.h	Mon Feb 11 10:29:29 2002
@@ -439,10 +439,7 @@
 /*
  * Return saved PC of a blocked thread.
  */
-static inline unsigned long thread_saved_pc(struct task_struct *tsk)
-{
-	return ((unsigned long *)tsk->thread->esp)[3];
-}
+#define thread_saved_pc(TSK) (((unsigned long *)(TSK)->thread.esp)[3])
 
 unsigned long get_wchan(struct task_struct *p);
 #define KSTK_EIP(tsk)	(((unsigned long *)(4096+(unsigned long)(tsk)->thread_info))[1019])
