Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261316AbTI3KHE (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 30 Sep 2003 06:07:04 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261321AbTI3KHE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 30 Sep 2003 06:07:04 -0400
Received: from ns.suse.de ([195.135.220.2]:14538 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S261316AbTI3KG5 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 30 Sep 2003 06:06:57 -0400
Date: Tue, 30 Sep 2003 12:06:52 +0200
Message-ID: <s5hhe2ubner.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: linux-kernel@vger.kernel.org
Subject: Re: [2.6.0-test6] Troubles with ALSA via82xx
In-Reply-To: <20030929170437.GA805@dreamland.darkstar.lan>
References: <20030929170437.GA805@dreamland.darkstar.lan>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: multipart/mixed;
 boundary="Multipart_Tue_Sep_30_12:06:52_2003-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--Multipart_Tue_Sep_30_12:06:52_2003-1
Content-Type: text/plain; charset=US-ASCII

At Mon, 29 Sep 2003 19:04:37 +0200,
Kronos wrote:
> 
> Hi,
> 
> I have trouble with linux-2.6.0-test6 and via82xx. With default
> parameters I'm unable to play sound. I've tracked down the problem to
> this change:
> 
>    - use dxs_support=3 (48k fixed) as default, since there are so many
>      problems with dxs_support=0.
> 
> Loading module I see this:
> 
> via82xx: Assuming DXS channels with 48k fixed sample rate.
>          Please try dxs_support=1 option and report if it works on your machine.
> PCI: Setting latency timer of device 0000:00:11.5 to 64

please try the attached patch?

--
Takashi Iwai <tiwai dot suse.de>		ALSA Developer - www.alsa-project.org

--Multipart_Tue_Sep_30_12:06:52_2003-1
Content-Type: application/octet-stream
Content-Disposition: attachment; filename="via8233a-fix.dif"
Content-Transfer-Encoding: 7bit

diff -u -r1.60 via82xx.c
--- linux/sound/pci/via82xx.c	22 Sep 2003 10:10:29 -0000	1.60
+++ linux/sound/pci/via82xx.c	30 Sep 2003 10:02:13 -0000
@@ -2038,16 +2038,17 @@
 				break;
 			}
 		}
-		if (dxs_support[dev] == VIA_DXS_AUTO)
-			dxs_support[dev] = check_dxs_list(pci);
-		/* force to use VIA8233 or 8233A model according to
-		 * dxs_support module option
-		 */
-		if (dxs_support[dev] == VIA_DXS_DISABLE)
-			chip_type = TYPE_VIA8233A;
-		else
-			chip_type = TYPE_VIA8233;
-
+		if (chip_type != TYPE_VIA8233A) {
+			if (dxs_support[dev] == VIA_DXS_AUTO)
+				dxs_support[dev] = check_dxs_list(pci);
+			/* force to use VIA8233 or 8233A model according to
+			 * dxs_support module option
+			 */
+			if (dxs_support[dev] == VIA_DXS_DISABLE)
+				chip_type = TYPE_VIA8233A;
+			else
+				chip_type = TYPE_VIA8233;
+		}
 		if (chip_type == TYPE_VIA8233A)
 			strcpy(card->driver, "VIA8233A");
 		else

--Multipart_Tue_Sep_30_12:06:52_2003-1--
