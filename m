Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261682AbUE1VUy@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261682AbUE1VUy (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 28 May 2004 17:20:54 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261711AbUE1VUy
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 28 May 2004 17:20:54 -0400
Received: from mail.homelink.ru ([81.9.33.123]:24727 "EHLO eltel.net")
	by vger.kernel.org with ESMTP id S261682AbUE1VUc (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 28 May 2004 17:20:32 -0400
Date: Sat, 29 May 2004 01:20:30 +0400
From: Andrew Zabolotny <zap@homelink.ru>
To: linux-kernel@vger.kernel.org
Cc: Greg KH <greg@kroah.com>
Subject: two patches - request for comments
Message-Id: <20040529012030.795ad27e.zap@homelink.ru>
Organization: home
X-Mailer: Sylpheed version 0.9.6 (GTK+ 1.2.10; i686-pc-linux-gnu)
X-Face: #%`a@cSvZ:n@M%n/to$C^!{JE%'%7_0xb("Hr%7Z0LDKO7?w=m~CU#d@-.2yO<l^giDz{>9
 epB|2@pe{%4[Q3pw""FeqiT6rOc>+8|ED/6=Eh/4l3Ru>qRC]ef%ojRz;GQb=uqI<yb'yaIIzq^NlL
 rf<gnIz)JE/7:KmSsR[wN`b\l8:z%^[gNq#d1\QSuya1(
Mime-Version: 1.0
Content-Type: multipart/mixed;
 boundary="Multipart=_Sat__29_May_2004_01_20_30_+0400_HQYOhV0ieAcECWsm"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

--Multipart=_Sat__29_May_2004_01_20_30_+0400_HQYOhV0ieAcECWsm
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Hello!

I'm going to submit the class_find_device() patch (attached for your
convenience) as a pre-requisite for the backlight/lcd device class patch
(also included so that you can take at it as well) via Russel King (the
backlight/lcd patch is needed for our ARM-based handhelds framebuffer
devices). Any comments/objections are welcome.

The LCD and backlight device classes were implemented with the following in
mind:

a) Allow user-mode code to control backlight and lcd (notably for
handhelds this is a must). This is done via sysfs (/sys/class/backlight/XXX/
and /sys/class/lcd/XXX/ where XXX is something like mq1100fb0).

b) Allow framebuffer devices to find and contact the respective backlight and
lcd devices (they are using the same name as the framebuffer device). This is
needed to implement the respective calls to backlight and lcd devices for
power management.

--
Greetings,
   Andrew

P.S. I've posted a similar message on linux-fbdev mailing listt; forgive me if
you seen it twice.

--Multipart=_Sat__29_May_2004_01_20_30_+0400_HQYOhV0ieAcECWsm
Content-Type: application/octet-stream;
 name="class.diff"
Content-Disposition: attachment;
 filename="class.diff"
Content-Transfer-Encoding: base64

LS0tIGxpbnV4LTIuNi42L2RyaXZlcnMvYmFzZS9jbGFzcy5jCTIwMDQtMDUtMTAgMDY6MzM6MjEu
MDAwMDAwMDAwICswNDAwCisrKyBsaW51eC0yLjYuNi1oaDAvZHJpdmVycy9iYXNlL2NsYXNzLmMJ
MjAwNC0wNS0yNSAxNToxNzo1Ny4wMDAwMDAwMDAgKzA0MDAKQEAgLTM1OSw3ICszNTksNyBAQAog
CWNsYXNzX2RldmljZV9wdXQoY2xhc3NfZGV2KTsKIH0KIAotaW50IGNsYXNzX2RldmljZV9yZW5h
bWUoc3RydWN0IGNsYXNzX2RldmljZSAqY2xhc3NfZGV2LCBjaGFyICpuZXdfbmFtZSkKK2ludCBj
bGFzc19kZXZpY2VfcmVuYW1lKHN0cnVjdCBjbGFzc19kZXZpY2UgKmNsYXNzX2RldiwgY29uc3Qg
Y2hhciAqbmV3X25hbWUpCiB7CiAJY2xhc3NfZGV2ID0gY2xhc3NfZGV2aWNlX2dldChjbGFzc19k
ZXYpOwogCWlmICghY2xhc3NfZGV2KQpAQCAtMzc3LDYgKzM3NywzMyBAQAogCXJldHVybiAwOwog
fQogCisvKioKKyAqIGNsYXNzX2RldmljZV9maW5kIC0gZmluZCBhIHN0cnVjdCBjbGFzc19kZXZp
Y2UgaW4gYSBzcGVjaWZpYyBjbGFzcworICogQGNsYXNzOiB0aGUgY2xhc3MgdG8gc2VhcmNoCisg
KiBAY2xhc3NfaWQ6IHRoZSBjbGFzc19pZCB0byBzZWFyY2ggZm9yCisgKgorICogSXRlcmF0ZXMg
dGhyb3VnaCB0aGUgbGlzdCBvZiBhbGwgY2xhc3MgZGV2aWNlcyByZWdpc3RlcmVkIHRvIGEgY2xh
c3MuIElmCisgKiB0aGUgY2xhc3NfaWQgaXMgZm91bmQsIGl0cyByZWZlcmVuY2UgY291bnQgaXMg
aW5jcmVtZW50ZWQgYW5kIHJldHVybmVkIHRvCisgKiB0aGUgY2FsbGVyLiBJZiB0aGUgY2xhc3Nf
aWQgZG9lcyBub3QgbWF0Y2ggYW55IGV4aXN0aW5nIHN0cnVjdCBjbGFzc19kZXZpY2UKKyAqIHJl
Z2lzdGVyZWQgdG8gdGhpcyBzdHJ1Y3QgY2xhc3MsIHRoZW4gTlVMTCBpcyByZXR1cm5lZC4KKyAq
Lworc3RydWN0IGNsYXNzX2RldmljZSAqIGNsYXNzX2RldmljZV9maW5kKHN0cnVjdCBjbGFzcyAq
Y2xhc3MsIGNvbnN0IGNoYXIgKmNsYXNzX2lkKQoreworCXN0cnVjdCBjbGFzc19kZXZpY2UgKmNs
YXNzX2RldjsKKwlzdHJ1Y3QgY2xhc3NfZGV2aWNlICpmb3VuZCA9IE5VTEw7CisKKwlkb3duX3Jl
YWQoJmNsYXNzLT5zdWJzeXMucndzZW0pOworCWxpc3RfZm9yX2VhY2hfZW50cnkoY2xhc3NfZGV2
LCAmY2xhc3MtPmNoaWxkcmVuLCBub2RlKSB7CisJCWlmIChzdHJjbXAoY2xhc3NfZGV2LT5jbGFz
c19pZCwgY2xhc3NfaWQpID09IDApIHsKKwkJCWZvdW5kID0gY2xhc3NfZGV2aWNlX2dldChjbGFz
c19kZXYpOworCQkJYnJlYWs7CisJCX0KKwl9CisJdXBfcmVhZCgmY2xhc3MtPnN1YnN5cy5yd3Nl
bSk7CisKKwlyZXR1cm4gZm91bmQ7Cit9CisKIHN0cnVjdCBjbGFzc19kZXZpY2UgKiBjbGFzc19k
ZXZpY2VfZ2V0KHN0cnVjdCBjbGFzc19kZXZpY2UgKmNsYXNzX2RldikKIHsKIAlpZiAoY2xhc3Nf
ZGV2KQpAQCAtMzg5LDcgKzQxNiw2IEBACiAJa29iamVjdF9wdXQoJmNsYXNzX2Rldi0+a29iaik7
CiB9CiAKLQogaW50IGNsYXNzX2ludGVyZmFjZV9yZWdpc3RlcihzdHJ1Y3QgY2xhc3NfaW50ZXJm
YWNlICpjbGFzc19pbnRmKQogewogCXN0cnVjdCBjbGFzcyAqIHBhcmVudDsKQEAgLTQ2OCw2ICs0
OTQsOCBAQAogRVhQT1JUX1NZTUJPTChjbGFzc19kZXZpY2VfcHV0KTsKIEVYUE9SVF9TWU1CT0wo
Y2xhc3NfZGV2aWNlX2NyZWF0ZV9maWxlKTsKIEVYUE9SVF9TWU1CT0woY2xhc3NfZGV2aWNlX3Jl
bW92ZV9maWxlKTsKK0VYUE9SVF9TWU1CT0woY2xhc3NfZGV2aWNlX3JlbmFtZSk7CitFWFBPUlRf
U1lNQk9MKGNsYXNzX2RldmljZV9maW5kKTsKIAogRVhQT1JUX1NZTUJPTChjbGFzc19pbnRlcmZh
Y2VfcmVnaXN0ZXIpOwogRVhQT1JUX1NZTUJPTChjbGFzc19pbnRlcmZhY2VfdW5yZWdpc3Rlcik7
Ci0tLSBsaW51eC0yLjYuNi9pbmNsdWRlL2xpbnV4L2RldmljZS5oCTIwMDQtMDUtMTAgMDY6MzM6
MTkuMDAwMDAwMDAwICswNDAwCisrKyBsaW51eC0yLjYuNi1oaDAvaW5jbHVkZS9saW51eC9kZXZp
Y2UuaAkyMDA0LTA1LTI1IDAxOjU0OjMwLjAwMDAwMDAwMCArMDQwMApAQCAtMjEyLDggKzIxMiw5
IEBACiBleHRlcm4gaW50IGNsYXNzX2RldmljZV9hZGQoc3RydWN0IGNsYXNzX2RldmljZSAqKTsK
IGV4dGVybiB2b2lkIGNsYXNzX2RldmljZV9kZWwoc3RydWN0IGNsYXNzX2RldmljZSAqKTsKIAot
ZXh0ZXJuIGludCBjbGFzc19kZXZpY2VfcmVuYW1lKHN0cnVjdCBjbGFzc19kZXZpY2UgKiwgY2hh
ciAqKTsKK2V4dGVybiBpbnQgY2xhc3NfZGV2aWNlX3JlbmFtZShzdHJ1Y3QgY2xhc3NfZGV2aWNl
ICosIGNvbnN0IGNoYXIgKik7CiAKK2V4dGVybiBzdHJ1Y3QgY2xhc3NfZGV2aWNlICogY2xhc3Nf
ZGV2aWNlX2ZpbmQoc3RydWN0IGNsYXNzICpjbGFzcywgY29uc3QgY2hhciAqY2xhc3NfaWQpOwog
ZXh0ZXJuIHN0cnVjdCBjbGFzc19kZXZpY2UgKiBjbGFzc19kZXZpY2VfZ2V0KHN0cnVjdCBjbGFz
c19kZXZpY2UgKik7CiBleHRlcm4gdm9pZCBjbGFzc19kZXZpY2VfcHV0KHN0cnVjdCBjbGFzc19k
ZXZpY2UgKik7CiAK

--Multipart=_Sat__29_May_2004_01_20_30_+0400_HQYOhV0ieAcECWsm
Content-Type: application/octet-stream;
 name="bl-lcd.diff"
Content-Disposition: attachment;
 filename="bl-lcd.diff"
Content-Transfer-Encoding: base64

LS0tIGxpbnV4LTIuNi42L2luY2x1ZGUvbGludXgvbGNkLmgJMTk3MC0wMS0wMSAwMzowMDowMC4w
MDAwMDAwMDAgKzAzMDAKKysrIGxpbnV4LTIuNi42LWhoMC9pbmNsdWRlL2xpbnV4L2xjZC5oCTIw
MDQtMDUtMjcgMjI6NDg6MTguMDAwMDAwMDAwICswNDAwCkBAIC0wLDAgKzEsNjAgQEAKKy8qCisg
KiBMQ0QgTG93bGV2ZWwgQ29udHJvbCBBYnN0cmFjdGlvbgorICogCisgKiBDb3B5cmlnaHQgKEMp
IDIwMDMsMjAwNCBIZXdsZXR0LVBhY2thcmQgQ29tcGFueQorICogCisgKi8KKworI2lmbmRlZiBf
TElOVVhfTENEX0gKKyNkZWZpbmUgX0xJTlVYX0xDRF9ICisKKyNpbmNsdWRlIDxsaW51eC9kZXZp
Y2UuaD4KKworc3RydWN0IGxjZF9kZXZpY2U7CisKKy8qIFRoaXMgc3RydWN0dXJlIGRlZmluZXMg
YWxsIHRoZSBwcm9wZXJ0aWVzIG9mIGEgTENEIGZsYXQgcGFuZWwuICovCitzdHJ1Y3QgbGNkX3By
b3BlcnRpZXMgeworCS8qIE93bmVyIG1vZHVsZSAqLworCXN0cnVjdCBtb2R1bGUgKm93bmVyOwor
CS8qIEdldCB0aGUgcG93ZXIgZW5hYmxlZCBzdGF0dXMgKDAvMSkgKi8KKwlpbnQgKCpnZXRfcG93
ZXIpIChzdHJ1Y3QgbGNkX2RldmljZSAqKTsKKwkvKiBFbmFibGUgb3IgZGlzYWJsZSBwb3dlciB0
byB0aGUgTENEICovCisJaW50ICgqc2V0X3Bvd2VyKSAoc3RydWN0IGxjZF9kZXZpY2UgKiwgaW50
IHBvd2VyKTsKKwkvKiBHZXQgdGhlIExDRCBjb250cm9sbGVyIGVuYWJsZWQgc3RhdHVzICgwLzEp
ICovCisJaW50ICgqZ2V0X2VuYWJsZSkgKHN0cnVjdCBsY2RfZGV2aWNlICopOworCS8qIEVuYWJs
ZSBvciBkaXNhYmxlIHRoZSBMQ0QgY29udHJvbGxlciAqLworCWludCAoKnNldF9lbmFibGUpIChz
dHJ1Y3QgbGNkX2RldmljZSAqLCBpbnQgZW5hYmxlKTsKKwkvKiBUaGUgbWF4aW11bSB2YWx1ZSBm
b3IgY29udHJhc3QgKHJlYWQtb25seSkgKi8KKwlpbnQgbWF4X2NvbnRyYXN0OworCS8qIEdldCB0
aGUgY3VycmVudCBjb250cmFzdCBzZXR0aW5nICgwLW1heF9jb250cmFzdCkgKi8KKwlpbnQgKCpn
ZXRfY29udHJhc3QpIChzdHJ1Y3QgbGNkX2RldmljZSAqKTsKKwkvKiBTZXQgTENEIHBhbmVsIGNv
bnRyYXN0ICovCisJaW50ICgqc2V0X2NvbnRyYXN0KSAoc3RydWN0IGxjZF9kZXZpY2UgKiwgaW50
IGNvbnRyYXN0KTsKK307CisKK3N0cnVjdCBsY2RfZGV2aWNlIHsKKwkvKiBUaGlzIHByb3RlY3Rz
IHRoZSAncHJvcHMnIGZpZWxkLiBJZiAncHJvcHMnIGlzIE5VTEwsIHRoZSBkcml2ZXIgdGhhdAor
CSAgIHJlZ2lzdGVyZWQgdGhpcyBkZXZpY2UgaGFzIGJlZW4gdW5sb2FkZWQsIGFuZCBpZiBjbGFz
c19kZXZkYXRhKCkKKwkgICBwb2ludHMgdG8gc29tZXRoaW5nIGluIHRoZSBib2R5IG9mIHRoYXQg
ZHJpdmVyLCBpdCBpcyBhbHNvIGludmFsaWQuICovCisJc3RydWN0IHNlbWFwaG9yZSBzZW07CisJ
LyogSWYgdGhpcyBpcyBOVUxMLCB0aGUgYmFja2luZyBtb2R1bGUgaXMgdW5sb2FkZWQgKi8KKwlz
dHJ1Y3QgbGNkX3Byb3BlcnRpZXMgKnByb3BzOworCS8qIFRoZSBjbGFzcyBkZXZpY2Ugc3RydWN0
dXJlICovCisJc3RydWN0IGNsYXNzX2RldmljZSBjbGFzc19kZXY7Cit9OworCitleHRlcm4gaW50
IGxjZF9kZXZpY2VfcmVnaXN0ZXIoY29uc3QgY2hhciAqbmFtZSwgdm9pZCAqZGV2ZGF0YSwKKwlz
dHJ1Y3QgbGNkX3Byb3BlcnRpZXMgKmxwKTsKK2V4dGVybiB2b2lkIGxjZF9kZXZpY2VfdW5yZWdp
c3Rlcihjb25zdCBjaGFyICpuYW1lKTsKKworZXh0ZXJuIHN0cnVjdCBsY2RfZGV2aWNlICpsY2Rf
ZGV2aWNlX2ZpbmQoY29uc3QgY2hhciAqbmFtZSk7CitleHRlcm4gc3RydWN0IGxjZF9kZXZpY2Ug
KmxjZF9kZXZpY2VfZ2V0KHN0cnVjdCBsY2RfZGV2aWNlICpsZCk7CitleHRlcm4gdm9pZCBsY2Rf
ZGV2aWNlX3B1dChzdHJ1Y3QgbGNkX2RldmljZSAqbGQpOworCisjZGVmaW5lIHRvX2xjZF9kZXZp
Y2Uob2JqKSBjb250YWluZXJfb2Yob2JqLCBzdHJ1Y3QgbGNkX2RldmljZSwgY2xhc3NfZGV2KQor
CisvKiBUaGUgcmVnaXN0ZXJlZCBjbGllbnRzIG9mIHRoaXMgbm90aWZpZXIgY2hhaW4gd2lsbCBi
ZSBjYWxsZWQgZXZlcnkgdGltZQorICAgYSBuZXcgbGNkIGNsYXNzX2RldmljZSBpcyByZWdpc3Rl
cmVkICovCitleHRlcm4gc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpsY2RfZGV2aWNlX2NoYWluOwor
CisjZW5kaWYKLS0tIGxpbnV4LTIuNi42L2luY2x1ZGUvbGludXgvYmFja2xpZ2h0LmgJMTk3MC0w
MS0wMSAwMzowMDowMC4wMDAwMDAwMDAgKzAzMDAKKysrIGxpbnV4LTIuNi42LWhoMC9pbmNsdWRl
L2xpbnV4L2JhY2tsaWdodC5oCTIwMDQtMDUtMjcgMjI6NDg6MjcuMDAwMDAwMDAwICswNDAwCkBA
IC0wLDAgKzEsNTcgQEAKKy8qCisgKiBCYWNrbGlnaHQgTG93bGV2ZWwgQ29udHJvbCBBYnN0cmFj
dGlvbgorICogCisgKiBDb3B5cmlnaHQgKEMpIDIwMDMsMjAwNCBIZXdsZXR0LVBhY2thcmQgQ29t
cGFueQorICogCisgKi8KKworI2lmbmRlZiBfTElOVVhfQkFDS0xJR0hUX0gKKyNkZWZpbmUgX0xJ
TlVYX0JBQ0tMSUdIVF9ICisKKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKworc3RydWN0IGJh
Y2tsaWdodF9kZXZpY2U7CisKKy8qIFRoaXMgc3RydWN0dXJlIGRlZmluZXMgYWxsIHRoZSBwcm9w
ZXJ0aWVzIG9mIGEgYmFja2xpZ2h0CisgICAodXN1YWxseSBhdHRhY2hlZCB0byBhIExDRCkuICov
CitzdHJ1Y3QgYmFja2xpZ2h0X3Byb3BlcnRpZXMgeworCS8qIE93bmVyIG1vZHVsZSAqLworCXN0
cnVjdCBtb2R1bGUgKm93bmVyOworCS8qIEdldCB0aGUgcG93ZXIgZW5hYmxlZCBzdGF0dXMgKDAv
MSkgKi8KKwlpbnQgKCpnZXRfcG93ZXIpIChzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqKTsKKwkv
KiBFbmFibGUgb3IgZGlzYWJsZSBwb3dlciB0byB0aGUgTENEICovCisJaW50ICgqc2V0X3Bvd2Vy
KSAoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKiwgaW50IHBvd2VyKTsKKwkvKiBNYXhpbWFsIHZh
bHVlIGZvciBicmlnaHRuZXNzIChyZWFkLW9ubHkpICovCisJaW50IG1heF9icmlnaHRuZXNzOwor
CS8qIEdldCBjdXJyZW50IGJhY2tsaWdodCBicmlnaHRuZXNzICovCisJaW50ICgqZ2V0X2JyaWdo
dG5lc3MpIChzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqKTsKKwkvKiBTZXQgYmFja2xpZ2h0IGJy
aWdodG5lc3MgKDAuLm1heF9icmlnaHRuZXNzKSAqLworCWludCAoKnNldF9icmlnaHRuZXNzKSAo
c3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKiwgaW50IGJyaWdodG5lc3MpOworfTsKKworc3RydWN0
IGJhY2tsaWdodF9kZXZpY2UgeworCS8qIFRoaXMgcHJvdGVjdHMgdGhlICdwcm9wcycgZmllbGQu
IElmICdwcm9wcycgaXMgTlVMTCwgdGhlIGRyaXZlciB0aGF0CisJICAgcmVnaXN0ZXJlZCB0aGlz
IGRldmljZSBoYXMgYmVlbiB1bmxvYWRlZCwgYW5kIGlmIGNsYXNzX2RldmRhdGEoKQorCSAgIHBv
aW50cyB0byBzb21ldGhpbmcgaW4gdGhlIGJvZHkgb2YgdGhhdCBkcml2ZXIsIGl0IGlzIGFsc28g
aW52YWxpZC4gKi8KKwlzdHJ1Y3Qgc2VtYXBob3JlIHNlbTsKKwkvKiBJZiB0aGlzIGlzIE5VTEws
IHRoZSBiYWNraW5nIG1vZHVsZSBpcyB1bmxvYWRlZCAqLworCXN0cnVjdCBiYWNrbGlnaHRfcHJv
cGVydGllcyAqcHJvcHM7CisJLyogVGhlIGNsYXNzIGRldmljZSBzdHJ1Y3R1cmUgKi8KKwlzdHJ1
Y3QgY2xhc3NfZGV2aWNlIGNsYXNzX2RldjsKK307CisKK2V4dGVybiBpbnQgYmFja2xpZ2h0X2Rl
dmljZV9yZWdpc3Rlcihjb25zdCBjaGFyICpuYW1lLCB2b2lkICpkZXZkYXRhLAorCQkJCSAgICAg
c3RydWN0IGJhY2tsaWdodF9wcm9wZXJ0aWVzICpicCk7CitleHRlcm4gdm9pZCBiYWNrbGlnaHRf
ZGV2aWNlX3VucmVnaXN0ZXIoY29uc3QgY2hhciAqbmFtZSk7CisKK2V4dGVybiBzdHJ1Y3QgYmFj
a2xpZ2h0X2RldmljZSAqYmFja2xpZ2h0X2RldmljZV9maW5kKGNvbnN0IGNoYXIgKm5hbWUpOwor
ZXh0ZXJuIHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiYWNrbGlnaHRfZGV2aWNlX2dldChzdHJ1
Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQpOworZXh0ZXJuIHZvaWQgYmFja2xpZ2h0X2RldmljZV9w
dXQoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkKTsKKworI2RlZmluZSB0b19iYWNrbGlnaHRf
ZGV2aWNlKG9iaikgY29udGFpbmVyX29mKG9iaiwgc3RydWN0IGJhY2tsaWdodF9kZXZpY2UsIGNs
YXNzX2RldikKKworLyogVGhlIHJlZ2lzdGVyZWQgY2xpZW50cyBvZiB0aGlzIG5vdGlmaWVyIGNo
YWluIHdpbGwgYmUgY2FsbGVkIGV2ZXJ5IHRpbWUKKyAgIGEgbmV3IGJhY2tsaWdodCBjbGFzc19k
ZXZpY2UgaXMgcmVnaXN0ZXJlZCAqLworZXh0ZXJuIHN0cnVjdCBub3RpZmllcl9ibG9jayAqYmFj
a2xpZ2h0X2RldmljZV9jaGFpbjsKKworI2VuZGlmCi0tLSBsaW51eC0yLjYuNi9kcml2ZXJzL3Zp
ZGVvL2xjZC5jCTE5NzAtMDEtMDEgMDM6MDA6MDAuMDAwMDAwMDAwICswMzAwCisrKyBsaW51eC0y
LjYuNi1oaDAvZHJpdmVycy92aWRlby9sY2QuYwkyMDA0LTA1LTI5IDAxOjAwOjUyLjAwMDAwMDAw
MCArMDQwMApAQCAtMCwwICsxLDMzOSBAQAorLyoKKyAqIExDRCBMb3dsZXZlbCBDb250cm9sIEFi
c3RyYWN0aW9uCisgKiAKKyAqIENvcHlyaWdodCAoQykgMjAwMywyMDA0IEhld2xldHQtUGFja2Fy
ZCBDb21wYW55CisgKiAKKyAqLworCisjaW5jbHVkZSA8bGludXgvdmVyc2lvbi5oPgorI2luY2x1
ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L2luaXQuaD4KKyNpbmNsdWRlIDxs
aW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9sY2QuaD4KKyNpbmNsdWRlIDxsaW51eC9u
b3RpZmllci5oPgorI2luY2x1ZGUgPGxpbnV4L2N0eXBlLmg+CisjaW5jbHVkZSA8YXNtL2J1Zy5o
PgorCitzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKmxjZF9kZXZpY2VfY2hhaW47CitFWFBPUlRfU1lN
Qk9MIChsY2RfZGV2aWNlX2NoYWluKTsKKworc3RhdGljIHNzaXplX3QgbGNkX3Nob3dfcG93ZXIo
c3RydWN0IGNsYXNzX2RldmljZSAqY2RldiwgY2hhciAqYnVmKQoreworCWludCByYzsKKwlzdHJ1
Y3QgbGNkX2RldmljZSAqbGQgPSB0b19sY2RfZGV2aWNlKGNkZXYpOworCisJZG93biAoJmxkLT5z
ZW0pOworCWlmIChsaWtlbHkgKGxkLT5wcm9wcyAmJiBsZC0+cHJvcHMtPmdldF9wb3dlcikpCisJ
CXJjID0gc3ByaW50ZiAoYnVmLCAiJWRcbiIsIGxkLT5wcm9wcy0+Z2V0X3Bvd2VyIChsZCkpOwor
CWVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZsZC0+c2VtKTsKKworCXJldHVybiByYzsKK30K
Kworc3RhdGljIHNzaXplX3QgbGNkX3N0b3JlX3Bvd2VyKHN0cnVjdCBjbGFzc19kZXZpY2UgKmNk
ZXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQoreworCWludCByYywgcG93ZXI7CisJ
Y2hhciAqZW5kcDsKKwlzdHJ1Y3QgbGNkX2RldmljZSAqbGQgPSB0b19sY2RfZGV2aWNlKGNkZXYp
OworCisJcG93ZXIgPSBzaW1wbGVfc3RydG91bChidWYsICZlbmRwLCAwKTsKKwlpZiAoKmVuZHAg
JiYgIWlzc3BhY2UgKCplbmRwKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlkb3duICgmbGQtPnNl
bSk7CisJaWYgKGxpa2VseSAobGQtPnByb3BzICYmIGxkLT5wcm9wcy0+c2V0X3Bvd2VyKSkgewor
CQlwcl9kZWJ1ZygibGNkOiBzZXQgcG93ZXIgdG8gJWRcbiIsIHBvd2VyKTsKKwkJbGQtPnByb3Bz
LT5zZXRfcG93ZXIobGQsIHBvd2VyKTsKKwkJcmMgPSBjb3VudDsKKwl9IGVsc2UKKwkJcmMgPSAt
RU5YSU87CisJdXAgKCZsZC0+c2VtKTsKKworCXJldHVybiByYzsKK30KKworc3RhdGljIHNzaXpl
X3QgbGNkX3Nob3dfZW5hYmxlKHN0cnVjdCBjbGFzc19kZXZpY2UgKmNkZXYsIGNoYXIgKmJ1ZikK
K3sKKwlpbnQgcmM7CisJc3RydWN0IGxjZF9kZXZpY2UgKmxkID0gdG9fbGNkX2RldmljZShjZGV2
KTsKKworCWRvd24gKCZsZC0+c2VtKTsKKwlpZiAobGlrZWx5KGxkLT5wcm9wcyAmJiBsZC0+cHJv
cHMtPmdldF9lbmFibGUpKQorCQlyYyA9IHNwcmludGYgKGJ1ZiwgIiVkXG4iLCBsZC0+cHJvcHMt
PmdldF9lbmFibGUobGQpKTsKKwllbHNlCisJCXJjID0gLUVOWElPOworCXVwICgmbGQtPnNlbSk7
CisKKwlyZXR1cm4gcmM7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGxjZF9zdG9yZV9lbmFibGUoc3Ry
dWN0IGNsYXNzX2RldmljZSAqY2RldiwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7
CisJaW50IHJjLCBlbmFibGU7CisJY2hhciAqZW5kcDsKKwlzdHJ1Y3QgbGNkX2RldmljZSAqbGQg
PSB0b19sY2RfZGV2aWNlKGNkZXYpOworCisJZW5hYmxlID0gc2ltcGxlX3N0cnRvdWwoYnVmLCAm
ZW5kcCwgMCk7CisJaWYgKCplbmRwICYmICFpc3NwYWNlICgqZW5kcCkpCisJCXJldHVybiAtRUlO
VkFMOworCisJZG93biAoJmxkLT5zZW0pOworCWlmIChsaWtlbHkgKGxkLT5wcm9wcyAmJiBsZC0+
cHJvcHMtPnNldF9lbmFibGUpKSB7CisJCXByX2RlYnVnKCJsY2Q6IHNldCBlbmFibGUgdG8gJWRc
biIsIGVuYWJsZSk7CisJCWxkLT5wcm9wcy0+c2V0X2VuYWJsZShsZCwgZW5hYmxlKTsKKwkJcmMg
PSBjb3VudDsKKwl9IGVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZsZC0+c2VtKTsKKworCXJl
dHVybiByYzsKK30KKworc3RhdGljIHNzaXplX3QgbGNkX3Nob3dfY29udHJhc3Qoc3RydWN0IGNs
YXNzX2RldmljZSAqY2RldiwgY2hhciAqYnVmKQoreworCWludCByYzsKKwlzdHJ1Y3QgbGNkX2Rl
dmljZSAqbGQgPSB0b19sY2RfZGV2aWNlKGNkZXYpOworCisJZG93biAoJmxkLT5zZW0pOworCWlm
IChsaWtlbHkgKGxkLT5wcm9wcyAmJiBsZC0+cHJvcHMtPmdldF9jb250cmFzdCkpCisJCXJjID0g
c3ByaW50ZiAoYnVmLCAiJWRcbiIsIGxkLT5wcm9wcy0+Z2V0X2NvbnRyYXN0KGxkKSk7CisJZWxz
ZQorCQlyYyA9IC1FTlhJTzsKKwl1cCAoJmxkLT5zZW0pOworCisJcmV0dXJuIHJjOworfQorCitz
dGF0aWMgc3NpemVfdCBsY2Rfc3RvcmVfY29udHJhc3Qoc3RydWN0IGNsYXNzX2RldmljZSAqY2Rl
diwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJaW50IHJjLCBjb250cmFzdDsK
KwljaGFyICplbmRwOworCXN0cnVjdCBsY2RfZGV2aWNlICpsZCA9IHRvX2xjZF9kZXZpY2UoY2Rl
dik7CisKKwljb250cmFzdCA9IHNpbXBsZV9zdHJ0b3VsKGJ1ZiwgJmVuZHAsIDApOworCWlmICgq
ZW5kcCAmJiAhaXNzcGFjZSAoKmVuZHApKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWRvd24gKCZs
ZC0+c2VtKTsKKwlpZiAobGlrZWx5IChsZC0+cHJvcHMgJiYgbGQtPnByb3BzLT5zZXRfY29udHJh
c3QpKSB7CisJCXByX2RlYnVnKCJsY2Q6IHNldCBjb250cmFzdCB0byAlZFxuIiwgY29udHJhc3Qp
OworCQlsZC0+cHJvcHMtPnNldF9jb250cmFzdChsZCwgY29udHJhc3QpOworCQlyYyA9IGNvdW50
OworCX0gZWxzZQorCQlyYyA9IC1FTlhJTzsKKwl1cCAoJmxkLT5zZW0pOworCisJcmV0dXJuIHJj
OworfQorCitzdGF0aWMgc3NpemVfdCBsY2Rfc2hvd19tYXhfY29udHJhc3Qoc3RydWN0IGNsYXNz
X2RldmljZSAqY2RldiwgY2hhciAqYnVmKQoreworCWludCByYzsKKwlzdHJ1Y3QgbGNkX2Rldmlj
ZSAqbGQgPSB0b19sY2RfZGV2aWNlKGNkZXYpOworCisJZG93biAoJmxkLT5zZW0pOworCWlmIChs
aWtlbHkgKGxkLT5wcm9wcykpCisJCXJjID0gc3ByaW50ZiAoYnVmLCAiJWRcbiIsIGxkLT5wcm9w
cy0+bWF4X2NvbnRyYXN0KTsKKwllbHNlCisJCXJjID0gLUVOWElPOworCXVwICgmbGQtPnNlbSk7
CisKKwlyZXR1cm4gcmM7Cit9CisKK3N0YXRpYyB2b2lkIGxjZF9jbGFzc19yZWxlYXNlKHN0cnVj
dCBjbGFzc19kZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgbGNkX2RldmljZSAqbGQgPSB0b19sY2Rf
ZGV2aWNlIChkZXYpOworCWtmcmVlIChsZCk7Cit9CisKK3N0cnVjdCBjbGFzcyBsY2RfY2xhc3Mg
PSB7CisJLm5hbWUgPSAibGNkIiwKKwkucmVsZWFzZSA9IGxjZF9jbGFzc19yZWxlYXNlLAorfTsK
KworI2RlZmluZSBERUNMQVJFX0FUVFIoX25hbWUsX21vZGUsX3Nob3csX3N0b3JlKQkJCVwKK3sJ
CQkJCQkJIAlcCisJLmF0dHIJPSB7IC5uYW1lID0gX19zdHJpbmdpZnkoX25hbWUpLCAubW9kZSA9
IF9tb2RlLCAub3duZXIgPSBUSElTX01PRFVMRSB9LAlcCisJLnNob3cJPSBfc2hvdywJCQkJCVwK
Kwkuc3RvcmUJPSBfc3RvcmUsCQkJCQlcCit9CisKK3N0YXRpYyBzdHJ1Y3QgY2xhc3NfZGV2aWNl
X2F0dHJpYnV0ZSBsY2RfY2xhc3NfZGV2aWNlX2F0dHJpYnV0ZXNbXSA9IHsKKwlERUNMQVJFX0FU
VFIgKHBvd2VyLCAwNjQ0LCBsY2Rfc2hvd19wb3dlciwgbGNkX3N0b3JlX3Bvd2VyKSwKKwlERUNM
QVJFX0FUVFIgKGVuYWJsZSwgMDY0NCwgbGNkX3Nob3dfZW5hYmxlLCBsY2Rfc3RvcmVfZW5hYmxl
KSwKKwlERUNMQVJFX0FUVFIgKGNvbnRyYXN0LCAwNjQ0LCBsY2Rfc2hvd19jb250cmFzdCwgbGNk
X3N0b3JlX2NvbnRyYXN0KSwKKwlERUNMQVJFX0FUVFIgKG1heF9jb250cmFzdCwgMDQ0NCwgbGNk
X3Nob3dfbWF4X2NvbnRyYXN0LCBOVUxMKSwKK307CisKKy8qKgorICogbGNkX2RldmljZV9yZWdp
c3RlciAtIHJlZ2lzdGVyIGEgbmV3IG9iamVjdCBvZiBsY2RfZGV2aWNlIGNsYXNzLgorICogQG5h
bWU6IHRoZSBuYW1lIG9mIHRoZSBuZXcgb2JqZWN0IChtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBu
YW1lIG9mIHRoZQorICogICByZXNwZWN0aXZlIGZyYW1lYnVmZmVyIGRldmljZSkuCisgKiBAZGV2
ZGF0YTogYW4gb3B0aW9uYWwgcG9pbnRlciB0byBiZSBzdG9yZWQgaW4gdGhlIGNsYXNzX2Rldmlj
ZS4gVGhlCisgKiAgIG1ldGhvZHMgbWF5IHJldHJpZXZlIGl0IGJ5IHVzaW5nIGNsYXNzX2dldF9k
ZXZkYXRhIChsZC0+Y2xhc3NfZGV2KS4KKyAqIEBscDogdGhlIGxjZCBwcm9wZXJ0aWVzIHN0cnVj
dHVyZS4KKyAqCisgKiBDcmVhdGVzIGEgbmV3IGxjZCBjbGFzc19kZXZpY2UgYW5kIGNvcGllcyBk
YXRhIGZyb20gdGhlIHJlY2VpdmVkIGxkCisgKiBzdHJ1Y3R1cmUgaW50byB0aGUgbmV3IG9iamVj
dC4gUmV0dXJucyBhZnRlciByZWdpc3RlcmluZyB0aGUgbmV3IG9iamVjdC4KKyAqLworaW50IGxj
ZF9kZXZpY2VfcmVnaXN0ZXIgKGNvbnN0IGNoYXIgKm5hbWUsIHZvaWQgKmRldmRhdGEsCisJCQkg
c3RydWN0IGxjZF9wcm9wZXJ0aWVzICpscCkKK3sKKwlpbnQgaSwgcmM7CisJc3RydWN0IGxjZF9k
ZXZpY2UgKm5ld19sZDsKKworCXByX2RlYnVnKCJsY2RfZGV2aWNlX3JlZ2lzdGVyOiBuYW1lPSVz
XG4iLCBuYW1lKTsKKworCW5ld19sZCA9IGttYWxsb2MgKHNpemVvZiAoc3RydWN0IGxjZF9kZXZp
Y2UpLCBHRlBfS0VSTkVMKTsKKwlpZiAodW5saWtlbHkgKCFuZXdfbGQpKQorCQlyZXR1cm4gLUVO
T01FTTsKKworCWluaXRfTVVURVggKCZuZXdfbGQtPnNlbSk7CisJbmV3X2xkLT5wcm9wcyA9IGxw
OworCW5ld19sZC0+Y2xhc3NfZGV2LmNsYXNzID0gJmxjZF9jbGFzczsKKwlzdHJsY3B5IChuZXdf
bGQtPmNsYXNzX2Rldi5jbGFzc19pZCwgbmFtZSwgS09CSl9OQU1FX0xFTik7CisJY2xhc3Nfc2V0
X2RldmRhdGEgKCZuZXdfbGQtPmNsYXNzX2RldiwgZGV2ZGF0YSk7CisJcmMgPSBjbGFzc19kZXZp
Y2VfcmVnaXN0ZXIgKCZuZXdfbGQtPmNsYXNzX2Rldik7CisJaWYgKHVubGlrZWx5IChyYykpIHsK
KwkJa2ZyZWUgKG5ld19sZCk7CisJCXJldHVybiByYzsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShsY2RfY2xhc3NfZGV2aWNlX2F0dHJpYnV0ZXMpOyBpKyspIHsKKwkJcmMgPSBj
bGFzc19kZXZpY2VfY3JlYXRlX2ZpbGUoJm5ld19sZC0+Y2xhc3NfZGV2LAorCQkJCQkgICAgICAm
bGNkX2NsYXNzX2RldmljZV9hdHRyaWJ1dGVzW2ldKTsKKwkJaWYgKHVubGlrZWx5IChyYykpIHsK
KwkJCXdoaWxlICgtLWkgPj0gMCkKKwkJCQljbGFzc19kZXZpY2VfcmVtb3ZlX2ZpbGUoJm5ld19s
ZC0+Y2xhc3NfZGV2LAorCQkJCQkJCSAmbGNkX2NsYXNzX2RldmljZV9hdHRyaWJ1dGVzW2ldKTsK
KwkJCWNsYXNzX2RldmljZV91bnJlZ2lzdGVyKCZuZXdfbGQtPmNsYXNzX2Rldik7CisJCQlyZXR1
cm4gcmM7CisJCX0KKwl9CisKKwlub3RpZmllcl9jYWxsX2NoYWluICgmbGNkX2RldmljZV9jaGFp
biwgMCwgbmV3X2xkKTsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTChsY2RfZGV2aWNl
X3JlZ2lzdGVyKTsKKworLyoqCisgKiBsY2RfZGV2aWNlX3VucmVnaXN0ZXIgLSB1bnJlZ2lzdGVy
cyBhIG9iamVjdCBvZiBsY2RfZGV2aWNlIGNsYXNzLgorICogQG5hbWU6IHRoZSBuYW1lIG9mIHRo
ZSBvYmplY3QgKG11c3QgYmUgdGhlIHNhbWUgYXMgdGhlIG5hbWUgb2YgdGhlCisgKiAgIHJlc3Bl
Y3RpdmUgZnJhbWVidWZmZXIgZGV2aWNlKS4KKyAqCisgKiBVbnJlZ2lzdGVycyBhIHByZXZpb3Vz
bHkgcmVnaXN0ZXJlZCB2aWEgbGNkX2RldmljZV9yZWdpc3RlciBvYmplY3QuCisgKi8KK3ZvaWQg
bGNkX2RldmljZV91bnJlZ2lzdGVyKGNvbnN0IGNoYXIgKm5hbWUpCit7CisJaW50IGk7CisJc3Ry
dWN0IGxjZF9kZXZpY2UgKmxkOworCXN0cnVjdCBjbGFzc19kZXZpY2UgKmNsYXNzX2RldiA9CisJ
CWNsYXNzX2RldmljZV9maW5kICgmbGNkX2NsYXNzLCBuYW1lKTsKKworCWlmICghY2xhc3NfZGV2
KQorCQlyZXR1cm47CisKKwlwcl9kZWJ1ZygibGNkX2RldmljZV91bnJlZ2lzdGVyOiBuYW1lPSVz
XG4iLCBuYW1lKTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFIChsY2RfY2xhc3NfZGV2
aWNlX2F0dHJpYnV0ZXMpOyBpKyspCisJCWNsYXNzX2RldmljZV9yZW1vdmVfZmlsZSAoY2xhc3Nf
ZGV2LAorCQkJCQkgICZsY2RfY2xhc3NfZGV2aWNlX2F0dHJpYnV0ZXNbaV0pOworCisJbGQgPSB0
b19sY2RfZGV2aWNlIChjbGFzc19kZXYpOworCWRvd24gKCZsZC0+c2VtKTsKKwlsZC0+cHJvcHMg
PSBOVUxMOworCXVwICgmbGQtPnNlbSk7CisKKwljbGFzc19kZXZpY2VfdW5yZWdpc3RlcihjbGFz
c19kZXYpOworCS8qIFdlIGdvdCB0aGUgcmVmZXJlbmNlIGNvdW50ZXIgaW5jcmVtZW50ZWQgYnkg
Y2xhc3NfZGV2aWNlX2ZpbmQoKSAqLworCWNsYXNzX2RldmljZV9wdXQoY2xhc3NfZGV2KTsKK30K
K0VYUE9SVF9TWU1CT0wobGNkX2RldmljZV91bnJlZ2lzdGVyKTsKKworLyoqCisgKiBsY2RfZGV2
aWNlX2ZpbmQgLSBmaW5kIGEgTENEIGRldmljZSBieSBuYW1lLgorICogQG5hbWU6IHRoZSBuYW1l
IG9mIHRoZSBMQ0Qgb2JqZWN0IHRvIGZpbmQuCisgKgorICogVGhlIHJlZmVyZW5jZSBjb3VudGVy
IG9mIHRoZSByZXR1cm5lZCBvYmplY3QgYXMgd2VsbCBhcyBvbiB0aGUgbW9kdWxlCisgKiB0aGF0
IGltcGxlbWVudHMgdGhlIGJhY2tsaWdodCBmdW5jdGlvbnMgYXJlIGluY3JlbWVudGVkLgorICov
CitzdHJ1Y3QgbGNkX2RldmljZSAqbGNkX2RldmljZV9maW5kKGNvbnN0IGNoYXIgKm5hbWUpCit7
CisJc3RydWN0IGxjZF9kZXZpY2UgKmxkOworCXN0cnVjdCBjbGFzc19kZXZpY2UgKmNsYXNzX2Rl
diA9CisJCWNsYXNzX2RldmljZV9maW5kICgmbGNkX2NsYXNzLCBuYW1lKTsKKworCWlmICh1bmxp
a2VseSAoIWNsYXNzX2RldikpCisJCXJldHVybiBOVUxMOworCisJbGQgPSBsY2RfZGV2aWNlX2dl
dCAodG9fbGNkX2RldmljZSAoY2xhc3NfZGV2KSk7CisJY2xhc3NfZGV2aWNlX3B1dCAoY2xhc3Nf
ZGV2KTsKKwlyZXR1cm4gbGQ7Cit9CitFWFBPUlRfU1lNQk9MKGxjZF9kZXZpY2VfZmluZCk7CisK
Ky8qKgorICogbGNkX2RldmljZV9nZXQgLSBpbmNyZW1lbnQgcmVmZXJlbmNlIGNvdW50ZXIgb2Yg
YSBMQ0QgZGV2aWNlCisgKiAgIGFuZCBvbiB0aGUgbW9kdWxlIHRoYXQgaW1wbGVtZW50cyB0aGUg
TENEIGRldmljZSBtZXRob2RzLgorICogQGxkOiB0aGUgTENEIGRldmljZSBvYmplY3QuCisgKgor
ICogSW5jcmVtZW50cyB0aGUgcmVmZXJlbmNlIGNvdW50ZXIgb24gYm90aCB0aGUgTENEIGRldmlj
ZSBhbmQgb24gdGhlCisgKiBtb2R1bGUgdGhhdCBpbXBsZW1lbnRzIHRoaXMgTENEIGRldmljZS4K
KyAqLworc3RydWN0IGxjZF9kZXZpY2UgKmxjZF9kZXZpY2VfZ2V0KHN0cnVjdCBsY2RfZGV2aWNl
ICpsZCkKK3sKKwlzdHJ1Y3QgY2xhc3NfZGV2aWNlICpjbGFzc19kZXYgPSBjbGFzc19kZXZpY2Vf
Z2V0ICgmbGQtPmNsYXNzX2Rldik7CisKKwlpZiAobGlrZWx5IChjbGFzc19kZXYpKSB7CisJCWRv
d24gKCZsZC0+c2VtKTsKKwkJaWYgKGxpa2VseSAobGQtPnByb3BzICYmIHRyeV9tb2R1bGVfZ2V0
IChsZC0+cHJvcHMtPm93bmVyKSkpIHsKKwkJCXVwICgmbGQtPnNlbSk7CisJCQlyZXR1cm4gbGQ7
CisJCX0KKwkJdXAgKCZsZC0+c2VtKTsKKworCQljbGFzc19kZXZpY2VfcHV0KGNsYXNzX2Rldik7
CisJfQorCXJldHVybiBOVUxMOworfQorRVhQT1JUX1NZTUJPTChsY2RfZGV2aWNlX2dldCk7CisK
Ky8qKgorICogbGNkX2RldmljZV9wdXQgLSBkZWNyZW1lbnQgcmVmZXJlbmNlIGNvdW50ZXIgb2Yg
YSBMQ0QgZGV2aWNlLgorICogQGxkOiB0aGUgTENEIGRldmljZSBvYmplY3QuCisgKgorICogRGVj
cmVtZW50cyB0aGUgcmVmZXJlbmNlIGNvdW50ZXIgb24gYm90aCB0aGUgTENEIGRldmljZSBhbmQg
b24gdGhlCisgKiBtb2R1bGUgdGhhdCBpbXBsZW1lbnRzIHRoaXMgTENEIGRldmljZS4KKyAqLwor
dm9pZCBsY2RfZGV2aWNlX3B1dChzdHJ1Y3QgbGNkX2RldmljZSAqbGQpCit7CisJaWYgKGxkKSB7
CisJCWRvd24gKCZsZC0+c2VtKTsKKwkJaWYgKGxkLT5wcm9wcykKKwkJCW1vZHVsZV9wdXQobGQt
PnByb3BzLT5vd25lcik7CisJCXVwICgmbGQtPnNlbSk7CisJCWNsYXNzX2RldmljZV9wdXQgKCZs
ZC0+Y2xhc3NfZGV2KTsKKwl9Cit9CitFWFBPUlRfU1lNQk9MKGxjZF9kZXZpY2VfcHV0KTsKKwor
c3RhdGljIHZvaWQgX19leGl0IGxjZF9jbGFzc19leGl0KHZvaWQpCit7CisJY2xhc3NfdW5yZWdp
c3RlcigmbGNkX2NsYXNzKTsKK30KKworc3RhdGljIGludCBfX2luaXQgbGNkX2NsYXNzX2luaXQo
dm9pZCkKK3sKKwlyZXR1cm4gY2xhc3NfcmVnaXN0ZXIoJmxjZF9jbGFzcyk7Cit9CisKKy8qCisg
KiBpZiB0aGlzIGlzIGNvbXBpbGVkIGludG8gdGhlIGtlcm5lbCwgd2UgbmVlZCB0byBlbnN1cmUg
dGhhdCB0aGUKKyAqIGNsYXNzIGlzIHJlZ2lzdGVyZWQgYmVmb3JlIHVzZXJzIG9mIHRoZSBjbGFz
cyB0cnkgdG8gcmVnaXN0ZXIgbGNkJ3MKKyAqLworcG9zdGNvcmVfaW5pdGNhbGwobGNkX2NsYXNz
X2luaXQpOworbW9kdWxlX2V4aXQobGNkX2NsYXNzX2V4aXQpOwotLS0gbGludXgtMi42LjYvZHJp
dmVycy92aWRlby9iYWNrbGlnaHQuYwkxOTcwLTAxLTAxIDAzOjAwOjAwLjAwMDAwMDAwMCArMDMw
MAorKysgbGludXgtMi42LjYtaGgwL2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0LmMJMjAwNC0wNS0y
OSAwMDo1Njo1My4wMDAwMDAwMDAgKzA0MDAKQEAgLTAsMCArMSwzMDEgQEAKKy8qCisgKiBCYWNr
bGlnaHQgTG93bGV2ZWwgQ29udHJvbCBBYnN0cmFjdGlvbgorICogCisgKiBDb3B5cmlnaHQgKEMp
IDIwMDMsMjAwNCBIZXdsZXR0LVBhY2thcmQgQ29tcGFueQorICogCisgKi8KKworI2luY2x1ZGUg
PGxpbnV4L3ZlcnNpb24uaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxs
aW51eC9pbml0Lmg+CisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgv
YmFja2xpZ2h0Lmg+CisjaW5jbHVkZSA8bGludXgvbm90aWZpZXIuaD4KKyNpbmNsdWRlIDxsaW51
eC9jdHlwZS5oPgorI2luY2x1ZGUgPGFzbS9idWcuaD4KKworc3RydWN0IG5vdGlmaWVyX2Jsb2Nr
ICpiYWNrbGlnaHRfZGV2aWNlX2NoYWluOworRVhQT1JUX1NZTUJPTCAoYmFja2xpZ2h0X2Rldmlj
ZV9jaGFpbik7CisKK3N0YXRpYyBzc2l6ZV90IGJhY2tsaWdodF9zaG93X3Bvd2VyIChzdHJ1Y3Qg
Y2xhc3NfZGV2aWNlICpjZGV2LCBjaGFyICpidWYpCit7CisJaW50IHJjOworCXN0cnVjdCBiYWNr
bGlnaHRfZGV2aWNlICpiZCA9IHRvX2JhY2tsaWdodF9kZXZpY2UgKGNkZXYpOworCisJZG93biAo
JmJkLT5zZW0pOworCWlmIChsaWtlbHkgKGJkLT5wcm9wcyAmJiBiZC0+cHJvcHMtPmdldF9wb3dl
cikpCisJCXJjID0gc3ByaW50ZiAoYnVmLCAiJWRcbiIsIGJkLT5wcm9wcy0+Z2V0X3Bvd2VyIChi
ZCkpOworCWVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZiZC0+c2VtKTsKKworCXJldHVybiBy
YzsKK30KKworc3RhdGljIHNzaXplX3QgYmFja2xpZ2h0X3N0b3JlX3Bvd2VyKHN0cnVjdCBjbGFz
c19kZXZpY2UgKmNkZXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQoreworCWludCBy
YywgcG93ZXI7CisJY2hhciAqZW5kcDsKKwlzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQgPSB0
b19iYWNrbGlnaHRfZGV2aWNlIChjZGV2KTsKKworCXBvd2VyID0gc2ltcGxlX3N0cnRvdWwgKGJ1
ZiwgJmVuZHAsIDApOworCWlmICgqZW5kcCAmJiAhaXNzcGFjZSAoKmVuZHApKQorCQlyZXR1cm4g
LUVJTlZBTDsKKworCWRvd24gKCZiZC0+c2VtKTsKKwlpZiAobGlrZWx5IChiZC0+cHJvcHMgJiYg
YmQtPnByb3BzLT5zZXRfcG93ZXIpKSB7CisJCXByX2RlYnVnKCJiYWNrbGlnaHQ6IHNldCBwb3dl
ciB0byAlZFxuIiwgcG93ZXIpOworCQliZC0+cHJvcHMtPnNldF9wb3dlcihiZCwgcG93ZXIpOwor
CQlyYyA9IGNvdW50OworCX0gZWxzZQorCQlyYyA9IC1FTlhJTzsKKwl1cCAoJmJkLT5zZW0pOwor
CisJcmV0dXJuIHJjOworfQorCitzdGF0aWMgc3NpemVfdCBiYWNrbGlnaHRfc2hvd19icmlnaHRu
ZXNzKHN0cnVjdCBjbGFzc19kZXZpY2UgKmNkZXYsIGNoYXIgKmJ1ZikKK3sKKwlpbnQgcmM7CisJ
c3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkID0gdG9fYmFja2xpZ2h0X2RldmljZSAoY2Rldik7
CisKKwlkb3duICgmYmQtPnNlbSk7CisJaWYgKGxpa2VseSAoYmQtPnByb3BzICYmIGJkLT5wcm9w
cy0+Z2V0X2JyaWdodG5lc3MpKQorCQlyYyA9IHNwcmludGYgKGJ1ZiwgIiVkXG4iLCBiZC0+cHJv
cHMtPmdldF9icmlnaHRuZXNzIChiZCkpOworCWVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZi
ZC0+c2VtKTsKKworCXJldHVybiByYzsKK30KKworc3RhdGljIHNzaXplX3QgYmFja2xpZ2h0X3N0
b3JlX2JyaWdodG5lc3Moc3RydWN0IGNsYXNzX2RldmljZSAqY2RldiwgY29uc3QgY2hhciAqYnVm
LCBzaXplX3QgY291bnQpCit7CisJaW50IHJjLCBicmlnaHRuZXNzOworCWNoYXIgKmVuZHA7CisJ
c3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkID0gdG9fYmFja2xpZ2h0X2RldmljZSAoY2Rldik7
CisKKwlicmlnaHRuZXNzID0gc2ltcGxlX3N0cnRvdWwgKGJ1ZiwgJmVuZHAsIDApOworCWlmICgq
ZW5kcCAmJiAhaXNzcGFjZSAoKmVuZHApKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWRvd24gKCZi
ZC0+c2VtKTsKKwlpZiAobGlrZWx5IChiZC0+cHJvcHMgJiYgYmQtPnByb3BzLT5zZXRfYnJpZ2h0
bmVzcykpIHsKKwkJcHJfZGVidWcoImJhY2tsaWdodDogc2V0IGJyaWdodG5lc3MgdG8gJWRcbiIs
IGJyaWdodG5lc3MpOworCQliZC0+cHJvcHMtPnNldF9icmlnaHRuZXNzKGJkLCBicmlnaHRuZXNz
KTsKKwkJcmMgPSBjb3VudDsKKwl9IGVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZiZC0+c2Vt
KTsKKworCXJldHVybiByYzsKK30KKworc3RhdGljIHNzaXplX3QgYmFja2xpZ2h0X3Nob3dfbWF4
X2JyaWdodG5lc3Moc3RydWN0IGNsYXNzX2RldmljZSAqY2RldiwgY2hhciAqYnVmKQoreworCWlu
dCByYzsKKwlzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQgPSB0b19iYWNrbGlnaHRfZGV2aWNl
IChjZGV2KTsKKworCWRvd24gKCZiZC0+c2VtKTsKKwlpZiAobGlrZWx5IChiZC0+cHJvcHMpKQor
CQlyYyA9IHNwcmludGYoYnVmLCAiJWRcbiIsIGJkLT5wcm9wcy0+bWF4X2JyaWdodG5lc3MpOwor
CWVsc2UKKwkJcmMgPSAtRU5YSU87CisJdXAgKCZiZC0+c2VtKTsKKworCXJldHVybiByYzsKK30K
Kworc3RhdGljIHZvaWQgYmFja2xpZ2h0X2NsYXNzX3JlbGVhc2Uoc3RydWN0IGNsYXNzX2Rldmlj
ZSAqZGV2KQoreworCXN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiZCA9IHRvX2JhY2tsaWdodF9k
ZXZpY2UgKGRldik7CisJa2ZyZWUgKGJkKTsKK30KKworc3RydWN0IGNsYXNzIGJhY2tsaWdodF9j
bGFzcyA9IHsKKwkubmFtZSA9ICJiYWNrbGlnaHQiLAorCS5yZWxlYXNlID0gYmFja2xpZ2h0X2Ns
YXNzX3JlbGVhc2UsCit9OworCisjZGVmaW5lIERFQ0xBUkVfQVRUUihfbmFtZSxfbW9kZSxfc2hv
dyxfc3RvcmUpCQkJXAorewkJCQkJCQkgCVwKKwkuYXR0cgk9IHsgLm5hbWUgPSBfX3N0cmluZ2lm
eShfbmFtZSksIC5tb2RlID0gX21vZGUsIC5vd25lciA9IFRISVNfTU9EVUxFIH0sCVwKKwkuc2hv
dwk9IF9zaG93LAkJCQkJXAorCS5zdG9yZQk9IF9zdG9yZSwJCQkJCVwKK30KKworc3RhdGljIHN0
cnVjdCBjbGFzc19kZXZpY2VfYXR0cmlidXRlIGJsX2NsYXNzX2RldmljZV9hdHRyaWJ1dGVzW10g
PSB7CisJREVDTEFSRV9BVFRSIChwb3dlciwgMDY0NCwgYmFja2xpZ2h0X3Nob3dfcG93ZXIsIGJh
Y2tsaWdodF9zdG9yZV9wb3dlciksCisJREVDTEFSRV9BVFRSIChicmlnaHRuZXNzLCAwNjQ0LCBi
YWNrbGlnaHRfc2hvd19icmlnaHRuZXNzLCBiYWNrbGlnaHRfc3RvcmVfYnJpZ2h0bmVzcyksCisJ
REVDTEFSRV9BVFRSIChtYXhfYnJpZ2h0bmVzcywgMDQ0NCwgYmFja2xpZ2h0X3Nob3dfbWF4X2Jy
aWdodG5lc3MsIE5VTEwpLAorfTsKKworLyoqCisgKiBiYWNrbGlnaHRfZGV2aWNlX3JlZ2lzdGVy
IC0gcmVnaXN0ZXIgYSBuZXcgb2JqZWN0IG9mIGJhY2tsaWdodF9kZXZpY2UgY2xhc3MuCisgKiBA
bmFtZTogdGhlIG5hbWUgb2YgdGhlIG5ldyBvYmplY3QgKG11c3QgYmUgdGhlIHNhbWUgYXMgdGhl
IG5hbWUgb2YgdGhlCisgKiAgIHJlc3BlY3RpdmUgZnJhbWVidWZmZXIgZGV2aWNlKS4KKyAqIEBk
ZXZkYXRhOiBhbiBvcHRpb25hbCBwb2ludGVyIHRvIGJlIHN0b3JlZCBpbiB0aGUgY2xhc3NfZGV2
aWNlLiBUaGUKKyAqICAgbWV0aG9kcyBtYXkgcmV0cmlldmUgaXQgYnkgdXNpbmcgY2xhc3NfZ2V0
X2RldmRhdGEgKCZiZC0+Y2xhc3NfZGV2KS4KKyAqIEBicDogdGhlIGJhY2tsaWdodCBwcm9wZXJ0
aWVzIHN0cnVjdHVyZS4KKyAqCisgKiBDcmVhdGVzIGEgbmV3IGJhY2tsaWdodCBjbGFzc19kZXZp
Y2UuIFJldHVybnMgYWZ0ZXIgcmVnaXN0ZXJpbmcgdGhlCisgKiBuZXcgb2JqZWN0LgorICovCitp
bnQgYmFja2xpZ2h0X2RldmljZV9yZWdpc3Rlcihjb25zdCBjaGFyICpuYW1lLCB2b2lkICpkZXZk
YXRhLAorCQkJICAgICAgc3RydWN0IGJhY2tsaWdodF9wcm9wZXJ0aWVzICpicCkKK3sKKwlpbnQg
aSwgcmM7CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKm5ld19iZDsKKworCXByX2RlYnVnKCJi
YWNrbGlnaHRfZGV2aWNlX3JlZ2lzdGVyOiBuYW1lPSVzXG4iLCBuYW1lKTsKKworCW5ld19iZCA9
IGttYWxsb2MgKHNpemVvZiAoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UpLCBHRlBfS0VSTkVMKTsK
KwlpZiAodW5saWtlbHkgKCFuZXdfYmQpKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWluaXRfTVVU
RVggKCZuZXdfYmQtPnNlbSk7CisJbmV3X2JkLT5wcm9wcyA9IGJwOworCW5ld19iZC0+Y2xhc3Nf
ZGV2LmNsYXNzID0gJmJhY2tsaWdodF9jbGFzczsKKwlzdHJsY3B5IChuZXdfYmQtPmNsYXNzX2Rl
di5jbGFzc19pZCwgbmFtZSwgS09CSl9OQU1FX0xFTik7CisJY2xhc3Nfc2V0X2RldmRhdGEgKCZu
ZXdfYmQtPmNsYXNzX2RldiwgZGV2ZGF0YSk7CisJcmMgPSBjbGFzc19kZXZpY2VfcmVnaXN0ZXIg
KCZuZXdfYmQtPmNsYXNzX2Rldik7CisJaWYgKHVubGlrZWx5IChyYykpIHsKKwkJa2ZyZWUgKG5l
d19iZCk7CisJCXJldHVybiByYzsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShi
bF9jbGFzc19kZXZpY2VfYXR0cmlidXRlcyk7IGkrKykgeworCQlyYyA9IGNsYXNzX2RldmljZV9j
cmVhdGVfZmlsZSgmbmV3X2JkLT5jbGFzc19kZXYsCisJCQkJCSAgICAgICZibF9jbGFzc19kZXZp
Y2VfYXR0cmlidXRlc1tpXSk7CisJCWlmICh1bmxpa2VseSAocmMpKSB7CisJCQl3aGlsZSAoLS1p
ID49IDApCisJCQkJY2xhc3NfZGV2aWNlX3JlbW92ZV9maWxlKCZuZXdfYmQtPmNsYXNzX2RldiwK
KwkJCQkJCQkgJmJsX2NsYXNzX2RldmljZV9hdHRyaWJ1dGVzW2ldKTsKKwkJCWNsYXNzX2Rldmlj
ZV91bnJlZ2lzdGVyKCZuZXdfYmQtPmNsYXNzX2Rldik7CisJCQlyZXR1cm4gcmM7CisJCX0KKwl9
CisKKwlub3RpZmllcl9jYWxsX2NoYWluICgmYmFja2xpZ2h0X2RldmljZV9jaGFpbiwgMCwgbmV3
X2JkKTsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTChiYWNrbGlnaHRfZGV2aWNlX3Jl
Z2lzdGVyKTsKKworLyoqCisgKiBiYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIgLSB1bnJlZ2lz
dGVycyBhIG9iamVjdCBvZiBiYWNrbGlnaHRfZGV2aWNlIGNsYXNzLgorICogQG5hbWU6IHRoZSBu
YW1lIG9mIHRoZSBvYmplY3QgKG11c3QgYmUgdGhlIHNhbWUgYXMgdGhlIG5hbWUgb2YgdGhlCisg
KiAgIHJlc3BlY3RpdmUgZnJhbWVidWZmZXIgZGV2aWNlKS4KKyAqCisgKiBVbnJlZ2lzdGVycyBh
IHByZXZpb3VzbHkgcmVnaXN0ZXJlZCB2aWEgYmFja2xpZ2h0X2RldmljZV9yZWdpc3RlciBvYmpl
Y3QuCisgKi8KK3ZvaWQgYmFja2xpZ2h0X2RldmljZV91bnJlZ2lzdGVyKGNvbnN0IGNoYXIgKm5h
bWUpCit7CisJaW50IGk7CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkOworCXN0cnVjdCBj
bGFzc19kZXZpY2UgKmNsYXNzX2RldiA9CisJCWNsYXNzX2RldmljZV9maW5kICgmYmFja2xpZ2h0
X2NsYXNzLCBuYW1lKTsKKworCWlmICghY2xhc3NfZGV2KQorCQlyZXR1cm47CisKKwlwcl9kZWJ1
ZygiYmFja2xpZ2h0X2RldmljZV91bnJlZ2lzdGVyOiBuYW1lPSVzXG4iLCBuYW1lKTsKKworCWZv
ciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGJsX2NsYXNzX2RldmljZV9hdHRyaWJ1dGVzKTsgaSsr
KQorCQljbGFzc19kZXZpY2VfcmVtb3ZlX2ZpbGUgKGNsYXNzX2RldiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZibF9jbGFzc19kZXZpY2VfYXR0cmlidXRlc1tp
XSk7CisKKwliZCA9IHRvX2JhY2tsaWdodF9kZXZpY2UgKGNsYXNzX2Rldik7CisJZG93biAoJmJk
LT5zZW0pOworCWJkLT5wcm9wcyA9IE5VTEw7CisJdXAgKCZiZC0+c2VtKTsKKworCWNsYXNzX2Rl
dmljZV91bnJlZ2lzdGVyKGNsYXNzX2Rldik7CisJLyogV2UgZ290IHRoZSByZWZlcmVuY2UgY291
bnRlciBpbmNyZW1lbnRlZCBieSBjbGFzc19kZXZpY2VfZmluZCgpICovCisJY2xhc3NfZGV2aWNl
X3B1dChjbGFzc19kZXYpOworfQorRVhQT1JUX1NZTUJPTChiYWNrbGlnaHRfZGV2aWNlX3VucmVn
aXN0ZXIpOworCisvKioKKyAqIGJhY2tsaWdodF9kZXZpY2VfZmluZCAtIGZpbmQgYSBiYWNrbGln
aHQgZGV2aWNlIGJ5IG5hbWUuCisgKiBAbmFtZTogdGhlIG5hbWUgb2YgdGhlIGJhY2tsaWdodCBv
YmplY3QgdG8gZmluZC4KKyAqCisgKiBUaGUgcmVmZXJlbmNlIGNvdW50ZXIgb2YgdGhlIHJldHVy
bmVkIG9iamVjdCBhcyB3ZWxsIGFzIG9uIHRoZSBtb2R1bGUKKyAqIHRoYXQgaW1wbGVtZW50cyB0
aGUgYmFja2xpZ2h0IGZ1bmN0aW9ucyBhcmUgaW5jcmVtZW50ZWQuCisgKi8KK3N0cnVjdCBiYWNr
bGlnaHRfZGV2aWNlICpiYWNrbGlnaHRfZGV2aWNlX2ZpbmQoY29uc3QgY2hhciAqbmFtZSkKK3sK
KwlzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQ7CisJc3RydWN0IGNsYXNzX2RldmljZSAqY2xh
c3NfZGV2ID0KKwkJY2xhc3NfZGV2aWNlX2ZpbmQgKCZiYWNrbGlnaHRfY2xhc3MsIG5hbWUpOwor
CisJaWYgKHVubGlrZWx5ICghY2xhc3NfZGV2KSkKKwkJcmV0dXJuIE5VTEw7CisKKwliZCA9IGJh
Y2tsaWdodF9kZXZpY2VfZ2V0ICh0b19iYWNrbGlnaHRfZGV2aWNlIChjbGFzc19kZXYpKTsKKwlj
bGFzc19kZXZpY2VfcHV0IChjbGFzc19kZXYpOworCXJldHVybiBiZDsKK30KK0VYUE9SVF9TWU1C
T0woYmFja2xpZ2h0X2RldmljZV9maW5kKTsKKworLyoqCisgKiBiYWNrbGlnaHRfZGV2aWNlX2dl
dCAtIGluY3JlbWVudCByZWZlcmVuY2UgY291bnRlciBvZiBhIGJhY2tsaWdodCBkZXZpY2UKKyAq
ICAgYW5kIG9uIHRoZSBtb2R1bGUgdGhhdCBpbXBsZW1lbnRzIHRoZSBiYWNrbGlnaHQgZGV2aWNl
IG1ldGhvZHMuCisgKiBAYmQ6IHRoZSBiYWNrbGlnaHQgZGV2aWNlIG9iamVjdC4KKyAqCisgKiBJ
bmNyZW1lbnRzIHRoZSByZWZlcmVuY2UgY291bnRlciBvbiBib3RoIHRoZSBiYWNrbGlnaHQgZGV2
aWNlIGFuZCBvbiB0aGUKKyAqIG1vZHVsZSB0aGF0IGltcGxlbWVudHMgdGhpcyBiYWNrbGlnaHQg
ZGV2aWNlLgorICovCitzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmFja2xpZ2h0X2RldmljZV9n
ZXQoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkKQoreworCXN0cnVjdCBjbGFzc19kZXZpY2Ug
KmNsYXNzX2RldiA9IGNsYXNzX2RldmljZV9nZXQgKCZiZC0+Y2xhc3NfZGV2KTsKKworCWlmIChs
aWtlbHkgKGNsYXNzX2RldikpIHsKKwkJZG93biAoJmJkLT5zZW0pOworCQlpZiAobGlrZWx5IChi
ZC0+cHJvcHMgJiYgdHJ5X21vZHVsZV9nZXQgKGJkLT5wcm9wcy0+b3duZXIpKSkgeworCQkJdXAg
KCZiZC0+c2VtKTsKKwkJCXJldHVybiBiZDsKKwkJfQorICAgICAgICAgICAgICAgIHVwICgmYmQt
PnNlbSk7CisKKwkJY2xhc3NfZGV2aWNlX3B1dChjbGFzc19kZXYpOworCX0KKwlyZXR1cm4gTlVM
TDsKK30KK0VYUE9SVF9TWU1CT0woYmFja2xpZ2h0X2RldmljZV9nZXQpOworCisvKioKKyAqIGJh
Y2tsaWdodF9kZXZpY2VfcHV0IC0gZGVjcmVtZW50IHJlZmVyZW5jZSBjb3VudGVyIG9mIGEgYmFj
a2xpZ2h0IGRldmljZS4KKyAqIEBsZDogdGhlIGJhY2tsaWdodCBkZXZpY2Ugb2JqZWN0LgorICoK
KyAqIERlY3JlbWVudHMgdGhlIHJlZmVyZW5jZSBjb3VudGVyIG9uIGJvdGggdGhlIGJhY2tsaWdo
dCBkZXZpY2UgYW5kIG9uIHRoZQorICogbW9kdWxlIHRoYXQgaW1wbGVtZW50cyB0aGlzIGJhY2ts
aWdodCBkZXZpY2UuCisgKi8KK3ZvaWQgYmFja2xpZ2h0X2RldmljZV9wdXQoc3RydWN0IGJhY2ts
aWdodF9kZXZpY2UgKmJkKQoreworCWlmIChiZCkgeworCQlkb3duICgmYmQtPnNlbSk7CisJCWlm
IChiZC0+cHJvcHMpCisJCQltb2R1bGVfcHV0KGJkLT5wcm9wcy0+b3duZXIpOworCQl1cCAoJmJk
LT5zZW0pOworCQljbGFzc19kZXZpY2VfcHV0ICgmYmQtPmNsYXNzX2Rldik7CisJfQorfQorRVhQ
T1JUX1NZTUJPTChiYWNrbGlnaHRfZGV2aWNlX3B1dCk7CisKK3N0YXRpYyB2b2lkIF9fZXhpdCBi
YWNrbGlnaHRfY2xhc3NfZXhpdCh2b2lkKQoreworCWNsYXNzX3VucmVnaXN0ZXIoJmJhY2tsaWdo
dF9jbGFzcyk7Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IGJhY2tsaWdodF9jbGFzc19pbml0KHZv
aWQpCit7CisJcmV0dXJuIGNsYXNzX3JlZ2lzdGVyKCZiYWNrbGlnaHRfY2xhc3MpOworfQorCisv
KgorICogaWYgdGhpcyBpcyBjb21waWxlZCBpbnRvIHRoZSBrZXJuZWwsIHdlIG5lZWQgdG8gZW5z
dXJlIHRoYXQgdGhlCisgKiBjbGFzcyBpcyByZWdpc3RlcmVkIGJlZm9yZSB1c2VycyBvZiB0aGUg
Y2xhc3MgdHJ5IHRvIHJlZ2lzdGVyIGxjZCdzCisgKi8KK3Bvc3Rjb3JlX2luaXRjYWxsKGJhY2ts
aWdodF9jbGFzc19pbml0KTsKK21vZHVsZV9leGl0KGJhY2tsaWdodF9jbGFzc19leGl0KTsKLS0t
IGxpbnV4LTIuNi42L2RyaXZlcnMvdmlkZW8vS2NvbmZpZwkyMDA0LTA1LTEwIDA2OjMxOjU5LjAw
MDAwMDAwMCArMDQwMAorKysgcmVwbGFjZW1lbnQvZHJpdmVycy92aWRlby9LY29uZmlnCTIwMDQt
MDUtMjggMjM6MTk6NDUuMDAwMDAwMDAwICswNDAwCkBAIC0zOCw2ICszOCwzOCBAQAogCSAgKGUu
Zy4gYW4gYWNjZWxlcmF0ZWQgWCBzZXJ2ZXIpIGFuZCB0aGF0IGFyZSBub3QgZnJhbWUgYnVmZmVy
CiAJICBkZXZpY2UtYXdhcmUgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgcmVzdWx0cy4gSWYgdW5zdXJl
LCBzYXkgTi4KIAorY29uZmlnIExDRF9DTEFTU19ERVZJQ0UKKyAgICAgICAgdHJpc3RhdGUgIkxv
d2xldmVsIExDRCBjb250cm9scyIKKwlkZXBlbmRzIG9uIEZCCisJaGVscAorCSAgVGhpcyBmcmFt
ZXdvcmsgYWRkcyBzdXBwb3J0IGZvciBsb3ctbGV2ZWwgY29udHJvbCBvZiBMQ0QuCisJICBTb21l
IGZyYW1lYnVmZmVyIGRldmljZXMgY29ubmVjdCB0byBwbGF0Zm9ybS1zcGVjaWZpYyBMQ0QgbW9k
dWxlcworCSAgaW4gb3JkZXIgdG8gaGF2ZSBhIHBsYXRmb3JtLXNwZWNpZmljIHdheSB0byBjb250
cm9sIHRoZSBmbGF0IHBhbmVsCisJICAoY29udHJhc3QgYW5kIGFwcGx5aW5nIHBvd2VyIHRvIHRo
ZSBMQ0QgKG5vdCB0byB0aGUgYmFja2xpZ2h0ISkpLgorCisJICBUbyBoYXZlIHN1cHBvcnQgZm9y
IHlvdXIgc3BlY2lmaWMgTENEIHBhbmVsIHlvdSB3aWxsIGhhdmUgdG8KKwkgIHNlbGVjdCB0aGUg
cHJvcGVyIGRyaXZlcnMgd2hpY2ggZGVwZW5kIG9uIHRoaXMgb3B0aW9uLgorCitjb25maWcgTENE
X0RFVklDRQorCWJvb2wKKwlkZXBlbmRzIG9uIExDRF9DTEFTU19ERVZJQ0UKKwlkZWZhdWx0IEZC
CisKK2NvbmZpZyBCQUNLTElHSFRfQ0xBU1NfREVWSUNFCisgICAgICAgIHRyaXN0YXRlICJMb3ds
ZXZlbCBCYWNrbGlnaHQgY29udHJvbHMiCisJZGVwZW5kcyBvbiBGQgorCWhlbHAKKwkgIFRoaXMg
ZnJhbWV3b3JrIGFkZHMgc3VwcG9ydCBmb3IgbG93LWxldmVsIGNvbnRyb2wgb2YgdGhlIExDRAor
ICAgICAgICAgIGJhY2tsaWdodC4gVGhpcyBpbmNsdWRlcyBzdXBwb3J0IGZvciBicmlnaHRuZXNz
IGFuZCBwb3dlci4KKworCSAgVG8gaGF2ZSBzdXBwb3J0IGZvciB5b3VyIHNwZWNpZmljIExDRCBw
YW5lbCB5b3Ugd2lsbCBoYXZlIHRvCisJICBzZWxlY3QgdGhlIHByb3BlciBkcml2ZXJzIHdoaWNo
IGRlcGVuZCBvbiB0aGlzIG9wdGlvbi4KKworY29uZmlnIEJBQ0tMSUdIVF9ERVZJQ0UKKwlib29s
CisJZGVwZW5kcyBvbiBCQUNLTElHSFRfQ0xBU1NfREVWSUNFCisJZGVmYXVsdCBGQgorCiBjb25m
aWcgRkJfQ0lSUlVTCiAJdHJpc3RhdGUgIkNpcnJ1cyBMb2dpYyBzdXBwb3J0IgogCWRlcGVuZHMg
b24gRkIgJiYgKEFNSUdBIHx8IFBDSSkgJiYgQlJPS0VOCi0tLSBsaW51eC0yLjYuNi9kcml2ZXJz
L3ZpZGVvL01ha2VmaWxlCTIwMDQtMDUtMTAgMDY6MzI6MDAuMDAwMDAwMDAwICswNDAwCisrKyBy
ZXBsYWNlbWVudC9kcml2ZXJzL3ZpZGVvL01ha2VmaWxlCTIwMDQtMDUtMjUgMjE6Mjk6MjYuMDAw
MDAwMDAwICswNDAwCkBAIC0xMyw2ICsxMyw5IEBACiBvYmotJChDT05GSUdfUFBDKSAgICAgICAg
ICAgICAgICAgKz0gbWFjbW9kZXMubwogZW5kaWYKIAorb2JqLSQoQ09ORklHX0xDRF9ERVZJQ0Up
ICAgICAgICAgICs9IGxjZC5vCitvYmotJChDT05GSUdfQkFDS0xJR0hUX0RFVklDRSkgICAgKz0g
YmFja2xpZ2h0Lm8KKwogb2JqLSQoQ09ORklHX0ZCX0FDT1JOKSAgICAgICAgICAgICs9IGFjb3Ju
ZmIubyBjZmJmaWxscmVjdC5vIGNmYmNvcHlhcmVhLm8gY2ZiaW1nYmx0Lm8KIG9iai0kKENPTkZJ
R19GQl9BTUlHQSkgICAgICAgICAgICArPSBhbWlmYi5vIGMycC5vCiBvYmotJChDT05GSUdfRkJf
UE0yKSAgICAgICAgICAgICAgKz0gcG0yZmIubyBjZmJmaWxscmVjdC5vIGNmYmNvcHlhcmVhLm8g
Y2ZiaW1nYmx0Lm8K

--Multipart=_Sat__29_May_2004_01_20_30_+0400_HQYOhV0ieAcECWsm--
