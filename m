Return-Path: <linux-kernel-owner+willy=40w.ods.org-S265930AbUFWQJ0@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S265930AbUFWQJ0 (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 23 Jun 2004 12:09:26 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266096AbUFWQIM
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 23 Jun 2004 12:08:12 -0400
Received: from cantor.suse.de ([195.135.220.2]:749 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S265930AbUFWQGM (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 23 Jun 2004 12:06:12 -0400
Date: Wed, 23 Jun 2004 18:01:04 +0200
Message-ID: <s5h7jtyjmbj.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Russell King <rmk+lkml@arm.linux.org.uk>
Cc: Linus Torvalds <torvalds@osdl.org>, Jeff Garzik <jgarzik@pobox.com>,
       Matt Porter <mporter@kernel.crashing.org>,
       Jamey Hicks <jamey.hicks@hp.com>, Ian Molton <spyro@f2s.com>,
       linux-kernel@vger.kernel.org, greg@kroah.com, tony@atomide.com,
       david-b@pacbell.net, joshua@joshuawise.com
Subject: Re: DMA API issues
In-Reply-To: <20040623164419.E27549@flint.arm.linux.org.uk>
References: <20040618122112.D3851@home.com>
	<20040618204322.C17516@flint.arm.linux.org.uk>
	<s5hoendm3td.wl@alsa2.suse.de>
	<20040622000838.B7802@flint.arm.linux.org.uk>
	<40D7941F.3020909@pobox.com>
	<Pine.LNX.4.58.0406212006270.6530@ppc970.osdl.org>
	<Pine.LNX.4.58.0406212024550.6530@ppc970.osdl.org>
	<s5hfz8nnadu.wl@alsa2.suse.de>
	<20040623133423.B27549@flint.arm.linux.org.uk>
	<s5hbrjajnfq.wl@alsa2.suse.de>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Wed, 23 Jun 2004 16:44:19 +0100,
Russell King wrote:
> 
> On Wed, Jun 23, 2004 at 05:36:57PM +0200, Takashi Iwai wrote:
> > > and a similar one for the ARM-specific "write combining" case (for
> > > framebuffers utilising the DMA API)?
> > 
> > pgprot_noncached() is used on many other architectures in fbmem.c
> > (well, not really, but the result is identical).
> > Should it be provided as another one, or is it used as default in
> > dma_mmap_coherent()?
> 
> The whole point is to kill the idea that drivers should have to know
> about page protection crap.  That should be wholely contained within
> the architecture implementation.

I agree.  My question is whether we need to handle different cases
with cached, non-cached and writecombine, according to the demand of
the driver.  In other words, do we always handle these mmap pages to
be non-cached (except for writecombine version)?


> > Also, it would be nice to have a version for sg-buffer, too.
> 
> Well, we don't have a sg-buffer version of dma_alloc_coherent(),
> so we don't have a sg-buffer version of dma_mmap_coherent().

That sound reasonable :)


Takashi
