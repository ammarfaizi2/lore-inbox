Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1751313AbWJVRP3@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751313AbWJVRP3 (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 22 Oct 2006 13:15:29 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751316AbWJVRP3
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 22 Oct 2006 13:15:29 -0400
Received: from mout0.freenet.de ([194.97.50.131]:56269 "EHLO mout0.freenet.de")
	by vger.kernel.org with ESMTP id S1751313AbWJVRP2 (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 22 Oct 2006 13:15:28 -0400
Date: Sun, 22 Oct 2006 19:17:28 +0200
To: linux-kernel@vger.kernel.org
Subject: [PATCH] 2.6.19-rc2-mm2 pktcdvd: add sysfs and debugfs interface
Reply-To: balagi@justmail.de
From: "Thomas Maier" <balagi@justmail.de>
Cc: petero2@telia.com, akpm@osdl.org
Content-Type: multipart/mixed; boundary=----------hwWKFn2jd84xAw9EVebSv7
MIME-Version: 1.0
Message-ID: <op.tht1yvsaiudtyh@master>
User-Agent: Opera Mail/9.02 (Win32)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------------hwWKFn2jd84xAw9EVebSv7
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit

Hello,

this patch adds a sysfs and debugfs interface
to the pktcdvd driver.
The procfs interface is not modified!

Look into the 2 ABI/testing/* files in the patch
for more infos.

Signed-off-by: Thomas Maier <balagi@justmail.de>

------------hwWKFn2jd84xAw9EVebSv7
Content-Disposition: attachment; filename=pktcdvd-add-sysfs-debugfs.patch
Content-Type: application/octet-stream; name=pktcdvd-add-sysfs-debugfs.patch
Content-Transfer-Encoding: Base64

ZGlmZiAtdXJwTiBsaW51eC0yLjYuMTktcmMyLW1tMi9Eb2N1bWVudGF0aW9uL0FC
SS90ZXN0aW5nL2RlYnVnZnMtcGt0Y2R2ZCAxLXN5c2ZzLWRlYnVnZnMvRG9jdW1l
bnRhdGlvbi9BQkkvdGVzdGluZy9kZWJ1Z2ZzLXBrdGNkdmQKLS0tIGxpbnV4LTIu
Ni4xOS1yYzItbW0yL0RvY3VtZW50YXRpb24vQUJJL3Rlc3RpbmcvZGVidWdmcy1w
a3RjZHZkCTE5NzAtMDEtMDEgMDE6MDA6MDAuMDAwMDAwMDAwICswMTAwCisrKyAx
LXN5c2ZzLWRlYnVnZnMvRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9kZWJ1Z2Zz
LXBrdGNkdmQJMjAwNi0xMC0yMiAxODowNTo0Mi4wMDAwMDAwMDAgKzAyMDAKQEAg
LTAsMCArMSwyMCBAQAorV2hhdDogICAgICAgICAgIC9kZWJ1Zy9wa3RjZHZkL3Br
dGNkdmRbMC03XQorRGF0ZTogICAgICAgICAgIE9jdC4gMjAwNgorS2VybmVsVmVy
c2lvbjogIDIuNi4xOQorQ29udGFjdDogICAgICAgIFRob21hcyBNYWllciA8YmFs
YWdpQGp1c3RtYWlsLmRlPgorRGVzY3JpcHRpb246CisKK2RlYnVnZnMgaW50ZXJm
YWNlCistLS0tLS0tLS0tLS0tLS0tLQorCitUaGUgcGt0Y2R2ZCBtb2R1bGUgKHBh
Y2tldCB3cml0aW5nIGRyaXZlcikgY3JlYXRlcwordGhlc2UgZmlsZXMgaW4gZGVi
dWdmczoKKworL2RlYnVnL3BrdGNkdmQvcGt0Y2R2ZFswLTddLworICAgIGluZm8g
ICAgICAgICAgICAoMDQ0NCkgTG90cyBvZiBodW1hbiByZWFkYWJsZSBkcml2ZXIK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpc3RpY3MgYW5kIGluZm9z
LiBNdWx0aXBsZSBsaW5lcyEKKworRXhhbXBsZToKKy0tLS0tLS0KKworY2F0IC9k
ZWJ1Zy9wa3RjZHZkL3BrdGNkdmQwL2luZm8KZGlmZiAtdXJwTiBsaW51eC0yLjYu
MTktcmMyLW1tMi9Eb2N1bWVudGF0aW9uL0FCSS90ZXN0aW5nL3N5c2ZzLWNsYXNz
LXBrdGNkdmQgMS1zeXNmcy1kZWJ1Z2ZzL0RvY3VtZW50YXRpb24vQUJJL3Rlc3Rp
bmcvc3lzZnMtY2xhc3MtcGt0Y2R2ZAotLS0gbGludXgtMi42LjE5LXJjMi1tbTIv
RG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1jbGFzcy1wa3RjZHZkCTE5
NzAtMDEtMDEgMDE6MDA6MDAuMDAwMDAwMDAwICswMTAwCisrKyAxLXN5c2ZzLWRl
YnVnZnMvRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1jbGFzcy1wa3Rj
ZHZkCTIwMDYtMTAtMjIgMTg6MTE6MDUuMDAwMDAwMDAwICswMjAwCkBAIC0wLDAg
KzEsNzIgQEAKK1doYXQ6ICAgICAgICAgICAvc3lzL2NsYXNzL3BrdGNkdmQvCitE
YXRlOiAgICAgICAgICAgT2N0LiAyMDA2CitLZXJuZWxWZXJzaW9uOiAgMi42LjE5
CitDb250YWN0OiAgICAgICAgVGhvbWFzIE1haWVyIDxiYWxhZ2lAanVzdG1haWwu
ZGU+CitEZXNjcmlwdGlvbjoKKworc3lzZnMgaW50ZXJmYWNlCistLS0tLS0tLS0t
LS0tLS0KKworVGhlIHBrdGNkdmQgbW9kdWxlIChwYWNrZXQgd3JpdGluZyBkcml2
ZXIpIGNyZWF0ZXMKK3RoZXNlIGZpbGVzIGluIHRoZSBzeXNmczoKKyg8ZGV2aWQ+
IGlzIGluIGZvcm1hdCAgbWFqb3I6bWlub3IgKQorCisvc3lzL2NsYXNzL3BrdGNk
dmQvCisgICAgYWRkICAgICAgICAgICAgKDAyMDApICBXcml0ZSBhIGJsb2NrIGRl
dmljZSBpZCAobWFqb3I6bWlub3IpCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICB0byBjcmVhdGUgYSBuZXcgcGt0Y2R2ZCBkZXZpY2UgYW5kIG1hcAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaXQgdG8gdGhlIGJsb2NrIGRldmljZS4KKwor
ICAgIHJlbW92ZSAgICAgICAgICgwMjAwKSAgV3JpdGUgdGhlIHBrdGNkdmQgZGV2
aWNlIGlkIChtYWpvcjptaW5vcikKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
IHRvIGl0IHRvIHJlbW92ZSB0aGUgcGt0Y2R2ZCBkZXZpY2UuCisKKyAgICBkZXZp
Y2VfbWFwICAgICAoMDQ0NCkgIFNob3dzIHRoZSBkZXZpY2UgbWFwcGluZyBpbiBm
b3JtYXQ6CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrdGNkdmRbMC03
XSA8cGt0ZGV2aWQ+IDxibGtkZXZpZD4KKwkKKy9zeXMvY2xhc3MvcGt0Y2R2ZC9w
a3RjZHZkWzAtN10vCisgICAgZGV2ICAgICAgICAgICAgICAgICAgICgwNDQ0KSBE
ZXZpY2UgaWQKKyAgICB1ZXZlbnQgICAgICAgICAgICAgICAgKDAyMDApIFRvIHNl
bmQgYW4gdWV2ZW50LgorICAgIAorL3N5cy9jbGFzcy9wa3RjZHZkL3BrdGNkdmRb
MC03XS9zdGF0LworICAgIHBhY2tldHNfc3RhcnRlZCAgICAgICAoMDQ0NCkgTnVt
YmVyIG9mIHN0YXJ0ZWQgcGFja2V0cy4KKyAgICBwYWNrZXRzX2ZpbmlzaGVkICAg
ICAgKDA0NDQpIE51bWJlciBvZiBmaW5pc2hlZCBwYWNrZXRzLgorCisgICAga2Jf
d3JpdHRlbiAgICAgICAgICAgICgwNDQ0KSBrQnl0ZXMgd3JpdHRlbi4KKyAgICBr
Yl9yZWFkICAgICAgICAgICAgICAgKDA0NDQpIGtCeXRlcyByZWFkLgorICAgIGti
X3JlYWRfZ2F0aGVyICAgICAgICAoMDQ0NCkga0J5dGVzIHJlYWQgdG8gZmlsbCB3
cml0ZSBwYWNrZXRzLgorICAgIAorICAgIHJlc2V0ICAgICAgICAgICAgICAgICAo
MDIwMCkgV3JpdGUgYW55IHZhbHVlIHRvIGl0IHRvIHJlc2V0CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwa3RjZHZkIGRldmljZSBzdGF0aXN0aWMg
dmFsdWVzLCBsaWtlCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBi
eXRlcyByZWFkL3dyaXR0ZW4uCisgICAgCisvc3lzL2NsYXNzL3BrdGNkdmQvcGt0
Y2R2ZFswLTddL3dyaXRlX3F1ZXVlLworICAgIHNpemUgICAgICAgICAgICAgICAg
ICAoMDQ0NCkgQ29udGFpbnMgdGhlIHNpemUgb2YgdGhlIGJpbyB3cml0ZQorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWUuCisKKyAgICBjb25n
ZXN0aW9uX29mZiAgICAgICAgKDA2NDQpIElmIGJpbyB3cml0ZSBxdWV1ZSBzaXpl
IGlzIGJlbG93CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlz
IG1hcmssIGFjY2VwdCBuZXcgYmlvIHJlcXVlc3RzCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBmcm9tIHRoZSBibG9jayBsYXllci4KKworICAgIGNv
bmdlc3Rpb25fb24gICAgICAgICAoMDY0NCkgSWYgYmlvIHdyaXRlIHF1ZXVlIHNp
emUgaXMgaGlnaGVyCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBh
cyB0aGlzIG1hcmssIGRvIG5vIGxvbmdlciBhY2NlcHQKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGJpbyB3cml0ZSByZXF1ZXN0cyBmcm9tIHRoZSBi
bG9jaworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIgYW5k
IHdhaXQgdGlsbCB0aGUgcGt0Y2R2ZAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZGV2aWNlIGhhcyBwcm9jZXNzZWQgZW5vdWdoIGJpbydzCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbyB0aGF0IGJpbyB3cml0ZSBx
dWV1ZSBzaXplIGlzCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBi
ZWxvdyBjb25nZXN0aW9uIG9mZiBtYXJrLgorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgQSB2YWx1ZSBvZiA8PSAwIGRpc2FibGVzIGNvbmdlc3Rpb24K
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2wuCQkJCSAK
KyAKKworRXhhbXBsZToKKy0tLS0tLS0tCitUbyB1c2UgdGhlIHBrdGNkdmQgc3lz
ZnMgaW50ZXJmYWNlIGRpcmVjdGx5LCB5b3UgY2FuIGRvOgorCisjIGNyZWF0ZSBh
IG5ldyBwa3RjZHZkIGRldmljZSBtYXBwZWQgdG8gL2Rldi9oZGMKK2VjaG8gIjIy
OjAiID4vc3lzL2NsYXNzL3BrdGNkdmQvYWRkCitjYXQgL3N5cy9jbGFzcy9wa3Rj
ZHZkL2RldmljZV9tYXAKKyMgYXNzdW1pbmcgZGV2aWNlIHBrdGNkdmQwIHdhcyBj
cmVhdGVkLCBsb29rIGF0IHN0YXQncworY2F0IC9zeXMvY2xhc3MvcGt0Y2R2ZC9w
a3RjZHZkMC9zdGF0L2tiX3dyaXR0ZW4KKyMgcHJpbnQgdGhlIGRldmljZSBpZCBv
ZiB0aGUgbWFwcGVkIGJsb2NrIGRldmljZQorZmdyZXAgcGt0Y2R2ZDAgL3N5cy9j
bGFzcy9wa3RjZHZkL2RldmljZV9tYXAKKyMgcmVtb3ZlIGRldmljZSwgdXNpbmcg
cGt0Y2R2ZDAgZGV2aWNlIGlkICAgMjUzOjAKK2VjaG8gIjI1MzowIiA+L3N5cy9j
bGFzcy9wa3RjZHZkL3JlbW92ZQpkaWZmIC11cnBOIGxpbnV4LTIuNi4xOS1yYzIt
bW0yL0RvY3VtZW50YXRpb24vY2Ryb20vcGFja2V0LXdyaXRpbmcudHh0IDEtc3lz
ZnMtZGVidWdmcy9Eb2N1bWVudGF0aW9uL2Nkcm9tL3BhY2tldC13cml0aW5nLnR4
dAotLS0gbGludXgtMi42LjE5LXJjMi1tbTIvRG9jdW1lbnRhdGlvbi9jZHJvbS9w
YWNrZXQtd3JpdGluZy50eHQJMjAwNi0xMC0yMSAyMTo0ODo1Ny4wMDAwMDAwMDAg
KzAyMDAKKysrIDEtc3lzZnMtZGVidWdmcy9Eb2N1bWVudGF0aW9uL2Nkcm9tL3Bh
Y2tldC13cml0aW5nLnR4dAkyMDA2LTEwLTIyIDE4OjE2OjU0LjAwMDAwMDAwMCAr
MDIwMApAQCAtOCw2ICs4LDcgQEAgR2V0dGluZyBzdGFydGVkIHF1aWNrCiAKIC0g
WW91IG5lZWQgdGhlIHVkZnRvb2xzIHBhY2thZ2UgKHBrdHNldHVwLCBta3VkZmZz
LCBjZHJ3dG9vbCkuCiAgIERvd25sb2FkIGZyb20gaHR0cDovL3NvdXJjZWZvcmdl
Lm5ldC9wcm9qZWN0cy9saW51eC11ZGYvCisgIE5vdGU6IHBrdHNldHVwIHVzZXMg
dGhlIHBrdGNkdmQgcHJvY2ZzIGludGVyZmFjZSEKIAogLSBHcmFiIGEgbmV3IENE
LVJXIGRpc2MgYW5kIGZvcm1hdCBpdCAoYXNzdW1pbmcgQ0QtUlcgaXMgaGRjLCBz
dWJzdGl0dXRlCiAgIGFzIGFwcHJvcHJpYXRlKToKQEAgLTkwLDYgKzkxLDQxIEBA
IE5vdGVzCiAgIHRvIGNyZWF0ZSBhbiBleHQyIGZpbGVzeXN0ZW0gb24gdGhlIGRp
c2MuCiAKIAorVXNpbmcgdGhlIHBrdGNkdmQgc3lzZnMgaW50ZXJmYWNlCistLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKworU2luY2UgTGludXggMi42
LjE5LCB0aGUgcGt0Y2R2ZCBtb2R1bGUgaGFzIGEgc3lzZnMgaW50ZXJmYWNlCith
bmQgY2FuIGJlIGNvbnRyb2xsZWQgYnkgaXQuIEZvciBleGFtcGxlIHRoZSAicGt0
Y2R2ZCIgdG9vbCB1c2VzCit0aGlzIGludGVyZmFjZS4gKHNlZSBodHRwOi8vcGVv
cGxlLmZyZWVuZXQuZGUvQmFsYUdpI3BrdGNkdmQgKQorCisicGt0Y2R2ZCIgd29y
a3Mgc2ltaWxhciB0byAicGt0c2V0dXAiLCBlLmcuOgorCisJIyBwa3RjZHZkIC1h
IGRldl9uYW1lIC9kZXYvaGRjCisJIyBta3VkZmZzIC9kZXYvcGt0Y2R2ZC9kZXZf
bmFtZQorCSMgbW91bnQgLXQgdWRmIC1vIHJ3LG5vYXRpbWUgL2Rldi9wa3RjZHZk
L2Rldl9uYW1lIC9kdmRyYW0KKwkjIGNwIGZpbGVzIC9kdmRyYW0KKwkjIHVtb3Vu
dCAvZHZkcmFtCisJIyBwa3RjZHZkIC1yIGRldl9uYW1lCisKKworRm9yIGEgZGVz
Y3JpcHRpb24gb2YgdGhlIHN5c2ZzIGludGVyZmFjZSBsb29rIGludG8gdGhlIGZp
bGU6CisKKyAgRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9zeXNmcy1ibG9jay1w
a3RjZHZkCisKKworVXNpbmcgdGhlIHBrdGNkdmQgZGVidWdmcyBpbnRlcmZhY2UK
Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKK1RvIHJlYWQg
cGt0Y2R2ZCBkZXZpY2UgaW5mb3MgaW4gaHVtYW4gcmVhZGFibGUgZm9ybSwgZG86
CisKKwkjIGNhdCAvZGVidWcvcGt0Y2R2ZC9wa3RjZHZkWzAtN10vaW5mbworCitG
b3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgZGVidWdmcyBpbnRlcmZhY2UgbG9vayBp
bnRvIHRoZSBmaWxlOgorCisgIERvY3VtZW50YXRpb24vQUJJL3Rlc3RpbmcvZGVi
dWdmcy1wa3RjZHZkCisKKworCiBMaW5rcwogLS0tLS0KIApkaWZmIC11cnBOIGxp
bnV4LTIuNi4xOS1yYzItbW0yL2RyaXZlcnMvYmxvY2svcGt0Y2R2ZC5jIDEtc3lz
ZnMtZGVidWdmcy9kcml2ZXJzL2Jsb2NrL3BrdGNkdmQuYwotLS0gbGludXgtMi42
LjE5LXJjMi1tbTIvZHJpdmVycy9ibG9jay9wa3RjZHZkLmMJMjAwNi0xMC0yMSAy
MTo0OTo0MS4wMDAwMDAwMDAgKzAyMDAKKysrIDEtc3lzZnMtZGVidWdmcy9kcml2
ZXJzL2Jsb2NrL3BrdGNkdmQuYwkyMDA2LTEwLTIyIDE4OjA0OjUwLjAwMDAwMDAw
MCArMDIwMApAQCAtNjAsNiArNjAsOCBAQAogI2luY2x1ZGUgPHNjc2kvc2NzaV9j
bW5kLmg+CiAjaW5jbHVkZSA8c2NzaS9zY3NpX2lvY3RsLmg+CiAjaW5jbHVkZSA8
c2NzaS9zY3NpLmg+CisjaW5jbHVkZSA8bGludXgvZGVidWdmcy5oPgorI2luY2x1
ZGUgPGxpbnV4L2RldmljZS5oPgogCiAjaW5jbHVkZSA8YXNtL3VhY2Nlc3MuaD4K
IApAQCAtODksNiArOTEsNDE5IEBAIHN0YXRpYyBpbnQgd3JpdGVfY29uZ2VzdGlv
bl9vZmYgPSBQS1RfV1IKIHN0YXRpYyBzdHJ1Y3QgbXV0ZXggY3RsX211dGV4Owkv
KiBTZXJpYWxpemUgb3Blbi9jbG9zZS9zZXR1cC90ZWFyZG93biAqLwogc3RhdGlj
IG1lbXBvb2xfdCAqcHNkX3Bvb2w7CiAKK3N0YXRpYyBzdHJ1Y3QgY2xhc3MJKmNs
YXNzX3BrdGNkdmQgPSBOVUxMOyAgICAvKiAvc3lzL2NsYXNzL3BrdGNkdmQgKi8K
K3N0YXRpYyBzdHJ1Y3QgZGVudHJ5CSpwa3RfZGVidWdmc19yb290ID0gTlVMTDsg
LyogL2RlYnVnL3BrdGNkdmQgKi8KKworLyogZm9yd2FyZCBkZWNsYXJhdGlvbiAq
Lworc3RhdGljIGludCBwa3Rfc2V0dXBfZGV2KGRldl90IGRldiwgZGV2X3QqIHBr
dF9kZXYpOworc3RhdGljIGludCBwa3RfcmVtb3ZlX2RldihkZXZfdCBwa3RfZGV2
KTsKK3N0YXRpYyBpbnQgcGt0X3NlcV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwg
dm9pZCAqcCk7CisKKworCisvKgorICogY3JlYXRlIGFuZCByZWdpc3RlciBhIHBr
dGNkdmQga2VybmVsIG9iamVjdC4KKyAqLworc3RhdGljIHN0cnVjdCBwa3RjZHZk
X2tvYmoqIHBrdF9rb2JqX2NyZWF0ZShzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBk
LAorCQkJCQljb25zdCBjaGFyKiBuYW1lLAorCQkJCQlzdHJ1Y3Qga29iamVjdCog
cGFyZW50LAorCQkJCQlzdHJ1Y3Qga29ial90eXBlKiBrdHlwZSkKK3sKKwlzdHJ1
Y3QgcGt0Y2R2ZF9rb2JqICpwOworCXAgPSBremFsbG9jKHNpemVvZigqcCksIEdG
UF9LRVJORUwpOworCWlmICghcCkKKwkJcmV0dXJuIE5VTEw7CisJa29iamVjdF9z
ZXRfbmFtZSgmcC0+a29iaiwgIiVzIiwgbmFtZSk7CisJcC0+a29iai5wYXJlbnQg
PSBwYXJlbnQ7CisJcC0+a29iai5rdHlwZSA9IGt0eXBlOworCXAtPnBkID0gcGQ7
CisJaWYgKGtvYmplY3RfcmVnaXN0ZXIoJnAtPmtvYmopICE9IDApCisJCXJldHVy
biBOVUxMOworCXJldHVybiBwOworfQorLyoKKyAqIHJlbW92ZSBhIHBrdGNkdmQg
a2VybmVsIG9iamVjdC4KKyAqLworc3RhdGljIHZvaWQgcGt0X2tvYmpfcmVtb3Zl
KHN0cnVjdCBwa3RjZHZkX2tvYmogKnApCit7CisJaWYgKHApCisJCWtvYmplY3Rf
dW5yZWdpc3RlcigmcC0+a29iaik7Cit9CisvKgorICogZGVmYXVsdCByZWxlYXNl
IGZ1bmN0aW9uIGZvciBwa3RjZHZkIGtlcm5lbCBvYmplY3RzLgorICovCitzdGF0
aWMgdm9pZCBwa3Rfa29ial9yZWxlYXNlKHN0cnVjdCBrb2JqZWN0ICprb2JqKQor
eworCWtmcmVlKHRvX3BrdGNkdmRrb2JqKGtvYmopKTsKK30KKworCisvKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKgorICoKKyAqIHN5c2ZzIGludGVyZmFjZSBmb3IgcGt0Y2R2ZAorICogYnkg
KEMpIDIwMDYgIFRob21hcyBNYWllciA8YmFsYWdpQGp1c3RtYWlsLmRlPgorICoK
KyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqLworCisjZGVmaW5lIERFRl9BVFRSKF9vYmosX25hbWUsX21v
ZGUpIFwKKwlzdGF0aWMgc3RydWN0IGF0dHJpYnV0ZSBfb2JqID0geyBcCisJCS5u
YW1lID0gX25hbWUsIC5vd25lciA9IFRISVNfTU9EVUxFLCAubW9kZSA9IF9tb2Rl
IH0KKworLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioKKyAgL3N5cy9jbGFzcy9wa3RjZHZkL3BrdGNkdmRb
MC03XS8KKyAgICAgICAgICAgICAgICAgICAgIHN0YXQvcmVzZXQKKyAgICAgICAg
ICAgICAgICAgICAgIHN0YXQvcGFja2V0c19zdGFydGVkCisgICAgICAgICAgICAg
ICAgICAgICBzdGF0L3BhY2tldHNfZmluaXNoZWQKKyAgICAgICAgICAgICAgICAg
ICAgIHN0YXQva2Jfd3JpdHRlbgorICAgICAgICAgICAgICAgICAgICAgc3RhdC9r
Yl9yZWFkCisgICAgICAgICAgICAgICAgICAgICBzdGF0L2tiX3JlYWRfZ2F0aGVy
CisgICAgICAgICAgICAgICAgICAgICB3cml0ZV9xdWV1ZS9zaXplCisgICAgICAg
ICAgICAgICAgICAgICB3cml0ZV9xdWV1ZS9jb25nZXN0aW9uX29mZgorICAgICAg
ICAgICAgICAgICAgICAgd3JpdGVfcXVldWUvY29uZ2VzdGlvbl9vbgorICoqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKiovCisKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3QxLCAicmVzZXQiLCAw
MjAwKTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3QyLCAicGFja2V0c19zdGFy
dGVkIiwgMDQ0NCk7CitERUZfQVRUUihrb2JqX3BrdF9hdHRyX3N0MywgInBhY2tl
dHNfZmluaXNoZWQiLCAwNDQ0KTsKK0RFRl9BVFRSKGtvYmpfcGt0X2F0dHJfc3Q0
LCAia2Jfd3JpdHRlbiIsIDA0NDQpOworREVGX0FUVFIoa29ial9wa3RfYXR0cl9z
dDUsICJrYl9yZWFkIiwgMDQ0NCk7CitERUZfQVRUUihrb2JqX3BrdF9hdHRyX3N0
NiwgImtiX3JlYWRfZ2F0aGVyIiwgMDQ0NCk7CisKK3N0YXRpYyBzdHJ1Y3QgYXR0
cmlidXRlICprb2JqX3BrdF9hdHRyc19zdGF0W10gPSB7CisJJmtvYmpfcGt0X2F0
dHJfc3QxLAorCSZrb2JqX3BrdF9hdHRyX3N0MiwKKwkma29ial9wa3RfYXR0cl9z
dDMsCisJJmtvYmpfcGt0X2F0dHJfc3Q0LAorCSZrb2JqX3BrdF9hdHRyX3N0NSwK
Kwkma29ial9wa3RfYXR0cl9zdDYsCisJTlVMTAorfTsKKworREVGX0FUVFIoa29i
al9wa3RfYXR0cl93cTEsICJzaXplIiwgMDQ0NCk7CitERUZfQVRUUihrb2JqX3Br
dF9hdHRyX3dxMiwgImNvbmdlc3Rpb25fb2ZmIiwgMDY0NCk7CitERUZfQVRUUihr
b2JqX3BrdF9hdHRyX3dxMywgImNvbmdlc3Rpb25fb24iLCAgMDY0NCk7CisKK3N0
YXRpYyBzdHJ1Y3QgYXR0cmlidXRlICprb2JqX3BrdF9hdHRyc193cXVldWVbXSA9
IHsKKwkma29ial9wa3RfYXR0cl93cTEsCisJJmtvYmpfcGt0X2F0dHJfd3EyLAor
CSZrb2JqX3BrdF9hdHRyX3dxMywKKwlOVUxMCit9OworCisvKiBkZWNsYXJlcyBh
IGNoYXIgYnVmZmVyWzY0XSBfZGJ1ZiwgY29waWVzIGRhdGEgZnJvbQorICogX2Ig
d2l0aCBsZW5ndGggX2wgaW50byBpdCBhbmQgZW5zdXJlcyB0aGF0IF9kYnVmIGVu
ZHMKKyAqIHdpdGggYSBcMCBjaGFyYWN0ZXIuCisgKi8KKyNkZWZpbmUgREVDTEFS
RV9CVUZfQVNfU1RSSU5HKF9kYnVmLCBfYiwgX2wpIFwKKwljaGFyIF9kYnVmWzY0
XTsgaW50IGRsZW4gPSAoX2wpIDwgMCA/IDAgOiAoX2wpOyBcCisJaWYgKGRsZW4g
Pj0gc2l6ZW9mKF9kYnVmKSkgZGxlbiA9IHNpemVvZihfZGJ1ZiktMTsgXAorCW1l
bWNweShfZGJ1ZiwgX2IsIGRsZW4pOyBfZGJ1ZltkbGVuXSA9IDAKKwkKK3N0YXRp
YyBzc2l6ZV90IGtvYmpfcGt0X3Nob3coc3RydWN0IGtvYmplY3QgKmtvYmosCisJ
CQlzdHJ1Y3QgYXR0cmlidXRlICphdHRyLCBjaGFyICpkYXRhKQoreworCXN0cnVj
dCBwa3RjZHZkX2RldmljZSAqcGQgPSB0b19wa3RjZHZka29iaihrb2JqKS0+cGQ7
CisJaW50IG4gPSAwOworCWludCB2OworCWlmIChzdHJjbXAoYXR0ci0+bmFtZSwg
InBhY2tldHNfc3RhcnRlZCIpID09IDApIHsKKwkJbiA9IHNwcmludGYoZGF0YSwg
IiVsdVxuIiwgcGQtPnN0YXRzLnBrdF9zdGFydGVkKTsKKworCX0gZWxzZSBpZiAo
c3RyY21wKGF0dHItPm5hbWUsICJwYWNrZXRzX2ZpbmlzaGVkIikgPT0gMCkgewor
CQluID0gc3ByaW50ZihkYXRhLCAiJWx1XG4iLCBwZC0+c3RhdHMucGt0X2VuZGVk
KTsKKworCX0gZWxzZSBpZiAoc3RyY21wKGF0dHItPm5hbWUsICJrYl93cml0dGVu
IikgPT0gMCkgeworCQluID0gc3ByaW50ZihkYXRhLCAiJWx1XG4iLCBwZC0+c3Rh
dHMuc2Vjc193ID4+IDEpOworCisJfSBlbHNlIGlmIChzdHJjbXAoYXR0ci0+bmFt
ZSwgImtiX3JlYWQiKSA9PSAwKSB7CisJCW4gPSBzcHJpbnRmKGRhdGEsICIlbHVc
biIsIHBkLT5zdGF0cy5zZWNzX3IgPj4gMSk7CisKKwl9IGVsc2UgaWYgKHN0cmNt
cChhdHRyLT5uYW1lLCAia2JfcmVhZF9nYXRoZXIiKSA9PSAwKSB7CisJCW4gPSBz
cHJpbnRmKGRhdGEsICIlbHVcbiIsIHBkLT5zdGF0cy5zZWNzX3JnID4+IDEpOwor
CQorCX0gZWxzZSBpZiAoc3RyY21wKGF0dHItPm5hbWUsICJzaXplIikgPT0gMCkg
eworCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKKwkJdiA9IHBkLT5iaW9fcXVldWVf
c2l6ZTsKKwkJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKKwkJbiA9IHNwcmludGYo
ZGF0YSwgIiVkXG4iLCB2KTsKKwkJCisJfSBlbHNlIGlmIChzdHJjbXAoYXR0ci0+
bmFtZSwgImNvbmdlc3Rpb25fb2ZmIikgPT0gMCkgeworCQlzcGluX2xvY2soJnBk
LT5sb2NrKTsKKwkJdiA9IHBkLT53cml0ZV9jb25nZXN0aW9uX29mZjsKKwkJc3Bp
bl91bmxvY2soJnBkLT5sb2NrKTsKKwkJbiA9IHNwcmludGYoZGF0YSwgIiVkXG4i
LCB2KTsKKworCX0gZWxzZSBpZiAoc3RyY21wKGF0dHItPm5hbWUsICJjb25nZXN0
aW9uX29uIikgPT0gMCkgeworCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKKwkJdiA9
IHBkLT53cml0ZV9jb25nZXN0aW9uX29uOworCQlzcGluX3VubG9jaygmcGQtPmxv
Y2spOworCQluID0gc3ByaW50ZihkYXRhLCAiJWRcbiIsIHYpOworCX0KKwlyZXR1
cm4gbjsKK30KKworc3RhdGljIHZvaWQgaW5pdF93cml0ZV9jb25nZXN0aW9uX21h
cmtzKGludCogbG8sIGludCogaGkpCit7CisJaWYgKCpoaSA+IDApIHsKKwkJKmhp
ID0gbWF4KCpoaSwgNTAwKTsKKwkJKmhpID0gbWluKCpoaSwgMTAwMDAwMCk7CisJ
CWlmICgqbG8gPD0gMCkKKwkJCSpsbyA9ICpoaSAtIDEwMDsKKwkJZWxzZSB7CisJ
CQkqbG8gPSBtaW4oKmxvLCAqaGkgLSAxMDApOworCQkJKmxvID0gbWF4KCpsbywg
MTAwKTsKKwkJfQorCX0gZWxzZSB7CisJCSpoaSA9IC0xOworCQkqbG8gPSAtMTsK
Kwl9Cit9CisKK3N0YXRpYyBzc2l6ZV90IGtvYmpfcGt0X3N0b3JlKHN0cnVjdCBr
b2JqZWN0ICprb2JqLAorCQkJc3RydWN0IGF0dHJpYnV0ZSAqYXR0ciwKKwkJCWNv
bnN0IGNoYXIgKmRhdGEsIHNpemVfdCBsZW4pCit7CisJc3RydWN0IHBrdGNkdmRf
ZGV2aWNlICpwZCA9IHRvX3BrdGNkdmRrb2JqKGtvYmopLT5wZDsKKwlpbnQgdmFs
OworCURFQ0xBUkVfQlVGX0FTX1NUUklORyhkYnVmLCBkYXRhLCBsZW4pOyAvKiBl
bnN1cmUgc3NjYW5mIHNjYW5zIGEgc3RyaW5nICovCisKKwlpZiAoc3RyY21wKGF0
dHItPm5hbWUsICJyZXNldCIpID09IDAgJiYgZGxlbiA+IDApIHsKKwkJcGQtPnN0
YXRzLnBrdF9zdGFydGVkID0gMDsKKwkJcGQtPnN0YXRzLnBrdF9lbmRlZCA9IDA7
CisJCXBkLT5zdGF0cy5zZWNzX3cgPSAwOworCQlwZC0+c3RhdHMuc2Vjc19yZyA9
IDA7CisJCXBkLT5zdGF0cy5zZWNzX3IgPSAwOworCQorCX0gZWxzZSBpZiAoc3Ry
Y21wKGF0dHItPm5hbWUsICJjb25nZXN0aW9uX29mZiIpID09IDAKKwkJICAgJiYg
c3NjYW5mKGRidWYsICIlZCIsICZ2YWwpID09IDEpIHsKKwkJc3Bpbl9sb2NrKCZw
ZC0+bG9jayk7CisJCXBkLT53cml0ZV9jb25nZXN0aW9uX29mZiA9IHZhbDsKKwkJ
aW5pdF93cml0ZV9jb25nZXN0aW9uX21hcmtzKCZwZC0+d3JpdGVfY29uZ2VzdGlv
bl9vZmYsCisJCQkJCSZwZC0+d3JpdGVfY29uZ2VzdGlvbl9vbik7CisJCXNwaW5f
dW5sb2NrKCZwZC0+bG9jayk7CisJCQorCX0gZWxzZSBpZiAoc3RyY21wKGF0dHIt
Pm5hbWUsICJjb25nZXN0aW9uX29uIikgPT0gMAorCQkgICAmJiBzc2NhbmYoZGJ1
ZiwgIiVkIiwgJnZhbCkgPT0gMSkgeworCQlzcGluX2xvY2soJnBkLT5sb2NrKTsK
KwkJcGQtPndyaXRlX2Nvbmdlc3Rpb25fb24gPSB2YWw7CisJCWluaXRfd3JpdGVf
Y29uZ2VzdGlvbl9tYXJrcygmcGQtPndyaXRlX2Nvbmdlc3Rpb25fb2ZmLAorCQkJ
CQkmcGQtPndyaXRlX2Nvbmdlc3Rpb25fb24pOworCQlzcGluX3VubG9jaygmcGQt
PmxvY2spOworCX0KKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3RydWN0IHN5
c2ZzX29wcyBrb2JqX3BrdF9vcHMgPSB7CisJLnNob3cgPSBrb2JqX3BrdF9zaG93
LAorCS5zdG9yZSA9IGtvYmpfcGt0X3N0b3JlCit9Oworc3RhdGljIHN0cnVjdCBr
b2JqX3R5cGUga29ial9wa3RfdHlwZV9zdGF0ID0geworCS5yZWxlYXNlID0gcGt0
X2tvYmpfcmVsZWFzZSwKKwkuc3lzZnNfb3BzID0gJmtvYmpfcGt0X29wcywKKwku
ZGVmYXVsdF9hdHRycyA9IGtvYmpfcGt0X2F0dHJzX3N0YXQKK307CitzdGF0aWMg
c3RydWN0IGtvYmpfdHlwZSBrb2JqX3BrdF90eXBlX3dxdWV1ZSA9IHsKKwkucmVs
ZWFzZSA9IHBrdF9rb2JqX3JlbGVhc2UsCisJLnN5c2ZzX29wcyA9ICZrb2JqX3Br
dF9vcHMsCisJLmRlZmF1bHRfYXR0cnMgPSBrb2JqX3BrdF9hdHRyc193cXVldWUK
K307CisKK3N0YXRpYyB2b2lkIHBrdF9zeXNmc19kZXZfbmV3KHN0cnVjdCBwa3Rj
ZHZkX2RldmljZSAqcGQpCit7CisJaWYgKGNsYXNzX3BrdGNkdmQpIHsKKwkJcGQt
PmNsc2RldiA9IGNsYXNzX2RldmljZV9jcmVhdGUoY2xhc3NfcGt0Y2R2ZCwKKwkJ
CQkJTlVMTCwgcGQtPnBrdF9kZXYsCisJCQkJCU5VTEwsICIlcyIsIHBkLT5uYW1l
KTsKKwkJaWYgKElTX0VSUihwZC0+Y2xzZGV2KSkKKwkJCXBkLT5jbHNkZXYgPSBO
VUxMOworCX0KKwlpZiAocGQtPmNsc2RldikgeworCQlwZC0+a29ial9zdGF0ID0g
cGt0X2tvYmpfY3JlYXRlKHBkLCAic3RhdCIsCisJCQkJCSZwZC0+Y2xzZGV2LT5r
b2JqLAorCQkJCQkma29ial9wa3RfdHlwZV9zdGF0KTsKKwkJcGQtPmtvYmpfd3F1
ZXVlID0gcGt0X2tvYmpfY3JlYXRlKHBkLCAid3JpdGVfcXVldWUiLAorCQkJCQkm
cGQtPmNsc2Rldi0+a29iaiwKKwkJCQkJJmtvYmpfcGt0X3R5cGVfd3F1ZXVlKTsK
Kwl9Cit9CisKK3N0YXRpYyB2b2lkIHBrdF9zeXNmc19kZXZfcmVtb3ZlKHN0cnVj
dCBwa3RjZHZkX2RldmljZSAqcGQpCit7CisJcGt0X2tvYmpfcmVtb3ZlKHBkLT5r
b2JqX3N0YXQpOworCXBrdF9rb2JqX3JlbW92ZShwZC0+a29ial93cXVldWUpOwor
CWlmIChjbGFzc19wa3RjZHZkKQorCQljbGFzc19kZXZpY2VfZGVzdHJveShjbGFz
c19wa3RjZHZkLCBwZC0+cGt0X2Rldik7Cit9CisKKworLyoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqCisgIC9zeXMvY2xhc3MvcGt0Y2R2ZC8KKyAgICAgICAgICAgICAgICAg
ICAgIGFkZCAgICAgICAgICAgIG1hcCBibG9jayBkZXZpY2UKKyAgICAgICAgICAg
ICAgICAgICAgIHJlbW92ZSAgICAgICAgIHVubWFwIHBhY2tldCBkZXYKKyAgICAg
ICAgICAgICAgICAgICAgIGRldmljZV9tYXAgICAgIHNob3cgbWFwcGluZ3MKKyAq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqLworCitzdGF0aWMgdm9pZCBjbGFzc19wa3RjZHZk
X3JlbGVhc2Uoc3RydWN0IGNsYXNzICpjbHMpCit7CisJa2ZyZWUoY2xzKTsKK30K
K3N0YXRpYyBzc2l6ZV90IGNsYXNzX3BrdGNkdmRfc2hvd19tYXAoc3RydWN0IGNs
YXNzICpjLCBjaGFyICpkYXRhKQoreworCWludCBuID0gMDsKKwlpbnQgaWR4Owor
CW11dGV4X2xvY2tfbmVzdGVkKCZjdGxfbXV0ZXgsIFNJTkdMRV9ERVBUSF9ORVNU
SU5HKTsKKwlmb3IgKGlkeCA9IDA7IGlkeCA8IE1BWF9XUklURVJTOyBpZHgrKykg
eworCQlzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkID0gcGt0X2RldnNbaWR4XTsK
KwkJaWYgKCFwZCkKKwkJCWNvbnRpbnVlOworCQluICs9IHNwcmludGYoZGF0YStu
LCAiJXMgJXU6JXUgJXU6JXVcbiIsCisJCQlwZC0+bmFtZSwKKwkJCU1BSk9SKHBk
LT5wa3RfZGV2KSwgTUlOT1IocGQtPnBrdF9kZXYpLAorCQkJTUFKT1IocGQtPmJk
ZXYtPmJkX2RldiksCisJCQlNSU5PUihwZC0+YmRldi0+YmRfZGV2KSk7CisJfQor
CW11dGV4X3VubG9jaygmY3RsX211dGV4KTsKKwlyZXR1cm4gbjsKK30KKworc3Rh
dGljIHNzaXplX3QgY2xhc3NfcGt0Y2R2ZF9zdG9yZV9hZGQoc3RydWN0IGNsYXNz
ICpjLCBjb25zdCBjaGFyICpidWYsCisJCQkJCXNpemVfdCBjb3VudCkKK3sKKwl1
bnNpZ25lZCBpbnQgbWFqb3IsIG1pbm9yOworCURFQ0xBUkVfQlVGX0FTX1NUUklO
RyhkYnVmLCBidWYsIGNvdW50KTsKKwlpZiAoc3NjYW5mKGRidWYsICIldToldSIs
ICZtYWpvciwgJm1pbm9yKSA9PSAyKSB7CisJCXBrdF9zZXR1cF9kZXYoTUtERVYo
bWFqb3IsIG1pbm9yKSwgTlVMTCk7CisJCXJldHVybiBjb3VudDsKKwl9CisJcmV0
dXJuIC1FSU5WQUw7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNsYXNzX3BrdGNkdmRf
c3RvcmVfcmVtb3ZlKHN0cnVjdCBjbGFzcyAqYywgY29uc3QgY2hhciAqYnVmLAor
CQkJCQlzaXplX3QgY291bnQpCit7CisJdW5zaWduZWQgaW50IG1ham9yLCBtaW5v
cjsKKwlERUNMQVJFX0JVRl9BU19TVFJJTkcoZGJ1ZiwgYnVmLCBjb3VudCk7CisJ
aWYgKHNzY2FuZihkYnVmLCAiJXU6JXUiLCAmbWFqb3IsICZtaW5vcikgPT0gMikg
eworCQlwa3RfcmVtb3ZlX2RldihNS0RFVihtYWpvciwgbWlub3IpKTsKKwkJcmV0
dXJuIGNvdW50OworCX0KKwlyZXR1cm4gLUVJTlZBTDsKK30KKworc3RhdGljIHN0
cnVjdCBjbGFzc19hdHRyaWJ1dGUgY2xhc3NfcGt0Y2R2ZF9hdHRyc1tdID0gewor
IF9fQVRUUihhZGQsICAgICAgICAgICAgMDIwMCwgTlVMTCwgY2xhc3NfcGt0Y2R2
ZF9zdG9yZV9hZGQpLAorIF9fQVRUUihyZW1vdmUsICAgICAgICAgMDIwMCwgTlVM
TCwgY2xhc3NfcGt0Y2R2ZF9zdG9yZV9yZW1vdmUpLAorIF9fQVRUUihkZXZpY2Vf
bWFwLCAgICAgMDQ0NCwgY2xhc3NfcGt0Y2R2ZF9zaG93X21hcCwgTlVMTCksCisg
X19BVFRSX05VTEwKK307CisKKworc3RhdGljIGludCBwa3Rfc3lzZnNfaW5pdCh2
b2lkKQoreworCWludCByZXQgPSAwOworCQorCS8qCisJICogY3JlYXRlIGNvbnRy
b2wgZmlsZXMgaW4gc3lzZnMKKwkgKiAvc3lzL2NsYXNzL3BrdGNkdmQvLi4uCisJ
ICovCisJY2xhc3NfcGt0Y2R2ZCA9IGt6YWxsb2Moc2l6ZW9mKCpjbGFzc19wa3Rj
ZHZkKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFjbGFzc19wa3RjZHZkKQorCQlyZXR1
cm4gLUVOT01FTTsKKwljbGFzc19wa3RjZHZkLT5uYW1lID0gRFJJVkVSX05BTUU7
CisJY2xhc3NfcGt0Y2R2ZC0+b3duZXIgPSBUSElTX01PRFVMRTsKKwljbGFzc19w
a3RjZHZkLT5jbGFzc19yZWxlYXNlID0gY2xhc3NfcGt0Y2R2ZF9yZWxlYXNlOwor
CWNsYXNzX3BrdGNkdmQtPmNsYXNzX2F0dHJzID0gY2xhc3NfcGt0Y2R2ZF9hdHRy
czsKKwlyZXQgPSBjbGFzc19yZWdpc3RlcihjbGFzc19wa3RjZHZkKTsKKwlpZiAo
cmV0KSB7CisJCWtmcmVlKGNsYXNzX3BrdGNkdmQpOworCQljbGFzc19wa3RjZHZk
ID0gTlVMTDsKKwkJcHJpbnRrKERSSVZFUl9OQU1FIjogZmFpbGVkIHRvIGNyZWF0
ZSBjbGFzcyBwa3RjZHZkXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyB2b2lkIHBrdF9zeXNmc19jbGVhbnVwKHZvaWQpCit7
CisJaWYgKGNsYXNzX3BrdGNkdmQpCisJCWNsYXNzX2Rlc3Ryb3koY2xhc3NfcGt0
Y2R2ZCk7CisJY2xhc3NfcGt0Y2R2ZCA9IE5VTEw7Cit9CisKKy8qKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKgorICBlbnRyaWVzIGluIGRlYnVnZnMKKworICAvZGVidWdmcy9w
a3RjZHZkWzAtN10vCisJCQlpbmZvCisgIAorICoqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiov
CisKK3N0YXRpYyBpbnQgcGt0X2RlYnVnZnNfc2VxX3Nob3coc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpwKQoreworCXJldHVybiBwa3Rfc2VxX3Nob3cobSwgcCk7
Cit9CisKK3N0YXRpYyBpbnQgcGt0X2RlYnVnZnNfZm9wc19vcGVuKHN0cnVjdCBp
bm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQoreworCXJldHVybiBzaW5n
bGVfb3BlbihmaWxlLCBwa3RfZGVidWdmc19zZXFfc2hvdywgaW5vZGUtPmlfcHJp
dmF0ZSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGRlYnVn
X2ZvcHMgPSB7CisJLm9wZW4JCT0gcGt0X2RlYnVnZnNfZm9wc19vcGVuLAorCS5y
ZWFkCQk9IHNlcV9yZWFkLAorCS5sbHNlZWsJCT0gc2VxX2xzZWVrLAorCS5yZWxl
YXNlCT0gc2luZ2xlX3JlbGVhc2UsCisJLm93bmVyCQk9IFRISVNfTU9EVUxFLAor
fTsKKyAKK3N0YXRpYyB2b2lkIHBrdF9kZWJ1Z2ZzX2Rldl9uZXcoc3RydWN0IHBr
dGNkdmRfZGV2aWNlICpwZCkKK3sKKwlpZiAoIXBrdF9kZWJ1Z2ZzX3Jvb3QpCisJ
CXJldHVybjsKKwlwZC0+ZGZzX2ZfaW5mbyA9IE5VTEw7CisJcGQtPmRmc19kX3Jv
b3QgPSBkZWJ1Z2ZzX2NyZWF0ZV9kaXIocGQtPm5hbWUsIHBrdF9kZWJ1Z2ZzX3Jv
b3QpOworCWlmIChJU19FUlIocGQtPmRmc19kX3Jvb3QpKSB7CisJCXBkLT5kZnNf
ZF9yb290ID0gTlVMTDsKKwkJcmV0dXJuOworCX0KKwlwZC0+ZGZzX2ZfaW5mbyA9
IGRlYnVnZnNfY3JlYXRlX2ZpbGUoImluZm8iLCBTX0lSVUdPLAorCQkJCXBkLT5k
ZnNfZF9yb290LCBwZCwgJmRlYnVnX2ZvcHMpOworCWlmIChJU19FUlIocGQtPmRm
c19mX2luZm8pKSB7CisJCXBkLT5kZnNfZl9pbmZvID0gTlVMTDsKKwkJcmV0dXJu
OworCX0KK30KKworc3RhdGljIHZvaWQgcGt0X2RlYnVnZnNfZGV2X3JlbW92ZShz
dHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkKQoreworCWlmICghcGt0X2RlYnVnZnNf
cm9vdCkKKwkJcmV0dXJuOworCWlmIChwZC0+ZGZzX2ZfaW5mbykKKwkJZGVidWdm
c19yZW1vdmUocGQtPmRmc19mX2luZm8pOworCXBkLT5kZnNfZl9pbmZvID0gTlVM
TDsKKwlpZiAocGQtPmRmc19kX3Jvb3QpCisJCWRlYnVnZnNfcmVtb3ZlKHBkLT5k
ZnNfZF9yb290KTsKKwlwZC0+ZGZzX2Rfcm9vdCA9IE5VTEw7Cit9CisKK3N0YXRp
YyB2b2lkIHBrdF9kZWJ1Z2ZzX2luaXQodm9pZCkKK3sKKwlwa3RfZGVidWdmc19y
b290ID0gZGVidWdmc19jcmVhdGVfZGlyKERSSVZFUl9OQU1FLCBOVUxMKTsKKwlp
ZiAoSVNfRVJSKHBrdF9kZWJ1Z2ZzX3Jvb3QpKSB7CisJCXBrdF9kZWJ1Z2ZzX3Jv
b3QgPSBOVUxMOworCQlyZXR1cm47CisJfQorfQorCitzdGF0aWMgdm9pZCBwa3Rf
ZGVidWdmc19jbGVhbnVwKHZvaWQpCit7CisJaWYgKCFwa3RfZGVidWdmc19yb290
KQorCQlyZXR1cm47CisJZGVidWdmc19yZW1vdmUocGt0X2RlYnVnZnNfcm9vdCk7
CisJcGt0X2RlYnVnZnNfcm9vdCA9IE5VTEw7Cit9CisKKy8qIC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0q
LworCiAKIHN0YXRpYyB2b2lkIHBrdF9iaW9fZmluaXNoZWQoc3RydWN0IHBrdGNk
dmRfZGV2aWNlICpwZCkKIHsKQEAgLTI1MjYsNiArMjk0MSw5IEBAIHN0YXRpYyBp
bnQgcGt0X3NldHVwX2RldihkZXZfdCBkZXYsIGRldl8KIAkJZ290byBvdXRfbmV3
X2RldjsKIAogCWFkZF9kaXNrKGRpc2spOworCQorCXBrdF9zeXNmc19kZXZfbmV3
KHBkKTsKKwlwa3RfZGVidWdmc19kZXZfbmV3KHBkKTsKIAogCXBrdF9kZXZzW2lk
eF0gPSBwZDsKIAlpZiAocGt0X2RldikKQEAgLTI1NzcsNiArMjk5NSwxMSBAQCBz
dGF0aWMgaW50IHBrdF9yZW1vdmVfZGV2KGRldl90IHBrdF9kZXYpCiAJaWYgKCFJ
U19FUlIocGQtPmNkcncudGhyZWFkKSkKIAkJa3RocmVhZF9zdG9wKHBkLT5jZHJ3
LnRocmVhZCk7CiAKKwlwa3RfZGV2c1tpZHhdID0gTlVMTDsKKworCXBrdF9kZWJ1
Z2ZzX2Rldl9yZW1vdmUocGQpOworCXBrdF9zeXNmc19kZXZfcmVtb3ZlKHBkKTsK
KwogCWJsa2Rldl9wdXQocGQtPmJkZXYpOwogCiAJcmVtb3ZlX3Byb2NfZW50cnko
cGQtPm5hbWUsIHBrdF9wcm9jKTsKQEAgLTI1ODYsNyArMzAwOSw2IEBAIHN0YXRp
YyBpbnQgcGt0X3JlbW92ZV9kZXYoZGV2X3QgcGt0X2RldikKIAlibGtfY2xlYW51
cF9xdWV1ZShwZC0+ZGlzay0+cXVldWUpOwogCXB1dF9kaXNrKHBkLT5kaXNrKTsK
IAotCXBrdF9kZXZzW2lkeF0gPSBOVUxMOwogCW1lbXBvb2xfZGVzdHJveShwZC0+
cmJfcG9vbCk7CiAJa2ZyZWUocGQpOwogCkBAIC0yNjcwLDYgKzMwOTIsOCBAQCBz
dGF0aWMgaW50IF9faW5pdCBwa3RfaW5pdCh2b2lkKQogewogCWludCByZXQ7CiAK
KwltdXRleF9pbml0KCZjdGxfbXV0ZXgpOworCiAJcHNkX3Bvb2wgPSBtZW1wb29s
X2NyZWF0ZV9rbWFsbG9jX3Bvb2woUFNEX1BPT0xfU0laRSwKIAkJCQkJc2l6ZW9m
KHN0cnVjdCBwYWNrZXRfc3RhY2tlZF9kYXRhKSk7CiAJaWYgKCFwc2RfcG9vbCkK
QEAgLTI2ODMsMTggKzMxMDcsMjUgQEAgc3RhdGljIGludCBfX2luaXQgcGt0X2lu
aXQodm9pZCkKIAlpZiAoIXBrdGRldl9tYWpvcikKIAkJcGt0ZGV2X21ham9yID0g
cmV0OwogCisJcmV0ID0gcGt0X3N5c2ZzX2luaXQoKTsKKwlpZiAocmV0KQorCQln
b3RvIG91dDsKKworCXBrdF9kZWJ1Z2ZzX2luaXQoKTsKKwogCXJldCA9IG1pc2Nf
cmVnaXN0ZXIoJnBrdF9taXNjKTsKIAlpZiAocmV0KSB7CiAJCXByaW50ayhEUklW
RVJfTkFNRSI6IFVuYWJsZSB0byByZWdpc3RlciBtaXNjIGRldmljZVxuIik7Ci0J
CWdvdG8gb3V0OworCQlnb3RvIG91dF9taXNjOwogCX0KIAotCW11dGV4X2luaXQo
JmN0bF9tdXRleCk7Ci0KIAlwa3RfcHJvYyA9IHByb2NfbWtkaXIoRFJJVkVSX05B
TUUsIHByb2Nfcm9vdF9kcml2ZXIpOwogCiAJcmV0dXJuIDA7CiAKK291dF9taXNj
OgorCXBrdF9kZWJ1Z2ZzX2NsZWFudXAoKTsKKwlwa3Rfc3lzZnNfY2xlYW51cCgp
Owogb3V0OgogCXVucmVnaXN0ZXJfYmxrZGV2KHBrdGRldl9tYWpvciwgRFJJVkVS
X05BTUUpOwogb3V0MjoKQEAgLTI3MDYsNiArMzEzNywxMCBAQCBzdGF0aWMgdm9p
ZCBfX2V4aXQgcGt0X2V4aXQodm9pZCkKIHsKIAlyZW1vdmVfcHJvY19lbnRyeShE
UklWRVJfTkFNRSwgcHJvY19yb290X2RyaXZlcik7CiAJbWlzY19kZXJlZ2lzdGVy
KCZwa3RfbWlzYyk7CisJCisJcGt0X2RlYnVnZnNfY2xlYW51cCgpOworCXBrdF9z
eXNmc19jbGVhbnVwKCk7CisJCiAJdW5yZWdpc3Rlcl9ibGtkZXYocGt0ZGV2X21h
am9yLCBEUklWRVJfTkFNRSk7CiAJbWVtcG9vbF9kZXN0cm95KHBzZF9wb29sKTsK
IH0KZGlmZiAtdXJwTiBsaW51eC0yLjYuMTktcmMyLW1tMi9pbmNsdWRlL2xpbnV4
L3BrdGNkdmQuaCAxLXN5c2ZzLWRlYnVnZnMvaW5jbHVkZS9saW51eC9wa3RjZHZk
LmgKLS0tIGxpbnV4LTIuNi4xOS1yYzItbW0yL2luY2x1ZGUvbGludXgvcGt0Y2R2
ZC5oCTIwMDYtMTAtMjEgMjE6NDk6MTcuMDAwMDAwMDAwICswMjAwCisrKyAxLXN5
c2ZzLWRlYnVnZnMvaW5jbHVkZS9saW51eC9wa3RjZHZkLmgJMjAwNi0xMC0yMSAy
MTo1Mzo0Ny4wMDAwMDAwMDAgKzAyMDAKQEAgLTExMSw3ICsxMTEsOCBAQCBzdHJ1
Y3QgcGt0X2N0cmxfY29tbWFuZCB7CiAjaW5jbHVkZSA8bGludXgvYmxrZGV2Lmg+
CiAjaW5jbHVkZSA8bGludXgvY29tcGxldGlvbi5oPgogI2luY2x1ZGUgPGxpbnV4
L2Nkcm9tLmg+Ci0KKyNpbmNsdWRlIDxsaW51eC9rb2JqZWN0Lmg+CisjaW5jbHVk
ZSA8bGludXgvc3lzZnMuaD4KIAogLyogZGVmYXVsdCBiaW8gd3JpdGUgcXVldWUg
Y29uZ2VzdGlvbiBtYXJrcyAqLwogI2RlZmluZSBQS1RfV1JJVEVfQ09OR0VTVElP
Tl9PTiAgICAxMDAwMApAQCAtMjQ3LDYgKzI0OCwxNCBAQCBzdHJ1Y3QgcGFja2V0
X3N0YWNrZWRfZGF0YQogfTsKICNkZWZpbmUgUFNEX1BPT0xfU0laRQkJNjQKIAor
c3RydWN0IHBrdGNkdmRfa29iagoreworCXN0cnVjdCBrb2JqZWN0CQlrb2JqOwor
CXN0cnVjdCBwa3RjZHZkX2RldmljZQkqcGQ7Cit9OworI2RlZmluZSB0b19wa3Rj
ZHZka29iaihfaykgXAorICAoKHN0cnVjdCBwa3RjZHZkX2tvYmoqKWNvbnRhaW5l
cl9vZihfayxzdHJ1Y3QgcGt0Y2R2ZF9rb2JqLGtvYmopKQorCiBzdHJ1Y3QgcGt0
Y2R2ZF9kZXZpY2UKIHsKIAlzdHJ1Y3QgYmxvY2tfZGV2aWNlCSpiZGV2OwkJLyog
ZGV2IGF0dGFjaGVkICovCkBAIC0yODAsNiArMjg5LDEzIEBAIHN0cnVjdCBwa3Rj
ZHZkX2RldmljZQogCiAJaW50CQkJd3JpdGVfY29uZ2VzdGlvbl9vZmY7CiAJaW50
CQkJd3JpdGVfY29uZ2VzdGlvbl9vbjsKKwkKKwlzdHJ1Y3QgY2xhc3NfZGV2aWNl
CSpjbHNkZXY7CS8qIHN5c2ZzIHBrdGNkdmRbMC03XSBjbGFzcyBkZXYgKi8gCisJ
c3RydWN0IHBrdGNkdmRfa29iagkqa29ial9zdGF0OwkvKiBzeXNmcyBwa3RjZHZk
WzAtN10vc3RhdC8gICAgICovCisJc3RydWN0IHBrdGNkdmRfa29iagkqa29ial93
cXVldWU7CS8qIHN5c2ZzIHBrdGNkdmRbMC03XS93cml0ZV9xdWV1ZS8gKi8KKwkK
KwlzdHJ1Y3QgZGVudHJ5CQkqZGZzX2Rfcm9vdDsJLyogZGVidWdmczogZGV2bmFt
ZSBkaXJlY3RvcnkgKi8KKwlzdHJ1Y3QgZGVudHJ5CQkqZGZzX2ZfaW5mbzsJLyog
ZGVidWdmczogaW5mbyBmaWxlICovCiB9OwogCiAjZW5kaWYgLyogX19LRVJORUxf
XyAqLwo=

------------hwWKFn2jd84xAw9EVebSv7--

