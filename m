Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S263311AbREWW5k>; Wed, 23 May 2001 18:57:40 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S263306AbREWW4h>; Wed, 23 May 2001 18:56:37 -0400
Received: from echo.sound.net ([205.242.192.21]:997 "HELO echo.sound.net")
	by vger.kernel.org with SMTP id <S263307AbREWWzc>;
	Wed, 23 May 2001 18:55:32 -0400
Date: Wed, 23 May 2001 17:54:04 -0500 (CDT)
From: Hal Duston <hald@sound.net>
To: linux-kernel@vger.kernel.org
cc: alan@lxorguk.ukuu.org.uk
Subject: PS/2 Esdi patch #8
Message-ID: <Pine.GSO.4.10.10105231748550.23376-200000@sound.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-684387517-990658216=:23376"
Content-ID: <Pine.GSO.4.10.10105231751520.23376@sound.net>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---559023410-684387517-990658216=:23376
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.GSO.4.10.10105231751521.23376@sound.net>

Get soft reset at initialization working again.

Remove reset_time code.  (Re-add timeouts some time later.)
Eliminate remaining sleep_on() calls.
Encapsulate access to esdi attention register.
Correct some formatting in config display.
Correct soft reset logic.

Also...
http://www.sound.net/~hald/projects/ps2esdi/ps2esdi-2.4.4-patch4

Hal Duston
hald@sound.net

---559023410-684387517-990658216=:23376
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII; NAME="ps2esdi-2.4.4-patch4"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.GSO.4.10.10105231750160.23376@sound.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="ps2esdi-2.4.4-patch4"

R2V0IHNvZnQgcmVzZXQgYXQgaW5pdGlhbGl6YXRpb24gd29ya2luZyBhZ2Fp
bi4NCg0KUmVtb3ZlIHJlc2V0X3RpbWUgY29kZS4gIChSZS1hZGQgdGltZW91
dHMgc29tZSB0aW1lIGxhdGVyLikNCkVsaW1pbmF0ZSByZW1haW5pbmcgc2xl
ZXBfb24oKSBjYWxscy4NCkVuY2Fwc3VsYXRlIGFjY2VzcyB0byBlc2RpIGF0
dGVudGlvbiByZWdpc3Rlci4NCkNvcnJlY3Qgc29tZSBmb3JtYXR0aW5nIGlu
IGNvbmZpZyBkaXNwbGF5Lg0KQ29ycmVjdCBzb2Z0IHJlc2V0IGxvZ2ljLg0K
DQotLS0gbGludXgtMi40LjUtcHJlNC9kcml2ZXJzL2Jsb2NrL3BzMmVzZGku
Yy4zCU1vbiBNYXkgMjEgMDA6MDc6MzggMjAwMQ0KKysrIGxpbnV4LTIuNC41
LXByZTQvZHJpdmVycy9ibG9jay9wczJlc2RpLmMuNAlNb24gTWF5IDIxIDAw
OjE2OjQ5IDIwMDENCkBAIC0xMDcsNiArMTA3LDggQEANCiANCiBzdGF0aWMg
dm9pZCBwczJlc2RpX3Jlc2V0X3RpbWVyKHVuc2lnbmVkIGxvbmcgdW51c2Vk
KTsNCiANCitzdGF0aWMgaW50IHBzMmVzZGlfYXR0ZW50aW9uKHVfaW50IGRl
dmljZSwgdV9pbnQgcmVxdWVzdCk7DQorDQogc3RhdGljIHVfaW50IGRtYV9h
cmJfbGV2ZWw7CQkvKiBETUEgYXJiaXRyYXRpb24gbGV2ZWwgKi8NCiANCiBz
dGF0aWMgREVDTEFSRV9XQUlUX1FVRVVFX0hFQUQocHMyZXNkaV9pbnQpOw0K
QEAgLTQ2MCwxOSArNDYyLDggQEANCiAJY3VycmVudF9pbnRfaGFuZGxlciA9
IHBzMmVzZGlfaW5pdGlhbF9yZXNldF9pbnRfaGFuZGxlcjsNCiAJcmVzZXRf
Y3RybCgpOw0KIAlyZXNldF9zdGF0dXMgPSAwOw0KLQlyZXNldF9zdGFydCA9
IGppZmZpZXM7DQotCXdoaWxlICghcmVzZXRfc3RhdHVzKSB7DQotCQlpbml0
X3RpbWVyKCZlc2RpX3RpbWVyKTsNCi0JCWVzZGlfdGltZXIuZXhwaXJlcyA9
IGppZmZpZXMgKyBIWjsNCi0JCWVzZGlfdGltZXIuZGF0YSA9IDA7DQotCQlh
ZGRfdGltZXIoJmVzZGlfdGltZXIpOw0KLQkJc2xlZXBfb24oJnBzMmVzZGlf
aW50KTsNCi0JfQ0KLQlyZXNldF9lbmQgPSBqaWZmaWVzOw0KKwl3YWl0X2V2
ZW50KHBzMmVzZGlfaW50LCByZXNldF9zdGF0dXMpOw0KIAlMSVRFX09GRjsN
Ci0JcHJpbnRrKCIlczogcmVzZXQgaW50ZXJydXB0IGFmdGVyICVkIGppZmZp
ZXMsICAldS4lMDJ1IHNlY3NcbiIsDQotCSAgICAgICBERVZJQ0VfTkFNRSwg
cmVzZXRfZW5kIC0gcmVzZXRfc3RhcnQsIChyZXNldF9lbmQgLSByZXNldF9z
dGFydCkgLyBIWiwNCi0JICAgICAgIChyZXNldF9lbmQgLSByZXNldF9zdGFy
dCkgJSBIWik7DQogDQogDQogCS8qIEludGVncmF0ZWQgRVNESSBEaXNrIGFu
ZCBDb250cm9sbGVyIGhhcyBvbmx5IG9uZSBkcml2ZSEgKi8NCkBAIC01MjIs
OCArNTEzLDcgQEANCiAJCWNtZF9ibGtbMV0gPSAwOw0KIAkJbm9faW50X3ll
dCA9IFRSVUU7DQogCQlwczJlc2RpX291dF9jbWRfYmxrKGNtZF9ibGspOw0K
LQkJaWYgKG5vX2ludF95ZXQpDQotCQkJc2xlZXBfb24oJnBzMmVzZGlfaW50
KTsNCisJCXdhaXRfZXZlbnQocHMyZXNkaV9pbnQsICFub19pbnRfeWV0KTsN
CiAJfQ0KIAlyZXR1cm47DQogfQ0KQEAgLTU5NywzMiArNTg3LDIwIEBADQog
ew0KIA0KIAl1X2xvbmcgZXhwaXJlOw0KLQl1X3Nob3J0IHN0YXR1czsNCi0N
Ci0JLyogZW5hYmxlIGludGVycnVwdHMgb24gdGhlIGNvbnRyb2xsZXIgKi8N
Ci0Jc3RhdHVzID0gaW5iKEVTRElfSU5UUlBUKTsNCi0Jb3V0Yigoc3RhdHVz
ICYgMHhlMCkgfCBBVFRfRU9JLCBFU0RJX0FUVE4pOwkvKiB0byBiZSBzdXJl
IHdlIGRvbid0IGhhdmUNCi0JCQkJCQkJICAgYW55IGludGVycnVwdCBwZW5k
aW5nLi4uICovDQotCW91dGIoQ1RSTF9FTkFCTEVfSU5UUiwgRVNESV9DT05U
Uk9MKTsNCiANCi0JLyogcmVhZCB0aGUgRVNESSBzdGF0dXMgcG9ydCAtIGlm
IHRoZSBjb250cm9sbGVyIGlzIG5vdCBidXN5LA0KLQkgICBzaW1wbHkgZG8g
YSBzb2Z0IHJlc2V0IChmYXN0KSAtIG90aGVyd2lzZSB3ZSdsbCBoYXZlIHRv
IGRvIGENCi0JICAgaGFyZCAoc2xvdykgcmVzZXQuICAqLw0KLQlpZiAoIShp
bmIoRVNESV9TVEFUVVMpICYgU1RBVFVTX0JVU1kpKSB7DQorCWlmKCFwczJl
c2RpX2F0dGVudGlvbigweDA3LCAweDA0KSkgew0KIAkJLypCQSAqLyBwcmlu
dGsoIiVzOiBzb2Z0IHJlc2V0Li4uXG4iLCBERVZJQ0VfTkFNRSk7DQotCQlv
dXRiKENUUkxfU09GVF9SRVNFVCwgRVNESV9BVFROKTsNCiAJfQ0KLQkvKiBz
b2Z0IHJlc2V0ICovIA0KKwkvKiBzb2Z0IHJlc2V0ICovDQogCWVsc2Ugew0K
IAkJLypCQSAqLw0KIAkJcHJpbnRrKCIlczogaGFyZCByZXNldC4uLlxuIiwg
REVWSUNFX05BTUUpOw0KIAkJb3V0YihDVFJMX0hBUkRfUkVTRVQsIEVTRElf
Q09OVFJPTCk7DQotCQlleHBpcmUgPSBqaWZmaWVzICsgMipIWjsNCi0JCXdo
aWxlICh0aW1lX2JlZm9yZShqaWZmaWVzLCBleHBpcmUpKTsNCi0JCW91dGIo
MSwgRVNESV9DT05UUk9MKTsNCisJCWV4cGlyZSA9IGppZmZpZXMgKyAyICog
SFo7DQorCQl3aGlsZSh0aW1lX2JlZm9yZShqaWZmaWVzLCBleHBpcmUpKQ0K
KwkJe30NCisJCW91dGIoQ1RSTF9FTkFCTEVfSU5UUiwgRVNESV9DT05UUk9M
KTsNCiAJfQkJCS8qIGhhcmQgcmVzZXQgKi8NCi0NCi0NCiB9CQkJCS8qIHJl
c2V0IHRoZSBjb250cm9sbGVyICovDQogDQogLyogY2FsbGVkIGJ5IHRoZSBz
dHJhdGVneSByb3V0aW5lIHRvIGhhbmRsZSByZWFkIGFuZCB3cml0ZSByZXF1
ZXN0cyAqLw0KQEAgLTY5NSwxMyArNjczLDEwIEBADQogCXByaW50aygiJXM6
IGkoMSk9JWRcbiIsIERFVklDRV9OQU1FLCBpKTsNCiAjZW5kaWYNCiANCi0J
LyogaWYgZGV2aWNlIGlzIHN0aWxsIGJ1c3kgLSB0aGVuIGp1c3QgdGltZSBv
dXQgKi8NCi0JaWYgKGluYihFU0RJX1NUQVRVUykgJiBTVEFUVVNfQlVTWSkg
ew0KLQkJcHJpbnRrKCIlczogcHMyZXNkaV9vdXRfY21kIHRpbWVkIG91dCAo
MSlcbiIsIERFVklDRV9OQU1FKTsNCisJaWYocHMyZXNkaV9hdHRlbnRpb24o
KGNtZF9ibGtbMF0gJiAweGUwKSA+PiA1LCAweDAxKSkgew0KKwkJcHJpbnRr
KCIlczogcHMyZXNkaV9vdXRfY21kIHRpbWVkIG91dCAoJXgpXG4iLCBERVZJ
Q0VfTkFNRSwgKGNtZF9ibGtbMF0gJiAweGUwKSA+PiA1KTsNCiAJCXJldHVy
biBFUlJPUjsNCi0JfQkJCS8qIHRpbWVvdXQgPz8/ICovDQotCS8qIFNldCB1
cCB0aGUgYXR0ZW50aW9uIHJlZ2lzdGVyIGluIHRoZSBjb250cm9sbGVyICov
DQotCW91dGIoKCgqY21kX2JsaykgJiAweEUwKSB8IDEsIEVTRElfQVRUTik7
DQorCX0NCiANCiAjaWYgMA0KIAlwcmludGsoIiVzOiBzZW5kaW5nICVkIHdv
cmRzIHRvIGNvbnRyb2xsZXJcbiIsIERFVklDRV9OQU1FLCAoKCgqY21kX2Js
aykgPj4gMTQpICsgMSkgPDwgMSk7DQpAQCAtNzc0LDI1ICs3NDksMjUgQEAN
CiBzdGF0aWMgdm9pZCBwczJlc2RpX2luaXRpYWxfcmVzZXRfaW50X2hhbmRs
ZXIodV9pbnQgaW50X3JldF9jb2RlKQ0KIHsNCiANCisJcmVzZXRfc3RhdHVz
ID0gaW50X3JldF9jb2RlOw0KIAlzd2l0Y2ggKGludF9yZXRfY29kZSAmIDB4
Zikgew0KIAljYXNlIElOVF9SRVNFVDoNCiAJCS8qQkEgKi8NCiAJCXByaW50
aygiJXM6IGluaXRpYWwgcmVzZXQgY29tcGxldGVkLlxuIiwgREVWSUNFX05B
TUUpOw0KLQkJb3V0YigoaW50X3JldF9jb2RlICYgMHhlMCkgfCBBVFRfRU9J
LCBFU0RJX0FUVE4pOw0KKwkJcHMyZXNkaV9hdHRlbnRpb24oKGludF9yZXRf
Y29kZSAmIDB4ZTApID4+IDUsIEFUVF9FT0kpOw0KIAkJd2FrZV91cCgmcHMy
ZXNkaV9pbnQpOw0KIAkJYnJlYWs7DQogCWNhc2UgSU5UX0FUVE5fRVJST1I6
DQotCQlwcmludGsoIiVzOiBBdHRlbnRpb24gZXJyb3IuIGludGVycnVwdCBz
dGF0dXMgOiAlMDJYXG4iLCBERVZJQ0VfTkFNRSwNCisJCXByaW50aygiJXM6
IEF0dGVudGlvbiBlcnJvciBkdXJpbmcgcmVzZXQuIGludGVycnVwdCBzdGF0
dXMgOiAlMDJYXG4iLCBERVZJQ0VfTkFNRSwNCiAJCSAgICAgICBpbnRfcmV0
X2NvZGUpOw0KIAkJcHJpbnRrKCIlczogc3RhdHVzOiAlMDJ4XG4iLCBERVZJ
Q0VfTkFNRSwgaW5iKEVTRElfU1RBVFVTKSk7DQogCQlicmVhazsNCiAJZGVm
YXVsdDoNCiAJCXByaW50aygiJXM6IGluaXRpYWwgcmVzZXQgaGFuZGxlciBy
ZWNlaXZlZCBpbnRlcnJ1cHQ6ICUwMlhcbiIsDQogCQkgICAgICAgREVWSUNF
X05BTUUsIGludF9yZXRfY29kZSk7DQotCQlvdXRiKChpbnRfcmV0X2NvZGUg
JiAweGUwKSB8IEFUVF9FT0ksIEVTRElfQVRUTik7DQorCQlwczJlc2RpX2F0
dGVudGlvbigoaW50X3JldF9jb2RlICYgMHhlMCkgPj4gNSwgQVRUX0VPSSk7
DQogCQlicmVhazsNCiAJfQ0KLQlvdXRiKENUUkxfRU5BQkxFX0lOVFIsIEVT
RElfQ09OVFJPTCk7DQogfQ0KIA0KIA0KQEAgLTgyMSwxMCArNzk2LDEwIEBA
DQogCQkJCXByaW50aygiJXM6IERldmljZSBDb25maWd1cmF0aW9uIFN0YXR1
cyBmb3IgZHJpdmUgJXVcbiIsDQogCQkJCSAgICAgICBERVZJQ0VfTkFNRSwg
ZHJpdmVfbnVtKTsNCiANCi0JCQkJcHJpbnRrKCIlczogU3BhcmVzL2N5bHM6
ICV1IiwgREVWSUNFX05BTUUsIHJlcGx5WzBdID4+IDgpOw0KKwkJCQlwcmlu
dGsoIiVzOiBTcGFyZXMvY3lsczogJXVcbiIsIERFVklDRV9OQU1FLCByZXBs
eVswXSA+PiA4KTsNCiANCiAJCQkJcHJpbnRrDQotCQkJCSAgICAoIkNvbmZp
ZyBiaXRzOiAlcyVzJXMlcyVzXG4iLA0KKwkJCQkgICAgKCIlczogQ29uZmln
IGJpdHM6ICVzJXMlcyVzJXNcbiIsIERFVklDRV9OQU1FLA0KIAkJCQkgICAg
IChyZXBseVswXSAmIENPTkZJR19JUykgPyAiSW52YWxpZCBTZWNvbmRhcnks
ICIgOiAiIiwNCiAJCQkJICAgICAoKHJlcGx5WzBdICYgQ09ORklHX1pEKSAm
JiAhKHJlcGx5WzBdICYgQ09ORklHX0lTKSkNCiAJCQkJID8gIlplcm8gRGVm
ZWN0LCAiIDogIkRlZmVjdHMgUHJlc2VudCwgIiwNCkBAIC04NzcsMTEgKzg1
MiwxMSBAQA0KIAkJCXByaW50aygiJXM6IGNvbW1hbmQgJTAyWCB1bmtub3du
IGJ5IGdlb21ldHJ5IGhhbmRsZXJcbiIsDQogCQkJICAgICAgIERFVklDRV9O
QU1FLCBzdGF0dXMgJiAweDFmKTsNCiANCi0JCW91dGIoKGludF9yZXRfY29k
ZSAmIDB4ZTApIHwgQVRUX0VPSSwgRVNESV9BVFROKTsNCisJCXBzMmVzZGlf
YXR0ZW50aW9uKChpbnRfcmV0X2NvZGUgJiAweGUwKSA+PiA1LCBBVFRfRU9J
KTsNCiAJCWJyZWFrOw0KIA0KIAljYXNlIElOVF9BVFROX0VSUk9SOg0KLQkJ
cHJpbnRrKCIlczogQXR0ZW50aW9uIGVycm9yLiBpbnRlcnJ1cHQgc3RhdHVz
IDogJTAyWFxuIiwgREVWSUNFX05BTUUsDQorCQlwcmludGsoIiVzOiBBdHRl
bnRpb24gZXJyb3IgZHVyaW5nIGdlb21ldHJ5LiBpbnRlcnJ1cHQgc3RhdHVz
IDogJTAyWFxuIiwgREVWSUNFX05BTUUsDQogCQkgICAgICAgaW50X3JldF9j
b2RlKTsNCiAJCXByaW50aygiJXM6IERldmljZSBub3QgYXZhaWxhYmxlXG4i
LCBERVZJQ0VfTkFNRSk7DQogCQktLXBzMmVzZGlfZHJpdmVzOw0KQEAgLTg5
NiwxOSArODcxLDE4IEBADQogCWNhc2UgSU5UX0NNRF9CTEtfRVJSOg0KIAkJ
LypCQSAqLyBwcmludGsoIiVzOiBXaGFhLiBFcnJvciBvY2N1cnJlZC4uLlxu
IiwgREVWSUNFX05BTUUpOw0KIAkJZHVtcF9jbWRfY29tcGxldGVfc3RhdHVz
KGludF9yZXRfY29kZSk7DQotCQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUw
KSB8IEFUVF9FT0ksIEVTRElfQVRUTik7DQorCQlwczJlc2RpX2F0dGVudGlv
bigoaW50X3JldF9jb2RlICYgMHhlMCkgPj4gNSwgQVRUX0VPSSk7DQogCQkt
LXBzMmVzZGlfZHJpdmVzOw0KIAkJYnJlYWs7DQogCWRlZmF1bHQ6DQogCQlw
cmludGsoIiVzOiBVbmtub3duIGludGVycnVwdCByZWFzb246ICUwMlhcbiIs
DQogCQkgICAgICAgREVWSUNFX05BTUUsIGludF9yZXRfY29kZSAmIDB4Zik7
DQotCQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9FT0ksIEVT
RElfQVRUTik7DQorCQlwczJlc2RpX2F0dGVudGlvbigoaW50X3JldF9jb2Rl
ICYgMHhlMCkgPj4gNSwgQVRUX0VPSSk7DQogCQlicmVhazsNCiAJfQ0KIA0K
IAl3YWtlX3VwKCZwczJlc2RpX2ludCk7DQogCW5vX2ludF95ZXQgPSBGQUxT
RTsNCi0Jb3V0YihDVFJMX0VOQUJMRV9JTlRSLCBFU0RJX0NPTlRST0wpOw0K
IA0KIH0NCiANCkBAIC05MzAsNyArOTA0LDcgQEANCiAJCWJyZWFrOw0KIA0K
IAljYXNlIElOVF9BVFROX0VSUk9SOg0KLQkJcHJpbnRrKCIlczogQXR0ZW50
aW9uIGVycm9yLiBpbnRlcnJ1cHQgc3RhdHVzIDogJTAyWFxuIiwgREVWSUNF
X05BTUUsDQorCQlwcmludGsoIiVzOiBBdHRlbnRpb24gZXJyb3IgZHVyaW5n
IG5vcm1hbC4gaW50ZXJydXB0IHN0YXR1cyA6ICUwMlhcbiIsIERFVklDRV9O
QU1FLA0KIAkJICAgICAgIGludF9yZXRfY29kZSk7DQogCQlvdXRiKENUUkxf
RU5BQkxFX0lOVFIsIEVTRElfQ09OVFJPTCk7DQogCQllbmRpbmcgPSBGQUlM
Ow0KQEAgLTk0MCw4ICs5MTQsNyBAQA0KIAkJZm9yIChpID0gRVNESV9USU1F
T1VUOyBpICYgIShpbmIoRVNESV9TVEFUVVMpICYgU1RBVFVTX1NUQVRfQVZB
SUwpOyBpLS0pOw0KIAkJaWYgKCEoaW5iKEVTRElfU1RBVFVTKSAmIFNUQVRV
U19TVEFUX0FWQUlMKSkgew0KIAkJCXByaW50aygiJXM6IHRpbWVvdXQgcmVh
ZGluZyBzdGF0dXMgd29yZFxuIiwgREVWSUNFX05BTUUpOw0KLQkJCW91dGIo
KGludF9yZXRfY29kZSAmIDB4ZTApIHwgQVRUX0VPSSwgRVNESV9BVFROKTsN
Ci0JCQlvdXRiKENUUkxfRU5BQkxFX0lOVFIsIEVTRElfQ09OVFJPTCk7DQor
CQkJcHMyZXNkaV9hdHRlbnRpb24oKGludF9yZXRfY29kZSAmIDB4ZTApID4+
IDUsIEFUVF9FT0kpOw0KIAkJCWlmICgoKytDVVJSRU5ULT5lcnJvcnMpID49
IE1BWF9SRVRSSUVTKQ0KIAkJCQllbmRpbmcgPSBGQUlMOw0KIAkJCWVsc2UN
CkBAIC05NTMsOCArOTI2LDcgQEANCiAJCWNhc2UgKENNRF9SRUFEICYgMHhm
Zik6DQogCQljYXNlIChDTURfV1JJVEUgJiAweGZmKToNCiAJCQlMSVRFX09G
RjsNCi0JCQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9FT0ks
IEVTRElfQVRUTik7DQotCQkJb3V0YihDVFJMX0VOQUJMRV9JTlRSLCBFU0RJ
X0NPTlRST0wpOw0KKwkJCXBzMmVzZGlfYXR0ZW50aW9uKChpbnRfcmV0X2Nv
ZGUgJiAweGUwKSA+PiA1LCBBVFRfRU9JKTsNCiAjaWYgMA0KIAkJCXByaW50
aygicHMyZXNkaTogY21kX2NvbXBsZXRlIGJfd2FpdDogJXBcbiIsICZDVVJS
RU5ULT5iaC0+Yl93YWl0KTsNCiAjZW5kaWYNCkBAIC05NjMsOCArOTM1LDcg
QEANCiAJCWRlZmF1bHQ6DQogCQkJcHJpbnRrKCIlczogaW50ZXJydXB0IGZv
ciB1bmtub3duIGNvbW1hbmQgJTAyWFxuIiwNCiAJCQkgICAgICAgREVWSUNF
X05BTUUsIHN0YXR1cyAmIDB4MWYpOw0KLQkJCW91dGIoKGludF9yZXRfY29k
ZSAmIDB4ZTApIHwgQVRUX0VPSSwgRVNESV9BVFROKTsNCi0JCQlvdXRiKENU
UkxfRU5BQkxFX0lOVFIsIEVTRElfQ09OVFJPTCk7DQorCQkJcHMyZXNkaV9h
dHRlbnRpb24oKGludF9yZXRfY29kZSAmIDB4ZTApID4+IDUsIEFUVF9FT0kp
Ow0KIAkJCWVuZGluZyA9IC0xOw0KIAkJCWJyZWFrOw0KIAkJfQ0KQEAgLTk3
NCw4ICs5NDUsNyBAQA0KIAljYXNlIElOVF9DTURfRUNDX1JFVFJZOg0KIAkJ
TElURV9PRkY7DQogCQlkdW1wX2NtZF9jb21wbGV0ZV9zdGF0dXMoaW50X3Jl
dF9jb2RlKTsNCi0JCW91dGIoKGludF9yZXRfY29kZSAmIDB4ZTApIHwgQVRU
X0VPSSwgRVNESV9BVFROKTsNCi0JCW91dGIoQ1RSTF9FTkFCTEVfSU5UUiwg
RVNESV9DT05UUk9MKTsNCisJCXBzMmVzZGlfYXR0ZW50aW9uKChpbnRfcmV0
X2NvZGUgJiAweGUwKSA+PiA1LCBBVFRfRU9JKTsNCiAJCWVuZGluZyA9IFNV
Q0NFUzsNCiAJCWJyZWFrOw0KIAljYXNlIElOVF9DTURfV0FSTklORzoNCkBA
IC05ODQsOCArOTU0LDcgQEANCiAJY2FzZSBJTlRfRE1BX0VSUjoNCiAJCUxJ
VEVfT0ZGOw0KIAkJZHVtcF9jbWRfY29tcGxldGVfc3RhdHVzKGludF9yZXRf
Y29kZSk7DQotCQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9F
T0ksIEVTRElfQVRUTik7DQotCQlvdXRiKENUUkxfRU5BQkxFX0lOVFIsIEVT
RElfQ09OVFJPTCk7DQorCQlwczJlc2RpX2F0dGVudGlvbigoaW50X3JldF9j
b2RlICYgMHhlMCkgPj4gNSwgQVRUX0VPSSk7DQogCQlpZiAoKCsrQ1VSUkVO
VC0+ZXJyb3JzKSA+PSBNQVhfUkVUUklFUykNCiAJCQllbmRpbmcgPSBGQUlM
Ow0KIAkJZWxzZQ0KQEAgLTk5NCwzMSArOTYzLDI3IEBADQogDQogCWNhc2Ug
SU5UX0NNRF9CTEtfRVJSOg0KIAkJZHVtcF9jbWRfY29tcGxldGVfc3RhdHVz
KGludF9yZXRfY29kZSk7DQotCQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUw
KSB8IEFUVF9FT0ksIEVTRElfQVRUTik7DQotCQlvdXRiKENUUkxfRU5BQkxF
X0lOVFIsIEVTRElfQ09OVFJPTCk7DQorCQlwczJlc2RpX2F0dGVudGlvbigo
aW50X3JldF9jb2RlICYgMHhlMCkgPj4gNSwgQVRUX0VPSSk7DQogCQllbmRp
bmcgPSBGQUlMOw0KIAkJYnJlYWs7DQogDQogCWNhc2UgSU5UX0NNRF9GT1JN
QVQ6DQogCQlwcmludGsoIiVzOiBodWggPyBXaG8gaXNzdWVkIHRoaXMgZm9y
bWF0IGNvbW1hbmQgP1xuIg0KIAkJICAgICAgICxERVZJQ0VfTkFNRSk7DQot
CQlvdXRiKChpbnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9FT0ksIEVTRElf
QVRUTik7DQotCQlvdXRiKENUUkxfRU5BQkxFX0lOVFIsIEVTRElfQ09OVFJP
TCk7DQorCQlwczJlc2RpX2F0dGVudGlvbigoaW50X3JldF9jb2RlICYgMHhl
MCkgPj4gNSwgQVRUX0VPSSk7DQogCQllbmRpbmcgPSAtMTsNCiAJCWJyZWFr
Ow0KIA0KIAljYXNlIElOVF9SRVNFVDoNCiAJCS8qIEJBIHByaW50aygiJXM6
IHJlc2V0IGNvbXBsZXRlZC5cbiIsIERFVklDRV9OQU1FKSAqLyA7DQotCQlv
dXRiKChpbnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9FT0ksIEVTRElfQVRU
Tik7DQotCQlvdXRiKENUUkxfRU5BQkxFX0lOVFIsIEVTRElfQ09OVFJPTCk7
DQorCQlwczJlc2RpX2F0dGVudGlvbigoaW50X3JldF9jb2RlICYgMHhlMCkg
Pj4gNSwgQVRUX0VPSSk7DQogCQllbmRpbmcgPSAtMTsNCiAJCWJyZWFrOw0K
IA0KIAlkZWZhdWx0Og0KIAkJcHJpbnRrKCIlczogVW5rbm93biBpbnRlcnJ1
cHQgcmVhc29uOiAlMDJYXG4iLA0KIAkJICAgICAgIERFVklDRV9OQU1FLCBp
bnRfcmV0X2NvZGUgJiAweGYpOw0KLQkJb3V0YigoaW50X3JldF9jb2RlICYg
MHhlMCkgfCBBVFRfRU9JLCBFU0RJX0FUVE4pOw0KLQkJb3V0YihDVFJMX0VO
QUJMRV9JTlRSLCBFU0RJX0NPTlRST0wpOw0KKwkJcHMyZXNkaV9hdHRlbnRp
b24oKGludF9yZXRfY29kZSAmIDB4ZTApID4+IDUsIEFUVF9FT0kpOw0KIAkJ
ZW5kaW5nID0gLTE7DQogCQlicmVhazsNCiAJfQ0KQEAgLTExMjUsOCArMTA5
MCw3IEBADQogCWludCBkZXYgPSBERVZJQ0VfTlIoaW5vZGUtPmlfcmRldik7
DQogDQogCWlmIChkZXYgPCBwczJlc2RpX2RyaXZlcykgew0KLQkJd2hpbGUg
KCFwczJlc2RpX3ZhbGlkW2Rldl0pDQotCQkJc2xlZXBfb24oJnBzMmVzZGlf
d2FpdF9vcGVuKTsNCisJCXdhaXRfZXZlbnQocHMyZXNkaV93YWl0X29wZW4s
IHBzMmVzZGlfdmFsaWRbZGV2XSk7DQogDQogCQlhY2Nlc3NfY291bnRbZGV2
XSsrOw0KIA0KQEAgLTEyMzYsMTEgKzEyMDAsMzQgQEANCiANCiAJc3RhdHVz
ID0gaW5iKEVTRElfSU5UUlBUKTsNCiAJaWYgKChzdGF0dXMgJiAweGYpID09
IElOVF9SRVNFVCkgew0KLQkJb3V0Yigoc3RhdHVzICYgMHhlMCkgfCBBVFRf
RU9JLCBFU0RJX0FUVE4pOw0KLQkJb3V0YihDVFJMX0VOQUJMRV9JTlRSLCBF
U0RJX0NPTlRST0wpOw0KLQkJcmVzZXRfc3RhdHVzID0gMTsNCisJCXBzMmVz
ZGlfYXR0ZW50aW9uKChzdGF0dXMgJiAweGUwKSA+PiA1LCBBVFRfRU9JKTsN
CisJCXJlc2V0X3N0YXR1cyA9IC0xOw0KIAl9DQogCXdha2VfdXAoJnBzMmVz
ZGlfaW50KTsNCiB9DQogDQorc3RhdGljIGludCBwczJlc2RpX2F0dGVudGlv
bih1X2ludCBkZXZpY2UsIHVfaW50IHJlcXVlc3QpDQorew0KKwlpbnQgYnVz
eTsNCisJdV9jaGFyIHN0YXR1czsNCisNCisJb3V0YihDVFJMX0RJU0FCTEVf
SU5UUiwgRVNESV9DT05UUk9MKTsNCisJaWYocmVxdWVzdCA9PSBBVFRfRU9J
IHx8ICEoc3RhdHVzID0gaW5iKEVTRElfU1RBVFVTKSAmIDB4NTApKSB7DQor
CQlvdXRiKChkZXZpY2UgPDwgNSkgfCByZXF1ZXN0LCBFU0RJX0FUVE4pOw0K
KwkJYnVzeSA9IDA7DQorCX0NCisJZWxzZSB7DQorCQlpZihzdGF0dXMgJiAw
eDEwKSB7DQorCQkJcHJpbnRrKCIlczogQXR0ZW50aW9uIHBvcnQgaW4gdXNl
ICgweCV4KVxuIiwNCisJCQkJREVWSUNFX05BTUUsIHN0YXR1cyk7DQorCQl9
DQorCQlpZihzdGF0dXMgJiAweDQwKSB7DQorCQkJcHJpbnRrKCIlczogSW50
ZXJydXB0IHBlbmRpbmcgKDB4JXgpXG4iLA0KKwkJCQlERVZJQ0VfTkFNRSwg
c3RhdHVzKTsNCisJCX0NCisgCQlidXN5ID0gMTsNCisJfQ0KKwlvdXRiKENU
UkxfRU5BQkxFX0lOVFIsIEVTRElfQ09OVFJPTCk7DQorCXJldHVybiBidXN5
Ow0KK30NCiAjZW5kaWYNCg==
---559023410-684387517-990658216=:23376--
