Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1030887AbWKOTD4@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1030887AbWKOTD4 (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 15 Nov 2006 14:03:56 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1030886AbWKOTD4
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 15 Nov 2006 14:03:56 -0500
Received: from bay0-omc1-s23.bay0.hotmail.com ([65.54.246.95]:36871 "EHLO
	bay0-omc1-s23.bay0.hotmail.com") by vger.kernel.org with ESMTP
	id S1030887AbWKOTDz (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Wed, 15 Nov 2006 14:03:55 -0500
Message-ID: <BAY20-F24CB9D4EBE13D3AF96D79D8EA0@phx.gbl>
X-Originating-IP: [80.178.1.111]
X-Originating-Email: [yan_952@hotmail.com]
From: "Burman Yan" <yan_952@hotmail.com>
To: linux-kernel@vger.kernel.org
Cc: len.brown@intel.com, trivial@kernel.org
Subject: [PATCH 2.6.19-rc5] acpi: replace kmalloc+memset with kzalloc
Date: Wed, 15 Nov 2006 21:03:51 +0200
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="----=_NextPart_000_62df_2491_166e"
X-OriginalArrivalTime: 15 Nov 2006 19:03:54.0707 (UTC) FILETIME=[CBBEEA30:01C708E8]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------=_NextPart_000_62df_2491_166e
Content-Type: text/plain; format=flowed

Hi.

Here is the patch that replaces kmalloc+memset with kzalloc and removes 
unnecessary casts.

Regards
Yan Burman

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/

------=_NextPart_000_62df_2491_166e
Content-Type: application/octet-stream; name="kzalloc_acpi.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="kzalloc_acpi.patch"

QUNQSTogUmVwbGFjZSBrbWFsbG9jK21lbXNldCB3aXRoIGt6YWxsb2MgCgpT
aWduZWQtb2ZmLWJ5OiBZYW4gQnVybWFuIDx5YW5fOTUyQGhvdG1haWwuY29t
PgoKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvYXJjaC9pYTY0
L2tlcm5lbC9jcHVmcmVxL2FjcGktY3B1ZnJlcS5jIGxpbnV4LTIuNi4xOS1y
YzVfa3phbGxvYy9hcmNoL2lhNjQva2VybmVsL2NwdWZyZXEvYWNwaS1jcHVm
cmVxLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9hcmNoL2lhNjQva2Vy
bmVsL2NwdWZyZXEvYWNwaS1jcHVmcmVxLmMJMjAwNi0xMS0wOSAxMjoxNjoy
Mi4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxv
Yy9hcmNoL2lhNjQva2VybmVsL2NwdWZyZXEvYWNwaS1jcHVmcmVxLmMJMjAw
Ni0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTI3OSwxMiAr
Mjc5LDEwIEBAIGFjcGlfY3B1ZnJlcV9jcHVfaW5pdCAoCiAKIAlkcHJpbnRr
KCJhY3BpX2NwdWZyZXFfY3B1X2luaXRcbiIpOwogCi0JZGF0YSA9IGttYWxs
b2Moc2l6ZW9mKHN0cnVjdCBjcHVmcmVxX2FjcGlfaW8pLCBHRlBfS0VSTkVM
KTsKKwlkYXRhID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGNwdWZyZXFfYWNw
aV9pbyksIEdGUF9LRVJORUwpOwogCWlmICghZGF0YSkKIAkJcmV0dXJuICgt
RU5PTUVNKTsKIAotCW1lbXNldChkYXRhLCAwLCBzaXplb2Yoc3RydWN0IGNw
dWZyZXFfYWNwaV9pbykpOwotCiAJYWNwaV9pb19kYXRhW2NwdV0gPSBkYXRh
OwogCiAJcmVzdWx0ID0gYWNwaV9wcm9jZXNzb3JfcmVnaXN0ZXJfcGVyZm9y
bWFuY2UoJmRhdGEtPmFjcGlfZGF0YSwgY3B1KTsKZGlmZiAtcnVicCBsaW51
eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL2FjLmMgbGludXgtMi42
LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvYWNwaS9hYy5jCi0tLSBsaW51eC0y
LjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL2FjLmMJMjAwNi0xMS0wOSAx
MjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVf
a3phbGxvYy9kcml2ZXJzL2FjcGkvYWMuYwkyMDA2LTExLTExIDIyOjQ0OjA0
LjAwMDAwMDAwMCArMDIwMApAQCAtMjIxLDEwICsyMjEsOSBAQCBzdGF0aWMg
aW50IGFjcGlfYWNfYWRkKHN0cnVjdCBhY3BpX2RldmljCiAJaWYgKCFkZXZp
Y2UpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JYWMgPSBrbWFsbG9jKHNpemVv
ZihzdHJ1Y3QgYWNwaV9hYyksIEdGUF9LRVJORUwpOworCWFjID0ga3phbGxv
YyhzaXplb2Yoc3RydWN0IGFjcGlfYWMpLCBHRlBfS0VSTkVMKTsKIAlpZiAo
IWFjKQogCQlyZXR1cm4gLUVOT01FTTsKLQltZW1zZXQoYWMsIDAsIHNpemVv
ZihzdHJ1Y3QgYWNwaV9hYykpOwogCiAJYWMtPmRldmljZSA9IGRldmljZTsK
IAlzdHJjcHkoYWNwaV9kZXZpY2VfbmFtZShkZXZpY2UpLCBBQ1BJX0FDX0RF
VklDRV9OQU1FKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcv
ZHJpdmVycy9hY3BpL2FjcGlfbWVtaG90cGx1Zy5jIGxpbnV4LTIuNi4xOS1y
YzVfa3phbGxvYy9kcml2ZXJzL2FjcGkvYWNwaV9tZW1ob3RwbHVnLmMKLS0t
IGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2FjcGkvYWNwaV9tZW1o
b3RwbHVnLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAK
KysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2FjcGkvYWNw
aV9tZW1ob3RwbHVnLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAg
KzAyMDAKQEAgLTM5NSwxMCArMzk1LDkgQEAgc3RhdGljIGludCBhY3BpX21l
bW9yeV9kZXZpY2VfYWRkKHN0cnVjdAogCWlmICghZGV2aWNlKQogCQlyZXR1
cm4gLUVJTlZBTDsKIAotCW1lbV9kZXZpY2UgPSBrbWFsbG9jKHNpemVvZihz
dHJ1Y3QgYWNwaV9tZW1vcnlfZGV2aWNlKSwgR0ZQX0tFUk5FTCk7CisJbWVt
X2RldmljZSA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX21lbW9yeV9k
ZXZpY2UpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIW1lbV9kZXZpY2UpCiAJCXJl
dHVybiAtRU5PTUVNOwotCW1lbXNldChtZW1fZGV2aWNlLCAwLCBzaXplb2Yo
c3RydWN0IGFjcGlfbWVtb3J5X2RldmljZSkpOwogCiAJSU5JVF9MSVNUX0hF
QUQoJm1lbV9kZXZpY2UtPnJlc19saXN0KTsKIAltZW1fZGV2aWNlLT5kZXZp
Y2UgPSBkZXZpY2U7Ci0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVy
cy9hY3BpL2FzdXNfYWNwaS5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAw
MDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVy
cy9hY3BpL2FzdXNfYWNwaS5jCTIwMDYtMTEtMTUgMjA6MTE6NTcuMDAwMDAw
MDAwICswMjAwCkBAIC0xMjUyLDExICsxMjUyLDkgQEAgc3RhdGljIGludCBh
c3VzX2hvdGtfYWRkKHN0cnVjdCBhY3BpX2RldgogCXByaW50ayhLRVJOX05P
VElDRSAiQXN1cyBMYXB0b3AgQUNQSSBFeHRyYXMgdmVyc2lvbiAlc1xuIiwK
IAkgICAgICAgQVNVU19BQ1BJX1ZFUlNJT04pOwogCi0JaG90ayA9Ci0JICAg
IChzdHJ1Y3QgYXN1c19ob3RrICopa21hbGxvYyhzaXplb2Yoc3RydWN0IGFz
dXNfaG90ayksIEdGUF9LRVJORUwpOworCWhvdGsgPSBremFsbG9jKHNpemVv
ZihzdHJ1Y3QgYXN1c19ob3RrKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFob3Rr
KQogCQlyZXR1cm4gLUVOT01FTTsKLQltZW1zZXQoaG90aywgMCwgc2l6ZW9m
KHN0cnVjdCBhc3VzX2hvdGspKTsKIAogCWhvdGstPmhhbmRsZSA9IGRldmlj
ZS0+aGFuZGxlOwogCXN0cmNweShhY3BpX2RldmljZV9uYW1lKGRldmljZSks
IEFDUElfSE9US19ERVZJQ0VfTkFNRSk7CmRpZmYgLXJ1YnAgbGludXgtMi42
LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9iYXR0ZXJ5LmMgbGludXgtMi42
LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvYWNwaS9iYXR0ZXJ5LmMKLS0tIGxp
bnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2FjcGkvYmF0dGVyeS5jCTIw
MDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL2JhdHRlcnkuYwkyMDA2
LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTYwLDEyICsx
NjAsMTEgQEAgYWNwaV9iYXR0ZXJ5X2dldF9pbmZvKHN0cnVjdCBhY3BpX2Jh
dHRlcgogCQlnb3RvIGVuZDsKIAl9CiAKLQlkYXRhLnBvaW50ZXIgPSBrbWFs
bG9jKGRhdGEubGVuZ3RoLCBHRlBfS0VSTkVMKTsKKwlkYXRhLnBvaW50ZXIg
PSBremFsbG9jKGRhdGEubGVuZ3RoLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWRh
dGEucG9pbnRlcikgewogCQlyZXN1bHQgPSAtRU5PTUVNOwogCQlnb3RvIGVu
ZDsKIAl9Ci0JbWVtc2V0KGRhdGEucG9pbnRlciwgMCwgZGF0YS5sZW5ndGgp
OwogCiAJc3RhdHVzID0gYWNwaV9leHRyYWN0X3BhY2thZ2UocGFja2FnZSwg
JmZvcm1hdCwgJmRhdGEpOwogCWlmIChBQ1BJX0ZBSUxVUkUoc3RhdHVzKSkg
ewpAQCAtMjIwLDEyICsyMTksMTEgQEAgYWNwaV9iYXR0ZXJ5X2dldF9zdGF0
dXMoc3RydWN0IGFjcGlfYmF0dAogCQlnb3RvIGVuZDsKIAl9CiAKLQlkYXRh
LnBvaW50ZXIgPSBrbWFsbG9jKGRhdGEubGVuZ3RoLCBHRlBfS0VSTkVMKTsK
KwlkYXRhLnBvaW50ZXIgPSBremFsbG9jKGRhdGEubGVuZ3RoLCBHRlBfS0VS
TkVMKTsKIAlpZiAoIWRhdGEucG9pbnRlcikgewogCQlyZXN1bHQgPSAtRU5P
TUVNOwogCQlnb3RvIGVuZDsKIAl9Ci0JbWVtc2V0KGRhdGEucG9pbnRlciwg
MCwgZGF0YS5sZW5ndGgpOwogCiAJc3RhdHVzID0gYWNwaV9leHRyYWN0X3Bh
Y2thZ2UocGFja2FnZSwgJmZvcm1hdCwgJmRhdGEpOwogCWlmIChBQ1BJX0ZB
SUxVUkUoc3RhdHVzKSkgewpAQCAtNjk0LDEwICs2OTIsOSBAQCBzdGF0aWMg
aW50IGFjcGlfYmF0dGVyeV9hZGQoc3RydWN0IGFjcGlfCiAJaWYgKCFkZXZp
Y2UpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JYmF0dGVyeSA9IGttYWxsb2Mo
c2l6ZW9mKHN0cnVjdCBhY3BpX2JhdHRlcnkpLCBHRlBfS0VSTkVMKTsKKwli
YXR0ZXJ5ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFjcGlfYmF0dGVyeSks
IEdGUF9LRVJORUwpOwogCWlmICghYmF0dGVyeSkKIAkJcmV0dXJuIC1FTk9N
RU07Ci0JbWVtc2V0KGJhdHRlcnksIDAsIHNpemVvZihzdHJ1Y3QgYWNwaV9i
YXR0ZXJ5KSk7CiAKIAliYXR0ZXJ5LT5kZXZpY2UgPSBkZXZpY2U7CiAJc3Ry
Y3B5KGFjcGlfZGV2aWNlX25hbWUoZGV2aWNlKSwgQUNQSV9CQVRURVJZX0RF
VklDRV9OQU1FKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcv
ZHJpdmVycy9hY3BpL2J1dHRvbi5jIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxv
Yy9kcml2ZXJzL2FjcGkvYnV0dG9uLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9kcml2ZXJzL2FjcGkvYnV0dG9uLmMJMjAwNi0xMS0wOSAxMjoxNjoy
MS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxv
Yy9kcml2ZXJzL2FjcGkvYnV0dG9uLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4w
MDAwMDAwMDAgKzAyMDAKQEAgLTI5NiwxMCArMjk2LDkgQEAgc3RhdGljIGlu
dCBhY3BpX2J1dHRvbl9hZGQoc3RydWN0IGFjcGlfZAogCWlmICghZGV2aWNl
KQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWJ1dHRvbiA9IGttYWxsb2Moc2l6
ZW9mKHN0cnVjdCBhY3BpX2J1dHRvbiksIEdGUF9LRVJORUwpOworCWJ1dHRv
biA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX2J1dHRvbiksIEdGUF9L
RVJORUwpOwogCWlmICghYnV0dG9uKQogCQlyZXR1cm4gLUVOT01FTTsKLQlt
ZW1zZXQoYnV0dG9uLCAwLCBzaXplb2Yoc3RydWN0IGFjcGlfYnV0dG9uKSk7
CiAKIAlidXR0b24tPmRldmljZSA9IGRldmljZTsKIAlhY3BpX2RyaXZlcl9k
YXRhKGRldmljZSkgPSBidXR0b247CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5
LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9jb250YWluZXIuYyBsaW51eC0yLjYu
MTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL2NvbnRhaW5lci5jCi0tLSBs
aW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL2NvbnRhaW5lci5j
CTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51
eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL2NvbnRhaW5lci5j
CTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC05Niwx
MSArOTYsMTAgQEAgc3RhdGljIGludCBhY3BpX2NvbnRhaW5lcl9hZGQoc3Ry
dWN0IGFjcAogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQljb250YWluZXIg
PSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9jb250YWluZXIpLCBHRlBf
S0VSTkVMKTsKKwljb250YWluZXIgPSBremFsbG9jKHNpemVvZihzdHJ1Y3Qg
YWNwaV9jb250YWluZXIpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWNvbnRhaW5l
cikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltZW1zZXQoY29udGFpbmVyLCAw
LCBzaXplb2Yoc3RydWN0IGFjcGlfY29udGFpbmVyKSk7CiAJY29udGFpbmVy
LT5oYW5kbGUgPSBkZXZpY2UtPmhhbmRsZTsKIAlzdHJjcHkoYWNwaV9kZXZp
Y2VfbmFtZShkZXZpY2UpLCBBQ1BJX0NPTlRBSU5FUl9ERVZJQ0VfTkFNRSk7
CiAJc3RyY3B5KGFjcGlfZGV2aWNlX2NsYXNzKGRldmljZSksIEFDUElfQ09O
VEFJTkVSX0NMQVNTKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29y
aWcvZHJpdmVycy9hY3BpL2VjLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9j
L2RyaXZlcnMvYWNwaS9lYy5jCi0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcv
ZHJpdmVycy9hY3BpL2VjLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAw
MDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJz
L2FjcGkvZWMuYwkyMDA2LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIw
MApAQCAtNjUyLDEwICs2NTIsOSBAQCBzdGF0aWMgaW50IGFjcGlfZWNfYWRk
KHN0cnVjdCBhY3BpX2RldmljCiAJaWYgKCFkZXZpY2UpCiAJCXJldHVybiAt
RUlOVkFMOwogCi0JZWMgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9l
YyksIEdGUF9LRVJORUwpOworCWVjID0ga3phbGxvYyhzaXplb2Yoc3RydWN0
IGFjcGlfZWMpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWVjKQogCQlyZXR1cm4g
LUVOT01FTTsKLQltZW1zZXQoZWMsIDAsIHNpemVvZihzdHJ1Y3QgYWNwaV9l
YykpOwogCiAJZWMtPmhhbmRsZSA9IGRldmljZS0+aGFuZGxlOwogCWVjLT51
aWQgPSAtMTsKQEAgLTg4NCwxMiArODgzLDExIEBAIHN0YXRpYyBpbnQgX19p
bml0IGFjcGlfZWNfZmFrZV9lY2R0KHZvaWQKIAogCUFDUElfREVCVUdfUFJJ
TlQoKEFDUElfREJfSU5GTywgIlRyeSB0byBtYWtlIGFuIGZha2UgRUNEVCIp
KTsKIAotCWVjX2VjZHQgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9l
YyksIEdGUF9LRVJORUwpOworCWVjX2VjZHQgPSBremFsbG9jKHNpemVvZihz
dHJ1Y3QgYWNwaV9lYyksIEdGUF9LRVJORUwpOwogCWlmICghZWNfZWNkdCkg
ewogCQlyZXQgPSAtRU5PTUVNOwogCQlnb3RvIGVycm9yOwogCX0KLQltZW1z
ZXQoZWNfZWNkdCwgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX2VjKSk7CiAKIAlz
dGF0dXMgPSBhY3BpX2dldF9kZXZpY2VzKEFDUElfRUNfSElELAogCQkJCSAg
YWNwaV9mYWtlX2VjZHRfY2FsbGJhY2ssIE5VTEwsIE5VTEwpOwpAQCAtOTIx
LDEwICs5MTksOSBAQCBzdGF0aWMgaW50IF9faW5pdCBhY3BpX2VjX2dldF9y
ZWFsX2VjZHQoCiAJLyoKIAkgKiBHZW5lcmF0ZSBhIHRlbXBvcmFyeSBlYyBj
b250ZXh0IHRvIHVzZSB1bnRpbCB0aGUgbmFtZXNwYWNlIGlzIHNjYW5uZWQK
IAkgKi8KLQllY19lY2R0ID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IGFjcGlf
ZWMpLCBHRlBfS0VSTkVMKTsKKwllY19lY2R0ID0ga3phbGxvYyhzaXplb2Yo
c3RydWN0IGFjcGlfZWMpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWVjX2VjZHQp
CiAJCXJldHVybiAtRU5PTUVNOwotCW1lbXNldChlY19lY2R0LCAwLCBzaXpl
b2Yoc3RydWN0IGFjcGlfZWMpKTsKIAogCWluaXRfTVVURVgoJmVjX2VjZHQt
PnNlbSk7CiAJaWYgKGFjcGlfZWNfbW9kZSA9PSBFQ19JTlRSKSB7CmRpZmYg
LXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9mYW4u
YyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL2Zhbi5j
Ci0tLSBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL2Zhbi5j
CTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51
eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL2Zhbi5jCTIwMDYt
MTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC0xODYsMTAgKzE4
Niw5IEBAIHN0YXRpYyBpbnQgYWNwaV9mYW5fYWRkKHN0cnVjdCBhY3BpX2Rl
dmkKIAlpZiAoIWRldmljZSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlmYW4g
PSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9mYW4pLCBHRlBfS0VSTkVM
KTsKKwlmYW4gPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9mYW4pLCBH
RlBfS0VSTkVMKTsKIAlpZiAoIWZhbikKIAkJcmV0dXJuIC1FTk9NRU07Ci0J
bWVtc2V0KGZhbiwgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX2ZhbikpOwogCiAJ
ZmFuLT5kZXZpY2UgPSBkZXZpY2U7CiAJc3RyY3B5KGFjcGlfZGV2aWNlX25h
bWUoZGV2aWNlKSwgIkZhbiIpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1y
YzVfb3JpZy9kcml2ZXJzL2FjcGkvaTJjX2VjLmMgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2RyaXZlcnMvYWNwaS9pMmNfZWMuYwotLS0gbGludXgtMi42
LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9pMmNfZWMuYwkyMDA2LTExLTA5
IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJj
NV9remFsbG9jL2RyaXZlcnMvYWNwaS9pMmNfZWMuYwkyMDA2LTExLTExIDIy
OjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMzA5LDE4ICszMDksMTYgQEAg
c3RhdGljIGludCBhY3BpX2VjX2hjX2FkZChzdHJ1Y3QgYWNwaV9kZQogCQly
ZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQllY19oYyA9IGttYWxsb2Moc2l6ZW9m
KHN0cnVjdCBhY3BpX2VjX2hjKSwgR0ZQX0tFUk5FTCk7CisJZWNfaGMgPSBr
emFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9lY19oYyksIEdGUF9LRVJORUwp
OwogCWlmICghZWNfaGMpIHsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQotCW1l
bXNldChlY19oYywgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX2VjX2hjKSk7CiAK
LQlzbWJ1cyA9IGttYWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX2VjX3NtYnVz
KSwgR0ZQX0tFUk5FTCk7CisJc21idXMgPSBremFsbG9jKHNpemVvZihzdHJ1
Y3QgYWNwaV9lY19zbWJ1cyksIEdGUF9LRVJORUwpOwogCWlmICghc21idXMp
IHsKIAkJa2ZyZWUoZWNfaGMpOwogCQlyZXR1cm4gLUVOT01FTTsKIAl9Ci0J
bWVtc2V0KHNtYnVzLCAwLCBzaXplb2Yoc3RydWN0IGFjcGlfZWNfc21idXMp
KTsKIAogCWVjX2hjLT5oYW5kbGUgPSBkZXZpY2UtPmhhbmRsZTsKIAlzdHJj
cHkoYWNwaV9kZXZpY2VfbmFtZShkZXZpY2UpLCBBQ1BJX0VDX0hDX0RFVklD
RV9OQU1FKTsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJp
dmVycy9hY3BpL2libV9hY3BpLmMgbGludXgtMi42LjE5LXJjNV9remFsbG9j
L2RyaXZlcnMvYWNwaS9pYm1fYWNwaS5jCi0tLSBsaW51eC0yLjYuMTktcmM1
X29yaWcvZHJpdmVycy9hY3BpL2libV9hY3BpLmMJMjAwNi0xMS0wOSAxMjox
NjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3ph
bGxvYy9kcml2ZXJzL2FjcGkvaWJtX2FjcGkuYwkyMDA2LTExLTExIDIyOjQ0
OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTgxOCwxMyArMTgxOCwxMiBAQCBz
dGF0aWMgaW50IF9faW5pdCByZWdpc3Rlcl9kcml2ZXIoc3RydWN0CiB7CiAJ
aW50IHJldDsKIAotCWlibS0+ZHJpdmVyID0ga21hbGxvYyhzaXplb2Yoc3Ry
dWN0IGFjcGlfZHJpdmVyKSwgR0ZQX0tFUk5FTCk7CisJaWJtLT5kcml2ZXIg
PSBremFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9kcml2ZXIpLCBHRlBfS0VS
TkVMKTsKIAlpZiAoIWlibS0+ZHJpdmVyKSB7CiAJCXByaW50ayhJQk1fRVJS
ICJrbWFsbG9jKGlibS0+ZHJpdmVyKSBmYWlsZWRcbiIpOwogCQlyZXR1cm4g
LTE7CiAJfQogCi0JbWVtc2V0KGlibS0+ZHJpdmVyLCAwLCBzaXplb2Yoc3Ry
dWN0IGFjcGlfZHJpdmVyKSk7CiAJc3ByaW50ZihpYm0tPmRyaXZlci0+bmFt
ZSwgIiVzLyVzIiwgSUJNX05BTUUsIGlibS0+bmFtZSk7CiAJaWJtLT5kcml2
ZXItPmlkcyA9IGlibS0+aGlkOwogCWlibS0+ZHJpdmVyLT5vcHMuYWRkID0g
JmlibV9kZXZpY2VfYWRkOwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2Ry
aXZlcnMvYWNwaS9wY2lfYmluZC5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAw
MDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJp
dmVycy9hY3BpL3BjaV9iaW5kLmMJMjAwNi0xMS0xNSAyMDoxNDoxMy4wMDAw
MDAwMDAgKzAyMDAKQEAgLTEyMiwxOSArMTIyLDE3IEBAIGludCBhY3BpX3Bj
aV9iaW5kKHN0cnVjdCBhY3BpX2RldmljZSAqZGUKIAlpZiAoIWRldmljZSB8
fCAhZGV2aWNlLT5wYXJlbnQpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JcGF0
aG5hbWUgPSBrbWFsbG9jKEFDUElfUEFUSE5BTUVfTUFYLCBHRlBfS0VSTkVM
KTsKKwlwYXRobmFtZSA9IGt6YWxsb2MoQUNQSV9QQVRITkFNRV9NQVgsIEdG
UF9LRVJORUwpOwogCWlmICghcGF0aG5hbWUpCiAJCXJldHVybiAtRU5PTUVN
OwotCW1lbXNldChwYXRobmFtZSwgMCwgQUNQSV9QQVRITkFNRV9NQVgpOwog
CWJ1ZmZlci5sZW5ndGggPSBBQ1BJX1BBVEhOQU1FX01BWDsKIAlidWZmZXIu
cG9pbnRlciA9IHBhdGhuYW1lOwogCi0JZGF0YSA9IGttYWxsb2Moc2l6ZW9m
KHN0cnVjdCBhY3BpX3BjaV9kYXRhKSwgR0ZQX0tFUk5FTCk7CisJZGF0YSA9
IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX3BjaV9kYXRhKSwgR0ZQX0tF
Uk5FTCk7CiAJaWYgKCFkYXRhKSB7CiAJCWtmcmVlKHBhdGhuYW1lKTsKIAkJ
cmV0dXJuIC1FTk9NRU07CiAJfQotCW1lbXNldChkYXRhLCAwLCBzaXplb2Yo
c3RydWN0IGFjcGlfcGNpX2RhdGEpKTsKIAogCWFjcGlfZ2V0X25hbWUoZGV2
aWNlLT5oYW5kbGUsIEFDUElfRlVMTF9QQVRITkFNRSwgJmJ1ZmZlcik7CiAJ
QUNQSV9ERUJVR19QUklOVCgoQUNQSV9EQl9JTkZPLCAiQmluZGluZyBQQ0kg
ZGV2aWNlIFslc10uLi5cbiIsCkBAIC0yODEsMTAgKzI3OSw5IEBAIGludCBh
Y3BpX3BjaV91bmJpbmQoc3RydWN0IGFjcGlfZGV2aWNlICoKIAlpZiAoIWRl
dmljZSB8fCAhZGV2aWNlLT5wYXJlbnQpCiAJCXJldHVybiAtRUlOVkFMOwog
Ci0JcGF0aG5hbWUgPSAoY2hhciAqKWttYWxsb2MoQUNQSV9QQVRITkFNRV9N
QVgsIEdGUF9LRVJORUwpOworCXBhdGhuYW1lID0ga3phbGxvYyhBQ1BJX1BB
VEhOQU1FX01BWCwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFwYXRobmFtZSkKIAkJ
cmV0dXJuIC1FTk9NRU07Ci0JbWVtc2V0KHBhdGhuYW1lLCAwLCBBQ1BJX1BB
VEhOQU1FX01BWCk7CiAKIAlidWZmZXIubGVuZ3RoID0gQUNQSV9QQVRITkFN
RV9NQVg7CiAJYnVmZmVyLnBvaW50ZXIgPSBwYXRobmFtZTsKQEAgLTMzMiwx
MCArMzI5LDkgQEAgYWNwaV9wY2lfYmluZF9yb290KHN0cnVjdCBhY3BpX2Rl
dmljZSAqZAogCXN0cnVjdCBhY3BpX2J1ZmZlciBidWZmZXIgPSB7IDAsIE5V
TEwgfTsKIAogCi0JcGF0aG5hbWUgPSAoY2hhciAqKWttYWxsb2MoQUNQSV9Q
QVRITkFNRV9NQVgsIEdGUF9LRVJORUwpOworCXBhdGhuYW1lID0ga3phbGxv
YyhBQ1BJX1BBVEhOQU1FX01BWCwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFwYXRo
bmFtZSkKIAkJcmV0dXJuIC1FTk9NRU07Ci0JbWVtc2V0KHBhdGhuYW1lLCAw
LCBBQ1BJX1BBVEhOQU1FX01BWCk7CiAKIAlidWZmZXIubGVuZ3RoID0gQUNQ
SV9QQVRITkFNRV9NQVg7CiAJYnVmZmVyLnBvaW50ZXIgPSBwYXRobmFtZTsK
QEAgLTM0NSwxMiArMzQxLDExIEBAIGFjcGlfcGNpX2JpbmRfcm9vdChzdHJ1
Y3QgYWNwaV9kZXZpY2UgKmQKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0J
ZGF0YSA9IGttYWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX3BjaV9kYXRhKSwg
R0ZQX0tFUk5FTCk7CisJZGF0YSA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBh
Y3BpX3BjaV9kYXRhKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFkYXRhKSB7CiAJ
CWtmcmVlKHBhdGhuYW1lKTsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQotCW1l
bXNldChkYXRhLCAwLCBzaXplb2Yoc3RydWN0IGFjcGlfcGNpX2RhdGEpKTsK
IAogCWRhdGEtPmlkID0gKmlkOwogCWRhdGEtPmJ1cyA9IGJ1czsKZGlmZiAt
cnVicCBsaW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL3BjaV9p
cnEuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL3Bj
aV9pcnEuYwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNw
aS9wY2lfaXJxLmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAy
MDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2FjcGkv
cGNpX2lycS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAw
CkBAIC04OSwxMCArODksOSBAQCBhY3BpX3BjaV9pcnFfYWRkX2VudHJ5KGFj
cGlfaGFuZGxlIGhhbmRsCiAJaWYgKCFwcnQpCiAJCXJldHVybiAtRUlOVkFM
OwogCi0JZW50cnkgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9wcnRf
ZW50cnkpLCBHRlBfS0VSTkVMKTsKKwllbnRyeSA9IGt6YWxsb2Moc2l6ZW9m
KHN0cnVjdCBhY3BpX3BydF9lbnRyeSksIEdGUF9LRVJORUwpOwogCWlmICgh
ZW50cnkpCiAJCXJldHVybiAtRU5PTUVNOwotCW1lbXNldChlbnRyeSwgMCwg
c2l6ZW9mKHN0cnVjdCBhY3BpX3BydF9lbnRyeSkpOwogCiAJZW50cnktPmlk
LnNlZ21lbnQgPSBzZWdtZW50OwogCWVudHJ5LT5pZC5idXMgPSBidXM7CkBA
IC0xNjEsMTAgKzE2MCw5IEBAIGludCBhY3BpX3BjaV9pcnFfYWRkX3BydChh
Y3BpX2hhbmRsZSBoYW4KIAlzdGF0aWMgaW50IGZpcnN0X3RpbWUgPSAxOwog
CiAKLQlwYXRobmFtZSA9IChjaGFyICopa21hbGxvYyhBQ1BJX1BBVEhOQU1F
X01BWCwgR0ZQX0tFUk5FTCk7CisJcGF0aG5hbWUgPSBremFsbG9jKEFDUElf
UEFUSE5BTUVfTUFYLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXBhdGhuYW1lKQog
CQlyZXR1cm4gLUVOT01FTTsKLQltZW1zZXQocGF0aG5hbWUsIDAsIEFDUElf
UEFUSE5BTUVfTUFYKTsKIAogCWlmIChmaXJzdF90aW1lKSB7CiAJCWFjcGlf
cHJ0LmNvdW50ID0gMDsKQEAgLTE5OCwxMSArMTk2LDEwIEBAIGludCBhY3Bp
X3BjaV9pcnFfYWRkX3BydChhY3BpX2hhbmRsZSBoYW4KIAkJcmV0dXJuIC1F
Tk9ERVY7CiAJfQogCi0JcHJ0ID0ga21hbGxvYyhidWZmZXIubGVuZ3RoLCBH
RlBfS0VSTkVMKTsKKwlwcnQgPSBremFsbG9jKGJ1ZmZlci5sZW5ndGgsIEdG
UF9LRVJORUwpOwogCWlmICghcHJ0KSB7CiAJCXJldHVybiAtRU5PTUVNOwog
CX0KLQltZW1zZXQocHJ0LCAwLCBidWZmZXIubGVuZ3RoKTsKIAlidWZmZXIu
cG9pbnRlciA9IHBydDsKIAogCXN0YXR1cyA9IGFjcGlfZ2V0X2lycV9yb3V0
aW5nX3RhYmxlKGhhbmRsZSwgJmJ1ZmZlcik7CmRpZmYgLXJ1YnAgbGludXgt
Mi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9wY2lfbGluay5jIGxpbnV4
LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2FjcGkvcGNpX2xpbmsuYwot
LS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9wY2lfbGlu
ay5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAwCisrKyBs
aW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL3BjaV9saW5r
LmMJMjAwNi0xMS0xMSAyMjo0NDowNC4wMDAwMDAwMDAgKzAyMDAKQEAgLTMw
NywxMSArMzA3LDEwIEBAIHN0YXRpYyBpbnQgYWNwaV9wY2lfbGlua19zZXQo
c3RydWN0IGFjcGkKIAlpZiAoIWxpbmsgfHwgIWlycSkKIAkJcmV0dXJuIC1F
SU5WQUw7CiAKLQlyZXNvdXJjZSA9IGttYWxsb2Moc2l6ZW9mKCpyZXNvdXJj
ZSkgKyAxLCBpcnFzX2Rpc2FibGVkKCkgPyBHRlBfQVRPTUlDOiBHRlBfS0VS
TkVMKTsKKwlyZXNvdXJjZSA9IGt6YWxsb2Moc2l6ZW9mKCpyZXNvdXJjZSkg
KyAxLCBpcnFzX2Rpc2FibGVkKCkgPyBHRlBfQVRPTUlDOiBHRlBfS0VSTkVM
KTsKIAlpZiAoIXJlc291cmNlKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW1l
bXNldChyZXNvdXJjZSwgMCwgc2l6ZW9mKCpyZXNvdXJjZSkgKyAxKTsKIAli
dWZmZXIubGVuZ3RoID0gc2l6ZW9mKCpyZXNvdXJjZSkgKyAxOwogCWJ1ZmZl
ci5wb2ludGVyID0gcmVzb3VyY2U7CiAKQEAgLTcxOCwxMCArNzE3LDkgQEAg
c3RhdGljIGludCBhY3BpX3BjaV9saW5rX2FkZChzdHJ1Y3QgYWNwaQogCWlm
ICghZGV2aWNlKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWxpbmsgPSBrbWFs
bG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9wY2lfbGluayksIEdGUF9LRVJORUwp
OworCWxpbmsgPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9wY2lfbGlu
ayksIEdGUF9LRVJORUwpOwogCWlmICghbGluaykKIAkJcmV0dXJuIC1FTk9N
RU07Ci0JbWVtc2V0KGxpbmssIDAsIHNpemVvZihzdHJ1Y3QgYWNwaV9wY2lf
bGluaykpOwogCiAJbGluay0+ZGV2aWNlID0gZGV2aWNlOwogCXN0cmNweShh
Y3BpX2RldmljZV9uYW1lKGRldmljZSksIEFDUElfUENJX0xJTktfREVWSUNF
X05BTUUpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2
ZXJzL2FjcGkvcGNpX3Jvb3QuYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2Mv
ZHJpdmVycy9hY3BpL3BjaV9yb290LmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9kcml2ZXJzL2FjcGkvcGNpX3Jvb3QuYwkyMDA2LTExLTA5IDEyOjE2
OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFs
bG9jL2RyaXZlcnMvYWNwaS9wY2lfcm9vdC5jCTIwMDYtMTEtMTEgMjI6NDQ6
MDQuMDAwMDAwMDAwICswMjAwCkBAIC0xNjQsMTAgKzE2NCw5IEBAIHN0YXRp
YyBpbnQgYWNwaV9wY2lfcm9vdF9hZGQoc3RydWN0IGFjcGkKIAlpZiAoIWRl
dmljZSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlyb290ID0ga21hbGxvYyhz
aXplb2Yoc3RydWN0IGFjcGlfcGNpX3Jvb3QpLCBHRlBfS0VSTkVMKTsKKwly
b290ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFjcGlfcGNpX3Jvb3QpLCBH
RlBfS0VSTkVMKTsKIAlpZiAoIXJvb3QpCiAJCXJldHVybiAtRU5PTUVNOwot
CW1lbXNldChyb290LCAwLCBzaXplb2Yoc3RydWN0IGFjcGlfcGNpX3Jvb3Qp
KTsKIAlJTklUX0xJU1RfSEVBRCgmcm9vdC0+bm9kZSk7CiAKIAlyb290LT5k
ZXZpY2UgPSBkZXZpY2U7CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9v
cmlnL2RyaXZlcnMvYWNwaS9wb3dlci5jIGxpbnV4LTIuNi4xOS1yYzVfa3ph
bGxvYy9kcml2ZXJzL2FjcGkvcG93ZXIuYwotLS0gbGludXgtMi42LjE5LXJj
NV9vcmlnL2RyaXZlcnMvYWNwaS9wb3dlci5jCTIwMDYtMTEtMDkgMTI6MTY6
MjEuMDAwMDAwMDAwICswMjAwCisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxs
b2MvZHJpdmVycy9hY3BpL3Bvd2VyLmMJMjAwNi0xMS0xMSAyMjo0NDowNC4w
MDAwMDAwMDAgKzAyMDAKQEAgLTUzMiwxMCArNTMyLDkgQEAgc3RhdGljIGlu
dCBhY3BpX3Bvd2VyX2FkZChzdHJ1Y3QgYWNwaV9kZQogCWlmICghZGV2aWNl
KQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCXJlc291cmNlID0ga21hbGxvYyhz
aXplb2Yoc3RydWN0IGFjcGlfcG93ZXJfcmVzb3VyY2UpLCBHRlBfS0VSTkVM
KTsKKwlyZXNvdXJjZSA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBhY3BpX3Bv
d2VyX3Jlc291cmNlKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFyZXNvdXJjZSkK
IAkJcmV0dXJuIC1FTk9NRU07Ci0JbWVtc2V0KHJlc291cmNlLCAwLCBzaXpl
b2Yoc3RydWN0IGFjcGlfcG93ZXJfcmVzb3VyY2UpKTsKIAogCXJlc291cmNl
LT5kZXZpY2UgPSBkZXZpY2U7CiAJc3RyY3B5KHJlc291cmNlLT5uYW1lLCBk
ZXZpY2UtPnBucC5idXNfaWQpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1y
YzVfb3JpZy9kcml2ZXJzL2FjcGkvcHJvY2Vzc29yX2NvcmUuYyBsaW51eC0y
LjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL3Byb2Nlc3Nvcl9jb3Jl
LmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2FjcGkvcHJv
Y2Vzc29yX2NvcmUuYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCAr
MDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvYWNw
aS9wcm9jZXNzb3JfY29yZS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAw
MDAwICswMjAwCkBAIC02MTUsMTAgKzYxNSw5IEBAIHN0YXRpYyBpbnQgYWNw
aV9wcm9jZXNzb3JfYWRkKHN0cnVjdCBhY3AKIAlpZiAoIWRldmljZSkKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAKLQlwciA9IGttYWxsb2Moc2l6ZW9mKHN0cnVj
dCBhY3BpX3Byb2Nlc3NvciksIEdGUF9LRVJORUwpOworCXByID0ga3phbGxv
YyhzaXplb2Yoc3RydWN0IGFjcGlfcHJvY2Vzc29yKSwgR0ZQX0tFUk5FTCk7
CiAJaWYgKCFwcikKIAkJcmV0dXJuIC1FTk9NRU07Ci0JbWVtc2V0KHByLCAw
LCBzaXplb2Yoc3RydWN0IGFjcGlfcHJvY2Vzc29yKSk7CiAKIAlwci0+aGFu
ZGxlID0gZGV2aWNlLT5oYW5kbGU7CiAJc3RyY3B5KGFjcGlfZGV2aWNlX25h
bWUoZGV2aWNlKSwgQUNQSV9QUk9DRVNTT1JfREVWSUNFX05BTUUpOwpkaWZm
IC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2ZXJzL2FjcGkvc2Jz
LmMgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvYWNwaS9zYnMu
YwotLS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9zYnMu
YwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGlu
dXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZlcnMvYWNwaS9zYnMuYwkyMDA2
LTExLTExIDIyOjQ0OjA0LjAwMDAwMDAwMCArMDIwMApAQCAtMTU3NiwxMiAr
MTU3NiwxMSBAQCBzdGF0aWMgaW50IGFjcGlfc2JzX2FkZChzdHJ1Y3QgYWNw
aV9kZXZpCiAJaW50IGlkLCBjbnQ7CiAJYWNwaV9zdGF0dXMgc3RhdHVzID0g
QUVfT0s7CiAKLQlzYnMgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9z
YnMpLCBHRlBfS0VSTkVMKTsKKwlzYnMgPSBremFsbG9jKHNpemVvZihzdHJ1
Y3QgYWNwaV9zYnMpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXNicykgewogCQlB
Q1BJX0RFQlVHX1BSSU5UKChBQ1BJX0RCX0VSUk9SLCAia21hbGxvYygpIGZh
aWxlZFxuIikpOwogCQlyZXR1cm4gLUVOT01FTTsKIAl9Ci0JbWVtc2V0KHNi
cywgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX3NicykpOwogCiAJY250ID0gMDsK
IAl3aGlsZSAoY250IDwgMTApIHsKZGlmZiAtcnVicCBsaW51eC0yLjYuMTkt
cmM1X29yaWcvZHJpdmVycy9hY3BpL3NjYW4uYyBsaW51eC0yLjYuMTktcmM1
X2t6YWxsb2MvZHJpdmVycy9hY3BpL3NjYW4uYwotLS0gbGludXgtMi42LjE5
LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS9zY2FuLmMJMjAwNi0xMS0wOSAxMjox
NjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxpbnV4LTIuNi4xOS1yYzVfa3ph
bGxvYy9kcml2ZXJzL2FjcGkvc2Nhbi5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQu
MDAwMDAwMDAwICswMjAwCkBAIC05ODQsMTIgKzk4NCwxMSBAQCBhY3BpX2Fk
ZF9zaW5nbGVfb2JqZWN0KHN0cnVjdCBhY3BpX2RldmljCiAJaWYgKCFjaGls
ZCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlkZXZpY2UgPSBrbWFsbG9jKHNp
emVvZihzdHJ1Y3QgYWNwaV9kZXZpY2UpLCBHRlBfS0VSTkVMKTsKKwlkZXZp
Y2UgPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV9kZXZpY2UpLCBHRlBf
S0VSTkVMKTsKIAlpZiAoIWRldmljZSkgewogCQlwcmludGsoS0VSTl9FUlIg
UFJFRklYICJNZW1vcnkgYWxsb2NhdGlvbiBlcnJvclxuIik7CiAJCXJldHVy
biAtRU5PTUVNOwogCX0KLQltZW1zZXQoZGV2aWNlLCAwLCBzaXplb2Yoc3Ry
dWN0IGFjcGlfZGV2aWNlKSk7CiAKIAlkZXZpY2UtPmhhbmRsZSA9IGhhbmRs
ZTsKIAlkZXZpY2UtPnBhcmVudCA9IHBhcmVudDsKZGlmZiAtcnVicCBsaW51
eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9hY3BpL3RoZXJtYWwuYyBsaW51
eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9hY3BpL3RoZXJtYWwuYwot
LS0gbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMvYWNwaS90aGVybWFs
LmMJMjAwNi0xMS0wOSAxMjoxNjoyMS4wMDAwMDAwMDAgKzAyMDAKKysrIGxp
bnV4LTIuNi4xOS1yYzVfa3phbGxvYy9kcml2ZXJzL2FjcGkvdGhlcm1hbC5j
CTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAwICswMjAwCkBAIC05MDIs
MTIgKzkwMiwxMCBAQCBhY3BpX3RoZXJtYWxfd3JpdGVfdHJpcF9wb2ludHMo
c3RydWN0IGZpCiAJaW50IGkgPSAwOwogCiAKLQlsaW1pdF9zdHJpbmcgPSBr
bWFsbG9jKEFDUElfVEhFUk1BTF9NQVhfTElNSVRfU1RSX0xFTiwgR0ZQX0tF
Uk5FTCk7CisJbGltaXRfc3RyaW5nID0ga3phbGxvYyhBQ1BJX1RIRVJNQUxf
TUFYX0xJTUlUX1NUUl9MRU4sIEdGUF9LRVJORUwpOwogCWlmICghbGltaXRf
c3RyaW5nKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW1lbXNldChsaW1pdF9z
dHJpbmcsIDAsIEFDUElfVEhFUk1BTF9NQVhfTElNSVRfU1RSX0xFTik7Ci0K
IAlhY3RpdmUgPSBrbWFsbG9jKEFDUElfVEhFUk1BTF9NQVhfQUNUSVZFICog
c2l6ZW9mKGludCksIEdGUF9LRVJORUwpOwogCWlmICghYWN0aXZlKSB7CiAJ
CWtmcmVlKGxpbWl0X3N0cmluZyk7CkBAIC0xMjcxLDEwICsxMjY5LDkgQEAg
c3RhdGljIGludCBhY3BpX3RoZXJtYWxfYWRkKHN0cnVjdCBhY3BpXwogCWlm
ICghZGV2aWNlKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCXR6ID0ga21hbGxv
YyhzaXplb2Yoc3RydWN0IGFjcGlfdGhlcm1hbCksIEdGUF9LRVJORUwpOwor
CXR6ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFjcGlfdGhlcm1hbCksIEdG
UF9LRVJORUwpOwogCWlmICghdHopCiAJCXJldHVybiAtRU5PTUVNOwotCW1l
bXNldCh0eiwgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX3RoZXJtYWwpKTsKIAog
CXR6LT5kZXZpY2UgPSBkZXZpY2U7CiAJc3RyY3B5KHR6LT5uYW1lLCBkZXZp
Y2UtPnBucC5idXNfaWQpOwpkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVf
b3JpZy9kcml2ZXJzL2FjcGkvdXRpbHMuYyBsaW51eC0yLjYuMTktcmM1X2t6
YWxsb2MvZHJpdmVycy9hY3BpL3V0aWxzLmMKLS0tIGxpbnV4LTIuNi4xOS1y
YzVfb3JpZy9kcml2ZXJzL2FjcGkvdXRpbHMuYwkyMDA2LTExLTA5IDEyOjE2
OjIxLjAwMDAwMDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFs
bG9jL2RyaXZlcnMvYWNwaS91dGlscy5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQu
MDAwMDAwMDAwICswMjAwCkBAIC0yNjIsMTEgKzI2MiwxMCBAQCBhY3BpX2V2
YWx1YXRlX2ludGVnZXIoYWNwaV9oYW5kbGUgaGFuZGxlCiAJaWYgKCFkYXRh
KQogCQlyZXR1cm4gQUVfQkFEX1BBUkFNRVRFUjsKIAotCWVsZW1lbnQgPSBr
bWFsbG9jKHNpemVvZih1bmlvbiBhY3BpX29iamVjdCksIGlycXNfZGlzYWJs
ZWQoKSA/IEdGUF9BVE9NSUM6IEdGUF9LRVJORUwpOworCWVsZW1lbnQgPSBr
emFsbG9jKHNpemVvZih1bmlvbiBhY3BpX29iamVjdCksIGlycXNfZGlzYWJs
ZWQoKSA/IEdGUF9BVE9NSUM6IEdGUF9LRVJORUwpOwogCWlmICghZWxlbWVu
dCkKIAkJcmV0dXJuIEFFX05PX01FTU9SWTsKIAotCW1lbXNldChlbGVtZW50
LCAwLCBzaXplb2YodW5pb24gYWNwaV9vYmplY3QpKTsKIAlidWZmZXIubGVu
Z3RoID0gc2l6ZW9mKHVuaW9uIGFjcGlfb2JqZWN0KTsKIAlidWZmZXIucG9p
bnRlciA9IGVsZW1lbnQ7CiAJc3RhdHVzID0gYWNwaV9ldmFsdWF0ZV9vYmpl
Y3QoaGFuZGxlLCBwYXRobmFtZSwgYXJndW1lbnRzLCAmYnVmZmVyKTsKQEAg
LTMyMSwxMiArMzIwLDExIEBAIGFjcGlfZXZhbHVhdGVfc3RyaW5nKGFjcGlf
aGFuZGxlIGhhbmRsZSwKIAkJcmV0dXJuIEFFX0JBRF9EQVRBOwogCX0KIAot
CSpkYXRhID0ga21hbGxvYyhlbGVtZW50LT5zdHJpbmcubGVuZ3RoICsgMSwg
R0ZQX0tFUk5FTCk7CisJKmRhdGEgPSBremFsbG9jKGVsZW1lbnQtPnN0cmlu
Zy5sZW5ndGggKyAxLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWRhdGEpIHsKIAkJ
cHJpbnRrKEtFUk5fRVJSIFBSRUZJWCAiTWVtb3J5IGFsbG9jYXRpb25cbiIp
OwogCQlyZXR1cm4gLUVOT01FTTsKIAl9Ci0JbWVtc2V0KCpkYXRhLCAwLCBl
bGVtZW50LT5zdHJpbmcubGVuZ3RoICsgMSk7CiAKIAltZW1jcHkoKmRhdGEs
IGVsZW1lbnQtPnN0cmluZy5wb2ludGVyLCBlbGVtZW50LT5zdHJpbmcubGVu
Z3RoKTsKIApkaWZmIC1ydWJwIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9kcml2
ZXJzL2FjcGkvdmlkZW8uYyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJp
dmVycy9hY3BpL3ZpZGVvLmMKLS0tIGxpbnV4LTIuNi4xOS1yYzVfb3JpZy9k
cml2ZXJzL2FjcGkvdmlkZW8uYwkyMDA2LTExLTA5IDEyOjE2OjIxLjAwMDAw
MDAwMCArMDIwMAorKysgbGludXgtMi42LjE5LXJjNV9remFsbG9jL2RyaXZl
cnMvYWNwaS92aWRlby5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAwMDAw
ICswMjAwCkBAIC01MzIsMTEgKzUzMiwxMCBAQCBzdGF0aWMgdm9pZCBhY3Bp
X3ZpZGVvX2RldmljZV9maW5kX2NhcChzCiAJCWludCBjb3VudCA9IDA7CiAJ
CXVuaW9uIGFjcGlfb2JqZWN0ICpvOwogCi0JCWJyID0ga21hbGxvYyhzaXpl
b2YoKmJyKSwgR0ZQX0tFUk5FTCk7CisJCWJyID0ga3phbGxvYyhzaXplb2Yo
KmJyKSwgR0ZQX0tFUk5FTCk7CiAJCWlmICghYnIpIHsKIAkJCXByaW50ayhL
RVJOX0VSUiAiY2FuJ3QgYWxsb2NhdGUgbWVtb3J5XG4iKTsKIAkJfSBlbHNl
IHsKLQkJCW1lbXNldChiciwgMCwgc2l6ZW9mKCpicikpOwogCQkJYnItPmxl
dmVscyA9IGttYWxsb2Mob2JqLT5wYWNrYWdlLmNvdW50ICoKIAkJCQkJICAg
ICBzaXplb2YgKihici0+bGV2ZWxzKSwgR0ZQX0tFUk5FTCk7CiAJCQlpZiAo
IWJyLT5sZXZlbHMpCkBAIC0xMjYzLDEyICsxMjYyLDEwIEBAIGFjcGlfdmlk
ZW9fYnVzX2dldF9vbmVfZGV2aWNlKHN0cnVjdCBhY3AKIAkgICAgYWNwaV9l
dmFsdWF0ZV9pbnRlZ2VyKGRldmljZS0+aGFuZGxlLCAiX0FEUiIsIE5VTEws
ICZkZXZpY2VfaWQpOwogCWlmIChBQ1BJX1NVQ0NFU1Moc3RhdHVzKSkgewog
Ci0JCWRhdGEgPSBrbWFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV92aWRlb19k
ZXZpY2UpLCBHRlBfS0VSTkVMKTsKKwkJZGF0YSA9IGt6YWxsb2Moc2l6ZW9m
KHN0cnVjdCBhY3BpX3ZpZGVvX2RldmljZSksIEdGUF9LRVJORUwpOwogCQlp
ZiAoIWRhdGEpCiAJCQlyZXR1cm4gLUVOT01FTTsKIAotCQltZW1zZXQoZGF0
YSwgMCwgc2l6ZW9mKHN0cnVjdCBhY3BpX3ZpZGVvX2RldmljZSkpOwotCiAJ
CXN0cmNweShhY3BpX2RldmljZV9uYW1lKGRldmljZSksIEFDUElfVklERU9f
REVWSUNFX05BTUUpOwogCQlzdHJjcHkoYWNwaV9kZXZpY2VfY2xhc3MoZGV2
aWNlKSwgQUNQSV9WSURFT19DTEFTUyk7CiAJCWFjcGlfZHJpdmVyX2RhdGEo
ZGV2aWNlKSA9IGRhdGE7CkBAIC0xNjk2LDEwICsxNjkzLDkgQEAgc3RhdGlj
IGludCBhY3BpX3ZpZGVvX2J1c19hZGQoc3RydWN0IGFjcAogCWlmICghZGV2
aWNlKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCXZpZGVvID0ga21hbGxvYyhz
aXplb2Yoc3RydWN0IGFjcGlfdmlkZW9fYnVzKSwgR0ZQX0tFUk5FTCk7CisJ
dmlkZW8gPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgYWNwaV92aWRlb19idXMp
LCBHRlBfS0VSTkVMKTsKIAlpZiAoIXZpZGVvKQogCQlyZXR1cm4gLUVOT01F
TTsKLQltZW1zZXQodmlkZW8sIDAsIHNpemVvZihzdHJ1Y3QgYWNwaV92aWRl
b19idXMpKTsKIAogCXZpZGVvLT5kZXZpY2UgPSBkZXZpY2U7CiAJc3RyY3B5
KGFjcGlfZGV2aWNlX25hbWUoZGV2aWNlKSwgQUNQSV9WSURFT19CVVNfTkFN
RSk7CmRpZmYgLXJ1YnAgbGludXgtMi42LjE5LXJjNV9vcmlnL2RyaXZlcnMv
cGNpL2hvdHBsdWcvYWNwaXBocF9pYm0uYyBsaW51eC0yLjYuMTktcmM1X2t6
YWxsb2MvZHJpdmVycy9wY2kvaG90cGx1Zy9hY3BpcGhwX2libS5jCi0tLSBs
aW51eC0yLjYuMTktcmM1X29yaWcvZHJpdmVycy9wY2kvaG90cGx1Zy9hY3Bp
cGhwX2libS5jCTIwMDYtMTEtMDkgMTI6MTY6MjEuMDAwMDAwMDAwICswMjAw
CisrKyBsaW51eC0yLjYuMTktcmM1X2t6YWxsb2MvZHJpdmVycy9wY2kvaG90
cGx1Zy9hY3BpcGhwX2libS5jCTIwMDYtMTEtMTEgMjI6NDQ6MDQuMDAwMDAw
MDAwICswMjAwCkBAIC0zMTksMTMgKzMxOSwxMiBAQCBzdGF0aWMgaW50IGli
bV9nZXRfdGFibGVfZnJvbV9hY3BpKGNoYXIgCiAJaWYgKGJ1ZnAgPT0gTlVM
TCkKIAkJZ290byByZWFkX3RhYmxlX2RvbmU7CiAKLQlsYnVmID0ga21hbGxv
YyhzaXplLCBHRlBfS0VSTkVMKTsKKwlsYnVmID0ga3phbGxvYyhzaXplLCBH
RlBfS0VSTkVMKTsKIAlkYmcoIiVzOiBlbGVtZW50IGNvdW50OiAlaSwgQVNM
IHRhYmxlIHNpemU6ICVpLCAmdGFibGUgPSAweCVwXG4iLAogCQkJX19GVU5D
VElPTl9fLCBwYWNrYWdlLT5wYWNrYWdlLmNvdW50LCBzaXplLCBsYnVmKTsK
IAogCWlmIChsYnVmKSB7CiAJCSpidWZwID0gbGJ1ZjsKLQkJbWVtc2V0KGxi
dWYsIDAsIHNpemUpOwogCX0gZWxzZSB7CiAJCXNpemUgPSAtRU5PTUVNOwog
CQlnb3RvIHJlYWRfdGFibGVfZG9uZTsK


------=_NextPart_000_62df_2491_166e--
