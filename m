Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S311405AbSCWWyd>; Sat, 23 Mar 2002 17:54:33 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S311406AbSCWWy1>; Sat, 23 Mar 2002 17:54:27 -0500
Received: from astound-64-85-224-253.ca.astound.net ([64.85.224.253]:22532
	"EHLO master.linux-ide.org") by vger.kernel.org with ESMTP
	id <S311405AbSCWWyI>; Sat, 23 Mar 2002 17:54:08 -0500
Date: Sat, 23 Mar 2002 14:53:58 -0800 (PST)
From: Andre Hedrick <andre@linux-ide.org>
To: linux-kernel@vger.kernel.org
cc: Martin Dalecki <dalecki@evision-ventures.com>
Subject: [PATCH] linux-2.5.7.fix2.patch
Message-ID: <Pine.LNX.4.10.10203231441530.1053-200000@master.linux-ide.org>
MIME-Version: 1.0
Content-Type: multipart/mixed; BOUNDARY="1430322656-215002990-1016924038=:1053"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--1430322656-215002990-1016924038=:1053
Content-Type: text/plain; charset=us-ascii


Martin et al.

This is the next step in stablizing the transport layer.
I have not booted but it will compile, and it is nearly identical to what
I generated for 2.4 to be released soon.

The comments are harsh on the interface but it functionally correct.
If you get an device error in PIO, bad things can happen to the data.
This is no different in the stock 2.4.0->2.4.18->19x.

Of of all the transport data handlers.

CLEAN and SAFE:
	DMA read/write is safe and has always been.
	Single sector PIO WRITING is clean and safe.

DIRTY but operational (error events in the hardware will cause data problems) 
	Single sector PIO READING can corrupt a single sector if there
		is a device error.
	Multi-Read/Write will corrupt and misreport data only on an error.

What is still lacking in block is the much needed in proccess bio walker.
Once I can finish coding this fix into BLOCK, then I can complete the
transport layer and slap it on a bus analyzer and force articial errors on
the buss to see if the driver behaves correctly.  If this passes, we are
good to run like the wind.

Regards,

Andre Hedrick
LAD Storage Consulting Group

--1430322656-215002990-1016924038=:1053
Content-Type: text/plain; charset=us-ascii; name="linux-2.5.7.fix2.patch"
Content-Transfer-Encoding: base64
Content-ID: <Pine.LNX.4.10.10203231453580.1053@master.linux-ide.org>
Content-Description: 
Content-Disposition: attachment; filename="linux-2.5.7.fix2.patch"

ZGlmZiAtdXJOIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL2hwdDM0eC5jIGxp
bnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS9ocHQzNHguYw0KLS0tIGxpbnV4
LTIuNS43L2RyaXZlcnMvaWRlL2hwdDM0eC5jCUZyaSBNYXIgMjIgMDI6NTg6
MDAgMjAwMg0KKysrIGxpbnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS9ocHQz
NHguYwlGcmkgTWFyIDIyIDIxOjQ3OjA5IDIwMDINCkBAIC0zMzQsNiArMzM0
LDggQEANCiAJCQlkcml2ZS0+d2FpdGluZ19mb3JfZG1hID0gMTsNCiAJCQlp
ZiAoZHJpdmUtPnR5cGUgIT0gQVRBX0RJU0spDQogCQkJCXJldHVybiAwOw0K
KwkJCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAhPSBOVUxMKQkvKiBw
YXJhbm9pYSBjaGVjayAqLw0KKwkJCQlCVUcoKTsNCiAJCQlpZGVfc2V0X2hh
bmRsZXIoZHJpdmUsICZpZGVfZG1hX2ludHIsIFdBSVRfQ01ELCBOVUxMKTsJ
LyogaXNzdWUgY21kIHRvIGRyaXZlICovDQogCQkJT1VUX0JZVEUoKHJlYWRp
bmcgPT0gOSkgPyBXSU5fUkVBRERNQSA6IFdJTl9XUklURURNQSwgSURFX0NP
TU1BTkRfUkVHKTsNCiAJCQlyZXR1cm4gMDsNCmRpZmYgLXVyTiBsaW51eC0y
LjUuNy9kcml2ZXJzL2lkZS9pY3NpZGUuYyBsaW51eC0yLjUuNy5maXgvZHJp
dmVycy9pZGUvaWNzaWRlLmMNCi0tLSBsaW51eC0yLjUuNy9kcml2ZXJzL2lk
ZS9pY3NpZGUuYwlGcmkgTWFyIDIyIDAyOjU4OjAwIDIwMDINCisrKyBsaW51
eC0yLjUuNy5maXgvZHJpdmVycy9pZGUvaWNzaWRlLmMJRnJpIE1hciAyMiAy
MTo0Nzo0MSAyMDAyDQpAQCAtNDQ0LDYgKzQ0NCw5IEBADQogCQlpZiAoZHJp
dmUtPm1lZGlhICE9IGlkZV9kaXNrKQ0KIAkJCXJldHVybiAwOw0KIA0KKwkJ
aWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBhcmFu
b2lhIGNoZWNrICovDQorCQkJQlVHKCk7DQorDQogCQlpZGVfc2V0X2hhbmRs
ZXIoZHJpdmUsICZpY3NpZGVfZG1haW50ciwgV0FJVF9DTUQsIE5VTEwpOw0K
IAkJT1VUX0JZVEUocmVhZGluZyA/IFdJTl9SRUFERE1BIDogV0lOX1dSSVRF
RE1BLA0KIAkJCSBJREVfQ09NTUFORF9SRUcpOw0KZGlmZiAtdXJOIGxpbnV4
LTIuNS43L2RyaXZlcnMvaWRlL2lkZS1jZC5jIGxpbnV4LTIuNS43LmZpeC9k
cml2ZXJzL2lkZS9pZGUtY2QuYw0KLS0tIGxpbnV4LTIuNS43L2RyaXZlcnMv
aWRlL2lkZS1jZC5jCUZyaSBNYXIgMjIgMDI6NTg6MDAgMjAwMg0KKysrIGxp
bnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS9pZGUtY2QuYwlGcmkgTWFyIDIy
IDIxOjUwOjU4IDIwMDINCkBAIC03NDUsNiArNzQ1LDkgQEANCiAJCSh2b2lk
KSAoSFdJRihkcml2ZSktPmRtYXByb2MoaWRlX2RtYV9iZWdpbiwgZHJpdmUp
KTsNCiANCiAJaWYgKENEUk9NX0NPTkZJR19GTEFHUyAoZHJpdmUpLT5kcnFf
aW50ZXJydXB0KSB7DQorDQorCQlpZiAoSFdHUk9VUChkcml2ZSktPmhhbmRs
ZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sgKi8NCisJCQlCVUcoKTsN
CiAJCWlkZV9zZXRfaGFuZGxlciAoZHJpdmUsIGhhbmRsZXIsIFdBSVRfQ01E
LCBjZHJvbV90aW1lcl9leHBpcnkpOw0KIAkJT1VUX0JZVEUgKFdJTl9QQUNL
RVRDTUQsIElERV9DT01NQU5EX1JFRyk7IC8qIHBhY2tldCBjb21tYW5kICov
DQogCQlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQpAQCAtNzg2LDYgKzc4OSw5IEBA
DQogCQkJcmV0dXJuIHN0YXJ0c3RvcDsNCiAJfQ0KIA0KKwlpZiAoSFdHUk9V
UChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sg
Ki8NCisJCUJVRygpOw0KKw0KIAkvKiBBcm0gdGhlIGludGVycnVwdCBoYW5k
bGVyLiAqLw0KIAlpZGVfc2V0X2hhbmRsZXIgKGRyaXZlLCBoYW5kbGVyLCB0
aW1lb3V0LCBjZHJvbV90aW1lcl9leHBpcnkpOw0KIA0KQEAgLTEwMDUsNiAr
MTAxMSw5IEBADQogDQogCS8qIERvbmUgbW92aW5nIGRhdGEhDQogCSAgIFdh
aXQgZm9yIGFub3RoZXIgaW50ZXJydXB0LiAqLw0KKw0KKwlpZiAoSFdHUk9V
UChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sg
Ki8NCisJCUJVRygpOw0KIAlpZGVfc2V0X2hhbmRsZXIoZHJpdmUsICZjZHJv
bV9yZWFkX2ludHIsIFdBSVRfQ01ELCBOVUxMKTsNCiAJcmV0dXJuIGlkZV9z
dGFydGVkOw0KIH0NCkBAIC0xMzM1LDYgKzEzNDQsOSBAQA0KIAl9DQogDQog
CS8qIE5vdyB3ZSB3YWl0IGZvciBhbm90aGVyIGludGVycnVwdC4gKi8NCisN
CisJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBh
cmFub2lhIGNoZWNrICovDQorCQlCVUcoKTsNCiAJaWRlX3NldF9oYW5kbGVy
IChkcml2ZSwgJmNkcm9tX3BjX2ludHIsIFdBSVRfQ01ELCBjZHJvbV90aW1l
cl9leHBpcnkpOw0KIAlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQogfQ0KQEAgLTE1
NTksNiArMTU3MSw5IEBADQogCX0NCiANCiAJLyogcmUtYXJtIGhhbmRsZXIg
Ki8NCisNCisJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwp
CS8qIHBhcmFub2lhIGNoZWNrICovDQorCQlCVUcoKTsNCiAJaWRlX3NldF9o
YW5kbGVyKGRyaXZlLCAmY2Ryb21fd3JpdGVfaW50ciwgNSAqIFdBSVRfQ01E
LCBOVUxMKTsNCiAJcmV0dXJuIGlkZV9zdGFydGVkOw0KIH0NCmRpZmYgLXVy
TiBsaW51eC0yLjUuNy9kcml2ZXJzL2lkZS9pZGUtZG1hLmMgbGludXgtMi41
LjcuZml4L2RyaXZlcnMvaWRlL2lkZS1kbWEuYw0KLS0tIGxpbnV4LTIuNS43
L2RyaXZlcnMvaWRlL2lkZS1kbWEuYwlGcmkgTWFyIDIyIDAyOjU4OjAwIDIw
MDINCisrKyBsaW51eC0yLjUuNy5maXgvZHJpdmVycy9pZGUvaWRlLWRtYS5j
CUZyaSBNYXIgMjIgMjE6NTE6MjggMjAwMg0KQEAgLTU4OCw2ICs1ODgsOSBA
QA0KIAkJCWRyaXZlLT53YWl0aW5nX2Zvcl9kbWEgPSAxOw0KIAkJCWlmIChk
cml2ZS0+dHlwZSAhPSBBVEFfRElTSykNCiAJCQkJcmV0dXJuIDA7DQorDQor
CQkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBh
cmFub2lhIGNoZWNrICovDQorCQkJCUJVRygpOw0KIAkJCWlkZV9zZXRfaGFu
ZGxlcihkcml2ZSwgJmlkZV9kbWFfaW50ciwgV0FJVF9DTUQsIGRtYV90aW1l
cl9leHBpcnkpOwkvKiBpc3N1ZSBjbWQgdG8gZHJpdmUgKi8NCiAJCQlpZiAo
KEhXR1JPVVAoZHJpdmUpLT5ycS0+ZmxhZ3MgJiBSRVFfRFJJVkVfVEFTS0ZJ
TEUpICYmDQogCQkJICAgIChkcml2ZS0+YWRkcmVzc2luZyA9PSAxKSkgew0K
ZGlmZiAtdXJOIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL2lkZS1mbG9wcHku
YyBsaW51eC0yLjUuNy5maXgvZHJpdmVycy9pZGUvaWRlLWZsb3BweS5jDQot
LS0gbGludXgtMi41LjcvZHJpdmVycy9pZGUvaWRlLWZsb3BweS5jCUZyaSBN
YXIgMjIgMDI6NTg6MDAgMjAwMg0KKysrIGxpbnV4LTIuNS43LmZpeC9kcml2
ZXJzL2lkZS9pZGUtZmxvcHB5LmMJRnJpIE1hciAyMiAyMTo1NDo1MyAyMDAy
DQpAQCAtOTY4LDYgKzk2OCw5IEBADQogCQkJaWYgKHRlbXAgPiBwYy0+YnVm
ZmVyX3NpemUpIHsNCiAJCQkJcHJpbnRrIChLRVJOX0VSUiAiaWRlLWZsb3Bw
eTogVGhlIGZsb3BweSB3YW50cyB0byBzZW5kIHVzIG1vcmUgZGF0YSB0aGFu
IGV4cGVjdGVkIC0gZGlzY2FyZGluZyBkYXRhXG4iKTsNCiAJCQkJaWRlZmxv
cHB5X2Rpc2NhcmRfZGF0YSAoZHJpdmUsYmNvdW50LmFsbCk7DQorDQorCQkJ
CWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAhPSBOVUxMKQkvKiBwYXJh
bm9pYSBjaGVjayAqLw0KKwkJCQkJQlVHKCk7DQogCQkJCWlkZV9zZXRfaGFu
ZGxlciAoZHJpdmUsJmlkZWZsb3BweV9wY19pbnRyLElERUZMT1BQWV9XQUlU
X0NNRCwgTlVMTCk7DQogCQkJCXJldHVybiBpZGVfc3RhcnRlZDsNCiAJCQl9
DQpAQCAtOTkwLDYgKzk5Myw4IEBADQogCXBjLT5hY3R1YWxseV90cmFuc2Zl
cnJlZCs9YmNvdW50LmFsbDsJCQkJLyogVXBkYXRlIHRoZSBjdXJyZW50IHBv
c2l0aW9uICovDQogCXBjLT5jdXJyZW50X3Bvc2l0aW9uKz1iY291bnQuYWxs
Ow0KIA0KKwlpZiAoSFdHUk9VUChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJ
LyogcGFyYW5vaWEgY2hlY2sgKi8NCisJCUJVRygpOw0KIAlpZGVfc2V0X2hh
bmRsZXIgKGRyaXZlLCZpZGVmbG9wcHlfcGNfaW50cixJREVGTE9QUFlfV0FJ
VF9DTUQsIE5VTEwpOwkJLyogQW5kIHNldCB0aGUgaW50ZXJydXB0IGhhbmRs
ZXIgYWdhaW4gKi8NCiAJcmV0dXJuIGlkZV9zdGFydGVkOw0KIH0NCkBAIC0x
MDE0LDYgKzEwMTksOCBAQA0KIAkJcHJpbnRrIChLRVJOX0VSUiAiaWRlLWZs
b3BweTogKElPLENvRCkgIT0gKDAsMSkgd2hpbGUgaXNzdWluZyBhIHBhY2tl
dCBjb21tYW5kXG4iKTsNCiAJCXJldHVybiBpZGVfc3RvcHBlZDsNCiAJfQ0K
KwlpZiAoSFdHUk9VUChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFy
YW5vaWEgY2hlY2sgKi8NCisJCUJVRygpOw0KIAlpZGVfc2V0X2hhbmRsZXIg
KGRyaXZlLCAmaWRlZmxvcHB5X3BjX2ludHIsIElERUZMT1BQWV9XQUlUX0NN
RCwgTlVMTCk7CS8qIFNldCB0aGUgaW50ZXJydXB0IHJvdXRpbmUgKi8NCiAJ
YXRhcGlfb3V0cHV0X2J5dGVzIChkcml2ZSwgZmxvcHB5LT5wYy0+YywgMTIp
OyAvKiBTZW5kIHRoZSBhY3R1YWwgcGFja2V0ICovDQogCXJldHVybiBpZGVf
c3RhcnRlZDsNCkBAIC0xMDYyLDkgKzEwNjksMTMgQEANCiAJICogMjVtc2Vj
IGlzIHRvbyBzaG9ydCwgNDAgYW5kIDUwbXNlYyB3b3JrIHdlbGwuIGlkZWZs
b3BweV9wY19pbnRyIHdpbGwgDQogCSAqIG5vdCBiZSBhY3R1YWxseSB1c2Vk
IHVudGlsIGFmdGVyIHRoZSBwYWNrZXQgaXMgbW92ZWQgaW4gYWJvdXQgNTAg
bXNlYy4NCiAJICovDQorDQorCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxl
ciAhPSBOVUxMKQkvKiBwYXJhbm9pYSBjaGVjayAqLw0KKwkJQlVHKCk7DQor
DQogCWlkZV9zZXRfaGFuZGxlciAoZHJpdmUsIA0KIAkgICZpZGVmbG9wcHlf
cGNfaW50ciwgCQkvKiBzZXJ2aWNlIHJvdXRpbmUgZm9yIHBhY2tldCBjb21t
YW5kICovDQotCSAgZmxvcHB5LT50aWNrcywJCQkvKiB3YWl0IHRoaXMgbG9u
ZyBiZWZvcmUgImZhaWxpbmciICovDQorCSAgZmxvcHB5LT50aWNrcywJCS8q
IHdhaXQgdGhpcyBsb25nIGJlZm9yZSAiZmFpbGluZyIgKi8NCiAJICAmaWRl
ZmxvcHB5X3RyYW5zZmVyX3BjMik7CS8qIGZhaWwgPT0gdHJhbnNmZXJfcGMy
ICovDQogCXJldHVybiBpZGVfc3RhcnRlZDsNCiB9DQpAQCAtMTE0NSw2ICsx
MTU2LDkgQEANCiAJfQ0KIAkNCiAJaWYgKHRlc3RfYml0IChJREVGTE9QUFlf
RFJRX0lOVEVSUlVQVCwgJmZsb3BweS0+ZmxhZ3MpKSB7DQorDQorCQlpZiAo
SFdHUk9VUChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEg
Y2hlY2sgKi8NCisJCQlCVUcoKTsNCiAJCWlkZV9zZXRfaGFuZGxlciAoZHJp
dmUsIHBrdF94ZmVyX3JvdXRpbmUsIElERUZMT1BQWV9XQUlUX0NNRCwgTlVM
TCk7DQogCQlPVVRfQllURSAoV0lOX1BBQ0tFVENNRCwgSURFX0NPTU1BTkRf
UkVHKTsJCS8qIElzc3VlIHRoZSBwYWNrZXQgY29tbWFuZCAqLw0KIAkJcmV0
dXJuIGlkZV9zdGFydGVkOw0KZGlmZiAtdXJOIGxpbnV4LTIuNS43L2RyaXZl
cnMvaWRlL2lkZS1wbWFjLmMgbGludXgtMi41LjcuZml4L2RyaXZlcnMvaWRl
L2lkZS1wbWFjLmMNCi0tLSBsaW51eC0yLjUuNy9kcml2ZXJzL2lkZS9pZGUt
cG1hYy5jCUZyaSBNYXIgMjIgMDI6NTg6MDAgMjAwMg0KKysrIGxpbnV4LTIu
NS43LmZpeC9kcml2ZXJzL2lkZS9pZGUtcG1hYy5jCUZyaSBNYXIgMjIgMjE6
NTU6MjAgMjAwMg0KQEAgLTk5Myw2ICs5OTMsOCBAQA0KIAkJZHJpdmUtPndh
aXRpbmdfZm9yX2RtYSA9IDE7DQogCQlpZiAoZHJpdmUtPm1lZGlhICE9IGlk
ZV9kaXNrKQ0KIAkJCXJldHVybiAwOw0KKwkJaWYgKEhXR1JPVVAoZHJpdmUp
LT5oYW5kbGVyICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQkJ
QlVHKCk7DQogCQlpZGVfc2V0X2hhbmRsZXIoZHJpdmUsICZpZGVfZG1hX2lu
dHIsIFdBSVRfQ01ELCBOVUxMKTsNCiAJCU9VVF9CWVRFKGZ1bmM9PWlkZV9k
bWFfd3JpdGU/IFdJTl9XUklURURNQTogV0lOX1JFQURETUEsDQogCQkJIElE
RV9DT01NQU5EX1JFRyk7DQpkaWZmIC11ck4gbGludXgtMi41LjcvZHJpdmVy
cy9pZGUvaWRlLXRhcGUuYyBsaW51eC0yLjUuNy5maXgvZHJpdmVycy9pZGUv
aWRlLXRhcGUuYw0KLS0tIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL2lkZS10
YXBlLmMJRnJpIE1hciAyMiAwMjo1ODowMCAyMDAyDQorKysgbGludXgtMi41
LjcuZml4L2RyaXZlcnMvaWRlL2lkZS10YXBlLmMJRnJpIE1hciAyMiAyMTo1
Nzo1NiAyMDAyDQpAQCAtMjE1NSw2ICsyMTU1LDkgQEANCiAJCQlpZiAodGVt
cCA+IHBjLT5idWZmZXJfc2l6ZSkgew0KIAkJCQlwcmludGsgKEtFUk5fRVJS
ICJpZGUtdGFwZTogVGhlIHRhcGUgd2FudHMgdG8gc2VuZCB1cyBtb3JlIGRh
dGEgdGhhbiBleHBlY3RlZCAtIGRpc2NhcmRpbmcgZGF0YVxuIik7DQogCQkJ
CWlkZXRhcGVfZGlzY2FyZF9kYXRhIChkcml2ZSwgYmNvdW50LmFsbCk7DQor
CQkJCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAhPSBOVUxMKQkvKiBw
YXJhbm9pYSBjaGVjayAqLw0KKwkJCQkJQlVHKCk7DQorDQogCQkJCWlkZV9z
ZXRfaGFuZGxlciAoZHJpdmUsICZpZGV0YXBlX3BjX2ludHIsIElERVRBUEVf
V0FJVF9DTUQsIE5VTEwpOw0KIAkJCQlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQog
CQkJfQ0KQEAgLTIxODEsNiArMjE4NCw5IEBADQogCWlmICh0YXBlLT5kZWJ1
Z19sZXZlbCA+PSAyKQ0KIAkJcHJpbnRrKEtFUk5fSU5GTyAiaWRlLXRhcGU6
IFtjbWQgJXhdIHRyYW5zZmVycmVkICVkIGJ5dGVzIG9uIHRoYXQgaW50ZXJy
dXB0XG4iLCBwYy0+Y1swXSwgYmNvdW50LmFsbCk7DQogI2VuZGlmDQorDQor
CWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAhPSBOVUxMKQkvKiBwYXJh
bm9pYSBjaGVjayAqLw0KKwkJQlVHKCk7DQogCWlkZV9zZXRfaGFuZGxlciAo
ZHJpdmUsICZpZGV0YXBlX3BjX2ludHIsIElERVRBUEVfV0FJVF9DTUQsIE5V
TEwpOwkvKiBBbmQgc2V0IHRoZSBpbnRlcnJ1cHQgaGFuZGxlciBhZ2FpbiAq
Lw0KIAlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQogfQ0KQEAgLTIyNTUsNiArMjI2
MSw4IEBADQogCQlyZXR1cm4gaWRlX3N0b3BwZWQ7DQogCX0NCiAJdGFwZS0+
Y21kX3N0YXJ0X3RpbWUgPSBqaWZmaWVzOw0KKwlpZiAoSFdHUk9VUChkcml2
ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sgKi8NCisJ
CUJVRygpOw0KIAlpZGVfc2V0X2hhbmRsZXIoZHJpdmUsICZpZGV0YXBlX3Bj
X2ludHIsIElERVRBUEVfV0FJVF9DTUQsIE5VTEwpOwkvKiBTZXQgdGhlIGlu
dGVycnVwdCByb3V0aW5lICovDQogCWF0YXBpX291dHB1dF9ieXRlcyAoZHJp
dmUscGMtPmMsMTIpOwkJCS8qIFNlbmQgdGhlIGFjdHVhbCBwYWNrZXQgKi8N
CiAJcmV0dXJuIGlkZV9zdGFydGVkOw0KQEAgLTIzMjgsNiArMjMzNiw5IEBA
DQogCX0NCiAjZW5kaWYgLyogQ09ORklHX0JMS19ERVZfSURFRE1BICovDQog
CWlmICh0ZXN0X2JpdChJREVUQVBFX0RSUV9JTlRFUlJVUFQsICZ0YXBlLT5m
bGFncykpIHsNCisNCisJCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAh
PSBOVUxMKQkvKiBwYXJhbm9pYSBjaGVjayAqLw0KKwkJCUJVRygpOw0KIAkJ
aWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmaWRldGFwZV90cmFuc2Zlcl9wYywg
SURFVEFQRV9XQUlUX0NNRCwgTlVMTCk7DQogCQlPVVRfQllURShXSU5fUEFD
S0VUQ01ELCBJREVfQ09NTUFORF9SRUcpOw0KIAkJcmV0dXJuIGlkZV9zdGFy
dGVkOw0KZGlmZiAtdXJOIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL2lkZS10
YXNrZmlsZS5jIGxpbnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS9pZGUtdGFz
a2ZpbGUuYw0KLS0tIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL2lkZS10YXNr
ZmlsZS5jCUZyaSBNYXIgMjIgMDI6NTg6MDAgMjAwMg0KKysrIGxpbnV4LTIu
NS43LmZpeC9kcml2ZXJzL2lkZS9pZGUtdGFza2ZpbGUuYwlTYXQgTWFyIDIz
IDAyOjQ4OjE0IDIwMDINCkBAIC0xLDggKzEsMjcgQEANCiAvKg0KLSAqICBD
b3B5cmlnaHQgKEMpIDIwMDAJCU1pY2hhZWwgQ29ybndlbGwgPGNvcm53ZWxs
QGFjbS5vcmc+DQotICogIENvcHlyaWdodCAoQykgMjAwMAkJQW5kcmUgSGVk
cmljayA8YW5kcmVAbGludXgtaWRlLm9yZz4NCisgKiBsaW51eC9kcml2ZXJz
L2lkZS9pZGUtdGFza2ZpbGUuYyAgICAgVmVyc2lvbiAwLjMwICAgIE1hciAy
MywgMjAwMg0KICAqDQotICogIE1heSBiZSBjb3BpZWQgb3IgbW9kaWZpZWQg
dW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGlj
ZW5zZQ0KKyAqICBDb3B5cmlnaHQgKEMpIDIwMDAtMjAwMglNaWNoYWVsIENv
cm53ZWxsIDxjb3Jud2VsbEBhY20ub3JnPg0KKyAqICBDb3B5cmlnaHQgKEMp
IDIwMDAtMjAwMglBbmRyZSBIZWRyaWNrIDxhbmRyZUBsaW51eC1pZGUub3Jn
Pg0KKyAqDQorICogIFRoZSBiaWcgdGhlIGJhZCBhbmQgdGhlIHVnbHkuDQor
ICoNCisgKiAgUHJvYmxlbXMgdG8gYmUgZml4ZWQgYmVjYXVzZSBvZiBCSU8g
aW50ZXJmYWNlIG9yIHRoZSBsYWNrIHRoZXJlZm9yZS4NCisgKg0KKyAqICBG
aWxsIG1lIGluIHN0dXBpZCAhISENCisgKg0KKyAqICBIT1NUOg0KKyAqCUdl
bmVyYWwgcmVmZXJzIHRvIHRoZSBDb250cm9sbGVyIGFuZCBEcml2ZXIgInBh
aXIiLg0KKyAqICBEQVRBIEhBTkRMRVI6DQorICoJVW5kZXIgdGhlIGNvbnRl
eHQgb2YgTGludXggaXQgZ2VuZXJhbGx5IHJlZmVycyB0byBhbiBpbnRlcnJ1
cHQgaGFuZGxlci4NCisgKglIb3dldmVyLCBpdCBjb3JyZWN0bHkgZGVzY3Jp
YmVzIHRoZSAnSE9TVCcNCisgKiAgREFUQSBCTE9DSzoNCisgKglUaGUgYW1v
dW50IG9mIGRhdGEgbmVlZGVkIHRvIGJlIHRyYW5zZmVyZWQgYXMgcHJlZGVm
aW5lZCBpbiB0aGUNCisgKglzZXR1cCBvZiB0aGUgZGV2aWNlLg0KKyAqICBT
VE9SQUdFIEFUT01JQzoNCisgKglUaGUgJ0RBVEEgQkxPQ0snIGFzc29jaWF0
ZWQgdG8gdGhlICdEQVRBIEhBTkRMRVInLCBhbmQgY2FuIGJlIGFzDQorICoJ
c21hbGwgYXMgYSBzaW5nbGUgc2VjdG9yIG9yIGFzIGxhcmdlIGFzIHRoZSBl
bnRpcmUgY29tbWFuZCBibG9jaw0KKyAqCXJlcXVlc3QuDQogICovDQogDQog
I2luY2x1ZGUgPGxpbnV4L2NvbmZpZy5oPg0KQEAgLTMzLDcgKzUyLDcgQEAN
CiAjZGVmaW5lIERFQlVHX1RBU0tGSUxFCTAJLyogdW5zZXQgd2hlbiBmaXhl
ZCAqLw0KIA0KICNpZiBERUJVR19UQVNLRklMRQ0KLSNkZWZpbmUgRFRGKHgu
Li4pIHByaW50aygjI3gpDQorI2RlZmluZSBEVEYoeC4uLikgcHJpbnRrKHgp
DQogI2Vsc2UNCiAjZGVmaW5lIERURih4Li4uKQ0KICNlbmRpZg0KQEAgLTU1
LDcgKzc0LDcgQEANCiAJCQkJdW5zaWduZWQgbG9uZyAqZmxhZ3MpDQogew0K
IAlpZiAocnEtPmJpbykNCi0JICAgIGJpb19rdW5tYXBfaXJxKHRvLCBmbGFn
cyk7DQorCQliaW9fa3VubWFwX2lycSh0bywgZmxhZ3MpOw0KIH0NCiANCiBz
dGF0aWMgdm9pZCBic3dhcF9kYXRhICh2b2lkICpidWZmZXIsIGludCB3Y291
bnQpDQpAQCAtMjg4LDQyICszMDcsNTIgQEANCiAJCQlicmVhazsNCiAJfQ0K
IH0NCi1zdGF0aWMgaWRlX3N0YXJ0c3RvcF90IGJpb19tdWxvdXRfaW50cihp
ZGVfZHJpdmVfdCAqZHJpdmUpOw0KIA0KIC8qDQorICogRklYTUUgYmVmb3Jl
IDIuNiAuLi4gREFUQSBpbnRlZ3JpdHkgaXNzdWUgdXBvbiBlcnJvci4NCisg
Ki8NCisvKg0KICAqIEhhbmRsZXIgZm9yIGNvbW1hbmQgd3JpdGUgbXVsdGlw
bGUNCiAgKiBDYWxsZWQgZGlyZWN0bHkgZnJvbSBleGVjdXRlX2RyaXZlX2Nt
ZCBmb3IgdGhlIGZpcnN0IGJ1bmNoIG9mIHNlY3RvcnMsDQogICogYWZ0ZXJ3
YXJkcyBvbmx5IGJ5IHRoZSBJU1INCiAgKi8NCiBzdGF0aWMgaWRlX3N0YXJ0
c3RvcF90IHRhc2tfbXVsb3V0X2ludHIoaWRlX2RyaXZlX3QgKmRyaXZlKQ0K
IHsNCi0JdW5zaWduZWQgaW50CQltc2VjdCwgbnNlY3Q7DQotCWJ5dGUgc3Rh
dAkJPSBHRVRfU1RBVCgpOw0KLQlieXRlIGlvXzMyYml0CQk9IGRyaXZlLT5p
b18zMmJpdDsNCi0Jc3RydWN0IHJlcXVlc3QgKnJxCT0gSFdHUk9VUChkcml2
ZSktPnJxOw0KLQlpZGVfaHdncm91cF90ICpod2dyb3VwCT0gSFdHUk9VUChk
cml2ZSk7DQotCWNoYXIgKnBCdWYJCT0gTlVMTDsNCisJYnl0ZSBzdGF0CQkJ
PSBHRVRfU1RBVCgpOw0KKwlieXRlIGlvXzMyYml0CQkJPSBkcml2ZS0+aW9f
MzJiaXQ7DQorCXN0cnVjdCByZXF1ZXN0ICpycQkJPSBIV0dST1VQKGRyaXZl
KS0+cnE7DQorCWlkZV9od2dyb3VwX3QgKmh3Z3JvdXAJCT0gSFdHUk9VUChk
cml2ZSk7DQorCWNoYXIgKnBCdWYJCQk9IE5VTEw7DQorCWlkZV9zdGFydHN0
b3BfdCBzdGFydHN0b3AJPSBpZGVfc3RvcHBlZDsNCisJdW5zaWduZWQgaW50
IG1zZWN0CQk9IGRyaXZlLT5tdWx0X2NvdW50Ow0KKwl1bnNpZ25lZCBpbnQg
bnNlY3Q7DQogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQogDQorLyoNCisgKglo
ZWxkIGhlcmUgYXMgYSByZWZlcnJlbmNlIHRvIHRoZSBwYXN0Lg0KKyAqCV9f
aWRlX2VuZF9yZXF1ZXN0KGRyaXZlLCAxLCBycS0+aGFyZF9ucl9zZWN0b3Jz
KTsNCisgKi8NCiAJLyoNCiAJICogKGtzL2hzKTogSGFuZGxlIGxhc3QgSVJR
IG9uIG11bHRpLXNlY3RvciB0cmFuc2ZlciwNCiAJICogb2NjdXJzIGFmdGVy
IGFsbCBkYXRhIHdhcyBzZW50IGluIHRoaXMgY2h1bmsNCiAJICovDQogCWlm
IChycS0+Y3VycmVudF9ucl9zZWN0b3JzID09IDApIHsNCi0JCWlmIChzdGF0
ICYgKEVSUl9TVEFUfERSUV9TVEFUKSkNCisJCWlmIChzdGF0ICYgKEVSUl9T
VEFUfERSUV9TVEFUKSkgew0KKwkJCXByaW50aygiJXM6IE1VTFRJLVdSSVRF
IGFzc3VtZSBhbGwgZGF0YSB0cmFuc2ZlcmVkICIgXA0KKwkJCQkiaXMgYmFk
IHN0YXR1cz0weCUwMnhcbiIsDQorCQkJCWRyaXZlLT5uYW1lLCBzdGF0KTsN
CiAJCQlyZXR1cm4gaWRlX2Vycm9yKGRyaXZlLCAidGFza19tdWxvdXRfaW50
ciIsIHN0YXQpOw0KLQ0KLQkJLyoNCi0JCSAqIHRoZXJlIG1heSBiZSBtb3Jl
LCBpZGVfZG9fcmVxdWVzdCB3aWxsIHJlc3RhcnQgaXQgaWYNCi0JCSAqIG5l
Y2Vzc2FyeQ0KLQkJICovDQotCQlpZGVfZW5kX3JlcXVlc3QoZHJpdmUsIDEp
Ow0KLQ0KLQkJcmV0dXJuIGlkZV9zdG9wcGVkOw0KKwkJfQ0KKwkJaWYgKCFy
cS0+YmlvKQ0KKwkJCWlkZV9lbmRfcmVxdWVzdChkcml2ZSwgMSk7DQorCQly
ZXR1cm4gc3RhcnRzdG9wOw0KIAl9DQogDQogCWlmICghT0tfU1RBVChzdGF0
LERBVEFfUkVBRFksQkFEX1JfU1RBVCkpIHsNCiAJCWlmIChzdGF0ICYgKEVS
Ul9TVEFUfERSUV9TVEFUKSkgew0KKwkJCXByaW50aygiJXM6IE1VTFRJLVdS
SVRFIGFzc3VtZSBhbGwgZGF0YSB0cmFuc2ZlcmVkICIgXA0KKwkJCQkiaXMg
YmFkIHN0YXR1cz0weCUwMnhcbiIsDQorCQkJCWRyaXZlLT5uYW1lLCBzdGF0
KTsNCiAJCQlyZXR1cm4gaWRlX2Vycm9yKGRyaXZlLCAidGFza19tdWxvdXRf
aW50ciIsIHN0YXQpOw0KIAkJfQ0KIAkJLyogbm8gZGF0YSB5ZXQsIHNvIHdh
aXQgZm9yIGFub3RoZXIgaW50ZXJydXB0ICovDQpAQCAtMzMyLDIyICszNjEs
NDEgQEANCiAJCXJldHVybiBpZGVfc3RhcnRlZDsNCiAJfQ0KIA0KLQkvKiAo
a3MvaHMpOiBTZWUgdGFza19tdWxpbl9pbnRyICovDQotCW1zZWN0ID0gZHJp
dmUtPm11bHRfY291bnQ7DQotCW5zZWN0ID0gcnEtPmN1cnJlbnRfbnJfc2Vj
dG9yczsNCi0JaWYgKG5zZWN0ID4gbXNlY3QpDQotCQluc2VjdCA9IG1zZWN0
Ow0KKwlpZiAoSFdHUk9VUChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkgew0K
KwkJdW5zaWduZWQgbG9uZyBsZmxhZ3M7DQorCQlzcGluX2xvY2tfaXJxc2F2
ZSgmaWRlX2xvY2ssIGxmbGFncyk7DQorCQlIV0dST1VQKGRyaXZlKS0+aGFu
ZGxlciA9IE5VTEw7DQorCQlkZWxfdGltZXIoJkhXR1JPVVAoZHJpdmUpLT50
aW1lcik7DQorCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpZGVfbG9jaywg
bGZsYWdzKTsNCisJfQ0KIA0KLQlwQnVmID0gaWRlX21hcF9ycShycSwgJmZs
YWdzKTsNCi0JRFRGKCJNdWx0aXdyaXRlOiAlcCwgbnNlY3Q6ICVkICwgcnEt
PmN1cnJlbnRfbnJfc2VjdG9yczogJWxkXG4iLA0KLQkJcEJ1ZiwgbnNlY3Qs
IHJxLT5jdXJyZW50X25yX3NlY3RvcnMpOw0KLQlkcml2ZS0+aW9fMzJiaXQg
PSAwOw0KLQl0YXNrZmlsZV9vdXRwdXRfZGF0YShkcml2ZSwgcEJ1ZiwgbnNl
Y3QgKiBTRUNUT1JfV09SRFMpOw0KLQlpZGVfdW5tYXBfcnEocnEsIHBCdWYs
ICZmbGFncyk7DQotCWRyaXZlLT5pb18zMmJpdCA9IGlvXzMyYml0Ow0KKwlk
byB7DQorCQluc2VjdCA9IHJxLT5jdXJyZW50X25yX3NlY3RvcnM7DQorCQlp
ZiAobnNlY3QgPiBtc2VjdCkNCisJCQluc2VjdCA9IG1zZWN0Ow0KKwkJcEJ1
ZiA9IGlkZV9tYXBfcnEocnEsICZmbGFncyk7DQorCQlEVEYoIk11bHRpd3Jp
dGU6ICVwLCBuc2VjdDogJWQsIG1zZWN0OiAlZCwgIiBcDQorCQkJInJxLT5j
dXJyZW50X25yX3NlY3RvcnM6ICVsZFxuIiwNCisJCQlwQnVmLCBuc2VjdCwg
bXNlY3QsIHJxLT5jdXJyZW50X25yX3NlY3RvcnMpOw0KKwkJbXNlY3QgLT0g
bnNlY3Q7DQorCQlkcml2ZS0+aW9fMzJiaXQgPSAwOw0KKwkJdGFza2ZpbGVf
b3V0cHV0X2RhdGEoZHJpdmUsIHBCdWYsIG5zZWN0ICogU0VDVE9SX1dPUkRT
KTsNCisJCWlkZV91bm1hcF9ycShycSwgcEJ1ZiwgJmZsYWdzKTsNCisJCXJx
LT5jdXJyZW50X25yX3NlY3RvcnMgLT0gbnNlY3Q7DQorCQlkcml2ZS0+aW9f
MzJiaXQgPSBpb18zMmJpdDsNCisJCS8qDQorCQkgKiBGSVhNRSA6OiBXZSBy
ZWFsbHkgY2FuIG5vdCBsZWdhbGx5IGdldCBhIG5ldyBwYWdlL2Jpbw0KKwkJ
ICogcmVnYXJkbGVzcywgaWYgdGhpcyBpcyB0aGUgZW5kIG9mIG91ciBzZWdt
ZW50Lg0KKwkJICogQklPIHdhbGtpbmcgb3Igc2VnbWVudCBjYW4gb25seSBi
ZSB1cGRhdGVkIGFmdGVyIHdlDQorCQkgKiBoYXZlIGEgZ29vZCAgR0VUX1NU
QVQoKTsgcmV0dXJuLg0KKwkJICovDQorCQlpZiAoIXJxLT5jdXJyZW50X25y
X3NlY3RvcnMpIHsNCisJCQlpZiAoIWlkZV9lbmRfcmVxdWVzdChkcml2ZSwg
MSkpDQorCQkJCWlmICghcnEtPmJpbykNCisJCQkJCXJldHVybiBpZGVfc3Rv
cHBlZDsNCisJCX0NCisJfSB3aGlsZSAobXNlY3QpOw0KIAlycS0+ZXJyb3Jz
ID0gMDsNCi0JLyogQXJlIHdlIHN1cmUgdGhhdCB0aGlzIGFzIGFsbCBiZWVu
IGFscmVhZHkgdHJhbnNmZXJlZD8gKi8NCi0JcnEtPmN1cnJlbnRfbnJfc2Vj
dG9ycyAtPSBuc2VjdDsNCiAJaWYgKGh3Z3JvdXAtPmhhbmRsZXIgPT0gTlVM
TCkNCiAJCWlkZV9zZXRfaGFuZGxlcihkcml2ZSwgJnRhc2tfbXVsb3V0X2lu
dHIsIFdBSVRfQ01ELCBOVUxMKTsNCiAJcmV0dXJuIGlkZV9zdGFydGVkOw0K
QEAgLTM2MSwxMSArNDA5LDEwIEBADQogCWJ5dGUgSElISSA9IChkcml2ZS0+
YWRkcmVzc2luZykgPyAweEUwIDogMHhFRjsNCiANCiAJLyogKGtzL2hzKTog
TW92ZWQgdG8gc3RhcnQsIGRvIG5vdCB1c2UgZm9yIG11bHRpcGxlIG91dCBj
b21tYW5kcyAqLw0KLQlpZiAodGFzay0+aGFuZGxlciAhPSB0YXNrX211bG91
dF9pbnRyICYmIHRhc2stPmhhbmRsZXIgIT0gYmlvX211bG91dF9pbnRyKSB7
DQotCQlpZiAoSURFX0NPTlRST0xfUkVHKQ0KLQkJCU9VVF9CWVRFKGRyaXZl
LT5jdGwsIElERV9DT05UUk9MX1JFRyk7CS8qIGNsZWFyIG5JRU4gKi8NCi0J
CVNFTEVDVF9NQVNLKEhXSUYoZHJpdmUpLCBkcml2ZSwgMCk7DQotCX0NCisJ
LyogQUxMIENvbW1hbmQgQmxvY2sgRXhlY3V0aW9ucyBTSEFMTCBjbGVhciBu
SUVOLCB1bmxlc3Mgb3RoZXJ3aXNlICovDQorCWlmIChJREVfQ09OVFJPTF9S
RUcpDQorCQlPVVRfQllURShkcml2ZS0+Y3RsLCBJREVfQ09OVFJPTF9SRUcp
OwkvKiBjbGVhciBuSUVOICovDQorCVNFTEVDVF9NQVNLKEhXSUYoZHJpdmUp
LCBkcml2ZSwgMCk7DQogDQogCWlmICgoaWQtPmNvbW1hbmRfc2V0XzIgJiAw
eDA0MDApICYmDQogCSAgICAoaWQtPmNmc19lbmFibGVfMiAmIDB4MDQwMCkg
JiYNCkBAIC0zODksMTEgKzQzNiw2IEBADQogCWlmICh0YXNrLT5oYW5kbGVy
ICE9IE5VTEwpIHsNCiAJCWlkZV9zZXRfaGFuZGxlciAoZHJpdmUsIHRhc2st
PmhhbmRsZXIsIFdBSVRfQ01ELCBOVUxMKTsNCiAJCU9VVF9CWVRFKHRhc2tm
aWxlLT5jb21tYW5kLCBJREVfQ09NTUFORF9SRUcpOw0KLQkJLyoNCi0JCSAq
IFdhcm5pbmcgY2hlY2sgZm9yIHJhY2UgYmV0d2VlbiBoYW5kbGVyIGFuZCBw
cmVoYW5kbGVyIGZvcg0KLQkJICogd3JpdGluZyBmaXJzdCBibG9jayBvZiBk
YXRhLiAgaG93ZXZlciBzaW5jZSB3ZSBhcmUgd2VsbA0KLQkJICogaW5zaWRl
IHRoZSBib3VuZGFyaWVzIG9mIHRoZSBzZWVrLCB3ZSBzaG91bGQgYmUgb2th
eS4NCi0JCSAqLw0KIAkJaWYgKHRhc2stPnByZWhhbmRsZXIgIT0gTlVMTCkg
ew0KIAkJCXJldHVybiB0YXNrLT5wcmVoYW5kbGVyKGRyaXZlLCB0YXNrLT5y
cSk7DQogCQl9DQpAQCAtNDA1LDcgKzQ0NywxMiBAQA0KIAlyZXR1cm4gaWRl
X3N0YXJ0ZWQ7DQogfQ0KIA0KLXZvaWQgZG9fdGFza2ZpbGUoaWRlX2RyaXZl
X3QgKmRyaXZlLCBzdHJ1Y3QgaGRfZHJpdmVfdGFza19oZHIgKnRhc2tmaWxl
LA0KKy8qDQorICogRklYTUUgOjogTmVlZCB0byBtZXJnZSBhbGwgdGFza2Zp
bGUgcmVxdWVzdHMgcmVnYXJkbGVzcyBvZiBjYWxsZXINCisgKgl0byB0aGUg
YWJvdmUgZG9fcndfdGFza2ZpbGUuDQorICovDQordm9pZCBkb190YXNrZmls
ZShpZGVfZHJpdmVfdCAqZHJpdmUsDQorCQlzdHJ1Y3QgaGRfZHJpdmVfdGFz
a19oZHIgKnRhc2tmaWxlLA0KIAkJc3RydWN0IGhkX2RyaXZlX2hvYl9oZHIg
KmhvYmZpbGUsDQogCQlpZGVfaGFuZGxlcl90ICpoYW5kbGVyKQ0KIHsNCkBA
IC00MTMsMTEgKzQ2MCwxMCBAQA0KIAlieXRlIEhJSEkgPSAoZHJpdmUtPmFk
ZHJlc3NpbmcpID8gMHhFMCA6IDB4RUY7DQogDQogCS8qIChrcy9ocyk6IE1v
dmVkIHRvIHN0YXJ0LCBkbyBub3QgdXNlIGZvciBtdWx0aXBsZSBvdXQgY29t
bWFuZHMgKi8NCi0JaWYgKCpoYW5kbGVyICE9IHRhc2tfbXVsb3V0X2ludHIg
JiYgaGFuZGxlciAhPSBiaW9fbXVsb3V0X2ludHIpIHsNCi0JCWlmIChJREVf
Q09OVFJPTF9SRUcpDQotCQkJT1VUX0JZVEUoZHJpdmUtPmN0bCwgSURFX0NP
TlRST0xfUkVHKTsgIC8qIGNsZWFyIG5JRU4gKi8NCi0JCVNFTEVDVF9NQVNL
KEhXSUYoZHJpdmUpLCBkcml2ZSwgMCk7DQotCX0NCisJLyogQUxMIENvbW1h
bmQgQmxvY2sgRXhlY3V0aW9ucyBTSEFMTCBjbGVhciBuSUVOLCB1bmxlc3Mg
b3RoZXJ3aXNlICovDQorCWlmIChJREVfQ09OVFJPTF9SRUcpDQorCQlPVVRf
QllURShkcml2ZS0+Y3RsLCBJREVfQ09OVFJPTF9SRUcpOyAgLyogY2xlYXIg
bklFTiAqLw0KKwlTRUxFQ1RfTUFTSyhIV0lGKGRyaXZlKSwgZHJpdmUsIDAp
Ow0KIA0KIAlpZiAoKGlkLT5jb21tYW5kX3NldF8yICYgMHgwNDAwKSAmJg0K
IAkgICAgKGlkLT5jZnNfZW5hYmxlXzIgJiAweDA0MDApICYmDQpAQCAtNDc3
LDYgKzUyMyw4IEBADQogCWlmIChzdGF0ICYgKEVSUl9TVEFUfERSUV9TVEFU
KSkNCiAJCXJldHVybiBpZGVfZXJyb3IoZHJpdmUsICJzZXRfZ2VvbWV0cnlf
aW50ciIsIHN0YXQpOw0KIA0KKwlpZiAoSFdHUk9VUChkcml2ZSktPmhhbmRs
ZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sgKi8NCisJCUJVRygpOw0K
IAlpZGVfc2V0X2hhbmRsZXIoZHJpdmUsICZzZXRfZ2VvbWV0cnlfaW50ciwg
V0FJVF9DTUQsIE5VTEwpOw0KIAlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQogfQ0K
QEAgLTUxMyw3ICs1NjEsMTAgQEANCiB9DQogDQogLyoNCi0gKiBIYW5kbGVy
IGZvciBjb21tYW5kIHdpdGggUElPIGRhdGEtaW4gcGhhc2UNCisgKiBIYW5k
bGVyIGZvciBjb21tYW5kIHdpdGggUElPIGRhdGEtaW4gcGhhc2UsIFJFQUQN
CisgKi8NCisvKg0KKyAqIEZJWE1FIGJlZm9yZSAyLjYgLi4uIERBVEEgaW50
ZWdyaXR5IGlzc3VlIHVwb24gZXJyb3IuIDxhbmRyZUBsaW51eC1pZGUub3Jn
Pg0KICAqLw0KIHN0YXRpYyBpZGVfc3RhcnRzdG9wX3QgdGFza19pbl9pbnRy
IChpZGVfZHJpdmVfdCAqZHJpdmUpDQogew0KQEAgLTUyNSw2NSArNTc2LDgw
IEBADQogDQogCWlmICghT0tfU1RBVChzdGF0LERBVEFfUkVBRFksQkFEX1Jf
U1RBVCkpIHsNCiAJCWlmIChzdGF0ICYgKEVSUl9TVEFUfERSUV9TVEFUKSkg
ew0KKyNpZiAwDQorCQkJRFRGKCIlczogUkVBRCBhdHRlbXB0aW5nIHRvIHJl
Y292ZXIgbGFzdCAiIFwNCisJCQkJInNlY3RvciBjb3VudGVyIHN0YXR1cz0w
eCUwMnhcbiIsDQorCQkJCWRyaXZlLT5uYW1lLCBzdGF0KTsNCisJCS8qDQor
CQkgKiBFeHBlY3QgYSBCVUcgQk9NQiBpZiB3ZSBhdHRlbXB0IHRvIHJld2lu
ZCB0aGUNCisJCSAqIG9mZnNldCBpbiB0aGUgQklPIGFrYSBQQUdFIGluIHRo
ZSBjdXJyZW50IEJMT0NLDQorCQkgKiBzZWdtZW50LiAgVGhpcyBpcyBkaWZm
ZXJlbnQgdGhhbiB0aGUgSE9TVCBzZWdtZW50Lg0KKwkJICovDQorDQorCQkJ
cnEtPmN1cnJlbnRfbnJfc2VjdG9ycysrOw0KKyNlbmRpZg0KIAkJCXJldHVy
biBpZGVfZXJyb3IoZHJpdmUsICJ0YXNrX2luX2ludHIiLCBzdGF0KTsNCiAJ
CX0NCiAJCWlmICghKHN0YXQgJiBCVVNZX1NUQVQpKSB7DQogCQkJRFRGKCJ0
YXNrX2luX2ludHIgdG8gU29vbiB3YWl0IGZvciBuZXh0IGludGVycnVwdFxu
Iik7DQotCQkJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmdGFza19pbl9pbnRy
LCBXQUlUX0NNRCwgTlVMTCk7DQorCQkJaWYgKEhXR1JPVVAoZHJpdmUpLT5o
YW5kbGVyID09IE5VTEwpDQorCQkJCWlkZV9zZXRfaGFuZGxlcihkcml2ZSwg
JnRhc2tfaW5faW50ciwgV0FJVF9DTUQsIE5VTEwpOw0KIAkJCXJldHVybiBp
ZGVfc3RhcnRlZDsNCiAJCX0NCiAJfQ0KLQlEVEYoInN0YXQ6ICUwMnhcbiIs
IHN0YXQpOw0KIAlwQnVmID0gaWRlX21hcF9ycShycSwgJmZsYWdzKTsNCi0J
RFRGKCJSZWFkOiAlcCwgcnEtPmN1cnJlbnRfbnJfc2VjdG9yczogJWRcbiIs
IHBCdWYsIChpbnQpIHJxLT5jdXJyZW50X25yX3NlY3RvcnMpOw0KLQ0KKwlE
VEYoIlJlYWQ6ICVwLCBycS0+Y3VycmVudF9ucl9zZWN0b3JzOiAlZCwgc3Rh
dDogJTAyeFxuIiwNCisJCXBCdWYsIChpbnQpIHJxLT5jdXJyZW50X25yX3Nl
Y3RvcnMsIHN0YXQpOw0KIAlkcml2ZS0+aW9fMzJiaXQgPSAwOw0KIAl0YXNr
ZmlsZV9pbnB1dF9kYXRhKGRyaXZlLCBwQnVmLCBTRUNUT1JfV09SRFMpOw0K
IAlpZGVfdW5tYXBfcnEocnEsIHBCdWYsICZmbGFncyk7DQogCWRyaXZlLT5p
b18zMmJpdCA9IGlvXzMyYml0Ow0KLQ0KLQlpZiAoLS1ycS0+Y3VycmVudF9u
cl9zZWN0b3JzIDw9IDApIHsNCi0JCS8qIChocyk6IHN3YXBwZWQgbmV4dCAy
IGxpbmVzICovDQotCQlEVEYoIlJlcXVlc3QgRW5kZWQgc3RhdDogJTAyeFxu
IiwgR0VUX1NUQVQoKSk7DQotCQlpZiAoaWRlX2VuZF9yZXF1ZXN0KGRyaXZl
LCAxKSkgew0KLQkJCWlkZV9zZXRfaGFuZGxlcihkcml2ZSwgJnRhc2tfaW5f
aW50ciwgIFdBSVRfQ01ELCBOVUxMKTsNCi0JCQlyZXR1cm4gaWRlX3N0YXJ0
ZWQ7DQotCQl9DQotCX0gZWxzZSB7DQorCS8qDQorCSAqIEZJWE1FIDo6IFdl
IHJlYWxseSBjYW4gbm90IGxlZ2FsbHkgZ2V0IGEgbmV3IHBhZ2UvYmlvDQor
CSAqIHJlZ2FyZGxlc3MsIGlmIHRoaXMgaXMgdGhlIGVuZCBvZiBvdXIgc2Vn
bWVudC4NCisJICogQklPIHdhbGtpbmcgb3Igc2VnbWVudCBjYW4gb25seSBi
ZSB1cGRhdGVkIGFmdGVyIHdlIGhhdmUgYSBnb29kDQorCSAqIEdFVF9TVEFU
KCk7IHJldHVybi4NCisJICovDQorCWlmICgtLXJxLT5jdXJyZW50X25yX3Nl
Y3RvcnMgPD0gMCkNCisJCWlmICghaWRlX2VuZF9yZXF1ZXN0KGRyaXZlLCAx
KSkNCisJCQlyZXR1cm4gaWRlX3N0b3BwZWQ7DQorCWlmIChIV0dST1VQKGRy
aXZlKS0+aGFuZGxlciA9PSBOVUxMKQ0KIAkJaWRlX3NldF9oYW5kbGVyKGRy
aXZlLCAmdGFza19pbl9pbnRyLCAgV0FJVF9DTUQsIE5VTEwpOw0KLQkJcmV0
dXJuIGlkZV9zdGFydGVkOw0KLQl9DQotCXJldHVybiBpZGVfc3RvcHBlZDsN
CisJcmV0dXJuIGlkZV9zdGFydGVkOw0KIH0NCiANCisvKg0KKyAqIFZFUklG
WSBNRSBiZWZvcmUgMi42IC4uLiB1bmV4cGVjdGVkIHJhY2UgaXMgcG9zc2li
bGUgYmFzZWQgb24gZGV0YWlscw0KKyAqIFJNSyB3aXRoIDc0TFMyNDUvMzcz
LzM3NCBUVEwgYnVmZmVyIGxvZ2ljIGJlY2F1c2Ugb2YgcGFzc3Rocm91Z2gu
DQorICovDQogc3RhdGljIGlkZV9zdGFydHN0b3BfdCBwcmVfdGFza19vdXRf
aW50ciAoaWRlX2RyaXZlX3QgKmRyaXZlLCBzdHJ1Y3QgcmVxdWVzdCAqcnEp
DQogew0KLQlpZGVfdGFza190ICphcmdzID0gcnEtPnNwZWNpYWw7DQorCWNo
YXIgKnBCdWYJCT0gTlVMTDsNCisJdW5zaWduZWQgbG9uZyBmbGFnczsNCiAJ
aWRlX3N0YXJ0c3RvcF90IHN0YXJ0c3RvcDsNCiANCi0JaWYgKGlkZV93YWl0
X3N0YXQoJnN0YXJ0c3RvcCwgZHJpdmUsIERBVEFfUkVBRFksIGRyaXZlLT5i
YWRfd3N0YXQsIFdBSVRfRFJRKSkgew0KLQkJcHJpbnRrKEtFUk5fRVJSICIl
czogbm8gRFJRIGFmdGVyIGlzc3VpbmcgJXNcbiIsIGRyaXZlLT5uYW1lLCBk
cml2ZS0+bXVsdF9jb3VudCA/ICJNVUxUV1JJVEUiIDogIldSSVRFIik7DQor
CWlmIChpZGVfd2FpdF9zdGF0KCZzdGFydHN0b3AsIGRyaXZlLCBEQVRBX1JF
QURZLA0KKwkJCWRyaXZlLT5iYWRfd3N0YXQsIFdBSVRfRFJRKSkgew0KKwkJ
cHJpbnRrKEtFUk5fRVJSICIlczogbm8gRFJRIGFmdGVyIGlzc3VpbmcgJXNc
biIsDQorCQkJZHJpdmUtPm5hbWUsDQorCQkJZHJpdmUtPmFkZHJlc3Npbmcg
PyAiV1JJVEVfRVhUIiA6ICJXUklURSIpOw0KIAkJcmV0dXJuIHN0YXJ0c3Rv
cDsNCiAJfQ0KLQ0KLQkvKiAoa3MvaHMpOiBGaXhlZCBNdWx0aSBXcml0ZSAq
Lw0KLQlpZiAoKGFyZ3MtPnRmUmVnaXN0ZXJbSURFX0NPTU1BTkRfT0ZGU0VU
XSAhPSBXSU5fTVVMVFdSSVRFKSAmJg0KLQkgICAgKGFyZ3MtPnRmUmVnaXN0
ZXJbSURFX0NPTU1BTkRfT0ZGU0VUXSAhPSBXSU5fTVVMVFdSSVRFX0VYVCkp
IHsNCi0JCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQotCQljaGFyICpidWYgPSBp
ZGVfbWFwX3JxKHJxLCAmZmxhZ3MpOw0KLQkJLyogRm9yIFdyaXRlX3NlY3Rv
cnMgd2UgbmVlZCB0byBzdHVmZiB0aGUgZmlyc3Qgc2VjdG9yICovDQotCQl0
YXNrZmlsZV9vdXRwdXRfZGF0YShkcml2ZSwgYnVmLCBTRUNUT1JfV09SRFMp
Ow0KLQkJcnEtPmN1cnJlbnRfbnJfc2VjdG9ycy0tOw0KLQkJaWRlX3VubWFw
X3JxKHJxLCBidWYsICZmbGFncyk7DQotCX0gZWxzZSB7DQotCQlhdGFfcG9s
bF9kcml2ZV9yZWFkeShkcml2ZSk7DQotCQlyZXR1cm4gYXJncy0+aGFuZGxl
cihkcml2ZSk7DQotCX0NCisJLyogRm9yIFdyaXRlX3NlY3RvcnMgd2UgbmVl
ZCB0byBzdHVmZiB0aGUgZmlyc3Qgc2VjdG9yICovDQorCXBCdWYgPSBpZGVf
bWFwX3JxKHJxLCAmZmxhZ3MpOw0KKwl0YXNrZmlsZV9vdXRwdXRfZGF0YShk
cml2ZSwgcEJ1ZiwgU0VDVE9SX1dPUkRTKTsNCisJLyoNCisJICogV0FSTklO
RyA6OiBJbnRlcnJ1cHQgY291bGQgaGFwcGVuIGluc3RhbnRseSA6LS8NCisJ
ICovDQorCXJxLT5jdXJyZW50X25yX3NlY3RvcnMtLTsNCisJaWRlX3VubWFw
X3JxKHJxLCBwQnVmLCAmZmxhZ3MpOw0KIAlyZXR1cm4gaWRlX3N0YXJ0ZWQ7
DQogfQ0KIA0KIC8qDQotICogSGFuZGxlciBmb3IgY29tbWFuZCB3aXRoIFBJ
TyBkYXRhLW91dCBwaGFzZQ0KKyAqIEhhbmRsZXIgZm9yIGNvbW1hbmQgd2l0
aCBQSU8gZGF0YS1vdXQgcGhhc2UgV1JJVEUNCisgKg0KKyAqIFdPT0hPTyB0
aGlzIGlzIGEgQ09SUkVDVCBTVEFURSBESUFHUkFNIE5PVywgPGFuZHJlQGxp
bnV4LWlkZS5vcmc+DQogICovDQogc3RhdGljIGlkZV9zdGFydHN0b3BfdCB0
YXNrX291dF9pbnRyKGlkZV9kcml2ZV90ICpkcml2ZSkNCiB7DQpAQCAtNTkz
LDE3ICs2NTksMjUgQEANCiAJY2hhciAqcEJ1ZgkJPSBOVUxMOw0KIAl1bnNp
Z25lZCBsb25nIGZsYWdzOw0KIA0KLQlpZiAoIU9LX1NUQVQoc3RhdCxEUklW
RV9SRUFEWSxkcml2ZS0+YmFkX3dzdGF0KSkNCisJaWYgKCFPS19TVEFUKHN0
YXQsRFJJVkVfUkVBRFksZHJpdmUtPmJhZF93c3RhdCkpIHsNCisJCURURigi
JXM6IFdSSVRFIGF0dGVtcHRpbmcgdG8gcmVjb3ZlciBsYXN0ICIgXA0KKwkJ
CSJzZWN0b3IgY291bnRlciBzdGF0dXM9MHglMDJ4XG4iLA0KKwkJCWRyaXZl
LT5uYW1lLCBzdGF0KTsNCisJCXJxLT5jdXJyZW50X25yX3NlY3RvcnMrKzsN
CiAJCXJldHVybiBpZGVfZXJyb3IoZHJpdmUsICJ0YXNrX291dF9pbnRyIiwg
c3RhdCk7DQotDQorCX0NCisJLyoNCisJICogU2FmZSB0byB1cGRhdGUgcmVx
dWVzdCBmb3IgcGFydGlhbCBjb21wbGV0aW9ucy4NCisJICogV2UgaGF2ZSBh
IGdvb2QgU1RBVFVTIENIRUNLISEhDQorCSAqLw0KIAlpZiAoIXJxLT5jdXJy
ZW50X25yX3NlY3RvcnMpDQogCQlpZiAoIWlkZV9lbmRfcmVxdWVzdChkcml2
ZSwgMSkpDQogCQkJcmV0dXJuIGlkZV9zdG9wcGVkOw0KLQ0KIAlpZiAoKHJx
LT5jdXJyZW50X25yX3NlY3RvcnM9PTEpIF4gKHN0YXQgJiBEUlFfU1RBVCkp
IHsNCiAJCXJxID0gSFdHUk9VUChkcml2ZSktPnJxOw0KIAkJcEJ1ZiA9IGlk
ZV9tYXBfcnEocnEsICZmbGFncyk7DQotCQlEVEYoIndyaXRlOiAlcCwgcnEt
PmN1cnJlbnRfbnJfc2VjdG9yczogJWRcbiIsIHBCdWYsIChpbnQpIHJxLT5j
dXJyZW50X25yX3NlY3RvcnMpOw0KKwkJRFRGKCJ3cml0ZTogJXAsIHJxLT5j
dXJyZW50X25yX3NlY3RvcnM6ICVkXG4iLA0KKwkJCXBCdWYsIChpbnQpIHJx
LT5jdXJyZW50X25yX3NlY3RvcnMpOw0KIAkJZHJpdmUtPmlvXzMyYml0ID0g
MDsNCiAJCXRhc2tmaWxlX291dHB1dF9kYXRhKGRyaXZlLCBwQnVmLCBTRUNU
T1JfV09SRFMpOw0KIAkJaWRlX3VubWFwX3JxKHJxLCBwQnVmLCAmZmxhZ3Mp
Ow0KQEAgLTYxMSwxNDUgKzY4NSw3MyBAQA0KIAkJcnEtPmVycm9ycyA9IDA7
DQogCQlycS0+Y3VycmVudF9ucl9zZWN0b3JzLS07DQogCX0NCi0NCi0JaWRl
X3NldF9oYW5kbGVyKGRyaXZlLCB0YXNrX291dF9pbnRyLCBXQUlUX0NNRCwg
TlVMTCk7DQorCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciA9PSBOVUxM
KQ0KKwkJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmdGFza19vdXRfaW50ciwg
V0FJVF9DTUQsIE5VTEwpOw0KIAlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQogfQ0K
IA0KLXN0YXRpYyBpZGVfc3RhcnRzdG9wX3QgcHJlX2Jpb19vdXRfaW50cihp
ZGVfZHJpdmVfdCAqZHJpdmUsIHN0cnVjdCByZXF1ZXN0ICpycSkNCitzdGF0
aWMgaWRlX3N0YXJ0c3RvcF90IHByZV90YXNrX211bG91dF9pbnRyKGlkZV9k
cml2ZV90ICpkcml2ZSwgc3RydWN0IHJlcXVlc3QgKnJxKQ0KIHsNCiAJaWRl
X3Rhc2tfdCAqYXJncyA9IHJxLT5zcGVjaWFsOw0KIAlpZGVfc3RhcnRzdG9w
X3Qgc3RhcnRzdG9wOw0KIA0KLQkvKg0KLQkgKiBhc3NpZ24gcHJpdmF0ZSBj
b3B5IGZvciBtdWx0aS13cml0ZQ0KLQkgKi8NCi0JbWVtY3B5KCZIV0dST1VQ
KGRyaXZlKS0+d3JxLCBycSwgc2l6ZW9mKHN0cnVjdCByZXF1ZXN0KSk7DQot
DQotCWlmIChpZGVfd2FpdF9zdGF0KCZzdGFydHN0b3AsIGRyaXZlLCBEQVRB
X1JFQURZLCBkcml2ZS0+YmFkX3dzdGF0LCBXQUlUX0RSUSkpDQorCWlmIChp
ZGVfd2FpdF9zdGF0KCZzdGFydHN0b3AsIGRyaXZlLCBEQVRBX1JFQURZLA0K
KwkJCWRyaXZlLT5iYWRfd3N0YXQsIFdBSVRfRFJRKSkgew0KKwkJcHJpbnRr
KEtFUk5fRVJSICIlczogbm8gRFJRIGFmdGVyIGlzc3VpbmcgJXNcbiIsDQor
CQkJZHJpdmUtPm5hbWUsDQorCQkJZHJpdmUtPmFkZHJlc3NpbmcgPyAiTVVM
VFdSSVRFX0VYVCIgOiAiTVVMVFdSSVRFIik7DQogCQlyZXR1cm4gc3RhcnRz
dG9wOw0KLQ0KKwl9DQorI2lmIDANCisJaWYgKHdhaXRfZm9yX3JlYWR5KGRy
aXZlLCAxMDApKQ0KKwkJQlVHKCk7DQorI2Vsc2UNCiAJYXRhX3BvbGxfZHJp
dmVfcmVhZHkoZHJpdmUpOw0KLQlyZXR1cm4gYXJncy0+aGFuZGxlcihkcml2
ZSk7DQotfQ0KLQ0KLQ0KLXN0YXRpYyBpZGVfc3RhcnRzdG9wX3QgYmlvX211
bG91dF9pbnRyIChpZGVfZHJpdmVfdCAqZHJpdmUpDQotew0KLQlieXRlIHN0
YXQJCT0gR0VUX1NUQVQoKTsNCi0JYnl0ZSBpb18zMmJpdAkJPSBkcml2ZS0+
aW9fMzJiaXQ7DQotCXN0cnVjdCByZXF1ZXN0ICpycQk9ICZIV0dST1VQKGRy
aXZlKS0+d3JxOw0KLQlpZGVfaHdncm91cF90ICpod2dyb3VwCT0gSFdHUk9V
UChkcml2ZSk7DQotCWludCBtY291bnQJCT0gZHJpdmUtPm11bHRfY291bnQ7
DQotCWlkZV9zdGFydHN0b3BfdCBzdGFydHN0b3A7DQotDQorI2VuZGlmDQog
CS8qDQotCSAqIChrcy9ocyk6IEhhbmRsZSBsYXN0IElSUSBvbiBtdWx0aS1z
ZWN0b3IgdHJhbnNmZXIsDQotCSAqIG9jY3VycyBhZnRlciBhbGwgZGF0YSB3
YXMgc2VudCBpbiB0aGlzIGNodW5rDQorCSAqIFdBUk5JTkcgOjogaWYgdGhl
IGRyaXZlIGFzIG5vdCBhY2tlZCBnb29kIHN0YXR1cyB3ZSBtYXkgbm90DQor
CSAqIG1vdmUgdGhlIERBVEEtVFJBTlNGRVIgVC1CYXIgYXMgQlNZICE9IDAu
IDxhbmRyZUBsaW51eC1pZGUub3JnPg0KIAkgKi8NCi0JaWYgKCFycS0+bnJf
c2VjdG9ycykgew0KLQkJaWYgKHN0YXQgJiAoRVJSX1NUQVR8RFJRX1NUQVQp
KSB7DQotCQkJc3RhcnRzdG9wID0gaWRlX2Vycm9yKGRyaXZlLCAiYmlvX211
bG91dF9pbnRyIiwgc3RhdCk7DQotCQkJbWVtY3B5KHJxLCBIV0dST1VQKGRy
aXZlKS0+cnEsIHNpemVvZihzdHJ1Y3QgcmVxdWVzdCkpOw0KLQkJCXJldHVy
biBzdGFydHN0b3A7DQotCQl9DQotDQotCQlfX2lkZV9lbmRfcmVxdWVzdChk
cml2ZSwgMSwgcnEtPmhhcmRfbnJfc2VjdG9ycyk7DQotCQlIV0dST1VQKGRy
aXZlKS0+d3JxLmJpbyA9IE5VTEw7DQotCQlyZXR1cm4gaWRlX3N0b3BwZWQ7
DQotCX0NCi0NCi0JaWYgKCFPS19TVEFUKHN0YXQsIERBVEFfUkVBRFksIEJB
RF9SX1NUQVQpKSB7DQotCQlpZiAoc3RhdCAmIChFUlJfU1RBVCB8IERSUV9T
VEFUKSkgew0KLQkJCXN0YXJ0c3RvcCA9IGlkZV9lcnJvcihkcml2ZSwgImJp
b19tdWxvdXRfaW50ciIsIHN0YXQpOw0KLQkJCW1lbWNweShycSwgSFdHUk9V
UChkcml2ZSktPnJxLCBzaXplb2Yoc3RydWN0IHJlcXVlc3QpKTsNCi0JCQly
ZXR1cm4gc3RhcnRzdG9wOw0KLQkJfQ0KLQ0KLQkJLyogbm8gZGF0YSB5ZXQs
IHNvIHdhaXQgZm9yIGFub3RoZXIgaW50ZXJydXB0ICovDQotCQlpZiAoaHdn
cm91cC0+aGFuZGxlciA9PSBOVUxMKQ0KLQkJCWlkZV9zZXRfaGFuZGxlcihk
cml2ZSwgYmlvX211bG91dF9pbnRyLCBXQUlUX0NNRCwgTlVMTCk7DQotDQot
CQlyZXR1cm4gaWRlX3N0YXJ0ZWQ7DQotCX0NCi0NCi0JZG8gew0KLQkJY2hh
ciAqYnVmZmVyOw0KLQkJaW50IG5zZWN0ID0gcnEtPmN1cnJlbnRfbnJfc2Vj
dG9yczsNCi0JCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQotDQotCQlpZiAobnNl
Y3QgPiBtY291bnQpDQotCQkJbnNlY3QgPSBtY291bnQ7DQotCQltY291bnQg
LT0gbnNlY3Q7DQotDQotCQlidWZmZXIgPSBiaW9fa21hcF9pcnEocnEtPmJp
bywgJmZsYWdzKSArIGlkZV9ycV9vZmZzZXQocnEpOw0KLQkJcnEtPnNlY3Rv
ciArPSBuc2VjdDsNCi0JCXJxLT5ucl9zZWN0b3JzIC09IG5zZWN0Ow0KLQkJ
cnEtPmN1cnJlbnRfbnJfc2VjdG9ycyAtPSBuc2VjdDsNCi0NCi0JCS8qIERv
IHdlIG1vdmUgdG8gdGhlIG5leHQgYmlvIGFmdGVyIHRoaXM/ICovDQotCQlp
ZiAoIXJxLT5jdXJyZW50X25yX3NlY3RvcnMpIHsNCi0JCQkvKiByZW1lbWJl
ciB0byBmaXggdGhpcyB1cCAvamVucyAqLw0KLQkJCXN0cnVjdCBiaW8gKmJp
byA9IHJxLT5iaW8tPmJpX25leHQ7DQotDQotCQkJLyogZW5kIGVhcmx5IGVh
cmx5IHdlIHJhbiBvdXQgb2YgcmVxdWVzdHMgKi8NCi0JCQlpZiAoIWJpbykg
ew0KLQkJCQltY291bnQgPSAwOw0KLQkJCX0gZWxzZSB7DQotCQkJCXJxLT5i
aW8gPSBiaW87DQotCQkJCXJxLT5jdXJyZW50X25yX3NlY3RvcnMgPSBiaW9f
aW92ZWMoYmlvKS0+YnZfbGVuID4+IDk7DQotCQkJfQ0KLQkJfQ0KLQ0KLQkJ
LyoNCi0JCSAqIE9rLCB3ZSdyZSBhbGwgc2V0dXAgZm9yIHRoZSBpbnRlcnJ1
cHQNCi0JCSAqIHJlLWVudGVyaW5nIHVzIG9uIHRoZSBsYXN0IHRyYW5zZmVy
Lg0KLQkJICovDQotCQl0YXNrZmlsZV9vdXRwdXRfZGF0YShkcml2ZSwgYnVm
ZmVyLCBuc2VjdCAqIFNFQ1RPUl9XT1JEUyk7DQotCQliaW9fa3VubWFwX2ly
cShidWZmZXIsICZmbGFncyk7DQotCX0gd2hpbGUgKG1jb3VudCk7DQotDQot
CWRyaXZlLT5pb18zMmJpdCA9IGlvXzMyYml0Ow0KLQlycS0+ZXJyb3JzID0g
MDsNCi0JaWYgKGh3Z3JvdXAtPmhhbmRsZXIgPT0gTlVMTCkNCi0JCWlkZV9z
ZXRfaGFuZGxlcihkcml2ZSwgYmlvX211bG91dF9pbnRyLCBXQUlUX0NNRCwg
TlVMTCk7DQotDQotCXJldHVybiBpZGVfc3RhcnRlZDsNCisJcmV0dXJuIGFy
Z3MtPmhhbmRsZXIoZHJpdmUpOw0KIH0NCiANCiAvKg0KICAqIEhhbmRsZXIg
Zm9yIGNvbW1hbmQgd2l0aCBSZWFkIE11bHRpcGxlDQogICovDQorLyoNCisg
KiBGSVhNRSBiZWZvcmUgMi42IC4uLiBEQVRBIGludGVncml0eSBpc3N1ZSB1
cG9uIGVycm9yLiA8YW5kcmVAbGludXgtaWRlLm9yZz4NCisgKi8NCiBzdGF0
aWMgaWRlX3N0YXJ0c3RvcF90IHRhc2tfbXVsaW5faW50cihpZGVfZHJpdmVf
dCAqZHJpdmUpDQogew0KLQl1bnNpZ25lZCBpbnQJCW1zZWN0LCBuc2VjdDsN
CiAJYnl0ZSBzdGF0CQk9IEdFVF9TVEFUKCk7DQogCWJ5dGUgaW9fMzJiaXQJ
CT0gZHJpdmUtPmlvXzMyYml0Ow0KIAlzdHJ1Y3QgcmVxdWVzdCAqcnEJPSBI
V0dST1VQKGRyaXZlKS0+cnE7DQogCWNoYXIgKnBCdWYJCT0gTlVMTDsNCisJ
dW5zaWduZWQgaW50IG1zZWN0CT0gZHJpdmUtPm11bHRfY291bnQ7DQorCXVu
c2lnbmVkIGludCBuc2VjdDsNCiAJdW5zaWduZWQgbG9uZyBmbGFnczsNCiAN
CiAJaWYgKCFPS19TVEFUKHN0YXQsREFUQV9SRUFEWSxCQURfUl9TVEFUKSkg
ew0KIAkJaWYgKHN0YXQgJiAoRVJSX1NUQVR8RFJRX1NUQVQpKSB7DQorCQkJ
cHJpbnRrKCIlczogTVVMVEktUkVBRCBhc3N1bWUgYWxsIGRhdGEgdHJhbnNm
ZXJlZCAiIFwNCisJCQkJImlzIGJhZCBzdGF0dXM9MHglMDJ4XG4iLA0KKwkJ
CQlkcml2ZS0+bmFtZSwgc3RhdCk7DQogCQkJcmV0dXJuIGlkZV9lcnJvcihk
cml2ZSwgInRhc2tfbXVsaW5faW50ciIsIHN0YXQpOw0KIAkJfQ0KIAkJLyog
bm8gZGF0YSB5ZXQsIHNvIHdhaXQgZm9yIGFub3RoZXIgaW50ZXJydXB0ICov
DQotCQlpZGVfc2V0X2hhbmRsZXIoZHJpdmUsIHRhc2tfbXVsaW5faW50ciwg
V0FJVF9DTUQsIE5VTEwpOw0KKwkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5k
bGVyID09IE5VTEwpDQorCQkJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmdGFz
a19tdWxpbl9pbnRyLCBXQUlUX0NNRCwgTlVMTCk7DQogCQlyZXR1cm4gaWRl
X3N0YXJ0ZWQ7DQogCX0NCiANCi0JLyogKGtzL2hzKTogRml4ZWQgTXVsdGkt
U2VjdG9yIHRyYW5zZmVyICovDQotCW1zZWN0ID0gZHJpdmUtPm11bHRfY291
bnQ7DQotDQogCWRvIHsNCiAJCW5zZWN0ID0gcnEtPmN1cnJlbnRfbnJfc2Vj
dG9yczsNCiAJCWlmIChuc2VjdCA+IG1zZWN0KQ0KIAkJCW5zZWN0ID0gbXNl
Y3Q7DQotDQogCQlwQnVmID0gaWRlX21hcF9ycShycSwgJmZsYWdzKTsNCi0N
Ci0JCURURigiTXVsdGlyZWFkOiAlcCwgbnNlY3Q6ICVkICwgcnEtPmN1cnJl
bnRfbnJfc2VjdG9yczogJWxkXG4iLA0KLQkJCXBCdWYsIG5zZWN0LCBycS0+
Y3VycmVudF9ucl9zZWN0b3JzKTsNCisJCURURigiTXVsdGlyZWFkOiAlcCwg
bnNlY3Q6ICVkLCBtc2VjdDogJWQsICIgXA0KKwkJCSIgcnEtPmN1cnJlbnRf
bnJfc2VjdG9yczogJWRcbiIsDQorCQkJcEJ1ZiwgbnNlY3QsIG1zZWN0LCBy
cS0+Y3VycmVudF9ucl9zZWN0b3JzKTsNCiAJCWRyaXZlLT5pb18zMmJpdCA9
IDA7DQogCQl0YXNrZmlsZV9pbnB1dF9kYXRhKGRyaXZlLCBwQnVmLCBuc2Vj
dCAqIFNFQ1RPUl9XT1JEUyk7DQogCQlpZGVfdW5tYXBfcnEocnEsIHBCdWYs
ICZmbGFncyk7DQpAQCAtNzYyLDEyICs3NjQsOCBAQA0KIAkJCQlyZXR1cm4g
aWRlX3N0b3BwZWQ7DQogCQl9DQogCX0gd2hpbGUgKG1zZWN0KTsNCi0NCi0N
Ci0JLyoNCi0JICogbW9yZSBkYXRhIGxlZnQNCi0JICovDQotCWlkZV9zZXRf
aGFuZGxlcihkcml2ZSwgdGFza19tdWxpbl9pbnRyLCBXQUlUX0NNRCwgTlVM
TCk7DQorCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciA9PSBOVUxMKQ0K
KwkJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmdGFza19tdWxpbl9pbnRyLCBX
QUlUX0NNRCwgTlVMTCk7DQogCXJldHVybiBpZGVfc3RhcnRlZDsNCiB9DQog
DQpAQCAtNzc4LDYgKzc3Niw5IEBADQogDQogCWFyZ3MtPnByZWhhbmRsZXIg
PSBOVUxMOw0KIAlhcmdzLT5oYW5kbGVyID0gTlVMTDsNCisjaWYgMA0KKwlh
cmdzLT5wb3N0aGFuZGxlciA9IE5VTEw7IC8qIHB1dCB0aGlzIGJhY2sgaW4g
b3IgQlVHUyB3aWxsIGhhcHBlbiAqLw0KKyNlbmRpZg0KIA0KIAlzd2l0Y2go
YXJncy0+dGZSZWdpc3RlcltJREVfQ09NTUFORF9PRkZTRVRdKSB7DQogCQlj
YXNlIFdJTl9JREVOVElGWToNCkBAIC04MTQsOCArODE1LDggQEANCiAJCWNh
c2UgQ0ZBX1dSSVRFX01VTFRJX1dPX0VSQVNFOg0KIAkJY2FzZSBXSU5fTVVM
VFdSSVRFOg0KIAkJY2FzZSBXSU5fTVVMVFdSSVRFX0VYVDoNCi0JCQlhcmdz
LT5wcmVoYW5kbGVyID0gcHJlX2Jpb19vdXRfaW50cjsNCi0JCQlhcmdzLT5o
YW5kbGVyID0gYmlvX211bG91dF9pbnRyOw0KKwkJCWFyZ3MtPnByZWhhbmRs
ZXIgPSBwcmVfdGFza19tdWxvdXRfaW50cjsNCisJCQlhcmdzLT5oYW5kbGVy
ID0gdGFza19tdWxvdXRfaW50cjsNCiAJCQlhcmdzLT5jb21tYW5kX3R5cGUg
PSBJREVfRFJJVkVfVEFTS19SQVdfV1JJVEU7DQogCQkJcmV0dXJuOw0KIA0K
QEAgLTEwNjMsNiArMTA2NCw5IEBADQogICoNCiAgKiBUaGUgY2FsbGVyIGhh
cyB0byBtYWtlIHN1cmUgYnVmIGlzIG5ldmVyIE5VTEwhDQogICovDQorLyoN
CisgKiBGSVhNRSBiZWZvcmUgMi42LCB0aGlzIG5lZWRzIHRvIG1hcCBpbnRv
IGF0IHRhc2tmaWxlLiA8YW5kcmVAbGludXgtaWRlLm9yZz4NCisgKi8NCiBz
dGF0aWMgaW50IGlkZV93YWl0X2NtZChpZGVfZHJpdmVfdCAqZHJpdmUsIGlu
dCBjbWQsIGludCBuc2VjdCwgaW50IGZlYXR1cmUsIGludCBzZWN0b3JzLCBi
eXRlICphcmdidWYpDQogew0KIAlzdHJ1Y3QgcmVxdWVzdCBycTsNCkBAIC0x
MDgwLDYgKzEwODQsOSBAQA0KIAlyZXR1cm4gaWRlX2RvX2RyaXZlX2NtZChk
cml2ZSwgJnJxLCBpZGVfd2FpdCk7DQogfQ0KIA0KKy8qDQorICogRklYTUUg
YmVmb3JlIDIuNiwgdGhpcyBuZWVkcyB0byBtYXAgaW50byBhdCB0YXNrZmls
ZS4gPGFuZHJlQGxpbnV4LWlkZS5vcmc+DQorICovDQogaW50IGlkZV9jbWRf
aW9jdGwoaWRlX2RyaXZlX3QgKmRyaXZlLCBzdHJ1Y3QgaW5vZGUgKmlub2Rl
LCBzdHJ1Y3QgZmlsZSAqZmlsZSwgdW5zaWduZWQgaW50IGNtZCwgdW5zaWdu
ZWQgbG9uZyBhcmcpDQogew0KIAlpbnQgZXJyID0gMDsNCkBAIC0xMTMzLDYg
KzExNDAsOSBAQA0KIAlyZXR1cm4gZXJyOw0KIH0NCiANCisvKg0KKyAqIEZJ
WE1FIGJlZm9yZSAyLjYsIHRoaXMgbmVlZHMgdG8gbWFwIGludG8gYXQgdGFz
a2ZpbGUuIDxhbmRyZUBsaW51eC1pZGUub3JnPg0KKyAqLw0KIGludCBpZGVf
dGFza19pb2N0bCAoaWRlX2RyaXZlX3QgKmRyaXZlLCBzdHJ1Y3QgaW5vZGUg
Kmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSwgdW5zaWduZWQgaW50IGNtZCwg
dW5zaWduZWQgbG9uZyBhcmcpDQogew0KIAlpbnQgZXJyID0gMDsNCmRpZmYg
LXVyTiBsaW51eC0yLjUuNy9kcml2ZXJzL2lkZS9pZGUuYyBsaW51eC0yLjUu
Ny5maXgvZHJpdmVycy9pZGUvaWRlLmMNCi0tLSBsaW51eC0yLjUuNy9kcml2
ZXJzL2lkZS9pZGUuYwlGcmkgTWFyIDIyIDAyOjU4OjAwIDIwMDINCisrKyBs
aW51eC0yLjUuNy5maXgvZHJpdmVycy9pZGUvaWRlLmMJU2F0IE1hciAyMyAw
MToyMjo0MSAyMDAyDQpAQCAtNTQ5LDYgKzU0OSw4IEBADQogCQlwcmludGso
IiVzOiBBVEFQSSByZXNldCBjb21wbGV0ZVxuIiwgZHJpdmUtPm5hbWUpOw0K
IAl9IGVsc2Ugew0KIAkJaWYgKDAgPCAoc2lnbmVkIGxvbmcpKGh3Z3JvdXAt
PnBvbGxfdGltZW91dCAtIGppZmZpZXMpKSB7DQorCQkJaWYgKEhXR1JPVVAo
ZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICov
DQorCQkJCUJVRygpOw0KIAkJCWlkZV9zZXRfaGFuZGxlciAoZHJpdmUsICZh
dGFwaV9yZXNldF9wb2xsZnVuYywgSFovMjAsIE5VTEwpOw0KIAkJCXJldHVy
biBpZGVfc3RhcnRlZDsJLyogY29udGludWUgcG9sbGluZyAqLw0KIAkJfQ0K
QEAgLTU3NCw2ICs1NzYsOCBAQA0KIA0KIAlpZiAoIU9LX1NUQVQodG1wPUdF
VF9TVEFUKCksIDAsIEJVU1lfU1RBVCkpIHsNCiAJCWlmICgwIDwgKHNpZ25l
ZCBsb25nKShod2dyb3VwLT5wb2xsX3RpbWVvdXQgLSBqaWZmaWVzKSkgew0K
KwkJCWlmIChIV0dST1VQKGRyaXZlKS0+aGFuZGxlciAhPSBOVUxMKQkvKiBw
YXJhbm9pYSBjaGVjayAqLw0KKwkJCQlCVUcoKTsNCiAJCQlpZGVfc2V0X2hh
bmRsZXIgKGRyaXZlLCAmcmVzZXRfcG9sbGZ1bmMsIEhaLzIwLCBOVUxMKTsN
CiAJCQlyZXR1cm4gaWRlX3N0YXJ0ZWQ7CS8qIGNvbnRpbnVlIHBvbGxpbmcg
Ki8NCiAJCX0NCkBAIC02NDUsNiArNjQ5LDggQEANCiAJCXVkZWxheSAoMjAp
Ow0KIAkJT1VUX0JZVEUgKFdJTl9TUlNULCBJREVfQ09NTUFORF9SRUcpOw0K
IAkJaHdncm91cC0+cG9sbF90aW1lb3V0ID0gamlmZmllcyArIFdBSVRfV09S
U1RDQVNFOw0KKwkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5V
TEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQkJQlVHKCk7DQogCQlpZGVf
c2V0X2hhbmRsZXIgKGRyaXZlLCAmYXRhcGlfcmVzZXRfcG9sbGZ1bmMsIEha
LzIwLCBOVUxMKTsNCiAJCV9fcmVzdG9yZV9mbGFncyAoZmxhZ3MpOwkvKiBs
b2NhbCBDUFUgb25seSAqLw0KIAkJcmV0dXJuIGlkZV9zdGFydGVkOw0KQEAg
LTY3OSw2ICs2ODUsOCBAQA0KIAl9DQogCXVkZWxheSgxMCk7CQkJLyogbW9y
ZSB0aGFuIGVub3VnaCB0aW1lICovDQogCWh3Z3JvdXAtPnBvbGxfdGltZW91
dCA9IGppZmZpZXMgKyBXQUlUX1dPUlNUQ0FTRTsNCisJaWYgKEhXR1JPVVAo
ZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICov
DQorCQlCVUcoKTsNCiAJaWRlX3NldF9oYW5kbGVyIChkcml2ZSwgJnJlc2V0
X3BvbGxmdW5jLCBIWi8yMCwgTlVMTCk7DQogDQogCS8qDQpAQCAtOTMzLDYg
Kzk0MSw5IEBADQogICovDQogdm9pZCBpZGVfY21kIChpZGVfZHJpdmVfdCAq
ZHJpdmUsIGJ5dGUgY21kLCBieXRlIG5zZWN0LCBpZGVfaGFuZGxlcl90ICpo
YW5kbGVyKQ0KIHsNCisJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9
IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQlCVUcoKTsNCisNCiAJ
aWRlX3NldF9oYW5kbGVyIChkcml2ZSwgaGFuZGxlciwgV0FJVF9DTUQsIE5V
TEwpOw0KIAlpZiAoSURFX0NPTlRST0xfUkVHKQ0KIAkJT1VUX0JZVEUoZHJp
dmUtPmN0bCxJREVfQ09OVFJPTF9SRUcpOwkvKiBjbGVhciBuSUVOICovDQpk
aWZmIC11ck4gbGludXgtMi41LjcvZHJpdmVycy9pZGUvcGRjNDAzMC5jIGxp
bnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS9wZGM0MDMwLmMNCi0tLSBsaW51
eC0yLjUuNy9kcml2ZXJzL2lkZS9wZGM0MDMwLmMJRnJpIE1hciAyMiAwMjo1
ODowMCAyMDAyDQorKysgbGludXgtMi41LjcuZml4L2RyaXZlcnMvaWRlL3Bk
YzQwMzAuYwlTYXQgTWFyIDIzIDAxOjI4OjQxIDIwMDINCkBAIC0zOTQsNiAr
Mzk0LDkgQEANCiANCiAJaWYgKEdFVF9TVEFUKCkgJiBCVVNZX1NUQVQpIHsN
CiAJCWlmICh0aW1lX2JlZm9yZShqaWZmaWVzLCBod2dyb3VwLT5wb2xsX3Rp
bWVvdXQpKSB7DQorDQorCQkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVy
ICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQkJCUJVRygpOw0K
IAkJCWlkZV9zZXRfaGFuZGxlcihkcml2ZSwgJnByb21pc2VfY29tcGxldGVf
cG9sbGZ1bmMsIEhaLzEwMCwgTlVMTCk7DQogCQkJcmV0dXJuIGlkZV9zdGFy
dGVkOyAvKiBjb250aW51ZSBwb2xsaW5nLi4uICovDQogCQl9DQpAQCAtNDc2
LDYgKzQ3OSw3IEBADQogDQogCWlmIChJTl9CWVRFKElERV9OU0VDVE9SX1JF
RykgIT0gMCkgew0KIAkJaWYgKHRpbWVfYmVmb3JlKGppZmZpZXMsIGh3Z3Jv
dXAtPnBvbGxfdGltZW91dCkpIHsNCisJCQlpZiAoSFdHUk9VUChkcml2ZSkt
PmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5vaWEgY2hlY2sgKi8JCQkJQlVH
KCk7DQogCQkJaWRlX3NldF9oYW5kbGVyIChkcml2ZSwgJnByb21pc2Vfd3Jp
dGVfcG9sbGZ1bmMsIEhaLzEwMCwgTlVMTCk7DQogCQkJcmV0dXJuIGlkZV9z
dGFydGVkOyAvKiBjb250aW51ZSBwb2xsaW5nLi4uICovDQogCQl9DQpAQCAt
NDg5LDYgKzQ5Myw4IEBADQogCSAqLw0KIAlwcm9taXNlX211bHR3cml0ZShk
cml2ZSwgNCk7DQogCWh3Z3JvdXAtPnBvbGxfdGltZW91dCA9IGppZmZpZXMg
KyBXQUlUX1dPUlNUQ0FTRTsNCisJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5k
bGVyICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQlCVUcoKTsN
CiAJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmcHJvbWlzZV9jb21wbGV0ZV9w
b2xsZnVuYywgSFovMTAwLCBOVUxMKTsNCiAjaWZkZWYgREVCVUdfV1JJVEUN
CiAJcHJpbnRrKEtFUk5fREVCVUcgIiVzOiBEb25lIGxhc3QgNCBzZWN0b3Jz
IC0gc3RhdHVzID0gJTAyeFxuIiwNCkBAIC01MjMsNiArNTI5LDggQEANCiAJ
CWlmIChwcm9taXNlX211bHR3cml0ZShkcml2ZSwgcnEtPm5yX3NlY3RvcnMg
LSA0KSkNCiAJCQlyZXR1cm4gaWRlX3N0b3BwZWQ7DQogCQlod2dyb3VwLT5w
b2xsX3RpbWVvdXQgPSBqaWZmaWVzICsgV0FJVF9XT1JTVENBU0U7DQorCQlp
ZiAoSFdHUk9VUChkcml2ZSktPmhhbmRsZXIgIT0gTlVMTCkJLyogcGFyYW5v
aWEgY2hlY2sgKi8NCisJCQlCVUcoKTsNCiAJCWlkZV9zZXRfaGFuZGxlciAo
ZHJpdmUsICZwcm9taXNlX3dyaXRlX3BvbGxmdW5jLCBIWi8xMDAsIE5VTEwp
Ow0KIAkJcmV0dXJuIGlkZV9zdGFydGVkOw0KIAl9IGVsc2Ugew0KQEAgLTUz
Myw2ICs1NDEsOCBAQA0KIAkJaWYgKHByb21pc2VfbXVsdHdyaXRlKGRyaXZl
LCBycS0+bnJfc2VjdG9ycykpDQogCQkJcmV0dXJuIGlkZV9zdG9wcGVkOw0K
IAkJaHdncm91cC0+cG9sbF90aW1lb3V0ID0gamlmZmllcyArIFdBSVRfV09S
U1RDQVNFOw0KKwkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVyICE9IE5V
TEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQkJQlVHKCk7DQogCQlpZGVf
c2V0X2hhbmRsZXIoZHJpdmUsICZwcm9taXNlX2NvbXBsZXRlX3BvbGxmdW5j
LCBIWi8xMDAsIE5VTEwpOw0KICNpZmRlZiBERUJVR19XUklURQ0KIAkJcHJp
bnRrKEtFUk5fREVCVUcgIiVzOiBwcm9taXNlX3dyaXRlOiA8PSA0IHNlY3Rv
cnMsICINCkBAIC01NTQsNiArNTY0LDEzIEBADQogCXVuc2lnbmVkIGxvbmcg
dGltZW91dDsNCiAJYnl0ZSBzdGF0Ow0KIA0KKwkvKiBDaGVjayB0aGF0IGl0
J3MgYSByZWd1bGFyIGNvbW1hbmQuIElmIG5vdCwgYm9tYiBvdXQgZWFybHku
ICovDQorCWlmICghKHJxLT5mbGFncyAmIFJFUV9DTUQpKSB7DQorCQlibGtf
ZHVtcF9ycV9mbGFncyhycSwgInBkYzQwMzAgYmFkIGZsYWdzIik7DQorCQlp
ZGVfZW5kX3JlcXVlc3QoZHJpdmUsIDApOw0KKwkJcmV0dXJuIGlkZV9zdG9w
cGVkOw0KKwl9DQorDQogCWlmIChJREVfQ09OVFJPTF9SRUcpDQogCQlPVVRf
QllURShkcml2ZS0+Y3RsLCBJREVfQ09OVFJPTF9SRUcpOyAgLyogY2xlYXIg
bklFTiAqLw0KIAlTRUxFQ1RfTUFTSyhIV0lGKGRyaXZlKSwgZHJpdmUsIDAp
Ow0KQEAgLTU2OCwxNiArNTg1LDggQEANCiAJT1VUX0JZVEUodGFza2ZpbGUt
PmRldmljZV9oZWFkLCBJREVfU0VMRUNUX1JFRyk7DQogCU9VVF9CWVRFKHRh
c2tmaWxlLT5jb21tYW5kLCBJREVfQ09NTUFORF9SRUcpOw0KIA0KLS8qIENo
ZWNrIHRoYXQgaXQncyBhIHJlZ3VsYXIgY29tbWFuZC4gSWYgbm90LCBib21i
IG91dCBlYXJseS4gKi8NCi0JaWYgKCEocnEtPmZsYWdzICYgUkVRX0NNRCkp
IHsNCi0JCWJsa19kdW1wX3JxX2ZsYWdzKHJxLCAicGRjNDAzMCBiYWQgZmxh
Z3MiKTsNCi0JCWlkZV9lbmRfcmVxdWVzdChkcml2ZSwgMCk7DQotCQlyZXR1
cm4gaWRlX3N0b3BwZWQ7DQotCX0NCi0NCiAJc3dpdGNoIChycV9kYXRhX2Rp
cihycSkpIHsNCiAJY2FzZSBSRUFEOg0KLQkJT1VUX0JZVEUoUFJPTUlTRV9S
RUFELCBJREVfQ09NTUFORF9SRUcpOw0KIC8qDQogICogVGhlIGNhcmQncyBi
ZWhhdmlvdXIgaXMgb2RkIGF0IHRoaXMgcG9pbnQuIElmIHRoZSBkYXRhIGlz
DQogICogYXZhaWxhYmxlLCBEUlEgd2lsbCBiZSB0cnVlLCBhbmQgbm8gaW50
ZXJydXB0IHdpbGwgYmUNCkBAIC02MDAsNiArNjA5LDggQEANCiAJCQkJcHJp
bnRrKEtFUk5fREVCVUcgIiVzOiByZWFkOiB3YWl0aW5nIGZvciAiDQogCQkJ
CSAgICAgICAgICAgICAgICAgICJpbnRlcnJ1cHRcbiIsIGRyaXZlLT5uYW1l
KTsNCiAjZW5kaWYNCisJCQkJaWYgKEhXR1JPVVAoZHJpdmUpLT5oYW5kbGVy
ICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICovDQorCQkJCQlCVUcoKTsN
CiAJCQkJaWRlX3NldF9oYW5kbGVyKGRyaXZlLCAmcHJvbWlzZV9yZWFkX2lu
dHIsIFdBSVRfQ01ELCBOVUxMKTsNCiAJCQkJcmV0dXJuIGlkZV9zdGFydGVk
Ow0KIAkJCX0NCkBAIC02MTIsNyArNjIzLDYgQEANCiANCiAJY2FzZSBXUklU
RTogew0KIAkJaWRlX3N0YXJ0c3RvcF90IHN0YXJ0c3RvcDsNCi0JCU9VVF9C
WVRFKFBST01JU0VfV1JJVEUsIElERV9DT01NQU5EX1JFRyk7DQogLyoNCiAg
KiBTdHJhdGVneSBvbiB3cml0ZSBpczoNCiAgKglsb29rIGZvciB0aGUgRFJR
IHRoYXQgc2hvdWxkIGhhdmUgYmVlbiBpbW1lZGlhdGVseSBhc3NlcnRlZA0K
ZGlmZiAtdXJOIGxpbnV4LTIuNS43L2RyaXZlcnMvaWRlL3RybTI5MC5jIGxp
bnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS90cm0yOTAuYw0KLS0tIGxpbnV4
LTIuNS43L2RyaXZlcnMvaWRlL3RybTI5MC5jCVRodSBNYXIgIDcgMTg6MTg6
MTYgMjAwMg0KKysrIGxpbnV4LTIuNS43LmZpeC9kcml2ZXJzL2lkZS90cm0y
OTAuYwlTYXQgTWFyIDIzIDAxOjI5OjI5IDIwMDINCkBAIC0xOTQsNiArMTk0
LDggQEANCiAJCQlvdXR3KChjb3VudCAqIDIpIC0gMSwgaHdpZi0+ZG1hX2Jh
c2UrMik7IC8qIHN0YXJ0IERNQSAqLw0KIAkJCWlmIChkcml2ZS0+dHlwZSAh
PSBBVEFfRElTSykNCiAJCQkJcmV0dXJuIDA7DQorCQkJaWYgKEhXR1JPVVAo
ZHJpdmUpLT5oYW5kbGVyICE9IE5VTEwpCS8qIHBhcmFub2lhIGNoZWNrICov
DQorCQkJCUJVRygpOw0KIAkJCWlkZV9zZXRfaGFuZGxlcihkcml2ZSwgJmlk
ZV9kbWFfaW50ciwgV0FJVF9DTUQsIE5VTEwpOw0KIAkJCU9VVF9CWVRFKHJl
YWRpbmcgPyBXSU5fUkVBRERNQSA6IFdJTl9XUklURURNQSwgSURFX0NPTU1B
TkRfUkVHKTsNCiAJCQlyZXR1cm4gMDsNCg==
--1430322656-215002990-1016924038=:1053--
