Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1751545AbWIZPsp@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1751545AbWIZPsp (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 26 Sep 2006 11:48:45 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1751548AbWIZPsp
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 26 Sep 2006 11:48:45 -0400
Received: from mx2.suse.de ([195.135.220.15]:17073 "EHLO mx2.suse.de")
	by vger.kernel.org with ESMTP id S1751544AbWIZPso (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Tue, 26 Sep 2006 11:48:44 -0400
Date: Tue, 26 Sep 2006 17:48:33 +0200
Message-ID: <s5hy7s6r5m6.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Randy Dunlap <rdunlap@xenotime.net>
Cc: Jeremy Fitzhardinge <jeremy@goop.org>, Pavel Machek <pavel@suse.cz>,
       Linux Kernel Mailing List <linux-kernel@vger.kernel.org>,
       alsa-devel@alsa-project.org, Andrew Morton <akpm@osdl.org>
Subject: Re: 2.6.18: hda_intel: azx_get_response timeout, switching to single_cmd mode...
In-Reply-To: <20060926083720.da9dca8e.rdunlap@xenotime.net>
References: <451834D0.40304@goop.org>
	<s5hlko7szjy.wl%tiwai@suse.de>
	<20060926083720.da9dca8e.rdunlap@xenotime.net>
User-Agent: Wanderlust/2.12.0 (Your Wildest Dreams) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.7 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 MULE XEmacs/21.5 (beta25)
 (eggplant) (+CVS-20060326) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Tue, 26 Sep 2006 08:37:20 -0700,
Randy Dunlap wrote:
> 
> On Tue, 26 Sep 2006 12:16:33 +0200 Takashi Iwai wrote:
> 
> > At Mon, 25 Sep 2006 12:58:08 -0700,
> > Jeremy Fitzhardinge wrote:
> > > 
> > > I have a ThinkPad X60 which uses the Intel 82801G HDA audio chip.  This 
> > > used to work for me, but lately (sometime during 2.6.18-rcX series) it 
> > > stopped working - programs trying to use it tend to just block forever 
> > > waiting for /dev/dsp.
> > > 
> > > The only obvious symptom is:
> > > 
> > >     hda_intel: azx_get_response timeout, switching to single_cmd mode...
> > > 
> > > appearing in the kernel log when booting.
> > > 
> > 
> > There is no big change relevant to TP X60 during 2.6.18rc, so I don't
> > think it's a regression in the hd-audio driver code.
> > 
> > > Details attached.  The dmesg output is for the FC6 distro kernel 
> > > 2.6.18-1.2689.fc6PAE, but I see the same symptoms with 2.6.18-mm1.
> > 
> > You must see difference with mm1 (suppose that mm1 already includes
> > the latest ALSA patches).  When the CORB/RIRB interrupt gets broken,
> > the driver first switches to poling mode, then single_cmd mode as
> > fallback.
> > 
> > Also, try disable_msi=1 option for mm1.  MSI seems broken on some
> > systems.
> 
> is that "pci=nomsi" ?

No, snd-hda-intel driver has a new module option "disable_msi" to
disable MSI support on that driver.  As default, it's off, i.e. MSI is
enabled if available.  (Well, I feel it's better to rename it
enable_msi and set on as default...)

Sorry for unclear text.


Takashi
