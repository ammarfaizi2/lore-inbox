Return-Path: <linux-kernel-owner+willy=40w.ods.org-S261674AbVDCLfE@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261674AbVDCLfE (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 3 Apr 2005 07:35:04 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261682AbVDCLfE
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 3 Apr 2005 07:35:04 -0400
Received: from omx3-ext.sgi.com ([192.48.171.20]:28127 "EHLO omx3.sgi.com")
	by vger.kernel.org with ESMTP id S261674AbVDCLet (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 3 Apr 2005 07:34:49 -0400
Date: Sun, 3 Apr 2005 04:34:20 -0700
From: Paul Jackson <pj@engr.sgi.com>
To: Ingo Molnar <mingo@elte.hu>
Cc: kenneth.w.chen@intel.com, torvalds@osdl.org, nickpiggin@yahoo.com.au,
       akpm@osdl.org, linux-kernel@vger.kernel.org
Subject: Re: [patch] sched: auto-tune migration costs [was: Re: Industry db
 benchmark result on recent 2.6 kernels]
Message-Id: <20050403043420.212290a8.pj@engr.sgi.com>
In-Reply-To: <20050403070415.GA18893@elte.hu>
References: <200504020100.j3210fg04870@unix-os.sc.intel.com>
	<20050402145351.GA11601@elte.hu>
	<20050402215332.79ff56cc.pj@engr.sgi.com>
	<20050403070415.GA18893@elte.hu>
Organization: SGI
X-Mailer: Sylpheed version 1.0.0 (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Ok - that flies, or at least walks.  It took 53 seconds to
compute this cost matrix.

Here's what it prints, on a small 8 CPU ia64 SN2 Altix, with
the migration_debug prints formatted separately from the primary
table, for ease of reading:

Total of 8 processors activated (15548.60 BogoMIPS).
---------------------
migration cost matrix (max_cache_size: 0, cpu: -1 MHz):
---------------------
          [00]    [01]    [02]    [03]    [04]    [05]    [06]    [07]
[00]:     -     4.0(0) 21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1)
[01]:   4.0(0)    -    21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1)
[02]:  21.7(1) 21.7(1)    -     4.0(0) 21.7(1) 21.7(1) 21.7(1) 21.7(1)
[03]:  21.7(1) 21.7(1)  4.0(0)    -    21.7(1) 21.7(1) 21.7(1) 21.7(1)
[04]:  21.7(1) 21.7(1) 21.7(1) 21.7(1)    -     4.0(0) 21.7(1) 21.7(1)
[05]:  21.7(1) 21.7(1) 21.7(1) 21.7(1)  4.0(0)    -    21.7(1) 21.7(1)
[06]:  21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1)    -     4.0(0)
[07]:  21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1) 21.7(1)  4.0(0)    -
---------------------
cacheflush times [2]: 4.0 (4059264) 21.7 (21764604)
---------------------

-> [0][1][10485760]   0.0 (0): (236441590 260844347 -24402757)
-> [0][1][9961472]   0.0 (0): (223517112 247446351 -23929239)
-> [0][1][9463398]   0.0 (0): (210676318 234128642 -23452324)
-> [0][1][8990228]   0.0 (0): (199150391 222962366 -23811975)
-> [0][1][8540716]   0.0 (0): (188000682 211792893 -23792211)
-> [0][1][8113680]   0.0 (0): (177705384 201661649 -23956265)
-> [0][1][7707996]   0.0 (0): (167300335 190993072 -23692737)
-> [0][1][7322596]   0.0 (0): (157792762 181764189 -23971427)
-> [0][1][6956466]   0.0 (0): (148554966 172428430 -23873464)
-> [0][1][6608642]   0.0 (0): (140208195 163875201 -23667006)
-> [0][1][6278209]   0.0 (0): (131352820 155083956 -23731136)
-> [0][1][5964298]   0.0 (0): (123604215 147567322 -23963107)
-> [0][1][5666083]   0.0 (0): (116411565 140028494 -23616929)
-> [0][1][5382778]   0.0 (0): (109268755 133013626 -23744871)
-> [0][1][5113639]   0.0 (0): (102398180 126017425 -23619245)
-> [0][1][4857957]   0.0 (0): (95917364 119835534 -23918170)
-> [0][1][4615059]   0.0 (0): (90016707 114103575 -24086868)
-> [0][1][4384306]   0.0 (0): (84323765 108006547 -23682782)
-> [0][1][4165090]   0.0 (0): (79059754 102627005 -23567251)
-> [0][1][3956835]   0.0 (0): (73688423 97291492 -23603069)
-> [0][1][3758993]   0.0 (0): (68716008 88560989 -19844981)
-> [0][1][3571043]   0.0 (0): (63733160 81897350 -18164190)
-> [0][1][3392490]   0.0 (0): (59879383 74232277 -14352894)
-> [0][1][3222865]   0.0 (0): (56841544 66555118 -9713574)
-> [0][1][3061721]   0.0 (0): (52946522 56831787 -3885265)
-> [0][1][2908634]   2.1 (0): (48782033 46610015  2172018)
-> [0][1][2763202]   7.4 (0): (45641483 38180422  7461061)
-> [0][1][2625041]   8.1 (0): (42666487 34547956  8118531)
-> [0][1][2493788]   8.1 (0): (40480659 32408260  8072399)
-> [0][1][2369098]   8.1 (0): (37962874 30163246  7799628)
-> [0][1][2250643]   8.1 (0): (34472406 26857206  7615200)
-> [0][1][2138110]   8.1 (0): (31271314 23649223  7622091)
-> [0][1][2031204]   8.1 (0): (28089754 21439413  6650341)
-> [0][1][1929643]   8.1 (0): (26354009 18543359  7810650)
-> [0][1][1833160]   8.1 (0): (21147235 14447434  6699801)
-> [0][1][1741502]   8.1 (0): (18121355 12206595  5914760)
-> [0][1][1654426]   8.1 (0): (15329605 10598656  4730949)
-> [0][1][1571704]   8.1 (0): (13611633  8689517  4922116)
-> [0][1][1493118]   8.1 (0): (11372044  6757841  4614203)
-> [0][1][1418462]   8.1 (0): ( 9444150  4882452  4561698)
-> [0][1][1347538]   8.1 (0): ( 8191406  4085242  4106164)
-> [0][1][1280161]   8.1 (0): ( 7790609  3898213  3892396)
-> [0][1][1216152]   8.1 (0): ( 7374407  3707184  3667223)
-> [0][1][1155344]   8.1 (0): ( 6999015  3515903  3483112)
-> [0][1][1097576]   8.1 (0): ( 6673248  3322754  3350494)
-> [0][1][1042697]   8.1 (0): ( 6335524  3161843  3173681)
-> [0][1][ 990562]   8.1 (0): ( 6004402  3008483  2995919)
-> [0][1][ 941033]   8.1 (0): ( 5725906  2863829  2862077)
-> [0][1][ 893981]   8.1 (0): ( 5426110  2734901  2691209)
-> [0][1][ 849281]   8.1 (0): ( 5140906  2596169  2544737)
-> [0][1][ 806816]   8.1 (0): ( 4898502  2465125  2433377)
-> [0][1][ 766475]   8.1 (0): ( 4649361  2349720  2299641)
-> [0][1][ 728151]   8.1 (0): ( 4427640  2224358  2203282)
-> [0][1][ 691743]   8.1 (0): ( 4205722  2113134  2092588)
-> [0][1][ 657155]   8.1 (0): ( 3991213  1997003  1994210)
-> [0][1][ 624297]   8.1 (0): ( 3808184  1922251  1885933)
-> [0][1][ 593082]   8.1 (0): ( 3637960  1824619  1813341)
-> [0][1][ 563427]   8.1 (0): ( 3436507  1717571  1718936)
-> [0][1][ 535255]   8.1 (0): ( 3258815  1638947  1619868)
-> [0][1][ 508492]   8.1 (0): ( 3107777  1554970  1552807)
-> [0][1][ 483067]   8.1 (0): ( 2947291  1476728  1470563)
-> [0][1][ 458913]   8.1 (0): ( 2791433  1408435  1382998)
-> [0][1][ 435967]   8.1 (0): ( 2652944  1322870  1330074)
-> [0][1][ 414168]   8.1 (0): ( 2535588  1270619  1264969)
-> [0][1][ 393459]   8.1 (0): ( 2412219  1213071  1199148)
-> [0][1][ 373786]   8.1 (0): ( 2282233  1141089  1141144)
-> [0][1][ 355096]   8.1 (0): ( 2177739  1084862  1092877)
-> [0][1][ 337341]   8.1 (0): ( 2072370  1027962  1044408)
-> [0][1][ 320473]   8.1 (0): ( 1968254   992712   975542)
-> [0][1][ 304449]   8.1 (0): ( 1869227   934710   934517)
-> [0][1][ 289226]   8.1 (0): ( 1787025   882591   904434)
-> [0][1][ 274764]   8.1 (0): ( 1685326   834412   850914)
-> [0][1][ 261025]   8.1 (0): ( 1599396   784748   814648)
-> [0][1][ 247973]   8.1 (0): ( 1520534   752650   767884)
-> [0][1][ 235574]   8.1 (0): ( 1447687   697913   749774)
-> [0][1][ 223795]   8.1 (0): ( 1395297   655215   740082)
-> [0][1][ 212605]   8.1 (0): ( 1304578   612879   691699)
-> [0][1][ 201974]   8.1 (0): ( 1242526   582890   659636)
-> [0][1][ 191875]   8.1 (0): ( 1192597   567342   625255)
-> [0][1][ 182281]   8.1 (0): ( 1154183   522506   631677)
-> [0][1][ 173166]   8.1 (0): ( 1063889   496038   567851)
-> [0][1][ 164507]   8.1 (0): ( 1018003   479707   538296)
-> [0][1][ 156281]   8.1 (0): (  966639   453335   513304)
-> [0][1][ 148466]   8.1 (0): (  911832   450767   461065)
-> [0][1][ 141042]   8.1 (0): (  861256   398012   463244)
-> [0][1][ 133989]   8.1 (0): (  816934   375902   441032)
-> [0][1][ 127289]   8.1 (0): (  772519   357192   415327)
-> [0][1][ 120924]   8.1 (0): (  738252   348262   389990)
-> [0][1][ 114877]   8.1 (0): (  700449   337719   362730)
-> [0][1][ 109133]   8.1 (0): (  666714   321362   345352)
-> [0][1][ 103676]   8.1 (0): (  632466   301106   331360)
-> [0][1][  98492]   8.1 (0): (  605840   283103   322737)
-> [0][1][  93567]   8.1 (0): (  574951   270209   304742)
-> [0][1][  88888]   8.1 (0): (  548250   275193   273057)
-> [0][1][  84443]   8.1 (0): (  520930   247909   273021)
-> [0][1][  80220]   8.1 (0): (  497343   235625   261718)
-> [0][1][  76209]   8.1 (0): (  475014   225910   249104)
-> [0][1][  72398]   8.1 (0): (  452979   217067   235912)
-> [0][1][  68778]   8.1 (0): (  437237   210221   227016)
[0][1] cache size found: 68778, cost: 2029632
-> [0][2][10485760]  21.3 (1): (280966301 259655197 21311104)
-> [0][2][9961472]  21.3 (1): (267532701 246464370 21068331)
-> [0][2][9463398]  21.4 (1): (255880339 234472901 21407438)
-> [0][2][8990228]  21.4 (1): (243788056 222976517 20811539)
-> [0][2][8540716]  21.4 (1): (232918189 211696038 21222151)
-> [0][2][8113680]  21.4 (1): (221867712 201185104 20682608)
-> [0][2][7707996]  21.4 (1): (211791934 190954096 20837838)
-> [0][2][7322596]  21.4 (1): (202147650 181014688 21132962)
-> [0][2][6956466]  21.4 (1): (193033236 172217232 20816004)
-> [0][2][6608642]  21.4 (1): (184315412 163326007 20989405)
-> [0][2][6278209]  21.5 (1): (176305487 154773881 21531606)
-> [0][2][5964298]  21.5 (1): (168324309 147210017 21114292)
-> [0][2][5666083]  21.5 (1): (160980756 140036947 20943809)
-> [0][2][5382778]  21.5 (1): (154082090 133018746 21063344)
-> [0][2][5113639]  21.5 (1): (147265497 125683900 21581597)
-> [0][2][4857957]  21.5 (1): (140785593 119757775 21027818)
-> [0][2][4615059]  21.5 (1): (134874499 113951649 20922850)
-> [0][2][4384306]  21.5 (1): (128926147 107954231 20971916)
-> [0][2][4165090]  21.5 (1): (123503066 102480419 21022647)
-> [0][2][3956835]  21.5 (1): (118671392 97407382 21264010)
-> [0][2][3758993]  24.6 (1): (113654772 89043284 24611488)
-> [0][2][3571043]  28.4 (1): (108688391 80283321 28405070)
-> [0][2][3392490]  30.8 (1): (103382097 72550143 30831954)
-> [0][2][3222865]  31.6 (1): (98813621 67206209 31607412)
-> [0][2][3061721]  34.6 (1): (94028301 59338910 34689391)
-> [0][2][2908634]  37.4 (1): (89336206 51906192 37430014)
-> [0][2][2763202]  41.6 (1): (85311763 43645210 41666553)
-> [0][2][2625041]  42.9 (1): (80967888 38067729 42900159)
-> [0][2][2493788]  43.5 (1): (76682195 33152985 43529210)
-> [0][2][2369098]  43.5 (1): (71641348 29795784 41845564)
-> [0][2][2250643]  43.5 (1): (67010318 26541156 40469162)
-> [0][2][2138110]  43.5 (1): (61116015 23104539 38011476)
-> [0][2][2031204]  43.5 (1): (56833321 20862067 35971254)
-> [0][2][1929643]  43.5 (1): (51867693 18230427 33637266)
-> [0][2][1833160]  43.5 (1): (47463072 14447831 33015241)
-> [0][2][1741502]  43.5 (1): (43341579 11804071 31537508)
-> [0][2][1654426]  43.5 (1): (39128869 10120316 29008553)
-> [0][2][1571704]  43.5 (1): (37112854  8701340 28411514)
-> [0][2][1493118]  43.5 (1): (33762646  6895300 26867346)
-> [0][2][1418462]  43.5 (1): (30140145  5233522 24906623)
-> [0][2][1347538]  43.5 (1): (28104612  4404674 23699938)
-> [0][2][1280161]  43.5 (1): (26384793  4142184 22242609)
-> [0][2][1216152]  43.5 (1): (24998530  3738080 21260450)
-> [0][2][1155344]  43.5 (1): (23692228  3530175 20162053)
-> [0][2][1097576]  43.5 (1): (22609076  3339587 19269489)
-> [0][2][1042697]  43.5 (1): (21418282  3178330 18239952)
-> [0][2][ 990562]  43.5 (1): (20406158  3017420 17388738)
-> [0][2][ 941033]  43.5 (1): (19348908  2870304 16478604)
-> [0][2][ 893981]  43.5 (1): (18374639  2739213 15635426)
-> [0][2][ 849281]  43.5 (1): (17423103  2600269 14822834)
-> [0][2][ 806816]  43.5 (1): (16663412  2478036 14185376)
-> [0][2][ 766475]  43.5 (1): (15709827  2350116 13359711)
-> [0][2][ 728151]  43.5 (1): (15008379  2220979 12787400)
-> [0][2][ 691743]  43.5 (1): (14214646  2113246 12101400)
-> [0][2][ 657155]  43.5 (1): (13507218  2012407 11494811)
-> [0][2][ 624297]  43.5 (1): (12850596  1932937 10917659)
-> [0][2][ 593082]  43.5 (1): (12249394  1822902 10426492)
-> [0][2][ 563427]  43.5 (1): (11575604  1741807  9833797)
-> [0][2][ 535255]  43.5 (1): (11013846  1659054  9354792)
-> [0][2][ 508492]  43.5 (1): (10406034  1583114  8822920)
-> [0][2][ 483067]  43.5 (1): ( 9991526  1487716  8503810)
-> [0][2][ 458913]  43.5 (1): ( 9424050  1411217  8012833)
-> [0][2][ 435967]  43.5 (1): ( 8969577  1341693  7627884)
-> [0][2][ 414168]  43.5 (1): ( 8619883  1265423  7354460)
-> [0][2][ 393459]  43.5 (1): ( 8172469  1215225  6957244)
-> [0][2][ 373786]  43.5 (1): ( 7693509  1156090  6537419)
-> [0][2][ 355096]  43.5 (1): ( 7321746  1096988  6224758)
-> [0][2][ 337341]  43.5 (1): ( 6996736  1048745  5947991)
-> [0][2][ 320473]  43.5 (1): ( 6567567  1000294  5567273)
-> [0][2][ 304449]  43.5 (1): ( 6243750   936678  5307072)
-> [0][2][ 289226]  43.5 (1): ( 5979868   896936  5082932)
-> [0][2][ 274764]  43.5 (1): ( 5738336   843368  4894968)
-> [0][2][ 261025]  43.5 (1): ( 5365096   791876  4573220)
-> [0][2][ 247973]  43.5 (1): ( 5059736   743485  4316251)
-> [0][2][ 235574]  43.5 (1): ( 4831530   699291  4132239)
-> [0][2][ 223795]  43.5 (1): ( 4638916   680192  3958724)
-> [0][2][ 212605]  43.5 (1): ( 4481601   637145  3844456)
-> [0][2][ 201974]  43.5 (1): ( 4191611   592293  3599318)
-> [0][2][ 191875]  43.5 (1): ( 3949722   570027  3379695)
-> [0][2][ 182281]  43.5 (1): ( 3726611   537697  3188914)
-> [0][2][ 173166]  43.5 (1): ( 3592882   515552  3077330)
-> [0][2][ 164507]  43.5 (1): ( 3390972   484264  2906708)
-> [0][2][ 156281]  43.5 (1): ( 3245101   459775  2785326)
-> [0][2][ 148466]  43.5 (1): ( 3113578   440451  2673127)
-> [0][2][ 141042]  43.5 (1): ( 2931948   409050  2522898)
-> [0][2][ 133989]  43.5 (1): ( 2808474   388318  2420156)
-> [0][2][ 127289]  43.5 (1): ( 2605945   368634  2237311)
-> [0][2][ 120924]  43.5 (1): ( 2447962   348413  2099549)
-> [0][2][ 114877]  43.5 (1): ( 2311453   341602  1969851)
-> [0][2][ 109133]  43.5 (1): ( 2213124   317917  1895207)
-> [0][2][ 103676]  43.5 (1): ( 2114799   301876  1812923)
-> [0][2][  98492]  43.5 (1): ( 2029078   288864  1740214)
-> [0][2][  93567]  43.5 (1): ( 1944647   282941  1661706)
-> [0][2][  88888]  43.5 (1): ( 1878239   263551  1614688)
-> [0][2][  84443]  43.5 (1): ( 1785472   254075  1531397)
-> [0][2][  80220]  43.5 (1): ( 1708646   241511  1467135)
-> [0][2][  76209]  43.5 (1): ( 1611896   241541  1370355)
-> [0][2][  72398]  43.5 (1): ( 1518939   222991  1295948)
-> [0][2][  68778]  43.5 (1): ( 1439208   224816  1214392)
[0][2] cache size found: 68778, cost: 10882302


-- 
                  I won't rest till it's the best ...
                  Programmer, Linux Scalability
                  Paul Jackson <pj@engr.sgi.com> 1.650.933.1373, 1.925.600.0401
