Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S310416AbSCLEJl>; Mon, 11 Mar 2002 23:09:41 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S310391AbSCLEJV>; Mon, 11 Mar 2002 23:09:21 -0500
Received: from fgwmail7.fujitsu.co.jp ([192.51.44.37]:55805 "EHLO
	fgwmail7.fujitsu.co.jp") by vger.kernel.org with ESMTP
	id <S310389AbSCLEJQ>; Mon, 11 Mar 2002 23:09:16 -0500
Date: Tue, 12 Mar 2002 13:09:06 +0900
From: Tachino Nobuhiro <tachino@jp.fujitsu.com>
Subject: Re: [bkpatch] Multiple threads in core dumps (was: Re: Thread
 registers dumped to core-file)
In-Reply-To: <20020309161322.A2092@nevyn.them.org>
To: Daniel Jacobowitz <dan@debian.org>
Cc: "Vamsi Krishna S." <vamsi_krishna@in.ibm.com>, torvalds@transmeta.com,
        Jeff Jenkins <jefreyr@pacbell.net>, linux-kernel@vger.kernel.org
Message-id: <eliqqvfh.wl@nisaaru.dvs.cs.fujitsu.co.jp>
MIME-version: 1.0 (generated by EMIKO 1.14.1 - "Choanoflagellata")
Content-type: text/plain; charset=US-ASCII
User-Agent: Wanderlust/2.9.7 (Unchained Melody) EMIKO/1.14.1 (Choanoflagellata)
 LIMIT/1.14.7 (Fujiidera) APEL/10.3 Emacs/21.2.50 (i686-pc-linux-gnu) MULE/5.0
 (SAKAKI)
In-Reply-To: <HFEPKLGPJDEHEGCKLKCCMEDLCCAA.jefreyr@pacbell.net>
 <200203090636.g296aSV273332@westrelay01.boulder.ibm.com>
 <20020309161322.A2092@nevyn.them.org>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


Hello,

I am now trying to implement gcore system call on linux and have a 
great interest in your patch.

At Sat, 09 Mar 2002 16:13:22 -0500,
Daniel Jacobowitz wrote:
> 
> Here it is, against 2.5.6-pre2 (linux-2.5).  I'll do a version for 2.4
> after it makes it into 2.5.
>
>
> I'm looking for feedback on this.  Particularly two things:

 One small feedback.
 If one of the threads sleeps with TASK_UNINTERRUPTIBLE, stop_all_threads()
 eats all CPU resources. I think following patch needed.


diff -ru linux-2.5-core.org/kernel/sched.c linux-2.5-core/kernel/sched.c
--- linux-2.5-core.org/kernel/sched.c	Mon Mar 11 19:08:00 2002
+++ linux-2.5-core/kernel/sched.c	Tue Mar 12 12:45:57 2002
@@ -763,6 +763,7 @@
 		if (all_stopped)
 			break;
 		read_unlock(&tasklist_lock);
+		set_current_state(TASK_UNINTERRUPTIBLE);
 		schedule_timeout(1);
 		read_lock(&tasklist_lock);
 	}
