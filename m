Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S265737AbTF3F2n (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 30 Jun 2003 01:28:43 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S265728AbTF3F2n
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 30 Jun 2003 01:28:43 -0400
Received: from angband.namesys.com ([212.16.7.85]:17892 "EHLO
	angband.namesys.com") by vger.kernel.org with ESMTP id S265737AbTF3F2k
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 30 Jun 2003 01:28:40 -0400
Date: Mon, 30 Jun 2003 09:42:59 +0400
From: Oleg Drokin <green@namesys.com>
To: Ivan Kokshaysky <ink@jurassic.park.msu.ru>
Cc: "T. Weyergraf" <kirk@colinet.de>, linux-kernel@vger.kernel.org
Subject: Re: 2.5.73 on alpha/smp build failure
Message-ID: <20030630054259.GC17466@namesys.com>
References: <kirk-1030628112813.A0111034@hydra.colinet.de> <20030628133818.GA6073@namesys.com> <20030629155616.B694@pls.park.msu.ru>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="p4qYPpj5QlsIQJ0K"
Content-Disposition: inline
In-Reply-To: <20030629155616.B694@pls.park.msu.ru>
User-Agent: Mutt/1.4i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org


--p4qYPpj5QlsIQJ0K
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello!

On Sun, Jun 29, 2003 at 03:56:16PM +0400, Ivan Kokshaysky wrote:

> > When I compile the kernel the alpha itself (tried shipped suse 8.1 gcc 3.2.2
> > and self-compiled gcc 2.95.3), it jumps to the address zero quickly after
> > launching init and panics.
> Most likely it's binutils problem. Versions 2.13.90.0.18 and newer
> should be OK, as discussed recently on l-k.

I have :
$ alphaev56-unknown-linux-gnu-size -V
GNU size 2.14 20030612
Copyright 2002 Free Software Foundation, Inc.
This program is free software; you may redistribute it under the terms of
the GNU General Public License.  This program has absolutely no warranty.

Also I tried to compare assembly output of native vs crosscompiler and have found the result to be
different substantionally (unfortunatelly I cannot understand alpha assembly, but I see the
code looks different in the beginning. Also assembly file generated by cross-gcc produces
wrong result after translated/linked using native binutils). I assume that binutils are not involved in
"gcc -S" process.

See attached assembly generated by cross compiler vs native compiler.

Bye,
    Oleg

--p4qYPpj5QlsIQJ0K
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="test-cross.s"

	.file	1 "test.c"
	.set noat
	.set noreorder
	.arch ev56
.section	.rodata
$LC0:
	.ascii "vs-500: unknown uniqueness %d\12\0"
$LC1:
	.ascii "result is %d\12\0"
.text
	.align 5
	.globl main
	.ent main
main:
	.frame $30,0,$26,0
	.mask 0x4000000,0
	ldgp $29,0($27)
$main..ng:
	lda $30,-16($30)
	lda $16,$LC0
	lda $17,-2
	stq $26,0($30)
	.prologue 1
	zapnot $17,15,$17
	jsr $26,printf
	ldgp $29,0($26)
	nop
	lda $16,$LC1
	lda $17,15
	jsr $26,printf
	ldgp $29,0($26)
	ldq $26,0($30)
	mov $31,$0
	lda $30,16($30)
	ret $31,($26),1
	.end main
	.ident	"GCC: (GNU) 2.95.3 20010315 (release)"

--p4qYPpj5QlsIQJ0K
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="test-native.s"

	.file	1 "test.c"
	.set noat
	.set noreorder
	.arch ev56
.section	.rodata
$LC0:
	.ascii "vs-500: unknown uniqueness %d\12\0"
$LC1:
	.ascii "result is %d\12\0"
.text
	.align 5
	.globl main
	.ent main
main:
	.frame $30,16,$26,0
	.mask 0x4000000,-16
	ldgp $29,0($27)
$main..ng:
	lda $30,-16($30)
	lda $16,$LC1
	stq $26,0($30)
	.prologue 1
	lda $17,1
	jsr $26,printf
	ldgp $29,0($26)
	ldq $26,0($30)
	mov $31,$0
	lda $30,16($30)
	ret $31,($26),1
	.end main
	.ident	"GCC: (GNU) 2.95.3 20010315 (release)"

--p4qYPpj5QlsIQJ0K--
