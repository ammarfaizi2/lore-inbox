Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S269900AbTG1OIj (ORCPT <rfc822;willy@w.ods.org>);
	Mon, 28 Jul 2003 10:08:39 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S269578AbTG1OIj
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Mon, 28 Jul 2003 10:08:39 -0400
Received: from i235086.ppp.asahi-net.or.jp ([61.125.235.86]:40440 "EHLO
	mitou.y-sato.ddo.jp") by vger.kernel.org with ESMTP id S269900AbTG1OER
	(ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Mon, 28 Jul 2003 10:04:17 -0400
Date: Mon, 28 Jul 2003 23:19:02 +0900
Message-ID: <m2lluiag4p.wl%ysato@users.sourceforge.jp>
From: Yoshinori Sato <ysato@users.sourceforge.jp>
To: Linus Torvalds <torvalds@osdl.org>
Cc: linux kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: [PATCH] linux-2.6.0-test2 h8300 archtecure support update (6/6)
User-Agent: Wanderlust/2.11.3 (Wonderwall) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 Emacs/21.3 (i386-pc-linux-gnu) MULE/5.0 (SAKAKI)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

build error and warning fix
blkdev location cleanup
typo fix
 
-- 
Yoshinori Sato
<ysato@users.sourceforge.jp>

diff -Nru linux-2.6.0-test2/arch/h8300/lib/Makefile linux-2.6.0-test2-h8300/arch/h8300/lib/Makefile
--- linux-2.6.0-test2/arch/h8300/lib/Makefile	2003-07-14 15:00:22.000000000 +0900
+++ linux-2.6.0-test2-h8300/arch/h8300/lib/Makefile	2003-07-28 12:40:08.000000000 +0900
@@ -5,4 +5,4 @@
 .S.o:
 	$(CC) $(AFLAGS) -D__ASSEMBLY__ -c $< -o $@
 
-lib-y  = ashrdi3.o checksum.o memcpy.o memset.o abs.o
+lib-y  = ashrdi3.o checksum.o memcpy.o memset.o abs.o romfs.o
diff -Nru linux-2.6.0-test2/arch/h8300/lib/abs.S linux-2.6.0-test2-h8300/arch/h8300/lib/abs.S
--- linux-2.6.0-test2/arch/h8300/lib/abs.S	2003-07-14 15:00:22.000000000 +0900
+++ linux-2.6.0-test2-h8300/arch/h8300/lib/abs.S	2003-07-19 21:41:33.000000000 +0900
@@ -1,4 +1,4 @@
-;;; memcpy.S
+;;; abs.S
 
 #include <asm/linkage.h>
 
diff -Nru linux-2.6.0-test2/arch/h8300/lib/memset.S linux-2.6.0-test2-h8300/arch/h8300/lib/memset.S
--- linux-2.6.0-test2/arch/h8300/lib/memset.S	2003-07-14 15:00:22.000000000 +0900
+++ linux-2.6.0-test2-h8300/arch/h8300/lib/memset.S	2003-07-19 23:20:29.000000000 +0900
@@ -17,9 +17,6 @@
 ;; c   = er1(r1l)
 ;; count = er2
 SYMBOL_NAME_LABEL(memset)
-	mov.l	er2,er2
-	beq	7f
-	mov.l	er0,@-sp
 	btst	#0,r0l
 	beq	2f
 
@@ -36,8 +33,13 @@
 	cmp.l	#4,er2
 	blo	4f
 	;; count>=4 -> count/4
+#if defined(__H8300H__)
 	shlr.l	er2
 	shlr.l	er2
+#endif
+#if defined(__H8300S__)
+	shlr.l	#2,er2
+#endif
 	;; byte -> long
 	mov.b	r1l,r1h
 	mov.w	r1,e1
@@ -56,6 +58,4 @@
 	dec.b	r3l
 	bne	5b
 6:
-	mov.l	@sp+,er0
-7:
-	rts
\ No newline at end of file
+	rts
