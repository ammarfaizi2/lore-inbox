Return-Path: <linux-kernel-owner+willy=40w.ods.org-S933520AbWKQKzG@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S933520AbWKQKzG (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 17 Nov 2006 05:55:06 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S933519AbWKQKzG
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 17 Nov 2006 05:55:06 -0500
Received: from ns.suse.de ([195.135.220.2]:33409 "EHLO mx1.suse.de")
	by vger.kernel.org with ESMTP id S933522AbWKQKzE (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 17 Nov 2006 05:55:04 -0500
Date: Fri, 17 Nov 2006 11:55:01 +0100
Message-ID: <s5hwt5us5q2.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Olivier Nicolas <olivn@trollprod.org>
Cc: Jeff Garzik <jeff@garzik.org>, "Lu, Yinghai" <yinghai.lu@amd.com>,
       David Miller <davem@davemloft.net>, torvalds@osdl.org,
       linux-kernel@vger.kernel.org
Subject: Re: [PATCH] ALSA: hda-intel - Disable MSI support by default
In-Reply-To: <455CEDC5.40200@trollprod.org>
References: <Pine.LNX.4.64.0611141846190.3349@woody.osdl.org>
	<20061114.190036.30187059.davem@davemloft.net>
	<Pine.LNX.4.64.0611141909370.3349@woody.osdl.org>
	<20061114.192117.112621278.davem@davemloft.net>
	<s5hbqn99f2v.wl%tiwai@suse.de>
	<455B5D22.10408@garzik.org>
	<s5hslgktu4a.wl%tiwai@suse.de>
	<455B6761.3050700@garzik.org>
	<s5hodr7u0ve.wl%tiwai@suse.de>
	<455CEDC5.40200@trollprod.org>
User-Agent: Wanderlust/2.12.0 (Your Wildest Dreams) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.7 (=?ISO-8859-4?Q?Sanj=F2?=) APEL/10.6 MULE XEmacs/21.5 (beta27)
 (fiddleheads) (+CVS-20060704) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Fri, 17 Nov 2006 00:01:25 +0100,
Olivier Nicolas wrote:
> 
> Takashi Iwai wrote:
> > At Wed, 15 Nov 2006 14:15:45 -0500,
> > Jeff Garzik wrote:
> >> ACK the pci_intx() calls, NAK the obviously overweight spinlock changes. 
> >>   The spinlock changes are completely unnecessary.  Just look at any 
> >> other (non-ALSA) PCI driver.  Existing "spin_lock()" is fine for both 
> >> PCI shared irq handlers and MSI irq handlers.
> >>
> >> It sounds like you are trying to work around a reentrancy problem that 
> >> does not exist.
> >>
> >> Only weird drivers like ps2kbd/mouse or IDE need spin_lock_irqsave(), 
> >> where separate interrupt sources call the same function.
> > 
> > OK, I revised it, also referring to a similar patch by Yinghai.
> > I think we can simplify the change like below.
> > Olivier, could you test this patch, too?
> 
> Applied to 2.6.19-rc6, the module tries MSI but this time no IRQ get 
> disabled. The result is equivalent to 2.6.19-rc6

Does it mean that the driver works as expected with this patch?

> 
> ALSA sound/pci/hda/hda_intel.c:543: hda_intel: No response from codec, 
> disabling MSI...
> hda_codec: Unknown model for AD1988, trying auto-probe from BIOS...
> 
> 
> Full details:
> http://olivn.trollprod.com/19-rc6/19-rc6-takashi-routeirq1.dmesg
> http://olivn.trollprod.com/19-rc6/19-rc6-takashi-routeirq1.irq

These look OK to me.


thanks,

Takashi
