Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S261530AbUCVAJe (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 21 Mar 2004 19:09:34 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S261551AbUCVAJe
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 21 Mar 2004 19:09:34 -0500
Received: from ppp-217-133-42-200.cust-adsl.tiscali.it ([217.133.42.200]:24714
	"EHLO dualathlon.random") by vger.kernel.org with ESMTP
	id S261530AbUCVAJb (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sun, 21 Mar 2004 19:09:31 -0500
Date: Mon, 22 Mar 2004 01:10:23 +0100
From: Andrea Arcangeli <andrea@suse.de>
To: Marc-Christian Petersen <m.c.p@wolk-project.de>
Cc: linux-kernel@vger.kernel.org, Andrew Morton <akpm@osdl.org>,
       Linus Torvalds <torvalds@osdl.org>
Subject: Re: do we want to kill VM_RESERVED or not? [was Re: 2.6.5-rc1-aa3]
Message-ID: <20040322001023.GD3649@dualathlon.random>
References: <20040320210306.GA11680@dualathlon.random> <20040321120005.GC10787@dualathlon.random> <20040321121526.GD10787@dualathlon.random> <200403212042.18092@WOLK>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200403212042.18092@WOLK>
User-Agent: Mutt/1.4.1i
X-GPG-Key: 1024D/68B9CB43 13D9 8355 295F 4823 7C49  C012 DFA1 686E 68B9 CB43
X-PGP-Key: 1024R/CB4660B9 CC A0 71 81 F4 A0 63 AC  C0 4B 81 1D 8C 15 C8 E5
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, Mar 21, 2004 at 08:42:18PM +0100, Marc-Christian Petersen wrote:
> On Sunday 21 March 2004 13:15, Andrea Arcangeli wrote:
> 
> Hi Andrea,
> 
> first: many thanks for all your effort for objrmap and anon_vma.
> I really appreciate it!

You're welcome, you should also thank Dave and Hugh even before you
thank me ;), since they solved many of the problems to make this
possible years ago even before I started working on the objrmap myself.

> > and here the vmware proper fix: --- vmmon-only/linux/driver.c.~1~
> > 2004-03-21 13:07:02.869326296 +0100
> > +++ vmmon-only/linux/driver.c	2004-03-21 13:07:28.320457136 +0100
> > @@ -1083,6 +1083,7 @@ static int LinuxDriverMmap(struct file *
> >     }
> >     /* Clear VM_IO, otherwise SuSE's kernels refuse to do get_user_pages */
> >     vma->vm_flags &= ~VM_IO;
> > +   vma->vm_flags |= VM_RESERVED;
> >  #if LINUX_VERSION_CODE < KERNEL_VERSION(2, 2, 3)
> >     vma->vm_file = filp;
> >     filp->f_count++;
> > You should apply both (though just applying one of the two will fix it).
> 
> ok, without the VMware fix, see attached oops report.

it's not an oops report, it's a warning only and it should not affect
functionality in any way (vmware should still work). The vmware fix will
shutdown the warning so you won't be annoyed anymore by it ;)

> With the VMware fix, it works fine.

Good.

> Both, for sure, with 2.6.5-rc2-aa1.
> 
> What I have noticed is this from VMware _without_ the VMware fix:
> 
> Mar 21 20:23:56 codeman kernel: /dev/vmnet: hub 8 does not exist, allocating 
> memory.
> Mar 21 20:23:56 codeman kernel: /dev/vmnet: port on hub 8 successfully opened
> Mar 21 20:23:56 codeman VMware[init]: Unable to sendto: Operation not		<------ 
> permitted
> Mar 21 20:23:56 codeman VMware[init]: 
> Mar 21 20:23:56 codeman kernel: /dev/vmnet: open called by PID 10497 
> (vmnet-netifup)
> Mar 21 20:23:56 codeman kernel: /dev/vmnet: port on hub 8 successfully opened
> 
> 
> With the VMware fix applied, the "Unable to sendto..." line disappears.

maybe a delay generated by the printk, not sure why there's a relation
between the two, or if it's only a coincidence. WARN_ON after triggering
should only generate a delay, no other effects.

thanks!
