Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S265597AbSKFFn6>; Wed, 6 Nov 2002 00:43:58 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S265601AbSKFFn6>; Wed, 6 Nov 2002 00:43:58 -0500
Received: from gateway-1237.mvista.com ([12.44.186.158]:15614 "EHLO
	av.mvista.com") by vger.kernel.org with ESMTP id <S265597AbSKFFn5>;
	Wed, 6 Nov 2002 00:43:57 -0500
Message-ID: <3DC8AD8A.20494DC0@mvista.com>
Date: Tue, 05 Nov 2002 21:50:02 -0800
From: george anzinger <george@mvista.com>
Organization: Monta Vista Software
X-Mailer: Mozilla 4.77 [en] (X11; U; Linux 2.2.12-20b i686)
X-Accept-Language: en
MIME-Version: 1.0
To: Ingo Molnar <mingo@elte.hu>,
       "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
Subject: NMI watchdog question.
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

In io_apic.c there is the following bit of code:

	if (nmi_watchdog) {
		printk(KERN_WARNING "timer doesn't work through the
IO-APIC - disabling NMI Watchdog!\n");
		nmi_watchdog = 0;
	}

On at least some systems, disabling the above store leaves a
valid nmi watchdog timer.

In attempting to understand how the NMI watchdog works I
think I have found that:

a. the NMI interrupts are generated by the performance
counter in the cpu and

b. the test to see if the cpu is stalled is on a counter
that is bumped by the apic counter interrupt code.

If this is so (and help me to understand if it is not), then
what do the timer interrupts going thru the IO_APIC have to
do with the NMI watchdog.

Is it possible that the above code is a hold over from when
things were done differently?

-- 
George Anzinger   george@mvista.com
High-res-timers: 
http://sourceforge.net/projects/high-res-timers/
Preemption patch:
http://www.kernel.org/pub/linux/kernel/people/rml
