Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S264129AbUBKL73 (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 11 Feb 2004 06:59:29 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S264321AbUBKL73
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 11 Feb 2004 06:59:29 -0500
Received: from ns.suse.de ([195.135.220.2]:12241 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S264129AbUBKL7Q (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 11 Feb 2004 06:59:16 -0500
Date: Wed, 11 Feb 2004 12:58:39 +0100
Message-ID: <s5hptclbzf4.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Meelis Roos <mroos@linux.ee>
Cc: linux-kernel@vger.kernel.org
Subject: Re: 2.6.3-rc1: snd_intel8x0 still too fast
In-Reply-To: <Pine.GSO.4.44.0402101356380.13962-100000@math.ut.ee>
References: <s5hn07r17ou.wl@alsa2.suse.de>
	<Pine.GSO.4.44.0402101356380.13962-100000@math.ut.ee>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: multipart/mixed;
 boundary="Multipart_Wed_Feb_11_12:58:39_2004-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--Multipart_Wed_Feb_11_12:58:39_2004-1
Content-Type: text/plain; charset=US-ASCII

At Tue, 10 Feb 2004 14:03:40 +0200 (EET),
Meelis Roos wrote:
> 
> > > mplayer /usr/share/sounds/KDE_Startup.wav
> > > gives the same very fast sound since it's a 22 KHz mono sample.
> > >
> > > mplayer -srate 48000 /usr/share/sounds/KDE_Startup.wav
> > > works fine. Same applies to all files.
> >
> > then VRA of ac97 seems not working correctly.
> > check /proc/asound/card0/codec97#0/* files for each case whether the
> > DAC rate is set correctly.  (it must be tuned with the detected ac97
> > clock, i.e. rate * clock / 48000).
> 
> PCM front DAC    : 41133Hz
> PCM ADC          : 48000Hz
> 
> This is with "intel8x0: clocking to 41133" and playing with mplayer
> -srate 48000 ...
> 
> PCM front DAC    : 18895Hz
> PCM ADC          : 48000Hz

does the attached patch improve?

if it still doesn't help, try the following:

- stop ALSA once
- remove /etc/asound.state
- restart ALSA and tune up mixer again


Takashi

--Multipart_Wed_Feb_11_12:58:39_2004-1
Content-Type: text/plain; charset=US-ASCII

--- linux/sound/pci/ac97/ac97_patch.c	9 Feb 2004 11:38:03 -0000	1.35
+++ linux/sound/pci/ac97/ac97_patch.c	11 Feb 2004 11:56:19 -0000
@@ -682,6 +682,9 @@
 	jack = snd_ac97_read(ac97, AC97_AD_JACK_SPDIF);
 	snd_ac97_write_cache(ac97, AC97_AD_JACK_SPDIF, jack | 0x0300);
 
+	/* set default */
+	snd_ac97_write_cache(ac97, AC97_AD_MISC, 0);
+
 	ac97->build_ops = &patch_ad1885_build_ops;
 	return 0;
 }

--Multipart_Wed_Feb_11_12:58:39_2004-1--
