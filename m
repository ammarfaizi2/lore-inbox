Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S267590AbUBSX5z (ORCPT <rfc822;willy@w.ods.org>);
	Thu, 19 Feb 2004 18:57:55 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S267592AbUBSX5y
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Thu, 19 Feb 2004 18:57:54 -0500
Received: from fw.osdl.org ([65.172.181.6]:24276 "EHLO mail.osdl.org")
	by vger.kernel.org with ESMTP id S267590AbUBSX5w (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Thu, 19 Feb 2004 18:57:52 -0500
Date: Thu, 19 Feb 2004 16:02:29 -0800 (PST)
From: Linus Torvalds <torvalds@osdl.org>
To: Andrew Tridgell <tridge@samba.org>
cc: Al Viro <viro@parcelfarce.linux.theplanet.co.uk>,
       Jamie Lokier <jamie@shareable.org>, "H. Peter Anvin" <hpa@zytor.com>,
       Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: Re: Eureka! (was Re: UTF-8 and case-insensitivity)
In-Reply-To: <16437.18605.71269.750607@samba.org>
Message-ID: <Pine.LNX.4.58.0402191549500.2244@ppc970.osdl.org>
References: <Pine.LNX.4.58.0402181422180.2686@home.osdl.org>
 <Pine.LNX.4.58.0402181427230.2686@home.osdl.org> <16435.60448.70856.791580@samba.org>
 <Pine.LNX.4.58.0402181457470.18038@home.osdl.org> <16435.61622.732939.135127@samba.org>
 <Pine.LNX.4.58.0402181511420.18038@home.osdl.org> <20040219081027.GB4113@mail.shareable.org>
 <Pine.LNX.4.58.0402190759550.1222@ppc970.osdl.org> <20040219163838.GC2308@mail.shareable.org>
 <Pine.LNX.4.58.0402190853500.1222@ppc970.osdl.org> <20040219182948.GA3414@mail.shareable.org>
 <Pine.LNX.4.58.0402191124080.1270@ppc970.osdl.org> <16437.18605.71269.750607@samba.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org



On Fri, 20 Feb 2004 tridge@samba.org wrote:
> 
> What your proposal doesn't give us is case-insensitive indexing into
> the dcache.

Correct.

And I've told you OVER AND OVER again that you have a choice: better than 
what you do now, or nothing. Whining about the fact that Windows is 
stupid will only make me convinced that there is no point to even helping 
samba, since what you really want is WNT.

If what you want is WNT, then go away. That's not what I'm offering. And 
it's not going to _be_ that I offer. 

I offer you _sane_ VFS semantics, with some accelerators for your insane 
needs. If that isn't enough, then please just stop bothering me. 

Comprende?

>	 The reason the dcache is such a great thing in Linux is
> that it is indexed by name, so you rarely do any scanning at all

And that is still true of any exact matches.

If you have a fuzzy lookup of a name that does exist, but doesn't match,
or you have a new name that simply doesn't _exist_ in the dcache, then you
will have to scan all dentries. But now you can scan them in-memory by
following the pointers directly without having to index through the
filesystem data structures and worrying about disk reads. And you can
optimize that to do a fast mismatch (ie in most cases you can probably
look at the first one of two characters and determine immediately that
there is no match).

The only way to avoid that is to make the hash weaker. Which I'm not 
willing to do: I'm not willing to make the _proper_ lookups go slower 
because of some insane crap generated by Microsoft.

In other words, put up or shut up. If you are only going to repeat your 
whine about how you want the Linux VFS layer to look like Windows, I'm 
simply NOT INTERESTED.

		Linus
