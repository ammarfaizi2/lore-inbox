Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S284410AbRLEODb>; Wed, 5 Dec 2001 09:03:31 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S284409AbRLEODV>; Wed, 5 Dec 2001 09:03:21 -0500
Received: from ns.suse.de ([213.95.15.193]:44812 "HELO Cantor.suse.de")
	by vger.kernel.org with SMTP id <S284402AbRLEODN>;
	Wed, 5 Dec 2001 09:03:13 -0500
To: Rik van Riel <riel@conectiva.com.br>
Cc: linux-kernel@vger.kernel.org, lse-tech@lists.sourceforge.net,
        kiran@in.ibm.com
Subject: Re: [RFC] [PATCH] Scalable Statistics Counters
In-Reply-To: <20011205163153.E16315@in.ibm.com.suse.lists.linux.kernel> <Pine.LNX.4.33L.0112051109340.4079-100000@imladris.surriel.com.suse.lists.linux.kernel>
From: Andi Kleen <ak@suse.de>
Date: 05 Dec 2001 15:03:12 +0100
In-Reply-To: Rik van Riel's message of "5 Dec 2001 14:22:44 +0100"
Message-ID: <p73ofld9333.fsf@amdsim2.suse.de>
X-Mailer: Gnus v5.7/Emacs 20.7
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

Rik van Riel <riel@conectiva.com.br> writes:
> 
> (it'd be so cool if we could just start using a statistic variable
> through some macro and it'd be automatically declared and visible
> in /proc ;))

It is rather easy using ELF segments. You just do macros that put the
names and a pointer to the variable and the type into an ELF segment
starting with a known symbol. Then at kernel/module init you walk this
segment and do the necessary registration. 

[has also been done for sysctls]

Disadvantage is that one needs to change modutils for it to make it also

Also it needs new binutils; old binutils tend to mislink code with
the many inter section relocations generated by this technique.

-Andi (who would also like such an easy statistics interface) 
