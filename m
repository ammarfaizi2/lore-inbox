Return-Path: <linux-kernel-owner+willy=40w.ods.org-S262532AbUKLN0z@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S262532AbUKLN0z (ORCPT <rfc822;willy@w.ods.org>);
	Fri, 12 Nov 2004 08:26:55 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S262524AbUKLN0z
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Fri, 12 Nov 2004 08:26:55 -0500
Received: from mail.suse.de ([195.135.220.2]:49822 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S262532AbUKLN0P (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Fri, 12 Nov 2004 08:26:15 -0500
Date: Fri, 12 Nov 2004 14:26:14 +0100
Message-ID: <s5hzn1ndwqx.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: "Zhu, Yi" <yi.zhu@intel.com>
Cc: "Martin Josefsson" <gandalf@wlug.westbo.se>, <perex@suse.cz>,
       <akpm@osdl.org>, <linux-kernel@vger.kernel.org>
Subject: Re: [PATCH] Add pci_save_state() to ALSA
In-Reply-To: <3ACA40606221794F80A5670F0AF15F8403BD5836@pdsmsx403>
References: <3ACA40606221794F80A5670F0AF15F8403BD5836@pdsmsx403>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 15) (Security Through Obscurity) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Fri, 12 Nov 2004 21:00:30 +0800,
Zhu, Yi wrote:
> 
> Takashi Iwai wrote:
> > pci_save_state() is called internally in
> > drivers/pci/pci-driver.c:pci_device_suspend(), so it's redundant.
> > 
> >> My laptop doesn't resume (gets what I assume is an ACPI timeout and
> >> hangs solid) without this small obvious patch.
> > 
> > I'm wondering how this can fix your problem...
> 
> For example, some devices call pci_save_state before pci_disable_device
> in
> ->suspend, but don't pci_enable_device in ->resume. This works before,
> but 
> is broken after the pci_save_state() change. We need to find those
> drivers out
> and change the individual drivers instead of this simple fix.

But pci_save_state() is called again after the driver's suspend
callback is called.  So, the final saved state must be anyway same.

> Martin, which sound driver do you use?

Yep that's important to know.


Takashi
