Return-Path: <linux-kernel-owner+willy=40w.ods.org-S932193AbWJASxK@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932193AbWJASxK (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 1 Oct 2006 14:53:10 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S932196AbWJASxJ
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 1 Oct 2006 14:53:09 -0400
Received: from mout1.freenet.de ([194.97.50.132]:38375 "EHLO mout1.freenet.de")
	by vger.kernel.org with ESMTP id S932194AbWJASxG (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 1 Oct 2006 14:53:06 -0400
Date: Sun, 01 Oct 2006 20:54:01 +0200
To: "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
Subject: [PATCH 2/4] 2.6.18-mm2 pktcdvd: make procfs interface optional
Reply-To: balagi@justmail.de
From: "Thomas Maier" <balagi@justmail.de>
Cc: "petero2@telia.com" <petero2@telia.com>, akpm@osdl.org
Content-Type: multipart/mixed; boundary=----------KzrdD7iN27cqphGKjVRtVg
MIME-Version: 1.0
Message-ID: <op.tgrasbjeiudtyh@master>
User-Agent: Opera Mail/9.00 (Win32)
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

------------KzrdD7iN27cqphGKjVRtVg
Content-Type: text/plain; charset=iso-8859-15
Content-Transfer-Encoding: 7bit

Hi,

this patch 2/4 for pktcdvd against Linux 2.6.18 (stable)
or 2.6.18-mm2 makes the procfs interface optional. A new kernel
config parameter is added: CDROM_PKTCDVD_PROCINTF
(Of course, you can not use pktcdvd if there is no procfs
interface. Wait for patch 4/4 that adds the sysfs interface ;)

You must first apply patch 1/4 !

Sorry, my mail client damages the patch, so please use the (text) attachment
or get the patch from
http://people.freenet.de/BalaGi/download/2-procfs-pktcdvd-patch-2.6.18

The merged patch (parts 1 to 4) is available at:
http://people.freenet.de/BalaGi/download/pktcdvd-patch-2.6.18

Signed-off-by: Thomas Maier<balagi@justmail.de>
------------KzrdD7iN27cqphGKjVRtVg
Content-Disposition: attachment; filename=2-procfs-pktcdvd-patch-2.6.18
Content-Type: application/octet-stream; name=2-procfs-pktcdvd-patch-2.6.18
Content-Transfer-Encoding: Base64

ZGlmZiAtdXJwTiBwMS1kcml2ZXItbmFtZS9kcml2ZXJzL2Jsb2NrL0tjb25maWcg
cDItcHJvY2ZzL2RyaXZlcnMvYmxvY2svS2NvbmZpZwotLS0gcDEtZHJpdmVyLW5h
bWUvZHJpdmVycy9ibG9jay9LY29uZmlnCTIwMDYtMTAtMDEgMTY6MTM6MTQuMDAw
MDAwMDAwICswMjAwCisrKyBwMi1wcm9jZnMvZHJpdmVycy9ibG9jay9LY29uZmln
CTIwMDYtMTAtMDEgMTY6Mzk6NDcuMDAwMDAwMDAwICswMjAwCkBAIC00NTgsNiAr
NDU4LDIxIEBAIGNvbmZpZyBDRFJPTV9QS1RDRFZEX1dDQUNIRQogCSAgdGhpcyBv
cHRpb24gaXMgZGFuZ2Vyb3VzIHVubGVzcyB0aGUgQ0QtUlcgbWVkaWEgaXMga25v
d24gZ29vZCwgYXMgd2UKIAkgIGRvbid0IGRvIGRlZmVycmVkIHdyaXRlIGVycm9y
IGhhbmRsaW5nIHlldC4KIAorY29uZmlnIENEUk9NX1BLVENEVkRfUFJPQ0lOVEYK
Kwlib29sICJFbmFibGUgcHJvY2ZzIGludGVyZmFjZSIKKwlkZXBlbmRzIG9uIENE
Uk9NX1BLVENEVkQKKwlkZWZhdWx0IHkKKwloZWxwCisJICBFbmFibGUgdGhlIHBy
b2MgZmlsZXN5c3RlbSBpbnRlcmZhY2UgZm9yIHBrdGNkdmQuCisJICBUaGUgZmls
ZXMgY2FuIGJlIGZvdW5kIGFzOgorCSAgCisJICAvcHJvYy9kcml2ZXIvcGt0Y2R2
ZC9wa3RjZHZkPGlkeD4KKwkgIAorCSAgQWxzbyBhIG1pc2MgZGV2aWNlIGlzIGFk
ZGVkIHdpdGggYSBkeW5hbWljIG1pbm9yIGRldmljZSBpZC4KKwkgIFNlZSB0aGUg
ZW50cnkgaW4gIC9wcm9jL21pc2MgIGZvciB0aGUgbWlub3IgbnVtYmVyLgorCSAg
VGhlIG1pc2MgcGt0Y2R2ZCBkcml2ZXIgc3VwcG9ydHMgaW9jdGwgY2FsbHMsIG5l
ZWRlZAorCSAgYnkgdGhlIHBrdHNldHVwIHRvb2wgZm91bmQgaW4gdWRmdG9vbHMg
cGFja2FnZS4KKwogc291cmNlICJkcml2ZXJzL3MzOTAvYmxvY2svS2NvbmZpZyIK
IAogY29uZmlnIEFUQV9PVkVSX0VUSApkaWZmIC11cnBOIHAxLWRyaXZlci1uYW1l
L2RyaXZlcnMvYmxvY2svcGt0Y2R2ZC5jIHAyLXByb2Nmcy9kcml2ZXJzL2Jsb2Nr
L3BrdGNkdmQuYwotLS0gcDEtZHJpdmVyLW5hbWUvZHJpdmVycy9ibG9jay9wa3Rj
ZHZkLmMJMjAwNi0xMC0wMSAxNjoxMTozMS4wMDAwMDAwMDAgKzAyMDAKKysrIHAy
LXByb2Nmcy9kcml2ZXJzL2Jsb2NrL3BrdGNkdmQuYwkyMDA2LTEwLTAxIDE4OjEx
OjM1LjAwMDAwMDAwMCArMDIwMApAQCAtMSw2ICsxLDcgQEAKIC8qCiAgKiBDb3B5
cmlnaHQgKEMpIDIwMDAgSmVucyBBeGJvZSA8YXhib2VAc3VzZS5kZT4KICAqIENv
cHlyaWdodCAoQykgMjAwMS0yMDA0IFBldGVyIE9zdGVybHVuZCA8cGV0ZXJvMkB0
ZWxpYS5jb20+CisgKiBDb3B5cmlnaHQgKEMpIDIwMDYgVGhvbWFzIE1haWVyIDxi
YWxhZ2lAanVzdG1haWwuZGU+CiAgKgogICogTWF5IGJlIGNvcGllZCBvciBtb2Rp
ZmllZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYwog
ICogTGljZW5zZS4gIFNlZSBsaW51eC9DT1BZSU5HIGZvciBtb3JlIGluZm9ybWF0
aW9uLgpAQCAtNTEsMTUgKzUyLDE4IEBACiAjaW5jbHVkZSA8bGludXgvZXJybm8u
aD4KICNpbmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgogI2luY2x1ZGUgPGxpbnV4
L2ZpbGUuaD4KLSNpbmNsdWRlIDxsaW51eC9wcm9jX2ZzLmg+CiAjaW5jbHVkZSA8
bGludXgvc2VxX2ZpbGUuaD4KLSNpbmNsdWRlIDxsaW51eC9taXNjZGV2aWNlLmg+
CiAjaW5jbHVkZSA8bGludXgvc3VzcGVuZC5oPgogI2luY2x1ZGUgPGxpbnV4L211
dGV4Lmg+CiAjaW5jbHVkZSA8c2NzaS9zY3NpX2NtbmQuaD4KICNpbmNsdWRlIDxz
Y3NpL3Njc2lfaW9jdGwuaD4KICNpbmNsdWRlIDxzY3NpL3Njc2kuaD4KIAorI2lm
IFBLVF9VU0VfUFJPQ0ZTCisjaW5jbHVkZSA8bGludXgvcHJvY19mcy5oPgorI2lu
Y2x1ZGUgPGxpbnV4L21pc2NkZXZpY2UuaD4KKyNlbmRpZgorCiAjaW5jbHVkZSA8
YXNtL3VhY2Nlc3MuaD4KIAogI2RlZmluZSBEUklWRVJfTkFNRQkicGt0Y2R2ZCIK
QEAgLTgxLDcgKzg1LDkgQEAKICNkZWZpbmUgWk9ORShzZWN0b3IsIHBkKSAoKChz
ZWN0b3IpICsgKHBkKS0+b2Zmc2V0KSAmIH4oKHBkKS0+c2V0dGluZ3Muc2l6ZSAt
IDEpKQogCiBzdGF0aWMgc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwa3RfZGV2c1tN
QVhfV1JJVEVSU107CisjaWYgUEtUX1VTRV9QUk9DRlMKIHN0YXRpYyBzdHJ1Y3Qg
cHJvY19kaXJfZW50cnkgKnBrdF9wcm9jOworI2VuZGlmCiBzdGF0aWMgaW50IHBr
dF9tYWpvcjsKIHN0YXRpYyBzdHJ1Y3QgbXV0ZXggY3RsX211dGV4OwkvKiBTZXJp
YWxpemUgb3Blbi9jbG9zZS9zZXR1cC90ZWFyZG93biAqLwogc3RhdGljIG1lbXBv
b2xfdCAqcHNkX3Bvb2w7CkBAIC0yMjQxLDYgKzIyNDcsNyBAQCBzdGF0aWMgdm9p
ZCBwa3RfaW5pdF9xdWV1ZShzdHJ1Y3QgcGt0Y2R2CiAJcS0+cXVldWVkYXRhID0g
cGQ7CiB9CiAKKyNpZiBQS1RfVVNFX1BST0NGUwogc3RhdGljIGludCBwa3Rfc2Vx
X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpwKQogewogCXN0cnVjdCBw
a3RjZHZkX2RldmljZSAqcGQgPSBtLT5wcml2YXRlOwpAQCAtMjMxMSwxMyArMjMx
OCwxMyBAQCBzdGF0aWMgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBwa3RfcHJvY19m
CiAJLmxsc2Vlawk9IHNlcV9sc2VlaywKIAkucmVsZWFzZSA9IHNpbmdsZV9yZWxl
YXNlCiB9OworI2VuZGlmIC8qIFBLVF9VU0VfUFJPQ0ZTICovCiAKIHN0YXRpYyBp
bnQgcGt0X25ld19kZXYoc3RydWN0IHBrdGNkdmRfZGV2aWNlICpwZCwgZGV2X3Qg
ZGV2KQogewogCWludCBpOwogCWludCByZXQgPSAwOwogCWNoYXIgYltCREVWTkFN
RV9TSVpFXTsKLQlzdHJ1Y3QgcHJvY19kaXJfZW50cnkgKnByb2M7CiAJc3RydWN0
IGJsb2NrX2RldmljZSAqYmRldjsKIAogCWlmIChwZC0+cGt0X2RldiA9PSBkZXYp
IHsKQEAgLTIzNjEsMTEgKzIzNjgsMTYgQEAgc3RhdGljIGludCBwa3RfbmV3X2Rl
dihzdHJ1Y3QgcGt0Y2R2ZF9kZQogCQlnb3RvIG91dF9tZW07CiAJfQogCi0JcHJv
YyA9IGNyZWF0ZV9wcm9jX2VudHJ5KHBkLT5uYW1lLCAwLCBwa3RfcHJvYyk7Ci0J
aWYgKHByb2MpIHsKLQkJcHJvYy0+ZGF0YSA9IHBkOwotCQlwcm9jLT5wcm9jX2Zv
cHMgPSAmcGt0X3Byb2NfZm9wczsKKyNpZiBQS1RfVVNFX1BST0NGUworCXsKKwkJ
c3RydWN0IHByb2NfZGlyX2VudHJ5ICpwcm9jID0gY3JlYXRlX3Byb2NfZW50cnko
cGQtPm5hbWUsCisJCQkJCQkJCTAsIHBrdF9wcm9jKTsKKwkJaWYgKHByb2MpIHsK
KwkJCXByb2MtPmRhdGEgPSBwZDsKKwkJCXByb2MtPnByb2NfZm9wcyA9ICZwa3Rf
cHJvY19mb3BzOworCQl9CiAJfQorI2VuZGlmCiAJRFBSSU5USyhEUklWRVJfTkFN
RSI6IHdyaXRlciAlcyBtYXBwZWQgdG8gJXNcbiIsIHBkLT5uYW1lLCBiZGV2bmFt
ZShiZGV2LCBiKSk7CiAJcmV0dXJuIDA7CiAKQEAgLTI1MzQsNyArMjU0Niw5IEBA
IHN0YXRpYyBpbnQgcGt0X3JlbW92ZV9kZXYoc3RydWN0IHBrdF9jdHIKIAogCWJs
a2Rldl9wdXQocGQtPmJkZXYpOwogCisjaWYgUEtUX1VTRV9QUk9DRlMKIAlyZW1v
dmVfcHJvY19lbnRyeShwZC0+bmFtZSwgcGt0X3Byb2MpOworI2VuZGlmCiAJRFBS
SU5USyhEUklWRVJfTkFNRSI6IHdyaXRlciAlcyB1bm1hcHBlZFxuIiwgcGQtPm5h
bWUpOwogCiAJZGVsX2dlbmRpc2socGQtPmRpc2spOwpAQCAtMjU1MCw2ICsyNTY0
LDcgQEAgc3RhdGljIGludCBwa3RfcmVtb3ZlX2RldihzdHJ1Y3QgcGt0X2N0cgog
CXJldHVybiAwOwogfQogCisjaWYgUEtUX1VTRV9QUk9DRlMKIHN0YXRpYyB2b2lk
IHBrdF9nZXRfc3RhdHVzKHN0cnVjdCBwa3RfY3RybF9jb21tYW5kICpjdHJsX2Nt
ZCkKIHsKIAlzdHJ1Y3QgcGt0Y2R2ZF9kZXZpY2UgKnBkID0gcGt0X2ZpbmRfZGV2
X2Zyb21fbWlub3IoY3RybF9jbWQtPmRldl9pbmRleCk7CkBAIC0yNjE1LDExICsy
NjMwLDE0IEBAIHN0YXRpYyBzdHJ1Y3QgbWlzY2RldmljZSBwa3RfbWlzYyA9IHsK
IAkubmFtZSAgCQk9IERSSVZFUl9OQU1FLAogCS5mb3BzICAJCT0gJnBrdF9jdGxf
Zm9wcwogfTsKKyNlbmRpZiAvKiBQS1RfVVNFX1BST0NGUyAqLwogCiBzdGF0aWMg
aW50IF9faW5pdCBwa3RfaW5pdCh2b2lkKQogewogCWludCByZXQ7CiAKKwltdXRl
eF9pbml0KCZjdGxfbXV0ZXgpOworCiAJcHNkX3Bvb2wgPSBtZW1wb29sX2NyZWF0
ZV9rbWFsbG9jX3Bvb2woUFNEX1BPT0xfU0laRSwKIAkJCQkJc2l6ZW9mKHN0cnVj
dCBwYWNrZXRfc3RhY2tlZF9kYXRhKSk7CiAJaWYgKCFwc2RfcG9vbCkKQEAgLTI2
MzMsMTUgKzI2NTEsMTQgQEAgc3RhdGljIGludCBfX2luaXQgcGt0X2luaXQodm9p
ZCkKIAlpZiAoIXBrdF9tYWpvcikKIAkJcGt0X21ham9yID0gcmV0OwogCisjaWYg
UEtUX1VTRV9QUk9DRlMKIAlyZXQgPSBtaXNjX3JlZ2lzdGVyKCZwa3RfbWlzYyk7
CiAJaWYgKHJldCkgewogCQlwcmludGsoRFJJVkVSX05BTUUiOiBVbmFibGUgdG8g
cmVnaXN0ZXIgbWlzYyBkZXZpY2VcbiIpOwogCQlnb3RvIG91dDsKIAl9Ci0KLQlt
dXRleF9pbml0KCZjdGxfbXV0ZXgpOwotCiAJcGt0X3Byb2MgPSBwcm9jX21rZGly
KERSSVZFUl9OQU1FLCBwcm9jX3Jvb3RfZHJpdmVyKTsKKyNlbmRpZgogCiAJcmV0
dXJuIDA7CiAKQEAgLTI2NTQsMTQgKzI2NzEsMTcgQEAgb3V0MjoKIAogc3RhdGlj
IHZvaWQgX19leGl0IHBrdF9leGl0KHZvaWQpCiB7CisjaWYgUEtUX1VTRV9QUk9D
RlMKIAlyZW1vdmVfcHJvY19lbnRyeShEUklWRVJfTkFNRSwgcHJvY19yb290X2Ry
aXZlcik7CiAJbWlzY19kZXJlZ2lzdGVyKCZwa3RfbWlzYyk7CisjZW5kaWYKIAl1
bnJlZ2lzdGVyX2Jsa2Rldihwa3RfbWFqb3IsIERSSVZFUl9OQU1FKTsKIAltZW1w
b29sX2Rlc3Ryb3kocHNkX3Bvb2wpOwogfQogCiBNT0RVTEVfREVTQ1JJUFRJT04o
IlBhY2tldCB3cml0aW5nIGxheWVyIGZvciBDRC9EVkQgZHJpdmVzIik7Ci1NT0RV
TEVfQVVUSE9SKCJKZW5zIEF4Ym9lIDxheGJvZUBzdXNlLmRlPiIpOworTU9EVUxF
X0FVVEhPUigiSmVucyBBeGJvZSA8YXhib2VAc3VzZS5kZT4sUGV0ZXIgT3N0ZXJs
dW5kIDxwZXRlcm8yQHRlbGlhLmNvbT4sIgorICAgICAgICAgICAgICAiVGhvbWFz
IE1haWVyIDxiYWxhZ2lAanVzdG1haWwuZGU+Iik7CiBNT0RVTEVfTElDRU5TRSgi
R1BMIik7CiAKIG1vZHVsZV9pbml0KHBrdF9pbml0KTsKZGlmZiAtdXJwTiBwMS1k
cml2ZXItbmFtZS9pbmNsdWRlL2xpbnV4L3BrdGNkdmQuaCBwMi1wcm9jZnMvaW5j
bHVkZS9saW51eC9wa3RjZHZkLmgKLS0tIHAxLWRyaXZlci1uYW1lL2luY2x1ZGUv
bGludXgvcGt0Y2R2ZC5oCTIwMDYtMTAtMDEgMTY6MTM6MTQuMDAwMDAwMDAwICsw
MjAwCisrKyBwMi1wcm9jZnMvaW5jbHVkZS9saW51eC9wa3RjZHZkLmgJMjAwNi0x
MC0wMSAxNzozODoyMi4wMDAwMDAwMDAgKzAyMDAKQEAgLTExMiw2ICsxMTIsMTMg
QEAgc3RydWN0IHBrdF9jdHJsX2NvbW1hbmQgewogI2luY2x1ZGUgPGxpbnV4L2Nv
bXBsZXRpb24uaD4KICNpbmNsdWRlIDxsaW51eC9jZHJvbS5oPgogCisvKiB1c2Ug
KG9sZCkgcHJvY2ZzIGludGVyZmFjZT8gKi8KKyNpZmRlZiBDT05GSUdfQ0RST01f
UEtUQ0RWRF9QUk9DSU5URgorI2RlZmluZSBQS1RfVVNFX1BST0NGUyAgMQorI2Vs
c2UKKyNkZWZpbmUgUEtUX1VTRV9QUk9DRlMgIDAKKyNlbmRpZgorCiBzdHJ1Y3Qg
cGFja2V0X3NldHRpbmdzCiB7CiAJX191MzIJCQlzaXplOwkJLyogcGFja2V0IHNp
emUgaW4gKDUxMiBieXRlKSBzZWN0b3JzICovCg==

------------KzrdD7iN27cqphGKjVRtVg--

