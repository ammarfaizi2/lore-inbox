Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S263310AbREWWzk>; Wed, 23 May 2001 18:55:40 -0400
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S263306AbREWWz3>; Wed, 23 May 2001 18:55:29 -0400
Received: from echo.sound.net ([205.242.192.21]:55012 "HELO echo.sound.net")
	by vger.kernel.org with SMTP id <S263307AbREWWzL>;
	Wed, 23 May 2001 18:55:11 -0400
Date: Wed, 23 May 2001 17:53:44 -0500 (CDT)
From: Hal Duston <hald@sound.net>
To: linux-kernel@vger.kernel.org
cc: alan@lxorguk.ukuu.org.uk
Subject: PS/2 Esdi patch #7
Message-ID: <Pine.GSO.4.10.10105231744550.23376-200000@sound.net>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-758783491-990658052=:23376"
Content-ID: <Pine.GSO.4.10.10105231753380.23376@sound.net>
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

---559023410-758783491-990658052=:23376
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.GSO.4.10.10105231753381.23376@sound.net>

Remove (incorrect) drive count detection stuff.
For now hard-code the drive count as 1 for integrated, and 2 for normal.
The second drive will error out if it isn't there.
(Which is what it did before anyway.)
If the second drive isn't really there back it out from the drive count.
The original code was starting at one and then detecting
   the _adapter_ and incrementing the drive count.
Still need to research the correct way to do drive count detection.

Again at
http://www.sound.net/~hald/projects/ps2esdi/ps2esdi-2.4.4-patch3

Hal Duston
hald@sound.net

---559023410-758783491-990658052=:23376
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII; NAME="ps2esdi-2.4.4-patch3"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.GSO.4.10.10105231747320.23376@sound.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="ps2esdi-2.4.4-patch3"

UmVtb3ZlIChpbmNvcnJlY3QpIGRyaXZlIGNvdW50IGRldGVjdGlvbiBzdHVm
Zi4NCkZvciBub3cgaGFyZC1jb2RlIHRoZSBkcml2ZSBjb3VudCBhcyAxIGZv
ciBpbnRlZ3JhdGVkLCBhbmQgMiBmb3Igbm9ybWFsLg0KVGhlIHNlY29uZCBk
cml2ZSB3aWxsIGVycm9yIG91dCBpZiBpdCBpc24ndCB0aGVyZS4NCihXaGlj
aCBpcyB3aGF0IGl0IGRpZCBiZWZvcmUgYW55d2F5LikNCklmIHRoZSBzZWNv
bmQgZHJpdmUgaXNuJ3QgcmVhbGx5IHRoZXJlIGJhY2sgaXQgb3V0IGZyb20g
dGhlIGRyaXZlIGNvdW50Lg0KVGhlIG9yaWdpbmFsIGNvZGUgd2FzIHN0YXJ0
aW5nIGF0IG9uZSBhbmQgdGhlbiBkZXRlY3RpbmcNCiAgIHRoZSBfYWRhcHRl
cl8gYW5kIGluY3JlbWVudGluZyB0aGUgZHJpdmUgY291bnQuDQpTdGlsbCBu
ZWVkIHRvIHJlc2VhcmNoIHRoZSBjb3JyZWN0IHdheSB0byBkbyBkcml2ZSBj
b3VudCBkZXRlY3Rpb24uDQoNCi0tLSBsaW51eC0yLjQuNS1wcmU0L2RyaXZl
cnMvYmxvY2svcHMyZXNkaS5jLjIJTW9uIE1heSAyMSAwMDowMzowMiAyMDAx
DQorKysgbGludXgtMi40LjUtcHJlNC9kcml2ZXJzL2Jsb2NrL3BzMmVzZGku
Yy4zCU1vbiBNYXkgMjEgMDA6MDU6MzQgMjAwMQ0KQEAgLTEyNSw3ICsxMjUs
NiBAQA0KIHN0YXRpYyBpbnQgcHMyZXNkaV9zbG90ID0gLTE7DQogc3RhdGlj
IHVfY2hhciBwczJlc2RpX3Bvc1s4XTsNCiBzdGF0aWMgaW50IHRwNzIwZXNk
aSA9IDA7CS8qIElzIGl0IEludGVncmF0ZWQgRVNESSBvZiBUaGlua1BhZC03
MjA/ICovDQotc3RhdGljIGludCBpbnRnX2VzZGkgPSAwOyAgICAgICAvKiBJ
ZiBpbnRlZ3JhdGVkIGFkYXB0ZXIgKi8NCiBzdHJ1Y3QgcHMyZXNkaV9pX3N0
cnVjdCB7DQogCXVuc2lnbmVkIGludCBoZWFkLCBzZWN0LCBjeWwsIHdwY29t
LCBsem9uZSwgY3RsOw0KIH07DQpAQCAtNDc4LDcgKzQ3NywxMCBAQA0KIA0K
IAkvKiBJbnRlZ3JhdGVkIEVTREkgRGlzayBhbmQgQ29udHJvbGxlciBoYXMg
b25seSBvbmUgZHJpdmUhICovDQogCWlmIChhZGFwdGVySUQgPT0gSU5UR19F
U0RJX0lEKSB7LyogaWYgbm90ICJub3JtYWwiIFBTMiBFU0RJIGFkYXB0ZXIg
Ki8NCi0JCXBzMmVzZGlfZHJpdmVzID0gMTsJLyogdGhlbiB3ZSBoYXZlIG9u
bHkgb25lIHBoeXNpY2FsIGRpc2shICovCQlpbnRnX2VzZGkgPSAxOw0KKwkJ
cHMyZXNkaV9kcml2ZXMgPSAxOwkvKiB0aGVuIHdlIGhhdmUgb25seSBvbmUg
cGh5c2ljYWwgZGlzayEgKi8NCisJfQ0KKwllbHNlIHsNCisJCXBzMmVzZGlf
ZHJpdmVzID0gMjsNCiAJfQ0KIA0KIA0KQEAgLTQ4NywxMyArNDg5LDYgQEAN
CiANCiAJcHMyZXNkaV9nZXRfZGV2aWNlX2NmZygpOw0KIA0KLQkvKiBzb21l
IGFubm95YW5jZSBpbiB0aGUgYWJvdmUgcm91dGluZSByZXR1cm5zIFRXTyBk
cml2ZXM/DQotCSBJcyBzb21ldGhpbmcgZWxzZSBoYXBwaW5pbmcgaW4gdGhl
IGJhY2tncm91bmQ/DQotCSBSZWdhdXJkbGVzcyB3ZSBmaXggdGhlICMgb2Yg
ZHJpdmVzIGFnYWluLiBBSksgKi8NCi0JLyogSW50ZWdyYXRlZCBFU0RJIERp
c2sgYW5kIENvbnRyb2xsZXIgaGFzIG9ubHkgb25lIGRyaXZlISAqLw0KLQlp
ZiAoYWRhcHRlcklEID09IElOVEdfRVNESV9JRCkJLyogaWYgbm90ICJub3Jt
YWwiIFBTMiBFU0RJIGFkYXB0ZXIgKi8NCi0JCXBzMmVzZGlfZHJpdmVzID0g
MTsJLyogTm90IHRocmVlIG9yIHR3bywgT05FIERBTU5JVCEgKi8NCi0NCiAJ
Y3VycmVudF9pbnRfaGFuZGxlciA9IHBzMmVzZGlfbm9ybWFsX2ludGVycnVw
dF9oYW5kbGVyOw0KIA0KIAlwczJlc2RpX2dlbmRpc2subnJfcmVhbCA9IHBz
MmVzZGlfZHJpdmVzOw0KQEAgLTUxNywyNSArNTEyLDE5IEBADQogc3RhdGlj
IHZvaWQgX19pbml0IHBzMmVzZGlfZ2V0X2RldmljZV9jZmcodm9pZCkNCiB7
DQogCXVfc2hvcnQgY21kX2Jsa1tUWVBFXzBfQ01EX0JMS19MRU5HVEhdOw0K
KwlpbnQgaTsNCiANCi0JLypCQSAqLyBwcmludGsoIiVzOiBEcml2ZSAwXG4i
LCBERVZJQ0VfTkFNRSk7DQorCS8qQkEgKi8NCiAJY3VycmVudF9pbnRfaGFu
ZGxlciA9IHBzMmVzZGlfZ2VvbWV0cnlfaW50X2hhbmRsZXI7DQotCWNtZF9i
bGtbMF0gPSBDTURfR0VUX0RFVl9DT05GSUcgfCAweDYwMDsNCi0JY21kX2Js
a1sxXSA9IDA7DQotCW5vX2ludF95ZXQgPSBUUlVFOw0KLQlwczJlc2RpX291
dF9jbWRfYmxrKGNtZF9ibGspOw0KLQlpZiAobm9faW50X3lldCkNCi0JCXNs
ZWVwX29uKCZwczJlc2RpX2ludCk7DQotDQotCWlmIChwczJlc2RpX2RyaXZl
cyA+IDEpIHsNCi0JCXByaW50aygiJXM6IERyaXZlIDFcbiIsIERFVklDRV9O
QU1FKTsJLypCQSAqLw0KLQkJY21kX2Jsa1swXSA9IENNRF9HRVRfREVWX0NP
TkZJRyB8ICgxIDw8IDUpIHwgMHg2MDA7DQorCWZvcihpID0gMDsgaSA8IHBz
MmVzZGlfZHJpdmVzOyArK2kpIHsNCisJCXByaW50aygiJXM6IERyaXZlICVk
XG4iLCBERVZJQ0VfTkFNRSwgaSk7CS8qQkEgKi8NCisJCWNtZF9ibGtbMF0g
PSBDTURfR0VUX0RFVl9DT05GSUcgfCAoaSA8PCA1KSB8IDB4NjAwOw0KIAkJ
Y21kX2Jsa1sxXSA9IDA7DQogCQlub19pbnRfeWV0ID0gVFJVRTsNCiAJCXBz
MmVzZGlfb3V0X2NtZF9ibGsoY21kX2Jsayk7DQogCQlpZiAobm9faW50X3ll
dCkNCiAJCQlzbGVlcF9vbigmcHMyZXNkaV9pbnQpOw0KLQl9CQkJLyogaWYg
c2Vjb25kIHBoeXNpY2FsIGRyaXZlIGlzIHByZXNlbnQgKi8NCisJfQ0KIAly
ZXR1cm47DQogfQ0KIA0KQEAgLTg2Miw5ICs4NTEsNiBAQA0KIAkJCQkJCXBz
MmVzZGlfaW5mb1swXS5jeWwgPSByZXBseVszXTsNCiAJCQkJCQlwczJlc2Rp
X2luZm9bMF0ud3Bjb20gPSAwOw0KIAkJCQkJCXBzMmVzZGlfaW5mb1swXS5s
em9uZSA9IHJlcGx5WzNdOw0KLQkJCQkJfSBlbHNlIHsNCi0JCQkJCQlpZiAo
IWludGdfZXNkaSkNCi0JCQkJCQkJcHMyZXNkaV9kcml2ZXMrKzsNCiAJCQkJ
CX0NCiAJCQkJfQ0KICNpZmRlZiBPQlNPTEVURQ0KQEAgLTg4MCw4ICs4NjYs
NiBAQA0KIAkJCQkJCXBzMmVzZGlfaW5mb1swXS5jeWwgPSByZXBseVszXTsN
CiAJCQkJCQlwczJlc2RpX2luZm9bMF0ud3Bjb20gPSAwOw0KIAkJCQkJCXBz
MmVzZGlfaW5mb1swXS5sem9uZSA9IHJlcGx5WzNdOw0KLQkJCQkJfSBlbHNl
IHsNCi0JCQkJCQlwczJlc2RpX2RyaXZlcysrOw0KIAkJCQkJfQ0KIAkJCQl9
DQogI2VuZGlmDQpAQCAtOTAwLDYgKzg4NCw3IEBADQogCQlwcmludGsoIiVz
OiBBdHRlbnRpb24gZXJyb3IuIGludGVycnVwdCBzdGF0dXMgOiAlMDJYXG4i
LCBERVZJQ0VfTkFNRSwNCiAJCSAgICAgICBpbnRfcmV0X2NvZGUpOw0KIAkJ
cHJpbnRrKCIlczogRGV2aWNlIG5vdCBhdmFpbGFibGVcbiIsIERFVklDRV9O
QU1FKTsNCisJCS0tcHMyZXNkaV9kcml2ZXM7DQogCQlicmVhazsNCiAJY2Fz
ZSBJTlRfQ01EX0VDQzoNCiAJY2FzZSBJTlRfQ01EX1JFVFJZOg0KQEAgLTkx
Miw2ICs4OTcsNyBAQA0KIAkJLypCQSAqLyBwcmludGsoIiVzOiBXaGFhLiBF
cnJvciBvY2N1cnJlZC4uLlxuIiwgREVWSUNFX05BTUUpOw0KIAkJZHVtcF9j
bWRfY29tcGxldGVfc3RhdHVzKGludF9yZXRfY29kZSk7DQogCQlvdXRiKChp
bnRfcmV0X2NvZGUgJiAweGUwKSB8IEFUVF9FT0ksIEVTRElfQVRUTik7DQor
CQktLXBzMmVzZGlfZHJpdmVzOw0KIAkJYnJlYWs7DQogCWRlZmF1bHQ6DQog
CQlwcmludGsoIiVzOiBVbmtub3duIGludGVycnVwdCByZWFzb246ICUwMlhc
biIsDQo=
---559023410-758783491-990658052=:23376--
