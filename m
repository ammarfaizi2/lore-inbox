Return-Path: <linux-kernel-owner+willy=40w.ods.org-S1030424AbVLNDai@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1030424AbVLNDai (ORCPT <rfc822;willy@w.ods.org>);
	Tue, 13 Dec 2005 22:30:38 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S1030425AbVLNDai
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Tue, 13 Dec 2005 22:30:38 -0500
Received: from fmr17.intel.com ([134.134.136.16]:1700 "EHLO
	orsfmr002.jf.intel.com") by vger.kernel.org with ESMTP
	id S1030424AbVLNDah (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Tue, 13 Dec 2005 22:30:37 -0500
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C6005E.BF161B04"
Subject: [PATCH 2/2] Export cpu info by sysfs
X-MimeOLE: Produced By Microsoft Exchange V6.5.7226.0
Date: Wed, 14 Dec 2005 11:30:33 +0800
Message-ID: <8126E4F969BA254AB43EA03C59F44E840431BB3D@pdsmsx404>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: [PATCH 2/2] Export cpu info by sysfs
Thread-Index: AcYAXr3MAY022mytTW6hF4QBHYYZlw==
From: "Zhang, Yanmin" <yanmin.zhang@intel.com>
To: <linux-kernel@vger.kernel.org>
Cc: "Pallipadi, Venkatesh" <venkatesh.pallipadi@intel.com>
X-OriginalArrivalTime: 14 Dec 2005 03:30:36.0196 (UTC) FILETIME=[BF3C3E40:01C6005E]
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

This is a multi-part message in MIME format.

------_=_NextPart_001_01C6005E.BF161B04
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable

The second patch is to export cache info which is similar to
/proc/pal/cpuX/cache_info. One important new item is shared_cpu_map.
shared_cpu_map showes the cpu map sharing the cache.

The items (attributes) are:
	level
	type
	coherency_line_size
	stride
	ways_of_associativity
	store_latency
	load_latency
	store_hints
	load_hints
	alias_boundary
	tag_lsb
	tag_msb
	size
	shared_cpu_map
	attributes

This patch depends on the first patch because they change the same
source file.

Signed-off-by: Zhang Yanmin <yanmin.zhang@intel.com>


------_=_NextPart_001_01C6005E.BF161B04
Content-Type: application/octet-stream;
	name="export_cache_info_sysfs_2.6.14_mm1_ia64.v12.patch"
Content-Transfer-Encoding: base64
Content-Description: export_cache_info_sysfs_2.6.14_mm1_ia64.v12.patch
Content-Disposition: attachment;
	filename="export_cache_info_sysfs_2.6.14_mm1_ia64.v12.patch"

ZGlmZiAtTnJhdXAgbGludXgtMi42LjE0X21tMV90b3BvbG9neS9hcmNoL2lhNjQva2VybmVsL3Rv
cG9sb2d5LmMgbGludXgtMi42LjE0X21tMV9jYWNoZS9hcmNoL2lhNjQva2VybmVsL3RvcG9sb2d5
LmMKLS0tIGxpbnV4LTIuNi4xNF9tbTFfdG9wb2xvZ3kvYXJjaC9pYTY0L2tlcm5lbC90b3BvbG9n
eS5jCTIwMDUtMTEtMDkgMTc6MjY6NTYuMDAwMDAwMDAwICswODAwCisrKyBsaW51eC0yLjYuMTRf
bW0xX2NhY2hlL2FyY2gvaWE2NC9rZXJuZWwvdG9wb2xvZ3kuYwkyMDA1LTExLTA5IDE3OjI5OjU4
LjAwMDAwMDAwMCArMDgwMApAQCAtMTksNiArMTksNyBAQAogI2luY2x1ZGUgPGxpbnV4L2luaXQu
aD4KICNpbmNsdWRlIDxsaW51eC9ib290bWVtLmg+CiAjaW5jbHVkZSA8bGludXgvbm9kZW1hc2su
aD4KKyNpbmNsdWRlIDxsaW51eC9ub3RpZmllci5oPgogI2luY2x1ZGUgPGFzbS9tbXpvbmUuaD4K
ICNpbmNsdWRlIDxhc20vbnVtYS5oPgogI2luY2x1ZGUgPGFzbS9jcHUuaD4KQEAgLTI0NCw1ICsy
NDUsNDY3IEBAIHN0YXRpYyBpbnQgX19jcHVpbml0IHRvcG9sb2d5X3N5c2ZzX2luaXQKIGRldmlj
ZV9pbml0Y2FsbCh0b3BvbG9neV9zeXNmc19pbml0KTsKIAogI2VuZGlmIC8vQ09ORklHX1NNUAor
CisKKy8qCisgKiBFeHBvcnQgY3B1IGNhY2hlIGluZm9ybWF0aW9uIHRocm91Z2ggc3lzZnMKKyAq
LworCisvKgorICogIEEgYnVuY2ggb2Ygc3RyaW5nIGFycmF5IHRvIGdldCBwcmV0dHkgcHJpbnRp
bmcKKyAqLworc3RhdGljIGNvbnN0IGNoYXIgKmNhY2hlX3R5cGVzW10gPSB7CisJIiIsCQkJLyog
bm90IHVzZWQgKi8KKwkiSW5zdHJ1Y3Rpb24iLAorCSJEYXRhIiwKKwkiRGF0YS9JbnN0cnVjdGlv
biIJLyogdW5pZmllZCAqLworfTsKKworc3RhdGljIGNvbnN0IGNoYXIgKmNhY2hlX21hdHRyaWJb
XT17CisJIldyaXRlVGhyb3VnaCIsCisJIldyaXRlQmFjayIsCisJIiIsCQkvKiByZXNlcnZlZCAq
LworCSIiCQkvKiByZXNlcnZlZCAqLworfTsKKworc3RhdGljIGNvbnN0IGNoYXIgKmNhY2hlX3N0
X2hpbnRzW109eworCSJUZW1wb3JhbCwgbGV2ZWwgMSIsCisJIlJlc2VydmVkIiwKKwkiUmVzZXJ2
ZWQiLAorCSJOb24tdGVtcG9yYWwsIGFsbCBsZXZlbHMiLAorCSJSZXNlcnZlZCIsCisJIlJlc2Vy
dmVkIiwKKwkiUmVzZXJ2ZWQiLAorCSJSZXNlcnZlZCIKK307CisKK3N0YXRpYyBjb25zdCBjaGFy
ICpjYWNoZV9sZF9oaW50c1tdPXsKKwkiVGVtcG9yYWwsIGxldmVsIDEiLAorCSJOb24tdGVtcG9y
YWwsIGxldmVsIDEiLAorCSJSZXNlcnZlZCIsCisJIk5vbi10ZW1wb3JhbCwgYWxsIGxldmVscyIs
CisJIlJlc2VydmVkIiwKKwkiUmVzZXJ2ZWQiLAorCSJSZXNlcnZlZCIsCisJIlJlc2VydmVkIgor
fTsKKworc3RydWN0IF9jYWNoZV9pbmZvIHsKKwlwYWxfY2FjaGVfY29uZmlnX2luZm9fdAljY2k7
CisJY3B1bWFza190IHNoYXJlZF9jcHVfbWFwOworCWludCBsZXZlbDsKKwlpbnQgdHlwZTsKKwlz
dHJ1Y3Qga29iamVjdCBrb2JqOworfTsKKworc3RydWN0IGNwdV9jYWNoZV9pbmZvIHsKKwlzdHJ1
Y3QgX2NhY2hlX2luZm8gKmNhY2hlX2xlYXZlczsKKwlpbnQJbnVtX2NhY2hlX2xlYXZlczsKKwlz
dHJ1Y3Qga29iamVjdCBrb2JqOworfTsKKworc3RhdGljIHN0cnVjdCBjcHVfY2FjaGVfaW5mbwlh
bGxfY3B1X2NhY2hlX2luZm9bTlJfQ1BVU107CisjZGVmaW5lIExFQUZfS09CSkVDVF9QVFIoeCx5
KSAgICAoJmFsbF9jcHVfY2FjaGVfaW5mb1t4XS5jYWNoZV9sZWF2ZXNbeV0pCisKKyNpZmRlZiBD
T05GSUdfU01QCitzdGF0aWMgdm9pZCBjYWNoZV9zaGFyZWRfY3B1X21hcF9zZXR1cCggdW5zaWdu
ZWQgaW50IGNwdSwKKwkJc3RydWN0IF9jYWNoZV9pbmZvICogdGhpc19sZWFmKQoreworCXBhbF9j
YWNoZV9zaGFyZWRfaW5mb190CWNzaTsKKwlpbnQgbnVtX3NoYXJlZCwgaSA9IDA7CisJdW5zaWdu
ZWQgaW50IGo7CisKKwlpZiAoY3B1X2RhdGEoY3B1KS0+dGhyZWFkc19wZXJfY29yZSA8PSAxICYm
CisJCWNwdV9kYXRhKGNwdSktPmNvcmVzX3Blcl9zb2NrZXQgPD0gMSkgeworCQljcHVfc2V0KGNw
dSwgdGhpc19sZWFmLT5zaGFyZWRfY3B1X21hcCk7CisJCXJldHVybjsKKwl9CisKKwlpZiAoaWE2
NF9wYWxfY2FjaGVfc2hhcmVkX2luZm8odGhpc19sZWFmLT5sZXZlbCwKKwkJCQkJdGhpc19sZWFm
LT50eXBlLAorCQkJCQkwLAorCQkJCQkmY3NpKSAhPSBQQUxfU1RBVFVTX1NVQ0NFU1MpCisJCXJl
dHVybjsKKworCW51bV9zaGFyZWQgPSAoaW50KSBjc2kubnVtX3NoYXJlZDsKKwlkbyB7CisJCWZv
cl9lYWNoX2NwdShqKQorCQkJaWYgKGNwdV9kYXRhKGNwdSktPnNvY2tldF9pZCA9PSBjcHVfZGF0
YShqKS0+c29ja2V0X2lkCisJCQkJJiYgY3B1X2RhdGEoaiktPmNvcmVfaWQgPT0gY3NpLmxvZzFf
Y2lkCisJCQkJJiYgY3B1X2RhdGEoaiktPnRocmVhZF9pZCA9PSBjc2kubG9nMV90aWQpCisJCQkJ
Y3B1X3NldChqLCB0aGlzX2xlYWYtPnNoYXJlZF9jcHVfbWFwKTsKKworCQlpKys7CisJfSB3aGls
ZSAoaSA8IG51bV9zaGFyZWQgJiYKKwkJaWE2NF9wYWxfY2FjaGVfc2hhcmVkX2luZm8odGhpc19s
ZWFmLT5sZXZlbCwKKwkJCQl0aGlzX2xlYWYtPnR5cGUsCisJCQkJaSwKKwkJCQkmY3NpKSA9PSBQ
QUxfU1RBVFVTX1NVQ0NFU1MpOworfQorI2Vsc2UKK3N0YXRpYyB2b2lkIGNhY2hlX3NoYXJlZF9j
cHVfbWFwX3NldHVwKHVuc2lnbmVkIGludCBjcHUsCisJCXN0cnVjdCBfY2FjaGVfaW5mbyAqIHRo
aXNfbGVhZikKK3sKKwljcHVfc2V0KGNwdSwgdGhpc19sZWFmLT5zaGFyZWRfY3B1X21hcCk7CisJ
cmV0dXJuOworfQorI2VuZGlmCisKK3N0YXRpYyBzc2l6ZV90IHNob3dfY29oZXJlbmN5X2xpbmVf
c2l6ZShzdHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwKKwkJCQkJY2hhciAqYnVmKQorewor
CXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCAxIDw8IHRoaXNfbGVhZi0+Y2NpLnBjY2lfbGlu
ZV9zaXplKTsKK30KKworc3RhdGljIHNzaXplX3Qgc2hvd193YXlzX29mX2Fzc29jaWF0aXZpdHko
c3RydWN0IF9jYWNoZV9pbmZvICp0aGlzX2xlYWYsCisJCQkJCWNoYXIgKmJ1ZikKK3sKKwlyZXR1
cm4gc3ByaW50ZihidWYsICIldVxuIiwgdGhpc19sZWFmLT5jY2kucGNjaV9hc3NvYyk7Cit9CisK
K3N0YXRpYyBzc2l6ZV90IHNob3dfc3RvcmVfbGF0ZW5jeShzdHJ1Y3QgX2NhY2hlX2luZm8gKnRo
aXNfbGVhZiwgY2hhciAqYnVmKQoreworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1IGN5Y2xlKHMp
XG4iLCB0aGlzX2xlYWYtPmNjaS5wY2NpX3N0X2xhdGVuY3kpOworfQorCitzdGF0aWMgc3NpemVf
dCBzaG93X2xvYWRfbGF0ZW5jeShzdHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwgY2hhciAq
YnVmKQoreworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1IGN5Y2xlKHMpXG4iLCB0aGlzX2xlYWYt
PmNjaS5wY2NpX2xkX2xhdGVuY3kpOworfQorCitzdGF0aWMgc3NpemVfdCBzaG93X3N0b3JlX2hp
bnRzKHN0cnVjdCBfY2FjaGVfaW5mbyAqdGhpc19sZWFmLCBjaGFyICpidWYpCit7CisJaW50IGs7
CisJY2hhciAqcCA9IGJ1ZjsKKwl1OCBzdF9oaW50cyA9IHRoaXNfbGVhZi0+Y2NpLnBjY2lfc3Rf
aGludHM7CisKKwlwWzBdID0gJ1wwJzsKKwlmb3IoayA9IDA7IGsgPCA4OyBrICsrICkgeworCQlp
ZiAoc3RfaGludHMgJiAweDEpCisJCQlwICs9IHNwcmludGYocCwgIlslc10iLCBjYWNoZV9zdF9o
aW50c1trXSk7CisJCXN0X2hpbnRzID4+PSAxOworCX0KKwlwICs9IHNwcmludGYocCwgIlxuIik7
CisJcmV0dXJuIHAgLSBidWY7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHNob3dfbG9hZF9oaW50cyhz
dHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwgY2hhciAqYnVmKQoreworCWludCBrOworCWNo
YXIgKnAgPSBidWY7CisJdTggbGRfaGludHMgPSB0aGlzX2xlYWYtPmNjaS5wY2NpX2xkX2hpbnRz
OworCisJcFswXSA9ICdcMCc7CisJZm9yKGsgPSAwOyBrIDwgODsgayArKykgeworCQlpZiAobGRf
aGludHMgJiAweDEpCisJCQlwICs9IHNwcmludGYocCwgIlslc10iLCBjYWNoZV9sZF9oaW50c1tr
XSk7CisJCWxkX2hpbnRzID4+PSAxOworCX0KKwlwICs9IHNwcmludGYocCwgIlxuIik7CisJcmV0
dXJuIHAgLSBidWY7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHNob3dfYWxpYXNfYm91bmRhcnkoc3Ry
dWN0IF9jYWNoZV9pbmZvICp0aGlzX2xlYWYsIGNoYXIgKmJ1ZikKK3sKKwlyZXR1cm4gc3ByaW50
ZihidWYsICIlZFxuIiwgMSA8PCB0aGlzX2xlYWYtPmNjaS5wY2NpX2FsaWFzX2JvdW5kYXJ5KTsK
K30KKworc3RhdGljIHNzaXplX3Qgc2hvd19zdHJpZGUoc3RydWN0IF9jYWNoZV9pbmZvICp0aGlz
X2xlYWYsIGNoYXIgKmJ1ZikKK3sKKwlyZXR1cm4gc3ByaW50ZihidWYsICIlZFxuIiwgMSA8PCB0
aGlzX2xlYWYtPmNjaS5wY2NpX3N0cmlkZSk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHNob3dfYXR0
cmlidXRlcyhzdHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwgY2hhciAqYnVmKQoreworCXJl
dHVybiBzcHJpbnRmKGJ1ZiwKKwkJCSIlc1xuIiwKKwkJCWNhY2hlX21hdHRyaWJbdGhpc19sZWFm
LT5jY2kucGNjaV9jYWNoZV9hdHRyXSk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHNob3dfdGFnX2xz
YihzdHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwgY2hhciAqYnVmKQoreworCXJldHVybiBz
cHJpbnRmKGJ1ZiwgIiVkXG4iLCB0aGlzX2xlYWYtPmNjaS5wY2NpX3RhZ19sc2IpOworfQorCitz
dGF0aWMgc3NpemVfdCBzaG93X3RhZ19tc2Ioc3RydWN0IF9jYWNoZV9pbmZvICp0aGlzX2xlYWYs
IGNoYXIgKmJ1ZikKK3sKKwlyZXR1cm4gc3ByaW50ZihidWYsICIlZFxuIiwgdGhpc19sZWFmLT5j
Y2kucGNjaV90YWdfbXNiKTsKK30KKworc3RhdGljIHNzaXplX3Qgc2hvd19zaXplKHN0cnVjdCBf
Y2FjaGVfaW5mbyAqdGhpc19sZWFmLCBjaGFyICpidWYpCit7CisJcmV0dXJuIHNwcmludGYoYnVm
LCAiJWx1S1xuIiwgdGhpc19sZWFmLT5jY2kucGNjaV9jYWNoZV9zaXplIC8gMTAyNCk7Cit9CisK
K3N0YXRpYyBzc2l6ZV90IHNob3dfc2hhcmVkX2NwdV9tYXAoc3RydWN0IF9jYWNoZV9pbmZvICp0
aGlzX2xlYWYsIGNoYXIgKmJ1ZikKK3sKKwlzc2l6ZV90CWxlbjsKKwljcHVtYXNrX3Qgc2hhcmVk
X2NwdV9tYXA7CisKKwljcHVzX2FuZChzaGFyZWRfY3B1X21hcCwgdGhpc19sZWFmLT5zaGFyZWRf
Y3B1X21hcCwgY3B1X29ubGluZV9tYXApOworCWxlbiA9IGNwdW1hc2tfc2NucHJpbnRmKGJ1Ziwg
TlJfQ1BVUysxLCBzaGFyZWRfY3B1X21hcCk7CisJbGVuICs9IHNwcmludGYoYnVmK2xlbiwgIlxu
Iik7CisJcmV0dXJuIGxlbjsKK30KKworc3RhdGljIHNzaXplX3Qgc2hvd190eXBlKHN0cnVjdCBf
Y2FjaGVfaW5mbyAqdGhpc19sZWFmLCBjaGFyICpidWYpCit7CisJaW50IHR5cGUgPSB0aGlzX2xl
YWYtPnR5cGUgKyB0aGlzX2xlYWYtPmNjaS5wY2NpX3VuaWZpZWQ7CisJcmV0dXJuIHNwcmludGYo
YnVmLCAiJXNcbiIsIGNhY2hlX3R5cGVzW3R5cGVdKTsKK30KKworc3RhdGljIHNzaXplX3Qgc2hv
d19sZXZlbChzdHJ1Y3QgX2NhY2hlX2luZm8gKnRoaXNfbGVhZiwgY2hhciAqYnVmKQoreworCXJl
dHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCB0aGlzX2xlYWYtPmxldmVsKTsKK30KKworc3RydWN0
IF9jYWNoZV9hdHRyIHsKKwlzdHJ1Y3QgYXR0cmlidXRlIGF0dHI7CisJc3NpemVfdCAoKnNob3cp
KHN0cnVjdCBfY2FjaGVfaW5mbyAqLCBjaGFyICopOworCXNzaXplX3QgKCpzdG9yZSkoc3RydWN0
IF9jYWNoZV9pbmZvICosIGNvbnN0IGNoYXIgKiwgc2l6ZV90IGNvdW50KTsKK307CisKKyNpZmRl
ZiBkZWZpbmVfb25lX3JvCisJI3VuZGVmIGRlZmluZV9vbmVfcm8KKyNlbmRpZgorI2RlZmluZSBk
ZWZpbmVfb25lX3JvKF9uYW1lKSBcCisJc3RhdGljIHN0cnVjdCBfY2FjaGVfYXR0ciBfbmFtZSA9
IFwKK19fQVRUUihfbmFtZSwgMDQ0NCwgc2hvd18jI19uYW1lLCBOVUxMKQorCitkZWZpbmVfb25l
X3JvKGxldmVsKTsKK2RlZmluZV9vbmVfcm8odHlwZSk7CitkZWZpbmVfb25lX3JvKGNvaGVyZW5j
eV9saW5lX3NpemUpOworZGVmaW5lX29uZV9ybyhzdHJpZGUpOworZGVmaW5lX29uZV9ybyh3YXlz
X29mX2Fzc29jaWF0aXZpdHkpOworZGVmaW5lX29uZV9ybyhzdG9yZV9sYXRlbmN5KTsKK2RlZmlu
ZV9vbmVfcm8obG9hZF9sYXRlbmN5KTsKK2RlZmluZV9vbmVfcm8oc3RvcmVfaGludHMpOworZGVm
aW5lX29uZV9ybyhsb2FkX2hpbnRzKTsKK2RlZmluZV9vbmVfcm8oYWxpYXNfYm91bmRhcnkpOwor
ZGVmaW5lX29uZV9ybyh0YWdfbHNiKTsKK2RlZmluZV9vbmVfcm8odGFnX21zYik7CitkZWZpbmVf
b25lX3JvKHNpemUpOworZGVmaW5lX29uZV9ybyhzaGFyZWRfY3B1X21hcCk7CitkZWZpbmVfb25l
X3JvKGF0dHJpYnV0ZXMpOworCitzdGF0aWMgc3RydWN0IGF0dHJpYnV0ZSAqIGNhY2hlX2RlZmF1
bHRfYXR0cnNbXSA9IHsKKwkmdHlwZS5hdHRyLAorCSZsZXZlbC5hdHRyLAorCSZjb2hlcmVuY3lf
bGluZV9zaXplLmF0dHIsCisJJnN0cmlkZS5hdHRyLAorCSZ3YXlzX29mX2Fzc29jaWF0aXZpdHku
YXR0ciwKKwkmc3RvcmVfbGF0ZW5jeS5hdHRyLAorCSZsb2FkX2xhdGVuY3kuYXR0ciwKKwkmYWxp
YXNfYm91bmRhcnkuYXR0ciwKKwkmdGFnX2xzYi5hdHRyLAorCSZ0YWdfbXNiLmF0dHIsCisJJmF0
dHJpYnV0ZXMuYXR0ciwKKwkmc2l6ZS5hdHRyLAorCSZzaGFyZWRfY3B1X21hcC5hdHRyLAorCSZz
dG9yZV9oaW50cy5hdHRyLAorCSZsb2FkX2hpbnRzLmF0dHIsCisJTlVMTAorfTsKKworI2RlZmlu
ZSB0b19vYmplY3QoaykgY29udGFpbmVyX29mKGssIHN0cnVjdCBfY2FjaGVfaW5mbywga29iaikK
KyNkZWZpbmUgdG9fYXR0cihhKSBjb250YWluZXJfb2YoYSwgc3RydWN0IF9jYWNoZV9hdHRyLCBh
dHRyKQorCitzdGF0aWMgc3NpemVfdCBjYWNoZV9zaG93KHN0cnVjdCBrb2JqZWN0ICoga29iaiwg
c3RydWN0IGF0dHJpYnV0ZSAqIGF0dHIsIGNoYXIgKiBidWYpCit7CisJc3RydWN0IF9jYWNoZV9h
dHRyICpmYXR0ciA9IHRvX2F0dHIoYXR0cik7CisJc3RydWN0IF9jYWNoZV9pbmZvICp0aGlzX2xl
YWYgPSB0b19vYmplY3Qoa29iaik7CisJc3NpemVfdCByZXQ7CisKKwlyZXQgPSBmYXR0ci0+c2hv
dyA/IGZhdHRyLT5zaG93KHRoaXNfbGVhZiwgYnVmKSA6IDA7CisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIHNzaXplX3QgY2FjaGVfc3RvcmUoc3RydWN0IGtvYmplY3QgKiBrb2JqLCBzdHJ1Y3Qg
YXR0cmlidXRlICogYXR0ciwKKwkJY29uc3QgY2hhciAqIGJ1Ziwgc2l6ZV90IGNvdW50KQorewor
CXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IHN5c2ZzX29wcyBjYWNoZV9zeXNmc19vcHMg
PSB7CisJLnNob3cgICA9IGNhY2hlX3Nob3csCisJLnN0b3JlICA9IGNhY2hlX3N0b3JlLAorfTsK
Kworc3RhdGljIHN0cnVjdCBrb2JqX3R5cGUgY2FjaGVfa3R5cGUgPSB7CisJLnN5c2ZzX29wcwk9
ICZjYWNoZV9zeXNmc19vcHMsCisJLmRlZmF1bHRfYXR0cnMJPSBjYWNoZV9kZWZhdWx0X2F0dHJz
LAorfTsKKworc3RhdGljIHN0cnVjdCBrb2JqX3R5cGUgY2FjaGVfa3R5cGVfcGVyY3B1X2VudHJ5
ID0geworCS5zeXNmc19vcHMJPSAmY2FjaGVfc3lzZnNfb3BzLAorfTsKKworc3RhdGljIHZvaWQg
X19jcHVpbml0IGNwdV9jYWNoZV9zeXNmc19leGl0KHVuc2lnbmVkIGludCBjcHUpCit7CisJaWYg
KGFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLmNhY2hlX2xlYXZlcykgeworCQlrZnJlZShhbGxfY3B1
X2NhY2hlX2luZm9bY3B1XS5jYWNoZV9sZWF2ZXMpOworCQlhbGxfY3B1X2NhY2hlX2luZm9bY3B1
XS5jYWNoZV9sZWF2ZXMgPSBOVUxMOworCX0KKwlhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5udW1f
Y2FjaGVfbGVhdmVzID0gMDsKKwltZW1zZXQoJmFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLmtvYmos
IDAsIHNpemVvZihzdHJ1Y3Qga29iamVjdCkpOworCisJcmV0dXJuOworfQorCitzdGF0aWMgaW50
IF9fY3B1aW5pdCBjcHVfY2FjaGVfc3lzZnNfaW5pdCh1bnNpZ25lZCBpbnQgY3B1KQoreworCXU2
NCBpLCBsZXZlbHMsIHVuaXF1ZV9jYWNoZXM7CisJcGFsX2NhY2hlX2NvbmZpZ19pbmZvX3QgY2Np
OworCWludCBqOworCXM2NCBzdGF0dXM7CisJc3RydWN0IF9jYWNoZV9pbmZvICp0aGlzX2NhY2hl
OworCWludCBudW1fY2FjaGVfbGVhdmVzID0gMDsKKworCWlmICgoc3RhdHVzID0gaWE2NF9wYWxf
Y2FjaGVfc3VtbWFyeSgmbGV2ZWxzLCAmdW5pcXVlX2NhY2hlcykpICE9IDApIHsKKwkJcHJpbnRr
KEtFUk5fRVJSICJpYTY0X3BhbF9jYWNoZV9zdW1tYXJ5PSVsZFxuIiwgc3RhdHVzKTsKKwkJcmV0
dXJuIC0xOworCX0KKworCXRoaXNfY2FjaGU9a3phbGxvYyhzaXplb2Yoc3RydWN0IF9jYWNoZV9p
bmZvKSp1bmlxdWVfY2FjaGVzLAorCQkJR0ZQX0tFUk5FTCk7CisJaWYgKHRoaXNfY2FjaGUgPT0g
TlVMTCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlmb3IgKGk9MDsgaSA8IGxldmVsczsgaSsrKSB7
CisJCWZvciAoaj0yOyBqID4wIDsgai0tKSB7CisJCQlpZiAoKHN0YXR1cz1pYTY0X3BhbF9jYWNo
ZV9jb25maWdfaW5mbyhpLGosICZjY2kpKSAhPQorCQkJCQlQQUxfU1RBVFVTX1NVQ0NFU1MpCisJ
CQkJY29udGludWU7CisKKwkJCXRoaXNfY2FjaGVbbnVtX2NhY2hlX2xlYXZlc10uY2NpID0gY2Np
OworCQkJdGhpc19jYWNoZVtudW1fY2FjaGVfbGVhdmVzXS5sZXZlbCA9IGk7CisJCQl0aGlzX2Nh
Y2hlW251bV9jYWNoZV9sZWF2ZXNdLnR5cGUgPSBqOworCisJCQljYWNoZV9zaGFyZWRfY3B1X21h
cF9zZXR1cChjcHUsCisJCQkJCSZ0aGlzX2NhY2hlW251bV9jYWNoZV9sZWF2ZXNdKTsKKwkJCW51
bV9jYWNoZV9sZWF2ZXMgKys7CisJCX0KKwl9CisKKwlhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5j
YWNoZV9sZWF2ZXMgPSB0aGlzX2NhY2hlOworCWFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLm51bV9j
YWNoZV9sZWF2ZXMgPSBudW1fY2FjaGVfbGVhdmVzOworCisJbWVtc2V0KCZhbGxfY3B1X2NhY2hl
X2luZm9bY3B1XS5rb2JqLCAwLCBzaXplb2Yoc3RydWN0IGtvYmplY3QpKTsKKworCXJldHVybiAw
OworfQorCisvKiBBZGQgY2FjaGUgaW50ZXJmYWNlIGZvciBDUFUgZGV2aWNlICovCitzdGF0aWMg
aW50IF9fY3B1aW5pdCBjYWNoZV9hZGRfZGV2KHN0cnVjdCBzeXNfZGV2aWNlICogc3lzX2RldikK
K3sKKwl1bnNpZ25lZCBpbnQgY3B1ID0gc3lzX2Rldi0+aWQ7CisJdW5zaWduZWQgbG9uZyBpLCBq
OworCXN0cnVjdCBfY2FjaGVfaW5mbyAqdGhpc19vYmplY3Q7CisJaW50IHJldHZhbCA9IDA7CisJ
Y3B1bWFza190ICAgICAgICAgICAgICAgb2xkbWFzazsKKworCWlmIChhbGxfY3B1X2NhY2hlX2lu
Zm9bY3B1XS5rb2JqLnBhcmVudCkKKwkJcmV0dXJuIDA7CisKKwlvbGRtYXNrID0gY3VycmVudC0+
Y3B1c19hbGxvd2VkOworCXJldHZhbCA9IHNldF9jcHVzX2FsbG93ZWQoY3VycmVudCwgY3B1bWFz
a19vZl9jcHUoY3B1KSk7CisJaWYgKHVubGlrZWx5KHJldHZhbCkpCisJCXJldHVybiByZXR2YWw7
CisKKwlyZXR2YWwgPSBjcHVfY2FjaGVfc3lzZnNfaW5pdChjcHUpOworCXNldF9jcHVzX2FsbG93
ZWQoY3VycmVudCwgb2xkbWFzayk7CisJaWYgKHVubGlrZWx5KHJldHZhbCA8IDApKQorCQlyZXR1
cm4gcmV0dmFsOworCisJYWxsX2NwdV9jYWNoZV9pbmZvW2NwdV0ua29iai5wYXJlbnQgPSAmc3lz
X2Rldi0+a29iajsKKwlrb2JqZWN0X3NldF9uYW1lKCZhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5r
b2JqLCAiJXMiLCAiY2FjaGUiKTsKKwlhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5rb2JqLmt0eXBl
ID0gJmNhY2hlX2t0eXBlX3BlcmNwdV9lbnRyeTsKKwlyZXR2YWwgPSBrb2JqZWN0X3JlZ2lzdGVy
KCZhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5rb2JqKTsKKworCWZvciAoaSA9IDA7IGkgPCBhbGxf
Y3B1X2NhY2hlX2luZm9bY3B1XS5udW1fY2FjaGVfbGVhdmVzOyBpKyspIHsKKwkJdGhpc19vYmpl
Y3QgPSBMRUFGX0tPQkpFQ1RfUFRSKGNwdSxpKTsKKwkJdGhpc19vYmplY3QtPmtvYmoucGFyZW50
ID0gJmFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLmtvYmo7CisJCWtvYmplY3Rfc2V0X25hbWUoJih0
aGlzX29iamVjdC0+a29iaiksICJpbmRleCUxbHUiLCBpKTsKKwkJdGhpc19vYmplY3QtPmtvYmou
a3R5cGUgPSAmY2FjaGVfa3R5cGU7CisJCXJldHZhbCA9IGtvYmplY3RfcmVnaXN0ZXIoJih0aGlz
X29iamVjdC0+a29iaikpOworCQlpZiAodW5saWtlbHkocmV0dmFsKSkgeworCQkJZm9yIChqID0g
MDsgaiA8IGk7IGorKykgeworCQkJCWtvYmplY3RfdW5yZWdpc3RlcigKKwkJCQkJJihMRUFGX0tP
QkpFQ1RfUFRSKGNwdSxqKS0+a29iaikpOworCQkJfQorCQkJa29iamVjdF91bnJlZ2lzdGVyKCZh
bGxfY3B1X2NhY2hlX2luZm9bY3B1XS5rb2JqKTsKKwkJCWNwdV9jYWNoZV9zeXNmc19leGl0KGNw
dSk7CisJCQlicmVhazsKKwkJfQorCX0KKwlyZXR1cm4gcmV0dmFsOworfQorCisvKiBSZW1vdmUg
Y2FjaGUgaW50ZXJmYWNlIGZvciBDUFUgZGV2aWNlICovCitzdGF0aWMgaW50IF9fY3B1ZXhpdCBj
YWNoZV9yZW1vdmVfZGV2KHN0cnVjdCBzeXNfZGV2aWNlICogc3lzX2RldikKK3sKKwl1bnNpZ25l
ZCBpbnQgY3B1ID0gc3lzX2Rldi0+aWQ7CisJdW5zaWduZWQgbG9uZyBpOworCisJZm9yIChpID0g
MDsgaSA8IGFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLm51bV9jYWNoZV9sZWF2ZXM7IGkrKykKKwkJ
a29iamVjdF91bnJlZ2lzdGVyKCYoTEVBRl9LT0JKRUNUX1BUUihjcHUsaSktPmtvYmopKTsKKwor
CWlmIChhbGxfY3B1X2NhY2hlX2luZm9bY3B1XS5rb2JqLnBhcmVudCkgeworCQlrb2JqZWN0X3Vu
cmVnaXN0ZXIoJmFsbF9jcHVfY2FjaGVfaW5mb1tjcHVdLmtvYmopOworCQltZW1zZXQoJmFsbF9j
cHVfY2FjaGVfaW5mb1tjcHVdLmtvYmosCisJCQkwLAorCQkJc2l6ZW9mKHN0cnVjdCBrb2JqZWN0
KSk7CisJfQorCisJY3B1X2NhY2hlX3N5c2ZzX2V4aXQoY3B1KTsKKworCXJldHVybiAwOworfQor
CisvKgorICogV2hlbiBhIGNwdSBpcyBob3QtcGx1Z2dlZCwgZG8gYSBjaGVjayBhbmQgaW5pdGlh
dGUKKyAqIGNhY2hlIGtvYmplY3QgaWYgbmVjZXNzYXJ5CisgKi8KK3N0YXRpYyBpbnQgX19jcHVp
bml0IGNhY2hlX2NwdV9jYWxsYmFjayhzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5mYiwKKwkJdW5z
aWduZWQgbG9uZyBhY3Rpb24sIHZvaWQgKmhjcHUpCit7CisJdW5zaWduZWQgaW50IGNwdSA9ICh1
bnNpZ25lZCBsb25nKWhjcHU7CisJc3RydWN0IHN5c19kZXZpY2UgKnN5c19kZXY7CisKKwlzeXNf
ZGV2ID0gZ2V0X2NwdV9zeXNkZXYoY3B1KTsKKwlzd2l0Y2ggKGFjdGlvbikgeworCQljYXNlIENQ
VV9PTkxJTkU6CisJCQljYWNoZV9hZGRfZGV2KHN5c19kZXYpOworCQkJYnJlYWs7CisjaWZkZWYJ
Q09ORklHX0hPVFBMVUdfQ1BVCisJCWNhc2UgQ1BVX0RFQUQ6CisJCQljYWNoZV9yZW1vdmVfZGV2
KHN5c19kZXYpOworCQkJYnJlYWs7CisjZW5kaWYKKwl9CisJcmV0dXJuIE5PVElGWV9PSzsKK30K
Kworc3RhdGljIHN0cnVjdCBub3RpZmllcl9ibG9jayBjYWNoZV9jcHVfbm90aWZpZXIgPQorewor
CS5ub3RpZmllcl9jYWxsID0gY2FjaGVfY3B1X2NhbGxiYWNrCit9OworCitzdGF0aWMgaW50IF9f
Y3B1aW5pdCBjYWNoZV9zeXNmc19pbml0KHZvaWQpCit7CisJaW50IGk7CisKKwlmb3JfZWFjaF9v
bmxpbmVfY3B1KGkpIHsKKwkJY2FjaGVfY3B1X2NhbGxiYWNrKCZjYWNoZV9jcHVfbm90aWZpZXIs
IENQVV9PTkxJTkUsCisJCQkJKHZvaWQgKikobG9uZylpKTsKKwl9CisKKwlyZWdpc3Rlcl9jcHVf
bm90aWZpZXIoJmNhY2hlX2NwdV9ub3RpZmllcik7CisKKwlyZXR1cm4gMDsKK30KKworZGV2aWNl
X2luaXRjYWxsKGNhY2hlX3N5c2ZzX2luaXQpOworCiAjZW5kaWYJLy9DT05GSUdfU1lTRlMKIApk
aWZmIC1OcmF1cCBsaW51eC0yLjYuMTRfbW0xX3RvcG9sb2d5L2luY2x1ZGUvYXNtLWlhNjQvcGFs
LmggbGludXgtMi42LjE0X21tMV9jYWNoZS9pbmNsdWRlL2FzbS1pYTY0L3BhbC5oCi0tLSBsaW51
eC0yLjYuMTRfbW0xX3RvcG9sb2d5L2luY2x1ZGUvYXNtLWlhNjQvcGFsLmgJMjAwNS0xMS0wOCAx
NzozOToxNS4wMDAwMDAwMDAgKzA4MDAKKysrIGxpbnV4LTIuNi4xNF9tbTFfY2FjaGUvaW5jbHVk
ZS9hc20taWE2NC9wYWwuaAkyMDA1LTExLTA5IDE3OjI5OjA1LjAwMDAwMDAwMCArMDgwMApAQCAt
NjgsNiArNjgsNyBAQAogI2RlZmluZSBQQUxfU0hVVERPV04JCTQwCS8qIGVudGVyIHByb2Nlc3Nv
ciBzaHV0ZG93biBzdGF0ZSAqLwogI2RlZmluZSBQQUxfUFJFRkVUQ0hfVklTSUJJTElUWQk0MQkv
KiBNYWtlIFByb2Nlc3NvciBQcmVmZXRjaGVzIFZpc2libGUgKi8KICNkZWZpbmUgUEFMX0xPR0lD
QUxfVE9fUEhZU0lDQUwgNDIJLyogcmV0dXJucyBpbmZvcm1hdGlvbiBvbiBsb2dpY2FsIHRvIHBo
eXNpY2FsIHByb2Nlc3NvciBtYXBwaW5nICovCisjZGVmaW5lIFBBTF9DQUNIRV9TSEFSRURfSU5G
Twk0MwkvKiByZXR1cm5zIGluZm9ybWF0aW9uIG9uIGNhY2hlcyBzaGFyZWQgYnkgbG9naWNhbCBw
cm9jZXNzb3IgKi8KIAogI2RlZmluZSBQQUxfQ09QWV9QQUwJCTI1NgkvKiByZWxvY2F0ZSBQQUwg
cHJvY2VkdXJlcyBhbmQgUEFMIFBNSSAqLwogI2RlZmluZSBQQUxfSEFMVF9JTkZPCQkyNTcJLyog
cmV0dXJuIHRoZSBsb3cgcG93ZXIgY2FwYWJpbGl0aWVzIG9mIHByb2Nlc3NvciAqLwpAQCAtMTY0
OCw2ICsxNjQ5LDMzIEBAIGlhNjRfcGFsX2xvZ2ljYWxfdG9fcGh5cyh1NjQgcHJvY19udW1iZXIK
IAogCXJldHVybiBpcHJ2LnN0YXR1czsKIH0KKwordHlwZWRlZiBzdHJ1Y3QgcGFsX2NhY2hlX3No
YXJlZF9pbmZvX3MKK3sKKwl1NjQgbnVtX3NoYXJlZDsKKwlwYWxfcHJvY19uX2xvZ19pbmZvMV90
IHBwbGkxOworCXBhbF9wcm9jX25fbG9nX2luZm8yX3QgcHBsaTI7Cit9IHBhbF9jYWNoZV9zaGFy
ZWRfaW5mb190OworCisvKiBHZXQgaW5mb3JtYXRpb24gb24gbG9naWNhbCB0byBwaHlzaWNhbCBw
cm9jZXNzb3IgbWFwcGluZ3MuICovCitzdGF0aWMgaW5saW5lIHM2NAoraWE2NF9wYWxfY2FjaGVf
c2hhcmVkX2luZm8odTY0IGxldmVsLAorCQl1NjQgdHlwZSwKKwkJdTY0IHByb2NfbnVtYmVyLAor
CQlwYWxfY2FjaGVfc2hhcmVkX2luZm9fdCAqaW5mbykKK3sKKwlzdHJ1Y3QgaWE2NF9wYWxfcmV0
dmFsIGlwcnY7CisKKwlQQUxfQ0FMTChpcHJ2LCBQQUxfQ0FDSEVfU0hBUkVEX0lORk8sIGxldmVs
LCB0eXBlLCBwcm9jX251bWJlcik7CisKKwlpZiAoaXBydi5zdGF0dXMgPT0gUEFMX1NUQVRVU19T
VUNDRVNTKSB7CisJCWluZm8tPm51bV9zaGFyZWQgPSBpcHJ2LnYwOworCQlpbmZvLT5wcGxpMS5w
cGxpMV9kYXRhID0gaXBydi52MTsKKwkJaW5mby0+cHBsaTIucHBsaTJfZGF0YSA9IGlwcnYudjI7
CisJfQorCisJcmV0dXJuIGlwcnYuc3RhdHVzOworfQogI2VuZGlmIC8qIF9fQVNTRU1CTFlfXyAq
LwogCiAjZW5kaWYgLyogX0FTTV9JQTY0X1BBTF9IICovCg==

------_=_NextPart_001_01C6005E.BF161B04--
