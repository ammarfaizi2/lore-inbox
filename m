Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id <S310289AbSCLBRc>; Mon, 11 Mar 2002 20:17:32 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org
	id <S310279AbSCLBRX>; Mon, 11 Mar 2002 20:17:23 -0500
Received: from megaela.fe.dis.titech.ac.jp ([131.112.171.110]:1807 "HELO
	megaela.srvf.org") by vger.kernel.org with SMTP id <S310280AbSCLBRK>;
	Mon, 11 Mar 2002 20:17:10 -0500
Date: Tue, 12 Mar 2002 10:17:07 +0900
Message-ID: <w53adte1t64.wl@megaela.fe.dis.titech.ac.jp>
From: GOTO Masanori <gotom@debian.or.jp>
To: garloff@suse.de, dougg@torque.net, sct@redhat.com,
        jeremy@classic.engr.sgi.com, phillips@bonn-fries.net,
        James.Bottomley@SteelEye.com, mason@suse.com,
        linux-kernel@vger.kernel.org, linux-scsi@vger.kernel.org
Subject: Re: [PATCH] 2.4.x write barriers (updated for ext3)
In-Reply-To: In your message of "Mon, 11 Mar 2002 12:13:00 +0100"
	<20020311121300.G2346@nbkurt.etpnet.phys.tue.nl>
In-Reply-To: <200202281536.g1SFaqF02079@localhost.localdomain>
	<E16heCm-0000Q5-00@starship.berlin>
	<10203032021.ZM443706@classic.engr.sgi.com>
	<E16hl4R-0000Zx-00@starship.berlin>
	<phillips@bonn-fries.net>
	<10203032209.ZM424559@classic.engr.sgi.com>
	<20020304165216.A1444@redhat.com>
	<3C8AEDFC.502CAD04@torque.net>
	<20020311121300.G2346@nbkurt.etpnet.phys.tue.nl>
User-Agent: Wanderlust/2.2.15 (More Than Words) EMIKO/1.13.9 (Euglena tripteris) FLIM/1.13.2 (Kasanui) APEL/10.2 MULE XEmacs/21.1 (patch 10) (Capitol Reef) (i386-debian-linux)
MIME-Version: 1.0 (generated by EMIKO 1.13.9 - "Euglena tripteris")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

At Mon, 11 Mar 2002 12:13:00 +0100,
Kurt Garloff <garloff@suse.de> wrote:
> On Sun, Mar 10, 2002 at 12:24:12AM -0500, Douglas Gilbert wrote:
> > "Stephen C. Tweedie" wrote:
> > > Even if WCE is enabled in the caching mode page, we can still set FUA
> > > (Force Unit Access) in individual write commands to force platter
> > > completion before commands complete.
> > > 
> > > Of course, it's a good question whether this is honoured properly on
> > > all drives.
> > > 
> > > FUA is not available on WRITE6, only WRITE10 or WRITE12 commands.
> > 
> > Stephen,
> [...]
> > 
> > Also SYNCHRONIZE CACHE(10) allows a range of blocks to be sent
> > to the platter but the size of the range is limited to 2**16 - 1
> > blocks which is probably too small to be useful. If the
> > "number of blocks" field is set to 0 then the whole disk cache
> > is flushed to the platter.
> 
> Which I think we should send before shutdown (and possible poweroff) for
> disks (DASDs), Write-Once and Optical Memory devices. (Funny enough, the
> SCSI spec also lists SYNCHRONIZE_CACHE for CD-Rom devices
> Unfortunately, SYNCHRONIZE CACHE is optional, so we would need to ignore any
> errors returned by this command.

I agree.
BTW, power management like suspend/resume needs 
SYNCHRONIZE_CACHE for the broken HDD/controller...?

-- gotom
