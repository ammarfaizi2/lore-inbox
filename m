Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S263082AbTJZMUq (ORCPT <rfc822;willy@w.ods.org>);
	Sun, 26 Oct 2003 07:20:46 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S263084AbTJZMUq
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Sun, 26 Oct 2003 07:20:46 -0500
Received: from mailhost.tue.nl ([131.155.2.7]:59397 "EHLO mailhost.tue.nl")
	by vger.kernel.org with ESMTP id S263082AbTJZMUn (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Sun, 26 Oct 2003 07:20:43 -0500
Date: Sun, 26 Oct 2003 13:20:40 +0100
From: Andries Brouwer <aebr@win.tue.nl>
To: "Norman Diamond" <ndiamond@wta.att.ne.jp>
Cc: "Hans Reiser" <reiser@namesys.com>, <linux-kernel@vger.kernel.org>
Subject: Re: ReiserFS, two oddities
Message-ID: <20031026122040.GA9906@win.tue.nl>
References: <334201c39b94$286e7ae0$24ee4ca5@DIAMONDLX60>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <334201c39b94$286e7ae0$24ee4ca5@DIAMONDLX60>
User-Agent: Mutt/1.3.25i
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, Oct 26, 2003 at 04:37:26PM +0900, Norman Diamond wrote:

> This is tangential to my observations about bad blocks (which the disk's
> firmware refused to reallocate during reads, writes, and S.M.A.R.T. long
> self-tests).  I have had two odd observations which seem related to ReiserFS
> on perfectly good blocks.
> 
> Here is partial output from fdisk's p command, copied by hand:
>   /dev/hda8   18169578  29431079   5630751   83  Linux
> 
> The sector is readable if I ignore partitions:
>   # dd if=/dev/hda of=/dev/null bs=512 skip=29431074 count=1
>   1+0 records in
>   1+0 records out
> but not if I address it from inside the partition:
>   # dd if=/dev/hda8 of=/dev/null bs=512 skip=11261496 count=1
>   dd: reading `/dev/hda8': Input/output error
>   0+0 records in
>   0+0 records out
> 
> LBA sector number 29431074 is inside the partition.  18169578 + 11261496 =
> 29431074, verified several times.  11261496 / 2 = 5630748, verified only
> twice, but it is within the quantity of 1K Linux blocks that the partition
> has.  Why is the sector unreadable when read from inside the partition?

If I understand you correctly, there may never have been a bad block.
That is good for Toshiba, no reason to say bad things about their disks.

Also, if there was no bad block, then no reallocation is needed.

You show that dd reads this sector without problems.
But you see an I/O error when it is just at the edge of the partition.
That I/O error may well be generated by Linux, not by the disk.

The details depend on kernel version, and I forgot what kernel
you used. Try  blockdev --getbsz /dev/hda  to see what blocksize
Linux is using. If that is 4096, that is 8 sectors, but only 6 sectors
remain in the partition. Try  blockdev --setbsz 512 /dev/hda
and read again. Maybe this would succeed.

Andries


[didnt you get error messages in dmesg?]

