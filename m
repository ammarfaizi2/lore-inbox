Return-Path: <linux-kernel-owner+willy=40w.ods.org@vger.kernel.org>
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S265714AbUBKT0f (ORCPT <rfc822;willy@w.ods.org>);
	Wed, 11 Feb 2004 14:26:35 -0500
Received: (majordomo@vger.kernel.org) by vger.kernel.org id S266217AbUBKT0f
	(ORCPT <rfc822;linux-kernel-outgoing>);
	Wed, 11 Feb 2004 14:26:35 -0500
Received: from ns.suse.de ([195.135.220.2]:62374 "EHLO Cantor.suse.de")
	by vger.kernel.org with ESMTP id S265714AbUBKT0c (ORCPT
	<rfc822;linux-kernel@vger.kernel.org>);
	Wed, 11 Feb 2004 14:26:32 -0500
Date: Wed, 11 Feb 2004 20:26:30 +0100
Message-ID: <s5hlln9a049.wl@alsa2.suse.de>
From: Takashi Iwai <tiwai@suse.de>
To: Meelis Roos <mroos@linux.ee>
Cc: linux-kernel@vger.kernel.org
Subject: Re: 2.6.3-rc1: snd_intel8x0 still too fast
In-Reply-To: <Pine.GSO.4.44.0402111845200.19304-100000@math.ut.ee>
References: <s5hwu6ta7oh.wl@alsa2.suse.de>
	<Pine.GSO.4.44.0402111845200.19304-100000@math.ut.ee>
User-Agent: Wanderlust/2.10.1 (Watching The Wheels) SEMI/1.14.5 (Awara-Onsen) FLIM/1.14.5 (Demachiyanagi) APEL/10.6 MULE XEmacs/21.4 (patch 13) (Rational FORTRAN) (i386-suse-linux)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: multipart/mixed;
 boundary="Multipart_Wed_Feb_11_20:26:30_2004-1"
Sender: linux-kernel-owner@vger.kernel.org
X-Mailing-List: linux-kernel@vger.kernel.org

--Multipart_Wed_Feb_11_20:26:30_2004-1
Content-Type: text/plain; charset=US-ASCII

At Wed, 11 Feb 2004 18:49:36 +0200 (EET),
Meelis Roos wrote:
> 
> > hmm, please show /proc/asound/card0/codec97#0/ac97#0-0 and
> > ac97#0-0+regs files again?

oops, the patch was wrong.  could you try this one (and remove
/etc/asound.state before starting ALSA?)

also, if it still doesn't work, try to change the ADC VRA.
for example, run "arecord -fS16_LE -r44100 foo.wav" once before
playing 44100 samples.

also, to make sure that it's a hardware problem, please avoid mono
samples but use 16bit stereo samples only.


Takashi

--Multipart_Wed_Feb_11_20:26:30_2004-1
Content-Type: text/plain; charset=US-ASCII

--- linux/sound/pci/ac97/ac97_patch.c	9 Feb 2004 11:38:03 -0000	1.35
+++ linux/sound/pci/ac97/ac97_patch.c	11 Feb 2004 12:08:20 -0000	1.36
@@ -652,7 +652,7 @@
 
 static const snd_kcontrol_new_t snd_ac97_controls_ad1885[] = {
 	AC97_SINGLE("Digital Mono Direct", AC97_AD_MISC, 11, 1, 0),
-	AC97_SINGLE("Digital Audio Mode", AC97_AD_MISC, 12, 1, 0),
+	/* AC97_SINGLE("Digital Audio Mode", AC97_AD_MISC, 12, 1, 0), */ /* seems problematic */
 	AC97_SINGLE("Low Power Mixer", AC97_AD_MISC, 14, 1, 0),
 	AC97_SINGLE("Zero Fill DAC", AC97_AD_MISC, 15, 1, 0),
 };
@@ -682,6 +682,9 @@
 	jack = snd_ac97_read(ac97, AC97_AD_JACK_SPDIF);
 	snd_ac97_write_cache(ac97, AC97_AD_JACK_SPDIF, jack | 0x0300);
 
+	/* set default */
+	snd_ac97_write_cache(ac97, AC97_AD_MISC, 0x0404);
+
 	ac97->build_ops = &patch_ad1885_build_ops;
 	return 0;
 }

--Multipart_Wed_Feb_11_20:26:30_2004-1--
